import{y as e,g as t,r as n,j as r,_ as a,C as s,b as i,c as o,a as l,B as c,M as d,a9 as u,V as g}from"./index-BEYDIuQu.js";import{s as h}from"./supabase-DUkWVuqu.js";import{Z as m}from"./zap-Dc-JlMB3.js";import{C as p}from"./circle-alert-r6o2xtyK.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f=e("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),x=e("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]),y=e("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),b=[{code:"en",name:"English",flag:"ğŸ‡ºğŸ‡¸"},{code:"es",name:"EspaÃ±ol",flag:"ğŸ‡ªğŸ‡¸"},{code:"fr",name:"FranÃ§ais",flag:"ğŸ‡«ğŸ‡·"},{code:"de",name:"Deutsch",flag:"ğŸ‡©ğŸ‡ª"},{code:"zh",name:"ä¸­æ–‡",flag:"ğŸ‡¨ğŸ‡³"},{code:"ja",name:"æ—¥æœ¬èª",flag:"ğŸ‡¯ğŸ‡µ"},{code:"ko",name:"í•œêµ­ì–´",flag:"ğŸ‡°ğŸ‡·"},{code:"pt",name:"PortuguÃªs",flag:"ğŸ‡µğŸ‡¹"},{code:"ru",name:"Ğ ÑƒÑÑĞºĞ¸Ğ¹",flag:"ğŸ‡·ğŸ‡º"},{code:"ar",name:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",flag:"ğŸ‡¸ğŸ‡¦"},{code:"hi",name:"à¤¹à¤¿à¤¨à¥à¤¦à¥€",flag:"ğŸ‡®ğŸ‡³"}],w=()=>{const{toast:e}=t(),[w,S]=n.useState("idle"),[k,j]=n.useState(!1),[v,T]=n.useState([]),[N,$]=n.useState(""),[C,E]=n.useState(0),[R,A]=n.useState([]),[I,L]=n.useState("web-speech"),[M,F]=n.useState("Cherry"),[P,U]=n.useState(""),[O,z]=n.useState("en"),[B,Q]=n.useState(!0),J=[{id:"Cherry",name:"Cherry - Cheerful & Friendly",gender:"Female"},{id:"Ethan",name:"Ethan - Bright & Energetic",gender:"Male"},{id:"Nofish",name:"Nofish - Designer Voice",gender:"Neutral"},{id:"Jennifer",name:"Jennifer - Premium Cinematic",gender:"Female"},{id:"Ryan",name:"Ryan - Rhythmic & Dramatic",gender:"Male"},{id:"Katerina",name:"Katerina - Mature & Rhythmic",gender:"Female"},{id:"Elias",name:"Elias - Academic & Clear",gender:"Male"},{id:"Jada",name:"Shanghai-Jada - Lively",gender:"Female"},{id:"Dylan",name:"Beijing-Dylan - Teenager",gender:"Male"},{id:"Sunny",name:"Sichuan-Sunny - Sweet",gender:"Female"},{id:"Li",name:"Nanjing-Li - Patient Teacher",gender:"Female"},{id:"Marcus",name:"Shaanxi-Marcus - Sincere",gender:"Male"},{id:"Roy",name:"Minnan-Roy - Humorous",gender:"Male"},{id:"Peter",name:"Tianjin-Peter - Crosstalk",gender:"Male"},{id:"Rocky",name:"Cantonese-Rocky - Witty",gender:"Male"},{id:"Kiki",name:"Cantonese-Kiki - Sweet Friend",gender:"Female"},{id:"Eric",name:"Sichuan-Eric - Refined",gender:"Male"}],D=e=>{const t=(new Date).toLocaleTimeString();console.log(`[${t}] ${e}`),A(n=>[...n,`[${t}] ${e}`])},G=()=>{if(!K.current)return D("âš ï¸ Recognition not initialized"),!1;try{return"listening"===re.current||"starting"===re.current?(D("âš ï¸ Recognition already running, skipping start"),!1):(re.current="starting",K.current.start(),re.current="listening",D("âœ… Recognition started safely"),!0)}catch(e){const t=String(e);return t.includes("already started")?(D("âš ï¸ Recognition already started (caught)"),re.current="listening",!1):(D(`âŒ Failed to start recognition: ${t}`),re.current="idle",!1)}},_=async(e,t=3)=>{const n=M;for(let i=1;i<=t;i++)try{let a,s;D(`ğŸµ Qwen TTS attempt ${i}/${t} with voice: ${n}...`);try{const t=await h.functions.invoke("openrouter-qwen-tts",{body:{text:e,voice:n,language_type:"English"}});if(a=t.data,s=t.error,console.log("ğŸ” Full invoke result:",{hasData:!!a,hasError:!!s,dataSuccess:null==a?void 0:a.success,dataError:null==a?void 0:a.error,dataKeys:a?Object.keys(a):[],errorKeys:s?Object.keys(s):[]}),s){console.error("ğŸ” Supabase client error:",s);const e=s.message||JSON.stringify(s);throw D(`âŒ Qwen TTS function error: ${e}`),new Error(`Qwen TTS function error: ${e}`)}if(!a)throw new Error("No TTS data returned from Qwen function");if(!1===a.success||a.error){const e="string"==typeof a.error?a.error:JSON.stringify(a.error||"Unknown error"),t=a.details?` Details: ${JSON.stringify(a.details)}`:"",n=a.statusCode?` (Status: ${a.statusCode})`:"";throw D(`âŒ Qwen TTS API error: ${e}${t}${n}`),console.error("Full error response:",a),new Error(`Qwen TTS API error: ${e}${t}${n}`)}return a.audioContent?(D(`âœ… Qwen TTS successful (${a.audioContent.length} bytes)`),a.audioContent):(D(`âš ï¸ Unexpected response format: ${JSON.stringify(a).substring(0,200)}`),console.warn("Unexpected Qwen TTS response:",a),D("ğŸ”„ Falling back to Google TTS..."),await V(e,n))}catch(r){throw console.error("âŒ Supabase invoke exception:",r),r}}catch(a){const r=String(a);if(D(`âŒ Qwen TTS attempt ${i} failed: ${r}`),i===t){D("ğŸ”„ All Qwen TTS attempts failed, trying Google TTS fallback...");try{return await V(e,n)}catch(s){throw D(`âŒ Fallback TTS also failed: ${String(s)}`),s}}await new Promise(e=>setTimeout(e,1e3*Math.pow(2,i-1)))}throw new Error("Qwen TTS failed after all retries")},V=async(e,t)=>{const n=await fetch("https://texttospeech.googleapis.com/v1/text:synthesize?key=AIzaSyB4b-vDRpqbEZVMye8LBS6FugK1Wtgm1Us",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input:{text:e},voice:{languageCode:"en-US",name:t},audioConfig:{audioEncoding:"MP3",pitch:0,speakingRate:.95}})});if(!n.ok){const e=await n.text();throw new Error(`Google TTS fallback failed: ${n.status} - ${e.substring(0,100)}`)}const r=await n.json();if(!r.audioContent)throw new Error("No audio content from Google TTS fallback");return D(`âœ… Google TTS fallback successful (${r.audioContent.length} bytes)`),r.audioContent},W=async(e,t)=>{var n;if("en"!==t)try{const r=(null==(n=b.find(e=>e.code===t))?void 0:n.name)||t;D(`ğŸŒ Translating "${e.substring(0,30)}..." to ${r}...`);const{data:a,error:s}=await h.functions.invoke("ai-speaking-chat",{body:{message:`Translate this English text to ${r}: "${e}"\n\nIMPORTANT: Return ONLY the translation in ${r}, no explanations, no English text, just the translation.`}});if(s)return console.error("Translation API error:",s),void D(`âš ï¸ Translation API error: ${s.message||JSON.stringify(s)}`);if(!(null==a?void 0:a.success)||!(null==a?void 0:a.response))return void D("âš ï¸ Translation failed - no response data");let i=a.response.trim();return i=i.replace(/^["']|["']$/g,""),i=i.replace(/^Translation:\s*/i,""),i=i.replace(/^Here.*?:\s*/i,""),i=i.split("\n")[0],i=i.trim(),!i||i===e||i.length<3?void D("âš ï¸ Translation result invalid or same as original"):(D(`âœ… Translation successful: "${i.substring(0,50)}..."`),i)}catch(r){return console.error("Translation error:",r),void D(`âš ï¸ Translation exception: ${String(r)}`)}},K=n.useRef(null),Y=n.useRef("Starting new IELTS Speaking practice session"),q=n.useRef(null),H=n.useRef(null),Z=n.useRef(!1),X=n.useRef(!1),ee=n.useRef(null),te=n.useRef(null),ne=n.useRef([]),re=n.useRef("idle");n.useEffect(()=>{const t=window.SpeechRecognition||window.webkitSpeechRecognition;if(!t){return D("âš ï¸ "+"Browser Web Speech API not supported - will use Google Cloud Speech"),void L("google-cloud")}D("âœ… Web Speech API available"),L("web-speech");const n=new t;return n.continuous=!0,n.interimResults=!0,n.language="en-US",n.maxAlternatives=1,n.onstart=()=>{D("ğŸ¤ Speech recognition started (Web Speech API)"),S("listening"),$("")},n.onresult=e=>{D(`ğŸ“Š onresult fired (result index: ${e.resultIndex}, total results: ${e.results.length})`);let t="",n=!1,r="";for(let a=e.resultIndex;a<e.results.length;a++){const s=e.results[a][0].transcript,i=e.results[a][0].confidence;e.results[a].isFinal?(n=!0,r=s,D(`âœ… Final transcript: "${s}" (confidence: ${(100*i).toFixed(0)}%)`)):t+=s}t&&$(t),n&&r&&($(""),ae(r))},n.onerror=t=>{const n=`Speech recognition error: ${t.error}`;D("âŒ "+n),"no-speech"===t.error?D("âš ï¸ No speech detected, will restart on onend"):"network"===t.error?(D("âš ï¸ Network error, falling back to Google Cloud Speech"),L("google-cloud")):"aborted"!==t.error&&(e({title:"Mic Error",description:n,variant:"destructive"}),S("idle"))},n.onend=()=>{D("ğŸ›‘ Speech recognition ended"),Z.current?D("â¸ï¸  Already restarting, skipping duplicate attempt"):X.current?D("ğŸ›‘ onend during TTS playback, will not restart"):(Z.current=!0,re.current="idle",setTimeout(()=>{try{K.current&&"idle"!==w&&"speaking"!==w&&G()}catch(e){const t=String(e);t.includes("already started")||D("âš ï¸ Could not restart: "+t)}finally{Z.current=!1}},300))},K.current=n,D("âœ… Speech recognition initialized with auto-restart"),()=>{if(K.current)try{K.current.abort()}catch(e){}}},[e]),n.useEffect(()=>{const e=localStorage.getItem("ai-speaking-language");e&&z(e);const t=localStorage.getItem("ai-speaking-show-translation");null!==t&&Q("true"===t)},[]),n.useEffect(()=>{var e;null==(e=ee.current)||e.scrollIntoView({behavior:"smooth"})},[v,N]);const ae=async e=>{var t,n;D(`ğŸ“¢ Processing student text: "${e}"`),T(t=>[...t,{speaker:"student",text:e}]),S("thinking");try{D("ğŸ¤” Calling AI Speaking Chat for real conversation...");const s=(Y.current||"").split("\n").filter(e=>e.trim()),i=s.slice(-4),o=i.join("\n");let l;if(D(`ğŸ“ Context length: ${o.length} chars, ${s.length} total turns, using last ${i.length}`),D("ğŸ“¤ Sending request to AI Speaking Chat function..."),ne.current&&ne.current.length>0)try{const e=new Blob(ne.current.slice(-10),{type:"audio/webm"}),t=await e.arrayBuffer();l=btoa(String.fromCharCode(...new Uint8Array(t))),D(`ğŸµ Prepared audio data: ${l.length} bytes`)}catch(r){D(`âš ï¸ Failed to prepare audio data: ${r}`)}D(`ğŸ“¤ Request body: message="${e.substring(0,50)}...", audioBase64=${l?l.length+" bytes":"none"}`);const{data:c,error:d}=await h.functions.invoke("ai-speaking-chat",{body:{message:e,audioBase64:l,audioMimeType:"audio/webm"}});if(D(`ğŸ“¡ Raw response: data=${JSON.stringify(c).substring(0,200)}, error=${JSON.stringify(d)}`),d)throw D(`âŒ Supabase function error: ${d.message}`),new Error(`Supabase function failed: ${d.message}`);if(!c)throw D("âŒ No data returned from function"),new Error("No data returned from AI Speaking Chat function");if(!c.success)throw D(`âŒ Function returned success=false: ${c.error||"Unknown error"}`),new Error(`AI Speaking Chat failed: ${c.error||"Unknown error"}`);let u=c.response;u||(D("âŒ No text from AI Speaking Chat - using fallback"),u="That's interesting! Can you tell me more about that?"),D(`âœ… AI Speaking Chat response text: "${u.substring(0,100)}"`);let g=u.trim().substring(0,200);if(u.length>200){const e=g.split(/[.!?]+/);g=e.slice(0,-1).join(". "),g.endsWith(".")||(g+=".")}g&&0!==g.trim().length||(D("âš ï¸ Response was empty after processing, using fallback"),g="That's interesting! Can you tell me more about that?"),D(`âœ… Final tutor response: "${g}"`),Y.current+=`\nStudent: ${e}\nTutor: ${g}`,D("ğŸµ Calling Qwen 3 TTS Flash for response...");const m=O;let p;if(D(`ğŸ” Current selectedLanguage value: "${m}"`),m&&"en"!==m){const e=(null==(t=b.find(e=>e.code===m))?void 0:t.name)||m;D(`ğŸŒ Translating AI response to ${e} (code: ${m})...`);try{p=await W(g,m),D(p?`âœ… Translation complete: "${p.substring(0,50)}..."`:"âš ï¸ Translation returned undefined - will not show translation")}catch(a){D(`âŒ Translation exception: ${String(a)}`),p=void 0}}else D(`â„¹ï¸ Translation skipped - language is "${m}" (should be non-English code)`);const f=await _(g);D(`âœ… TTS_FETCH Qwen 3 TTS Flash (${f.length} bytes)`);let x=f.trim().replace(/\s/g,"");for(x=x.replace(/-/g,"+").replace(/_/g,"/");x.length%4;)x+="=";const y=atob(x),w=new Uint8Array(y.length);for(let e=0;e<y.length;e++)w[e]=y.charCodeAt(e);const k=new Blob([w],{type:"audio/mp3"}),j={speaker:"tutora",text:g,translation:p||void 0};if(D(`ğŸ“ Adding to transcript - text: "${g.substring(0,30)}...", translation: ${p?`"${p.substring(0,30)}..."`:"NONE"}`),D(`ğŸ“ Message object: ${JSON.stringify({...j,translation:p||"undefined"})}`),T(e=>[...e,j]),q.current){try{null==(n=K.current)||n.stop(),re.current="stopping"}catch{}X.current=!0;const e=URL.createObjectURL(k);q.current.src=e,D("PLAY_START response"),q.current.play(),S("speaking"),q.current.onended=()=>{URL.revokeObjectURL(e),D("PLAY_END response"),X.current=!1,D("â¹ï¸ Audio finished, resuming listening"),S("listening"),setTimeout(()=>{G()},500)}}else D("âŒ No audio element available"),S("listening")}catch(a){const e=a instanceof Error?a.message:String(a);D("âŒ Error: "+e),console.error("Error in conversation flow:",a);try{D("ğŸ†˜ Attempting recovery with fallback...");const e="I'm having a technical issue, but I'm still here to help! Please try again.";try{let t=(await _(e)).trim().replace(/\s/g,"");for(t=t.replace(/-/g,"+").replace(/_/g,"/");t.length%4;)t+="=";const n=atob(t),r=new Uint8Array(n.length);for(let e=0;e<n.length;e++)r[e]=n.charCodeAt(e);const a=new Blob([r],{type:"audio/mp3"});if(q.current){const e=URL.createObjectURL(a);q.current.src=e,q.current.play(),q.current.onended=()=>{URL.revokeObjectURL(e),S("listening"),setTimeout(()=>G(),500)}}}catch(s){D("âš ï¸ Fallback TTS failed: "+String(s))}}catch(i){D("âŒ Recovery failed: "+String(i))}S("listening")}},se=()=>{D(`â–¶ï¸ Starting call (using ${I})`),T([]),E(0),A([]),Y.current="Starting new IELTS Speaking practice session",H.current=setInterval(()=>{E(e=>e+1)},1e3),D("ğŸ¤ Requesting mic access and starting greeting..."),(async()=>{var e,t;try{D("ğŸ¤ Playing AI greeting...");const r="Hello! I'm English Tutora, your IELTS Speaking coach. Let's practice together. What would you like to talk about today?";let a;if("en"!==O){D(`ğŸŒ Translating greeting to ${(null==(e=b.find(e=>e.code===O))?void 0:e.name)||O}...`);try{a=await W(r,O),D(a?`âœ… Greeting translation complete: "${a.substring(0,50)}..."`:"âš ï¸ Greeting translation returned undefined")}catch(n){D(`âš ï¸ Greeting translation failed: ${String(n)}`),a=void 0}}D(`ğŸµ Calling Qwen 3 TTS Flash with voice: ${M}`);const s=await _(r);D(`âœ… TTS_FETCH greeting (${s.length} bytes)`);const i=s.substring(0,100),o=s.substring(Math.max(0,s.length-50));D(`ğŸ” Base64 preview: first="${i}...", last="...${o}"`);let l=s;if(s.startsWith("data:")){const e=s.match(/base64,(.+)$/);e&&(l=e[1],D(`ğŸ” Extracted base64 from data URL (${l.length} chars)`))}let c=l.trim().replace(/\s/g,"");for(c=c.replace(/-/g,"+").replace(/_/g,"/");c.length%4;)c+="=";const d=/^[A-Za-z0-9+/]*={0,2}$/;if(!d.test(c)){const e=c.match(/[^A-Za-z0-9+/=]/g);throw D(`âŒ Invalid base64 characters found: ${(null==e?void 0:e.join(", "))||"unknown"}`),new Error("Invalid base64 format: contains invalid characters")}D(`ğŸ” Cleaning base64: length=${c.length}, valid=${d.test(c)}`);const u=atob(c),g=new Uint8Array(u.length);for(let e=0;e<u.length;e++)g[e]=u.charCodeAt(e);const h=new Blob([g],{type:"audio/mp3"});if(q.current){try{null==(t=K.current)||t.stop()}catch{}X.current=!0;const e=URL.createObjectURL(h);q.current.src=e,D("PLAY_START greeting"),S("speaking"),T(e=>[...e,{speaker:"tutora",text:r,translation:a}]),q.current.onended=()=>{URL.revokeObjectURL(e),D("PLAY_END greeting"),X.current=!1,D("âœ… Greeting finished, starting to listen..."),S("listening"),setTimeout(()=>{G()},500)},q.current.onerror=e=>{D("âŒ Audio playback error: "+String(e)),X.current=!1,S("listening"),setTimeout(()=>G(),500)},q.current.play().catch(e=>{D("âŒ Could not play audio: "+String(e)),X.current=!1,S("listening"),setTimeout(()=>G(),500)})}}catch(n){D("âŒ Greeting error: "+String(n)),D("ğŸ“ Starting listening anyway..."),S("listening"),setTimeout(()=>{G()},500)}})()};return r.jsx(a,{title:"AI Speaking Tutor",showBackButton:!0,backPath:"/ielts-portal",children:r.jsxs("div",{className:"max-w-3xl mx-auto space-y-4",children:[r.jsxs(s,{children:[r.jsx(i,{className:"pb-3",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx(o,{className:"text-xl",children:"English Tutora - IELTS Speaking Practice"}),r.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Real-time voice conversation with AI coaching"})]}),r.jsxs("div",{className:"text-right",children:[r.jsx("div",{className:"text-2xl font-mono font-bold",children:(ie=C,`${Math.floor(ie/60)}:${(ie%60).toString().padStart(2,"0")}`)}),r.jsxs("div",{className:"text-xs text-muted-foreground flex items-center justify-end gap-1",children:[r.jsx("span",{children:"listening"===w?"ğŸ¤ Listening":"thinking"===w?"ğŸ¤” Thinking...":"speaking"===w?"ğŸ”Š Speaking":"âš« Ready"}),"google-cloud"===I&&r.jsx(m,{className:"w-3 h-3"})]})]})]})}),r.jsxs(l,{className:"flex gap-3 justify-center pt-0",children:["idle"===w&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"flex gap-2 items-center",children:[r.jsx("label",{className:"text-sm font-medium",children:"Voice:"}),r.jsx("select",{value:M,onChange:e=>F(e.target.value),className:"px-3 py-2 border border-input rounded-md bg-background text-sm",disabled:"idle"!==w,children:J.map(e=>r.jsxs("option",{value:e.id,children:[e.name," (",e.gender,")"]},e.id))})]}),r.jsxs(c,{onClick:se,size:"lg",className:"gap-2",children:[r.jsx(y,{className:"w-5 h-5"}),"Start Call"]})]}),("listening"===w||"thinking"===w||"speaking"===w)&&r.jsxs(r.Fragment,{children:[r.jsxs(c,{variant:k?"secondary":"outline",onClick:()=>j(!k),size:"lg",className:"gap-2",children:[k?r.jsx(f,{className:"w-5 h-5"}):r.jsx(d,{className:"w-5 h-5"}),k?"Unmute":"Mute"]}),r.jsxs(c,{variant:"destructive",onClick:()=>{var e;D("â¹ï¸ Ending call");try{null==(e=K.current)||e.stop(),re.current="idle"}catch{}q.current&&(q.current.pause(),q.current.currentTime=0),H.current&&clearInterval(H.current),te.current&&clearInterval(te.current),S("idle")},size:"lg",className:"gap-2",children:[r.jsx(x,{className:"w-5 h-5"}),"End Call"]})]}),"error"===w&&r.jsxs(c,{disabled:!0,size:"lg",className:"gap-2",children:[r.jsx(u,{className:"w-5 h-5"}),"Browser Not Supported"]})]})]}),"idle"===w&&r.jsxs(s,{children:[r.jsx(i,{children:r.jsx(o,{className:"text-sm",children:"Voice Agent Settings"})}),r.jsxs(l,{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium block mb-2",children:"Mother Language (for Translation)"}),r.jsx("select",{value:O,onChange:e=>{z(e.target.value),localStorage.setItem("ai-speaking-language",e.target.value)},className:"w-full px-3 py-2 border border-input rounded-md bg-background text-sm",children:b.map(e=>r.jsxs("option",{value:e.code,children:[e.flag," ",e.name]},e.code))}),r.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"AI responses will be translated to your language"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",id:"showTranslation",checked:B,onChange:e=>{Q(e.target.checked),localStorage.setItem("ai-speaking-show-translation",String(e.target.checked))},className:"w-4 h-4"}),r.jsx("label",{htmlFor:"showTranslation",className:"text-sm",children:"Show translations in conversation"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium block mb-2",children:"Voice"}),r.jsx("select",{value:M,onChange:e=>F(e.target.value),className:"w-full px-3 py-2 border border-input rounded-md bg-background text-sm",children:J.map(e=>r.jsxs("option",{value:e.id,children:[e.name," (",e.gender,")"]},e.id))})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium block mb-2",children:"Coach Prompt (Optional)"}),r.jsx("textarea",{value:P,onChange:e=>U(e.target.value),placeholder:"Leave blank for default English Tutora IELTS coach. Or describe your custom coaching style...",className:"w-full px-3 py-2 border border-input rounded-md bg-background text-sm h-24 resize-none"}),r.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:'Examples: "You are a pronunciation coach focused only on accent", "You are a vocabulary expert for advanced learners"'})]}),r.jsxs(c,{onClick:se,size:"lg",className:"w-full gap-2",children:[r.jsx(y,{className:"w-5 h-5"}),"Start Call"]})]})]}),r.jsxs(s,{className:"flex-1",children:[r.jsx(i,{children:r.jsxs(o,{className:"flex items-center gap-2",children:[r.jsx(g,{className:"w-4 h-4"}),"Conversation"]})}),r.jsxs(l,{className:"max-h-96 overflow-y-auto space-y-3 pb-4",children:[0===v.length&&!N&&"idle"===w&&r.jsx("div",{className:"text-center py-8 text-muted-foreground",children:r.jsx("p",{className:"text-sm",children:"Start a call to begin practicing IELTS Speaking with English Tutora."})}),v.map((e,t)=>r.jsx("div",{className:"flex "+("student"===e.speaker?"justify-end":"justify-start"),children:r.jsxs("div",{className:"max-w-xs px-4 py-2 rounded-2xl text-sm "+("student"===e.speaker?"bg-primary text-primary-foreground":"bg-card border border-border"),children:[r.jsx("p",{className:"leading-relaxed",children:e.text}),e.translation&&e.translation.trim()&&r.jsx("p",{className:"text-xs mt-2 pt-2 border-t border-current/30 opacity-75 italic",children:e.translation}),e.pronunciation&&e.pronunciation.score>0&&r.jsxs("div",{className:"mt-2 pt-2 border-t border-border/50 text-xs opacity-75",children:["ğŸ¯ Pronunciation: ",e.pronunciation.feedback," (",e.pronunciation.score,"/10)"]})]})},t)),N&&r.jsx("div",{className:"flex "+(v.filter(e=>"student"===e.speaker).length%2==0?"justify-end":"justify-start"),children:r.jsx("div",{className:"max-w-xs px-4 py-2 rounded-2xl text-sm italic opacity-75 "+(v.filter(e=>"student"===e.speaker).length%2==0?"bg-primary text-primary-foreground":"bg-card border border-border"),children:N})}),r.jsx("div",{ref:ee})]})]}),R.length>0&&r.jsxs(s,{className:"bg-slate-50 dark:bg-slate-900 border-slate-200 dark:border-slate-800",children:[r.jsx(i,{children:r.jsxs(o,{className:"flex items-center gap-2 text-sm",children:[r.jsx(p,{className:"w-4 h-4"}),"Debug Logs ","google-cloud"===I&&r.jsx("span",{className:"text-xs bg-orange-100 dark:bg-orange-900 px-2 py-1 rounded text-orange-800 dark:text-orange-200",children:"Fallback Mode"})]})}),r.jsx(l,{children:r.jsx("div",{className:"text-xs font-mono space-y-1 max-h-32 overflow-y-auto",children:R.map((e,t)=>r.jsx("div",{className:"text-muted-foreground",children:e},t))})})]}),r.jsx(s,{className:"bg-blue-50 dark:bg-blue-950 border-blue-200 dark:border-blue-800",children:r.jsx(l,{className:"pt-4 text-sm text-muted-foreground",children:r.jsxs("p",{children:["ğŸ’¡ ",r.jsx("strong",{children:"Tip:"})," Speak naturally and at a normal pace. English Tutora will provide real-time pronunciation feedback and coaching on your IELTS Speaking performance."]})})}),r.jsx("audio",{ref:q})]})});var ie};
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */export{w as default};
