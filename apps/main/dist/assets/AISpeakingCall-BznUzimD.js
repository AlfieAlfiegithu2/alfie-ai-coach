import{r as e,j as t}from"./vendor-react-rLLBBC7n.js";import{d as n,s as r,y as a,C as s,b as i,c as o,a as l,B as c}from"./index-KxDfHqNJ.js";import{bf as d,ch as u,bb as g,aO as h,ci as m,y as p,aw as f,b4 as x}from"./vendor-ui-BGi_EvHx.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-charts-0DeywwxG.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";const b=[{code:"en",name:"English",flag:"ğŸ‡ºğŸ‡¸"},{code:"es",name:"EspaÃ±ol",flag:"ğŸ‡ªğŸ‡¸"},{code:"fr",name:"FranÃ§ais",flag:"ğŸ‡«ğŸ‡·"},{code:"de",name:"Deutsch",flag:"ğŸ‡©ğŸ‡ª"},{code:"zh",name:"ä¸­æ–‡",flag:"ğŸ‡¨ğŸ‡³"},{code:"ja",name:"æ—¥æœ¬èª",flag:"ğŸ‡¯ğŸ‡µ"},{code:"ko",name:"í•œêµ­ì–´",flag:"ğŸ‡°ğŸ‡·"},{code:"pt",name:"PortuguÃªs",flag:"ğŸ‡µğŸ‡¹"},{code:"ru",name:"Ğ ÑƒÑÑĞºĞ¸Ğ¹",flag:"ğŸ‡·ğŸ‡º"},{code:"ar",name:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",flag:"ğŸ‡¸ğŸ‡¦"},{code:"hi",name:"à¤¹à¤¿à¤¨à¥à¤¦à¥€",flag:"ğŸ‡®ğŸ‡³"}],y=()=>{const{toast:y}=n(),[w,S]=e.useState("idle"),[j,v]=e.useState(!1),[T,k]=e.useState([]),[N,$]=e.useState(""),[C,E]=e.useState(0),[R,A]=e.useState([]),[I,L]=e.useState("web-speech"),[F,P]=e.useState("Cherry"),[U,M]=e.useState(""),[O,B]=e.useState("en"),[Q,z]=e.useState(!0),J=[{id:"Cherry",name:"Cherry - Cheerful & Friendly",gender:"Female"},{id:"Ethan",name:"Ethan - Bright & Energetic",gender:"Male"},{id:"Nofish",name:"Nofish - Designer Voice",gender:"Neutral"},{id:"Jennifer",name:"Jennifer - Premium Cinematic",gender:"Female"},{id:"Ryan",name:"Ryan - Rhythmic & Dramatic",gender:"Male"},{id:"Katerina",name:"Katerina - Mature & Rhythmic",gender:"Female"},{id:"Elias",name:"Elias - Academic & Clear",gender:"Male"},{id:"Jada",name:"Shanghai-Jada - Lively",gender:"Female"},{id:"Dylan",name:"Beijing-Dylan - Teenager",gender:"Male"},{id:"Sunny",name:"Sichuan-Sunny - Sweet",gender:"Female"},{id:"Li",name:"Nanjing-Li - Patient Teacher",gender:"Female"},{id:"Marcus",name:"Shaanxi-Marcus - Sincere",gender:"Male"},{id:"Roy",name:"Minnan-Roy - Humorous",gender:"Male"},{id:"Peter",name:"Tianjin-Peter - Crosstalk",gender:"Male"},{id:"Rocky",name:"Cantonese-Rocky - Witty",gender:"Male"},{id:"Kiki",name:"Cantonese-Kiki - Sweet Friend",gender:"Female"},{id:"Eric",name:"Sichuan-Eric - Refined",gender:"Male"}],D=e=>{const t=(new Date).toLocaleTimeString();console.log(`[${t}] ${e}`),A(n=>[...n,`[${t}] ${e}`])},G=()=>{if(!Y.current)return D("âš ï¸ Recognition not initialized"),!1;try{return"listening"===re.current||"starting"===re.current?(D("âš ï¸ Recognition already running, skipping start"),!1):(re.current="starting",Y.current.start(),re.current="listening",D("âœ… Recognition started safely"),!0)}catch(e){const t=String(e);return t.includes("already started")?(D("âš ï¸ Recognition already started (caught)"),re.current="listening",!1):(D(`âŒ Failed to start recognition: ${t}`),re.current="idle",!1)}},_=async(e,t=3)=>{const n=F;for(let o=1;o<=t;o++)try{let s,i;D(`ğŸµ Qwen TTS attempt ${o}/${t} with voice: ${n}...`);try{const t=await r.functions.invoke("openrouter-qwen-tts",{body:{text:e,voice:n,language_type:"English"}});if(s=t.data,i=t.error,console.log("ğŸ” Full invoke result:",{hasData:!!s,hasError:!!i,dataSuccess:null==s?void 0:s.success,dataError:null==s?void 0:s.error,dataKeys:s?Object.keys(s):[],errorKeys:i?Object.keys(i):[]}),i){console.error("ğŸ” Supabase client error:",i);const e=i.message||JSON.stringify(i);throw D(`âŒ Qwen TTS function error: ${e}`),new Error(`Qwen TTS function error: ${e}`)}if(!s)throw new Error("No TTS data returned from Qwen function");if(!1===s.success||s.error){const e="string"==typeof s.error?s.error:JSON.stringify(s.error||"Unknown error"),t=s.details?` Details: ${JSON.stringify(s.details)}`:"",n=s.statusCode?` (Status: ${s.statusCode})`:"";throw D(`âŒ Qwen TTS API error: ${e}${t}${n}`),console.error("Full error response:",s),new Error(`Qwen TTS API error: ${e}${t}${n}`)}return s.audioContent?(D(`âœ… Qwen TTS successful (${s.audioContent.length} bytes)`),s.audioContent):(D(`âš ï¸ Unexpected response format: ${JSON.stringify(s).substring(0,200)}`),console.warn("Unexpected Qwen TTS response:",s),D("ğŸ”„ Falling back to Google TTS..."),await W(e,n))}catch(a){throw console.error("âŒ Supabase invoke exception:",a),a}}catch(s){const r=String(s);if(D(`âŒ Qwen TTS attempt ${o} failed: ${r}`),o===t){D("ğŸ”„ All Qwen TTS attempts failed, trying Google TTS fallback...");try{return await W(e,n)}catch(i){throw D(`âŒ Fallback TTS also failed: ${String(i)}`),i}}await new Promise(e=>setTimeout(e,1e3*Math.pow(2,o-1)))}throw new Error("Qwen TTS failed after all retries")},W=async(e,t)=>{const n=await fetch("https://texttospeech.googleapis.com/v1/text:synthesize?key=AIzaSyB4b-vDRpqbEZVMye8LBS6FugK1Wtgm1Us",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input:{text:e},voice:{languageCode:"en-US",name:t},audioConfig:{audioEncoding:"MP3",pitch:0,speakingRate:.95}})});if(!n.ok){const e=await n.text();throw new Error(`Google TTS fallback failed: ${n.status} - ${e.substring(0,100)}`)}const r=await n.json();if(!r.audioContent)throw new Error("No audio content from Google TTS fallback");return D(`âœ… Google TTS fallback successful (${r.audioContent.length} bytes)`),r.audioContent},K=async(e,t)=>{var n;if("en"!==t)try{const a=(null==(n=b.find(e=>e.code===t))?void 0:n.name)||t;D(`ğŸŒ Translating "${e.substring(0,30)}..." to ${a}...`);const{data:s,error:i}=await r.functions.invoke("ai-speaking-chat",{body:{message:`Translate this English text to ${a}: "${e}"\n\nIMPORTANT: Return ONLY the translation in ${a}, no explanations, no English text, just the translation.`}});if(i)return console.error("Translation API error:",i),void D(`âš ï¸ Translation API error: ${i.message||JSON.stringify(i)}`);if(!(null==s?void 0:s.success)||!(null==s?void 0:s.response))return void D("âš ï¸ Translation failed - no response data");let o=s.response.trim();return o=o.replace(/^["']|["']$/g,""),o=o.replace(/^Translation:\s*/i,""),o=o.replace(/^Here.*?:\s*/i,""),o=o.split("\n")[0],o=o.trim(),!o||o===e||o.length<3?void D("âš ï¸ Translation result invalid or same as original"):(D(`âœ… Translation successful: "${o.substring(0,50)}..."`),o)}catch(a){return console.error("Translation error:",a),void D(`âš ï¸ Translation exception: ${String(a)}`)}},Y=e.useRef(null),V=e.useRef("Starting new IELTS Speaking practice session"),q=e.useRef(null),H=e.useRef(null),Z=e.useRef(!1),X=e.useRef(!1),ee=e.useRef(null),te=e.useRef(null),ne=e.useRef([]),re=e.useRef("idle");e.useEffect(()=>{const e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e){return D("âš ï¸ "+"Browser Web Speech API not supported - will use Google Cloud Speech"),void L("google-cloud")}D("âœ… Web Speech API available"),L("web-speech");const t=new e;return t.continuous=!0,t.interimResults=!0,t.language="en-US",t.maxAlternatives=1,t.onstart=()=>{D("ğŸ¤ Speech recognition started (Web Speech API)"),S("listening"),$("")},t.onresult=e=>{D(`ğŸ“Š onresult fired (result index: ${e.resultIndex}, total results: ${e.results.length})`);let t="",n=!1,r="";for(let a=e.resultIndex;a<e.results.length;a++){const s=e.results[a][0].transcript,i=e.results[a][0].confidence;e.results[a].isFinal?(n=!0,r=s,D(`âœ… Final transcript: "${s}" (confidence: ${(100*i).toFixed(0)}%)`)):t+=s}t&&$(t),n&&r&&($(""),ae(r))},t.onerror=e=>{const t=`Speech recognition error: ${e.error}`;D("âŒ "+t),"no-speech"===e.error?D("âš ï¸ No speech detected, will restart on onend"):"network"===e.error?(D("âš ï¸ Network error, falling back to Google Cloud Speech"),L("google-cloud")):"aborted"!==e.error&&(y({title:"Mic Error",description:t,variant:"destructive"}),S("idle"))},t.onend=()=>{D("ğŸ›‘ Speech recognition ended"),Z.current?D("â¸ï¸  Already restarting, skipping duplicate attempt"):X.current?D("ğŸ›‘ onend during TTS playback, will not restart"):(Z.current=!0,re.current="idle",setTimeout(()=>{try{Y.current&&"idle"!==w&&"speaking"!==w&&G()}catch(e){const t=String(e);t.includes("already started")||D("âš ï¸ Could not restart: "+t)}finally{Z.current=!1}},300))},Y.current=t,D("âœ… Speech recognition initialized with auto-restart"),()=>{if(Y.current)try{Y.current.abort()}catch(e){}}},[y]),e.useEffect(()=>{const e=localStorage.getItem("ai-speaking-language");e&&B(e);const t=localStorage.getItem("ai-speaking-show-translation");null!==t&&z("true"===t)},[]),e.useEffect(()=>{var e;null==(e=ee.current)||e.scrollIntoView({behavior:"smooth"})},[T,N]);const ae=async e=>{var t,n;D(`ğŸ“¢ Processing student text: "${e}"`),k(t=>[...t,{speaker:"student",text:e}]),S("thinking");try{D("ğŸ¤” Calling AI Speaking Chat for real conversation...");const i=(V.current||"").split("\n").filter(e=>e.trim()),o=i.slice(-4),l=o.join("\n");let c;if(D(`ğŸ“ Context length: ${l.length} chars, ${i.length} total turns, using last ${o.length}`),D("ğŸ“¤ Sending request to AI Speaking Chat function..."),ne.current&&ne.current.length>0)try{const e=new Blob(ne.current.slice(-10),{type:"audio/webm"}),t=await e.arrayBuffer();c=btoa(String.fromCharCode(...new Uint8Array(t))),D(`ğŸµ Prepared audio data: ${c.length} bytes`)}catch(a){D(`âš ï¸ Failed to prepare audio data: ${a}`)}D(`ğŸ“¤ Request body: message="${e.substring(0,50)}...", audioBase64=${c?c.length+" bytes":"none"}`);const{data:d,error:u}=await r.functions.invoke("ai-speaking-chat",{body:{message:e,audioBase64:c,audioMimeType:"audio/webm"}});if(D(`ğŸ“¡ Raw response: data=${JSON.stringify(d).substring(0,200)}, error=${JSON.stringify(u)}`),u)throw D(`âŒ Supabase function error: ${u.message}`),new Error(`Supabase function failed: ${u.message}`);if(!d)throw D("âŒ No data returned from function"),new Error("No data returned from AI Speaking Chat function");if(!d.success)throw D(`âŒ Function returned success=false: ${d.error||"Unknown error"}`),new Error(`AI Speaking Chat failed: ${d.error||"Unknown error"}`);let g=d.response;g||(D("âŒ No text from AI Speaking Chat - using fallback"),g="That's interesting! Can you tell me more about that?"),D(`âœ… AI Speaking Chat response text: "${g.substring(0,100)}"`);let h=g.trim().substring(0,200);if(g.length>200){const e=h.split(/[.!?]+/);h=e.slice(0,-1).join(". "),h.endsWith(".")||(h+=".")}h&&0!==h.trim().length||(D("âš ï¸ Response was empty after processing, using fallback"),h="That's interesting! Can you tell me more about that?"),D(`âœ… Final tutor response: "${h}"`),V.current+=`\nStudent: ${e}\nTutor: ${h}`,D("ğŸµ Calling Qwen 3 TTS Flash for response...");const m=O;let p;if(D(`ğŸ” Current selectedLanguage value: "${m}"`),m&&"en"!==m){const e=(null==(t=b.find(e=>e.code===m))?void 0:t.name)||m;D(`ğŸŒ Translating AI response to ${e} (code: ${m})...`);try{p=await K(h,m),D(p?`âœ… Translation complete: "${p.substring(0,50)}..."`:"âš ï¸ Translation returned undefined - will not show translation")}catch(s){D(`âŒ Translation exception: ${String(s)}`),p=void 0}}else D(`â„¹ï¸ Translation skipped - language is "${m}" (should be non-English code)`);const f=await _(h);D(`âœ… TTS_FETCH Qwen 3 TTS Flash (${f.length} bytes)`);let x=f.trim().replace(/\s/g,"");for(x=x.replace(/-/g,"+").replace(/_/g,"/");x.length%4;)x+="=";const y=atob(x),w=new Uint8Array(y.length);for(let e=0;e<y.length;e++)w[e]=y.charCodeAt(e);const j=new Blob([w],{type:"audio/mp3"}),v={speaker:"tutora",text:h,translation:p||void 0};if(D(`ğŸ“ Adding to transcript - text: "${h.substring(0,30)}...", translation: ${p?`"${p.substring(0,30)}..."`:"NONE"}`),D(`ğŸ“ Message object: ${JSON.stringify({...v,translation:p||"undefined"})}`),k(e=>[...e,v]),q.current){try{null==(n=Y.current)||n.stop(),re.current="stopping"}catch{}X.current=!0;const e=URL.createObjectURL(j);q.current.src=e,D("PLAY_START response"),q.current.play(),S("speaking"),q.current.onended=()=>{URL.revokeObjectURL(e),D("PLAY_END response"),X.current=!1,D("â¹ï¸ Audio finished, resuming listening"),S("listening"),setTimeout(()=>{G()},500)}}else D("âŒ No audio element available"),S("listening")}catch(s){const e=s instanceof Error?s.message:String(s);D("âŒ Error: "+e),console.error("Error in conversation flow:",s);try{D("ğŸ†˜ Attempting recovery with fallback...");const e="I'm having a technical issue, but I'm still here to help! Please try again.";try{let t=(await _(e)).trim().replace(/\s/g,"");for(t=t.replace(/-/g,"+").replace(/_/g,"/");t.length%4;)t+="=";const n=atob(t),r=new Uint8Array(n.length);for(let e=0;e<n.length;e++)r[e]=n.charCodeAt(e);const a=new Blob([r],{type:"audio/mp3"});if(q.current){const e=URL.createObjectURL(a);q.current.src=e,q.current.play(),q.current.onended=()=>{URL.revokeObjectURL(e),S("listening"),setTimeout(()=>G(),500)}}}catch(i){D("âš ï¸ Fallback TTS failed: "+String(i))}}catch(o){D("âŒ Recovery failed: "+String(o))}S("listening")}},se=()=>{D(`â–¶ï¸ Starting call (using ${I})`),k([]),E(0),A([]),V.current="Starting new IELTS Speaking practice session",H.current=setInterval(()=>{E(e=>e+1)},1e3),D("ğŸ¤ Requesting mic access and starting greeting..."),(async()=>{var e,t;try{D("ğŸ¤ Playing AI greeting...");const r="Hello! I'm English Tutora, your IELTS Speaking coach. Let's practice together. What would you like to talk about today?";let a;if("en"!==O){D(`ğŸŒ Translating greeting to ${(null==(e=b.find(e=>e.code===O))?void 0:e.name)||O}...`);try{a=await K(r,O),D(a?`âœ… Greeting translation complete: "${a.substring(0,50)}..."`:"âš ï¸ Greeting translation returned undefined")}catch(n){D(`âš ï¸ Greeting translation failed: ${String(n)}`),a=void 0}}D(`ğŸµ Calling Qwen 3 TTS Flash with voice: ${F}`);const s=await _(r);D(`âœ… TTS_FETCH greeting (${s.length} bytes)`);const i=s.substring(0,100),o=s.substring(Math.max(0,s.length-50));D(`ğŸ” Base64 preview: first="${i}...", last="...${o}"`);let l=s;if(s.startsWith("data:")){const e=s.match(/base64,(.+)$/);e&&(l=e[1],D(`ğŸ” Extracted base64 from data URL (${l.length} chars)`))}let c=l.trim().replace(/\s/g,"");for(c=c.replace(/-/g,"+").replace(/_/g,"/");c.length%4;)c+="=";const d=/^[A-Za-z0-9+/]*={0,2}$/;if(!d.test(c)){const e=c.match(/[^A-Za-z0-9+/=]/g);throw D(`âŒ Invalid base64 characters found: ${(null==e?void 0:e.join(", "))||"unknown"}`),new Error("Invalid base64 format: contains invalid characters")}D(`ğŸ” Cleaning base64: length=${c.length}, valid=${d.test(c)}`);const u=atob(c),g=new Uint8Array(u.length);for(let e=0;e<u.length;e++)g[e]=u.charCodeAt(e);const h=new Blob([g],{type:"audio/mp3"});if(q.current){try{null==(t=Y.current)||t.stop()}catch{}X.current=!0;const e=URL.createObjectURL(h);q.current.src=e,D("PLAY_START greeting"),S("speaking"),k(e=>[...e,{speaker:"tutora",text:r,translation:a}]),q.current.onended=()=>{URL.revokeObjectURL(e),D("PLAY_END greeting"),X.current=!1,D("âœ… Greeting finished, starting to listen..."),S("listening"),setTimeout(()=>{G()},500)},q.current.onerror=e=>{D("âŒ Audio playback error: "+String(e)),X.current=!1,S("listening"),setTimeout(()=>G(),500)},q.current.play().catch(e=>{D("âŒ Could not play audio: "+String(e)),X.current=!1,S("listening"),setTimeout(()=>G(),500)})}}catch(n){D("âŒ Greeting error: "+String(n)),D("ğŸ“ Starting listening anyway..."),S("listening"),setTimeout(()=>{G()},500)}})()};return t.jsx(a,{title:"AI Speaking Tutor",showBackButton:!0,backPath:"/ielts-portal",children:t.jsxs("div",{className:"max-w-3xl mx-auto space-y-4",children:[t.jsxs(s,{children:[t.jsx(i,{className:"pb-3",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx(o,{className:"text-xl",children:"English Tutora - IELTS Speaking Practice"}),t.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Real-time voice conversation with AI coaching"})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"text-2xl font-mono font-bold",children:(ie=C,`${Math.floor(ie/60)}:${(ie%60).toString().padStart(2,"0")}`)}),t.jsxs("div",{className:"text-xs text-muted-foreground flex items-center justify-end gap-1",children:[t.jsx("span",{children:"listening"===w?"ğŸ¤ Listening":"thinking"===w?"ğŸ¤” Thinking...":"speaking"===w?"ğŸ”Š Speaking":"âš« Ready"}),"google-cloud"===I&&t.jsx(d,{className:"w-3 h-3"})]})]})]})}),t.jsxs(l,{className:"flex gap-3 justify-center pt-0",children:["idle"===w&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex gap-2 items-center",children:[t.jsx("label",{className:"text-sm font-medium",children:"Voice:"}),t.jsx("select",{value:F,onChange:e=>P(e.target.value),className:"px-3 py-2 border border-input rounded-md bg-background text-sm",disabled:"idle"!==w,children:J.map(e=>t.jsxs("option",{value:e.id,children:[e.name," (",e.gender,")"]},e.id))})]}),t.jsxs(c,{onClick:se,size:"lg",className:"gap-2",children:[t.jsx(u,{className:"w-5 h-5"}),"Start Call"]})]}),("listening"===w||"thinking"===w||"speaking"===w)&&t.jsxs(t.Fragment,{children:[t.jsxs(c,{variant:j?"secondary":"outline",onClick:()=>v(!j),size:"lg",className:"gap-2",children:[j?t.jsx(g,{className:"w-5 h-5"}):t.jsx(h,{className:"w-5 h-5"}),j?"Unmute":"Mute"]}),t.jsxs(c,{variant:"destructive",onClick:()=>{var e;D("â¹ï¸ Ending call");try{null==(e=Y.current)||e.stop(),re.current="idle"}catch{}q.current&&(q.current.pause(),q.current.currentTime=0),H.current&&clearInterval(H.current),te.current&&clearInterval(te.current),S("idle")},size:"lg",className:"gap-2",children:[t.jsx(m,{className:"w-5 h-5"}),"End Call"]})]}),"error"===w&&t.jsxs(c,{disabled:!0,size:"lg",className:"gap-2",children:[t.jsx(p,{className:"w-5 h-5"}),"Browser Not Supported"]})]})]}),"idle"===w&&t.jsxs(s,{children:[t.jsx(i,{children:t.jsx(o,{className:"text-sm",children:"Voice Agent Settings"})}),t.jsxs(l,{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium block mb-2",children:"Mother Language (for Translation)"}),t.jsx("select",{value:O,onChange:e=>{B(e.target.value),localStorage.setItem("ai-speaking-language",e.target.value)},className:"w-full px-3 py-2 border border-input rounded-md bg-background text-sm",children:b.map(e=>t.jsxs("option",{value:e.code,children:[e.flag," ",e.name]},e.code))}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"AI responses will be translated to your language"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",id:"showTranslation",checked:Q,onChange:e=>{z(e.target.checked),localStorage.setItem("ai-speaking-show-translation",String(e.target.checked))},className:"w-4 h-4"}),t.jsx("label",{htmlFor:"showTranslation",className:"text-sm",children:"Show translations in conversation"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium block mb-2",children:"Voice"}),t.jsx("select",{value:F,onChange:e=>P(e.target.value),className:"w-full px-3 py-2 border border-input rounded-md bg-background text-sm",children:J.map(e=>t.jsxs("option",{value:e.id,children:[e.name," (",e.gender,")"]},e.id))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium block mb-2",children:"Coach Prompt (Optional)"}),t.jsx("textarea",{value:U,onChange:e=>M(e.target.value),placeholder:"Leave blank for default English Tutora IELTS coach. Or describe your custom coaching style...",className:"w-full px-3 py-2 border border-input rounded-md bg-background text-sm h-24 resize-none"}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:'Examples: "You are a pronunciation coach focused only on accent", "You are a vocabulary expert for advanced learners"'})]}),t.jsxs(c,{onClick:se,size:"lg",className:"w-full gap-2",children:[t.jsx(u,{className:"w-5 h-5"}),"Start Call"]})]})]}),t.jsxs(s,{className:"flex-1",children:[t.jsx(i,{children:t.jsxs(o,{className:"flex items-center gap-2",children:[t.jsx(f,{className:"w-4 h-4"}),"Conversation"]})}),t.jsxs(l,{className:"max-h-96 overflow-y-auto space-y-3 pb-4",children:[0===T.length&&!N&&"idle"===w&&t.jsx("div",{className:"text-center py-8 text-muted-foreground",children:t.jsx("p",{className:"text-sm",children:"Start a call to begin practicing IELTS Speaking with English Tutora."})}),T.map((e,n)=>t.jsx("div",{className:"flex "+("student"===e.speaker?"justify-end":"justify-start"),children:t.jsxs("div",{className:"max-w-xs px-4 py-2 rounded-2xl text-sm "+("student"===e.speaker?"bg-primary text-primary-foreground":"bg-card border border-border"),children:[t.jsx("p",{className:"leading-relaxed",children:e.text}),e.translation&&e.translation.trim()&&t.jsx("p",{className:"text-xs mt-2 pt-2 border-t border-current/30 opacity-75 italic",children:e.translation}),e.pronunciation&&e.pronunciation.score>0&&t.jsxs("div",{className:"mt-2 pt-2 border-t border-border/50 text-xs opacity-75",children:["ğŸ¯ Pronunciation: ",e.pronunciation.feedback," (",e.pronunciation.score,"/10)"]})]})},n)),N&&t.jsx("div",{className:"flex "+(T.filter(e=>"student"===e.speaker).length%2==0?"justify-end":"justify-start"),children:t.jsx("div",{className:"max-w-xs px-4 py-2 rounded-2xl text-sm italic opacity-75 "+(T.filter(e=>"student"===e.speaker).length%2==0?"bg-primary text-primary-foreground":"bg-card border border-border"),children:N})}),t.jsx("div",{ref:ee})]})]}),R.length>0&&t.jsxs(s,{className:"bg-slate-50 dark:bg-slate-900 border-slate-200 dark:border-slate-800",children:[t.jsx(i,{children:t.jsxs(o,{className:"flex items-center gap-2 text-sm",children:[t.jsx(x,{className:"w-4 h-4"}),"Debug Logs ","google-cloud"===I&&t.jsx("span",{className:"text-xs bg-orange-100 dark:bg-orange-900 px-2 py-1 rounded text-orange-800 dark:text-orange-200",children:"Fallback Mode"})]})}),t.jsx(l,{children:t.jsx("div",{className:"text-xs font-mono space-y-1 max-h-32 overflow-y-auto",children:R.map((e,n)=>t.jsx("div",{className:"text-muted-foreground",children:e},n))})})]}),t.jsx(s,{className:"bg-blue-50 dark:bg-blue-950 border-blue-200 dark:border-blue-800",children:t.jsx(l,{className:"pt-4 text-sm text-muted-foreground",children:t.jsxs("p",{children:["ğŸ’¡ ",t.jsx("strong",{children:"Tip:"})," Speak naturally and at a normal pace. English Tutora will provide real-time pronunciation feedback and coaching on your IELTS Speaking performance."]})})}),t.jsx("audio",{ref:q})]})});var ie};export{y as default};
