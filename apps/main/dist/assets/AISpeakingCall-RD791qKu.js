import{h as e,r as t,j as n,a5 as r,C as a,b as s,d as i,a as o,B as l,M as c,ao as d,V as u}from"./index-Dj8G7xJc.js";import{s as g}from"./supabase-DWL4C3fA.js";import{Z as h}from"./zap-DnxM7BKC.js";import{P as m}from"./phone-BI7Ms0s4.js";import{M as p}from"./mic-off-RIDwW9FZ.js";import{P as f}from"./phone-off-Dj9uiAjd.js";import{C as x}from"./circle-alert-D5yxzsnp.js";const b=[{code:"en",name:"English",flag:"ğŸ‡ºğŸ‡¸"},{code:"es",name:"EspaÃ±ol",flag:"ğŸ‡ªğŸ‡¸"},{code:"fr",name:"FranÃ§ais",flag:"ğŸ‡«ğŸ‡·"},{code:"de",name:"Deutsch",flag:"ğŸ‡©ğŸ‡ª"},{code:"zh",name:"ä¸­æ–‡",flag:"ğŸ‡¨ğŸ‡³"},{code:"ja",name:"æ—¥æœ¬èª",flag:"ğŸ‡¯ğŸ‡µ"},{code:"ko",name:"í•œêµ­ì–´",flag:"ğŸ‡°ğŸ‡·"},{code:"pt",name:"PortuguÃªs",flag:"ğŸ‡µğŸ‡¹"},{code:"ru",name:"Ğ ÑƒÑÑĞºĞ¸Ğ¹",flag:"ğŸ‡·ğŸ‡º"},{code:"ar",name:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",flag:"ğŸ‡¸ğŸ‡¦"},{code:"hi",name:"à¤¹à¤¿à¤¨à¥à¤¦à¥€",flag:"ğŸ‡®ğŸ‡³"}],y=()=>{const{toast:y}=e(),[S,w]=t.useState("idle"),[j,T]=t.useState(!1),[k,v]=t.useState([]),[N,$]=t.useState(""),[C,E]=t.useState(0),[R,A]=t.useState([]),[I,L]=t.useState("web-speech"),[F,P]=t.useState("Cherry"),[M,U]=t.useState(""),[O,B]=t.useState("en"),[z,Q]=t.useState(!0),D=[{id:"Cherry",name:"Cherry - Cheerful & Friendly",gender:"Female"},{id:"Ethan",name:"Ethan - Bright & Energetic",gender:"Male"},{id:"Nofish",name:"Nofish - Designer Voice",gender:"Neutral"},{id:"Jennifer",name:"Jennifer - Premium Cinematic",gender:"Female"},{id:"Ryan",name:"Ryan - Rhythmic & Dramatic",gender:"Male"},{id:"Katerina",name:"Katerina - Mature & Rhythmic",gender:"Female"},{id:"Elias",name:"Elias - Academic & Clear",gender:"Male"},{id:"Jada",name:"Shanghai-Jada - Lively",gender:"Female"},{id:"Dylan",name:"Beijing-Dylan - Teenager",gender:"Male"},{id:"Sunny",name:"Sichuan-Sunny - Sweet",gender:"Female"},{id:"Li",name:"Nanjing-Li - Patient Teacher",gender:"Female"},{id:"Marcus",name:"Shaanxi-Marcus - Sincere",gender:"Male"},{id:"Roy",name:"Minnan-Roy - Humorous",gender:"Male"},{id:"Peter",name:"Tianjin-Peter - Crosstalk",gender:"Male"},{id:"Rocky",name:"Cantonese-Rocky - Witty",gender:"Male"},{id:"Kiki",name:"Cantonese-Kiki - Sweet Friend",gender:"Female"},{id:"Eric",name:"Sichuan-Eric - Refined",gender:"Male"}],J=e=>{const t=(new Date).toLocaleTimeString();console.log(`[${t}] ${e}`),A(n=>[...n,`[${t}] ${e}`])},G=()=>{if(!V.current)return J("âš ï¸ Recognition not initialized"),!1;try{return"listening"===re.current||"starting"===re.current?(J("âš ï¸ Recognition already running, skipping start"),!1):(re.current="starting",V.current.start(),re.current="listening",J("âœ… Recognition started safely"),!0)}catch(e){const t=String(e);return t.includes("already started")?(J("âš ï¸ Recognition already started (caught)"),re.current="listening",!1):(J(`âŒ Failed to start recognition: ${t}`),re.current="idle",!1)}},_=async(e,t=3)=>{const n=F;for(let i=1;i<=t;i++)try{let a,s;J(`ğŸµ Qwen TTS attempt ${i}/${t} with voice: ${n}...`);try{const t=await g.functions.invoke("openrouter-qwen-tts",{body:{text:e,voice:n,language_type:"English"}});if(a=t.data,s=t.error,console.log("ğŸ” Full invoke result:",{hasData:!!a,hasError:!!s,dataSuccess:null==a?void 0:a.success,dataError:null==a?void 0:a.error,dataKeys:a?Object.keys(a):[],errorKeys:s?Object.keys(s):[]}),s){console.error("ğŸ” Supabase client error:",s);const e=s.message||JSON.stringify(s);throw J(`âŒ Qwen TTS function error: ${e}`),new Error(`Qwen TTS function error: ${e}`)}if(!a)throw new Error("No TTS data returned from Qwen function");if(!1===a.success||a.error){const e="string"==typeof a.error?a.error:JSON.stringify(a.error||"Unknown error"),t=a.details?` Details: ${JSON.stringify(a.details)}`:"",n=a.statusCode?` (Status: ${a.statusCode})`:"";throw J(`âŒ Qwen TTS API error: ${e}${t}${n}`),console.error("Full error response:",a),new Error(`Qwen TTS API error: ${e}${t}${n}`)}return a.audioContent?(J(`âœ… Qwen TTS successful (${a.audioContent.length} bytes)`),a.audioContent):(J(`âš ï¸ Unexpected response format: ${JSON.stringify(a).substring(0,200)}`),console.warn("Unexpected Qwen TTS response:",a),J("ğŸ”„ Falling back to Google TTS..."),await W(e,n))}catch(r){throw console.error("âŒ Supabase invoke exception:",r),r}}catch(a){const r=String(a);if(J(`âŒ Qwen TTS attempt ${i} failed: ${r}`),i===t){J("ğŸ”„ All Qwen TTS attempts failed, trying Google TTS fallback...");try{return await W(e,n)}catch(s){throw J(`âŒ Fallback TTS also failed: ${String(s)}`),s}}await new Promise(e=>setTimeout(e,1e3*Math.pow(2,i-1)))}throw new Error("Qwen TTS failed after all retries")},W=async(e,t)=>{const n=await fetch("https://texttospeech.googleapis.com/v1/text:synthesize?key=AIzaSyB4b-vDRpqbEZVMye8LBS6FugK1Wtgm1Us",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input:{text:e},voice:{languageCode:"en-US",name:t},audioConfig:{audioEncoding:"MP3",pitch:0,speakingRate:.95}})});if(!n.ok){const e=await n.text();throw new Error(`Google TTS fallback failed: ${n.status} - ${e.substring(0,100)}`)}const r=await n.json();if(!r.audioContent)throw new Error("No audio content from Google TTS fallback");return J(`âœ… Google TTS fallback successful (${r.audioContent.length} bytes)`),r.audioContent},K=async(e,t)=>{var n;if("en"!==t)try{const r=(null==(n=b.find(e=>e.code===t))?void 0:n.name)||t;J(`ğŸŒ Translating "${e.substring(0,30)}..." to ${r}...`);const{data:a,error:s}=await g.functions.invoke("ai-speaking-chat",{body:{message:`Translate this English text to ${r}: "${e}"\n\nIMPORTANT: Return ONLY the translation in ${r}, no explanations, no English text, just the translation.`}});if(s)return console.error("Translation API error:",s),void J(`âš ï¸ Translation API error: ${s.message||JSON.stringify(s)}`);if(!(null==a?void 0:a.success)||!(null==a?void 0:a.response))return void J("âš ï¸ Translation failed - no response data");let i=a.response.trim();return i=i.replace(/^["']|["']$/g,""),i=i.replace(/^Translation:\s*/i,""),i=i.replace(/^Here.*?:\s*/i,""),i=i.split("\n")[0],i=i.trim(),!i||i===e||i.length<3?void J("âš ï¸ Translation result invalid or same as original"):(J(`âœ… Translation successful: "${i.substring(0,50)}..."`),i)}catch(r){return console.error("Translation error:",r),void J(`âš ï¸ Translation exception: ${String(r)}`)}},V=t.useRef(null),Y=t.useRef("Starting new IELTS Speaking practice session"),q=t.useRef(null),H=t.useRef(null),Z=t.useRef(!1),X=t.useRef(!1),ee=t.useRef(null),te=t.useRef(null),ne=t.useRef([]),re=t.useRef("idle");t.useEffect(()=>{const e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e){return J("âš ï¸ "+"Browser Web Speech API not supported - will use Google Cloud Speech"),void L("google-cloud")}J("âœ… Web Speech API available"),L("web-speech");const t=new e;return t.continuous=!0,t.interimResults=!0,t.language="en-US",t.maxAlternatives=1,t.onstart=()=>{J("ğŸ¤ Speech recognition started (Web Speech API)"),w("listening"),$("")},t.onresult=e=>{J(`ğŸ“Š onresult fired (result index: ${e.resultIndex}, total results: ${e.results.length})`);let t="",n=!1,r="";for(let a=e.resultIndex;a<e.results.length;a++){const s=e.results[a][0].transcript,i=e.results[a][0].confidence;e.results[a].isFinal?(n=!0,r=s,J(`âœ… Final transcript: "${s}" (confidence: ${(100*i).toFixed(0)}%)`)):t+=s}t&&$(t),n&&r&&($(""),ae(r))},t.onerror=e=>{const t=`Speech recognition error: ${e.error}`;J("âŒ "+t),"no-speech"===e.error?J("âš ï¸ No speech detected, will restart on onend"):"network"===e.error?(J("âš ï¸ Network error, falling back to Google Cloud Speech"),L("google-cloud")):"aborted"!==e.error&&(y({title:"Mic Error",description:t,variant:"destructive"}),w("idle"))},t.onend=()=>{J("ğŸ›‘ Speech recognition ended"),Z.current?J("â¸ï¸  Already restarting, skipping duplicate attempt"):X.current?J("ğŸ›‘ onend during TTS playback, will not restart"):(Z.current=!0,re.current="idle",setTimeout(()=>{try{V.current&&"idle"!==S&&"speaking"!==S&&G()}catch(e){const t=String(e);t.includes("already started")||J("âš ï¸ Could not restart: "+t)}finally{Z.current=!1}},300))},V.current=t,J("âœ… Speech recognition initialized with auto-restart"),()=>{if(V.current)try{V.current.abort()}catch(e){}}},[y]),t.useEffect(()=>{const e=localStorage.getItem("ai-speaking-language");e&&B(e);const t=localStorage.getItem("ai-speaking-show-translation");null!==t&&Q("true"===t)},[]),t.useEffect(()=>{var e;null==(e=ee.current)||e.scrollIntoView({behavior:"smooth"})},[k,N]);const ae=async e=>{var t,n;J(`ğŸ“¢ Processing student text: "${e}"`),v(t=>[...t,{speaker:"student",text:e}]),w("thinking");try{J("ğŸ¤” Calling AI Speaking Chat for real conversation...");const s=(Y.current||"").split("\n").filter(e=>e.trim()),i=s.slice(-4),o=i.join("\n");let l;if(J(`ğŸ“ Context length: ${o.length} chars, ${s.length} total turns, using last ${i.length}`),J("ğŸ“¤ Sending request to AI Speaking Chat function..."),ne.current&&ne.current.length>0)try{const e=new Blob(ne.current.slice(-10),{type:"audio/webm"}),t=await e.arrayBuffer();l=btoa(String.fromCharCode(...new Uint8Array(t))),J(`ğŸµ Prepared audio data: ${l.length} bytes`)}catch(r){J(`âš ï¸ Failed to prepare audio data: ${r}`)}J(`ğŸ“¤ Request body: message="${e.substring(0,50)}...", audioBase64=${l?l.length+" bytes":"none"}`);const{data:c,error:d}=await g.functions.invoke("ai-speaking-chat",{body:{message:e,audioBase64:l,audioMimeType:"audio/webm"}});if(J(`ğŸ“¡ Raw response: data=${JSON.stringify(c).substring(0,200)}, error=${JSON.stringify(d)}`),d)throw J(`âŒ Supabase function error: ${d.message}`),new Error(`Supabase function failed: ${d.message}`);if(!c)throw J("âŒ No data returned from function"),new Error("No data returned from AI Speaking Chat function");if(!c.success)throw J(`âŒ Function returned success=false: ${c.error||"Unknown error"}`),new Error(`AI Speaking Chat failed: ${c.error||"Unknown error"}`);let u=c.response;u||(J("âŒ No text from AI Speaking Chat - using fallback"),u="That's interesting! Can you tell me more about that?"),J(`âœ… AI Speaking Chat response text: "${u.substring(0,100)}"`);let h=u.trim().substring(0,200);if(u.length>200){const e=h.split(/[.!?]+/);h=e.slice(0,-1).join(". "),h.endsWith(".")||(h+=".")}h&&0!==h.trim().length||(J("âš ï¸ Response was empty after processing, using fallback"),h="That's interesting! Can you tell me more about that?"),J(`âœ… Final tutor response: "${h}"`),Y.current+=`\nStudent: ${e}\nTutor: ${h}`,J("ğŸµ Calling Qwen 3 TTS Flash for response...");const m=O;let p;if(J(`ğŸ” Current selectedLanguage value: "${m}"`),m&&"en"!==m){const e=(null==(t=b.find(e=>e.code===m))?void 0:t.name)||m;J(`ğŸŒ Translating AI response to ${e} (code: ${m})...`);try{p=await K(h,m),J(p?`âœ… Translation complete: "${p.substring(0,50)}..."`:"âš ï¸ Translation returned undefined - will not show translation")}catch(a){J(`âŒ Translation exception: ${String(a)}`),p=void 0}}else J(`â„¹ï¸ Translation skipped - language is "${m}" (should be non-English code)`);const f=await _(h);J(`âœ… TTS_FETCH Qwen 3 TTS Flash (${f.length} bytes)`);let x=f.trim().replace(/\s/g,"");for(x=x.replace(/-/g,"+").replace(/_/g,"/");x.length%4;)x+="=";const y=atob(x),S=new Uint8Array(y.length);for(let e=0;e<y.length;e++)S[e]=y.charCodeAt(e);const j=new Blob([S],{type:"audio/mp3"}),T={speaker:"tutora",text:h,translation:p||void 0};if(J(`ğŸ“ Adding to transcript - text: "${h.substring(0,30)}...", translation: ${p?`"${p.substring(0,30)}..."`:"NONE"}`),J(`ğŸ“ Message object: ${JSON.stringify({...T,translation:p||"undefined"})}`),v(e=>[...e,T]),q.current){try{null==(n=V.current)||n.stop(),re.current="stopping"}catch{}X.current=!0;const e=URL.createObjectURL(j);q.current.src=e,J("PLAY_START response"),q.current.play(),w("speaking"),q.current.onended=()=>{URL.revokeObjectURL(e),J("PLAY_END response"),X.current=!1,J("â¹ï¸ Audio finished, resuming listening"),w("listening"),setTimeout(()=>{G()},500)}}else J("âŒ No audio element available"),w("listening")}catch(a){const e=a instanceof Error?a.message:String(a);J("âŒ Error: "+e),console.error("Error in conversation flow:",a);try{J("ğŸ†˜ Attempting recovery with fallback...");const e="I'm having a technical issue, but I'm still here to help! Please try again.";try{let t=(await _(e)).trim().replace(/\s/g,"");for(t=t.replace(/-/g,"+").replace(/_/g,"/");t.length%4;)t+="=";const n=atob(t),r=new Uint8Array(n.length);for(let e=0;e<n.length;e++)r[e]=n.charCodeAt(e);const a=new Blob([r],{type:"audio/mp3"});if(q.current){const e=URL.createObjectURL(a);q.current.src=e,q.current.play(),q.current.onended=()=>{URL.revokeObjectURL(e),w("listening"),setTimeout(()=>G(),500)}}}catch(s){J("âš ï¸ Fallback TTS failed: "+String(s))}}catch(i){J("âŒ Recovery failed: "+String(i))}w("listening")}},se=()=>{J(`â–¶ï¸ Starting call (using ${I})`),v([]),E(0),A([]),Y.current="Starting new IELTS Speaking practice session",H.current=setInterval(()=>{E(e=>e+1)},1e3),J("ğŸ¤ Requesting mic access and starting greeting..."),(async()=>{var e,t;try{J("ğŸ¤ Playing AI greeting...");const r="Hello! I'm English Tutora, your IELTS Speaking coach. Let's practice together. What would you like to talk about today?";let a;if("en"!==O){J(`ğŸŒ Translating greeting to ${(null==(e=b.find(e=>e.code===O))?void 0:e.name)||O}...`);try{a=await K(r,O),J(a?`âœ… Greeting translation complete: "${a.substring(0,50)}..."`:"âš ï¸ Greeting translation returned undefined")}catch(n){J(`âš ï¸ Greeting translation failed: ${String(n)}`),a=void 0}}J(`ğŸµ Calling Qwen 3 TTS Flash with voice: ${F}`);const s=await _(r);J(`âœ… TTS_FETCH greeting (${s.length} bytes)`);const i=s.substring(0,100),o=s.substring(Math.max(0,s.length-50));J(`ğŸ” Base64 preview: first="${i}...", last="...${o}"`);let l=s;if(s.startsWith("data:")){const e=s.match(/base64,(.+)$/);e&&(l=e[1],J(`ğŸ” Extracted base64 from data URL (${l.length} chars)`))}let c=l.trim().replace(/\s/g,"");for(c=c.replace(/-/g,"+").replace(/_/g,"/");c.length%4;)c+="=";const d=/^[A-Za-z0-9+/]*={0,2}$/;if(!d.test(c)){const e=c.match(/[^A-Za-z0-9+/=]/g);throw J(`âŒ Invalid base64 characters found: ${(null==e?void 0:e.join(", "))||"unknown"}`),new Error("Invalid base64 format: contains invalid characters")}J(`ğŸ” Cleaning base64: length=${c.length}, valid=${d.test(c)}`);const u=atob(c),g=new Uint8Array(u.length);for(let e=0;e<u.length;e++)g[e]=u.charCodeAt(e);const h=new Blob([g],{type:"audio/mp3"});if(q.current){try{null==(t=V.current)||t.stop()}catch{}X.current=!0;const e=URL.createObjectURL(h);q.current.src=e,J("PLAY_START greeting"),w("speaking"),v(e=>[...e,{speaker:"tutora",text:r,translation:a}]),q.current.onended=()=>{URL.revokeObjectURL(e),J("PLAY_END greeting"),X.current=!1,J("âœ… Greeting finished, starting to listen..."),w("listening"),setTimeout(()=>{G()},500)},q.current.onerror=e=>{J("âŒ Audio playback error: "+String(e)),X.current=!1,w("listening"),setTimeout(()=>G(),500)},q.current.play().catch(e=>{J("âŒ Could not play audio: "+String(e)),X.current=!1,w("listening"),setTimeout(()=>G(),500)})}}catch(n){J("âŒ Greeting error: "+String(n)),J("ğŸ“ Starting listening anyway..."),w("listening"),setTimeout(()=>{G()},500)}})()};return n.jsx(r,{title:"AI Speaking Tutor",showBackButton:!0,backPath:"/ielts-portal",children:n.jsxs("div",{className:"max-w-3xl mx-auto space-y-4",children:[n.jsxs(a,{children:[n.jsx(s,{className:"pb-3",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx(i,{className:"text-xl",children:"English Tutora - IELTS Speaking Practice"}),n.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Real-time voice conversation with AI coaching"})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("div",{className:"text-2xl font-mono font-bold",children:(ie=C,`${Math.floor(ie/60)}:${(ie%60).toString().padStart(2,"0")}`)}),n.jsxs("div",{className:"text-xs text-muted-foreground flex items-center justify-end gap-1",children:[n.jsx("span",{children:"listening"===S?"ğŸ¤ Listening":"thinking"===S?"ğŸ¤” Thinking...":"speaking"===S?"ğŸ”Š Speaking":"âš« Ready"}),"google-cloud"===I&&n.jsx(h,{className:"w-3 h-3"})]})]})]})}),n.jsxs(o,{className:"flex gap-3 justify-center pt-0",children:["idle"===S&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex gap-2 items-center",children:[n.jsx("label",{className:"text-sm font-medium",children:"Voice:"}),n.jsx("select",{value:F,onChange:e=>P(e.target.value),className:"px-3 py-2 border border-input rounded-md bg-background text-sm",disabled:"idle"!==S,children:D.map(e=>n.jsxs("option",{value:e.id,children:[e.name," (",e.gender,")"]},e.id))})]}),n.jsxs(l,{onClick:se,size:"lg",className:"gap-2",children:[n.jsx(m,{className:"w-5 h-5"}),"Start Call"]})]}),("listening"===S||"thinking"===S||"speaking"===S)&&n.jsxs(n.Fragment,{children:[n.jsxs(l,{variant:j?"secondary":"outline",onClick:()=>T(!j),size:"lg",className:"gap-2",children:[j?n.jsx(p,{className:"w-5 h-5"}):n.jsx(c,{className:"w-5 h-5"}),j?"Unmute":"Mute"]}),n.jsxs(l,{variant:"destructive",onClick:()=>{var e;J("â¹ï¸ Ending call");try{null==(e=V.current)||e.stop(),re.current="idle"}catch{}q.current&&(q.current.pause(),q.current.currentTime=0),H.current&&clearInterval(H.current),te.current&&clearInterval(te.current),w("idle")},size:"lg",className:"gap-2",children:[n.jsx(f,{className:"w-5 h-5"}),"End Call"]})]}),"error"===S&&n.jsxs(l,{disabled:!0,size:"lg",className:"gap-2",children:[n.jsx(d,{className:"w-5 h-5"}),"Browser Not Supported"]})]})]}),"idle"===S&&n.jsxs(a,{children:[n.jsx(s,{children:n.jsx(i,{className:"text-sm",children:"Voice Agent Settings"})}),n.jsxs(o,{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-medium block mb-2",children:"Mother Language (for Translation)"}),n.jsx("select",{value:O,onChange:e=>{B(e.target.value),localStorage.setItem("ai-speaking-language",e.target.value)},className:"w-full px-3 py-2 border border-input rounded-md bg-background text-sm",children:b.map(e=>n.jsxs("option",{value:e.code,children:[e.flag," ",e.name]},e.code))}),n.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"AI responses will be translated to your language"})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"checkbox",id:"showTranslation",checked:z,onChange:e=>{Q(e.target.checked),localStorage.setItem("ai-speaking-show-translation",String(e.target.checked))},className:"w-4 h-4"}),n.jsx("label",{htmlFor:"showTranslation",className:"text-sm",children:"Show translations in conversation"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-medium block mb-2",children:"Voice"}),n.jsx("select",{value:F,onChange:e=>P(e.target.value),className:"w-full px-3 py-2 border border-input rounded-md bg-background text-sm",children:D.map(e=>n.jsxs("option",{value:e.id,children:[e.name," (",e.gender,")"]},e.id))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-medium block mb-2",children:"Coach Prompt (Optional)"}),n.jsx("textarea",{value:M,onChange:e=>U(e.target.value),placeholder:"Leave blank for default English Tutora IELTS coach. Or describe your custom coaching style...",className:"w-full px-3 py-2 border border-input rounded-md bg-background text-sm h-24 resize-none"}),n.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:'Examples: "You are a pronunciation coach focused only on accent", "You are a vocabulary expert for advanced learners"'})]}),n.jsxs(l,{onClick:se,size:"lg",className:"w-full gap-2",children:[n.jsx(m,{className:"w-5 h-5"}),"Start Call"]})]})]}),n.jsxs(a,{className:"flex-1",children:[n.jsx(s,{children:n.jsxs(i,{className:"flex items-center gap-2",children:[n.jsx(u,{className:"w-4 h-4"}),"Conversation"]})}),n.jsxs(o,{className:"max-h-96 overflow-y-auto space-y-3 pb-4",children:[0===k.length&&!N&&"idle"===S&&n.jsx("div",{className:"text-center py-8 text-muted-foreground",children:n.jsx("p",{className:"text-sm",children:"Start a call to begin practicing IELTS Speaking with English Tutora."})}),k.map((e,t)=>n.jsx("div",{className:"flex "+("student"===e.speaker?"justify-end":"justify-start"),children:n.jsxs("div",{className:"max-w-xs px-4 py-2 rounded-2xl text-sm "+("student"===e.speaker?"bg-primary text-primary-foreground":"bg-card border border-border"),children:[n.jsx("p",{className:"leading-relaxed",children:e.text}),e.translation&&e.translation.trim()&&n.jsx("p",{className:"text-xs mt-2 pt-2 border-t border-current/30 opacity-75 italic",children:e.translation}),e.pronunciation&&e.pronunciation.score>0&&n.jsxs("div",{className:"mt-2 pt-2 border-t border-border/50 text-xs opacity-75",children:["ğŸ¯ Pronunciation: ",e.pronunciation.feedback," (",e.pronunciation.score,"/10)"]})]})},t)),N&&n.jsx("div",{className:"flex "+(k.filter(e=>"student"===e.speaker).length%2==0?"justify-end":"justify-start"),children:n.jsx("div",{className:"max-w-xs px-4 py-2 rounded-2xl text-sm italic opacity-75 "+(k.filter(e=>"student"===e.speaker).length%2==0?"bg-primary text-primary-foreground":"bg-card border border-border"),children:N})}),n.jsx("div",{ref:ee})]})]}),R.length>0&&n.jsxs(a,{className:"bg-slate-50 dark:bg-slate-900 border-slate-200 dark:border-slate-800",children:[n.jsx(s,{children:n.jsxs(i,{className:"flex items-center gap-2 text-sm",children:[n.jsx(x,{className:"w-4 h-4"}),"Debug Logs ","google-cloud"===I&&n.jsx("span",{className:"text-xs bg-orange-100 dark:bg-orange-900 px-2 py-1 rounded text-orange-800 dark:text-orange-200",children:"Fallback Mode"})]})}),n.jsx(o,{children:n.jsx("div",{className:"text-xs font-mono space-y-1 max-h-32 overflow-y-auto",children:R.map((e,t)=>n.jsx("div",{className:"text-muted-foreground",children:e},t))})})]}),n.jsx(a,{className:"bg-blue-50 dark:bg-blue-950 border-blue-200 dark:border-blue-800",children:n.jsx(o,{className:"pt-4 text-sm text-muted-foreground",children:n.jsxs("p",{children:["ğŸ’¡ ",n.jsx("strong",{children:"Tip:"})," Speak naturally and at a normal pace. English Tutora will provide real-time pronunciation feedback and coaching on your IELTS Speaking performance."]})})}),n.jsx("audio",{ref:q})]})});var ie};export{y as default};
