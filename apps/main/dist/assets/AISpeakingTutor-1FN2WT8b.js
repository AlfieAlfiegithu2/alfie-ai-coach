import{u as e,g as a,r as s,j as t,Z as r,aa as i,C as n,a as o,U as l,I as c,B as d,a7 as m}from"./index-ZP4Rea1h.js";import{s as u}from"./supabase-DUkWVuqu.js";const x=()=>{e();const{toast:x}=a(),[h,f]=s.useState([]),[p,g]=s.useState(""),[y,b]=s.useState(!1),v=s.useRef(null);s.useEffect(()=>{(async()=>{const e="Hello! I'm Foxbot, your expert IELTS Speaking tutor powered by Qwen 3 TTS Flash. I'm here to guide you through strategic speaking techniques, structure, and vocabulary enhancement. What specific aspect of your speaking would you like to work on?";try{const{data:a}=await u.functions.invoke("openrouter-qwen-tts",{body:{text:e,voice:"Cherry",language_type:"English"}});f([{id:"welcome",text:e,isUser:!1,timestamp:new Date,ttsData:a}])}catch(a){console.warn("Welcome TTS failed, using text only:",a);f([{id:"welcome",text:e,isUser:!1,timestamp:new Date}])}})()},[]),s.useEffect(()=>{var e;null==(e=v.current)||e.scrollIntoView({behavior:"smooth"})},[h]);const w=()=>{p.trim()&&(async e=>{if(!e.trim())return;const a={id:Date.now().toString(),text:e,isUser:!0,timestamp:new Date};f(e=>[...e,a]),g(""),b(!0);try{const{data:a,error:s}=await u.functions.invoke("openai-chat",{body:{message:`The student is asking about IELTS Speaking practice. They asked: "${e}". Provide helpful, conversational guidance for IELTS Speaking improvement. Be encouraging and specific.`,context:"english_tutor"}});if(s)throw s;const t=a.response||"I'm unable to provide assistance right now. Please try again.",{data:r,error:i}=await u.functions.invoke("openrouter-qwen-tts",{body:{text:t,voice:"Cherry",language_type:"English"}});i&&console.warn("TTS failed, using text only:",i);const n={id:(Date.now()+1).toString(),text:t,isUser:!1,timestamp:new Date,ttsData:r};f(e=>[...e,n])}catch(s){console.error("Error getting AI assistance:",s),x({title:"AI Assistant Error",description:"Failed to get assistance. Please try again.",variant:"destructive"});const e={id:(Date.now()+1).toString(),text:"Sorry, I encountered an error. Please try again.",isUser:!1,timestamp:new Date};f(a=>[...a,e])}finally{b(!1)}})(p)};return t.jsx(r,{title:"AI Speaking Tutor",showBackButton:!0,backPath:"/ielts-portal",children:t.jsxs("div",{className:"max-w-3xl mx-auto h-[calc(100vh-250px)] flex flex-col space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(i,{className:"w-5 h-5 text-primary"}),t.jsx("h1",{className:"text-2xl font-bold",children:"AI Speaking Tutor"})]}),t.jsx("p",{className:"text-muted-foreground",children:"Conversational practice with Foxbot - Get personalized guidance for IELTS Speaking"})]}),t.jsx(n,{className:"flex-1 flex flex-col overflow-hidden",children:t.jsxs(o,{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-muted/30",children:[h.map(e=>t.jsxs("div",{className:"flex gap-3 "+(e.isUser?"justify-end":"justify-start"),children:[!e.isUser&&t.jsx("div",{className:"flex-shrink-0 mt-1",children:t.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center overflow-hidden",children:t.jsx("img",{src:"/lovable-uploads/dc03c5f0-f40a-40f2-a71a-0b12438f0f6b.png",alt:"Foxbot",className:"w-8 h-8 rounded-full object-cover"})})}),t.jsx("div",{className:"max-w-[80%] p-4 rounded-2xl text-sm shadow-sm "+(e.isUser?"bg-primary text-primary-foreground":"bg-card border border-border"),children:t.jsx("p",{className:"leading-relaxed whitespace-pre-wrap",children:e.text})}),e.isUser&&t.jsx("div",{className:"flex-shrink-0 mt-1",children:t.jsx("div",{className:"w-8 h-8 rounded-full bg-muted flex items-center justify-center",children:t.jsx(l,{className:"h-4 w-4 text-muted-foreground"})})})]},e.id)),y&&t.jsxs("div",{className:"flex gap-3 justify-start",children:[t.jsx("div",{className:"flex-shrink-0 mt-1",children:t.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center overflow-hidden",children:t.jsx("img",{src:"/lovable-uploads/dc03c5f0-f40a-40f2-a71a-0b12438f0f6b.png",alt:"Foxbot",className:"w-8 h-8 rounded-full object-cover"})})}),t.jsx("div",{className:"bg-card border border-border p-4 rounded-2xl shadow-sm",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-bounce"}),t.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-bounce delay-100"}),t.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-bounce delay-200"})]})})]}),t.jsx("div",{ref:v})]})}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(c,{value:p,onChange:e=>g(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),w())},placeholder:"Ask Foxbot anything about IELTS Speaking...",disabled:y}),t.jsx(d,{onClick:w,disabled:y||!p.trim(),className:"bg-primary hover:bg-primary/90",children:t.jsx(m,{className:"h-4 w-4"})})]})]})})};export{x as default};
