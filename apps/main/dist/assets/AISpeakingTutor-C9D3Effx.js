import{u as e,r as s,j as a}from"./vendor-react-rLLBBC7n.js";import{d as t,y as r,C as i,a as o,I as n,B as l,s as c}from"./index-KxDfHqNJ.js";import{ak as d,U as m,x as u}from"./vendor-ui-BGi_EvHx.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-charts-0DeywwxG.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";const x=()=>{e();const{toast:x}=t(),[p,h]=s.useState([]),[f,g]=s.useState(""),[v,y]=s.useState(!1),j=s.useRef(null);s.useEffect(()=>{(async()=>{const e="Hello! I'm Foxbot, your expert IELTS Speaking tutor powered by Qwen 3 TTS Flash. I'm here to guide you through strategic speaking techniques, structure, and vocabulary enhancement. What specific aspect of your speaking would you like to work on?";try{const{data:s}=await c.functions.invoke("openrouter-qwen-tts",{body:{text:e,voice:"Cherry",language_type:"English"}});h([{id:"welcome",text:e,isUser:!1,timestamp:new Date,ttsData:s}])}catch(s){console.warn("Welcome TTS failed, using text only:",s);h([{id:"welcome",text:e,isUser:!1,timestamp:new Date}])}})()},[]),s.useEffect(()=>{var e;null==(e=j.current)||e.scrollIntoView({behavior:"smooth"})},[p]);const b=()=>{f.trim()&&(async e=>{if(!e.trim())return;const s={id:Date.now().toString(),text:e,isUser:!0,timestamp:new Date};h(e=>[...e,s]),g(""),y(!0);try{const{data:s,error:a}=await c.functions.invoke("openai-chat",{body:{message:`The student is asking about IELTS Speaking practice. They asked: "${e}". Provide helpful, conversational guidance for IELTS Speaking improvement. Be encouraging and specific.`,context:"english_tutor"}});if(a)throw a;const t=s.response||"I'm unable to provide assistance right now. Please try again.",{data:r,error:i}=await c.functions.invoke("openrouter-qwen-tts",{body:{text:t,voice:"Cherry",language_type:"English"}});i&&console.warn("TTS failed, using text only:",i);const o={id:(Date.now()+1).toString(),text:t,isUser:!1,timestamp:new Date,ttsData:r};h(e=>[...e,o])}catch(a){console.error("Error getting AI assistance:",a),x({title:"AI Assistant Error",description:"Failed to get assistance. Please try again.",variant:"destructive"});const e={id:(Date.now()+1).toString(),text:"Sorry, I encountered an error. Please try again.",isUser:!1,timestamp:new Date};h(s=>[...s,e])}finally{y(!1)}})(f)};return a.jsx(r,{title:"AI Speaking Tutor",showBackButton:!0,backPath:"/ielts-portal",children:a.jsxs("div",{className:"max-w-3xl mx-auto h-[calc(100vh-250px)] flex flex-col space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(d,{className:"w-5 h-5 text-primary"}),a.jsx("h1",{className:"text-2xl font-bold",children:"AI Speaking Tutor"})]}),a.jsx("p",{className:"text-muted-foreground",children:"Conversational practice with Foxbot - Get personalized guidance for IELTS Speaking"})]}),a.jsx(i,{className:"flex-1 flex flex-col overflow-hidden",children:a.jsxs(o,{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-muted/30",children:[p.map(e=>a.jsxs("div",{className:"flex gap-3 "+(e.isUser?"justify-end":"justify-start"),children:[!e.isUser&&a.jsx("div",{className:"flex-shrink-0 mt-1",children:a.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center overflow-hidden",children:a.jsx("img",{src:"/lovable-uploads/dc03c5f0-f40a-40f2-a71a-0b12438f0f6b.png",alt:"Foxbot",className:"w-8 h-8 rounded-full object-cover"})})}),a.jsx("div",{className:"max-w-[80%] p-4 rounded-2xl text-sm shadow-sm "+(e.isUser?"bg-primary text-primary-foreground":"bg-card border border-border"),children:a.jsx("p",{className:"leading-relaxed whitespace-pre-wrap",children:e.text})}),e.isUser&&a.jsx("div",{className:"flex-shrink-0 mt-1",children:a.jsx("div",{className:"w-8 h-8 rounded-full bg-muted flex items-center justify-center",children:a.jsx(m,{className:"h-4 w-4 text-muted-foreground"})})})]},e.id)),v&&a.jsxs("div",{className:"flex gap-3 justify-start",children:[a.jsx("div",{className:"flex-shrink-0 mt-1",children:a.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center overflow-hidden",children:a.jsx("img",{src:"/lovable-uploads/dc03c5f0-f40a-40f2-a71a-0b12438f0f6b.png",alt:"Foxbot",className:"w-8 h-8 rounded-full object-cover"})})}),a.jsx("div",{className:"bg-card border border-border p-4 rounded-2xl shadow-sm",children:a.jsxs("div",{className:"flex gap-1",children:[a.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-bounce"}),a.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-bounce delay-100"}),a.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-bounce delay-200"})]})})]}),a.jsx("div",{ref:j})]})}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(n,{value:f,onChange:e=>g(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),b())},placeholder:"Ask Foxbot anything about IELTS Speaking...",disabled:v}),a.jsx(l,{onClick:b,disabled:v||!f.trim(),className:"bg-primary hover:bg-primary/90",children:a.jsx(u,{className:"h-4 w-4"})})]})]})})};export{x as default};
