import{r as e,j as s}from"./vendor-react-rLLBBC7n.js";import{A as t}from"./AdminLayout-DwaN-V0p.js";import{d as a,C as l,b as r,c as i,a as c,P as n,s as d}from"./index-BDl0jLJK.js";import{aw as o,bf as x,H as m,aQ as h,cq as u,cr as j}from"./vendor-ui-BGi_EvHx.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-charts-0DeywwxG.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";const f=()=>{const[f,p]=e.useState(null),[N,g]=e.useState([]),[y,b]=e.useState(!0),{toast:v}=a(),_=e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,s)*100)/100+" "+["Bytes","KB","MB","GB"][s]},w=e=>(new Intl.NumberFormat).format(e);e.useEffect(()=>{(async()=>{try{const{data:e,error:s}=await d.rpc("get_audio_analytics_summary",{days_back:30});if(s)throw s;e&&e.length>0&&p(e[0]);const{data:t,error:a}=await d.rpc("get_storage_stats");if(a)throw a;g(t||[])}catch(e){console.error("Error fetching analytics:",e),v({title:"Error Loading Analytics",description:e.message,variant:"destructive"})}finally{b(!1)}})()},[v]);const C=f?(f.total_egress_bytes/1073741824*.09).toFixed(2):"0.00",B=N.reduce((e,s)=>e+s.total_bytes/1073741824*.021,0).toFixed(2);return s.jsx(t,{title:"Audio & Storage Analytics",showBackButton:!0,children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[s.jsxs(l,{children:[s.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(i,{className:"text-sm font-medium",children:"Total Audio Plays"}),s.jsx(o,{className:"h-4 w-4 text-muted-foreground"})]}),s.jsxs(c,{children:[s.jsx("div",{className:"text-2xl font-bold",children:y?"...":w((null==f?void 0:f.total_plays)||0)}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Last 30 days"})]})]}),s.jsxs(l,{children:[s.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(i,{className:"text-sm font-medium",children:"Cache Hit Rate"}),s.jsx(x,{className:"h-4 w-4 text-muted-foreground"})]}),s.jsxs(c,{children:[s.jsx("div",{className:"text-2xl font-bold",children:y?"...":`${Math.round((null==f?void 0:f.cache_hit_rate)||0)}%`}),s.jsx(n,{value:(null==f?void 0:f.cache_hit_rate)||0,className:"mt-2"}),s.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[w((null==f?void 0:f.cache_hits)||0)," cached responses"]})]})]}),s.jsxs(l,{children:[s.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(i,{className:"text-sm font-medium",children:"Total Egress"}),s.jsx(m,{className:"h-4 w-4 text-muted-foreground"})]}),s.jsxs(c,{children:[s.jsx("div",{className:"text-2xl font-bold",children:y?"...":_((null==f?void 0:f.total_egress_bytes)||0)}),s.jsxs("p",{className:"text-xs text-muted-foreground",children:["Est. cost: $",C]})]})]}),s.jsxs(l,{children:[s.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(i,{className:"text-sm font-medium",children:"API Generations"}),s.jsx(h,{className:"h-4 w-4 text-muted-foreground"})]}),s.jsxs(c,{children:[s.jsx("div",{className:"text-2xl font-bold",children:y?"...":w((null==f?void 0:f.total_generations)||0)}),s.jsxs("p",{className:"text-xs text-muted-foreground",children:[w((null==f?void 0:f.unique_questions)||0)," unique questions"]})]})]})]}),s.jsxs(l,{children:[s.jsx(r,{children:s.jsxs(i,{className:"flex items-center gap-2",children:[s.jsx(u,{className:"h-5 w-5"}),"Storage Breakdown by Bucket"]})}),s.jsx(c,{children:s.jsx("div",{className:"space-y-4",children:N.map(e=>s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:"text-sm font-medium",children:e.bucket_id}),s.jsxs("p",{className:"text-xs text-muted-foreground",children:[w(e.file_count)," files • Avg: ",_(e.avg_bytes)]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-sm font-bold",children:_(e.total_bytes)}),s.jsxs("p",{className:"text-xs text-muted-foreground",children:["$",(e.total_bytes/1073741824*.021).toFixed(4),"/mo"]})]})]}),s.jsx(n,{value:e.total_bytes/Math.max(...N.map(e=>e.total_bytes))*100})]},e.bucket_id))})})]}),s.jsxs(l,{children:[s.jsx(r,{children:s.jsxs(i,{className:"flex items-center gap-2",children:[s.jsx(j,{className:"h-5 w-5"}),"Monthly Cost Estimate"]})}),s.jsx(c,{children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm",children:"Storage Cost"}),s.jsxs("span",{className:"font-mono font-bold",children:["$",B]})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm",children:"Egress Cost (30 days)"}),s.jsxs("span",{className:"font-mono font-bold",children:["$",C]})]}),s.jsxs("div",{className:"border-t pt-4 flex justify-between items-center",children:[s.jsx("span",{className:"text-base font-medium",children:"Total Estimated"}),s.jsxs("span",{className:"text-xl font-bold",children:["$",(parseFloat(B)+parseFloat(C)).toFixed(2)]})]}),s.jsxs("div",{className:"mt-6 p-4 bg-muted rounded-lg space-y-2",children:[s.jsx("h4",{className:"font-semibold text-sm",children:"Cost Optimization Tips:"}),s.jsxs("ul",{className:"text-xs space-y-1 text-muted-foreground",children:[s.jsx("li",{children:"• Increase cache hit rate to reduce egress costs"}),s.jsx("li",{children:"• Compress audio files to reduce storage size"}),s.jsx("li",{children:"• Use CDN to reduce Supabase egress charges"}),s.jsx("li",{children:"• Clean up duplicate files in audio-files bucket"}),s.jsxs("li",{children:["• Current avg file size: ",_((null==f?void 0:f.avg_file_size)||0)]})]})]})]})})]})]})})};export{f as default};
