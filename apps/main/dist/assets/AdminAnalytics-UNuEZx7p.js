import{c as e,r as s,h as t,j as a,C as l,b as i,d as r,V as c,a as n,K as d,af as o}from"./index-DDnQPoAv.js";import{A as x}from"./AdminLayout-DoYX_qjq.js";import{s as m}from"./supabase-DWL4C3fA.js";import{Z as h}from"./zap-D8vjGtsS.js";import{C as u}from"./chart-column-B4J2SQfV.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j=e("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),f=e("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]),p=()=>{const[e,p]=s.useState(null),[y,N]=s.useState([]),[g,b]=s.useState(!0),{toast:v}=t(),_=e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,s)*100)/100+" "+["Bytes","KB","MB","GB"][s]},w=e=>(new Intl.NumberFormat).format(e);s.useEffect(()=>{(async()=>{try{const{data:e,error:s}=await m.rpc("get_audio_analytics_summary",{days_back:30});if(s)throw s;e&&e.length>0&&p(e[0]);const{data:t,error:a}=await m.rpc("get_storage_stats");if(a)throw a;N(t||[])}catch(e){console.error("Error fetching analytics:",e),v({title:"Error Loading Analytics",description:e.message,variant:"destructive"})}finally{b(!1)}})()},[v]);const k=e?(e.total_egress_bytes/1073741824*.09).toFixed(2):"0.00",M=y.reduce((e,s)=>e+s.total_bytes/1073741824*.021,0).toFixed(2);return a.jsx(x,{title:"Audio & Storage Analytics",showBackButton:!0,children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[a.jsxs(l,{children:[a.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(r,{className:"text-sm font-medium",children:"Total Audio Plays"}),a.jsx(c,{className:"h-4 w-4 text-muted-foreground"})]}),a.jsxs(n,{children:[a.jsx("div",{className:"text-2xl font-bold",children:g?"...":w((null==e?void 0:e.total_plays)||0)}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Last 30 days"})]})]}),a.jsxs(l,{children:[a.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(r,{className:"text-sm font-medium",children:"Cache Hit Rate"}),a.jsx(h,{className:"h-4 w-4 text-muted-foreground"})]}),a.jsxs(n,{children:[a.jsx("div",{className:"text-2xl font-bold",children:g?"...":`${Math.round((null==e?void 0:e.cache_hit_rate)||0)}%`}),a.jsx(d,{value:(null==e?void 0:e.cache_hit_rate)||0,className:"mt-2"}),a.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[w((null==e?void 0:e.cache_hits)||0)," cached responses"]})]})]}),a.jsxs(l,{children:[a.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(r,{className:"text-sm font-medium",children:"Total Egress"}),a.jsx(o,{className:"h-4 w-4 text-muted-foreground"})]}),a.jsxs(n,{children:[a.jsx("div",{className:"text-2xl font-bold",children:g?"...":_((null==e?void 0:e.total_egress_bytes)||0)}),a.jsxs("p",{className:"text-xs text-muted-foreground",children:["Est. cost: $",k]})]})]}),a.jsxs(l,{children:[a.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(r,{className:"text-sm font-medium",children:"API Generations"}),a.jsx(u,{className:"h-4 w-4 text-muted-foreground"})]}),a.jsxs(n,{children:[a.jsx("div",{className:"text-2xl font-bold",children:g?"...":w((null==e?void 0:e.total_generations)||0)}),a.jsxs("p",{className:"text-xs text-muted-foreground",children:[w((null==e?void 0:e.unique_questions)||0)," unique questions"]})]})]})]}),a.jsxs(l,{children:[a.jsx(i,{children:a.jsxs(r,{className:"flex items-center gap-2",children:[a.jsx(f,{className:"h-5 w-5"}),"Storage Breakdown by Bucket"]})}),a.jsx(n,{children:a.jsx("div",{className:"space-y-4",children:y.map(e=>a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("p",{className:"text-sm font-medium",children:e.bucket_id}),a.jsxs("p",{className:"text-xs text-muted-foreground",children:[w(e.file_count)," files • Avg: ",_(e.avg_bytes)]})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("p",{className:"text-sm font-bold",children:_(e.total_bytes)}),a.jsxs("p",{className:"text-xs text-muted-foreground",children:["$",(e.total_bytes/1073741824*.021).toFixed(4),"/mo"]})]})]}),a.jsx(d,{value:e.total_bytes/Math.max(...y.map(e=>e.total_bytes))*100})]},e.bucket_id))})})]}),a.jsxs(l,{children:[a.jsx(i,{children:a.jsxs(r,{className:"flex items-center gap-2",children:[a.jsx(j,{className:"h-5 w-5"}),"Monthly Cost Estimate"]})}),a.jsx(n,{children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm",children:"Storage Cost"}),a.jsxs("span",{className:"font-mono font-bold",children:["$",M]})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm",children:"Egress Cost (30 days)"}),a.jsxs("span",{className:"font-mono font-bold",children:["$",k]})]}),a.jsxs("div",{className:"border-t pt-4 flex justify-between items-center",children:[a.jsx("span",{className:"text-base font-medium",children:"Total Estimated"}),a.jsxs("span",{className:"text-xl font-bold",children:["$",(parseFloat(M)+parseFloat(k)).toFixed(2)]})]}),a.jsxs("div",{className:"mt-6 p-4 bg-muted rounded-lg space-y-2",children:[a.jsx("h4",{className:"font-semibold text-sm",children:"Cost Optimization Tips:"}),a.jsxs("ul",{className:"text-xs space-y-1 text-muted-foreground",children:[a.jsx("li",{children:"• Increase cache hit rate to reduce egress costs"}),a.jsx("li",{children:"• Compress audio files to reduce storage size"}),a.jsx("li",{children:"• Use CDN to reduce Supabase egress charges"}),a.jsx("li",{children:"• Clean up duplicate files in audio-files bucket"}),a.jsxs("li",{children:["• Current avg file size: ",_((null==e?void 0:e.avg_file_size)||0)]})]})]})]})})]})]})})};
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */export{p as default};
