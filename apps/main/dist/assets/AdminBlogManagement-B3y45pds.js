import{y as e,u as t,r as s,J as a,j as n,au as l,ah as r,B as i,P as c,C as o,a as d,k as m,G as x,W as u,E as g,b as h,c as p,bg as j,bh as v,bi as f,I as y,ad as b,S as N,o as w,p as k,q as E,s as S,a9 as _,bd as C,L as T,T as I,X as L}from"./index-CKnaXPOD.js";import{T as $,a as A,b as P,c as G}from"./tabs-Dd9Qm4Rj.js";import{A as O,a as F,b as z,c as M,d as R,e as D,f as U,g as B,h as q}from"./alert-dialog-DR989NAv.js";import{A as W}from"./AdminLayout-DSM8iI2m.js";import{s as Y}from"./supabase-DWL4C3fA.js";import{c as K,g as H,s as J,S as X}from"./blogUtils-wXDNDKeJ.js";import{S as Q}from"./square-pen-BDznx_9B.js";import{T as V}from"./trash-2-BGAhI09j.js";import{C as Z}from"./circle-help-CFoQgv9K.js";import{C as ee}from"./circle-alert-hfwXBz2n.js";import{S as te}from"./save-Dv2OSWtr.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=e("WandSparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]),ae=()=>{var e,ae,ne,le,re,ie,ce,oe,de,me,xe,ue,ge,he,pe,je,ve,fe,ye,be,Ne,we,ke,Ee;t();const[Se,_e]=s.useState([]),[Ce,Te]=s.useState(!0),[Ie,Le]=s.useState(null),[$e,Ae]=s.useState(!1),[Pe,Ge]=s.useState("list"),[Oe,Fe]=s.useState(""),[ze,Me]=s.useState(""),[Re,De]=s.useState("draft"),[Ue,Be]=s.useState({}),[qe,We]=s.useState(!1),[Ye,Ke]=s.useState(new Set),[He,Je]=s.useState("en");s.useEffect(()=>{Xe()},[]);const Xe=async()=>{try{Te(!0);const{data:e,error:t}=await Y.from("blog_posts").select("\n          *,\n          blog_post_translations (*)\n        ").order("created_at",{ascending:!1});if(t)throw t;const s=(e||[]).map(e=>({...e,translations:e.blog_post_translations||[]}));_e(s)}catch(e){console.error("Error loading blog posts:",e),a.error("Failed to load blog posts")}finally{Te(!1)}},Qe=()=>{Ae(!0),Le(null),Fe(""),Me(""),De("draft"),Be({}),Ge("edit")},Ve=()=>{Le(null),Ae(!1),Fe(""),Me(""),De("draft"),Be({}),Ke(new Set),Je("en"),Ge("list")},Ze=(e,t,s)=>{Be(a=>({...a,[e]:{...a[e],language_code:e,[t]:s}}))},et=(e,t="en")=>{if(!e.trim())return"";const s=J(e);return Ie&&Ie.slug?Ie.slug:s},tt=async(e,t,s,a)=>{if(!(e.length>200||e.split(" ").length>10))try{await Y.from("translation_cache").upsert({word:e.toLowerCase().trim(),source_lang:s,target_lang:a,translation:t,hit_count:1,expires_at:new Date(Date.now()+6048e5).toISOString()},{onConflict:"word,source_lang,target_lang"})}catch(n){console.debug("Failed to cache translation:",n)}},st=async(e,t)=>{var s,a;try{const n=await Y.functions.invoke("translation-service",{body:{text:`Generate a compelling 1-2 sentence excerpt (max 160 characters) for a blog post with title: "${e}". Content summary: ${t.substring(0,500)}${t.length>500?"...":""}`,sourceLang:"en",targetLang:"en",includeContext:!1}});if((null==(s=n.data)?void 0:s.success)&&(null==(a=n.data.result)?void 0:a.translation))return n.data.result.translation.trim();return t.replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim().substring(0,160)}catch(n){console.error("Failed to generate excerpt:",n);return t.replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim().substring(0,160)}},at=async(e,t)=>{var s,a;try{const n=await Y.functions.invoke("translation-service",{body:{text:`Create an SEO-optimized meta description (max 155 characters) for a blog post titled: "${e}". Focus on the main benefit or key insight. Content: ${t.substring(0,300)}${t.length>300?"...":""}`,sourceLang:"en",targetLang:"en",includeContext:!1}});if((null==(s=n.data)?void 0:s.success)&&(null==(a=n.data.result)?void 0:a.translation))return n.data.result.translation.trim();return`${e}. ${t.replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim().substring(0,120)}`.substring(0,155)}catch(n){console.error("Failed to generate meta description:",n);return`${e}. ${t.replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim().substring(0,120)}`.substring(0,155)}},nt=async(e,t)=>{var s,a;try{const n=await Y.functions.invoke("translation-service",{body:{text:`Generate 5-8 relevant SEO keywords (comma-separated) for a blog post titled: "${e}". Include main topic, related terms, and long-tail keywords. Content preview: ${t.substring(0,400)}${t.length>400?"...":""}`,sourceLang:"en",targetLang:"en",includeContext:!1}});return(null==(s=n.data)?void 0:s.success)&&(null==(a=n.data.result)?void 0:a.translation)?n.data.result.translation.trim():"IELTS, English learning, AI tutor, IELTS Speaking, IELTS Writing"}catch(n){return console.error("Failed to generate meta keywords:",n),"IELTS, English learning, AI tutor, IELTS Speaking, IELTS Writing"}},lt=async(e,t)=>{var s,a;try{const n=await Y.functions.invoke("translation-service",{body:{text:`Suggest a descriptive filename for a featured image for a blog post titled: "${e}". Content summary: ${t.substring(0,200)}${t.length>200?"...":""}. Return just the filename without extension (e.g., "ielts-speaking-practice-guide").`,sourceLang:"en",targetLang:"en",includeContext:!1}});if((null==(s=n.data)?void 0:s.success)&&(null==(a=n.data.result)?void 0:a.translation)){return`https://storage.googleapis.com/gpt-engineer-file-uploads/${n.data.result.translation.trim().toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}`}return`https://storage.googleapis.com/gpt-engineer-file-uploads/${J(e)}-featured-image`}catch(n){return console.error("Failed to generate image suggestion:",n),`https://storage.googleapis.com/gpt-engineer-file-uploads/${J(e)}-featured-image`}},rt=async(e,t="",s="IELTS")=>{var a,n;try{const l=`Generate an SEO-optimized blog post title for content about: "${e.substring(0,500)}${e.length>500?"...":""}"\n\nSEO REQUIREMENTS:\n- Length: 50-65 characters (ideal for Google)\n- Include primary keyword naturally\n- Add power words (Best, Ultimate, Complete, Essential, Proven, etc.)\n- Create curiosity or solve a problem\n- Target search intent\n${t?`- Include these target keywords: ${t}`:""}\n- Niche: ${s} preparation and learning\n\nReturn ONLY the title, no quotes or explanation.`,r=await Y.functions.invoke("translation-service",{body:{text:l,sourceLang:"en",targetLang:"en",includeContext:!1}});if((null==(a=r.data)?void 0:a.success)&&(null==(n=r.data.result)?void 0:n.translation))return r.data.result.translation.trim();return`${e.split(".")[0].substring(0,60)} - ${s} Guide`}catch(l){console.error("Failed to generate SEO title:",l);return`${e.split(".")[0].substring(0,60)} - ${s} Guide`}},it=async(e,t,s,a=2)=>{var n,l;const r=await(async(e,t,s)=>{if(e.length>200||e.split(" ").length>10)return null;try{const{data:a}=await Y.from("translation_cache").select("translation").eq("word",e.toLowerCase().trim()).eq("source_lang",t).eq("target_lang",s).gt("expires_at",(new Date).toISOString()).single();return(null==a?void 0:a.translation)||null}catch{return null}})(e,t,s);if(r)return console.log(`Cache hit for "${e.substring(0,30)}..." â†’ "${r.substring(0,30)}..."`),r;for(let c=1;c<=a;c++)try{const r=await Y.functions.invoke("translation-service",{body:{text:e,sourceLang:t,targetLang:s,includeContext:!1}});if(r.error||!(null==(n=r.data)?void 0:n.success)||!(null==(l=r.data.result)?void 0:l.translation)){if(console.warn(`Translation attempt ${c} failed for ${s}:`,r.error||r.data),c===a)return null;await new Promise(e=>setTimeout(e,1e3*c));continue}const i=String(r.data.result.translation).trim();return await tt(e,i,t,s),i}catch(i){if(console.error(`Translation attempt ${c} error for ${s}:`,i),c===a)return null;await new Promise(e=>setTimeout(e,1e3*c))}return null};return n.jsx(l,{children:n.jsxs(W,{title:"Blog Management",showBackButton:!0,children:[n.jsx(r,{title:"Blog Management - Admin",description:"Manage blog posts and translations",lang:"en"}),n.jsxs($,{value:Pe,onValueChange:Ge,className:"w-full",children:[n.jsxs(A,{className:"grid w-full grid-cols-2",children:[n.jsx(P,{value:"list",children:"Blog Posts"}),n.jsx(P,{value:"edit",children:$e?"Create New Post":Ie?"Edit Post":"New Post"})]}),n.jsxs(G,{value:"list",className:"space-y-4",children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("h2",{className:"text-2xl font-bold",children:"All Blog Posts"}),n.jsxs(i,{onClick:Qe,children:[n.jsx(c,{className:"w-4 h-4 mr-2"}),"Create New Post"]})]}),Ce?n.jsxs("div",{className:"text-center py-12",children:[n.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),n.jsx("p",{className:"mt-4 text-gray-600",children:"Loading posts..."})]}):0===Se.length?n.jsx(o,{children:n.jsxs(d,{className:"p-12 text-center",children:[n.jsx("p",{className:"text-gray-600 mb-4",children:"No blog posts yet."}),n.jsxs(i,{onClick:Qe,children:[n.jsx(c,{className:"w-4 h-4 mr-2"}),"Create Your First Post"]})]})}):n.jsx("div",{className:"grid gap-4",children:Se.map(e=>n.jsx(o,{children:n.jsx(d,{className:"p-6",children:n.jsxs("div",{className:"flex items-start justify-between",children:[n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx("h3",{className:"text-xl font-semibold",children:e.slug}),n.jsx(m,{variant:"published"===e.status?"default":"secondary",children:e.status})]}),n.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500 mb-2",children:[n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(x,{className:"w-4 h-4"}),e.translations.length," language",1!==e.translations.length?"s":""," published"]}),e.published_at&&n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(u,{className:"w-4 h-4"}),new Date(e.published_at).toLocaleDateString()]})]}),n.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.translations.slice(0,5).map(e=>n.jsxs(m,{variant:"outline",className:"text-xs",children:[K(e.language_code)," ","en"===e.language_code?"English":H(e.language_code)]},e.language_code)),e.translations.length>5&&n.jsxs(m,{variant:"outline",className:"text-xs",children:["+",e.translations.length-5," more"]})]})]}),n.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[n.jsx(i,{variant:"ghost",size:"sm",onClick:()=>{var t;return window.open(`/${(null==(t=e.translations[0])?void 0:t.language_code)||"en"}/blog/${e.slug}`,"_blank")},children:n.jsx(g,{className:"w-4 h-4"})}),n.jsx(i,{variant:"ghost",size:"sm",onClick:()=>(e=>{Le(e),Ae(!1),Fe(e.slug),Me(e.featured_image_url||""),De(e.status);const t={};e.translations.forEach(e=>{t[e.language_code]={id:e.id,language_code:e.language_code,title:e.title,content:e.content,excerpt:e.excerpt||"",meta_description:e.meta_description||"",meta_keywords:e.meta_keywords||""}}),Be(t),Ge("edit")})(e),children:n.jsx(Q,{className:"w-4 h-4"})}),n.jsxs(O,{children:[n.jsx(F,{asChild:!0,children:n.jsx(i,{variant:"ghost",size:"sm",children:n.jsx(V,{className:"w-4 h-4 text-red-500"})})}),n.jsxs(z,{children:[n.jsxs(M,{children:[n.jsx(R,{children:"Delete Blog Post"}),n.jsxs(D,{children:['Are you sure you want to delete "',e.slug,'"? This action cannot be undone.']})]}),n.jsxs(U,{children:[n.jsx(B,{children:"Cancel"}),n.jsx(q,{onClick:()=>(async e=>{try{const{error:t}=await Y.from("blog_posts").delete().eq("id",e);if(t)throw t;a.success("Blog post deleted successfully"),Xe()}catch(t){console.error("Error deleting blog post:",t),a.error(t.message||"Failed to delete blog post")}})(e.id),children:"Delete"})]})]})]})]})]})})},e.id))})]}),n.jsx(G,{value:"edit",className:"space-y-6",children:n.jsxs(o,{children:[n.jsx(h,{children:n.jsx(p,{children:$e?"Create New Blog Post":"Edit Blog Post"})}),n.jsxs(d,{className:"space-y-6",children:[n.jsxs("div",{className:"space-y-4",children:[n.jsx("h3",{className:"text-lg font-semibold",children:"Basic Information"}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx("label",{className:"block text-sm font-medium",children:"Slug (URL)"}),n.jsxs(j,{children:[n.jsx(v,{asChild:!0,children:n.jsx(Z,{className:"w-4 h-4 text-gray-400 hover:text-gray-600 cursor-help"})}),n.jsx(f,{className:"max-w-sm",children:n.jsxs("div",{className:"space-y-2",children:[n.jsx("p",{className:"text-sm font-medium",children:"Slug (URL)"}),n.jsx("p",{className:"text-xs text-gray-600",children:"The URL-friendly version of your post title that appears in the web address."}),n.jsxs("div",{className:"bg-blue-50 p-2 rounded text-xs",children:[n.jsx("strong",{children:"Example:"}),n.jsx("br",{}),'Title: "IELTS Speaking Practice Guide"',n.jsx("br",{}),"URL: yoursite.com/blog/ielts-speaking-practice-guide"]})]})})]})]}),n.jsx(y,{value:Oe,onChange:e=>Fe(J(e.target.value)),placeholder:"blog-post-slug"})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("label",{className:"block text-sm font-medium",children:"Featured Image URL"}),n.jsxs(j,{children:[n.jsx(v,{asChild:!0,children:n.jsx(Z,{className:"w-4 h-4 text-gray-400 hover:text-gray-600 cursor-help"})}),n.jsx(f,{className:"max-w-sm",children:n.jsxs("div",{className:"space-y-2",children:[n.jsx("p",{className:"text-sm font-medium",children:"Featured Image URL"}),n.jsx("p",{className:"text-xs text-gray-600",children:"Main image for your blog post used in social media sharing and blog listings."}),n.jsxs("div",{className:"border-t pt-2 mt-2",children:[n.jsx("p",{className:"text-xs font-medium text-blue-600",children:"ðŸ¤– AI Suggestion:"}),n.jsxs("p",{className:"text-xs text-gray-600",children:["Uses your ",n.jsx("strong",{children:"title + content preview"})," to suggest a descriptive filename for your image."]}),n.jsxs("div",{className:"bg-blue-50 p-2 rounded text-xs mt-1",children:[n.jsx("strong",{children:"Example:"}),n.jsx("br",{}),'Title: "IELTS Speaking Practice Guide"',n.jsx("br",{}),'Generated: "ielts-speaking-practice-guide"',n.jsx("br",{}),'Full URL: "https://storage.googleapis.com/.../ielts-speaking-practice-guide"']})]}),n.jsxs("div",{className:"bg-green-50 p-2 rounded text-xs",children:[n.jsx("strong",{children:"Recommended size:"})," 1200x630px",n.jsx("br",{}),n.jsx("strong",{children:"Formats:"})," JPG, PNG, WebP"]})]})})]})]}),n.jsxs(i,{type:"button",variant:"outline",size:"sm",onClick:async()=>{var e,t;const s=Ue.en;if((null==(e=null==s?void 0:s.title)?void 0:e.trim())&&(null==(t=null==s?void 0:s.content)?void 0:t.trim()))try{const e=await lt(s.title,s.content);Me(e),a.success("Image URL suggestion generated!")}catch(n){a.error("Failed to generate image suggestion")}else a.error("Add English title and content first")},className:"flex items-center gap-1",children:[n.jsx(b,{className:"w-3 h-3"}),"AI Suggest"]})]}),n.jsx(y,{value:ze,onChange:e=>Me(e.target.value),placeholder:"https://example.com/image.jpg"})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx("label",{className:"block text-sm font-medium",children:"Status"}),n.jsxs(j,{children:[n.jsx(v,{asChild:!0,children:n.jsx(Z,{className:"w-4 h-4 text-gray-400 hover:text-gray-600 cursor-help"})}),n.jsx(f,{className:"max-w-sm",children:n.jsxs("div",{className:"space-y-2",children:[n.jsx("p",{className:"text-sm font-medium",children:"Post Status"}),n.jsxs("div",{className:"space-y-1 text-xs",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full"}),n.jsx("strong",{children:"Draft:"})," Private - only visible to admins"]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),n.jsx("strong",{children:"Published:"})," Live on website + auto-translated to all languages"]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"w-2 h-2 bg-orange-500 rounded-full"}),n.jsx("strong",{children:"Archived:"})," Hidden but accessible via direct link"]})]})]})})]})]}),n.jsxs("select",{value:Re,onChange:e=>De(e.target.value),className:"w-full px-3 py-2 border rounded-md",children:[n.jsx("option",{value:"draft",children:"Draft"}),n.jsx("option",{value:"published",children:"Published"}),n.jsx("option",{value:"archived",children:"Archived"})]})]})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[n.jsx(b,{className:"w-5 h-5 text-blue-600"}),"AI SEO Content Generator"]}),n.jsxs(j,{children:[n.jsx(v,{asChild:!0,children:n.jsx(Z,{className:"w-4 h-4 text-gray-400 hover:text-gray-600 cursor-help"})}),n.jsx(f,{className:"max-w-sm",children:n.jsxs("div",{className:"space-y-2",children:[n.jsx("p",{className:"text-sm font-medium",children:"AI SEO Content Generator"}),n.jsx("p",{className:"text-xs text-gray-600",children:"Generate comprehensive SEO-optimized content including title, excerpt, meta description, and keywords. Uses advanced AI to analyze your content and create search-engine friendly elements."}),n.jsxs("div",{className:"border-t pt-2 mt-2",children:[n.jsx("p",{className:"text-xs font-medium text-blue-600",children:"ðŸ¤– AI Features:"}),n.jsxs("ul",{className:"text-xs text-gray-600 list-disc list-inside space-y-1",children:[n.jsx("li",{children:"SEO-optimized titles (50-65 chars)"}),n.jsx("li",{children:"Compelling excerpts (max 160 chars)"}),n.jsx("li",{children:"Meta descriptions (120-155 chars)"}),n.jsx("li",{children:"Relevant keywords (5-8 terms)"})]})]})]})})]})]}),n.jsx(o,{className:"border-gray-200",children:n.jsx(d,{className:"p-6",children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"font-medium",children:"Generate Complete SEO Package"}),n.jsx("p",{className:"text-sm text-gray-600",children:"AI analyzes your content and creates SEO-optimized title, excerpt, meta description, and keywords"})]}),n.jsxs(i,{type:"button",variant:"default",size:"sm",onClick:async()=>{var e;const t=Ue.en;if(null==(e=null==t?void 0:t.content)?void 0:e.trim())try{a.loading("Generating comprehensive SEO content...",{id:"seo-generate"});const e=await(async(e,t="IELTS")=>{var s,a;try{const n=`Analyze this blog content and create comprehensive SEO content:\n\nCONTENT TO ANALYZE:\n"${e.substring(0,800)}${e.length>800?"...":""}"\n\nNICHE: ${t} preparation and learning\n\nREQUIREMENTS:\n1. TITLE (50-65 chars): SEO-optimized with primary keyword, power words, solves search intent\n2. EXCERPT (1-2 sentences, max 160 chars): Compelling summary that hooks readers\n3. META DESCRIPTION (120-155 chars): Includes main benefit, call-to-action, and keywords\n4. META KEYWORDS (5-8 keywords): Primary + related + long-tail keywords for ${t}\n\nFormat your response exactly like this:\nTITLE: [Your SEO title here]\nEXCERPT: [Your compelling excerpt]\nMETA_DESC: [Your meta description]\nKEYWORDS: [keyword1, keyword2, keyword3, keyword4, keyword5]`,l=await Y.functions.invoke("translation-service",{body:{text:n,sourceLang:"en",targetLang:"en",includeContext:!1}});if((null==(s=l.data)?void 0:s.success)&&(null==(a=l.data.result)?void 0:a.translation)){const e=l.data.result.translation.trim().split("\n"),t=t=>{const s=e.find(e=>e.startsWith(t));return s?s.replace(t,"").trim():""};return{title:t("TITLE:"),excerpt:t("EXCERPT:"),metaDescription:t("META_DESC:"),metaKeywords:t("KEYWORDS:")}}const r=await rt(e,"",t),i=await st(r,e);return{title:r,excerpt:i,metaDescription:await at(r,e),metaKeywords:await nt(r,e)}}catch(n){console.error("Failed to generate comprehensive SEO content:",n);const s=await rt(e,"",t);return{title:s,excerpt:await st(s,e),metaDescription:await at(s,e),metaKeywords:await nt(s,e)}}})(t.content,"IELTS");Ze("en","title",e.title),Ze("en","excerpt",e.excerpt),Ze("en","meta_description",e.metaDescription),Ze("en","meta_keywords",e.metaKeywords);const s=et(e.title);s&&Fe(s);const n=await lt(e.title,t.content);Me(n),a.dismiss("seo-generate"),a.success("Complete SEO package generated! Title, excerpt, meta description, keywords, slug, and image URL updated.")}catch(s){a.dismiss("seo-generate"),a.error("Failed to generate SEO content")}else a.error("Add English content first")},disabled:!(null==(ae=null==(e=Ue.en)?void 0:e.content)?void 0:ae.trim()),className:"flex items-center gap-2",children:[n.jsx(se,{className:"w-4 h-4"}),"Generate SEO Package"]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-gray-200",children:[n.jsxs("div",{children:[n.jsx("h5",{className:"font-medium text-sm mb-2",children:"Individual Generators"}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs(i,{type:"button",variant:"outline",size:"sm",onClick:async()=>{var e;const t=Ue.en;if(null==(e=null==t?void 0:t.content)?void 0:e.trim())try{const e=await rt(t.content,t.meta_keywords,"IELTS");Ze("en","title",e);const s=et(e);s&&Fe(s),a.success("SEO-optimized title and slug generated!")}catch(s){a.error("Failed to generate SEO title")}else a.error("Add English content first")},disabled:!(null==(le=null==(ne=Ue.en)?void 0:ne.content)?void 0:le.trim()),className:"w-full justify-start text-xs",children:[n.jsx(se,{className:"w-3 h-3 mr-2"}),"Generate SEO Title"]}),n.jsxs(i,{type:"button",variant:"outline",size:"sm",onClick:async()=>{var e,t;const s=Ue.en;if((null==(e=null==s?void 0:s.title)?void 0:e.trim())&&(null==(t=null==s?void 0:s.content)?void 0:t.trim()))try{const e=await st(s.title,s.content);Ze("en","excerpt",e),a.success("Excerpt generated!")}catch(n){a.error("Failed to generate excerpt")}else a.error("Add title and content first")},disabled:!(null==(ie=null==(re=Ue.en)?void 0:re.title)?void 0:ie.trim())||!(null==(oe=null==(ce=Ue.en)?void 0:ce.content)?void 0:oe.trim()),className:"w-full justify-start text-xs",children:[n.jsx(se,{className:"w-3 h-3 mr-2"}),"Generate Excerpt"]})]})]}),n.jsxs("div",{children:[n.jsx("h5",{className:"font-medium text-sm mb-2",children:"Meta Generators"}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs(i,{type:"button",variant:"outline",size:"sm",onClick:async()=>{var e,t;const s=Ue.en;if((null==(e=null==s?void 0:s.title)?void 0:e.trim())&&(null==(t=null==s?void 0:s.content)?void 0:t.trim()))try{const e=await at(s.title,s.content);Ze("en","meta_description",e),a.success("Meta description generated!")}catch(n){a.error("Failed to generate meta description")}else a.error("Add title and content first")},disabled:!(null==(me=null==(de=Ue.en)?void 0:de.title)?void 0:me.trim())||!(null==(ue=null==(xe=Ue.en)?void 0:xe.content)?void 0:ue.trim()),className:"w-full justify-start text-xs",children:[n.jsx(se,{className:"w-3 h-3 mr-2"}),"Generate Meta Description"]}),n.jsxs(i,{type:"button",variant:"outline",size:"sm",onClick:async()=>{var e,t;const s=Ue.en;if((null==(e=null==s?void 0:s.title)?void 0:e.trim())&&(null==(t=null==s?void 0:s.content)?void 0:t.trim()))try{const e=await nt(s.title,s.content);Ze("en","meta_keywords",e),a.success("Meta keywords generated!")}catch(n){a.error("Failed to generate meta keywords")}else a.error("Add title and content first")},disabled:!(null==(he=null==(ge=Ue.en)?void 0:ge.title)?void 0:he.trim())||!(null==(je=null==(pe=Ue.en)?void 0:pe.content)?void 0:je.trim()),className:"w-full justify-start text-xs",children:[n.jsx(se,{className:"w-3 h-3 mr-2"}),"Generate Keywords"]})]})]})]}),n.jsx("div",{className:"bg-blue-50 p-3 rounded-lg",children:n.jsxs("div",{className:"flex items-start gap-2",children:[n.jsx(Z,{className:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"}),n.jsxs("div",{className:"text-xs text-blue-800",children:[n.jsx("strong",{children:"Pro Tip:"}),' Start with content, then use "Generate SEO Package" for a complete optimized setup. Individual generators are useful for fine-tuning specific elements.']})]})})]})})})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("h3",{className:"text-lg font-semibold",children:"Content Editor"}),n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(x,{className:"w-4 h-4 text-gray-600"}),n.jsxs(N,{value:He,onValueChange:Je,children:[n.jsx(w,{className:"w-48",children:n.jsx(k,{})}),n.jsx(E,{children:X.map(e=>{var t,s;const a=Ue[e.code],l=(null==(t=null==a?void 0:a.title)?void 0:t.trim())&&(null==(s=null==a?void 0:a.content)?void 0:s.trim()),r=Ye.has(e.code);return n.jsxs(S,{value:e.code,className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{children:e.flag}),n.jsxs("span",{children:[e.nativeName," (",e.name,")"]}),"en"===e.code&&n.jsx(m,{variant:"default",className:"text-xs ml-2",children:"Primary"})]}),n.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[r&&n.jsx(_,{className:"w-3 h-3 animate-spin text-blue-500"}),!r&&l&&n.jsx(C,{className:"w-3 h-3 text-green-500"}),!r&&!l&&"en"!==e.code&&n.jsx(ee,{className:"w-3 h-3 text-orange-500"})]})]},e.code)})})]})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs(i,{variant:"outline",size:"sm",onClick:()=>{Ue[He]||Be({...Ue,[He]:{language_code:He,title:"",content:"",excerpt:"",meta_description:"",meta_keywords:""}})},disabled:!!Ue[He],children:[n.jsx(c,{className:"w-4 h-4 mr-2"}),"Add Language"]}),n.jsx(i,{variant:"outline",size:"sm",onClick:async()=>{var e,t;try{const s=Ue.en;if(!s||!(null==(e=s.title)?void 0:e.trim())||!(null==(t=s.content)?void 0:t.trim()))return void a.error("Add English title and content first, then auto-translate.");We(!0);const n=X.map(e=>e.code).filter(e=>"en"!==e),l={...Ue};let r=0,i=0,c=0;const o=3;for(let e=0;e<n.length;e+=o){const t=n.slice(e,e+o).map(async e=>{var t,a,n;const o=Ue[e];if((null==(t=null==o?void 0:o.title)?void 0:t.trim())&&(null==(a=null==o?void 0:o.content)?void 0:a.trim()))i++;else try{Ke(t=>new Set([...t,e]));const[t,a]=await Promise.all([it(s.title,"en",e),it(s.content,"en",e)]);if(!t||!a)return console.warn(`Failed to translate ${e} after retries`),void c++;const i=a.replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim(),d=i.slice(0,160),m=i.slice(0,155),x=(null==(n=s.meta_keywords)?void 0:n.trim())?s.meta_keywords:"IELTS, English learning, AI tutor, IELTS Speaking, IELTS Writing";l[e]={id:null==o?void 0:o.id,language_code:e,title:t,content:a,excerpt:d,meta_description:m,meta_keywords:x},r++}catch(d){console.error(`Error translating to ${e}:`,d),c++}finally{Ke(t=>{const s=new Set(t);return s.delete(e),s})}});await Promise.all(t)}Be(l),a.dismiss("translating"),r>0?a.success(`Auto-translated ${r} language${r>1?"s":""} using Gemini 2.5 Flash Lite.`+(i>0?` ${i} skipped (already translated).`:"")+(c>0?` ${c} failed.`:"")):i>0?a.info(`All languages already have translations. ${i} skipped.`):a.error("Failed to translate. Please try again.")}catch(s){console.error("Error in auto-translate:",s),a.dismiss("translating"),a.error(s.message||"Failed to auto-translate. Please try again.")}finally{We(!1)}},disabled:qe||!(null==(fe=null==(ve=Ue.en)?void 0:ve.title)?void 0:fe.trim())||!(null==(be=null==(ye=Ue.en)?void 0:ye.content)?void 0:be.trim()),children:qe?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"w-4 h-4 mr-2 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Translating..."]}):n.jsxs(n.Fragment,{children:[n.jsx(T,{className:"w-4 h-4 mr-2"}),"Auto-Translate All"]})})]})]})]}),(()=>{var e,t;const s=X.find(e=>e.code===He),l=Ue[He],r=Ye.has(He),c=(null==(e=null==l?void 0:l.title)?void 0:e.trim())&&(null==(t=null==l?void 0:l.content)?void 0:t.trim()),x=l||{language_code:He,title:"",content:"",excerpt:"",meta_description:"",meta_keywords:""};return n.jsxs(o,{className:"transition-all duration-200 "+(r?"ring-2 ring-blue-500 bg-blue-50/50":""),children:[n.jsx(h,{children:n.jsxs(p,{className:"text-base flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[s.flag," ",s.nativeName," (",s.name,")","en"===He&&n.jsx(m,{variant:"default",className:"text-xs ml-2",children:"Primary"}),"en"!==He&&!l&&n.jsx(m,{variant:"outline",className:"text-xs ml-2",children:"Not Added"}),"en"!==He&&l&&c&&n.jsx(m,{variant:"default",className:"text-xs ml-2 text-green-700 bg-green-100",children:"Translated"})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[r&&n.jsxs("div",{className:"flex items-center gap-1 text-blue-600",children:[n.jsx(_,{className:"w-4 h-4 animate-spin"}),n.jsx("span",{className:"text-xs",children:"Translating..."})]}),!r&&c&&n.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[n.jsx(C,{className:"w-4 h-4"}),n.jsx("span",{className:"text-xs",children:"Complete"})]}),!r&&!c&&"en"===He&&n.jsxs("div",{className:"flex items-center gap-1 text-red-600",children:[n.jsx(ee,{className:"w-4 h-4"}),n.jsx("span",{className:"text-xs",children:"Required"})]}),!r&&!c&&"en"!==He&&n.jsxs("div",{className:"flex items-center gap-1 text-orange-600",children:[n.jsx(ee,{className:"w-4 h-4"}),n.jsx("span",{className:"text-xs",children:"Not Translated"})]})]})]})}),n.jsxs(d,{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx("label",{className:"block text-sm font-medium",children:"Title"}),n.jsxs(j,{children:[n.jsx(v,{asChild:!0,children:n.jsx(Z,{className:"w-4 h-4 text-gray-400 hover:text-gray-600 cursor-help"})}),n.jsx(f,{className:"max-w-sm",children:n.jsxs("div",{className:"space-y-2",children:[n.jsx("p",{className:"text-sm font-medium",children:"Title"}),n.jsx("p",{className:"text-xs text-gray-600",children:"The main headline of your blog post that appears at the top of the article."}),n.jsx("div",{className:"border-t pt-2 mt-2",children:n.jsxs("p",{className:"text-xs text-orange-600",children:["ðŸ“ ","en"===He?"Primary content - write your main article title here":"Translated from English. Edit as needed for this language."]})})]})})]})]}),n.jsx(y,{value:x.title,onChange:e=>((e,t)=>{if(Ze(e,"title",t),"en"===e&&!Oe){const e=et(t);e&&Fe(e)}})(He,e.target.value),placeholder:"Blog post title",disabled:r})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx("label",{className:"block text-sm font-medium",children:"Content (HTML supported)"}),n.jsxs(j,{children:[n.jsx(v,{asChild:!0,children:n.jsx(Z,{className:"w-4 h-4 text-gray-400 hover:text-gray-600 cursor-help"})}),n.jsx(f,{className:"max-w-sm",children:n.jsxs("div",{className:"space-y-2",children:[n.jsx("p",{className:"text-sm font-medium",children:"Content"}),n.jsx("p",{className:"text-xs text-gray-600",children:"The main body of your blog post. HTML formatting is supported for rich text."}),n.jsx("div",{className:"border-t pt-2 mt-2",children:n.jsxs("p",{className:"text-xs text-orange-600",children:["ðŸ“ ","en"===He?"Primary content - write your full article here":"Auto-translated from English. Edit as needed for this language."]})})]})})]})]}),n.jsx(I,{value:x.content,onChange:e=>Ze(He,"content",e.target.value),placeholder:"Blog post content...",rows:10,className:"font-mono text-sm",disabled:r})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("label",{className:"block text-sm font-medium",children:"Excerpt"}),n.jsxs(j,{children:[n.jsx(v,{asChild:!0,children:n.jsx(Z,{className:"w-4 h-4 text-gray-400 hover:text-gray-600 cursor-help"})}),n.jsx(f,{className:"max-w-sm",children:n.jsxs("div",{className:"space-y-2",children:[n.jsx("p",{className:"text-sm font-medium",children:"Excerpt"}),n.jsx("p",{className:"text-xs text-gray-600",children:"A short summary of your post (max 160 characters) that appears in blog listings and social media previews."}),n.jsxs("div",{className:"border-t pt-2 mt-2",children:[n.jsx("p",{className:"text-xs font-medium text-blue-600",children:"ðŸ¤– AI Generation:"}),n.jsxs("p",{className:"text-xs text-gray-600",children:["Uses your ",n.jsx("strong",{children:"title + first 500 characters of content"})," to create a compelling 1-2 sentence summary."]}),n.jsxs("div",{className:"bg-blue-50 p-2 rounded text-xs mt-1",children:[n.jsx("strong",{children:"Example:"}),n.jsx("br",{}),'Title: "IELTS Speaking Practice Guide"',n.jsx("br",{}),'Content: "Master IELTS speaking with..."',n.jsx("br",{}),'Generated: "Learn effective IELTS speaking strategies with personalized AI feedback and practice tests designed for band 9 success."']})]})]})})]})]}),n.jsxs(i,{type:"button",variant:"outline",size:"sm",onClick:async()=>{var e,t;if((null==(e=x.title)?void 0:e.trim())&&(null==(t=x.content)?void 0:t.trim()))try{const e=await st(x.title,x.content);Ze(He,"excerpt",e),a.success("Excerpt generated!")}catch(s){a.error("Failed to generate excerpt")}else a.error("Add title and content first")},disabled:r,className:"flex items-center gap-1",children:[n.jsx(se,{className:"w-3 h-3"}),"AI Generate"]})]}),n.jsx(I,{value:x.excerpt,onChange:e=>Ze(He,"excerpt",e.target.value),placeholder:"Short excerpt...",rows:3,disabled:r})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("label",{className:"block text-sm font-medium",children:"Meta Description"}),n.jsxs(j,{children:[n.jsx(v,{asChild:!0,children:n.jsx(Z,{className:"w-4 h-4 text-gray-400 hover:text-gray-600 cursor-help"})}),n.jsx(f,{className:"max-w-sm",children:n.jsxs("div",{className:"space-y-2",children:[n.jsx("p",{className:"text-sm font-medium",children:"Meta Description"}),n.jsx("p",{className:"text-xs text-gray-600",children:"SEO description (max 155 characters) that appears in Google search results under your title."}),n.jsxs("div",{className:"border-t pt-2 mt-2",children:[n.jsx("p",{className:"text-xs font-medium text-blue-600",children:"ðŸ¤– AI Generation:"}),n.jsxs("p",{className:"text-xs text-gray-600",children:["Uses your ",n.jsx("strong",{children:"title + first 300 characters of content"})," to create SEO-optimized copy that includes keywords and compelling benefits."]}),n.jsxs("div",{className:"bg-blue-50 p-2 rounded text-xs mt-1",children:[n.jsx("strong",{children:"Example:"}),n.jsx("br",{}),'Title: "IELTS Speaking Practice Guide"',n.jsx("br",{}),'Generated: "Improve your IELTS Speaking score with AI-powered practice tests, instant feedback, and personalized coaching. Join 50,000+ students achieving band 9 success."']})]})]})})]})]}),n.jsxs(i,{type:"button",variant:"outline",size:"sm",onClick:async()=>{var e,t;if((null==(e=x.title)?void 0:e.trim())&&(null==(t=x.content)?void 0:t.trim()))try{const e=await at(x.title,x.content);Ze(He,"meta_description",e),a.success("Meta description generated!")}catch(s){a.error("Failed to generate meta description")}else a.error("Add title and content first")},disabled:r,className:"flex items-center gap-1",children:[n.jsx(se,{className:"w-3 h-3"}),"AI Generate"]})]}),n.jsx(I,{value:x.meta_description,onChange:e=>Ze(He,"meta_description",e.target.value),placeholder:"SEO meta description...",rows:2,disabled:r})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("label",{className:"block text-sm font-medium",children:"Meta Keywords"}),n.jsxs(j,{children:[n.jsx(v,{asChild:!0,children:n.jsx(Z,{className:"w-4 h-4 text-gray-400 hover:text-gray-600 cursor-help"})}),n.jsx(f,{className:"max-w-sm",children:n.jsxs("div",{className:"space-y-2",children:[n.jsx("p",{className:"text-sm font-medium",children:"Meta Keywords"}),n.jsx("p",{className:"text-xs text-gray-600",children:"Comma-separated keywords (5-8 total) that help search engines understand your content topic."}),n.jsxs("div",{className:"border-t pt-2 mt-2",children:[n.jsx("p",{className:"text-xs font-medium text-blue-600",children:"ðŸ¤– AI Generation:"}),n.jsxs("p",{className:"text-xs text-gray-600",children:["Uses your ",n.jsx("strong",{children:"title + first 400 characters of content"})," to generate relevant keywords including main topic, related terms, and long-tail phrases."]}),n.jsxs("div",{className:"bg-blue-50 p-2 rounded text-xs mt-1",children:[n.jsx("strong",{children:"Example:"}),n.jsx("br",{}),'Title: "IELTS Speaking Practice Guide"',n.jsx("br",{}),'Generated: "IELTS Speaking, speaking practice, AI tutor, IELTS preparation, band score improvement, English fluency, speaking test tips, IELTS coaching"']})]})]})})]})]}),n.jsxs(i,{type:"button",variant:"outline",size:"sm",onClick:async()=>{var e,t;if((null==(e=x.title)?void 0:e.trim())&&(null==(t=x.content)?void 0:t.trim()))try{const e=await nt(x.title,x.content);Ze(He,"meta_keywords",e),a.success("Meta keywords generated!")}catch(s){a.error("Failed to generate meta keywords")}else a.error("Add title and content first")},disabled:r,className:"flex items-center gap-1",children:[n.jsx(se,{className:"w-3 h-3"}),"AI Generate"]})]}),n.jsx(y,{value:x.meta_keywords,onChange:e=>Ze(He,"meta_keywords",e.target.value),placeholder:"keyword1, keyword2, keyword3",disabled:r})]}),"en"!==He&&l&&n.jsx("div",{className:"pt-4 border-t",children:n.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>{const e={...Ue};delete e[He],Be(e),Je("en")},disabled:r,className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[n.jsx(L,{className:"w-4 h-4 mr-2"}),"Remove ",s.nativeName," Translation"]})})]})]},He)})(),"en"===He&&1===Object.keys(Ue).length&&(null==(we=null==(Ne=Ue.en)?void 0:Ne.title)?void 0:we.trim())&&(null==(Ee=null==(ke=Ue.en)?void 0:ke.content)?void 0:Ee.trim())&&n.jsx(o,{className:"border-dashed border-2 border-gray-300",children:n.jsxs(d,{className:"p-8 text-center",children:[n.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[n.jsx(x,{className:"w-8 h-8 text-gray-400"}),n.jsx(T,{className:"w-8 h-8 text-gray-400"})]}),n.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Ready for Global Publishing"}),n.jsxs("p",{className:"text-gray-600 mb-4",children:["Your English content is complete! When you publish this post, it will be automatically translated to all ",X.length-1," supported languages using Gemini 2.5 Flash Lite."]}),n.jsxs("div",{className:"flex flex-wrap gap-1 justify-center",children:[X.filter(e=>"en"!==e.code).slice(0,12).map(e=>n.jsxs(m,{variant:"outline",className:"text-xs",children:[e.flag," ",e.nativeName]},e.code)),X.length>13&&n.jsxs(m,{variant:"outline",className:"text-xs",children:["+",X.length-13," more"]})]})]})}),Object.keys(Ue).length>1&&n.jsx(o,{className:"bg-gray-50",children:n.jsx(d,{className:"p-4",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(T,{className:"w-4 h-4 text-gray-600"}),n.jsx("span",{className:"text-sm font-medium",children:"Translation Summary"})]}),n.jsxs("div",{className:"flex flex-wrap gap-1",children:[X.filter(e=>{var t,s,a,n;return(null==(s=null==(t=Ue[e.code])?void 0:t.title)?void 0:s.trim())&&(null==(n=null==(a=Ue[e.code])?void 0:a.content)?void 0:n.trim())}).map(e=>n.jsxs(m,{variant:"default",className:"text-xs bg-green-100 text-green-800",children:[e.flag," ",e.nativeName]},e.code)),X.filter(e=>{var t,s,a,n;return!(null==(s=null==(t=Ue[e.code])?void 0:t.title)?void 0:s.trim())||!(null==(n=null==(a=Ue[e.code])?void 0:a.content)?void 0:n.trim())}).filter(e=>"en"!==e.code).slice(0,3).map(e=>n.jsxs(m,{variant:"outline",className:"text-xs",children:[e.flag," ",e.nativeName]},e.code)),X.filter(e=>{var t,s,a,n;return!(null==(s=null==(t=Ue[e.code])?void 0:t.title)?void 0:s.trim())||!(null==(n=null==(a=Ue[e.code])?void 0:a.content)?void 0:n.trim())}).filter(e=>"en"!==e.code).length>3&&n.jsxs(m,{variant:"outline",className:"text-xs",children:["+",X.filter(e=>{var t,s,a,n;return!(null==(s=null==(t=Ue[e.code])?void 0:t.title)?void 0:s.trim())||!(null==(n=null==(a=Ue[e.code])?void 0:a.content)?void 0:n.trim())}).filter(e=>"en"!==e.code).length-3," more"]})]})]})})})]}),n.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[n.jsx(i,{variant:"outline",onClick:Ve,children:"Cancel"}),n.jsxs(i,{onClick:async()=>{try{if(!Oe.trim())return void a.error("Slug is required");if(!Ue.en||!Ue.en.title.trim()||!Ue.en.content.trim())return void a.error("English title and content are required");let e;if($e){const{data:t,error:s}=await Y.from("blog_posts").insert({slug:Oe,featured_image_url:ze||null,status:Re,published_at:"published"===Re?(new Date).toISOString():null}).select().single();if(s)throw s;e=t.id}else{if(!Ie)return void a.error("Invalid state");{const{error:t}=await Y.from("blog_posts").update({slug:Oe,featured_image_url:ze||null,status:Re,published_at:"published"!==Re||Ie.published_at?Ie.published_at:(new Date).toISOString()}).eq("id",Ie.id);if(t)throw t;e=Ie.id}}"published"===Re&&await(async e=>{var t,s;try{const n=Ue.en;if(!n||!(null==(t=n.title)?void 0:t.trim())||!(null==(s=n.content)?void 0:s.trim()))return;const l=X.map(e=>e.code).filter(e=>"en"!==e),{data:r}=await Y.from("blog_post_translations").select("language_code").eq("blog_post_id",e),i=(null==r?void 0:r.map(e=>e.language_code))||[],c=l.filter(e=>!i.includes(e));if(0===c.length)return;console.log(`Auto-translating ${c.length} languages for published post...`);let o=0;const d=c.length;a.loading(`Auto-translating languages (0/${d})...`,{id:"auto-translate"});const m=3,x=[];for(let t=0;t<c.length;t+=m){const s=c.slice(t,t+m).map(async t=>{var s;try{a.loading(`Auto-translating languages (${o}/${d})...`,{id:"auto-translate"});const[l,r]=await Promise.all([it(n.title,"en",t),it(n.content,"en",t)]);if(!l||!r)return console.warn(`Failed to translate ${t} after retries`),x.push(null),null;const i=r.replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim(),c=i.slice(0,160),m=i.slice(0,155),u=(null==(s=n.meta_keywords)?void 0:s.trim())?n.meta_keywords:"IELTS, English learning, AI tutor, IELTS Speaking, IELTS Writing",{error:g}=await Y.from("blog_post_translations").insert({blog_post_id:e,language_code:t,title:l,content:r,excerpt:c,meta_description:m,meta_keywords:u});return g?(console.error(`Failed to save translation for ${t}:`,g),x.push(null),null):(x.push(t),o++,t)}catch(l){return console.error(`Error translating to ${t}:`,l),x.push(null),null}});await Promise.all(s)}const u=x.filter(e=>null!==e);if(a.dismiss("auto-translate"),u.length>0&&(console.log(`Successfully auto-translated ${u.length} languages: ${u.join(", ")}`),a.success(`Auto-published in ${u.length} additional languages using Gemini 2.5 Flash Lite.`)),u.length<c.length){const e=c.length-u.length;a.warning(`${e} translations failed. You can translate them manually later.`)}}catch(n){console.error("Error in auto-translate on publish:",n),a.dismiss("auto-translate"),a.warning("Post published, but some translations may have failed. Check the post and translate manually if needed.")}})(e);for(const t of Object.keys(Ue)){const s=Ue[t];if(s.id){const{error:e}=await Y.from("blog_post_translations").update({title:s.title,content:s.content,excerpt:s.excerpt||null,meta_description:s.meta_description||null,meta_keywords:s.meta_keywords||null}).eq("id",s.id);if(e)throw e}else{const{error:a}=await Y.from("blog_post_translations").insert({blog_post_id:e,language_code:t,title:s.title,content:s.content,excerpt:s.excerpt||null,meta_description:s.meta_description||null,meta_keywords:s.meta_keywords||null});if(a)throw a}}a.success($e?"Blog post created successfully":"Blog post updated successfully"),Ve(),Xe()}catch(e){console.error("Error saving blog post:",e),a.error(e.message||"Failed to save blog post")}},children:[n.jsx(te,{className:"w-4 h-4 mr-2"}),$e?"Create Post":"Save Changes"]})]})]})]})})]})]})})};export{ae as default};
