import{c as e,u as s,h as l,r as i,j as a,I as r,S as t,p as n,q as c,s as d,t as o,B as m,P as h,C as x,a as u,e as p,af as g,ao as j,D as v,m as f,n as b,o as N,R as _,T as w,bs as y,l as C,N as E,E as S}from"./index-x_G9xLa2.js";import{A as T}from"./AdminLayout-BDgQJlLk.js";import{T as k,a as F,b as A,c as P}from"./tabs-Cs2rntBY.js";import{S as L}from"./switch-ByaescBY.js";import{s as D}from"./supabase-DWL4C3fA.js";import{D as q,a as B,b as I,c as M}from"./dropdown-menu-AACOFhIK.js";import{S as G}from"./search-akhynhvE.js";import{S as V}from"./square-pen-DP3RrITH.js";import{T as z}from"./trash-2-BByKM9fF.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=e("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),O={beginner:"bg-emerald-100 text-emerald-700",intermediate:"bg-blue-100 text-blue-700",advanced:"bg-purple-100 text-purple-700"},U=()=>{const e=s(),{toast:C}=l(),[E,S]=i.useState([]),[q,B]=i.useState(!0),[I,M]=i.useState(""),[V,z]=i.useState("all"),[$,O]=i.useState(!1),[U,R]=i.useState(null),[H,K]=i.useState({slug:"",level:"beginner",topic_order:1,icon:"book",color:"blue",is_published:!1,title_en:"",description_en:""});i.useEffect(()=>{Q()},[]);const Q=async()=>{B(!0);try{const{data:e,error:s}=await D.from("grammar_topics").select("\n          *,\n          grammar_topic_translations(language_code, title, description)\n        ").order("level").order("topic_order");if(s)throw s;const l=await Promise.all((e||[]).map(async e=>{const[s,l]=await Promise.all([D.from("grammar_exercises").select("id",{count:"exact",head:!0}).eq("topic_id",e.id),D.from("grammar_lessons").select("id",{count:"exact",head:!0}).eq("topic_id",e.id)]);return{...e,translations:e.grammar_topic_translations||[],exercise_count:s.count||0,lesson_count:l.count||0}}));S(l)}catch(e){console.error("Error loading topics:",e),C({title:"Error",description:"Failed to load grammar topics",variant:"destructive"})}finally{B(!1)}},W=async e=>{if(confirm("Are you sure you want to delete this topic? This will also delete all lessons and exercises."))try{const{error:s}=await D.from("grammar_topics").delete().eq("id",e);if(s)throw s;C({title:"Success",description:"Grammar topic deleted successfully"}),Q()}catch(s){console.error("Error deleting topic:",s),C({title:"Error",description:s.message||"Failed to delete topic",variant:"destructive"})}},X=async e=>{try{const{error:s}=await D.from("grammar_topics").update({is_published:!e.is_published}).eq("id",e.id);if(s)throw s;C({title:"Success",description:`Topic ${e.is_published?"unpublished":"published"} successfully`}),Q()}catch(s){C({title:"Error",description:s.message||"Failed to update topic",variant:"destructive"})}},Y=()=>{K({slug:"",level:"beginner",topic_order:1,icon:"book",color:"blue",is_published:!1,title_en:"",description_en:""})},Z=e=>{const s=e.translations.find(e=>"en"===e.language_code);K({slug:e.slug,level:e.level,topic_order:e.topic_order,icon:e.icon,color:e.color,is_published:e.is_published,title_en:(null==s?void 0:s.title)||"",description_en:(null==s?void 0:s.description)||""}),R(e)},ee=E.filter(e=>{const s=e.slug.toLowerCase().includes(I.toLowerCase())||e.translations.some(e=>e.title.toLowerCase().includes(I.toLowerCase())),l="all"===V||e.level===V;return s&&l}),se={beginner:ee.filter(e=>"beginner"===e.level),intermediate:ee.filter(e=>"intermediate"===e.level),advanced:ee.filter(e=>"advanced"===e.level)},le=e=>{const s=e.translations.find(e=>"en"===e.language_code);return(null==s?void 0:s.title)||e.slug.replace(/-/g," ")};return a.jsx(T,{title:"Grammar Management",showBackButton:!0,children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between",children:[a.jsxs("div",{className:"flex gap-2 flex-1",children:[a.jsxs("div",{className:"relative flex-1 max-w-md",children:[a.jsx(G,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),a.jsx(r,{placeholder:"Search topics...",value:I,onChange:e=>M(e.target.value),className:"pl-10"})]}),a.jsxs(t,{value:V,onValueChange:z,children:[a.jsx(n,{className:"w-[150px]",children:a.jsx(c,{placeholder:"Filter level"})}),a.jsxs(d,{children:[a.jsx(o,{value:"all",children:"All Levels"}),a.jsx(o,{value:"beginner",children:"Beginner"}),a.jsx(o,{value:"intermediate",children:"Intermediate"}),a.jsx(o,{value:"advanced",children:"Advanced"})]})]})]}),a.jsxs(m,{onClick:()=>O(!0),children:[a.jsx(h,{className:"w-4 h-4 mr-2"}),"Add Topic"]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4",children:[a.jsx(x,{children:a.jsx(u,{className:"p-4",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center",children:a.jsx(p,{className:"w-5 h-5 text-gray-600"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-2xl font-bold",children:E.length}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Topics"})]})]})})}),a.jsx(x,{children:a.jsx(u,{className:"p-4",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-lg bg-emerald-100 flex items-center justify-center",children:a.jsx(g,{className:"w-5 h-5 text-emerald-600"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-2xl font-bold",children:se.beginner.length}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Beginner"})]})]})})}),a.jsx(x,{children:a.jsx(u,{className:"p-4",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:a.jsx(j,{className:"w-5 h-5 text-blue-600"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-2xl font-bold",children:se.intermediate.length}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Intermediate"})]})]})})}),a.jsx(x,{children:a.jsx(u,{className:"p-4",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:a.jsx(p,{className:"w-5 h-5 text-purple-600"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-2xl font-bold",children:se.advanced.length}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Advanced"})]})]})})})]}),a.jsxs(k,{defaultValue:"all",children:[a.jsxs(F,{children:[a.jsxs(A,{value:"all",children:["All (",ee.length,")"]}),a.jsxs(A,{value:"beginner",children:["Beginner (",se.beginner.length,")"]}),a.jsxs(A,{value:"intermediate",children:["Intermediate (",se.intermediate.length,")"]}),a.jsxs(A,{value:"advanced",children:["Advanced (",se.advanced.length,")"]})]}),a.jsx(P,{value:"all",className:"mt-4",children:a.jsx(J,{topics:ee,getTitle:le,onEdit:Z,onDelete:W,onTogglePublish:X,onManage:s=>e(`/admin/grammar/${s.id}`)})}),["beginner","intermediate","advanced"].map(s=>a.jsx(P,{value:s,className:"mt-4",children:a.jsx(J,{topics:se[s],getTitle:le,onEdit:Z,onDelete:W,onTogglePublish:X,onManage:s=>e(`/admin/grammar/${s.id}`)})},s))]}),a.jsx(v,{open:$||!!U,onOpenChange:e=>{e||(O(!1),R(null),Y())},children:a.jsxs(f,{className:"sm:max-w-lg",children:[a.jsx(b,{children:a.jsx(N,{children:U?"Edit Topic":"Create New Topic"})}),a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(_,{htmlFor:"title",children:"Title (English)"}),a.jsx(r,{id:"title",value:H.title_en,onChange:e=>K({...H,title_en:e.target.value}),placeholder:"Present Simple"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(_,{htmlFor:"slug",children:"Slug"}),a.jsx(r,{id:"slug",value:H.slug,onChange:e=>K({...H,slug:e.target.value.toLowerCase().replace(/\s+/g,"-")}),placeholder:"present-simple"})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(_,{htmlFor:"description",children:"Description (English)"}),a.jsx(w,{id:"description",value:H.description_en,onChange:e=>K({...H,description_en:e.target.value}),placeholder:"Learn how to use present simple tense...",rows:3})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(_,{htmlFor:"level",children:"Level"}),a.jsxs(t,{value:H.level,onValueChange:e=>K({...H,level:e}),children:[a.jsx(n,{children:a.jsx(c,{})}),a.jsxs(d,{children:[a.jsx(o,{value:"beginner",children:"Beginner"}),a.jsx(o,{value:"intermediate",children:"Intermediate"}),a.jsx(o,{value:"advanced",children:"Advanced"})]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(_,{htmlFor:"order",children:"Order"}),a.jsx(r,{id:"order",type:"number",min:1,value:H.topic_order,onChange:e=>K({...H,topic_order:parseInt(e.target.value)||1})})]})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(_,{htmlFor:"published",children:"Published"}),a.jsx(L,{id:"published",checked:H.is_published,onCheckedChange:e=>K({...H,is_published:e})})]})]}),a.jsxs(y,{children:[a.jsx(m,{variant:"outline",onClick:()=>{O(!1),R(null),Y()},children:"Cancel"}),a.jsx(m,{onClick:U?async()=>{if(U)try{const{error:e}=await D.from("grammar_topics").update({slug:H.slug,level:H.level,topic_order:H.topic_order,icon:H.icon,color:H.color,is_published:H.is_published}).eq("id",U.id);if(e)throw e;const{error:s}=await D.from("grammar_topic_translations").upsert({topic_id:U.id,language_code:"en",title:H.title_en,description:H.description_en},{onConflict:"topic_id,language_code"});if(s)throw s;C({title:"Success",description:"Grammar topic updated successfully"}),R(null),Y(),Q()}catch(e){console.error("Error updating topic:",e),C({title:"Error",description:e.message||"Failed to update topic",variant:"destructive"})}}:async()=>{try{const{data:e,error:s}=await D.from("grammar_topics").insert({slug:H.slug,level:H.level,topic_order:H.topic_order,icon:H.icon,color:H.color,is_published:H.is_published}).select().single();if(s)throw s;const{error:l}=await D.from("grammar_topic_translations").insert({topic_id:e.id,language_code:"en",title:H.title_en,description:H.description_en});if(l)throw l;C({title:"Success",description:"Grammar topic created successfully"}),O(!1),Y(),Q()}catch(e){console.error("Error creating topic:",e),C({title:"Error",description:e.message||"Failed to create topic",variant:"destructive"})}},children:U?"Update":"Create"})]})]})})]})})},J=({topics:e,getTitle:s,onEdit:l,onDelete:i,onTogglePublish:r,onManage:t})=>0===e.length?a.jsxs(x,{className:"p-8 text-center",children:[a.jsx(p,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Topics Found"}),a.jsx("p",{className:"text-muted-foreground",children:"Create your first grammar topic to get started."})]}):a.jsx("div",{className:"space-y-3",children:e.map(e=>a.jsx(x,{className:"hover:shadow-md transition-shadow",children:a.jsx(u,{className:"p-4",children:a.jsxs("div",{className:"flex items-center justify-between gap-4",children:[a.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[a.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center "+("beginner"===e.level?"bg-emerald-100":"intermediate"===e.level?"bg-blue-100":"bg-purple-100"),children:a.jsx(p,{className:"w-5 h-5 "+("beginner"===e.level?"text-emerald-600":"intermediate"===e.level?"text-blue-600":"text-purple-600")})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("h3",{className:"font-semibold truncate",children:s(e)}),a.jsx(C,{className:O[e.level],variant:"secondary",children:e.level}),e.is_published?a.jsx(C,{className:"bg-emerald-100 text-emerald-700",children:"Published"}):a.jsx(C,{variant:"secondary",children:"Draft"})]}),a.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.lesson_count," lesson(s) Â· ",e.exercise_count," exercise(s)"]})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(m,{variant:"outline",size:"sm",onClick:()=>t(e),children:"Manage"}),a.jsxs(q,{children:[a.jsx(B,{asChild:!0,children:a.jsx(m,{variant:"ghost",size:"sm",children:a.jsx($,{className:"w-4 h-4"})})}),a.jsxs(I,{align:"end",children:[a.jsxs(M,{onClick:()=>l(e),children:[a.jsx(V,{className:"w-4 h-4 mr-2"}),"Edit"]}),a.jsx(M,{onClick:()=>r(e),children:e.is_published?a.jsxs(a.Fragment,{children:[a.jsx(E,{className:"w-4 h-4 mr-2"}),"Unpublish"]}):a.jsxs(a.Fragment,{children:[a.jsx(S,{className:"w-4 h-4 mr-2"}),"Publish"]})}),a.jsxs(M,{onClick:()=>i(e.id),className:"text-red-600",children:[a.jsx(z,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})]})]})})},e.id))});export{U as default};
