import{u as e,r as s,j as l}from"./vendor-react-rLLBBC7n.js";import{A as i}from"./AdminLayout-DwaN-V0p.js";import{d as a,s as r,I as t,S as n,i as c,j as d,k as o,l as m,B as h,C as x,a as u,D as p,f as g,g as j,h as v,L as f,T as b,X as N,e as _}from"./index-BDl0jLJK.js";import{T as w,a as y,b as C,c as E}from"./tabs-CFW1rRMF.js";import{S as T}from"./switch-JnklLIAd.js";import{D as S,a as F,b as k,c as A}from"./dropdown-menu-DF6eZyHV.js";import{aW as L,av as P,ao as D,an as B,K as I,cw as M,aX as q,aM as G,aN as V,aY as $}from"./vendor-ui-BGi_EvHx.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-charts-0DeywwxG.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";const z={beginner:"bg-emerald-100 text-emerald-700",intermediate:"bg-blue-100 text-blue-700",advanced:"bg-purple-100 text-purple-700"},O=()=>{const _=e(),{toast:S}=a(),[F,k]=s.useState([]),[A,M]=s.useState(!0),[q,G]=s.useState(""),[V,$]=s.useState("all"),[z,O]=s.useState(!1),[X,K]=s.useState(null),[W,Y]=s.useState({slug:"",level:"beginner",topic_order:1,icon:"book",color:"blue",is_published:!1,title_en:"",description_en:""});s.useEffect(()=>{H()},[]);const H=async()=>{M(!0);try{const{data:e,error:s}=await r.from("grammar_topics").select("\n          *,\n          grammar_topic_translations(language_code, title, description)\n        ").order("level").order("topic_order");if(s)throw s;const l=await Promise.all((e||[]).map(async e=>{const[s,l]=await Promise.all([r.from("grammar_exercises").select("id",{count:"exact",head:!0}).eq("topic_id",e.id),r.from("grammar_lessons").select("id",{count:"exact",head:!0}).eq("topic_id",e.id)]);return{...e,translations:e.grammar_topic_translations||[],exercise_count:s.count||0,lesson_count:l.count||0}}));k(l)}catch(e){console.error("Error loading topics:",e),S({title:"Error",description:"Failed to load grammar topics",variant:"destructive"})}finally{M(!1)}},J=async e=>{if(confirm("Are you sure you want to delete this topic? This will also delete all lessons and exercises."))try{const{error:s}=await r.from("grammar_topics").delete().eq("id",e);if(s)throw s;S({title:"Success",description:"Grammar topic deleted successfully"}),H()}catch(s){console.error("Error deleting topic:",s),S({title:"Error",description:s.message||"Failed to delete topic",variant:"destructive"})}},Q=async e=>{try{const{error:s}=await r.from("grammar_topics").update({is_published:!e.is_published}).eq("id",e.id);if(s)throw s;S({title:"Success",description:`Topic ${e.is_published?"unpublished":"published"} successfully`}),H()}catch(s){S({title:"Error",description:s.message||"Failed to update topic",variant:"destructive"})}},R=()=>{Y({slug:"",level:"beginner",topic_order:1,icon:"book",color:"blue",is_published:!1,title_en:"",description_en:""})},Z=e=>{const s=e.translations.find(e=>"en"===e.language_code);Y({slug:e.slug,level:e.level,topic_order:e.topic_order,icon:e.icon,color:e.color,is_published:e.is_published,title_en:(null==s?void 0:s.title)||"",description_en:(null==s?void 0:s.description)||""}),K(e)},ee=F.filter(e=>{const s=e.slug.toLowerCase().includes(q.toLowerCase())||e.translations.some(e=>e.title.toLowerCase().includes(q.toLowerCase())),l="all"===V||e.level===V;return s&&l}),se={beginner:ee.filter(e=>"beginner"===e.level),intermediate:ee.filter(e=>"intermediate"===e.level),advanced:ee.filter(e=>"advanced"===e.level)},le=e=>{const s=e.translations.find(e=>"en"===e.language_code);return(null==s?void 0:s.title)||e.slug.replace(/-/g," ")};return l.jsx(i,{title:"Grammar Management",showBackButton:!0,children:l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between",children:[l.jsxs("div",{className:"flex gap-2 flex-1",children:[l.jsxs("div",{className:"relative flex-1 max-w-md",children:[l.jsx(L,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),l.jsx(t,{placeholder:"Search topics...",value:q,onChange:e=>G(e.target.value),className:"pl-10"})]}),l.jsxs(n,{value:V,onValueChange:$,children:[l.jsx(c,{className:"w-[150px]",children:l.jsx(d,{placeholder:"Filter level"})}),l.jsxs(o,{children:[l.jsx(m,{value:"all",children:"All Levels"}),l.jsx(m,{value:"beginner",children:"Beginner"}),l.jsx(m,{value:"intermediate",children:"Intermediate"}),l.jsx(m,{value:"advanced",children:"Advanced"})]})]})]}),l.jsxs(h,{onClick:()=>O(!0),children:[l.jsx(P,{className:"w-4 h-4 mr-2"}),"Add Topic"]})]}),l.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4",children:[l.jsx(x,{children:l.jsx(u,{className:"p-4",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center",children:l.jsx(D,{className:"w-5 h-5 text-gray-600"})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-2xl font-bold",children:F.length}),l.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Topics"})]})]})})}),l.jsx(x,{children:l.jsx(u,{className:"p-4",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"w-10 h-10 rounded-lg bg-emerald-100 flex items-center justify-center",children:l.jsx(B,{className:"w-5 h-5 text-emerald-600"})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-2xl font-bold",children:se.beginner.length}),l.jsx("p",{className:"text-sm text-muted-foreground",children:"Beginner"})]})]})})}),l.jsx(x,{children:l.jsx(u,{className:"p-4",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:l.jsx(I,{className:"w-5 h-5 text-blue-600"})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-2xl font-bold",children:se.intermediate.length}),l.jsx("p",{className:"text-sm text-muted-foreground",children:"Intermediate"})]})]})})}),l.jsx(x,{children:l.jsx(u,{className:"p-4",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:l.jsx(D,{className:"w-5 h-5 text-purple-600"})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-2xl font-bold",children:se.advanced.length}),l.jsx("p",{className:"text-sm text-muted-foreground",children:"Advanced"})]})]})})})]}),l.jsxs(w,{defaultValue:"all",children:[l.jsxs(y,{children:[l.jsxs(C,{value:"all",children:["All (",ee.length,")"]}),l.jsxs(C,{value:"beginner",children:["Beginner (",se.beginner.length,")"]}),l.jsxs(C,{value:"intermediate",children:["Intermediate (",se.intermediate.length,")"]}),l.jsxs(C,{value:"advanced",children:["Advanced (",se.advanced.length,")"]})]}),l.jsx(E,{value:"all",className:"mt-4",children:l.jsx(U,{topics:ee,getTitle:le,onEdit:Z,onDelete:J,onTogglePublish:Q,onManage:e=>_(`/admin/grammar/${e.id}`)})}),["beginner","intermediate","advanced"].map(e=>l.jsx(E,{value:e,className:"mt-4",children:l.jsx(U,{topics:se[e],getTitle:le,onEdit:Z,onDelete:J,onTogglePublish:Q,onManage:e=>_(`/admin/grammar/${e.id}`)})},e))]}),l.jsx(p,{open:z||!!X,onOpenChange:e=>{e||(O(!1),K(null),R())},children:l.jsxs(g,{className:"sm:max-w-lg",children:[l.jsx(j,{children:l.jsx(v,{children:X?"Edit Topic":"Create New Topic"})}),l.jsxs("div",{className:"space-y-4 py-4",children:[l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(f,{htmlFor:"title",children:"Title (English)"}),l.jsx(t,{id:"title",value:W.title_en,onChange:e=>Y({...W,title_en:e.target.value}),placeholder:"Present Simple"})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(f,{htmlFor:"slug",children:"Slug"}),l.jsx(t,{id:"slug",value:W.slug,onChange:e=>Y({...W,slug:e.target.value.toLowerCase().replace(/\s+/g,"-")}),placeholder:"present-simple"})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(f,{htmlFor:"description",children:"Description (English)"}),l.jsx(b,{id:"description",value:W.description_en,onChange:e=>Y({...W,description_en:e.target.value}),placeholder:"Learn how to use present simple tense...",rows:3})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(f,{htmlFor:"level",children:"Level"}),l.jsxs(n,{value:W.level,onValueChange:e=>Y({...W,level:e}),children:[l.jsx(c,{children:l.jsx(d,{})}),l.jsxs(o,{children:[l.jsx(m,{value:"beginner",children:"Beginner"}),l.jsx(m,{value:"intermediate",children:"Intermediate"}),l.jsx(m,{value:"advanced",children:"Advanced"})]})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(f,{htmlFor:"order",children:"Order"}),l.jsx(t,{id:"order",type:"number",min:1,value:W.topic_order,onChange:e=>Y({...W,topic_order:parseInt(e.target.value)||1})})]})]}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx(f,{htmlFor:"published",children:"Published"}),l.jsx(T,{id:"published",checked:W.is_published,onCheckedChange:e=>Y({...W,is_published:e})})]})]}),l.jsxs(N,{children:[l.jsx(h,{variant:"outline",onClick:()=>{O(!1),K(null),R()},children:"Cancel"}),l.jsx(h,{onClick:X?async()=>{if(X)try{const{error:e}=await r.from("grammar_topics").update({slug:W.slug,level:W.level,topic_order:W.topic_order,icon:W.icon,color:W.color,is_published:W.is_published}).eq("id",X.id);if(e)throw e;const{error:s}=await r.from("grammar_topic_translations").upsert({topic_id:X.id,language_code:"en",title:W.title_en,description:W.description_en},{onConflict:"topic_id,language_code"});if(s)throw s;S({title:"Success",description:"Grammar topic updated successfully"}),K(null),R(),H()}catch(e){console.error("Error updating topic:",e),S({title:"Error",description:e.message||"Failed to update topic",variant:"destructive"})}}:async()=>{try{const{data:e,error:s}=await r.from("grammar_topics").insert({slug:W.slug,level:W.level,topic_order:W.topic_order,icon:W.icon,color:W.color,is_published:W.is_published}).select().single();if(s)throw s;const{error:l}=await r.from("grammar_topic_translations").insert({topic_id:e.id,language_code:"en",title:W.title_en,description:W.description_en});if(l)throw l;S({title:"Success",description:"Grammar topic created successfully"}),O(!1),R(),H()}catch(e){console.error("Error creating topic:",e),S({title:"Error",description:e.message||"Failed to create topic",variant:"destructive"})}},children:X?"Update":"Create"})]})]})})]})})},U=({topics:e,getTitle:s,onEdit:i,onDelete:a,onTogglePublish:r,onManage:t})=>0===e.length?l.jsxs(x,{className:"p-8 text-center",children:[l.jsx(D,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),l.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Topics Found"}),l.jsx("p",{className:"text-muted-foreground",children:"Create your first grammar topic to get started."})]}):l.jsx("div",{className:"space-y-3",children:e.map(e=>l.jsx(x,{className:"hover:shadow-md transition-shadow",children:l.jsx(u,{className:"p-4",children:l.jsxs("div",{className:"flex items-center justify-between gap-4",children:[l.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[l.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center "+("beginner"===e.level?"bg-emerald-100":"intermediate"===e.level?"bg-blue-100":"bg-purple-100"),children:l.jsx(D,{className:"w-5 h-5 "+("beginner"===e.level?"text-emerald-600":"intermediate"===e.level?"text-blue-600":"text-purple-600")})}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("h3",{className:"font-semibold truncate",children:s(e)}),l.jsx(_,{className:z[e.level],variant:"secondary",children:e.level}),e.is_published?l.jsx(_,{className:"bg-emerald-100 text-emerald-700",children:"Published"}):l.jsx(_,{variant:"secondary",children:"Draft"})]}),l.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.lesson_count," lesson(s) Â· ",e.exercise_count," exercise(s)"]})]})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(h,{variant:"outline",size:"sm",onClick:()=>t(e),children:"Manage"}),l.jsxs(S,{children:[l.jsx(F,{asChild:!0,children:l.jsx(h,{variant:"ghost",size:"sm",children:l.jsx(M,{className:"w-4 h-4"})})}),l.jsxs(k,{align:"end",children:[l.jsxs(A,{onClick:()=>i(e),children:[l.jsx(q,{className:"w-4 h-4 mr-2"}),"Edit"]}),l.jsx(A,{onClick:()=>r(e),children:e.is_published?l.jsxs(l.Fragment,{children:[l.jsx(G,{className:"w-4 h-4 mr-2"}),"Unpublish"]}):l.jsxs(l.Fragment,{children:[l.jsx(V,{className:"w-4 h-4 mr-2"}),"Publish"]})}),l.jsxs(A,{onClick:()=>a(e.id),className:"text-red-600",children:[l.jsx($,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})]})]})})},e.id))});export{O as default};
