import{G as e,u as s,h as a,r,j as t,C as n,a as i,ai as l,S as c,p as o,q as d,s as m,t as h,e as x,ao as u,b as p,d as j,R as g,I as f,T as _,B as v,P as y,L as w,l as N,O as b,D as C,m as k,n as S,o as E,bu as T}from"./index-Q8OEo_x_.js";import{A as q}from"./AdminLayout-B0MjgE3e.js";import{T as z,a as A,b as F,c as I}from"./tabs-MKf21qNa.js";import{S as B}from"./separator-DiIg3G9Q.js";import{s as D}from"./supabase-DWL4C3fA.js";import{L as G}from"./lightbulb-ChbJMoKJ.js";import{T as P}from"./trash-2-zeItPUCX.js";import{C as R}from"./circle-alert-CZuX4lSc.js";import{S as L}from"./save-Cp1jgwAo.js";import{W as M}from"./wand-sparkles-ClOUhY27.js";import{S as V}from"./square-pen-pkQitRbI.js";const H=[{code:"en",name:"English"},{code:"zh",name:"中文 (Chinese)"},{code:"hi",name:"हिंदी (Hindi)"},{code:"es",name:"Español (Spanish)"},{code:"fr",name:"Français (French)"},{code:"ar",name:"العربية (Arabic)"},{code:"bn",name:"বাংলা (Bengali)"},{code:"pt",name:"Português (Portuguese)"},{code:"ru",name:"Русский (Russian)"},{code:"ja",name:"日本語 (Japanese)"},{code:"de",name:"Deutsch (German)"},{code:"ko",name:"한국어 (Korean)"},{code:"vi",name:"Tiếng Việt (Vietnamese)"},{code:"tr",name:"Türkçe (Turkish)"},{code:"it",name:"Italiano (Italian)"},{code:"th",name:"ไทย (Thai)"},{code:"pl",name:"Polski (Polish)"},{code:"nl",name:"Nederlands (Dutch)"},{code:"id",name:"Bahasa Indonesia"},{code:"uk",name:"Українська (Ukrainian)"},{code:"tl",name:"Tagalog (Filipino)"},{code:"ms",name:"Bahasa Melayu (Malay)"},{code:"ro",name:"Română (Romanian)"},{code:"cs",name:"Čeština (Czech)"},{code:"el",name:"Ελληνικά (Greek)"},{code:"hu",name:"Magyar (Hungarian)"},{code:"sv",name:"Svenska (Swedish)"},{code:"he",name:"עברית (Hebrew)"},{code:"fa",name:"فارسی (Persian)"}],O=[{value:"multiple_choice",label:"Multiple Choice"},{value:"fill_in_blank",label:"Fill in the Blank"},{value:"error_correction",label:"Error Correction"},{value:"sentence_transformation",label:"Sentence Transformation"},{value:"drag_drop_reorder",label:"Drag & Drop Reorder"}],U=()=>{var U,W,$;const{topicId:J}=e();s();const{toast:K}=a(),[Q,Y]=r.useState(null),[X,Z]=r.useState(null),[ee,se]=r.useState([]),[ae,re]=r.useState(!0),[te,ne]=r.useState("en"),[ie,le]=r.useState(!1),[ce,oe]=r.useState({theory_title:"",theory_definition:"",theory_formation:"",theory_usage:"",theory_common_mistakes:"",rules:[],examples:[],localized_tips:""}),[de,me]=r.useState(!1),[he,xe]=r.useState(null),[ue,pe]=r.useState({exercise_type:"multiple_choice",difficulty:1,correct_order:[],transformation_type:""}),[je,ge]=r.useState({question:"",instruction:"",correct_answer:"",incorrect_answers:["","",""],explanation:"",hint:"",sentence_with_blank:"",incorrect_sentence:"",original_sentence:""});r.useEffect(()=>{J&&fe()},[J]),r.useEffect(()=>{X&&_e()},[X,te]);const fe=async()=>{re(!0);try{const{data:e,error:s}=await D.from("grammar_topics").select("\n          id,\n          slug,\n          level,\n          grammar_topic_translations(language_code, title, description)\n        ").eq("id",J).single();if(s)throw s;Y({...e,translations:e.grammar_topic_translations||[]});const{data:a,error:r}=await D.from("grammar_lessons").select("*").eq("topic_id",J).order("lesson_order").limit(1).maybeSingle();if(r)throw r;if(a)Z(a);else{const{data:e,error:s}=await D.from("grammar_lessons").insert({topic_id:J,lesson_order:1}).select().single();if(s)throw s;Z(e)}const{data:t}=await D.from("grammar_exercises").select("*").eq("topic_id",J).order("exercise_order");se(t||[])}catch(e){console.error("Error loading data:",e),K({title:"Error",description:"Failed to load topic data",variant:"destructive"})}finally{re(!1)}},_e=async()=>{if(!X)return;const{data:e,error:s}=await D.from("grammar_lesson_translations").select("*").eq("lesson_id",X.id).eq("language_code",te).maybeSingle();oe(e?{...e,rules:e.rules||[],examples:e.examples||[]}:{theory_title:"",theory_definition:"",theory_formation:"",theory_usage:"",theory_common_mistakes:"",rules:[],examples:[],localized_tips:""})},ve=(e,s,a)=>{oe(r=>({...r,rules:(r.rules||[]).map((r,t)=>t===e?{...r,[s]:a}:r)}))},ye=(e,s,a)=>{oe(r=>({...r,examples:(r.examples||[]).map((r,t)=>t===e?{...r,[s]:a}:r)}))},we=async e=>{if(e){xe(e),pe({exercise_type:e.exercise_type,difficulty:e.difficulty,correct_order:e.correct_order||[],transformation_type:e.transformation_type||""});const{data:s}=await D.from("grammar_exercise_translations").select("*").eq("exercise_id",e.id).eq("language_code",te).maybeSingle();s?ge(s):Ne()}else xe(null),pe({exercise_type:"multiple_choice",difficulty:1,correct_order:[],transformation_type:""}),Ne();me(!0)},Ne=()=>{ge({question:"",instruction:"",correct_answer:"",incorrect_answers:["","",""],explanation:"",hint:"",sentence_with_blank:"",incorrect_sentence:"",original_sentence:""})};return ae?t.jsx(q,{title:"Loading...",showBackButton:!0,children:t.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):t.jsx(q,{title:`Edit: ${(()=>{const e=null==Q?void 0:Q.translations.find(e=>"en"===e.language_code);return(null==e?void 0:e.title)||(null==Q?void 0:Q.slug)||"Topic"})()}`,showBackButton:!0,backPath:"/admin/grammar",children:t.jsxs("div",{className:"space-y-6",children:[t.jsx(n,{children:t.jsx(i,{className:"p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(l,{className:"w-5 h-5 text-muted-foreground"}),t.jsx("span",{className:"font-medium",children:"Content Language:"})]}),t.jsxs(c,{value:te,onValueChange:ne,children:[t.jsx(o,{className:"w-[200px]",children:t.jsx(d,{})}),t.jsx(m,{children:H.map(e=>t.jsx(h,{value:e.code,children:e.name},e.code))})]})]})})}),t.jsxs(z,{defaultValue:"theory",children:[t.jsxs(A,{className:"grid w-full grid-cols-2 max-w-md",children:[t.jsxs(F,{value:"theory",children:[t.jsx(x,{className:"w-4 h-4 mr-2"}),"Theory & Content"]}),t.jsxs(F,{value:"exercises",children:[t.jsx(u,{className:"w-4 h-4 mr-2"}),"Exercises (",ee.length,")"]})]}),t.jsxs(I,{value:"theory",className:"space-y-6 mt-6",children:[t.jsxs(n,{children:[t.jsx(p,{children:t.jsxs(j,{className:"flex items-center gap-2",children:[t.jsx(G,{className:"w-5 h-5 text-amber-500"}),"Definition"]})}),t.jsxs(i,{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(g,{children:"Title"}),t.jsx(f,{value:ce.theory_title||"",onChange:e=>oe({...ce,theory_title:e.target.value}),placeholder:"What is Present Simple?"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(g,{children:"Definition / Explanation"}),t.jsx(_,{value:ce.theory_definition||"",onChange:e=>oe({...ce,theory_definition:e.target.value}),placeholder:"The present simple tense is used to describe...",rows:5})]})]})]}),t.jsxs(n,{children:[t.jsx(p,{children:t.jsxs(j,{className:"flex items-center gap-2",children:[t.jsx(u,{className:"w-5 h-5 text-blue-500"}),"How to Form It"]})}),t.jsxs(i,{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(g,{children:"Formation Explanation"}),t.jsx(_,{value:ce.theory_formation||"",onChange:e=>oe({...ce,theory_formation:e.target.value}),placeholder:"To form the present simple, use the base form of the verb...",rows:4})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(g,{children:"Grammar Rules / Formulas"}),t.jsxs(v,{variant:"outline",size:"sm",onClick:()=>{oe(e=>({...e,rules:[...e.rules||[],{title:"",formula:"",example:""}]}))},children:[t.jsx(y,{className:"w-4 h-4 mr-1"}),"Add Rule"]})]}),(ce.rules||[]).map((e,s)=>t.jsxs("div",{className:"p-4 border rounded-lg space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("span",{className:"font-medium",children:["Rule ",s+1]}),t.jsx(v,{variant:"ghost",size:"sm",onClick:()=>(e=>{oe(s=>({...s,rules:(s.rules||[]).filter((s,a)=>a!==e)}))})(s),children:t.jsx(P,{className:"w-4 h-4 text-red-500"})})]}),t.jsx(f,{placeholder:"Rule title (e.g., Affirmative)",value:e.title,onChange:e=>ve(s,"title",e.target.value)}),t.jsx(f,{placeholder:"Formula (e.g., Subject + Verb(s/es) + Object)",value:e.formula,onChange:e=>ve(s,"formula",e.target.value),className:"font-mono"}),t.jsx(f,{placeholder:"Example sentence",value:e.example,onChange:e=>ve(s,"example",e.target.value)})]},s))]})]})]}),t.jsxs(n,{children:[t.jsx(p,{children:t.jsxs(j,{className:"flex items-center gap-2",children:[t.jsx(w,{className:"w-5 h-5 text-emerald-500"}),"When to Use It"]})}),t.jsx(i,{children:t.jsx(_,{value:ce.theory_usage||"",onChange:e=>oe({...ce,theory_usage:e.target.value}),placeholder:"Use present simple when talking about habits, facts, schedules...",rows:5})})]}),t.jsxs(n,{children:[t.jsx(p,{children:t.jsxs(j,{className:"flex items-center justify-between",children:[t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsx(x,{className:"w-5 h-5 text-purple-500"}),"Examples"]}),t.jsxs(v,{variant:"outline",size:"sm",onClick:()=>{oe(e=>({...e,examples:[...e.examples||[],{sentence:"",translation:"",correct:!0}]}))},children:[t.jsx(y,{className:"w-4 h-4 mr-1"}),"Add Example"]})]})}),t.jsx(i,{className:"space-y-3",children:(ce.examples||[]).map((e,s)=>t.jsxs("div",{className:"p-4 border rounded-lg space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"font-medium",children:["Example ",s+1]}),t.jsx(N,{variant:e.correct?"default":"destructive",className:"cursor-pointer",onClick:()=>ye(s,"correct",!e.correct),children:e.correct?"Correct":"Incorrect"})]}),t.jsx(v,{variant:"ghost",size:"sm",onClick:()=>(e=>{oe(s=>({...s,examples:(s.examples||[]).filter((s,a)=>a!==e)}))})(s),children:t.jsx(P,{className:"w-4 h-4 text-red-500"})})]}),t.jsx(f,{placeholder:"Example sentence",value:e.sentence,onChange:e=>ye(s,"sentence",e.target.value)}),t.jsx(f,{placeholder:"Translation (optional)",value:e.translation||"",onChange:e=>ye(s,"translation",e.target.value)})]},s))})]}),t.jsxs(n,{className:"border-amber-200",children:[t.jsx(p,{children:t.jsxs(j,{className:"flex items-center gap-2 text-amber-700",children:[t.jsx(R,{className:"w-5 h-5"}),"Common Mistakes to Avoid"]})}),t.jsx(i,{children:t.jsx(_,{value:ce.theory_common_mistakes||"",onChange:e=>oe({...ce,theory_common_mistakes:e.target.value}),placeholder:"Common mistakes learners make...",rows:4})})]}),t.jsxs(n,{className:"border-purple-200",children:[t.jsx(p,{children:t.jsxs(j,{className:"flex items-center gap-2 text-purple-700",children:[t.jsx(l,{className:"w-5 h-5"}),"Tips for ",null==(U=H.find(e=>e.code===te))?void 0:U.name," Speakers"]})}),t.jsx(i,{children:t.jsx(_,{value:ce.localized_tips||"",onChange:e=>oe({...ce,localized_tips:e.target.value}),placeholder:"Specific tips for speakers of this language...",rows:4})})]}),t.jsx("div",{className:"flex justify-end",children:t.jsxs(v,{onClick:async()=>{var e;if(X){le(!0);try{const{error:s}=await D.from("grammar_lesson_translations").upsert({lesson_id:X.id,language_code:te,theory_title:ce.theory_title,theory_definition:ce.theory_definition,theory_formation:ce.theory_formation,theory_usage:ce.theory_usage,theory_common_mistakes:ce.theory_common_mistakes,rules:ce.rules,examples:ce.examples,localized_tips:ce.localized_tips},{onConflict:"lesson_id,language_code"});if(s)throw s;K({title:"Success",description:`Lesson content saved for ${null==(e=H.find(e=>e.code===te))?void 0:e.name}`})}catch(s){K({title:"Error",description:s.message||"Failed to save lesson",variant:"destructive"})}finally{le(!1)}}},disabled:ie,children:[t.jsx(L,{className:"w-4 h-4 mr-2"}),ie?"Saving...":"Save Lesson Content"]})}),t.jsx("div",{className:"mt-8 p-6 bg-gradient-to-br from-indigo-50 to-purple-50 rounded-xl border border-indigo-100 dark:from-indigo-950/20 dark:to-purple-950/20 dark:border-indigo-900",children:t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:"p-3 bg-white dark:bg-gray-800 rounded-lg shadow-sm",children:t.jsx(M,{className:"w-6 h-6 text-indigo-500"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"text-lg font-semibold text-indigo-900 dark:text-indigo-300 mb-2",children:"AI Content Generator"}),t.jsxs("p",{className:"text-sm text-indigo-700 dark:text-indigo-400 mb-4",children:["Automatically generate comprehensive, localized theory content for ",t.jsx("strong",{children:null==(W=H.find(e=>e.code===te))?void 0:W.name}),". This will create deep definitions, usage rules, and comparison tables adapted for native speakers of this language."]}),t.jsxs(v,{onClick:async()=>{var e,s;if(X&&(!ce.theory_title||confirm("This will overwrite existing content for this language. Continue?"))){le(!0),K({title:"Generating Content...",description:`AI is writing comprehensive grammar content for ${null==(e=H.find(e=>e.code===te))?void 0:e.name}...`});try{const e=(null==(s=H.find(e=>e.code===te))?void 0:s.name)||"English",{data:a,error:r}=await D.functions.invoke("enhance-grammar-lesson",{body:{lesson_id:X.id,language_code:te,language_name:e}});if(r)throw r;if(!a.success)throw new Error(a.error||"Failed to generate content");const t=a.data;oe({...ce,theory_title:t.theory_title,theory_definition:t.theory_definition,theory_formation:t.theory_formation,theory_usage:t.theory_usage,theory_common_mistakes:t.theory_common_mistakes,rules:t.rules,examples:t.examples,localized_tips:t.localized_tips}),K({title:"Content Generated! ✨",description:"Review the content and click Save to persist changes."})}catch(a){console.error("Generation error:",a),K({title:"Generation Failed",description:a.message||"Failed to generate content. Ensure English content exists first.",variant:"destructive"})}finally{le(!1)}}},disabled:ie,variant:"secondary",className:"bg-white text-indigo-600 hover:bg-indigo-50 border border-indigo-200 shadow-sm",children:[t.jsx(b,{className:"w-4 h-4 mr-2"}),"Generate ",null==($=H.find(e=>e.code===te))?void 0:$.name," Content"]})]})]})})]}),t.jsxs(I,{value:"exercises",className:"space-y-6 mt-6",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Create interactive exercises for students to practice."}),t.jsxs(v,{onClick:()=>we(),children:[t.jsx(y,{className:"w-4 h-4 mr-2"}),"Add Exercise"]})]}),0===ee.length?t.jsxs(n,{className:"p-8 text-center",children:[t.jsx(u,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Exercises Yet"}),t.jsx("p",{className:"text-muted-foreground mb-4",children:"Add exercises to help students practice this grammar topic."}),t.jsxs(v,{onClick:()=>we(),children:[t.jsx(y,{className:"w-4 h-4 mr-2"}),"Create First Exercise"]})]}):t.jsx("div",{className:"space-y-3",children:ee.map((e,s)=>{var a;return t.jsx(n,{children:t.jsx(i,{className:"p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center text-sm font-medium",children:s+1}),t.jsx("div",{children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(N,{variant:"secondary",children:null==(a=O.find(s=>s.value===e.exercise_type))?void 0:a.label}),t.jsxs(N,{variant:"outline",children:["Difficulty: ",e.difficulty]})]})})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(v,{variant:"outline",size:"sm",onClick:()=>we(e),children:t.jsx(V,{className:"w-4 h-4"})}),t.jsx(v,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(confirm("Delete this exercise?"))try{const{error:s}=await D.from("grammar_exercises").delete().eq("id",e);if(s)throw s;K({title:"Success",description:"Exercise deleted"}),fe()}catch(s){K({title:"Error",description:s.message||"Failed to delete exercise",variant:"destructive"})}})(e.id),children:t.jsx(P,{className:"w-4 h-4 text-red-500"})})]})]})})},e.id)})})]})]}),t.jsx(C,{open:de,onOpenChange:me,children:t.jsxs(k,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[t.jsx(S,{children:t.jsx(E,{children:he?"Edit Exercise":"Add New Exercise"})}),t.jsxs("div",{className:"space-y-4 py-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(g,{children:"Exercise Type"}),t.jsxs(c,{value:ue.exercise_type,onValueChange:e=>pe({...ue,exercise_type:e}),children:[t.jsx(o,{children:t.jsx(d,{})}),t.jsx(m,{children:O.map(e=>t.jsx(h,{value:e.value,children:e.label},e.value))})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(g,{children:"Difficulty (1-3)"}),t.jsxs(c,{value:String(ue.difficulty),onValueChange:e=>pe({...ue,difficulty:parseInt(e)}),children:[t.jsx(o,{children:t.jsx(d,{})}),t.jsxs(m,{children:[t.jsx(h,{value:"1",children:"1 - Easy"}),t.jsx(h,{value:"2",children:"2 - Medium"}),t.jsx(h,{value:"3",children:"3 - Hard"})]})]})]})]}),t.jsx(B,{}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(g,{children:"Question / Prompt"}),t.jsx(_,{value:je.question||"",onChange:e=>ge({...je,question:e.target.value}),placeholder:"Enter the question or prompt...",rows:2})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(g,{children:"Instruction (optional)"}),t.jsx(f,{value:je.instruction||"",onChange:e=>ge({...je,instruction:e.target.value}),placeholder:"Choose the correct answer..."})]}),"fill_in_blank"===ue.exercise_type&&t.jsxs("div",{className:"space-y-2",children:[t.jsx(g,{children:"Sentence with blank (use ___ for blank)"}),t.jsx(f,{value:je.sentence_with_blank||"",onChange:e=>ge({...je,sentence_with_blank:e.target.value}),placeholder:"She ___ to school every day."})]}),"error_correction"===ue.exercise_type&&t.jsxs("div",{className:"space-y-2",children:[t.jsx(g,{children:"Incorrect Sentence (with error)"}),t.jsx(f,{value:je.incorrect_sentence||"",onChange:e=>ge({...je,incorrect_sentence:e.target.value}),placeholder:"She go to school every day."})]}),"sentence_transformation"===ue.exercise_type&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(g,{children:"Transformation Type"}),t.jsx(f,{value:ue.transformation_type||"",onChange:e=>pe({...ue,transformation_type:e.target.value}),placeholder:"Active to Passive"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(g,{children:"Original Sentence"}),t.jsx(f,{value:je.original_sentence||"",onChange:e=>ge({...je,original_sentence:e.target.value}),placeholder:"The cat eats the fish."})]})]}),"drag_drop_reorder"===ue.exercise_type&&t.jsxs("div",{className:"space-y-2",children:[t.jsx(g,{children:"Correct Word Order (comma-separated)"}),t.jsx(f,{value:ue.correct_order.join(", "),onChange:e=>pe({...ue,correct_order:e.target.value.split(",").map(e=>e.trim()).filter(Boolean)}),placeholder:"She, goes, to, school, every, day"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(g,{children:"Correct Answer"}),t.jsx(f,{value:je.correct_answer||"",onChange:e=>ge({...je,correct_answer:e.target.value}),placeholder:"The correct answer..."})]}),"multiple_choice"===ue.exercise_type&&t.jsxs("div",{className:"space-y-2",children:[t.jsx(g,{children:"Incorrect Answers (one per line)"}),(je.incorrect_answers||["","",""]).map((e,s)=>t.jsx(f,{value:e,onChange:e=>{const a=[...je.incorrect_answers||["","",""]];a[s]=e.target.value,ge({...je,incorrect_answers:a})},placeholder:`Incorrect answer ${s+1}`},s))]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(g,{children:"Explanation (shown after answering)"}),t.jsx(_,{value:je.explanation||"",onChange:e=>ge({...je,explanation:e.target.value}),placeholder:"Explain why this is the correct answer...",rows:2})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(g,{children:"Hint (optional)"}),t.jsx(f,{value:je.hint||"",onChange:e=>ge({...je,hint:e.target.value}),placeholder:"A helpful hint..."})]})]}),t.jsxs(T,{children:[t.jsx(v,{variant:"outline",onClick:()=>me(!1),children:"Cancel"}),t.jsx(v,{onClick:async()=>{var e;if(J){le(!0);try{let s=null==he?void 0:he.id;if(he){const{error:e}=await D.from("grammar_exercises").update({exercise_type:ue.exercise_type,difficulty:ue.difficulty,correct_order:"drag_drop_reorder"===ue.exercise_type?ue.correct_order:null,transformation_type:"sentence_transformation"===ue.exercise_type?ue.transformation_type:null}).eq("id",he.id);if(e)throw e}else{const e=ee.length>0?Math.max(...ee.map(e=>e.exercise_order)):0,{data:a,error:r}=await D.from("grammar_exercises").insert({topic_id:J,exercise_type:ue.exercise_type,difficulty:ue.difficulty,exercise_order:e+1,correct_order:"drag_drop_reorder"===ue.exercise_type?ue.correct_order:null,transformation_type:"sentence_transformation"===ue.exercise_type?ue.transformation_type:null}).select().single();if(r)throw r;s=a.id}const{error:a}=await D.from("grammar_exercise_translations").upsert({exercise_id:s,language_code:te,question:je.question,instruction:je.instruction,correct_answer:je.correct_answer,incorrect_answers:null==(e=je.incorrect_answers)?void 0:e.filter(e=>e.trim()),explanation:je.explanation,hint:je.hint,sentence_with_blank:je.sentence_with_blank,incorrect_sentence:je.incorrect_sentence,original_sentence:je.original_sentence},{onConflict:"exercise_id,language_code"});if(a)throw a;K({title:"Success",description:he?"Exercise updated":"Exercise created"}),me(!1),fe()}catch(s){K({title:"Error",description:s.message||"Failed to save exercise",variant:"destructive"})}finally{le(!1)}}},disabled:ie,children:ie?"Saving...":he?"Update":"Create"})]})]})})]})})};export{U as default};
