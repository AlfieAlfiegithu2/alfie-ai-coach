import{G as e,u as s,h as a,r,j as t,C as n,a as i,a9 as l,S as c,p as o,q as d,s as m,t as h,e as x,a1 as u,b as p,d as j,O as _,I as f,T as g,B as v,P as y,L as w,l as N,D as b,m as C,n as k,o as S,bp as E}from"./index-C6RqRRNF.js";import{A as T}from"./AdminLayout-1IXvt-T8.js";import{T as q,a as z,b as A,c as F}from"./tabs-BnFIjZh5.js";import{S as I}from"./separator-D1lX5upN.js";import{s as B}from"./supabase-DWL4C3fA.js";import{L as D}from"./lightbulb-CIy2asBP.js";import{T as P}from"./trash-2-_ZMt6Ux1.js";import{C as R}from"./circle-alert-CygSRMfx.js";import{S as L}from"./save-CNLNrp94.js";import{S as M}from"./square-pen-DZkYhpqN.js";const V=[{code:"en",name:"English"},{code:"zh",name:"中文 (Chinese)"},{code:"hi",name:"हिंदी (Hindi)"},{code:"es",name:"Español (Spanish)"},{code:"fr",name:"Français (French)"},{code:"ar",name:"العربية (Arabic)"},{code:"bn",name:"বাংলা (Bengali)"},{code:"pt",name:"Português (Portuguese)"},{code:"ru",name:"Русский (Russian)"},{code:"ja",name:"日本語 (Japanese)"},{code:"de",name:"Deutsch (German)"},{code:"ko",name:"한국어 (Korean)"},{code:"vi",name:"Tiếng Việt (Vietnamese)"},{code:"tr",name:"Türkçe (Turkish)"},{code:"it",name:"Italiano (Italian)"},{code:"th",name:"ไทย (Thai)"},{code:"pl",name:"Polski (Polish)"},{code:"nl",name:"Nederlands (Dutch)"},{code:"id",name:"Bahasa Indonesia"},{code:"uk",name:"Українська (Ukrainian)"},{code:"tl",name:"Tagalog (Filipino)"},{code:"ms",name:"Bahasa Melayu (Malay)"},{code:"ro",name:"Română (Romanian)"},{code:"cs",name:"Čeština (Czech)"},{code:"el",name:"Ελληνικά (Greek)"},{code:"hu",name:"Magyar (Hungarian)"},{code:"sv",name:"Svenska (Swedish)"},{code:"he",name:"עברית (Hebrew)"},{code:"fa",name:"فارسی (Persian)"}],H=[{value:"multiple_choice",label:"Multiple Choice"},{value:"fill_in_blank",label:"Fill in the Blank"},{value:"error_correction",label:"Error Correction"},{value:"sentence_transformation",label:"Sentence Transformation"},{value:"drag_drop_reorder",label:"Drag & Drop Reorder"}],O=()=>{var O;const{topicId:G}=e();s();const{toast:U}=a(),[W,$]=r.useState(null),[J,K]=r.useState(null),[Q,Y]=r.useState([]),[X,Z]=r.useState(!0),[ee,se]=r.useState("en"),[ae,re]=r.useState(!1),[te,ne]=r.useState({theory_title:"",theory_definition:"",theory_formation:"",theory_usage:"",theory_common_mistakes:"",rules:[],examples:[],localized_tips:""}),[ie,le]=r.useState(!1),[ce,oe]=r.useState(null),[de,me]=r.useState({exercise_type:"multiple_choice",difficulty:1,correct_order:[],transformation_type:""}),[he,xe]=r.useState({question:"",instruction:"",correct_answer:"",incorrect_answers:["","",""],explanation:"",hint:"",sentence_with_blank:"",incorrect_sentence:"",original_sentence:""});r.useEffect(()=>{G&&ue()},[G]),r.useEffect(()=>{J&&pe()},[J,ee]);const ue=async()=>{Z(!0);try{const{data:e,error:s}=await B.from("grammar_topics").select("\n          id,\n          slug,\n          level,\n          grammar_topic_translations(language_code, title, description)\n        ").eq("id",G).single();if(s)throw s;$({...e,translations:e.grammar_topic_translations||[]});const{data:a,error:r}=await B.from("grammar_lessons").select("*").eq("topic_id",G).order("lesson_order").limit(1).maybeSingle();if(r)throw r;if(a)K(a);else{const{data:e,error:s}=await B.from("grammar_lessons").insert({topic_id:G,lesson_order:1}).select().single();if(s)throw s;K(e)}const{data:t}=await B.from("grammar_exercises").select("*").eq("topic_id",G).order("exercise_order");Y(t||[])}catch(e){console.error("Error loading data:",e),U({title:"Error",description:"Failed to load topic data",variant:"destructive"})}finally{Z(!1)}},pe=async()=>{if(!J)return;const{data:e,error:s}=await B.from("grammar_lesson_translations").select("*").eq("lesson_id",J.id).eq("language_code",ee).maybeSingle();ne(e?{...e,rules:e.rules||[],examples:e.examples||[]}:{theory_title:"",theory_definition:"",theory_formation:"",theory_usage:"",theory_common_mistakes:"",rules:[],examples:[],localized_tips:""})},je=(e,s,a)=>{ne(r=>({...r,rules:(r.rules||[]).map((r,t)=>t===e?{...r,[s]:a}:r)}))},_e=(e,s,a)=>{ne(r=>({...r,examples:(r.examples||[]).map((r,t)=>t===e?{...r,[s]:a}:r)}))},fe=async e=>{if(e){oe(e),me({exercise_type:e.exercise_type,difficulty:e.difficulty,correct_order:e.correct_order||[],transformation_type:e.transformation_type||""});const{data:s}=await B.from("grammar_exercise_translations").select("*").eq("exercise_id",e.id).eq("language_code",ee).maybeSingle();s?xe(s):ge()}else oe(null),me({exercise_type:"multiple_choice",difficulty:1,correct_order:[],transformation_type:""}),ge();le(!0)},ge=()=>{xe({question:"",instruction:"",correct_answer:"",incorrect_answers:["","",""],explanation:"",hint:"",sentence_with_blank:"",incorrect_sentence:"",original_sentence:""})};return X?t.jsx(T,{title:"Loading...",showBackButton:!0,children:t.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):t.jsx(T,{title:`Edit: ${(()=>{const e=null==W?void 0:W.translations.find(e=>"en"===e.language_code);return(null==e?void 0:e.title)||(null==W?void 0:W.slug)||"Topic"})()}`,showBackButton:!0,backPath:"/admin/grammar",children:t.jsxs("div",{className:"space-y-6",children:[t.jsx(n,{children:t.jsx(i,{className:"p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(l,{className:"w-5 h-5 text-muted-foreground"}),t.jsx("span",{className:"font-medium",children:"Content Language:"})]}),t.jsxs(c,{value:ee,onValueChange:se,children:[t.jsx(o,{className:"w-[200px]",children:t.jsx(d,{})}),t.jsx(m,{children:V.map(e=>t.jsx(h,{value:e.code,children:e.name},e.code))})]})]})})}),t.jsxs(q,{defaultValue:"theory",children:[t.jsxs(z,{className:"grid w-full grid-cols-2 max-w-md",children:[t.jsxs(A,{value:"theory",children:[t.jsx(x,{className:"w-4 h-4 mr-2"}),"Theory & Content"]}),t.jsxs(A,{value:"exercises",children:[t.jsx(u,{className:"w-4 h-4 mr-2"}),"Exercises (",Q.length,")"]})]}),t.jsxs(F,{value:"theory",className:"space-y-6 mt-6",children:[t.jsxs(n,{children:[t.jsx(p,{children:t.jsxs(j,{className:"flex items-center gap-2",children:[t.jsx(D,{className:"w-5 h-5 text-amber-500"}),"Definition"]})}),t.jsxs(i,{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(_,{children:"Title"}),t.jsx(f,{value:te.theory_title||"",onChange:e=>ne({...te,theory_title:e.target.value}),placeholder:"What is Present Simple?"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(_,{children:"Definition / Explanation"}),t.jsx(g,{value:te.theory_definition||"",onChange:e=>ne({...te,theory_definition:e.target.value}),placeholder:"The present simple tense is used to describe...",rows:5})]})]})]}),t.jsxs(n,{children:[t.jsx(p,{children:t.jsxs(j,{className:"flex items-center gap-2",children:[t.jsx(u,{className:"w-5 h-5 text-blue-500"}),"How to Form It"]})}),t.jsxs(i,{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(_,{children:"Formation Explanation"}),t.jsx(g,{value:te.theory_formation||"",onChange:e=>ne({...te,theory_formation:e.target.value}),placeholder:"To form the present simple, use the base form of the verb...",rows:4})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(_,{children:"Grammar Rules / Formulas"}),t.jsxs(v,{variant:"outline",size:"sm",onClick:()=>{ne(e=>({...e,rules:[...e.rules||[],{title:"",formula:"",example:""}]}))},children:[t.jsx(y,{className:"w-4 h-4 mr-1"}),"Add Rule"]})]}),(te.rules||[]).map((e,s)=>t.jsxs("div",{className:"p-4 border rounded-lg space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("span",{className:"font-medium",children:["Rule ",s+1]}),t.jsx(v,{variant:"ghost",size:"sm",onClick:()=>(e=>{ne(s=>({...s,rules:(s.rules||[]).filter((s,a)=>a!==e)}))})(s),children:t.jsx(P,{className:"w-4 h-4 text-red-500"})})]}),t.jsx(f,{placeholder:"Rule title (e.g., Affirmative)",value:e.title,onChange:e=>je(s,"title",e.target.value)}),t.jsx(f,{placeholder:"Formula (e.g., Subject + Verb(s/es) + Object)",value:e.formula,onChange:e=>je(s,"formula",e.target.value),className:"font-mono"}),t.jsx(f,{placeholder:"Example sentence",value:e.example,onChange:e=>je(s,"example",e.target.value)})]},s))]})]})]}),t.jsxs(n,{children:[t.jsx(p,{children:t.jsxs(j,{className:"flex items-center gap-2",children:[t.jsx(w,{className:"w-5 h-5 text-emerald-500"}),"When to Use It"]})}),t.jsx(i,{children:t.jsx(g,{value:te.theory_usage||"",onChange:e=>ne({...te,theory_usage:e.target.value}),placeholder:"Use present simple when talking about habits, facts, schedules...",rows:5})})]}),t.jsxs(n,{children:[t.jsx(p,{children:t.jsxs(j,{className:"flex items-center justify-between",children:[t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsx(x,{className:"w-5 h-5 text-purple-500"}),"Examples"]}),t.jsxs(v,{variant:"outline",size:"sm",onClick:()=>{ne(e=>({...e,examples:[...e.examples||[],{sentence:"",translation:"",correct:!0}]}))},children:[t.jsx(y,{className:"w-4 h-4 mr-1"}),"Add Example"]})]})}),t.jsx(i,{className:"space-y-3",children:(te.examples||[]).map((e,s)=>t.jsxs("div",{className:"p-4 border rounded-lg space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"font-medium",children:["Example ",s+1]}),t.jsx(N,{variant:e.correct?"default":"destructive",className:"cursor-pointer",onClick:()=>_e(s,"correct",!e.correct),children:e.correct?"Correct":"Incorrect"})]}),t.jsx(v,{variant:"ghost",size:"sm",onClick:()=>(e=>{ne(s=>({...s,examples:(s.examples||[]).filter((s,a)=>a!==e)}))})(s),children:t.jsx(P,{className:"w-4 h-4 text-red-500"})})]}),t.jsx(f,{placeholder:"Example sentence",value:e.sentence,onChange:e=>_e(s,"sentence",e.target.value)}),t.jsx(f,{placeholder:"Translation (optional)",value:e.translation||"",onChange:e=>_e(s,"translation",e.target.value)})]},s))})]}),t.jsxs(n,{className:"border-amber-200",children:[t.jsx(p,{children:t.jsxs(j,{className:"flex items-center gap-2 text-amber-700",children:[t.jsx(R,{className:"w-5 h-5"}),"Common Mistakes to Avoid"]})}),t.jsx(i,{children:t.jsx(g,{value:te.theory_common_mistakes||"",onChange:e=>ne({...te,theory_common_mistakes:e.target.value}),placeholder:"Common mistakes learners make...",rows:4})})]}),t.jsxs(n,{className:"border-purple-200",children:[t.jsx(p,{children:t.jsxs(j,{className:"flex items-center gap-2 text-purple-700",children:[t.jsx(l,{className:"w-5 h-5"}),"Tips for ",null==(O=V.find(e=>e.code===ee))?void 0:O.name," Speakers"]})}),t.jsx(i,{children:t.jsx(g,{value:te.localized_tips||"",onChange:e=>ne({...te,localized_tips:e.target.value}),placeholder:"Specific tips for speakers of this language...",rows:4})})]}),t.jsx("div",{className:"flex justify-end",children:t.jsxs(v,{onClick:async()=>{var e;if(J){re(!0);try{const{error:s}=await B.from("grammar_lesson_translations").upsert({lesson_id:J.id,language_code:ee,theory_title:te.theory_title,theory_definition:te.theory_definition,theory_formation:te.theory_formation,theory_usage:te.theory_usage,theory_common_mistakes:te.theory_common_mistakes,rules:te.rules,examples:te.examples,localized_tips:te.localized_tips},{onConflict:"lesson_id,language_code"});if(s)throw s;U({title:"Success",description:`Lesson content saved for ${null==(e=V.find(e=>e.code===ee))?void 0:e.name}`})}catch(s){U({title:"Error",description:s.message||"Failed to save lesson",variant:"destructive"})}finally{re(!1)}}},disabled:ae,children:[t.jsx(L,{className:"w-4 h-4 mr-2"}),ae?"Saving...":"Save Lesson Content"]})})]}),t.jsxs(F,{value:"exercises",className:"space-y-6 mt-6",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Create interactive exercises for students to practice."}),t.jsxs(v,{onClick:()=>fe(),children:[t.jsx(y,{className:"w-4 h-4 mr-2"}),"Add Exercise"]})]}),0===Q.length?t.jsxs(n,{className:"p-8 text-center",children:[t.jsx(u,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Exercises Yet"}),t.jsx("p",{className:"text-muted-foreground mb-4",children:"Add exercises to help students practice this grammar topic."}),t.jsxs(v,{onClick:()=>fe(),children:[t.jsx(y,{className:"w-4 h-4 mr-2"}),"Create First Exercise"]})]}):t.jsx("div",{className:"space-y-3",children:Q.map((e,s)=>{var a;return t.jsx(n,{children:t.jsx(i,{className:"p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center text-sm font-medium",children:s+1}),t.jsx("div",{children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(N,{variant:"secondary",children:null==(a=H.find(s=>s.value===e.exercise_type))?void 0:a.label}),t.jsxs(N,{variant:"outline",children:["Difficulty: ",e.difficulty]})]})})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(v,{variant:"outline",size:"sm",onClick:()=>fe(e),children:t.jsx(M,{className:"w-4 h-4"})}),t.jsx(v,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(confirm("Delete this exercise?"))try{const{error:s}=await B.from("grammar_exercises").delete().eq("id",e);if(s)throw s;U({title:"Success",description:"Exercise deleted"}),ue()}catch(s){U({title:"Error",description:s.message||"Failed to delete exercise",variant:"destructive"})}})(e.id),children:t.jsx(P,{className:"w-4 h-4 text-red-500"})})]})]})})},e.id)})})]})]}),t.jsx(b,{open:ie,onOpenChange:le,children:t.jsxs(C,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[t.jsx(k,{children:t.jsx(S,{children:ce?"Edit Exercise":"Add New Exercise"})}),t.jsxs("div",{className:"space-y-4 py-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(_,{children:"Exercise Type"}),t.jsxs(c,{value:de.exercise_type,onValueChange:e=>me({...de,exercise_type:e}),children:[t.jsx(o,{children:t.jsx(d,{})}),t.jsx(m,{children:H.map(e=>t.jsx(h,{value:e.value,children:e.label},e.value))})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(_,{children:"Difficulty (1-3)"}),t.jsxs(c,{value:String(de.difficulty),onValueChange:e=>me({...de,difficulty:parseInt(e)}),children:[t.jsx(o,{children:t.jsx(d,{})}),t.jsxs(m,{children:[t.jsx(h,{value:"1",children:"1 - Easy"}),t.jsx(h,{value:"2",children:"2 - Medium"}),t.jsx(h,{value:"3",children:"3 - Hard"})]})]})]})]}),t.jsx(I,{}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(_,{children:"Question / Prompt"}),t.jsx(g,{value:he.question||"",onChange:e=>xe({...he,question:e.target.value}),placeholder:"Enter the question or prompt...",rows:2})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(_,{children:"Instruction (optional)"}),t.jsx(f,{value:he.instruction||"",onChange:e=>xe({...he,instruction:e.target.value}),placeholder:"Choose the correct answer..."})]}),"fill_in_blank"===de.exercise_type&&t.jsxs("div",{className:"space-y-2",children:[t.jsx(_,{children:"Sentence with blank (use ___ for blank)"}),t.jsx(f,{value:he.sentence_with_blank||"",onChange:e=>xe({...he,sentence_with_blank:e.target.value}),placeholder:"She ___ to school every day."})]}),"error_correction"===de.exercise_type&&t.jsxs("div",{className:"space-y-2",children:[t.jsx(_,{children:"Incorrect Sentence (with error)"}),t.jsx(f,{value:he.incorrect_sentence||"",onChange:e=>xe({...he,incorrect_sentence:e.target.value}),placeholder:"She go to school every day."})]}),"sentence_transformation"===de.exercise_type&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(_,{children:"Transformation Type"}),t.jsx(f,{value:de.transformation_type||"",onChange:e=>me({...de,transformation_type:e.target.value}),placeholder:"Active to Passive"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(_,{children:"Original Sentence"}),t.jsx(f,{value:he.original_sentence||"",onChange:e=>xe({...he,original_sentence:e.target.value}),placeholder:"The cat eats the fish."})]})]}),"drag_drop_reorder"===de.exercise_type&&t.jsxs("div",{className:"space-y-2",children:[t.jsx(_,{children:"Correct Word Order (comma-separated)"}),t.jsx(f,{value:de.correct_order.join(", "),onChange:e=>me({...de,correct_order:e.target.value.split(",").map(e=>e.trim()).filter(Boolean)}),placeholder:"She, goes, to, school, every, day"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(_,{children:"Correct Answer"}),t.jsx(f,{value:he.correct_answer||"",onChange:e=>xe({...he,correct_answer:e.target.value}),placeholder:"The correct answer..."})]}),"multiple_choice"===de.exercise_type&&t.jsxs("div",{className:"space-y-2",children:[t.jsx(_,{children:"Incorrect Answers (one per line)"}),(he.incorrect_answers||["","",""]).map((e,s)=>t.jsx(f,{value:e,onChange:e=>{const a=[...he.incorrect_answers||["","",""]];a[s]=e.target.value,xe({...he,incorrect_answers:a})},placeholder:`Incorrect answer ${s+1}`},s))]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(_,{children:"Explanation (shown after answering)"}),t.jsx(g,{value:he.explanation||"",onChange:e=>xe({...he,explanation:e.target.value}),placeholder:"Explain why this is the correct answer...",rows:2})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(_,{children:"Hint (optional)"}),t.jsx(f,{value:he.hint||"",onChange:e=>xe({...he,hint:e.target.value}),placeholder:"A helpful hint..."})]})]}),t.jsxs(E,{children:[t.jsx(v,{variant:"outline",onClick:()=>le(!1),children:"Cancel"}),t.jsx(v,{onClick:async()=>{var e;if(G){re(!0);try{let s=null==ce?void 0:ce.id;if(ce){const{error:e}=await B.from("grammar_exercises").update({exercise_type:de.exercise_type,difficulty:de.difficulty,correct_order:"drag_drop_reorder"===de.exercise_type?de.correct_order:null,transformation_type:"sentence_transformation"===de.exercise_type?de.transformation_type:null}).eq("id",ce.id);if(e)throw e}else{const e=Q.length>0?Math.max(...Q.map(e=>e.exercise_order)):0,{data:a,error:r}=await B.from("grammar_exercises").insert({topic_id:G,exercise_type:de.exercise_type,difficulty:de.difficulty,exercise_order:e+1,correct_order:"drag_drop_reorder"===de.exercise_type?de.correct_order:null,transformation_type:"sentence_transformation"===de.exercise_type?de.transformation_type:null}).select().single();if(r)throw r;s=a.id}const{error:a}=await B.from("grammar_exercise_translations").upsert({exercise_id:s,language_code:ee,question:he.question,instruction:he.instruction,correct_answer:he.correct_answer,incorrect_answers:null==(e=he.incorrect_answers)?void 0:e.filter(e=>e.trim()),explanation:he.explanation,hint:he.hint,sentence_with_blank:he.sentence_with_blank,incorrect_sentence:he.incorrect_sentence,original_sentence:he.original_sentence},{onConflict:"exercise_id,language_code"});if(a)throw a;U({title:"Success",description:ce?"Exercise updated":"Exercise created"}),le(!1),ue()}catch(s){U({title:"Error",description:s.message||"Failed to save exercise",variant:"destructive"})}finally{re(!1)}}},disabled:ae,children:ae?"Saving...":ce?"Update":"Create"})]})]})})]})})};export{O as default};
