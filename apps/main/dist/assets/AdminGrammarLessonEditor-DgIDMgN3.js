import{c as e,u as s,r as a,j as r}from"./vendor-react-rLLBBC7n.js";import{A as t}from"./AdminLayout-DGXoIbe0.js";import{d as n,s as i,C as l,a as c,S as o,i as d,j as m,k as h,l as x,b as u,c as p,L as j,I as _,T as f,B as v,e as g,D as y,f as w,g as N,h as b,X as C}from"./index-KxDfHqNJ.js";import{T as k,a as S,b as E,c as T}from"./tabs-BVz_B7Kx.js";import{S as q}from"./separator-DByOkGf1.js";import{w as z,ao as A,K as F,cv as I,av as B,aY as D,at as P,b4 as R,b5 as M,aX as V}from"./vendor-ui-BGi_EvHx.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-charts-0DeywwxG.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";const H=[{code:"en",name:"English"},{code:"zh",name:"中文 (Chinese)"},{code:"hi",name:"हिंदी (Hindi)"},{code:"es",name:"Español (Spanish)"},{code:"fr",name:"Français (French)"},{code:"ar",name:"العربية (Arabic)"},{code:"bn",name:"বাংলা (Bengali)"},{code:"pt",name:"Português (Portuguese)"},{code:"ru",name:"Русский (Russian)"},{code:"ja",name:"日本語 (Japanese)"},{code:"de",name:"Deutsch (German)"},{code:"ko",name:"한국어 (Korean)"},{code:"vi",name:"Tiếng Việt (Vietnamese)"},{code:"tr",name:"Türkçe (Turkish)"},{code:"it",name:"Italiano (Italian)"},{code:"th",name:"ไทย (Thai)"},{code:"pl",name:"Polski (Polish)"},{code:"nl",name:"Nederlands (Dutch)"},{code:"id",name:"Bahasa Indonesia"},{code:"uk",name:"Українська (Ukrainian)"},{code:"tl",name:"Tagalog (Filipino)"},{code:"ms",name:"Bahasa Melayu (Malay)"},{code:"ro",name:"Română (Romanian)"},{code:"cs",name:"Čeština (Czech)"},{code:"el",name:"Ελληνικά (Greek)"},{code:"hu",name:"Magyar (Hungarian)"},{code:"sv",name:"Svenska (Swedish)"},{code:"he",name:"עברית (Hebrew)"},{code:"fa",name:"فارسی (Persian)"}],L=[{value:"multiple_choice",label:"Multiple Choice"},{value:"fill_in_blank",label:"Fill in the Blank"},{value:"error_correction",label:"Error Correction"},{value:"sentence_transformation",label:"Sentence Transformation"},{value:"drag_drop_reorder",label:"Drag & Drop Reorder"}],O=()=>{var O;const{topicId:U}=e();s();const{toast:G}=n(),[W,$]=a.useState(null),[K,X]=a.useState(null),[Y,J]=a.useState([]),[Q,Z]=a.useState(!0),[ee,se]=a.useState("en"),[ae,re]=a.useState(!1),[te,ne]=a.useState({theory_title:"",theory_definition:"",theory_formation:"",theory_usage:"",theory_common_mistakes:"",rules:[],examples:[],localized_tips:""}),[ie,le]=a.useState(!1),[ce,oe]=a.useState(null),[de,me]=a.useState({exercise_type:"multiple_choice",difficulty:1,correct_order:[],transformation_type:""}),[he,xe]=a.useState({question:"",instruction:"",correct_answer:"",incorrect_answers:["","",""],explanation:"",hint:"",sentence_with_blank:"",incorrect_sentence:"",original_sentence:""});a.useEffect(()=>{U&&ue()},[U]),a.useEffect(()=>{K&&pe()},[K,ee]);const ue=async()=>{Z(!0);try{const{data:e,error:s}=await i.from("grammar_topics").select("\n          id,\n          slug,\n          level,\n          grammar_topic_translations(language_code, title, description)\n        ").eq("id",U).single();if(s)throw s;$({...e,translations:e.grammar_topic_translations||[]});const{data:a,error:r}=await i.from("grammar_lessons").select("*").eq("topic_id",U).order("lesson_order").limit(1).maybeSingle();if(r)throw r;if(a)X(a);else{const{data:e,error:s}=await i.from("grammar_lessons").insert({topic_id:U,lesson_order:1}).select().single();if(s)throw s;X(e)}const{data:t}=await i.from("grammar_exercises").select("*").eq("topic_id",U).order("exercise_order");J(t||[])}catch(e){console.error("Error loading data:",e),G({title:"Error",description:"Failed to load topic data",variant:"destructive"})}finally{Z(!1)}},pe=async()=>{if(!K)return;const{data:e,error:s}=await i.from("grammar_lesson_translations").select("*").eq("lesson_id",K.id).eq("language_code",ee).maybeSingle();ne(e?{...e,rules:e.rules||[],examples:e.examples||[]}:{theory_title:"",theory_definition:"",theory_formation:"",theory_usage:"",theory_common_mistakes:"",rules:[],examples:[],localized_tips:""})},je=(e,s,a)=>{ne(r=>({...r,rules:(r.rules||[]).map((r,t)=>t===e?{...r,[s]:a}:r)}))},_e=(e,s,a)=>{ne(r=>({...r,examples:(r.examples||[]).map((r,t)=>t===e?{...r,[s]:a}:r)}))},fe=async e=>{if(e){oe(e),me({exercise_type:e.exercise_type,difficulty:e.difficulty,correct_order:e.correct_order||[],transformation_type:e.transformation_type||""});const{data:s}=await i.from("grammar_exercise_translations").select("*").eq("exercise_id",e.id).eq("language_code",ee).maybeSingle();s?xe(s):ve()}else oe(null),me({exercise_type:"multiple_choice",difficulty:1,correct_order:[],transformation_type:""}),ve();le(!0)},ve=()=>{xe({question:"",instruction:"",correct_answer:"",incorrect_answers:["","",""],explanation:"",hint:"",sentence_with_blank:"",incorrect_sentence:"",original_sentence:""})};return Q?r.jsx(t,{title:"Loading...",showBackButton:!0,children:r.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):r.jsx(t,{title:`Edit: ${(()=>{const e=null==W?void 0:W.translations.find(e=>"en"===e.language_code);return(null==e?void 0:e.title)||(null==W?void 0:W.slug)||"Topic"})()}`,showBackButton:!0,backPath:"/admin/grammar",children:r.jsxs("div",{className:"space-y-6",children:[r.jsx(l,{children:r.jsx(c,{className:"p-4",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(z,{className:"w-5 h-5 text-muted-foreground"}),r.jsx("span",{className:"font-medium",children:"Content Language:"})]}),r.jsxs(o,{value:ee,onValueChange:se,children:[r.jsx(d,{className:"w-[200px]",children:r.jsx(m,{})}),r.jsx(h,{children:H.map(e=>r.jsx(x,{value:e.code,children:e.name},e.code))})]})]})})}),r.jsxs(k,{defaultValue:"theory",children:[r.jsxs(S,{className:"grid w-full grid-cols-2 max-w-md",children:[r.jsxs(E,{value:"theory",children:[r.jsx(A,{className:"w-4 h-4 mr-2"}),"Theory & Content"]}),r.jsxs(E,{value:"exercises",children:[r.jsx(F,{className:"w-4 h-4 mr-2"}),"Exercises (",Y.length,")"]})]}),r.jsxs(T,{value:"theory",className:"space-y-6 mt-6",children:[r.jsxs(l,{children:[r.jsx(u,{children:r.jsxs(p,{className:"flex items-center gap-2",children:[r.jsx(I,{className:"w-5 h-5 text-amber-500"}),"Definition"]})}),r.jsxs(c,{className:"space-y-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(j,{children:"Title"}),r.jsx(_,{value:te.theory_title||"",onChange:e=>ne({...te,theory_title:e.target.value}),placeholder:"What is Present Simple?"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(j,{children:"Definition / Explanation"}),r.jsx(f,{value:te.theory_definition||"",onChange:e=>ne({...te,theory_definition:e.target.value}),placeholder:"The present simple tense is used to describe...",rows:5})]})]})]}),r.jsxs(l,{children:[r.jsx(u,{children:r.jsxs(p,{className:"flex items-center gap-2",children:[r.jsx(F,{className:"w-5 h-5 text-blue-500"}),"How to Form It"]})}),r.jsxs(c,{className:"space-y-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(j,{children:"Formation Explanation"}),r.jsx(f,{value:te.theory_formation||"",onChange:e=>ne({...te,theory_formation:e.target.value}),placeholder:"To form the present simple, use the base form of the verb...",rows:4})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx(j,{children:"Grammar Rules / Formulas"}),r.jsxs(v,{variant:"outline",size:"sm",onClick:()=>{ne(e=>({...e,rules:[...e.rules||[],{title:"",formula:"",example:""}]}))},children:[r.jsx(B,{className:"w-4 h-4 mr-1"}),"Add Rule"]})]}),(te.rules||[]).map((e,s)=>r.jsxs("div",{className:"p-4 border rounded-lg space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("span",{className:"font-medium",children:["Rule ",s+1]}),r.jsx(v,{variant:"ghost",size:"sm",onClick:()=>(e=>{ne(s=>({...s,rules:(s.rules||[]).filter((s,a)=>a!==e)}))})(s),children:r.jsx(D,{className:"w-4 h-4 text-red-500"})})]}),r.jsx(_,{placeholder:"Rule title (e.g., Affirmative)",value:e.title,onChange:e=>je(s,"title",e.target.value)}),r.jsx(_,{placeholder:"Formula (e.g., Subject + Verb(s/es) + Object)",value:e.formula,onChange:e=>je(s,"formula",e.target.value),className:"font-mono"}),r.jsx(_,{placeholder:"Example sentence",value:e.example,onChange:e=>je(s,"example",e.target.value)})]},s))]})]})]}),r.jsxs(l,{children:[r.jsx(u,{children:r.jsxs(p,{className:"flex items-center gap-2",children:[r.jsx(P,{className:"w-5 h-5 text-emerald-500"}),"When to Use It"]})}),r.jsx(c,{children:r.jsx(f,{value:te.theory_usage||"",onChange:e=>ne({...te,theory_usage:e.target.value}),placeholder:"Use present simple when talking about habits, facts, schedules...",rows:5})})]}),r.jsxs(l,{children:[r.jsx(u,{children:r.jsxs(p,{className:"flex items-center justify-between",children:[r.jsxs("span",{className:"flex items-center gap-2",children:[r.jsx(A,{className:"w-5 h-5 text-purple-500"}),"Examples"]}),r.jsxs(v,{variant:"outline",size:"sm",onClick:()=>{ne(e=>({...e,examples:[...e.examples||[],{sentence:"",translation:"",correct:!0}]}))},children:[r.jsx(B,{className:"w-4 h-4 mr-1"}),"Add Example"]})]})}),r.jsx(c,{className:"space-y-3",children:(te.examples||[]).map((e,s)=>r.jsxs("div",{className:"p-4 border rounded-lg space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("span",{className:"font-medium",children:["Example ",s+1]}),r.jsx(g,{variant:e.correct?"default":"destructive",className:"cursor-pointer",onClick:()=>_e(s,"correct",!e.correct),children:e.correct?"Correct":"Incorrect"})]}),r.jsx(v,{variant:"ghost",size:"sm",onClick:()=>(e=>{ne(s=>({...s,examples:(s.examples||[]).filter((s,a)=>a!==e)}))})(s),children:r.jsx(D,{className:"w-4 h-4 text-red-500"})})]}),r.jsx(_,{placeholder:"Example sentence",value:e.sentence,onChange:e=>_e(s,"sentence",e.target.value)}),r.jsx(_,{placeholder:"Translation (optional)",value:e.translation||"",onChange:e=>_e(s,"translation",e.target.value)})]},s))})]}),r.jsxs(l,{className:"border-amber-200",children:[r.jsx(u,{children:r.jsxs(p,{className:"flex items-center gap-2 text-amber-700",children:[r.jsx(R,{className:"w-5 h-5"}),"Common Mistakes to Avoid"]})}),r.jsx(c,{children:r.jsx(f,{value:te.theory_common_mistakes||"",onChange:e=>ne({...te,theory_common_mistakes:e.target.value}),placeholder:"Common mistakes learners make...",rows:4})})]}),r.jsxs(l,{className:"border-purple-200",children:[r.jsx(u,{children:r.jsxs(p,{className:"flex items-center gap-2 text-purple-700",children:[r.jsx(z,{className:"w-5 h-5"}),"Tips for ",null==(O=H.find(e=>e.code===ee))?void 0:O.name," Speakers"]})}),r.jsx(c,{children:r.jsx(f,{value:te.localized_tips||"",onChange:e=>ne({...te,localized_tips:e.target.value}),placeholder:"Specific tips for speakers of this language...",rows:4})})]}),r.jsx("div",{className:"flex justify-end",children:r.jsxs(v,{onClick:async()=>{var e;if(K){re(!0);try{const{error:s}=await i.from("grammar_lesson_translations").upsert({lesson_id:K.id,language_code:ee,theory_title:te.theory_title,theory_definition:te.theory_definition,theory_formation:te.theory_formation,theory_usage:te.theory_usage,theory_common_mistakes:te.theory_common_mistakes,rules:te.rules,examples:te.examples,localized_tips:te.localized_tips},{onConflict:"lesson_id,language_code"});if(s)throw s;G({title:"Success",description:`Lesson content saved for ${null==(e=H.find(e=>e.code===ee))?void 0:e.name}`})}catch(s){G({title:"Error",description:s.message||"Failed to save lesson",variant:"destructive"})}finally{re(!1)}}},disabled:ae,children:[r.jsx(M,{className:"w-4 h-4 mr-2"}),ae?"Saving...":"Save Lesson Content"]})})]}),r.jsxs(T,{value:"exercises",className:"space-y-6 mt-6",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("p",{className:"text-sm text-muted-foreground",children:"Create interactive exercises for students to practice."}),r.jsxs(v,{onClick:()=>fe(),children:[r.jsx(B,{className:"w-4 h-4 mr-2"}),"Add Exercise"]})]}),0===Y.length?r.jsxs(l,{className:"p-8 text-center",children:[r.jsx(F,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),r.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Exercises Yet"}),r.jsx("p",{className:"text-muted-foreground mb-4",children:"Add exercises to help students practice this grammar topic."}),r.jsxs(v,{onClick:()=>fe(),children:[r.jsx(B,{className:"w-4 h-4 mr-2"}),"Create First Exercise"]})]}):r.jsx("div",{className:"space-y-3",children:Y.map((e,s)=>{var a;return r.jsx(l,{children:r.jsx(c,{className:"p-4",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center text-sm font-medium",children:s+1}),r.jsx("div",{children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(g,{variant:"secondary",children:null==(a=L.find(s=>s.value===e.exercise_type))?void 0:a.label}),r.jsxs(g,{variant:"outline",children:["Difficulty: ",e.difficulty]})]})})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(v,{variant:"outline",size:"sm",onClick:()=>fe(e),children:r.jsx(V,{className:"w-4 h-4"})}),r.jsx(v,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(confirm("Delete this exercise?"))try{const{error:s}=await i.from("grammar_exercises").delete().eq("id",e);if(s)throw s;G({title:"Success",description:"Exercise deleted"}),ue()}catch(s){G({title:"Error",description:s.message||"Failed to delete exercise",variant:"destructive"})}})(e.id),children:r.jsx(D,{className:"w-4 h-4 text-red-500"})})]})]})})},e.id)})})]})]}),r.jsx(y,{open:ie,onOpenChange:le,children:r.jsxs(w,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[r.jsx(N,{children:r.jsx(b,{children:ce?"Edit Exercise":"Add New Exercise"})}),r.jsxs("div",{className:"space-y-4 py-4",children:[r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(j,{children:"Exercise Type"}),r.jsxs(o,{value:de.exercise_type,onValueChange:e=>me({...de,exercise_type:e}),children:[r.jsx(d,{children:r.jsx(m,{})}),r.jsx(h,{children:L.map(e=>r.jsx(x,{value:e.value,children:e.label},e.value))})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(j,{children:"Difficulty (1-3)"}),r.jsxs(o,{value:String(de.difficulty),onValueChange:e=>me({...de,difficulty:parseInt(e)}),children:[r.jsx(d,{children:r.jsx(m,{})}),r.jsxs(h,{children:[r.jsx(x,{value:"1",children:"1 - Easy"}),r.jsx(x,{value:"2",children:"2 - Medium"}),r.jsx(x,{value:"3",children:"3 - Hard"})]})]})]})]}),r.jsx(q,{}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(j,{children:"Question / Prompt"}),r.jsx(f,{value:he.question||"",onChange:e=>xe({...he,question:e.target.value}),placeholder:"Enter the question or prompt...",rows:2})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(j,{children:"Instruction (optional)"}),r.jsx(_,{value:he.instruction||"",onChange:e=>xe({...he,instruction:e.target.value}),placeholder:"Choose the correct answer..."})]}),"fill_in_blank"===de.exercise_type&&r.jsxs("div",{className:"space-y-2",children:[r.jsx(j,{children:"Sentence with blank (use ___ for blank)"}),r.jsx(_,{value:he.sentence_with_blank||"",onChange:e=>xe({...he,sentence_with_blank:e.target.value}),placeholder:"She ___ to school every day."})]}),"error_correction"===de.exercise_type&&r.jsxs("div",{className:"space-y-2",children:[r.jsx(j,{children:"Incorrect Sentence (with error)"}),r.jsx(_,{value:he.incorrect_sentence||"",onChange:e=>xe({...he,incorrect_sentence:e.target.value}),placeholder:"She go to school every day."})]}),"sentence_transformation"===de.exercise_type&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(j,{children:"Transformation Type"}),r.jsx(_,{value:de.transformation_type||"",onChange:e=>me({...de,transformation_type:e.target.value}),placeholder:"Active to Passive"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(j,{children:"Original Sentence"}),r.jsx(_,{value:he.original_sentence||"",onChange:e=>xe({...he,original_sentence:e.target.value}),placeholder:"The cat eats the fish."})]})]}),"drag_drop_reorder"===de.exercise_type&&r.jsxs("div",{className:"space-y-2",children:[r.jsx(j,{children:"Correct Word Order (comma-separated)"}),r.jsx(_,{value:de.correct_order.join(", "),onChange:e=>me({...de,correct_order:e.target.value.split(",").map(e=>e.trim()).filter(Boolean)}),placeholder:"She, goes, to, school, every, day"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(j,{children:"Correct Answer"}),r.jsx(_,{value:he.correct_answer||"",onChange:e=>xe({...he,correct_answer:e.target.value}),placeholder:"The correct answer..."})]}),"multiple_choice"===de.exercise_type&&r.jsxs("div",{className:"space-y-2",children:[r.jsx(j,{children:"Incorrect Answers (one per line)"}),(he.incorrect_answers||["","",""]).map((e,s)=>r.jsx(_,{value:e,onChange:e=>{const a=[...he.incorrect_answers||["","",""]];a[s]=e.target.value,xe({...he,incorrect_answers:a})},placeholder:`Incorrect answer ${s+1}`},s))]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(j,{children:"Explanation (shown after answering)"}),r.jsx(f,{value:he.explanation||"",onChange:e=>xe({...he,explanation:e.target.value}),placeholder:"Explain why this is the correct answer...",rows:2})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(j,{children:"Hint (optional)"}),r.jsx(_,{value:he.hint||"",onChange:e=>xe({...he,hint:e.target.value}),placeholder:"A helpful hint..."})]})]}),r.jsxs(C,{children:[r.jsx(v,{variant:"outline",onClick:()=>le(!1),children:"Cancel"}),r.jsx(v,{onClick:async()=>{var e;if(U){re(!0);try{let s=null==ce?void 0:ce.id;if(ce){const{error:e}=await i.from("grammar_exercises").update({exercise_type:de.exercise_type,difficulty:de.difficulty,correct_order:"drag_drop_reorder"===de.exercise_type?de.correct_order:null,transformation_type:"sentence_transformation"===de.exercise_type?de.transformation_type:null}).eq("id",ce.id);if(e)throw e}else{const e=Y.length>0?Math.max(...Y.map(e=>e.exercise_order)):0,{data:a,error:r}=await i.from("grammar_exercises").insert({topic_id:U,exercise_type:de.exercise_type,difficulty:de.difficulty,exercise_order:e+1,correct_order:"drag_drop_reorder"===de.exercise_type?de.correct_order:null,transformation_type:"sentence_transformation"===de.exercise_type?de.transformation_type:null}).select().single();if(r)throw r;s=a.id}const{error:a}=await i.from("grammar_exercise_translations").upsert({exercise_id:s,language_code:ee,question:he.question,instruction:he.instruction,correct_answer:he.correct_answer,incorrect_answers:null==(e=he.incorrect_answers)?void 0:e.filter(e=>e.trim()),explanation:he.explanation,hint:he.hint,sentence_with_blank:he.sentence_with_blank,incorrect_sentence:he.incorrect_sentence,original_sentence:he.original_sentence},{onConflict:"exercise_id,language_code"});if(a)throw a;G({title:"Success",description:ce?"Exercise updated":"Exercise created"}),le(!1),ue()}catch(s){G({title:"Error",description:s.message||"Failed to save exercise",variant:"destructive"})}finally{re(!1)}}},disabled:ae,children:ae?"Saving...":ce?"Update":"Create"})]})]})})]})})};export{O as default};
