import{u as e,r as s,j as t}from"./vendor-react-rLLBBC7n.js";import{n as a,u as l,e as r,C as n,b as i,c,a as o,I as d,B as m,o as x,s as h,J as j}from"./index-BDl0jLJK.js";import{T as u,a as g,b as p,c as f}from"./tabs-CFW1rRMF.js";import{S as N}from"./separator-C0bogF69.js";import{A as y,a as v,b,c as w,d as T,e as k,f as S,g as C,h as E}from"./alert-dialog-C3e0CSUs.js";import{A as L}from"./AdminLayout-DwaN-V0p.js";import{C as I}from"./CSVImport-DRYKTZAg.js";import{S as A}from"./skills-NqzSOyzV.js";import{ao as _,aZ as M,aQ as q,aJ as P,ax as R,aO as z,q as F,X as $,a_ as D,aY as V,aV as B}from"./vendor-ui-BGi_EvHx.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-charts-0DeywwxG.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";import"./alert-DtyL8j6a.js";const K=()=>{const K=e(),{admin:Q,loading:W}=a();l();const[J,U]=s.useState([]),[Y,O]=s.useState(!1),[Z,G]=s.useState(""),[H,X]=s.useState(null),[ee,se]=s.useState(""),[te,ae]=s.useState({totalTests:0,activeStudents:0,completionRate:0,avgScore:0}),le=async()=>{try{const{data:e,error:s}=await h.from("tests").select("*").eq("test_type","IELTS").is("skill_category",null).order("created_at",{ascending:!0});if(s)throw s;U(e||[]),ae(s=>({...s,totalTests:(e||[]).length}))}catch(e){console.error("Error loading tests:",e),j.error("Failed to load tests")}},re=async()=>{if(Z.trim()){O(!0);try{const{data:e}=await h.from("tests").insert({test_name:Z,test_type:"IELTS",module:"academic",skill_category:null}).select().single();j.success("Test created successfully"),G(""),le(),e&&K(`/admin/ielts/test/${e.id}`)}catch(e){console.error("Error creating test:",e),j.error("Failed to create test")}finally{O(!1)}}else j.error("Please enter a test name")},ne=()=>{X(null),se("")},ie=async()=>{if(ee.trim())try{const{error:e}=await h.from("tests").update({test_name:ee}).eq("id",H);if(e)throw e;j.success("Test name updated successfully"),X(null),se(""),le()}catch(e){console.error("Error updating test name:",e),j.error("Failed to update test name")}else j.error("Test name cannot be empty")},ce=e=>{K(`/admin/ielts/${e.toLowerCase()}`)};return s.useEffect(()=>{console.log("ðŸš€ AdminIELTS auth check:",{loading:W,admin:!!Q}),W||(Q?(console.log("âœ… Admin access confirmed, loading tests"),le()):(console.log("ðŸ”„ Redirecting to login - no admin access"),K("/admin/login")))},[Q,W,K]),W?t.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),t.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading IELTS Admin..."})]})}):Q?t.jsx(L,{title:"IELTS Administration",showBackButton:!0,backPath:"/admin",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold tracking-tight bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",children:"IELTS Admin Portal"}),t.jsx("p",{className:"text-muted-foreground",children:"Manage IELTS content, tests, and student progress"})]}),t.jsx(r,{variant:"secondary",className:"text-sm",children:"IELTS Module"})]}),t.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[t.jsxs(n,{children:[t.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(c,{className:"text-sm font-medium",children:"Total Tests"}),t.jsx(_,{className:"h-4 w-4 text-muted-foreground"})]}),t.jsxs(o,{children:[t.jsx("div",{className:"text-2xl font-bold",children:te.totalTests}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"IELTS practice tests"})]})]}),t.jsxs(n,{children:[t.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(c,{className:"text-sm font-medium",children:"Active Students"}),t.jsx(M,{className:"h-4 w-4 text-muted-foreground"})]}),t.jsxs(o,{children:[t.jsx("div",{className:"text-2xl font-bold",children:te.activeStudents}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Currently enrolled"})]})]}),t.jsxs(n,{children:[t.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(c,{className:"text-sm font-medium",children:"Completion Rate"}),t.jsx(q,{className:"h-4 w-4 text-muted-foreground"})]}),t.jsxs(o,{children:[t.jsxs("div",{className:"text-2xl font-bold",children:[te.completionRate,"%"]}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Test completion"})]})]}),t.jsxs(n,{children:[t.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(c,{className:"text-sm font-medium",children:"Average Score"}),t.jsx(q,{className:"h-4 w-4 text-muted-foreground"})]}),t.jsxs(o,{children:[t.jsx("div",{className:"text-2xl font-bold",children:te.avgScore}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Band score"})]})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("h3",{className:"text-xl font-semibold",children:"IELTS Test Management"}),t.jsx("p",{className:"text-muted-foreground",children:"Manage IELTS tests organized by the four core skills. Each skill has a quick create option."}),t.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[{skill:"Listening",icon:P,path:"/admin/ielts/listening",createTest:()=>ce("Listening")},{skill:"Reading",icon:_,path:"/admin/ielts/reading",createTest:()=>ce("Reading")},{skill:"Writing",icon:R,path:"/admin/ielts/writing",createTest:()=>ce("Writing")},{skill:"Speaking",icon:z,path:"/admin/ielts/speaking",createTest:()=>ce("Speaking")}].map(e=>t.jsxs(n,{className:"hover:shadow-lg transition-all duration-300 cursor-pointer border-border/40 bg-card/50 backdrop-blur-sm hover:bg-card/80",onClick:()=>K(e.path),children:[t.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsxs(c,{className:"text-lg font-semibold",children:[e.skill," Tests"]}),t.jsx(e.icon,{className:"h-5 w-5 text-primary"})]}),t.jsxs(o,{className:"space-y-3",children:[t.jsxs("p",{className:"text-sm text-muted-foreground",children:["Manage ",e.skill.toLowerCase()," test content and settings"]}),t.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[t.jsx("span",{children:"Click to manage tests"}),t.jsx("span",{className:"text-primary font-medium",children:"â†’"})]})]})]},e.skill))})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("h3",{className:"text-xl font-semibold",children:"Sharpen Your Skills"}),t.jsx("p",{className:"text-muted-foreground",children:"Manage 8 targeted skill drills. Changes appear instantly for students."}),t.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-4",children:A.map(e=>t.jsxs(n,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>K(`/admin/skills/${e.slug}`),children:[t.jsx(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:t.jsx(c,{className:"text-sm font-medium",children:e.label})}),t.jsx(o,{children:t.jsx("p",{className:"text-xs text-muted-foreground",children:"Add and manage questions for this skill"})})]},e.slug))})]}),t.jsx(N,{}),t.jsxs(u,{defaultValue:"content",className:"space-y-4",children:[t.jsxs(g,{className:"grid w-full grid-cols-3",children:[t.jsx(p,{value:"content",children:"Content Management"}),t.jsx(p,{value:"upload",children:"Upload Content"}),t.jsx(p,{value:"analytics",children:"Analytics"})]}),t.jsx(f,{value:"content",className:"space-y-4",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-xl font-semibold",children:"Multi-skill IELTS Tests"}),t.jsx("p",{className:"text-muted-foreground",children:"Manage complete IELTS tests with all 4 sections"})]}),t.jsxs("div",{className:"flex gap-3 items-end",children:[t.jsx(d,{placeholder:"Test name (e.g., IELTS Test 1)",value:Z,onChange:e=>G(e.target.value),onKeyPress:e=>"Enter"===e.key&&re(),className:"max-w-sm"}),t.jsx(m,{onClick:re,disabled:Y,children:Y?"Creating...":"Create Test"})]})]}),J.length>0?t.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:J.map(e=>t.jsxs(n,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>!H&&K(`/admin/ielts/test/${e.id}`),children:[t.jsxs(i,{children:[t.jsxs(c,{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(_,{className:"w-5 h-5 text-primary"}),H===e.id?t.jsxs("div",{className:"flex items-center space-x-2",onClick:e=>e.stopPropagation(),children:[t.jsx(d,{value:ee,onChange:e=>se(e.target.value),className:"text-lg font-semibold h-8",onKeyPress:e=>"Enter"===e.key&&ie()}),t.jsx(m,{size:"sm",variant:"ghost",onClick:ie,children:t.jsx(F,{className:"w-4 h-4 text-green-600"})}),t.jsx(m,{size:"sm",variant:"ghost",onClick:ne,children:t.jsx($,{className:"w-4 h-4 text-red-600"})})]}):t.jsx("span",{children:e.test_name})]}),H!==e.id&&t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(m,{size:"sm",variant:"ghost",onClick:s=>{s.stopPropagation(),(e=>{X(e.id),se(e.test_name)})(e)},children:t.jsx(D,{className:"w-4 h-4"})}),t.jsxs(y,{children:[t.jsx(v,{asChild:!0,children:t.jsx(m,{size:"sm",variant:"ghost",onClick:e=>e.stopPropagation(),children:t.jsx(V,{className:"w-4 h-4 text-red-600"})})}),t.jsxs(b,{children:[t.jsxs(w,{children:[t.jsx(T,{children:"Delete Test"}),t.jsxs(k,{children:['Are you sure you want to delete "',e.test_name,'"? This will also delete all questions associated with this test. This action cannot be undone.']})]}),t.jsxs(S,{children:[t.jsx(C,{children:"Cancel"}),t.jsx(E,{onClick:()=>(async(e,s)=>{try{console.log("ðŸ—‘ï¸ Starting delete process for test:",e);const{error:t}=await h.from("questions").delete().eq("test_id",e);if(t)return console.error("âŒ Error deleting questions:",t),void j.error("Failed to delete associated questions");console.log("âœ… Questions deleted successfully");const{error:a,data:l}=await h.from("tests").delete().eq("id",e).select();if(a)throw console.error("âŒ Error deleting test:",a),a;if(console.log("âœ… Deleted test data:",l),!l||0===l.length)return console.warn("âš ï¸ No test was deleted - test may not exist or access denied"),void j.error("Test not found or access denied");j.success(`Test "${s}" deleted successfully`),setTimeout(()=>{le()},500)}catch(t){console.error("âŒ Error deleting test:",t),j.error("Failed to delete test")}})(e.id,e.test_name),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]}),t.jsxs(x,{children:["Created: ",new Date(e.created_at).toLocaleDateString()]})]}),t.jsxs(o,{children:[t.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[t.jsx("span",{children:"Type: Multi-skill IELTS Test"}),t.jsx("span",{children:"Sections: 4 (L,R,W,S)"})]}),t.jsx(m,{size:"sm",className:"w-full mt-3",onClick:s=>{s.stopPropagation(),K(`/admin/ielts/test/${e.id}`)},disabled:H===e.id,children:"Manage All Sections"})]})]},e.id))}):t.jsxs("div",{className:"text-center py-12",children:[t.jsx(_,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Multi-skill IELTS tests found"}),t.jsx("p",{className:"text-muted-foreground mb-4",children:"Create your first multi-skill IELTS test with all 4 sections"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx(d,{placeholder:"Test name (e.g., IELTS Test 1)",value:Z,onChange:e=>G(e.target.value),onKeyPress:e=>"Enter"===e.key&&re(),className:"max-w-sm mx-auto"}),t.jsx(m,{onClick:re,disabled:Y,children:Y?"Creating...":"Create First Multi-skill Test"})]})]})]})}),t.jsx(f,{value:"upload",className:"space-y-4",children:t.jsxs(n,{children:[t.jsxs(i,{children:[t.jsxs(c,{className:"flex items-center space-x-2",children:[t.jsx(B,{className:"h-5 w-5"}),t.jsx("span",{children:"Upload IELTS Content"})]}),t.jsx(x,{children:"Import IELTS questions, passages, and audio content via CSV"})]}),t.jsx(o,{children:t.jsx(I,{onImport:()=>{},onQuestionsPreview:()=>{},type:"reading"})})]})}),t.jsx(f,{value:"analytics",className:"space-y-4",children:t.jsxs(n,{children:[t.jsxs(i,{children:[t.jsxs(c,{className:"flex items-center space-x-2",children:[t.jsx(q,{className:"h-5 w-5"}),t.jsx("span",{children:"IELTS Analytics"})]}),t.jsx(x,{children:"View performance metrics and student progress"})]}),t.jsx(o,{children:t.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[t.jsx(q,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),t.jsx("p",{children:"Analytics dashboard coming soon"}),t.jsx("p",{className:"text-sm",children:"Track student performance and test completion rates"})]})})]})})]})]})}):null};export{K as default};
