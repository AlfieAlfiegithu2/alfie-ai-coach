import{u as e,v as s,f as t,r as a,j as l,k as r,C as i,b as n,c,d as o,a as d,H as m,e as x,M as h,I as j,B as u,w as g,X as p,x as f,J as N}from"./index-ZP4Rea1h.js";import{T as y,a as w,b,c as v}from"./tabs-oJ0C-J_u.js";import{S as T}from"./separator-BmqQ6VMo.js";import{A as k,a as S,b as C,c as E,d as L,e as I,f as A,g as M,h as P}from"./alert-dialog-DiJbeiNB.js";import{A as _}from"./AdminLayout-o6A4ojxN.js";import{C as q}from"./CSVImport-C0Ie5XzM.js";import{s as z}from"./supabase-DUkWVuqu.js";import{S as R}from"./skills-NqzSOyzV.js";import{U as D}from"./users-BGrW77x3.js";import{C as F}from"./chart-column-pYyI0TtM.js";import{P as $}from"./pen-line-DC3CQIuW.js";import{T as B}from"./trash-2-CQ-hwedK.js";import{U as K}from"./upload-BEi9xynY.js";import"./alert--VHyh-vL.js";import"./file-text-C3fJ3u3O.js";import"./circle-alert-Dqp2LUNR.js";import"./circle-help-B3spld9P.js";import"./download-BDS2aXSm.js";const U=()=>{const U=e(),{admin:V,loading:Q}=s();t();const[W,H]=a.useState([]),[J,G]=a.useState(!1),[O,Y]=a.useState(""),[X,Z]=a.useState(null),[ee,se]=a.useState(""),[te,ae]=a.useState({totalTests:0,activeStudents:0,completionRate:0,avgScore:0}),le=async()=>{try{const{data:e,error:s}=await z.from("tests").select("*").eq("test_type","IELTS").is("skill_category",null).order("created_at",{ascending:!0});if(s)throw s;H(e||[]),ae(s=>({...s,totalTests:(e||[]).length}))}catch(e){console.error("Error loading tests:",e),N.error("Failed to load tests")}},re=async()=>{if(O.trim()){G(!0);try{const{data:e}=await z.from("tests").insert({test_name:O,test_type:"IELTS",module:"academic",skill_category:null}).select().single();N.success("Test created successfully"),Y(""),le(),e&&U(`/admin/ielts/test/${e.id}`)}catch(e){console.error("Error creating test:",e),N.error("Failed to create test")}finally{G(!1)}}else N.error("Please enter a test name")},ie=()=>{Z(null),se("")},ne=async()=>{if(ee.trim())try{const{error:e}=await z.from("tests").update({test_name:ee}).eq("id",X);if(e)throw e;N.success("Test name updated successfully"),Z(null),se(""),le()}catch(e){console.error("Error updating test name:",e),N.error("Failed to update test name")}else N.error("Test name cannot be empty")},ce=e=>{U(`/admin/ielts/${e.toLowerCase()}`)};return a.useEffect(()=>{console.log("ðŸš€ AdminIELTS auth check:",{loading:Q,admin:!!V}),Q||(V?(console.log("âœ… Admin access confirmed, loading tests"),le()):(console.log("ðŸ”„ Redirecting to login - no admin access"),U("/admin/login")))},[V,Q,U]),Q?l.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),l.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading IELTS Admin..."})]})}):V?l.jsx(_,{title:"IELTS Administration",showBackButton:!0,backPath:"/admin",children:l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-3xl font-bold tracking-tight bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",children:"IELTS Admin Portal"}),l.jsx("p",{className:"text-muted-foreground",children:"Manage IELTS content, tests, and student progress"})]}),l.jsx(r,{variant:"secondary",className:"text-sm",children:"IELTS Module"})]}),l.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[l.jsxs(i,{children:[l.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[l.jsx(c,{className:"text-sm font-medium",children:"Total Tests"}),l.jsx(o,{className:"h-4 w-4 text-muted-foreground"})]}),l.jsxs(d,{children:[l.jsx("div",{className:"text-2xl font-bold",children:te.totalTests}),l.jsx("p",{className:"text-xs text-muted-foreground",children:"IELTS practice tests"})]})]}),l.jsxs(i,{children:[l.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[l.jsx(c,{className:"text-sm font-medium",children:"Active Students"}),l.jsx(D,{className:"h-4 w-4 text-muted-foreground"})]}),l.jsxs(d,{children:[l.jsx("div",{className:"text-2xl font-bold",children:te.activeStudents}),l.jsx("p",{className:"text-xs text-muted-foreground",children:"Currently enrolled"})]})]}),l.jsxs(i,{children:[l.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[l.jsx(c,{className:"text-sm font-medium",children:"Completion Rate"}),l.jsx(F,{className:"h-4 w-4 text-muted-foreground"})]}),l.jsxs(d,{children:[l.jsxs("div",{className:"text-2xl font-bold",children:[te.completionRate,"%"]}),l.jsx("p",{className:"text-xs text-muted-foreground",children:"Test completion"})]})]}),l.jsxs(i,{children:[l.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[l.jsx(c,{className:"text-sm font-medium",children:"Average Score"}),l.jsx(F,{className:"h-4 w-4 text-muted-foreground"})]}),l.jsxs(d,{children:[l.jsx("div",{className:"text-2xl font-bold",children:te.avgScore}),l.jsx("p",{className:"text-xs text-muted-foreground",children:"Band score"})]})]})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-xl font-semibold",children:"IELTS Test Management"}),l.jsx("p",{className:"text-muted-foreground",children:"Manage IELTS tests organized by the four core skills. Each skill has a quick create option."}),l.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[{skill:"Listening",icon:m,path:"/admin/ielts/listening",createTest:()=>ce("Listening")},{skill:"Reading",icon:o,path:"/admin/ielts/reading",createTest:()=>ce("Reading")},{skill:"Writing",icon:x,path:"/admin/ielts/writing",createTest:()=>ce("Writing")},{skill:"Speaking",icon:h,path:"/admin/ielts/speaking",createTest:()=>ce("Speaking")}].map(e=>l.jsxs(i,{className:"hover:shadow-lg transition-all duration-300 cursor-pointer border-border/40 bg-card/50 backdrop-blur-sm hover:bg-card/80",onClick:()=>U(e.path),children:[l.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[l.jsxs(c,{className:"text-lg font-semibold",children:[e.skill," Tests"]}),l.jsx(e.icon,{className:"h-5 w-5 text-primary"})]}),l.jsxs(d,{className:"space-y-3",children:[l.jsxs("p",{className:"text-sm text-muted-foreground",children:["Manage ",e.skill.toLowerCase()," test content and settings"]}),l.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[l.jsx("span",{children:"Click to manage tests"}),l.jsx("span",{className:"text-primary font-medium",children:"â†’"})]})]})]},e.skill))})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-xl font-semibold",children:"Sharpen Your Skills"}),l.jsx("p",{className:"text-muted-foreground",children:"Manage 8 targeted skill drills. Changes appear instantly for students."}),l.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-4",children:R.map(e=>l.jsxs(i,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>U(`/admin/skills/${e.slug}`),children:[l.jsx(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:l.jsx(c,{className:"text-sm font-medium",children:e.label})}),l.jsx(d,{children:l.jsx("p",{className:"text-xs text-muted-foreground",children:"Add and manage questions for this skill"})})]},e.slug))})]}),l.jsx(T,{}),l.jsxs(y,{defaultValue:"content",className:"space-y-4",children:[l.jsxs(w,{className:"grid w-full grid-cols-3",children:[l.jsx(b,{value:"content",children:"Content Management"}),l.jsx(b,{value:"upload",children:"Upload Content"}),l.jsx(b,{value:"analytics",children:"Analytics"})]}),l.jsx(v,{value:"content",className:"space-y-4",children:l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("h3",{className:"text-xl font-semibold",children:"Multi-skill IELTS Tests"}),l.jsx("p",{className:"text-muted-foreground",children:"Manage complete IELTS tests with all 4 sections"})]}),l.jsxs("div",{className:"flex gap-3 items-end",children:[l.jsx(j,{placeholder:"Test name (e.g., IELTS Test 1)",value:O,onChange:e=>Y(e.target.value),onKeyPress:e=>"Enter"===e.key&&re(),className:"max-w-sm"}),l.jsx(u,{onClick:re,disabled:J,children:J?"Creating...":"Create Test"})]})]}),W.length>0?l.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:W.map(e=>l.jsxs(i,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>!X&&U(`/admin/ielts/test/${e.id}`),children:[l.jsxs(n,{children:[l.jsxs(c,{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx(o,{className:"w-5 h-5 text-primary"}),X===e.id?l.jsxs("div",{className:"flex items-center space-x-2",onClick:e=>e.stopPropagation(),children:[l.jsx(j,{value:ee,onChange:e=>se(e.target.value),className:"text-lg font-semibold h-8",onKeyPress:e=>"Enter"===e.key&&ne()}),l.jsx(u,{size:"sm",variant:"ghost",onClick:ne,children:l.jsx(g,{className:"w-4 h-4 text-green-600"})}),l.jsx(u,{size:"sm",variant:"ghost",onClick:ie,children:l.jsx(p,{className:"w-4 h-4 text-red-600"})})]}):l.jsx("span",{children:e.test_name})]}),X!==e.id&&l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(u,{size:"sm",variant:"ghost",onClick:s=>{s.stopPropagation(),(e=>{Z(e.id),se(e.test_name)})(e)},children:l.jsx($,{className:"w-4 h-4"})}),l.jsxs(k,{children:[l.jsx(S,{asChild:!0,children:l.jsx(u,{size:"sm",variant:"ghost",onClick:e=>e.stopPropagation(),children:l.jsx(B,{className:"w-4 h-4 text-red-600"})})}),l.jsxs(C,{children:[l.jsxs(E,{children:[l.jsx(L,{children:"Delete Test"}),l.jsxs(I,{children:['Are you sure you want to delete "',e.test_name,'"? This will also delete all questions associated with this test. This action cannot be undone.']})]}),l.jsxs(A,{children:[l.jsx(M,{children:"Cancel"}),l.jsx(P,{onClick:()=>(async(e,s)=>{try{console.log("ðŸ—‘ï¸ Starting delete process for test:",e);const{error:t}=await z.from("questions").delete().eq("test_id",e);if(t)return console.error("âŒ Error deleting questions:",t),void N.error("Failed to delete associated questions");console.log("âœ… Questions deleted successfully");const{error:a,data:l}=await z.from("tests").delete().eq("id",e).select();if(a)throw console.error("âŒ Error deleting test:",a),a;if(console.log("âœ… Deleted test data:",l),!l||0===l.length)return console.warn("âš ï¸ No test was deleted - test may not exist or access denied"),void N.error("Test not found or access denied");N.success(`Test "${s}" deleted successfully`),setTimeout(()=>{le()},500)}catch(t){console.error("âŒ Error deleting test:",t),N.error("Failed to delete test")}})(e.id,e.test_name),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]}),l.jsxs(f,{children:["Created: ",new Date(e.created_at).toLocaleDateString()]})]}),l.jsxs(d,{children:[l.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[l.jsx("span",{children:"Type: Multi-skill IELTS Test"}),l.jsx("span",{children:"Sections: 4 (L,R,W,S)"})]}),l.jsx(u,{size:"sm",className:"w-full mt-3",onClick:s=>{s.stopPropagation(),U(`/admin/ielts/test/${e.id}`)},disabled:X===e.id,children:"Manage All Sections"})]})]},e.id))}):l.jsxs("div",{className:"text-center py-12",children:[l.jsx(o,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),l.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Multi-skill IELTS tests found"}),l.jsx("p",{className:"text-muted-foreground mb-4",children:"Create your first multi-skill IELTS test with all 4 sections"}),l.jsxs("div",{className:"space-y-3",children:[l.jsx(j,{placeholder:"Test name (e.g., IELTS Test 1)",value:O,onChange:e=>Y(e.target.value),onKeyPress:e=>"Enter"===e.key&&re(),className:"max-w-sm mx-auto"}),l.jsx(u,{onClick:re,disabled:J,children:J?"Creating...":"Create First Multi-skill Test"})]})]})]})}),l.jsx(v,{value:"upload",className:"space-y-4",children:l.jsxs(i,{children:[l.jsxs(n,{children:[l.jsxs(c,{className:"flex items-center space-x-2",children:[l.jsx(K,{className:"h-5 w-5"}),l.jsx("span",{children:"Upload IELTS Content"})]}),l.jsx(f,{children:"Import IELTS questions, passages, and audio content via CSV"})]}),l.jsx(d,{children:l.jsx(q,{onImport:()=>{},onQuestionsPreview:()=>{},type:"reading"})})]})}),l.jsx(v,{value:"analytics",className:"space-y-4",children:l.jsxs(i,{children:[l.jsxs(n,{children:[l.jsxs(c,{className:"flex items-center space-x-2",children:[l.jsx(F,{className:"h-5 w-5"}),l.jsx("span",{children:"IELTS Analytics"})]}),l.jsx(f,{children:"View performance metrics and student progress"})]}),l.jsx(d,{children:l.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[l.jsx(F,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),l.jsx("p",{children:"Analytics dashboard coming soon"}),l.jsx("p",{className:"text-sm",children:"Track student performance and test completion rates"})]})})]})})]})]})}):null};export{U as default};
