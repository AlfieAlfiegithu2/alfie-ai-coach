import{u as e,X as s,g as t,r as a,j as l,A as n,n as r,C as i,b as c,c as d,d as o,a as m,Y as x,f as h,H as u,e as j,M as g,Z as p,_ as f,$ as N,a0 as y,a1 as w,a2 as v,I as b,B as T,a3 as k,a4 as S,a5 as C,a6 as E,a7 as L,T as I,a8 as A,a9 as M,aa as _,ab as q,ac as P,ad as R,ae as $,af as z,U as F,J as D,ag as B}from"./index-Djzz3iK_.js";import{s as K}from"./supabase-Bqkrifq5.js";const U=()=>{const U=e(),{admin:V,loading:W}=s();t();const[Q,Y]=a.useState([]),[H,J]=a.useState(!1),[X,Z]=a.useState(""),[G,O]=a.useState(null),[ee,se]=a.useState(""),[te,ae]=a.useState({totalTests:0,activeStudents:0,completionRate:0,avgScore:0}),le=async()=>{try{const{data:e,error:s}=await K.from("tests").select("*").eq("test_type","IELTS").is("skill_category",null).order("created_at",{ascending:!0});if(s)throw s;Y(e||[]),ae(s=>({...s,totalTests:(e||[]).length}))}catch(e){console.error("Error loading tests:",e),B.error("Failed to load tests")}},ne=async()=>{if(X.trim()){J(!0);try{const{data:e}=await K.from("tests").insert({test_name:X,test_type:"IELTS",module:"academic",skill_category:null}).select().single();B.success("Test created successfully"),Z(""),le(),e&&U(`/admin/ielts/test/${e.id}`)}catch(e){console.error("Error creating test:",e),B.error("Failed to create test")}finally{J(!1)}}else B.error("Please enter a test name")},re=()=>{O(null),se("")},ie=async()=>{if(ee.trim())try{const{error:e}=await K.from("tests").update({test_name:ee}).eq("id",G);if(e)throw e;B.success("Test name updated successfully"),O(null),se(""),le()}catch(e){console.error("Error updating test name:",e),B.error("Failed to update test name")}else B.error("Test name cannot be empty")},ce=e=>{U(`/admin/ielts/${e.toLowerCase()}`)};return a.useEffect(()=>{console.log("ðŸš€ AdminIELTS auth check:",{loading:W,admin:!!V}),W||(V?(console.log("âœ… Admin access confirmed, loading tests"),le()):(console.log("ðŸ”„ Redirecting to login - no admin access"),U("/admin/login")))},[V,W,U]),W?l.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),l.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading IELTS Admin..."})]})}):V?l.jsx(n,{title:"IELTS Administration",showBackButton:!0,backPath:"/admin",children:l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-3xl font-bold tracking-tight bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",children:"IELTS Admin Portal"}),l.jsx("p",{className:"text-muted-foreground",children:"Manage IELTS content, tests, and student progress"})]}),l.jsx(r,{variant:"secondary",className:"text-sm",children:"IELTS Module"})]}),l.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[l.jsxs(i,{children:[l.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[l.jsx(d,{className:"text-sm font-medium",children:"Total Tests"}),l.jsx(o,{className:"h-4 w-4 text-muted-foreground"})]}),l.jsxs(m,{children:[l.jsx("div",{className:"text-2xl font-bold",children:te.totalTests}),l.jsx("p",{className:"text-xs text-muted-foreground",children:"IELTS practice tests"})]})]}),l.jsxs(i,{children:[l.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[l.jsx(d,{className:"text-sm font-medium",children:"Active Students"}),l.jsx(x,{className:"h-4 w-4 text-muted-foreground"})]}),l.jsxs(m,{children:[l.jsx("div",{className:"text-2xl font-bold",children:te.activeStudents}),l.jsx("p",{className:"text-xs text-muted-foreground",children:"Currently enrolled"})]})]}),l.jsxs(i,{children:[l.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[l.jsx(d,{className:"text-sm font-medium",children:"Completion Rate"}),l.jsx(h,{className:"h-4 w-4 text-muted-foreground"})]}),l.jsxs(m,{children:[l.jsxs("div",{className:"text-2xl font-bold",children:[te.completionRate,"%"]}),l.jsx("p",{className:"text-xs text-muted-foreground",children:"Test completion"})]})]}),l.jsxs(i,{children:[l.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[l.jsx(d,{className:"text-sm font-medium",children:"Average Score"}),l.jsx(h,{className:"h-4 w-4 text-muted-foreground"})]}),l.jsxs(m,{children:[l.jsx("div",{className:"text-2xl font-bold",children:te.avgScore}),l.jsx("p",{className:"text-xs text-muted-foreground",children:"Band score"})]})]})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-xl font-semibold",children:"IELTS Test Management"}),l.jsx("p",{className:"text-muted-foreground",children:"Manage IELTS tests organized by the four core skills. Each skill has a quick create option."}),l.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[{skill:"Listening",icon:u,path:"/admin/ielts/listening",createTest:()=>ce("Listening")},{skill:"Reading",icon:o,path:"/admin/ielts/reading",createTest:()=>ce("Reading")},{skill:"Writing",icon:j,path:"/admin/ielts/writing",createTest:()=>ce("Writing")},{skill:"Speaking",icon:g,path:"/admin/ielts/speaking",createTest:()=>ce("Speaking")}].map(e=>l.jsxs(i,{className:"hover:shadow-lg transition-all duration-300 cursor-pointer border-border/40 bg-card/50 backdrop-blur-sm hover:bg-card/80",onClick:()=>U(e.path),children:[l.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[l.jsxs(d,{className:"text-lg font-semibold",children:[e.skill," Tests"]}),l.jsx(e.icon,{className:"h-5 w-5 text-primary"})]}),l.jsxs(m,{className:"space-y-3",children:[l.jsxs("p",{className:"text-sm text-muted-foreground",children:["Manage ",e.skill.toLowerCase()," test content and settings"]}),l.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[l.jsx("span",{children:"Click to manage tests"}),l.jsx("span",{className:"text-primary font-medium",children:"â†’"})]})]})]},e.skill))})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-xl font-semibold",children:"Sharpen Your Skills"}),l.jsx("p",{className:"text-muted-foreground",children:"Manage 8 targeted skill drills. Changes appear instantly for students."}),l.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-4",children:p.map(e=>l.jsxs(i,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>U(`/admin/skills/${e.slug}`),children:[l.jsx(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:l.jsx(d,{className:"text-sm font-medium",children:e.label})}),l.jsx(m,{children:l.jsx("p",{className:"text-xs text-muted-foreground",children:"Add and manage questions for this skill"})})]},e.slug))})]}),l.jsx(f,{}),l.jsxs(N,{defaultValue:"content",className:"space-y-4",children:[l.jsxs(y,{className:"grid w-full grid-cols-3",children:[l.jsx(w,{value:"content",children:"Content Management"}),l.jsx(w,{value:"upload",children:"Upload Content"}),l.jsx(w,{value:"analytics",children:"Analytics"})]}),l.jsx(v,{value:"content",className:"space-y-4",children:l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("h3",{className:"text-xl font-semibold",children:"Multi-skill IELTS Tests"}),l.jsx("p",{className:"text-muted-foreground",children:"Manage complete IELTS tests with all 4 sections"})]}),l.jsxs("div",{className:"flex gap-3 items-end",children:[l.jsx(b,{placeholder:"Test name (e.g., IELTS Test 1)",value:X,onChange:e=>Z(e.target.value),onKeyPress:e=>"Enter"===e.key&&ne(),className:"max-w-sm"}),l.jsx(T,{onClick:ne,disabled:H,children:H?"Creating...":"Create Test"})]})]}),Q.length>0?l.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:Q.map(e=>l.jsxs(i,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>!G&&U(`/admin/ielts/test/${e.id}`),children:[l.jsxs(c,{children:[l.jsxs(d,{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx(o,{className:"w-5 h-5 text-primary"}),G===e.id?l.jsxs("div",{className:"flex items-center space-x-2",onClick:e=>e.stopPropagation(),children:[l.jsx(b,{value:ee,onChange:e=>se(e.target.value),className:"text-lg font-semibold h-8",onKeyPress:e=>"Enter"===e.key&&ie()}),l.jsx(T,{size:"sm",variant:"ghost",onClick:ie,children:l.jsx(k,{className:"w-4 h-4 text-green-600"})}),l.jsx(T,{size:"sm",variant:"ghost",onClick:re,children:l.jsx(S,{className:"w-4 h-4 text-red-600"})})]}):l.jsx("span",{children:e.test_name})]}),G!==e.id&&l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(T,{size:"sm",variant:"ghost",onClick:s=>{s.stopPropagation(),(e=>{O(e.id),se(e.test_name)})(e)},children:l.jsx(C,{className:"w-4 h-4"})}),l.jsxs(E,{children:[l.jsx(L,{asChild:!0,children:l.jsx(T,{size:"sm",variant:"ghost",onClick:e=>e.stopPropagation(),children:l.jsx(I,{className:"w-4 h-4 text-red-600"})})}),l.jsxs(A,{children:[l.jsxs(M,{children:[l.jsx(_,{children:"Delete Test"}),l.jsxs(q,{children:['Are you sure you want to delete "',e.test_name,'"? This will also delete all questions associated with this test. This action cannot be undone.']})]}),l.jsxs(P,{children:[l.jsx(R,{children:"Cancel"}),l.jsx($,{onClick:()=>(async(e,s)=>{try{console.log("ðŸ—‘ï¸ Starting delete process for test:",e);const{error:t}=await K.from("questions").delete().eq("test_id",e);if(t)return console.error("âŒ Error deleting questions:",t),void B.error("Failed to delete associated questions");console.log("âœ… Questions deleted successfully");const{error:a,data:l}=await K.from("tests").delete().eq("id",e).select();if(a)throw console.error("âŒ Error deleting test:",a),a;if(console.log("âœ… Deleted test data:",l),!l||0===l.length)return console.warn("âš ï¸ No test was deleted - test may not exist or access denied"),void B.error("Test not found or access denied");B.success(`Test "${s}" deleted successfully`),setTimeout(()=>{le()},500)}catch(t){console.error("âŒ Error deleting test:",t),B.error("Failed to delete test")}})(e.id,e.test_name),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]}),l.jsxs(z,{children:["Created: ",new Date(e.created_at).toLocaleDateString()]})]}),l.jsxs(m,{children:[l.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[l.jsx("span",{children:"Type: Multi-skill IELTS Test"}),l.jsx("span",{children:"Sections: 4 (L,R,W,S)"})]}),l.jsx(T,{size:"sm",className:"w-full mt-3",onClick:s=>{s.stopPropagation(),U(`/admin/ielts/test/${e.id}`)},disabled:G===e.id,children:"Manage All Sections"})]})]},e.id))}):l.jsxs("div",{className:"text-center py-12",children:[l.jsx(o,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),l.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Multi-skill IELTS tests found"}),l.jsx("p",{className:"text-muted-foreground mb-4",children:"Create your first multi-skill IELTS test with all 4 sections"}),l.jsxs("div",{className:"space-y-3",children:[l.jsx(b,{placeholder:"Test name (e.g., IELTS Test 1)",value:X,onChange:e=>Z(e.target.value),onKeyPress:e=>"Enter"===e.key&&ne(),className:"max-w-sm mx-auto"}),l.jsx(T,{onClick:ne,disabled:H,children:H?"Creating...":"Create First Multi-skill Test"})]})]})]})}),l.jsx(v,{value:"upload",className:"space-y-4",children:l.jsxs(i,{children:[l.jsxs(c,{children:[l.jsxs(d,{className:"flex items-center space-x-2",children:[l.jsx(F,{className:"h-5 w-5"}),l.jsx("span",{children:"Upload IELTS Content"})]}),l.jsx(z,{children:"Import IELTS questions, passages, and audio content via CSV"})]}),l.jsx(m,{children:l.jsx(D,{onImport:()=>{},onQuestionsPreview:()=>{},type:"reading"})})]})}),l.jsx(v,{value:"analytics",className:"space-y-4",children:l.jsxs(i,{children:[l.jsxs(c,{children:[l.jsxs(d,{className:"flex items-center space-x-2",children:[l.jsx(h,{className:"h-5 w-5"}),l.jsx("span",{children:"IELTS Analytics"})]}),l.jsx(z,{children:"View performance metrics and student progress"})]}),l.jsx(m,{children:l.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[l.jsx(h,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),l.jsx("p",{children:"Analytics dashboard coming soon"}),l.jsx("p",{className:"text-sm",children:"Track student performance and test completion rates"})]})})]})})]})]})}):null};export{U as default};
