import{r as e,u as s,v as t,j as a,B as r,P as n,d as i,C as l,b as d,c,I as o,w as m,X as h,a as x,J as g}from"./index-BX4LCKf1.js";import{s as u}from"./supabase-Bqkrifq5.js";import{A as j,a as f,b as p,c as w,d as N,e as y,f as T,g as b,h as v}from"./alert-dialog-7aaB8BsD.js";import{A as C}from"./AdminLayout-BjRXctUZ.js";import{P as E}from"./pen-line-Cy6o-bTD.js";import{T as _}from"./trash-2-CHQgkfR3.js";function S(){const[S,k]=e.useState([]),[L,q]=e.useState(!0),[R,I]=e.useState(null),[P,B]=e.useState(null),[z,A]=e.useState(""),D=s(),{admin:F,loading:$}=t();e.useEffect(()=>{$||F||D("/admin/login")},[F,$,D]),e.useEffect(()=>{(async()=>{q(!0);const{data:e,error:s}=await u.from("tests").select("*").eq("test_type","IELTS").eq("module","Reading").order("created_at",{ascending:!1});s?I(s.message):k(e||[]),q(!1)})()},[]);const G=async()=>{q(!0),I(null);try{const{data:e}=await u.from("tests").select("test_name").eq("test_type","IELTS").eq("module","Reading").order("created_at",{ascending:!1}),s=((null==e?void 0:e.length)||0)+1,{data:t,error:a}=await u.from("tests").insert({test_name:`IELTS Reading Test ${s}`,test_type:"IELTS",module:"Reading"}).select().single();if(a)throw a;g.success("Test created successfully"),D(`/admin/ielts/test/${t.id}/reading`)}catch(e){console.error("Error creating test:",e),I(e.message),g.error("Failed to create test")}q(!1)},J=()=>{B(null),A("")},K=async()=>{if(z.trim())try{const{error:e}=await u.from("tests").update({test_name:z}).eq("id",P);if(e)throw e;g.success("Test name updated successfully"),B(null),A("");(async()=>{const{data:e,error:s}=await u.from("tests").select("*").eq("test_type","IELTS").eq("module","Reading").order("created_at",{ascending:!1});s?I(s.message):k(e||[])})()}catch(e){console.error("Error updating test name:",e),g.error("Failed to update test name")}else g.error("Test name cannot be empty")};return $?a.jsx("div",{className:"text-white",children:"Loading..."}):F?L&&0===S.length?a.jsx(C,{title:"IELTS Reading Tests",showBackButton:!0,backPath:"/admin",children:a.jsx("p",{className:"text-white",children:"Loading tests..."})}):R?a.jsx(C,{title:"IELTS Reading Tests",showBackButton:!0,backPath:"/admin",children:a.jsxs("p",{className:"text-red-500",children:["Error: ",R]})}):a.jsx(C,{title:"IELTS Reading Tests",showBackButton:!0,backPath:"/admin",children:a.jsxs("div",{className:"p-8",children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",children:"IELTS Reading Tests"}),a.jsxs(r,{onClick:G,disabled:L,className:"gap-2",children:[a.jsx(n,{className:"w-4 h-4"}),L?"Creating...":"Create Reading Test"]})]}),0===S.length?a.jsxs("div",{className:"text-center py-12",children:[a.jsx(i,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Reading tests found"}),a.jsx("p",{className:"text-muted-foreground mb-4",children:"Create your first IELTS Reading test to get started"}),a.jsxs(r,{onClick:G,disabled:L,children:[a.jsx(n,{className:"w-4 h-4 mr-2"}),L?"Creating...":"Create First Test"]})]}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:S.map(e=>a.jsxs(l,{className:"hover:shadow-lg transition-shadow",children:[a.jsx(d,{children:a.jsxs(c,{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(i,{className:"w-5 h-5"}),P===e.id?a.jsxs("div",{className:"flex items-center space-x-2",onClick:e=>e.stopPropagation(),children:[a.jsx(o,{value:z,onChange:e=>A(e.target.value),className:"text-lg font-semibold h-8",onKeyPress:e=>"Enter"===e.key&&K()}),a.jsx(r,{size:"sm",variant:"ghost",onClick:K,children:a.jsx(m,{className:"w-4 h-4 text-green-600"})}),a.jsx(r,{size:"sm",variant:"ghost",onClick:J,children:a.jsx(h,{className:"w-4 h-4 text-red-600"})})]}):a.jsx("span",{children:e.test_name})]}),P!==e.id&&a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(r,{size:"sm",variant:"ghost",onClick:s=>{s.stopPropagation(),(e=>{B(e.id),A(e.test_name)})(e)},children:a.jsx(E,{className:"w-4 h-4"})}),a.jsxs(j,{children:[a.jsx(f,{asChild:!0,children:a.jsx(r,{size:"sm",variant:"ghost",onClick:e=>e.stopPropagation(),children:a.jsx(_,{className:"w-4 h-4 text-red-600"})})}),a.jsxs(p,{children:[a.jsxs(w,{children:[a.jsx(N,{children:"Delete Test"}),a.jsxs(y,{children:['Are you sure you want to delete "',e.test_name,'"? This will also delete all questions associated with this test. This action cannot be undone.']})]}),a.jsxs(T,{children:[a.jsx(b,{children:"Cancel"}),a.jsx(v,{onClick:()=>(async(e,s)=>{try{const{error:t}=await u.from("questions").delete().eq("test_id",e);t&&console.error("Error deleting questions:",t);const{error:a}=await u.from("tests").delete().eq("id",e);if(a)throw a;g.success(`Test "${s}" deleted successfully`),(async()=>{const{data:e,error:s}=await u.from("tests").select("*").eq("test_type","IELTS").eq("module","Reading").order("created_at",{ascending:!1});s?I(s.message):k(e||[])})()}catch(t){console.error("Error deleting test:",t),g.error("Failed to delete test")}})(e.id,e.test_name),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]})}),a.jsx(x,{children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"text-sm text-muted-foreground",children:["Created: ",new Date(e.created_at).toLocaleDateString()]}),a.jsx(r,{size:"sm",className:"w-full",onClick:()=>D(`/admin/ielts/test/${e.id}/reading`),disabled:P===e.id,children:"Manage Test Content"})]})})]},e.id))})]})}):null}export{S as default};
