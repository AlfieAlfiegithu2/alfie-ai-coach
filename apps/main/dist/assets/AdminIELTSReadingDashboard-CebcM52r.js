import{r as e,u as s,j as t}from"./vendor-react-rLLBBC7n.js";import{n as a,B as n,C as i,b as r,c as o,I as c,a as l,s as d,J as m}from"./index-KxDfHqNJ.js";import{A as h,a as g,b as x,c as u,d as j,e as p,f,g as y,h as I}from"./alert-dialog-Bvks6upm.js";import{A as w}from"./AdminLayout-DGXoIbe0.js";import{av as N,ao as T,q as b,X as C,a_ as v,aY as S}from"./vendor-ui-BGi_EvHx.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-charts-0DeywwxG.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";function E(){const[E,k]=e.useState([]),[R,_]=e.useState(!0),[J,L]=e.useState(null),[O,$]=e.useState(null),[q,z]=e.useState(""),M=s(),{admin:F,loading:Z}=a();e.useEffect(()=>{Z||F||M("/admin/login")},[F,Z,M]),e.useEffect(()=>{(async()=>{_(!0);const{data:e,error:s}=await d.from("tests").select("*").eq("test_type","IELTS").eq("module","Reading").order("created_at",{ascending:!1});s?L(s.message):k(e||[]),_(!1)})()},[]);const B=async()=>{_(!0),L(null);try{const{data:e}=await d.from("tests").select("test_name").eq("test_type","IELTS").eq("module","Reading").order("created_at",{ascending:!1}),s=`IELTS Reading Test ${((null==e?void 0:e.length)||0)+1}`;console.log(`ğŸ“ Creating new Reading test: "${s}"`);const t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN1dW14bWZ6aHdsanlsYmRsZmxqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM1MTkxMjEsImV4cCI6MjA2OTA5NTEyMX0.8jqO_ciOttSxSLZnKY0i5oJmEn79ROF53TjUMYhNemI",a=`${"https://cuumxmfzhwljylbdlflj.supabase.co"}/functions/v1/create-test`,n={test_name:s,test_type:"IELTS",module:"Reading",skill_category:"Reading"};console.log("ğŸ’¾ Creating test via edge function:",n);const i=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",apikey:t,Authorization:`Bearer ${t}`},body:JSON.stringify(n)});if(!i.ok){const e=await i.text();throw console.error("Create function error response:",e),new Error(`Failed to create test: ${i.status} - ${e}`)}const r=(await i.json()).data;console.log("âœ… Test created successfully:",r),m.success("Test created successfully"),M(`/admin/ielts/test/${r.id}/reading`)}catch(e){console.error("âŒ Error creating test:",e),L(e.message),m.error(`Failed to create test: ${e.message}`)}_(!1)},Y=()=>{$(null),z("")},A=async()=>{if(q.trim())try{const{error:e}=await d.from("tests").update({test_name:q}).eq("id",O);if(e)throw e;m.success("Test name updated successfully"),$(null),z("");(async()=>{const{data:e,error:s}=await d.from("tests").select("*").eq("test_type","IELTS").eq("module","Reading").order("created_at",{ascending:!1});s?L(s.message):k(e||[])})()}catch(e){console.error("Error updating test name:",e),m.error("Failed to update test name")}else m.error("Test name cannot be empty")};return Z?t.jsx("div",{className:"text-white",children:"Loading..."}):F?R&&0===E.length?t.jsx(w,{title:"IELTS Reading Tests",showBackButton:!0,backPath:"/admin",children:t.jsx("p",{className:"text-white",children:"Loading tests..."})}):J?t.jsx(w,{title:"IELTS Reading Tests",showBackButton:!0,backPath:"/admin",children:t.jsxs("p",{className:"text-red-500",children:["Error: ",J]})}):t.jsx(w,{title:"IELTS Reading Tests",showBackButton:!0,backPath:"/admin",children:t.jsxs("div",{className:"p-8",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",children:"IELTS Reading Tests"}),t.jsxs(n,{onClick:B,disabled:R,className:"gap-2",children:[t.jsx(N,{className:"w-4 h-4"}),R?"Creating...":"Create Reading Test"]})]}),0===E.length?t.jsxs("div",{className:"text-center py-12",children:[t.jsx(T,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Reading tests found"}),t.jsx("p",{className:"text-muted-foreground mb-4",children:"Create your first IELTS Reading test to get started"}),t.jsxs(n,{onClick:B,disabled:R,children:[t.jsx(N,{className:"w-4 h-4 mr-2"}),R?"Creating...":"Create First Test"]})]}):t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:E.map(e=>t.jsxs(i,{className:"hover:shadow-lg transition-shadow",children:[t.jsx(r,{children:t.jsxs(o,{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(T,{className:"w-5 h-5"}),O===e.id?t.jsxs("div",{className:"flex items-center space-x-2",onClick:e=>e.stopPropagation(),children:[t.jsx(c,{value:q,onChange:e=>z(e.target.value),className:"text-lg font-semibold h-8",onKeyPress:e=>"Enter"===e.key&&A()}),t.jsx(n,{size:"sm",variant:"ghost",onClick:A,children:t.jsx(b,{className:"w-4 h-4 text-green-600"})}),t.jsx(n,{size:"sm",variant:"ghost",onClick:Y,children:t.jsx(C,{className:"w-4 h-4 text-red-600"})})]}):t.jsx("span",{children:e.test_name})]}),O!==e.id&&t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(n,{size:"sm",variant:"ghost",onClick:s=>{s.stopPropagation(),(e=>{$(e.id),z(e.test_name)})(e)},children:t.jsx(v,{className:"w-4 h-4"})}),t.jsxs(h,{children:[t.jsx(g,{asChild:!0,children:t.jsx(n,{size:"sm",variant:"ghost",onClick:e=>e.stopPropagation(),children:t.jsx(S,{className:"w-4 h-4 text-red-600"})})}),t.jsxs(x,{children:[t.jsxs(u,{children:[t.jsx(j,{children:"Delete Test"}),t.jsxs(p,{children:['Are you sure you want to delete "',e.test_name,'"? This will also delete all questions associated with this test. This action cannot be undone.']})]}),t.jsxs(f,{children:[t.jsx(y,{children:"Cancel"}),t.jsx(I,{onClick:()=>(async(e,s)=>{try{console.log(`ğŸ—‘ï¸ Deleting test: ${s} (${e})`);const t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN1dW14bWZ6aHdsanlsYmRsZmxqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM1MTkxMjEsImV4cCI6MjA2OTA5NTEyMX0.8jqO_ciOttSxSLZnKY0i5oJmEn79ROF53TjUMYhNemI",a="https://cuumxmfzhwljylbdlflj.supabase.co/functions/v1/delete-test",n=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",apikey:t,Authorization:`Bearer ${t}`},body:JSON.stringify({testId:e})});if(!n.ok){const e=await n.text();throw console.error("Delete function error response:",e),new Error(`Failed to delete test: ${n.status} - ${e}`)}const i=await n.json();console.log("âœ… Test deleted successfully:",i),m.success(`Test "${s}" deleted successfully`),(async()=>{const{data:e,error:s}=await d.from("tests").select("*").eq("test_type","IELTS").eq("module","Reading").order("created_at",{ascending:!1});s?L(s.message):k(e||[])})()}catch(t){console.error("âŒ Error deleting test:",t),m.error(`Failed to delete test: ${t.message}`)}})(e.id,e.test_name),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]})}),t.jsx(l,{children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"text-sm text-muted-foreground",children:["Created: ",new Date(e.created_at).toLocaleDateString()]}),t.jsx(n,{size:"sm",className:"w-full",onClick:()=>M(`/admin/ielts/test/${e.id}/reading`),disabled:O===e.id,children:"Manage Test Content"})]})})]},e.id))})]})}):null}export{E as default};
