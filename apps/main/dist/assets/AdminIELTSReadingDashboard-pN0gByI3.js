import{r as e,u as s,w as t,j as a,B as n,P as i,e as r,C as l,b as o,d as c,I as d,x as m,X as h,a as g,J as x}from"./index-BesslEmZ.js";import{s as u}from"./supabase-DWL4C3fA.js";import{A as j,a as p,b as f,c as y,d as I,e as w,f as T,g as N,h as b}from"./alert-dialog-DSn_QYXl.js";import{A as C}from"./AdminLayout-P0f5HcIw.js";import{P as S}from"./pen-line-D9sQkeEd.js";import{T as E}from"./trash-2-6K8zmsB-.js";function k(){const[k,v]=e.useState([]),[R,_]=e.useState(!0),[J,L]=e.useState(null),[O,$]=e.useState(null),[z,M]=e.useState(""),q=s(),{admin:F,loading:Z}=t();e.useEffect(()=>{Z||F||q("/admin/login")},[F,Z,q]),e.useEffect(()=>{(async()=>{_(!0);const{data:e,error:s}=await u.from("tests").select("*").eq("test_type","IELTS").eq("module","Reading").order("created_at",{ascending:!1});s?L(s.message):v(e||[]),_(!1)})()},[]);const B=async()=>{_(!0),L(null);try{const{data:e}=await u.from("tests").select("test_name").eq("test_type","IELTS").eq("module","Reading").order("created_at",{ascending:!1}),s=`IELTS Reading Test ${((null==e?void 0:e.length)||0)+1}`;console.log(`ğŸ“ Creating new Reading test: "${s}"`);const t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN1dW14bWZ6aHdsanlsYmRsZmxqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM1MTkxMjEsImV4cCI6MjA2OTA5NTEyMX0.8jqO_ciOttSxSLZnKY0i5oJmEn79ROF53TjUMYhNemI",a=`${"https://cuumxmfzhwljylbdlflj.supabase.co"}/functions/v1/create-test`,n={test_name:s,test_type:"IELTS",module:"Reading",skill_category:"Reading"};console.log("ğŸ’¾ Creating test via edge function:",n);const i=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",apikey:t,Authorization:`Bearer ${t}`},body:JSON.stringify(n)});if(!i.ok){const e=await i.text();throw console.error("Create function error response:",e),new Error(`Failed to create test: ${i.status} - ${e}`)}const r=(await i.json()).data;console.log("âœ… Test created successfully:",r),x.success("Test created successfully"),q(`/admin/ielts/test/${r.id}/reading`)}catch(e){console.error("âŒ Error creating test:",e),L(e.message),x.error(`Failed to create test: ${e.message}`)}_(!1)},P=()=>{$(null),M("")},A=async()=>{if(z.trim())try{const{error:e}=await u.from("tests").update({test_name:z}).eq("id",O);if(e)throw e;x.success("Test name updated successfully"),$(null),M("");(async()=>{const{data:e,error:s}=await u.from("tests").select("*").eq("test_type","IELTS").eq("module","Reading").order("created_at",{ascending:!1});s?L(s.message):v(e||[])})()}catch(e){console.error("Error updating test name:",e),x.error("Failed to update test name")}else x.error("Test name cannot be empty")};return Z?a.jsx("div",{className:"text-white",children:"Loading..."}):F?R&&0===k.length?a.jsx(C,{title:"IELTS Reading Tests",showBackButton:!0,backPath:"/admin",children:a.jsx("p",{className:"text-white",children:"Loading tests..."})}):J?a.jsx(C,{title:"IELTS Reading Tests",showBackButton:!0,backPath:"/admin",children:a.jsxs("p",{className:"text-red-500",children:["Error: ",J]})}):a.jsx(C,{title:"IELTS Reading Tests",showBackButton:!0,backPath:"/admin",children:a.jsxs("div",{className:"p-8",children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",children:"IELTS Reading Tests"}),a.jsxs(n,{onClick:B,disabled:R,className:"gap-2",children:[a.jsx(i,{className:"w-4 h-4"}),R?"Creating...":"Create Reading Test"]})]}),0===k.length?a.jsxs("div",{className:"text-center py-12",children:[a.jsx(r,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Reading tests found"}),a.jsx("p",{className:"text-muted-foreground mb-4",children:"Create your first IELTS Reading test to get started"}),a.jsxs(n,{onClick:B,disabled:R,children:[a.jsx(i,{className:"w-4 h-4 mr-2"}),R?"Creating...":"Create First Test"]})]}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:k.map(e=>a.jsxs(l,{className:"hover:shadow-lg transition-shadow",children:[a.jsx(o,{children:a.jsxs(c,{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(r,{className:"w-5 h-5"}),O===e.id?a.jsxs("div",{className:"flex items-center space-x-2",onClick:e=>e.stopPropagation(),children:[a.jsx(d,{value:z,onChange:e=>M(e.target.value),className:"text-lg font-semibold h-8",onKeyPress:e=>"Enter"===e.key&&A()}),a.jsx(n,{size:"sm",variant:"ghost",onClick:A,children:a.jsx(m,{className:"w-4 h-4 text-green-600"})}),a.jsx(n,{size:"sm",variant:"ghost",onClick:P,children:a.jsx(h,{className:"w-4 h-4 text-red-600"})})]}):a.jsx("span",{children:e.test_name})]}),O!==e.id&&a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(n,{size:"sm",variant:"ghost",onClick:s=>{s.stopPropagation(),(e=>{$(e.id),M(e.test_name)})(e)},children:a.jsx(S,{className:"w-4 h-4"})}),a.jsxs(j,{children:[a.jsx(p,{asChild:!0,children:a.jsx(n,{size:"sm",variant:"ghost",onClick:e=>e.stopPropagation(),children:a.jsx(E,{className:"w-4 h-4 text-red-600"})})}),a.jsxs(f,{children:[a.jsxs(y,{children:[a.jsx(I,{children:"Delete Test"}),a.jsxs(w,{children:['Are you sure you want to delete "',e.test_name,'"? This will also delete all questions associated with this test. This action cannot be undone.']})]}),a.jsxs(T,{children:[a.jsx(N,{children:"Cancel"}),a.jsx(b,{onClick:()=>(async(e,s)=>{try{console.log(`ğŸ—‘ï¸ Deleting test: ${s} (${e})`);const t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN1dW14bWZ6aHdsanlsYmRsZmxqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM1MTkxMjEsImV4cCI6MjA2OTA5NTEyMX0.8jqO_ciOttSxSLZnKY0i5oJmEn79ROF53TjUMYhNemI",a="https://cuumxmfzhwljylbdlflj.supabase.co/functions/v1/delete-test",n=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",apikey:t,Authorization:`Bearer ${t}`},body:JSON.stringify({testId:e})});if(!n.ok){const e=await n.text();throw console.error("Delete function error response:",e),new Error(`Failed to delete test: ${n.status} - ${e}`)}const i=await n.json();console.log("âœ… Test deleted successfully:",i),x.success(`Test "${s}" deleted successfully`),(async()=>{const{data:e,error:s}=await u.from("tests").select("*").eq("test_type","IELTS").eq("module","Reading").order("created_at",{ascending:!1});s?L(s.message):v(e||[])})()}catch(t){console.error("âŒ Error deleting test:",t),x.error(`Failed to delete test: ${t.message}`)}})(e.id,e.test_name),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]})}),a.jsx(g,{children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"text-sm text-muted-foreground",children:["Created: ",new Date(e.created_at).toLocaleDateString()]}),a.jsx(n,{size:"sm",className:"w-full",onClick:()=>q(`/admin/ielts/test/${e.id}/reading`),disabled:O===e.id,children:"Manage Test Content"})]})})]},e.id))})]})}):null}export{k as default};
