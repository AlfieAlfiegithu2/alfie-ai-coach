import{c as e,u as s,G as t,w as a,r as n,J as i,j as r,l,C as o,b as c,d,e as m,a as u,I as x,B as h,L as g,bd as p,F as b,T as j,N,P as f,E as v}from"./index-C3QtY_-A.js";import{T as y,a as w,b as q,c as T}from"./tabs-BOSTBc63.js";import{A as k}from"./AdminLayout-DVhFbZL8.js";import{I as _}from"./ImageQuestionExtractor-FXbWZcEr.js";import{s as S}from"./supabase-DWL4C3fA.js";import{S as C}from"./save-BwRKWTQT.js";import{I}from"./image-DeVABhhy.js";import{C as E}from"./circle-alert-5sr_Herb.js";import{T as A}from"./trash-2-C4LICyyo.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=e("ClipboardPaste",[["path",{d:"M15 2H9a1 1 0 0 0-1 1v2c0 .6.4 1 1 1h6c.6 0 1-.4 1-1V3c0-.6-.4-1-1-1Z",key:"1pp7kr"}],["path",{d:"M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2M16 4h2a2 2 0 0 1 2 2v2M11 14h10",key:"2ik1ml"}],["path",{d:"m17 10 4 4-4 4",key:"vp2hj1"}]]),M=[{value:"Matching Headings",label:"1. Matching Headings",keywords:["heading","paragraph","section"]},{value:"Matching Paragraph Information",label:"2. Matching Paragraph Information",keywords:["paragraph","contains","which paragraph"]},{value:"Matching Features",label:"3. Matching Features",keywords:["match","feature","researcher","writer","person"]},{value:"Matching Sentence Endings",label:"4. Matching Sentence Endings",keywords:["complete","sentence","ending"]},{value:"True False Not Given",label:"5. True/False/Not Given",keywords:["true","false","not given","TFNG"]},{value:"Yes No Not Given",label:"5. Yes/No/Not Given",keywords:["yes","no","not given","YNNG"]},{value:"Multiple Choice",label:"6. Multiple Choice",keywords:["choose","A","B","C","D","option"]},{value:"List Selection",label:"7. List of Options",keywords:["list","choose","THREE","TWO","select"]},{value:"Choose a Title",label:"8. Choose a Title",keywords:["title","best title","suitable title"]},{value:"Short Answer",label:"9. Short Answers",keywords:["answer","no more than","words"]},{value:"Sentence Completion",label:"10. Sentence Completion",keywords:["complete","sentence","blank"]},{value:"Summary Completion",label:"11. Summary Completion",keywords:["summary","complete the summary"]},{value:"Table Completion",label:"12. Table Completion",keywords:["table","complete the table"]},{value:"Flow Chart Completion",label:"13. Flow Chart Completion",keywords:["flow","chart","process"]},{value:"Diagram Completion",label:"14. Diagram Completion",keywords:["diagram","label"]}],F=e=>{const s=e.toLowerCase();return s.includes("true")&&s.includes("false")&&s.includes("not given")?"True False Not Given":s.includes("yes")&&s.includes("no")&&s.includes("not given")?"Yes No Not Given":s.includes("choose the correct letter")||s.includes("choose the best")||/choose.*letter\s*[A-D]/i.test(e)||/\n\s*[A-D]\s+[A-Z][a-z]+/.test(e)?"Multiple Choice":s.includes("complete the summary")||s.includes("complete the notes")||/\d+[â€¦.â€¦]{3,}/.test(e)||s.includes("no more than")&&s.includes("words")?"Summary Completion":s.includes("match")&&(s.includes("people")||s.includes("listed")||/[A-G]\s+\w+\s+\w+/.test(e))?"Matching Features":s.includes("heading")||s.includes("list of headings")?"Matching Headings":s.includes("which paragraph")||s.includes("paragraph contains")?"Matching Paragraph Information":s.includes("complete")&&s.includes("sentence")&&s.includes("ending")?"Matching Sentence Endings":s.includes("complete")&&s.includes("table")?"Table Completion":s.includes("complete")&&(s.includes("flow")||s.includes("chart"))?"Flow Chart Completion":s.includes("diagram")||s.includes("label")?"Diagram Completion":s.includes("choose")&&s.includes("title")?"Choose a Title":s.includes("complete")&&s.includes("sentence")?"Sentence Completion":"Short Answer"},G=()=>{const e=s(),{testId:G}=t(),{admin:$,loading:R}=a(),[O,Q]=n.useState(""),[L,Y]=n.useState(!1),[D,z]=n.useState(!0),[U,V]=n.useState(!1),[H,Z]=n.useState(1),[B,J]=n.useState("paste"),[W,X]=n.useState(""),[K,ee]=n.useState([]),[se,te]=n.useState({1:{passageNumber:1,title:"Passage 1",passageText:"",questions:[],sections:[],structureItems:[],extractionMetadata:null,questionRange:"1-13",imageFile:null,imageUrl:null},2:{passageNumber:2,title:"Passage 2",passageText:"",questions:[],sections:[],structureItems:[],extractionMetadata:null,questionRange:"14-26",imageFile:null,imageUrl:null},3:{passageNumber:3,title:"Passage 3",passageText:"",questions:[],sections:[],structureItems:[],extractionMetadata:null,questionRange:"27-40",imageFile:null,imageUrl:null}});n.useEffect(()=>{if(W.trim()){const e=(e=>{const s=[],t=[...e.matchAll(/Questions?\s+(\d+)(?:[-â€“â€”](\d+))?/gi)];if(0===t.length)return s;for(let a=0;a<t.length;a++){const n=t[a],i=parseInt(n[1]),r=n[2]?parseInt(n[2]):i,l=n.index,o=a<t.length-1?t[a+1].index:e.length,c=e.substring(l,o),d=F(c),m=c.match(/Questions?\s+\d+[-â€“â€”]\d+\s*([\s\S]*?)(?=\n\s*(?:[A-G]\s+\w|\d+\s+[A-Z]|\d+\.))/i),u=m?m[1].replace(/\s+/g," ").trim():"",x=[],h=c.split("\n");for(const e of h){const s=/([A-G])\s{1,3}([A-Za-z][A-Za-z\s]+?)(?=\s{3,}[A-G]\s|\s*$)/g;let t;for(;null!==(t=s.exec(e));){const e=t[1],s=t[2].trim();s.length>1&&/^[A-Z]/.test(s)&&!x.some(s=>s.startsWith(e+" "))&&x.push(`${e}  ${s}`)}const a=e.match(/^\s*([A-G])[.\)]\s*(.+)/);a&&!x.some(e=>e.startsWith(a[1]+" "))&&x.push(`${a[1]}  ${a[2].trim()}`)}x.sort((e,s)=>e.charCodeAt(0)-s.charCodeAt(0));const g=/^\s*([ivxIVX]+)[.\)]\s*(.+)/gm;let p;for(;null!==(p=g.exec(c));){const e=p[1].toLowerCase();x.some(s=>s.toLowerCase().startsWith(e+"."))||x.push(`${e}. ${p[2].trim()}`)}const b=[],j=c.split("\n"),N=[];let f="",v=0,y=!1;for(let e=0;e<j.length;e++){const s=j[e].trim();if(!s)continue;const t=s.match(/^(\d+)\s+(.+)/);if(t){const e=parseInt(t[1]);if(v>=i&&v<=r&&f){const e="True False Not Given"===d?["TRUE","FALSE","NOT GIVEN"]:"Yes No Not Given"===d?["YES","NO","NOT GIVEN"]:"Multiple Choice"===d&&N.length>0?[...N]:null;b.push({question_number:v,question_text:f.trim(),question_type:d,options:e,correct_answer:""}),N.length=0}e>=i&&e<=r?(v=e,f=t[2].trim(),y="Multiple Choice"===d):(v=0,f="")}else/^[A-D]\s+/.test(s)&&y?N.push(s):v>0&&(s.match(/^[A-G]\s+[A-Z]/)||s.match(/^Questions?\s/i)||(f+=" "+s))}if(v>=i&&v<=r&&f){const e="True False Not Given"===d?["TRUE","FALSE","NOT GIVEN"]:"Yes No Not Given"===d?["YES","NO","NOT GIVEN"]:"Multiple Choice"===d&&N.length>0?[...N]:null;b.push({question_number:v,question_text:f.trim(),question_type:d,options:e,correct_answer:""})}if(0===b.length&&("Summary Completion"===d||"Short Answer"===d)){const e=c.replace(/Questions?\s+\d+[-â€“â€”]?\d*[^\n]*\n/,"").trim();let s=e;for(let t=i;t<=r;t++)s=s.replace(new RegExp(`\\b${t}[â€¦.â€¦]+`,"g"),`(${t}) _______`);for(let t=i;t<=r;t++)b.push({question_number:t,question_text:`Blank ${t}`,question_type:d,options:null,correct_answer:""});s&&e.split("\n").slice(0,3).join(" ").trim()}let w="";if("Summary Completion"===d||"Short Answer"===d){const e=c.replace(/[\s\S]*?answer sheet\.?\s*/i,"").trim();if(e){w=e;for(let e=i;e<=r;e++)w=w.replace(new RegExp(`\\b${e}[â€¦.â€¦]+`,"g"),`_____(${e})_____`)}}if(b.length>0||i===r){if(0===b.length)for(let s=i;s<=r;s++)b.push({question_number:s,question_text:`Question ${s}`,question_type:d,options:"True False Not Given"===d?["TRUE","FALSE","NOT GIVEN"]:"Yes No Not Given"===d?["YES","NO","NOT GIVEN"]:null,correct_answer:""});let e=u;!w||"Summary Completion"!==d&&"Short Answer"!==d||(e=w),s.push({sectionTitle:i===r?`Question ${i}`:`Questions ${i}-${r}`,questionType:d,instructions:e,questionRange:i===r?`${i}`:`${i}-${r}`,options:x.length>0?x:null,questions:b})}}return s})(W);ee(e)}else ee([])},[W]);const ae=e=>e>=1&&e<=13?1:e>=14&&e<=26?2:e>=27&&e<=40?3:1;n.useEffect(()=>{R||$||e("/admin/login")},[$,R,e]),n.useEffect(()=>{G&&ne()},[G]);const ne=async()=>{if(G)try{console.log("ðŸ“– Loading reading test data for testId:",G),z(!0);const{data:e,error:s}=await S.from("tests").select("*").eq("id",G).maybeSingle();if(s)throw console.error("Error fetching test:",s),s;if(!e)return console.error("âŒ Test not found:",G),i.error("Test not found"),void z(!1);console.log("âœ… Test loaded:",e.test_name),Q(e.test_name);const{data:t,error:a}=await S.from("questions").select("*").eq("test_id",G).order("part_number",{ascending:!0}).order("question_number_in_part",{ascending:!0});if(a&&console.error("Error fetching questions:",a),console.log("ðŸ“Š Found",(null==t?void 0:t.length)||0,"questions for this test"),t&&t.length>0){const e={...se};t.forEach(s=>{const t=s.part_number||1;e[t]&&(!e[t].passageText&&s.passage_text&&(e[t].passageText=s.passage_text),e[t].questions.push({question_number:s.question_number_in_part||s.id,question_text:s.question_text,question_type:s.question_type||"Short Answer",options:s.choices?s.choices.split(";"):null,correct_answer:s.correct_answer,explanation:s.explanation}))}),te(e)}z(!1)}catch(e){console.error("âŒ Error loading test data:",e),i.error("Failed to load test data"),z(!1)}else z(!1)},ie=(e,s)=>{te(t=>({...t,[e]:{...t[e],...s}}))},re=()=>{const e=[];return[1,2,3].forEach(s=>{const t=se[s];t.questions.length>0&&t.questions.forEach((t,a)=>{e.push({...t,passageNumber:s,globalQuestionNumber:le(s,a)})})}),e},le=(e,s)=>1===e?s+1:2===e?13+s+1:26+s+1,oe=async()=>{if(!G)return void i.error("Test ID is required");if(re().length>0||[1,2,3].some(e=>se[e].passageText.trim())){Y(!0);try{console.log("ðŸ’¾ Saving reading test...");const e="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN1dW14bWZ6aHdsanlsYmRsZmxqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM1MTkxMjEsImV4cCI6MjA2OTA5NTEyMX0.8jqO_ciOttSxSLZnKY0i5oJmEn79ROF53TjUMYhNemI",s=`${"https://cuumxmfzhwljylbdlflj.supabase.co"}/functions/v1/save-reading-test`,t=[],a={1:[1,13],2:[14,26],3:[27,40]};[1,2,3].forEach(e=>{const s=se[e],[n,i]=a[e];s.sections&&s.sections.length>0?s.sections.forEach(a=>{a.questions.forEach((r,l)=>{const o=r.question_number||l+1;o>=n&&o<=i&&t.push({...r,part_number:e,passage_text:s.passageText,question_number_in_part:o,question_type:a.questionType||r.question_type||"Short Answer",choices:a.options||r.options||null,structure_data:{sectionTitle:a.sectionTitle,sectionRange:a.questionRange,instructions:a.instructions,options:a.options}})})}):s.questions.forEach((a,r)=>{const l=a.question_number||r+1;l>=n&&l<=i&&t.push({...a,part_number:e,passage_text:s.passageText,question_number_in_part:l,question_type:a.question_type||"Short Answer",choices:a.options||null})})}),console.log(`ðŸ“Š Saving ${t.length} questions (strict range validation applied)`);const n={testId:G,testData:{title:O||"IELTS Reading Test",passages:[1,2,3].map(e=>({passageNumber:e,title:se[e].title,passageText:se[e].passageText,questionRange:se[e].questionRange,structureItems:se[e].structureItems,extractionMetadata:se[e].extractionMetadata,sections:se[e].sections||[]}))},questions:t};console.log("ðŸ“¦ Data being sent:",JSON.stringify(n,null,2));const r=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",apikey:e,Authorization:`Bearer ${e}`},body:JSON.stringify(n)}),l=await r.json();if(!r.ok)throw new Error(l.error||"Failed to save test");console.log("âœ… Test saved successfully!"),i.success("Reading test saved successfully!")}catch(e){console.error("Error saving test:",e),i.error(`Failed to save test: ${e.message}`)}finally{Y(!1)}}else i.error("Please add at least one passage or questions")};return R||D?r.jsx(k,{title:"Loading Reading Test...",showBackButton:!0,backPath:"/admin/ielts/reading",children:r.jsx("div",{className:"flex items-center justify-center min-h-96",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),r.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading reading test data..."})]})})}):$?r.jsx(k,{title:`IELTS Reading Test - ${O||G}`,showBackButton:!0,backPath:"/admin/ielts/reading",children:r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold tracking-tight bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",children:"IELTS Reading Test Management"}),r.jsx("p",{className:"text-muted-foreground mt-1",children:"Create a complete reading test with 3 passages and 40 questions total"})]}),r.jsxs(l,{variant:"secondary",className:"text-sm",children:["Test ID: ",null==G?void 0:G.substring(0,8),"..."]})]}),r.jsxs(o,{className:"border border-border bg-card shadow-sm",children:[r.jsx(c,{children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs(d,{className:"flex items-center gap-2",children:[r.jsx(m,{className:"w-5 h-5 text-primary"}),"Reading Test - All Passages (1-3)"]}),r.jsx(l,{variant:"outline",className:"text-xs",children:"Preview updates instantly â†“"})]})}),r.jsxs(u,{className:"space-y-6",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-sm font-medium",children:"Test Name *"}),r.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:'Give this test a descriptive name (e.g., "IELTS Reading Test 1 - Cambridge 18")'}),r.jsx(x,{placeholder:"IELTS Reading Test 1",value:O,onChange:e=>Q(e.target.value),className:"max-w-md"})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsx("div",{className:"flex items-center justify-between",children:r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium",children:"Passages & Questions"}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"Upload passages and use AI to extract questions from images"})]})}),r.jsx("div",{className:"flex gap-2 border-b pb-2",children:[1,2,3].map(e=>{const s=se[e],t=s.questions.length>0,a=s.passageText.trim().length>0;return r.jsxs(h,{variant:H===e?"default":"outline",size:"sm",onClick:()=>Z(e),className:"relative "+(H===e?"ring-2 ring-primary":""),children:["Passage ",e,t&&r.jsx(g,{className:"w-3 h-3 ml-1 text-green-500"}),a&&!t&&r.jsx(p,{className:"w-3 h-3 ml-1 text-orange-500"}),r.jsxs("span",{className:"ml-1 text-xs text-muted-foreground",children:["(",s.questionRange,")"]})]},e)})}),r.jsxs("div",{className:"border rounded-lg p-4 bg-muted/20",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("div",{children:[r.jsxs("h4",{className:"font-semibold text-lg",children:["Passage ",H]}),r.jsxs("p",{className:"text-sm text-muted-foreground",children:["Questions ",se[H].questionRange," â€¢ ",se[H].questions.length," questions extracted"]})]}),se[H].questions.length>0&&r.jsxs(l,{variant:"default",className:"bg-green-600",children:[r.jsx(g,{className:"w-3 h-3 mr-1"}),se[H].questions.length," Questions"]})]}),r.jsxs("div",{className:"space-y-2 mb-4",children:[r.jsx("label",{className:"text-sm font-medium",children:"Passage Title"}),r.jsx(x,{placeholder:`Passage ${H} Title (e.g., "The History of Coffee")`,value:se[H].title,onChange:e=>ie(H,{title:e.target.value}),className:"max-w-lg"})]}),r.jsxs("div",{className:"space-y-2 mb-6",children:[r.jsxs("label",{className:"text-sm font-medium",children:[r.jsx(b,{className:"w-4 h-4 inline mr-1"}),"Passage Text *"]}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"Paste the full reading passage text here. This will be shown to students during the test."}),r.jsx(j,{placeholder:"Paste the complete reading passage text here...",value:se[H].passageText,onChange:e=>ie(H,{passageText:e.target.value}),rows:12,className:"font-serif text-sm leading-relaxed"}),se[H].passageText&&r.jsxs("div",{className:"flex items-center justify-between p-2 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200",children:[r.jsxs("p",{className:"text-xs text-green-800 dark:text-green-200 flex items-center gap-2",children:[r.jsx(g,{className:"w-3 h-3"}),se[H].passageText.split(" ").length," words"]}),r.jsx(h,{onClick:oe,disabled:L,size:"sm",className:"bg-green-600 hover:bg-green-700",children:L?r.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}):r.jsxs(r.Fragment,{children:[r.jsx(C,{className:"w-3 h-3 mr-1"}),"Save Passage"]})})]})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(N,{className:"w-4 h-4 text-purple-500"}),r.jsx("label",{className:"text-sm font-medium",children:"Add Questions"})]}),r.jsxs(l,{variant:"outline",className:"text-xs",children:[M.length," question types supported"]})]}),r.jsxs(y,{value:B,onValueChange:e=>J(e),children:[r.jsxs(w,{className:"grid w-full grid-cols-2",children:[r.jsxs(q,{value:"paste",className:"gap-2",children:[r.jsx(P,{className:"w-4 h-4"}),"Copy & Paste"]}),r.jsxs(q,{value:"image",className:"gap-2",children:[r.jsx(I,{className:"w-4 h-4"}),"Image Upload"]})]}),r.jsx(T,{value:"paste",className:"mt-4 space-y-4",children:r.jsxs(o,{className:"border-2 border-green-200 dark:border-green-800",children:[r.jsxs(c,{className:"pb-3 bg-green-50 dark:bg-green-900/20",children:[r.jsxs(d,{className:"text-base flex items-center gap-2",children:[r.jsx(P,{className:"w-4 h-4 text-green-600"}),"Paste All Questions (Auto-Detect)"]}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"Just paste everything! System auto-detects question types, ranges, and options."})]}),r.jsxs(u,{className:"space-y-4 pt-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Paste Questions (including headers)"}),r.jsx(j,{placeholder:"Paste entire question section here, for example:\n\nQuestions 1-8\nUse the information in the passage to match the people (listed A-G)...\n\n       A  Tony Brown            E  Art Pimms\n       B  Patrick Leahy          F  Steve Black\n       ...\n\n1   There is a double-advantage to the new techniques.\n2   The work on developing these alternative techniques is not finished.\n...\n\nQuestions 9-13\nDo the following statements agree with the information given?\nYES if the statement is true\nNO if the statement is false\nNOT GIVEN if the information is not given\n\n9   Integrated Pest Management has been regarded as a success.\n10  Oregon farmers have been promoted as successful examples.\n...",value:W,onChange:e=>X(e.target.value),rows:14,className:"font-mono text-sm"})]}),K.length>0&&r.jsxs("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border-2 border-green-300",children:[r.jsxs("p",{className:"text-sm font-medium text-green-800 dark:text-green-200 mb-2 flex items-center gap-2",children:[r.jsx(g,{className:"w-4 h-4"}),"Auto-Detected ",K.length," Section",K.length>1?"s":"",":"]}),r.jsx("div",{className:"space-y-2",children:K.map((e,s)=>{var t;const a=(null==(t=e.questions[0])?void 0:t.question_number)||parseInt(e.questionRange.split("-")[0]),n=ae(a);return r.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white dark:bg-gray-800 rounded border",children:[r.jsxs(l,{className:1===n?"bg-blue-600":2===n?"bg-purple-600":"bg-orange-600",children:["P",n]}),r.jsx(l,{variant:"outline",children:e.questionRange}),r.jsx(l,{variant:"secondary",children:e.questionType}),r.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",e.questions.length," questions)"]}),e.options&&e.options.length>0&&r.jsxs("span",{className:"text-xs text-amber-600",children:["+",e.options.length," options"]})]},s)})}),r.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"ðŸ“ Questions auto-assigned: 1-13 â†’ P1, 14-26 â†’ P2, 27-40 â†’ P3"})]}),W&&0===K.length&&r.jsx("div",{className:"p-2 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200",children:r.jsxs("p",{className:"text-xs text-amber-800 dark:text-amber-200 flex items-center gap-2",children:[r.jsx(E,{className:"w-3 h-3"}),'No sections detected. Make sure text includes "Questions X-Y" headers.']})}),r.jsxs(h,{onClick:()=>{if(0===K.length)return void i.error('No sections detected. Make sure your text contains "Questions X-Y" headers.');const e={1:[],2:[],3:[]};K.forEach(s=>{var t;const a=(null==(t=s.questions[0])?void 0:t.question_number)||parseInt(s.questionRange.split("-")[0]),n=ae(a);e[n].push(s)});let s=0;const t=[];[1,2,3].forEach(a=>{const n=e[a];if(n.length>0){const e=n.flatMap(e=>e.questions);ie(a,{sections:n,questions:e}),s+=e.length,t.push(`P${a}: ${e.length}q`)}}),K.map(e=>`${e.questionRange}: ${e.questionType}`).join(", "),console.log(`âœ… Applied ${K.length} sections with ${s} questions`),i.success(`Added ${s} questions!`,{description:t.join(" | ")}),X(""),ee([])},disabled:0===K.length,className:"w-full bg-green-600 hover:bg-green-700",size:"lg",children:[r.jsx(f,{className:"w-4 h-4 mr-2"}),"Add ",K.length," Section",1!==K.length?"s":""," to Passage ",H]}),r.jsxs("div",{className:"border-t pt-3 mt-3",children:[r.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-2",children:"âœ¨ Auto-Detection Works For:"}),r.jsxs("div",{className:"flex flex-wrap gap-1",children:[r.jsx(l,{variant:"outline",className:"text-xs",children:"True/False/Not Given"}),r.jsx(l,{variant:"outline",className:"text-xs",children:"Yes/No/Not Given"}),r.jsx(l,{variant:"outline",className:"text-xs",children:"Matching Features"}),r.jsx(l,{variant:"outline",className:"text-xs",children:"Matching Headings"}),r.jsx(l,{variant:"outline",className:"text-xs",children:"Multiple Choice"}),r.jsx(l,{variant:"outline",className:"text-xs",children:"Summary Completion"}),r.jsx(l,{variant:"outline",className:"text-xs",children:"+8 more"})]})]})]})]})}),r.jsx(T,{value:"image",className:"mt-4",children:r.jsx(_,{testId:G||"",testType:"IELTS-Reading",initialImageFile:se[H].imageFile,onImageSelected:e=>ie(H,{imageFile:e}),onQuestionsExtracted:(e,s)=>{console.log(`âœ¨ Passage ${H}: AI extracted ${e.length} questions`),ie(H,{questions:e,structureItems:(null==s?void 0:s.structureItems)||[],extractionMetadata:s||null});const t=(null==s?void 0:s.questionType)?` (${s.questionType})`:"";i.success(`Passage ${H}: ${e.length} questions extracted!${t}`)}})})]})]}),0===se[H].questions.length&&r.jsx("div",{className:"mt-4 p-4 border-2 border-dashed border-muted-foreground/25 rounded-lg bg-muted/10",children:r.jsxs("p",{className:"text-center text-muted-foreground text-sm",children:["ðŸ“‹ Use ",r.jsx("strong",{children:"Copy & Paste"})," to paste question text, or ",r.jsx("strong",{children:"Image Upload"})," to extract from screenshots"]})}),(se[H].questions.length>0||se[H].sections.length>0)&&r.jsxs("div",{className:"mt-6 space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsxs("h5",{className:"font-medium",children:["Extracted Questions (",se[H].questions.length,")"]}),se[H].sections.length>0&&r.jsxs("p",{className:"text-xs text-muted-foreground",children:[se[H].sections.length," question section(s) detected"]})]}),r.jsxs(h,{variant:"outline",size:"sm",onClick:()=>ie(H,{questions:[],sections:[]}),className:"text-red-600 hover:bg-red-50",children:[r.jsx(A,{className:"w-3 h-3 mr-1"}),"Clear All"]})]}),se[H].sections.length>0?r.jsx("div",{className:"space-y-4 max-h-[500px] overflow-y-auto pr-2",children:se[H].sections.map((e,s)=>r.jsxs(o,{className:"border-2 border-purple-200 dark:border-purple-800",children:[r.jsxs(c,{className:"pb-2 bg-purple-50 dark:bg-purple-900/20",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs(d,{className:"text-sm flex items-center gap-2",children:[r.jsx(l,{className:"bg-purple-600",children:e.questionRange}),r.jsx("span",{children:e.questionType})]}),r.jsxs(l,{variant:"outline",children:[e.questions.length," questions"]})]}),e.instructions&&r.jsx("p",{className:"text-xs text-muted-foreground mt-1 italic",children:e.instructions})]}),r.jsxs(u,{className:"pt-3 space-y-2",children:[e.options&&e.options.length>0&&r.jsxs("div",{className:"p-2 bg-amber-50 dark:bg-amber-900/20 rounded border border-amber-200 mb-3",children:[r.jsx("p",{className:"text-xs font-medium text-amber-800 dark:text-amber-200 mb-1",children:"Options:"}),r.jsx("div",{className:"flex flex-wrap gap-1",children:e.options.map((e,s)=>r.jsx(l,{variant:"outline",className:"text-xs",children:e},s))})]}),e.questions.map((e,s)=>r.jsxs("div",{className:"flex items-start gap-2 p-2 rounded bg-muted/30 hover:bg-muted/50",children:[r.jsx(l,{variant:"outline",className:"flex-shrink-0 text-xs",children:e.question_number}),r.jsxs("div",{className:"flex-1 text-sm",children:[r.jsx("span",{children:e.question_text}),e.correct_answer&&r.jsxs("span",{className:"ml-2 text-green-600 font-medium text-xs",children:["â†’ ",e.correct_answer]})]})]},s))]})]},s))}):r.jsx("div",{className:"space-y-3 max-h-[400px] overflow-y-auto pr-2",children:se[H].questions.map((e,s)=>r.jsx(o,{className:"bg-card border shadow-sm",children:r.jsx(u,{className:"p-3",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsxs(l,{variant:"outline",className:"flex-shrink-0",children:["Q",e.question_number||s+1]}),r.jsxs("div",{className:"flex-1 space-y-1",children:[r.jsx("p",{className:"text-sm",children:e.question_text}),e.options&&e.options.length>0&&r.jsxs("div",{className:"text-xs text-muted-foreground",children:["Options: ",e.options.join(" | ")]}),r.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[r.jsx(l,{variant:"secondary",className:"text-xs",children:e.question_type}),e.correct_answer&&r.jsxs("span",{className:"text-green-600 font-medium",children:["Answer: ",e.correct_answer]})]})]})]})})},s))}),r.jsxs("div",{className:"mt-4 pt-4 border-t",children:[r.jsx(h,{onClick:oe,disabled:L,className:"w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-semibold py-3",size:"lg",children:L?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):r.jsxs(r.Fragment,{children:[r.jsx(C,{className:"w-5 h-5 mr-2"}),"Save Passage ",H," Questions"]})}),r.jsx("p",{className:"text-xs text-center text-muted-foreground mt-2",children:"ðŸ’¡ Save after adding questions to each passage"})]})]})]}),r.jsx("div",{className:"grid grid-cols-3 gap-2 mt-4",children:[1,2,3].map(e=>{const s=se[e],t=s.passageText.trim().length>0,a=s.questions.length>0?"complete":t?"passage-ready":"empty";return r.jsxs("div",{className:`p-3 rounded-lg border text-center cursor-pointer transition-all ${"complete"===a?"bg-green-50 border-green-300 dark:bg-green-900/20":"passage-ready"===a?"bg-orange-50 border-orange-300 dark:bg-orange-900/20":"bg-gray-50 border-gray-200 dark:bg-gray-800"} ${H===e?"ring-2 ring-primary":""}`,onClick:()=>Z(e),children:[r.jsxs("div",{className:"font-semibold text-sm",children:["Passage ",e]}),r.jsx("div",{className:"text-xs text-muted-foreground",children:s.questionRange}),r.jsx("div",{className:"text-xs mt-1 font-medium "+("complete"===a?"text-green-600":"passage-ready"===a?"text-orange-600":"text-gray-400"),children:"complete"===a?`${s.questions.length} Questions`:"passage-ready"===a?"Passage Added":"Empty"})]},e)})}),(se[H].passageText||se[H].questions.length>0)&&r.jsxs("div",{className:"mt-6 border-t pt-6",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[r.jsx(v,{className:"w-5 h-5 text-blue-500"}),r.jsxs("h4",{className:"font-semibold",children:["Student View Preview - Passage ",H]}),r.jsx(l,{variant:"outline",className:"bg-blue-50",children:"Exactly as students will see"})]}),r.jsxs("div",{className:"border-4 border-blue-200 rounded-xl overflow-hidden shadow-lg",children:[r.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-800 text-white p-4",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"font-bold text-lg",children:"IELTS Academic Reading"}),r.jsx("p",{className:"text-blue-100 text-sm",children:O||"Reading Test"})]}),r.jsxs("div",{className:"text-right",children:[r.jsxs("div",{className:"text-2xl font-bold",children:["Passage ",H]}),r.jsxs("div",{className:"text-blue-100 text-sm",children:["Questions ",se[H].questionRange]})]})]})}),r.jsxs("div",{className:"grid grid-cols-2 divide-x divide-gray-200",children:[r.jsxs("div",{className:"bg-white dark:bg-gray-950 p-6 max-h-[600px] overflow-y-auto",children:[r.jsx("h4",{className:"font-bold text-xl mb-4 text-gray-900 dark:text-gray-100 border-b pb-2",children:se[H].title||`Reading Passage ${H}`}),r.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none",children:se[H].passageText?se[H].passageText.split("\n").filter(e=>e.trim()).map((e,s)=>r.jsx("p",{className:"mb-4 text-justify leading-relaxed text-gray-800 dark:text-gray-200 indent-8 first:indent-0",children:e},s)):r.jsx("p",{className:"text-muted-foreground italic",children:"No passage text added yet"})})]}),r.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 p-6 max-h-[600px] overflow-y-auto",children:[r.jsxs("h4",{className:"font-bold text-lg mb-4 text-gray-900 dark:text-gray-100",children:["Questions ",se[H].questionRange]}),se[H].sections.length>0?r.jsx("div",{className:"space-y-6",children:se[H].sections.map((e,s)=>r.jsxs("div",{className:"border-l-4 border-blue-500 pl-4",children:[r.jsxs("div",{className:"mb-3",children:[r.jsxs("h5",{className:"font-bold text-base text-gray-900 dark:text-gray-100",children:["Questions ",e.questionRange]}),r.jsx(l,{className:"mt-1",children:e.questionType}),e.instructions&&r.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2 italic bg-yellow-50 dark:bg-yellow-900/20 p-2 rounded",children:["ðŸ“‹ ",e.instructions]})]}),e.options&&e.options.length>0&&r.jsxs("div",{className:"mb-4 p-3 bg-white dark:bg-gray-800 rounded-lg border",children:[r.jsx("p",{className:"text-xs font-semibold text-gray-500 mb-2",children:"LIST OF HEADINGS/OPTIONS:"}),r.jsx("div",{className:"space-y-1",children:e.options.map((e,s)=>r.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:e},s))})]}),"Summary Completion"===e.questionType||"Short Answer"===e.questionType?r.jsx("div",{className:"space-y-2",children:r.jsx("div",{className:"flex flex-wrap gap-3",children:e.questions.map((e,s)=>r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"w-6 h-6 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 font-bold flex items-center justify-center text-xs",children:e.question_number}),r.jsx(x,{className:"w-32 border-dashed text-sm",placeholder:"Your answer",disabled:!0})]},s))})}):r.jsx("div",{className:"space-y-3",children:e.questions.map((s,t)=>r.jsxs("div",{className:"flex items-start gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg border hover:border-blue-300 transition-colors",children:[r.jsx("span",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 font-bold flex items-center justify-center text-sm",children:s.question_number}),r.jsxs("div",{className:"flex-1",children:[r.jsx("p",{className:"text-sm text-gray-800 dark:text-gray-200",children:s.question_text}),"True False Not Given"===e.questionType||"Yes No Not Given"===e.questionType?r.jsx("div",{className:"flex gap-2 mt-2",children:("True False Not Given"===e.questionType?["TRUE","FALSE","NOT GIVEN"]:["YES","NO","NOT GIVEN"]).map(e=>r.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",children:[r.jsx("input",{type:"radio",name:`q-${s.question_number}`,className:"w-4 h-4",disabled:!0}),r.jsx("span",{className:"text-xs",children:e})]},e))}):"Multiple Choice"===e.questionType&&s.options?r.jsx("div",{className:"space-y-1 mt-2",children:s.options.map((e,t)=>r.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700",children:[r.jsx("input",{type:"radio",name:`q-${s.question_number}`,className:"w-4 h-4",disabled:!0}),r.jsx("span",{children:e})]},t))}):"Matching Features"===e.questionType||"Matching Headings"===e.questionType?r.jsx(x,{className:"mt-2 w-16 border-dashed text-center",placeholder:"A-G",disabled:!0}):r.jsx(x,{className:"mt-2 max-w-xs border-dashed",placeholder:"Type your answer...",disabled:!0})]})]},t))})]},s))}):se[H].questions.length>0?r.jsx("div",{className:"space-y-3",children:se[H].questions.map((e,s)=>r.jsxs("div",{className:"flex items-start gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg border",children:[r.jsx("span",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 font-bold flex items-center justify-center text-sm",children:e.question_number||s+1}),r.jsxs("div",{className:"flex-1",children:[r.jsx("p",{className:"text-sm text-gray-800 dark:text-gray-200",children:e.question_text}),r.jsx(l,{variant:"outline",className:"mt-1 text-xs",children:e.question_type}),r.jsx(x,{className:"mt-2 max-w-xs border-dashed",placeholder:"Answer...",disabled:!0})]})]},s))}):r.jsx("p",{className:"text-muted-foreground italic",children:"No questions added yet"})]})]}),r.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-3 text-center text-xs text-muted-foreground",children:"Preview Mode â€¢ This is exactly how students will see the test"})]})]})]}),r.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200",children:[r.jsx("h4",{className:"text-sm font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"ðŸ’¡ How IELTS Reading works:"}),r.jsxs("ul",{className:"text-xs text-blue-800 dark:text-blue-200 space-y-1 list-disc list-inside mb-4",children:[r.jsx("li",{children:"IELTS Academic Reading has 3 passages with 40 questions total"}),r.jsx("li",{children:"Questions 1-13 = Passage 1, 14-26 = Passage 2, 27-40 = Passage 3"}),r.jsxs("li",{children:[r.jsx("strong",{children:"Copy & Paste"})," questions from Cambridge books or paste text directly"]}),r.jsxs("li",{children:[r.jsx("strong",{children:"Image Upload"})," for screenshots of question papers"]})]}),r.jsx("h4",{className:"text-sm font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"ðŸ“ 14 IELTS Reading Question Types (All Supported):"}),r.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-blue-800 dark:text-blue-200",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsx("p",{children:"1. Matching Headings"}),r.jsx("p",{children:"2. Matching Paragraph Info"}),r.jsx("p",{children:"3. Matching Features"}),r.jsx("p",{children:"4. Matching Sentence Endings"}),r.jsx("p",{children:"5. True/False/Not Given"}),r.jsx("p",{children:"6. Multiple Choice"}),r.jsx("p",{children:"7. List of Options"})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("p",{children:"8. Choose a Title"}),r.jsx("p",{children:"9. Short Answers"}),r.jsx("p",{children:"10. Sentence Completion"}),r.jsx("p",{children:"11. Summary Completion"}),r.jsx("p",{children:"12. Table Completion"}),r.jsx("p",{children:"13. Flow Chart Completion"}),r.jsx("p",{children:"14. Diagram Completion"})]})]})]}),r.jsxs("div",{className:"flex gap-3 justify-end pt-4 border-t",children:[re().length>0&&r.jsx(h,{variant:"outline",onClick:async()=>{const e=re();if(0!==e.length){V(!0);try{console.log("ðŸ¤– Generating AI explanations with Gemini...");const s=[1,2,3].map(e=>({passageNumber:e,text:se[e].passageText})).filter(e=>e.text),{data:t,error:a}=await S.functions.invoke("generate-reading-explanations",{body:{questions:e,passages:s}});if(a)throw a;if(!t.success)throw new Error(t.error||"Failed to generate explanations");const n={...se};t.explanations.forEach(e=>{const s=e.passageNumber||1,t=n[s].questions.findIndex(s=>s.question_number===e.questionNumber);-1!==t&&(n[s].questions[t].explanation=e.explanation)}),te(n),i.success(`Generated explanations for ${t.explanations.length} questions!`)}catch(s){console.error("Error generating explanations:",s),i.error(`Failed to generate explanations: ${s.message}`)}finally{V(!1)}}else i.error("Please add questions first")},disabled:U,className:"border-purple-300 text-purple-700 hover:bg-purple-50",size:"lg",children:U?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-purple-600 mr-2"}),"Generating Explanations..."]}):r.jsxs(r.Fragment,{children:[r.jsx(N,{className:"w-4 h-4 mr-2"}),"Generate AI Explanations"]})}),r.jsx(h,{onClick:oe,disabled:L,className:"bg-primary hover:bg-primary/90 px-8",size:"lg",children:L?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving Test..."]}):r.jsxs(r.Fragment,{children:[r.jsx(C,{className:"w-4 h-4 mr-2"}),"Save Complete Reading Test"]})})]})]})]})]})}):null};export{G as default};
