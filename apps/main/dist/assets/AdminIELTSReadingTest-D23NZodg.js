import{c as e,u as s,G as t,w as a,r as n,J as r,j as i,l,C as o,b as c,d,e as m,a as x,I as h,B as u,L as p,bb as g,F as b,T as f,N as j,P as N,E as v}from"./index-CbiFqfbO.js";import{T as w,a as y,b as q,c as T}from"./tabs-Cmws7A2v.js";import{A as _}from"./AdminLayout-Da-siA1a.js";import{I as S}from"./ImageQuestionExtractor-CG-PRzfJ.js";import{s as C}from"./supabase-DWL4C3fA.js";import{S as I}from"./save-mktcbz9o.js";import{I as E}from"./image-D_Fzbln8.js";import{C as A}from"./circle-alert-DSOkx7GJ.js";import{T as M}from"./trash-2-DK_iOJos.js";import"./upload-CoZqvV6v.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=e("ClipboardPaste",[["path",{d:"M15 2H9a1 1 0 0 0-1 1v2c0 .6.4 1 1 1h6c.6 0 1-.4 1-1V3c0-.6-.4-1-1-1Z",key:"1pp7kr"}],["path",{d:"M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2M16 4h2a2 2 0 0 1 2 2v2M11 14h10",key:"2ik1ml"}],["path",{d:"m17 10 4 4-4 4",key:"vp2hj1"}]]),k=[{value:"Matching Headings",label:"1. Matching Headings",keywords:["heading","paragraph","section"]},{value:"Matching Paragraph Information",label:"2. Matching Paragraph Information",keywords:["paragraph","contains","which paragraph"]},{value:"Matching Features",label:"3. Matching Features",keywords:["match","feature","researcher","writer","person"]},{value:"Matching Sentence Endings",label:"4. Matching Sentence Endings",keywords:["complete","sentence","ending"]},{value:"True False Not Given",label:"5. True/False/Not Given",keywords:["true","false","not given","TFNG"]},{value:"Yes No Not Given",label:"5. Yes/No/Not Given",keywords:["yes","no","not given","YNNG"]},{value:"Multiple Choice",label:"6. Multiple Choice",keywords:["choose","A","B","C","D","option"]},{value:"List Selection",label:"7. List of Options",keywords:["list","choose","THREE","TWO","select"]},{value:"Choose a Title",label:"8. Choose a Title",keywords:["title","best title","suitable title"]},{value:"Short Answer",label:"9. Short Answers",keywords:["answer","no more than","words"]},{value:"Sentence Completion",label:"10. Sentence Completion",keywords:["complete","sentence","blank"]},{value:"Summary Completion",label:"11. Summary Completion",keywords:["summary","complete the summary"]},{value:"Table Completion",label:"12. Table Completion",keywords:["table","complete the table"]},{value:"Flow Chart Completion",label:"13. Flow Chart Completion",keywords:["flow","chart","process"]},{value:"Diagram Completion",label:"14. Diagram Completion",keywords:["diagram","label"]}],F=e=>{const s=e.toLowerCase();return s.includes("true")&&s.includes("false")&&s.includes("not given")?"True False Not Given":s.includes("yes")&&s.includes("no")&&s.includes("not given")?"Yes No Not Given":s.includes("choose the correct letter")||s.includes("choose the best")||/choose.*letter\s*[A-D]/i.test(e)||/\n\s*[A-D]\s+[A-Z][a-z]+/.test(e)?"Multiple Choice":s.includes("complete the summary")||s.includes("complete the notes")||/\d+[â€¦.â€¦]{3,}/.test(e)||s.includes("no more than")&&s.includes("words")?"Summary Completion":s.includes("match")&&(s.includes("people")||s.includes("listed")||/[A-G]\s+\w+\s+\w+/.test(e))?"Matching Features":s.includes("heading")||s.includes("list of headings")?"Matching Headings":s.includes("which paragraph")||s.includes("paragraph contains")?"Matching Paragraph Information":s.includes("complete")&&s.includes("sentence")&&s.includes("ending")?"Matching Sentence Endings":s.includes("complete")&&s.includes("table")?"Table Completion":s.includes("complete")&&(s.includes("flow")||s.includes("chart"))?"Flow Chart Completion":s.includes("diagram")||s.includes("label")?"Diagram Completion":s.includes("choose")&&s.includes("title")?"Choose a Title":s.includes("complete")&&s.includes("sentence")?"Sentence Completion":"Short Answer"},$=()=>{const e=s(),{testId:$}=t(),{admin:R,loading:G}=a(),[O,Q]=n.useState(""),[L,Y]=n.useState(!1),[D,z]=n.useState(!0),[U,V]=n.useState(!1),[H,Z]=n.useState(1),[J,B]=n.useState("paste"),[W,X]=n.useState(""),[K,ee]=n.useState([]),[se,te]=n.useState({1:{passageNumber:1,title:"Passage 1",passageText:"",questions:[],sections:[],structureItems:[],extractionMetadata:null,questionRange:"1-13",imageFile:null,imageUrl:null},2:{passageNumber:2,title:"Passage 2",passageText:"",questions:[],sections:[],structureItems:[],extractionMetadata:null,questionRange:"14-26",imageFile:null,imageUrl:null},3:{passageNumber:3,title:"Passage 3",passageText:"",questions:[],sections:[],structureItems:[],extractionMetadata:null,questionRange:"27-40",imageFile:null,imageUrl:null}});n.useEffect(()=>{if(W.trim()){const e=(e=>{const s=[],t=[...e.matchAll(/Questions?\s+(\d+)(?:[-â€“â€”](\d+))?/gi)];if(0===t.length)return s;for(let a=0;a<t.length;a++){const n=t[a],r=parseInt(n[1]),i=n[2]?parseInt(n[2]):r,l=n.index,o=a<t.length-1?t[a+1].index:e.length,c=e.substring(l,o),d=F(c),m=c.match(/Questions?\s+\d+[-â€“â€”]\d+\s*([\s\S]*?)(?=\n\s*(?:[A-G]\s+\w|\d+\s+[A-Z]|\d+\.))/i),x=m?m[1].replace(/\s+/g," ").trim():"",h=[],u=c.split("\n");for(const e of u){const s=/([A-G])\s{1,3}([A-Za-z][A-Za-z\s]+?)(?=\s{3,}[A-G]\s|\s*$)/g;let t;for(;null!==(t=s.exec(e));){const e=t[1],s=t[2].trim();s.length>1&&/^[A-Z]/.test(s)&&!h.some(s=>s.startsWith(e+" "))&&h.push(`${e}  ${s}`)}const a=e.match(/^\s*([A-G])[.\)]\s*(.+)/);a&&!h.some(e=>e.startsWith(a[1]+" "))&&h.push(`${a[1]}  ${a[2].trim()}`)}h.sort((e,s)=>e.charCodeAt(0)-s.charCodeAt(0));const p=/^\s*([ivxIVX]+)[.\)]\s*(.+)/gm;let g;for(;null!==(g=p.exec(c));){const e=g[1].toLowerCase();h.some(s=>s.toLowerCase().startsWith(e+"."))||h.push(`${e}. ${g[2].trim()}`)}const b=[],f=c.split("\n"),j=[];let N="",v=0,w=!1;for(let e=0;e<f.length;e++){const s=f[e].trim();if(!s)continue;const t=s.match(/^(\d+)\s+(.+)/);if(t){const e=parseInt(t[1]);if(v>=r&&v<=i&&N){const e="True False Not Given"===d?["TRUE","FALSE","NOT GIVEN"]:"Yes No Not Given"===d?["YES","NO","NOT GIVEN"]:"Multiple Choice"===d&&j.length>0?[...j]:null;b.push({question_number:v,question_text:N.trim(),question_type:d,options:e,correct_answer:""}),j.length=0}e>=r&&e<=i?(v=e,N=t[2].trim(),w="Multiple Choice"===d):(v=0,N="")}else/^[A-D]\s+/.test(s)&&w?j.push(s):v>0&&(s.match(/^[A-G]\s+[A-Z]/)||s.match(/^Questions?\s/i)||(N+=" "+s))}if(v>=r&&v<=i&&N){const e="True False Not Given"===d?["TRUE","FALSE","NOT GIVEN"]:"Yes No Not Given"===d?["YES","NO","NOT GIVEN"]:"Multiple Choice"===d&&j.length>0?[...j]:null;b.push({question_number:v,question_text:N.trim(),question_type:d,options:e,correct_answer:""})}if(0===b.length&&("Summary Completion"===d||"Short Answer"===d)){const e=c.replace(/Questions?\s+\d+[-â€“â€”]?\d*[^\n]*\n/,"").trim();let s=e;for(let t=r;t<=i;t++)s=s.replace(new RegExp(`\\b${t}[â€¦.â€¦]+`,"g"),`(${t}) _______`);for(let t=r;t<=i;t++)b.push({question_number:t,question_text:`Blank ${t}`,question_type:d,options:null,correct_answer:""});s&&e.split("\n").slice(0,3).join(" ").trim()}let y="";if("Summary Completion"===d||"Short Answer"===d){const e=c.replace(/[\s\S]*?answer sheet\.?\s*/i,"").trim();if(e){y=e;for(let e=r;e<=i;e++)y=y.replace(new RegExp(`\\b${e}[â€¦.â€¦]+`,"g"),`_____(${e})_____`)}}if(b.length>0||r===i){if(0===b.length)for(let s=r;s<=i;s++)b.push({question_number:s,question_text:`Question ${s}`,question_type:d,options:"True False Not Given"===d?["TRUE","FALSE","NOT GIVEN"]:"Yes No Not Given"===d?["YES","NO","NOT GIVEN"]:null,correct_answer:""});let e=x;!y||"Summary Completion"!==d&&"Short Answer"!==d||(e=y),s.push({sectionTitle:r===i?`Question ${r}`:`Questions ${r}-${i}`,questionType:d,instructions:e,questionRange:r===i?`${r}`:`${r}-${i}`,options:h.length>0?h:null,questions:b})}}return s})(W);ee(e)}else ee([])},[W]);const ae=e=>e>=1&&e<=13?1:e>=14&&e<=26?2:e>=27&&e<=40?3:1;n.useEffect(()=>{G||R||e("/admin/login")},[R,G,e]),n.useEffect(()=>{$&&ne()},[$]);const ne=async()=>{if($)try{console.log("ðŸ“– Loading reading test data for testId:",$),z(!0);const{data:e,error:s}=await C.from("tests").select("*").eq("id",$).maybeSingle();if(s)throw console.error("Error fetching test:",s),s;if(!e)return console.error("âŒ Test not found:",$),r.error("Test not found"),void z(!1);console.log("âœ… Test loaded:",e.test_name),Q(e.test_name);const{data:t,error:a}=await C.from("questions").select("*").eq("test_id",$).order("part_number",{ascending:!0}).order("question_number_in_part",{ascending:!0});if(a&&console.error("Error fetching questions:",a),console.log("ðŸ“Š Found",(null==t?void 0:t.length)||0,"questions for this test"),t&&t.length>0){const e={1:{...se[1],questions:[],sections:[]},2:{...se[2],questions:[],sections:[]},3:{...se[3],questions:[],sections:[]}},s={1:[1,13],2:[14,26],3:[27,40]},a={1:0,2:0,3:0};t.forEach(t=>{let n=t.question_number_in_part??t.question_number??null,r=t.part_number??ae(n||0);const[i,l]=s[r]||[1,13];if(null!==n&&(n<i||n>l)&&(r=ae(n)),null===n){const[e]=s[r]||[1,13];n=e+a[r]}e[r]&&(!e[r].passageText&&t.passage_text&&(e[r].passageText=t.passage_text),e[r].questions.push({question_number:n,question_text:t.question_text,question_type:t.question_type||"Short Answer",options:t.choices?t.choices.split(";"):null,correct_answer:t.correct_answer,explanation:t.explanation}),a[r]+=1)}),te(e)}z(!1)}catch(e){console.error("âŒ Error loading test data:",e),r.error("Failed to load test data"),z(!1)}else z(!1)},re=(e,s)=>{te(t=>({...t,[e]:{...t[e],...s}}))},ie=()=>{const e=[];return[1,2,3].forEach(s=>{const t=se[s];t.questions.length>0&&t.questions.forEach((t,a)=>{e.push({...t,passageNumber:s,globalQuestionNumber:le(s,a)})})}),e},le=(e,s)=>1===e?s+1:2===e?13+s+1:26+s+1,oe=async()=>{if(!$)return void r.error("Test ID is required");if(ie().length>0||[1,2,3].some(e=>se[e].passageText.trim())){Y(!0);try{console.log("ðŸ’¾ Saving reading test...");const e="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN1dW14bWZ6aHdsanlsYmRsZmxqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM1MTkxMjEsImV4cCI6MjA2OTA5NTEyMX0.8jqO_ciOttSxSLZnKY0i5oJmEn79ROF53TjUMYhNemI",s=`${"https://cuumxmfzhwljylbdlflj.supabase.co"}/functions/v1/save-reading-test`,t=[],a={1:[1,13],2:[14,26],3:[27,40]};[1,2,3].forEach(e=>{const s=se[e],[n,r]=a[e];s.sections&&s.sections.length>0?s.sections.forEach(a=>{a.questions.forEach((i,l)=>{const o=i.question_number||l+1;o>=n&&o<=r&&t.push({...i,part_number:e,passage_text:s.passageText,question_number_in_part:o,question_type:a.questionType||i.question_type||"Short Answer",choices:a.options||i.options||null,structure_data:{sectionTitle:a.sectionTitle,sectionRange:a.questionRange,instructions:a.instructions,options:a.options}})})}):s.questions.forEach((a,i)=>{const l=a.question_number||i+1;l>=n&&l<=r&&t.push({...a,part_number:e,passage_text:s.passageText,question_number_in_part:l,question_type:a.question_type||"Short Answer",choices:a.options||null})})}),console.log(`ðŸ“Š Saving ${t.length} questions (strict range validation applied)`);const n={testId:$,testData:{title:O||"IELTS Reading Test",passages:[1,2,3].map(e=>({passageNumber:e,title:se[e].title,passageText:se[e].passageText,questionRange:se[e].questionRange,structureItems:se[e].structureItems,extractionMetadata:se[e].extractionMetadata,sections:se[e].sections||[]}))},questions:t};console.log("ðŸ“¦ Data being sent:",JSON.stringify(n,null,2));const i=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",apikey:e,Authorization:`Bearer ${e}`},body:JSON.stringify(n)}),l=await i.json();if(!i.ok)throw new Error(l.error||"Failed to save test");console.log("âœ… Test saved successfully!"),r.success("Reading test saved successfully!")}catch(e){console.error("Error saving test:",e),r.error(`Failed to save test: ${e.message}`)}finally{Y(!1)}}else r.error("Please add at least one passage or questions")};return G||D?i.jsx(_,{title:"Loading Reading Test...",showBackButton:!0,backPath:"/admin/ielts/reading",children:i.jsx("div",{className:"flex items-center justify-center min-h-96",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),i.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading reading test data..."})]})})}):R?i.jsx(_,{title:`IELTS Reading Test - ${O||$}`,showBackButton:!0,backPath:"/admin/ielts/reading",children:i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-3xl font-bold tracking-tight text-[#2f241f]",children:"IELTS Reading Test Management"}),i.jsx("p",{className:"text-[#5a4a3f] mt-1",children:"Create a complete reading test with 3 passages and 40 questions total"})]}),i.jsxs(l,{className:"bg-amber-100 text-amber-800 border-amber-200 text-sm",children:["Test ID: ",null==$?void 0:$.substring(0,8),"..."]})]}),i.jsxs(o,{className:"border-2 border-[#e0d6c7] bg-[#fdfaf3] shadow-sm",children:[i.jsx(c,{className:"bg-amber-50/50 border-b border-[#e0d6c7]",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs(d,{className:"flex items-center gap-2 text-[#2f241f]",children:[i.jsx(m,{className:"w-5 h-5 text-amber-600"}),"Reading Test - All Passages (1-3)"]}),i.jsx(l,{className:"bg-white border-amber-200 text-amber-700 text-xs",children:"Preview updates instantly â†“"})]})}),i.jsxs(x,{className:"space-y-6 bg-[#fdfaf3] pt-6",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-sm font-medium text-[#2f241f]",children:"Test Name *"}),i.jsx("p",{className:"text-xs text-[#5a4a3f] mb-2",children:'Give this test a descriptive name (e.g., "IELTS Reading Test 1 - Cambridge 18")'}),i.jsx(h,{placeholder:"IELTS Reading Test 1",value:O,onChange:e=>Q(e.target.value),className:"max-w-md bg-white border-[#e0d6c7] text-[#2f241f] focus:border-amber-400"})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("div",{className:"flex items-center justify-between",children:i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium text-[#2f241f]",children:"Passages & Questions"}),i.jsx("p",{className:"text-xs text-[#5a4a3f]",children:"Upload passages and use AI to extract questions from images"})]})}),i.jsx("div",{className:"flex gap-2 border-b border-[#e0d6c7] pb-2",children:[1,2,3].map(e=>{const s=se[e],t=s.questions.length>0,a=s.passageText.trim().length>0;return i.jsxs(u,{variant:H===e?"default":"outline",size:"sm",onClick:()=>Z(e),className:"relative "+(H===e?"bg-amber-600 hover:bg-amber-700 text-white ring-2 ring-amber-300":"bg-white border-[#e0d6c7] text-[#2f241f] hover:bg-amber-50"),children:["Passage ",e,t&&i.jsx(p,{className:"w-3 h-3 ml-1 text-green-500"}),a&&!t&&i.jsx(g,{className:"w-3 h-3 ml-1 text-amber-400"}),i.jsxs("span",{className:"ml-1 text-xs "+(H===e?"text-amber-100":"text-[#5a4a3f]"),children:["(",s.questionRange,")"]})]},e)})}),i.jsxs("div",{className:"border-2 border-[#e0d6c7] rounded-lg p-4 bg-white",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("div",{children:[i.jsxs("h4",{className:"font-semibold text-lg text-[#2f241f]",children:["Passage ",H]}),i.jsxs("p",{className:"text-sm text-[#5a4a3f]",children:["Questions ",se[H].questionRange," â€¢ ",se[H].questions.length," questions extracted"]})]}),se[H].questions.length>0&&i.jsxs(l,{className:"bg-amber-100 text-amber-800 border-amber-200",children:[i.jsx(p,{className:"w-3 h-3 mr-1"}),se[H].questions.length," Questions"]})]}),i.jsxs("div",{className:"space-y-2 mb-4",children:[i.jsx("label",{className:"text-sm font-medium text-[#2f241f]",children:"Passage Title"}),i.jsx(h,{placeholder:`Passage ${H} Title (e.g., "The History of Coffee")`,value:se[H].title,onChange:e=>re(H,{title:e.target.value}),className:"max-w-lg bg-white border-[#e0d6c7] text-[#2f241f] focus:border-amber-400"})]}),i.jsxs("div",{className:"space-y-2 mb-6",children:[i.jsxs("label",{className:"text-sm font-medium text-[#2f241f]",children:[i.jsx(b,{className:"w-4 h-4 inline mr-1 text-amber-600"}),"Passage Text *"]}),i.jsx("p",{className:"text-xs text-[#5a4a3f]",children:"Paste the full reading passage text here. This will be shown to students during the test."}),i.jsx(f,{placeholder:"Paste the complete reading passage text here...",value:se[H].passageText,onChange:e=>re(H,{passageText:e.target.value}),rows:12,className:"font-serif text-sm leading-relaxed bg-white border-[#e0d6c7] text-[#2f241f]"}),se[H].passageText&&i.jsxs("div",{className:"flex items-center justify-between p-2 bg-amber-50 rounded-lg border border-amber-200",children:[i.jsxs("p",{className:"text-xs text-amber-800 flex items-center gap-2",children:[i.jsx(p,{className:"w-3 h-3"}),se[H].passageText.split(" ").length," words"]}),i.jsx(u,{onClick:oe,disabled:L,size:"sm",className:"bg-amber-600 hover:bg-amber-700 text-white",children:L?i.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}):i.jsxs(i.Fragment,{children:[i.jsx(I,{className:"w-3 h-3 mr-1"}),"Save Passage"]})})]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(j,{className:"w-4 h-4 text-amber-500"}),i.jsx("label",{className:"text-sm font-medium text-[#2f241f]",children:"Add Questions"})]}),i.jsxs(l,{className:"bg-amber-100 text-amber-800 border-amber-200 text-xs",children:[k.length," question types supported"]})]}),i.jsxs(w,{value:J,onValueChange:e=>B(e),children:[i.jsxs(y,{className:"grid w-full grid-cols-2 bg-[#fdfaf3] border border-[#e0d6c7]",children:[i.jsxs(q,{value:"paste",className:"gap-2 data-[state=active]:bg-amber-600 data-[state=active]:text-white",children:[i.jsx(P,{className:"w-4 h-4"}),"Copy & Paste"]}),i.jsxs(q,{value:"image",className:"gap-2 data-[state=active]:bg-amber-600 data-[state=active]:text-white",children:[i.jsx(E,{className:"w-4 h-4"}),"Image Upload"]})]}),i.jsx(T,{value:"paste",className:"mt-4 space-y-4",children:i.jsxs(o,{className:"border-2 border-[#e0d6c7] bg-white",children:[i.jsxs(c,{className:"pb-3 bg-amber-50/50 border-b border-[#e0d6c7]",children:[i.jsxs(d,{className:"text-base flex items-center gap-2 text-[#2f241f]",children:[i.jsx(P,{className:"w-4 h-4 text-amber-600"}),"Paste All Questions (Auto-Detect)"]}),i.jsx("p",{className:"text-xs text-[#5a4a3f]",children:"Just paste everything! System auto-detects question types, ranges, and options."})]}),i.jsxs(x,{className:"space-y-4 pt-4 bg-[#fdfaf3]",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-1 block text-[#2f241f]",children:"Paste Questions (including headers)"}),i.jsx(f,{placeholder:"Paste entire question section here...",value:W,onChange:e=>X(e.target.value),rows:14,className:"font-mono text-sm bg-white border-[#e0d6c7] text-[#2f241f]"})]}),K.length>0&&i.jsxs("div",{className:"p-3 bg-amber-50 rounded-lg border-2 border-amber-300",children:[i.jsxs("p",{className:"text-sm font-medium text-amber-800 mb-2 flex items-center gap-2",children:[i.jsx(p,{className:"w-4 h-4"}),"Auto-Detected ",K.length," Section",K.length>1?"s":"",":"]}),i.jsx("div",{className:"space-y-2",children:K.map((e,s)=>{var t;const a=(null==(t=e.questions[0])?void 0:t.question_number)||parseInt(e.questionRange.split("-")[0]),n=ae(a);return i.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded border border-[#e0d6c7]",children:[i.jsxs(l,{className:1===n?"bg-amber-600":2===n?"bg-orange-600":"bg-yellow-600",children:["P",n]}),i.jsx(l,{variant:"outline",className:"border-amber-200",children:e.questionRange}),i.jsx(l,{variant:"secondary",className:"bg-amber-100 text-amber-800",children:e.questionType}),i.jsxs("span",{className:"text-xs text-[#5a4a3f]",children:["(",e.questions.length," questions)"]}),e.options&&e.options.length>0&&i.jsxs("span",{className:"text-xs text-amber-600",children:["+",e.options.length," options"]})]},s)})}),i.jsx("p",{className:"text-xs text-[#5a4a3f] mt-2",children:"ðŸ“ Questions auto-assigned: 1-13 â†’ P1, 14-26 â†’ P2, 27-40 â†’ P3"})]}),W&&0===K.length&&i.jsx("div",{className:"p-2 bg-red-50 rounded-lg border border-red-200",children:i.jsxs("p",{className:"text-xs text-red-800 flex items-center gap-2",children:[i.jsx(A,{className:"w-3 h-3"}),'No sections detected. Make sure text includes "Questions X-Y" headers.']})}),i.jsxs(u,{onClick:()=>{if(0===K.length)return void r.error('No sections detected. Make sure your text contains "Questions X-Y" headers.');const e={1:[],2:[],3:[]};K.forEach(s=>{var t;const a=(null==(t=s.questions[0])?void 0:t.question_number)||parseInt(s.questionRange.split("-")[0]),n=ae(a);e[n].push(s)});let s=0;const t=[];[1,2,3].forEach(a=>{const n=e[a];if(n.length>0){const e=n.flatMap(e=>e.questions);re(a,{sections:n,questions:e}),s+=e.length,t.push(`P${a}: ${e.length}q`)}}),K.map(e=>`${e.questionRange}: ${e.questionType}`).join(", "),console.log(`âœ… Applied ${K.length} sections with ${s} questions`),r.success(`Added ${s} questions!`,{description:t.join(" | ")}),X(""),ee([])},disabled:0===K.length,className:"w-full bg-amber-600 hover:bg-amber-700 text-white",size:"lg",children:[i.jsx(N,{className:"w-4 h-4 mr-2"}),"Add ",K.length," Section",1!==K.length?"s":""," to Passage ",H]}),i.jsxs("div",{className:"border-t border-[#e0d6c7] pt-3 mt-3",children:[i.jsx("p",{className:"text-xs font-medium text-[#5a4a3f] mb-2",children:"âœ¨ Auto-Detection Works For:"}),i.jsxs("div",{className:"flex flex-wrap gap-1",children:[i.jsx(l,{variant:"outline",className:"text-xs border-amber-200 text-[#5a4a3f]",children:"True/False/Not Given"}),i.jsx(l,{variant:"outline",className:"text-xs border-amber-200 text-[#5a4a3f]",children:"Yes/No/Not Given"}),i.jsx(l,{variant:"outline",className:"text-xs border-amber-200 text-[#5a4a3f]",children:"Matching Features"}),i.jsx(l,{variant:"outline",className:"text-xs border-amber-200 text-[#5a4a3f]",children:"Matching Headings"}),i.jsx(l,{variant:"outline",className:"text-xs border-amber-200 text-[#5a4a3f]",children:"Multiple Choice"}),i.jsx(l,{variant:"outline",className:"text-xs border-amber-200 text-[#5a4a3f]",children:"Summary Completion"}),i.jsx(l,{variant:"outline",className:"text-xs border-amber-200 text-[#5a4a3f]",children:"+8 more"})]})]})]})]})}),i.jsx(T,{value:"image",className:"mt-4",children:i.jsx(S,{testId:$||"",testType:"IELTS-Reading",initialImageFile:se[H].imageFile,onImageSelected:e=>re(H,{imageFile:e}),onQuestionsExtracted:(e,s)=>{console.log(`âœ¨ Passage ${H}: AI extracted ${e.length} questions`),re(H,{questions:e,structureItems:(null==s?void 0:s.structureItems)||[],extractionMetadata:s||null});const t=(null==s?void 0:s.questionType)?` (${s.questionType})`:"";r.success(`Passage ${H}: ${e.length} questions extracted!${t}`)}})})]})]}),0===se[H].questions.length&&i.jsx("div",{className:"mt-4 p-4 border-2 border-dashed border-[#e0d6c7] rounded-lg bg-[#fdfaf3]",children:i.jsxs("p",{className:"text-center text-[#5a4a3f] text-sm",children:["ðŸ“‹ Use ",i.jsx("strong",{children:"Copy & Paste"})," to paste question text, or ",i.jsx("strong",{children:"Image Upload"})," to extract from screenshots"]})}),(se[H].questions.length>0||se[H].sections.length>0)&&i.jsxs("div",{className:"mt-6 space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsxs("h5",{className:"font-medium text-[#2f241f]",children:["Extracted Questions (",se[H].questions.length,")"]}),se[H].sections.length>0&&i.jsxs("p",{className:"text-xs text-[#5a4a3f]",children:[se[H].sections.length," question section(s) detected"]})]}),i.jsxs(u,{variant:"outline",size:"sm",onClick:()=>re(H,{questions:[],sections:[]}),className:"text-red-600 hover:bg-red-50 border-red-200",children:[i.jsx(M,{className:"w-3 h-3 mr-1"}),"Clear All"]})]}),se[H].sections.length>0?i.jsx("div",{className:"space-y-4 max-h-[500px] overflow-y-auto pr-2",children:se[H].sections.map((e,s)=>i.jsxs(o,{className:"border-2 border-[#e0d6c7]",children:[i.jsxs(c,{className:"pb-2 bg-amber-50/50",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs(d,{className:"text-sm flex items-center gap-2 text-[#2f241f]",children:[i.jsx(l,{className:"bg-amber-600",children:e.questionRange}),i.jsx("span",{children:e.questionType})]}),i.jsxs(l,{variant:"outline",className:"border-amber-200 text-amber-800",children:[e.questions.length," questions"]})]}),e.instructions&&i.jsx("p",{className:"text-xs text-[#5a4a3f] mt-1 italic",children:e.instructions})]}),i.jsxs(x,{className:"pt-3 space-y-2 bg-[#fdfaf3]",children:[e.options&&e.options.length>0&&i.jsxs("div",{className:"p-2 bg-white rounded border border-[#e0d6c7] mb-3",children:[i.jsx("p",{className:"text-xs font-medium text-[#2f241f] mb-1",children:"Options:"}),i.jsx("div",{className:"flex flex-wrap gap-1",children:e.options.map((e,s)=>i.jsx(l,{variant:"outline",className:"text-xs border-[#e0d6c7] text-[#5a4a3f]",children:e},s))})]}),e.questions.map((e,s)=>i.jsxs("div",{className:"flex items-start gap-2 p-2 rounded bg-white border border-[#e0d6c7] hover:border-amber-300",children:[i.jsx(l,{variant:"outline",className:"flex-shrink-0 text-xs border-amber-200 text-amber-800",children:e.question_number}),i.jsxs("div",{className:"flex-1 text-sm text-[#2f241f]",children:[i.jsx("span",{children:e.question_text}),e.correct_answer&&i.jsxs("span",{className:"ml-2 text-green-600 font-medium text-xs",children:["â†’ ",e.correct_answer]})]})]},s))]})]},s))}):i.jsx("div",{className:"space-y-3 max-h-[400px] overflow-y-auto pr-2",children:se[H].questions.map((e,s)=>i.jsx(o,{className:"bg-white border-[#e0d6c7] shadow-sm",children:i.jsx(x,{className:"p-3",children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsxs(l,{variant:"outline",className:"flex-shrink-0 border-amber-200 text-amber-800",children:["Q",e.question_number||s+1]}),i.jsxs("div",{className:"flex-1 space-y-1",children:[i.jsx("p",{className:"text-sm text-[#2f241f]",children:e.question_text}),e.options&&e.options.length>0&&i.jsxs("div",{className:"text-xs text-[#5a4a3f]",children:["Options: ",e.options.join(" | ")]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[i.jsx(l,{variant:"secondary",className:"text-xs bg-amber-50 text-amber-800",children:e.question_type}),e.correct_answer&&i.jsxs("span",{className:"text-green-600 font-medium",children:["Answer: ",e.correct_answer]})]})]})]})})},s))}),i.jsxs("div",{className:"mt-4 pt-4 border-t border-[#e0d6c7]",children:[i.jsx(u,{onClick:oe,disabled:L,className:"w-full bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-700 hover:to-orange-700 text-white font-semibold py-3",size:"lg",children:L?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):i.jsxs(i.Fragment,{children:[i.jsx(I,{className:"w-5 h-5 mr-2"}),"Save Passage ",H," Questions"]})}),i.jsx("p",{className:"text-xs text-center text-[#5a4a3f] mt-2",children:"ðŸ’¡ Save after adding questions to each passage"})]})]})]}),i.jsx("div",{className:"grid grid-cols-3 gap-2 mt-4",children:[1,2,3].map(e=>{const s=se[e],t=s.passageText.trim().length>0,a=s.questions.length>0?"complete":t?"passage-ready":"empty";return i.jsxs("div",{className:`p-3 rounded-lg border text-center cursor-pointer transition-all ${"complete"===a?"bg-amber-100 border-amber-300":"passage-ready"===a?"bg-orange-50 border-orange-200":"bg-gray-50 border-gray-200"} ${H===e?"ring-2 ring-amber-500":""}`,onClick:()=>Z(e),children:[i.jsxs("div",{className:"font-semibold text-sm "+("complete"===a?"text-amber-900":"text-[#2f241f]"),children:["Passage ",e]}),i.jsx("div",{className:"text-xs text-[#5a4a3f]",children:s.questionRange}),i.jsx("div",{className:"text-xs mt-1 font-medium "+("complete"===a?"text-amber-700":"passage-ready"===a?"text-orange-600":"text-gray-400"),children:"complete"===a?`${s.questions.length} Questions`:"passage-ready"===a?"Passage Added":"Empty"})]},e)})}),(se[H].passageText||se[H].questions.length>0)&&i.jsxs("div",{className:"mt-6 border-t border-[#e0d6c7] pt-6",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[i.jsx(v,{className:"w-5 h-5 text-amber-600"}),i.jsxs("h4",{className:"font-semibold text-[#2f241f]",children:["Student View Preview - Passage ",H]}),i.jsx(l,{variant:"outline",className:"bg-amber-50 border-amber-200 text-amber-800",children:"Exactly as students will see"})]}),i.jsxs("div",{className:"border-4 border-[#e0d6c7] rounded-xl overflow-hidden shadow-lg bg-white",children:[i.jsx("div",{className:"bg-[#2f241f] text-white p-4",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"font-bold text-lg text-[#fdfaf3]",children:"IELTS Academic Reading"}),i.jsx("p",{className:"text-amber-200 text-sm",children:O||"Reading Test"})]}),i.jsxs("div",{className:"text-right",children:[i.jsxs("div",{className:"text-2xl font-bold text-[#fdfaf3]",children:["Passage ",H]}),i.jsxs("div",{className:"text-amber-200 text-sm",children:["Questions ",se[H].questionRange]})]})]})}),i.jsxs("div",{className:"grid grid-cols-2 divide-x divide-[#e0d6c7]",children:[i.jsxs("div",{className:"bg-[#fdfaf3] p-6 max-h-[600px] overflow-y-auto",children:[i.jsx("h4",{className:"font-bold text-xl mb-4 text-[#2f241f] border-b border-[#e0d6c7] pb-2 font-serif",children:se[H].title||`Reading Passage ${H}`}),i.jsx("div",{className:"prose prose-sm max-w-none",children:se[H].passageText?se[H].passageText.split("\n").filter(e=>e.trim()).map((e,s)=>i.jsx("p",{className:"mb-4 text-justify leading-relaxed text-[#2f241f] indent-8 first:indent-0 font-serif",children:e},s)):i.jsx("p",{className:"text-[#5a4a3f] italic",children:"No passage text added yet"})})]}),i.jsxs("div",{className:"bg-white p-6 max-h-[600px] overflow-y-auto",children:[i.jsxs("h4",{className:"font-bold text-lg mb-4 text-[#2f241f]",children:["Questions ",se[H].questionRange]}),se[H].sections.length>0?i.jsx("div",{className:"space-y-6",children:se[H].sections.map((e,s)=>i.jsxs("div",{className:"border-l-4 border-amber-500 pl-4",children:[i.jsxs("div",{className:"mb-3",children:[i.jsxs("h5",{className:"font-bold text-base text-[#2f241f]",children:["Questions ",e.questionRange]}),i.jsx(l,{className:"mt-1 bg-amber-100 text-amber-800 hover:bg-amber-200",children:e.questionType}),e.instructions&&i.jsxs("p",{className:"text-sm text-[#5a4a3f] mt-2 italic bg-[#fdfaf3] p-2 rounded border border-[#e0d6c7]",children:["ðŸ“‹ ",e.instructions]})]}),e.options&&e.options.length>0&&i.jsxs("div",{className:"mb-4 p-3 bg-[#fdfaf3] rounded-lg border border-[#e0d6c7]",children:[i.jsx("p",{className:"text-xs font-semibold text-[#5a4a3f] mb-2",children:"LIST OF HEADINGS/OPTIONS:"}),i.jsx("div",{className:"space-y-1",children:e.options.map((e,s)=>i.jsx("div",{className:"text-sm text-[#2f241f]",children:e},s))})]}),"Summary Completion"===e.questionType||"Short Answer"===e.questionType?i.jsx("div",{className:"space-y-2",children:i.jsx("div",{className:"flex flex-wrap gap-3",children:e.questions.map((e,s)=>i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"w-6 h-6 rounded-full bg-amber-100 text-amber-800 font-bold flex items-center justify-center text-xs border border-amber-200",children:e.question_number}),i.jsx(h,{className:"w-32 border-dashed border-[#e0d6c7] text-sm bg-[#fdfaf3]",placeholder:"Your answer",disabled:!0})]},s))})}):i.jsx("div",{className:"space-y-3",children:e.questions.map((s,t)=>i.jsxs("div",{className:"flex items-start gap-3 p-3 bg-[#fdfaf3] rounded-lg border border-[#e0d6c7] hover:border-amber-300 transition-colors",children:[i.jsx("span",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-amber-100 text-amber-800 font-bold flex items-center justify-center text-sm border border-amber-200",children:s.question_number}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm text-[#2f241f]",children:s.question_text}),"True False Not Given"===e.questionType||"Yes No Not Given"===e.questionType?i.jsx("div",{className:"flex gap-2 mt-2",children:("True False Not Given"===e.questionType?["TRUE","FALSE","NOT GIVEN"]:["YES","NO","NOT GIVEN"]).map(e=>i.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",children:[i.jsx("input",{type:"radio",name:`q-${s.question_number}`,className:"w-4 h-4 accent-amber-600",disabled:!0}),i.jsx("span",{className:"text-xs text-[#5a4a3f]",children:e})]},e))}):"Multiple Choice"===e.questionType&&s.options?i.jsx("div",{className:"space-y-1 mt-2",children:s.options.map((e,t)=>i.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer p-1 rounded hover:bg-amber-50",children:[i.jsx("input",{type:"radio",name:`q-${s.question_number}`,className:"w-4 h-4 accent-amber-600",disabled:!0}),i.jsx("span",{className:"text-[#2f241f]",children:e})]},t))}):"Matching Features"===e.questionType||"Matching Headings"===e.questionType?i.jsx(h,{className:"mt-2 w-16 border-dashed border-[#e0d6c7] text-center bg-white",placeholder:"A-G",disabled:!0}):i.jsx(h,{className:"mt-2 max-w-xs border-dashed border-[#e0d6c7] bg-white",placeholder:"Type your answer...",disabled:!0})]})]},t))})]},s))}):se[H].questions.length>0?i.jsx("div",{className:"space-y-3",children:se[H].questions.map((e,s)=>i.jsxs("div",{className:"flex items-start gap-3 p-3 bg-[#fdfaf3] rounded-lg border border-[#e0d6c7]",children:[i.jsx("span",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-amber-100 text-amber-800 font-bold flex items-center justify-center text-sm border border-amber-200",children:e.question_number||s+1}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm text-[#2f241f]",children:e.question_text}),i.jsx(l,{variant:"outline",className:"mt-1 text-xs border-amber-200 text-amber-800",children:e.question_type}),i.jsx(h,{className:"mt-2 max-w-xs border-dashed border-[#e0d6c7] bg-white",placeholder:"Answer...",disabled:!0})]})]},s))}):i.jsx("p",{className:"text-[#5a4a3f] italic",children:"No questions added yet"})]})]}),i.jsx("div",{className:"bg-[#f0ece2] p-3 text-center text-xs text-[#5a4a3f]",children:"Preview Mode â€¢ This is exactly how students will see the test"})]})]})]}),i.jsxs("div",{className:"bg-[#fdfaf3] rounded-lg p-4 border border-[#e0d6c7]",children:[i.jsx("h4",{className:"text-sm font-semibold text-[#2f241f] mb-2",children:"ðŸ’¡ How IELTS Reading works:"}),i.jsxs("ul",{className:"text-xs text-[#5a4a3f] space-y-1 list-disc list-inside mb-4",children:[i.jsx("li",{children:"IELTS Academic Reading has 3 passages with 40 questions total"}),i.jsx("li",{children:"Questions 1-13 = Passage 1, 14-26 = Passage 2, 27-40 = Passage 3"}),i.jsxs("li",{children:[i.jsx("strong",{children:"Copy & Paste"})," questions from Cambridge books or paste text directly"]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Image Upload"})," for screenshots of question papers"]})]}),i.jsx("h4",{className:"text-sm font-semibold text-[#2f241f] mb-2",children:"ðŸ“ 14 IELTS Reading Question Types (All Supported):"}),i.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-[#5a4a3f]",children:[i.jsxs("div",{className:"space-y-1",children:[i.jsx("p",{children:"1. Matching Headings"}),i.jsx("p",{children:"2. Matching Paragraph Info"}),i.jsx("p",{children:"3. Matching Features"}),i.jsx("p",{children:"4. Matching Sentence Endings"}),i.jsx("p",{children:"5. True/False/Not Given"}),i.jsx("p",{children:"6. Multiple Choice"}),i.jsx("p",{children:"7. List of Options"})]}),i.jsxs("div",{className:"space-y-1",children:[i.jsx("p",{children:"8. Choose a Title"}),i.jsx("p",{children:"9. Short Answers"}),i.jsx("p",{children:"10. Sentence Completion"}),i.jsx("p",{children:"11. Summary Completion"}),i.jsx("p",{children:"12. Table Completion"}),i.jsx("p",{children:"13. Flow Chart Completion"}),i.jsx("p",{children:"14. Diagram Completion"})]})]})]}),i.jsxs("div",{className:"flex gap-3 justify-end pt-4 border-t border-[#e0d6c7]",children:[ie().length>0&&i.jsx(u,{variant:"outline",onClick:async()=>{const e=ie();if(0!==e.length){V(!0);try{console.log("ðŸ¤– Generating AI explanations with Gemini...");const s=[1,2,3].map(e=>({passageNumber:e,text:se[e].passageText})).filter(e=>e.text),{data:t,error:a}=await C.functions.invoke("generate-reading-explanations",{body:{questions:e,passages:s}});if(a)throw a;if(!t.success)throw new Error(t.error||"Failed to generate explanations");const n={...se};t.explanations.forEach(e=>{const s=e.passageNumber||1,t=n[s].questions.findIndex(s=>s.question_number===e.questionNumber);-1!==t&&(n[s].questions[t].explanation=e.explanation)}),te(n),r.success(`Generated explanations for ${t.explanations.length} questions!`)}catch(s){console.error("Error generating explanations:",s),r.error(`Failed to generate explanations: ${s.message}`)}finally{V(!1)}}else r.error("Please add questions first")},disabled:U,className:"border-[#e0d6c7] text-[#5a4a3f] hover:bg-[#fdfaf3]",size:"lg",children:U?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-amber-600 mr-2"}),"Generating Explanations..."]}):i.jsxs(i.Fragment,{children:[i.jsx(j,{className:"w-4 h-4 mr-2"}),"Generate AI Explanations"]})}),i.jsx(u,{onClick:oe,disabled:L,className:"bg-amber-600 hover:bg-amber-700 text-white px-8",size:"lg",children:L?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving Test..."]}):i.jsxs(i.Fragment,{children:[i.jsx(I,{className:"w-4 h-4 mr-2"}),"Save Complete Reading Test"]})})]})]})]})]})}):null};export{$ as default};
