import{c as e,u as s,G as t,w as a,r as n,J as r,j as i,l as o,C as l,b as c,d,e as m,a as u,I as x,B as h,L as p,bi as g,ax as b,F as f,T as N,O as j,P as v,am as w,E as q,D as y,m as T,n as k,o as _,bp as A,X as C,bs as E}from"./index-CgS2SMUD.js";import{T as S,a as I,b as F,c as $}from"./tabs-ChlgK-lb.js";import{A as R}from"./AdminLayout-CDn_9VLs.js";import{I as G,P as M}from"./ImageQuestionExtractor-Dt39P7mv.js";import{s as P}from"./supabase-DWL4C3fA.js";import{S as O}from"./save-VzlaaWL8.js";import{I as D}from"./image-CG82WxDK.js";import{C as Q}from"./circle-alert-wejo28ip.js";import{T as L}from"./trash-2-DNKT7J8g.js";import"./upload-BlApq2h7.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=e("ClipboardPaste",[["path",{d:"M15 2H9a1 1 0 0 0-1 1v2c0 .6.4 1 1 1h6c.6 0 1-.4 1-1V3c0-.6-.4-1-1-1Z",key:"1pp7kr"}],["path",{d:"M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2M16 4h2a2 2 0 0 1 2 2v2M11 14h10",key:"2ik1ml"}],["path",{d:"m17 10 4 4-4 4",key:"vp2hj1"}]]),Y=[{value:"Matching Headings",label:"1. Matching Headings",keywords:["heading","paragraph","section"]},{value:"Matching Paragraph Information",label:"2. Matching Paragraph Information",keywords:["paragraph","contains","which paragraph"]},{value:"Matching Features",label:"3. Matching Features",keywords:["match","feature","researcher","writer","person"]},{value:"Matching Sentence Endings",label:"4. Matching Sentence Endings",keywords:["complete","sentence","ending"]},{value:"True False Not Given",label:"5. True/False/Not Given",keywords:["true","false","not given","TFNG"]},{value:"Yes No Not Given",label:"5. Yes/No/Not Given",keywords:["yes","no","not given","YNNG"]},{value:"Multiple Choice",label:"6. Multiple Choice",keywords:["choose","A","B","C","D","option"]},{value:"List Selection",label:"7. List of Options",keywords:["list","choose","THREE","TWO","select"]},{value:"Choose a Title",label:"8. Choose a Title",keywords:["title","best title","suitable title"]},{value:"Short Answer",label:"9. Short Answers",keywords:["answer","no more than","words"]},{value:"Sentence Completion",label:"10. Sentence Completion",keywords:["complete","sentence","blank"]},{value:"Summary Completion",label:"11. Summary Completion",keywords:["summary","complete the summary"]},{value:"Table Completion",label:"12. Table Completion",keywords:["table","complete the table"]},{value:"Flow Chart Completion",label:"13. Flow Chart Completion",keywords:["flow","chart","process"]},{value:"Diagram Completion",label:"14. Diagram Completion",keywords:["diagram","label"]}],z=e=>{const s=e.toLowerCase(),t=s.replace(/\s+/g," "),a=/^\s*YES\s+if/im.test(e)||t.includes("write yes"),n=/^\s*TRUE\s+if/im.test(e)||t.includes("write true");if(a&&s.includes("not given")&&!n)return"Yes No Not Given";if(n&&s.includes("not given"))return"True False Not Given";if((/^\s*YES\s*$/im.test(e)||/^\s*NO\s*$/im.test(e))&&s.includes("not given"))return"Yes No Not Given";if((/^\s*TRUE\s*$/im.test(e)||/^\s*FALSE\s*$/im.test(e))&&s.includes("not given"))return"True False Not Given";const r=/list\s+of\s+\w+/i.test(e),i=/\n\s*[A-E]\s+[A-Z]/m.test(e);if(s.includes("match each statement")||s.includes("match each")||s.includes("match")&&s.includes("with the correct")||r&&i||s.includes("list of books")||s.includes("list of people")||s.includes("list of researchers")||s.includes("list of writers")||s.includes("match")&&(s.includes("people")||s.includes("listed")||/[A-G]\s+\w+\s+\w+/.test(e)))return"Matching Features";if(s.includes("complete the summary")||s.includes("complete the notes")||/\d+[â€¦.â€¦]{3,}/.test(e)||s.includes("no more than")&&s.includes("words"))return"Summary Completion";return!(s.includes("list of")||s.includes("match"))&&(s.includes("choose the correct letter")||s.includes("choose the best")||/choose.*letter\s*[A-D]/i.test(e)||/\n\s*[A-D]\s+[A-Z][a-z]+/.test(e))?"Multiple Choice":s.includes("heading")||s.includes("list of headings")?"Matching Headings":s.includes("which paragraph")||s.includes("paragraph contains")?"Matching Paragraph Information":s.includes("complete")&&s.includes("sentence")&&s.includes("ending")?"Matching Sentence Endings":s.includes("complete")&&s.includes("table")?"Table Completion":s.includes("complete")&&(s.includes("flow")||s.includes("chart"))?"Flow Chart Completion":s.includes("diagram")||s.includes("label")?"Diagram Completion":s.includes("choose")&&s.includes("title")?"Choose a Title":s.includes("complete")&&s.includes("sentence")?"Sentence Completion":"Short Answer"},H=()=>{const e=s(),{testId:H}=t(),{admin:U,loading:V}=a(),[Z,W]=n.useState(""),[J,X]=n.useState(!1),[K,ee]=n.useState(!0),[se,te]=n.useState(!1),[ae,ne]=n.useState(1),[re,ie]=n.useState("paste"),[oe,le]=n.useState(""),[ce,de]=n.useState(""),[me,ue]=n.useState([]),[xe,he]=n.useState({1:{passageNumber:1,title:"Passage 1",passageText:"",questions:[],sections:[],structureItems:[],extractionMetadata:null,questionRange:"1-13",imageFile:null,imageUrl:null},2:{passageNumber:2,title:"Passage 2",passageText:"",questions:[],sections:[],structureItems:[],extractionMetadata:null,questionRange:"14-26",imageFile:null,imageUrl:null},3:{passageNumber:3,title:"Passage 3",passageText:"",questions:[],sections:[],structureItems:[],extractionMetadata:null,questionRange:"27-40",imageFile:null,imageUrl:null}}),[pe,ge]=n.useState(null),[be,fe]=n.useState([]),[Ne,je]=n.useState(""),[ve,we]=n.useState(""),[qe,ye]=n.useState(null),[Te,ke]=n.useState(""),[_e,Ae]=n.useState(null),[Ce,Ee]=n.useState(""),[Se,Ie]=n.useState(""),Fe=()=>{ge(null),fe([]),je(""),we("")},$e=()=>{if(!Ne.trim()||!ve.trim())return void r.error("Please enter both letter and name");const e=Ne.trim().toUpperCase();if(!/^[A-Z]$/.test(e))return void r.error("Letter must be A-Z");if(be.some(s=>s.startsWith(e+" ")||s.startsWith(e+"  ")))return void r.error(`Option ${e} already exists`);const s=`${e}  ${ve.trim()}`,t=[...be,s].sort((e,s)=>e.charCodeAt(0)-s.charCodeAt(0));fe(t),je(""),we(""),r.success(`Added option ${e}`)},Re=()=>{ye(null),ke("")},Ge=()=>{Ae(null),Ee(""),Ie("")};n.useEffect(()=>{if(oe.trim()){const e=(e=>{let s=[];const t=[...e.matchAll(/Questions?\s+(\d+)(?:[-â€“â€”](\d+))?/gi)];if(0===t.length)return s;const a=new Set,n=t.filter(s=>{const t=s.index,n=parseInt(s[1]),r=`${n}-${s[2]?parseInt(s[2]):n}`;if(a.has(r))return!1;const i=e.substring(Math.max(0,t-5),t);if(/\(\s*$/.test(i))return!1;let o=t;for(;o>0&&"\n"!==e[o-1];)o--;return!(e.substring(o,t).trim().length>50||(a.add(r),0))});if(0===n.length)return s;for(let c=0;c<n.length;c++){const t=n[c],a=parseInt(t[1]),r=t[2]?parseInt(t[2]):a;let i=t.index;for(;i>0&&"\n"!==e[i-1];)i--;let o=e.length;for(let s=c+1;s<n.length;s++){let t=n[s].index;for(;t>0&&"\n"!==e[t-1];)t--;o=t;break}const l=e.substring(i,o),d=z(l),m=l.match(/Questions?\s+\d+[-â€“â€”]?\d*\s*([\s\S]*?)(?=\n\s*(?:[A-G]\s+\w|\d+\s+[A-Z]|\d+\.))/i),u=m?m[1].replace(/\s+/g," ").trim():"";let x="";const h=l.split(/\r?\n/),p=[];let g=!1;for(const e of h){const s=e.trim();if(s){if("Yes No Not Given"===d||"True False Not Given"===d){if(/^\s*(YES|TRUE|NO|FALSE)\s+if/i.test(s)||/^\s*(YES|NO|TRUE|FALSE|NOT GIVEN)\s*$/i.test(s)||/^\d+\s+[A-Z]/i.test(s))break}else if("Summary Completion"===d||"Short Answer"===d){if(g)break;if(/answer\s+sheet/i.test(s)){p.push(s),g=!0;continue}if(/\d+[â€¦.â€¦]+/.test(s))break}else{if(g)break;if(/answer\s+sheet/i.test(s)){p.push(s),g=!0;continue}if(/^[A-G]\s{1,4}[A-Z]/i.test(s)||/^\d+\s+[A-Z]/i.test(s))break;if(/^List\s+of\s+/i.test(s))break}p.push(s)}}x=p.join(" ").trim(),x=x.replace(/(Questions?\s+\d+[-â€“â€”]?\d*)\s+\1/gi,"$1"),x=x.replace(/^Questions?\s+\d+[-â€“â€”]?\d*\s*/i,"").trim(),console.log("ðŸ“ Question type detected:",d),console.log("ðŸ“ Extracted task instruction:",x);const b=[];if("Multiple Choice"!==d){const e=/\b(MORE THAN \w+ WORDS|NO MORE THAN|answer sheet|NB\s+You|may use any letter|Write the correct|correct letter.*boxes|following statements.*list)\b/i,s=l.split("\n");for(const n of s){const s=n.trim();if(!s||/^\d+\s/.test(s))continue;if(e.test(s))continue;const t=s.match(/^([A-G])\s+(.+)$/);if(t&&!b.some(e=>e.startsWith(t[1]+" "))){const s=t[1],a=t[2].trim();a.length>1&&!e.test(a)&&b.push(`${s}  ${a}`)}const a=s.match(/^([A-G])[.\)]\s*(.+)$/);if(a&&!b.some(e=>e.startsWith(a[1]+" "))){const s=a[2].trim();s.length>1&&!e.test(s)&&b.push(`${a[1]}  ${s}`)}}b.sort((e,s)=>e.charCodeAt(0)-s.charCodeAt(0));const t=/^\s*([ivxIVX]+)[.\)]\s*(.+)/gm;let a;for(;null!==(a=t.exec(l));){const e=a[1].toLowerCase();b.some(s=>s.toLowerCase().startsWith(e+"."))||b.push(`${e}. ${a[2].trim()}`)}}const f=[],N=l.split("\n"),j=[];let v="",w=0,q=!1;for(let e=0;e<N.length;e++){const s=N[e].trim();if(!s)continue;const t=s.match(/^(\d+)\s+(.+)/);if(t){const e=parseInt(t[1]);if(w>=a&&w<=r&&v){const e="True False Not Given"===d?["TRUE","FALSE","NOT GIVEN"]:"Yes No Not Given"===d?["YES","NO","NOT GIVEN"]:"Multiple Choice"===d&&j.length>0?[...j]:null;f.push({question_number:w,question_text:v.trim(),question_type:d,options:e,correct_answer:""}),j.length=0}e>=a&&e<=r?(w=e,v=t[2].trim(),q="Multiple Choice"===d):(w=0,v="")}else if(/^[A-D]\s+/.test(s)&&q)j.push(s);else if(w>0){const e=/^[A-Ga-g]\s+.+/.test(s)||/^[A-Ga-g][.\)]\s*.+/.test(s),t=/^Questions?\s/i.test(s),a=/^[ivxIVX]+[.\)]\s*.+/.test(s),n=/^[A-G]\s{2,}[a-z]/.test(s),r=/^List\s+of\s+/i.test(s),i=/\b(below|from the list|choose from)\b/i.test(s)&&s.length<50;e||t||a||n||r||i||(v+=" "+s)}}if(w>=a&&w<=r&&v){const e="True False Not Given"===d?["TRUE","FALSE","NOT GIVEN"]:"Yes No Not Given"===d?["YES","NO","NOT GIVEN"]:"Multiple Choice"===d&&j.length>0?[...j]:null;f.push({question_number:w,question_text:v.trim(),question_type:d,options:e,correct_answer:""})}if(0===f.length&&("Summary Completion"===d||"Short Answer"===d)){const e=l.replace(/Questions?\s+\d+[-â€“â€”]?\d*[^\n]*\n/,"").trim();let s=e;for(let t=a;t<=r;t++)s=s.replace(new RegExp(`\\b${t}[â€¦.â€¦]+`,"g"),`(${t})_____`);for(let t=a;t<=r;t++)f.push({question_number:t,question_text:`Blank ${t}`,question_type:d,options:null,correct_answer:""});s&&e.split("\n").slice(0,3).join(" ").trim()}let y="";if("Summary Completion"===d||"Short Answer"===d){const e=l.replace(/[\s\S]*?answer sheet\.?\s*/i,"").trim();if(e){y=e;for(let e=a;e<=r;e++)y=y.replace(new RegExp(`\\b${e}[â€¦.â€¦]+`,"g"),`(${e})_____`)}}if(f.length>0||a===r){if(0===f.length)for(let s=a;s<=r;s++)f.push({question_number:s,question_text:`Question ${s}`,question_type:d,options:"True False Not Given"===d?["TRUE","FALSE","NOT GIVEN"]:"Yes No Not Given"===d?["YES","NO","NOT GIVEN"]:null,correct_answer:""});let e=u;!y||"Summary Completion"!==d&&"Short Answer"!==d||(e=y),s.push({sectionTitle:a===r?`Question ${a}`:`Questions ${a}-${r}`,questionType:d,instructions:e,taskInstruction:x||void 0,questionRange:a===r?`${a}`:`${a}-${r}`,options:b.length>0?b:null,questions:f})}}const r=new Map,i=e=>{const s=e.split("-"),t=parseInt(s[0])||0;return{start:t,end:parseInt(s[1])||t}},o=(e,s)=>{const t=i(e),a=i(s);return t.start<=a.end&&a.start<=t.end},l=e=>{var s,t,a,n;return 10*((null==(s=e.options)?void 0:s.length)||0)+((null==(t=e.taskInstruction)?void 0:t.length)||0)+5*((null==(a=e.questions)?void 0:a.length)||0)+((null==(n=e.instructions)?void 0:n.length)||0)};for(const c of s){const e=c.questionRange;let s=!1;for(const[t,a]of r.entries())if(e===t||o(e,t)){s=!0;const n=l(a);l(c)>n&&(r.delete(t),r.set(e,c));break}s||r.set(e,c)}return Array.from(r.values()).sort((e,s)=>(parseInt(e.questionRange.split("-")[0])||0)-(parseInt(s.questionRange.split("-")[0])||0))})(oe);ue(e)}else ue([])},[oe]);const Me=e=>e>=1&&e<=13?1:e>=14&&e<=26?2:e>=27&&e<=40?3:1,Pe=()=>{const e=[];return[1,2,3].forEach(s=>{const t=xe[s];t.questions&&t.questions.length>0&&t.questions.forEach((t,a)=>{const n=t.question_number??((e,s)=>1===e?s+1:2===e?13+s+1:26+s+1)(s,a);e.push({question_number:n,correct_answer:t.correct_answer,passage:s})})}),e.sort((e,s)=>e.question_number-s.question_number)};n.useEffect(()=>{V||U||e("/admin/login")},[U,V,e]),n.useEffect(()=>{H&&Oe()},[H]);const Oe=async()=>{if(H)try{console.log("ðŸ“– Loading reading test data for testId:",H),ee(!0);const{data:e,error:s}=await P.from("tests").select("*").eq("id",H).maybeSingle();if(s)throw console.error("Error fetching test:",s),s;if(!e)return console.error("âŒ Test not found:",H),r.error("Test not found"),void ee(!1);console.log("âœ… Test loaded:",e.test_name),W(e.test_name);const{data:t,error:a}=await P.from("questions").select("*").eq("test_id",H).order("part_number",{ascending:!0}).order("question_number_in_part",{ascending:!0});if(a&&console.error("Error fetching questions:",a),console.log("ðŸ“Š Found",(null==t?void 0:t.length)||0,"questions for this test"),t&&t.length>0){const e={1:{...xe[1],questions:[],sections:[],title:xe[1].title},2:{...xe[2],questions:[],sections:[],title:xe[2].title},3:{...xe[3],questions:[],sections:[],title:xe[3].title}},s={1:[1,13],2:[14,26],3:[27,40]},a={1:0,2:0,3:0},n={1:null,2:null,3:null};t.forEach(t=>{let r=t.question_number_in_part??t.question_number??null,i=t.part_number??Me(r||0);const[o,l]=s[i]||[1,13];if(null!==r&&(r<o||r>l)&&(i=Me(r)),null===r){const[e]=s[i]||[1,13];r=e+a[i]}if(e[i]){!e[i].passageText&&t.passage_text&&(e[i].passageText=t.passage_text);let s=null;try{t.structure_data&&"string"==typeof t.structure_data?s=JSON.parse(t.structure_data):t.structure_data&&"object"==typeof t.structure_data&&(s=t.structure_data)}catch(c){console.warn("Failed to parse structure_data:",c)}(null==s?void 0:s.passageTitle)&&!e[i].title&&(e[i].title=s.passageTitle,console.log(`ðŸ“– Loaded passage ${i} title:`,s.passageTitle)),(null==s?void 0:s.sections)&&Array.isArray(s.sections)&&s.sections.length>0&&(n[i]||(n[i]=s.sections,console.log(`ðŸ“š Found saved sections for Passage ${i}:`,s.sections.length)));let o=null;t.choices&&("string"==typeof t.choices?o=t.choices.split(";").filter(e=>e.trim()):Array.isArray(t.choices)&&(o=t.choices)),!o&&(null==s?void 0:s.options)&&(o=s.options),e[i].questions.push({question_number:r,question_text:t.question_text,question_type:t.question_type||"Short Answer",options:o,correct_answer:t.correct_answer,explanation:t.explanation,structureData:s}),a[i]+=1}}),[1,2,3].forEach(s=>{const t=e[s].questions;if(n[s]&&n[s].length>0){const a=n[s].map(e=>{var s;const a=null==(s=e.questionRange)?void 0:s.match(/(\d+)(?:-(\d+))?/),n=a?parseInt(a[1]):0,r=a?parseInt(a[2]||a[1]):n,i=t.filter(e=>e.question_number>=n&&e.question_number<=r);return{sectionTitle:e.sectionTitle||`Questions ${e.questionRange}`,questionType:e.questionType||"Short Answer",instructions:e.instructions||"",taskInstruction:e.taskInstruction||"",questionRange:e.questionRange||"",options:e.options||null,questions:i.length>0?i:e.questions||[]}});e[s].sections=a,console.log(`âœ… Restored ${a.length} saved sections for Passage ${s}:`,a.map(e=>`${e.questionRange} (${e.questionType})`).join(", "))}else if(t.length>0){const a=new Map;t.forEach(e=>{var s,t,n,r;const i=(null==(s=e.structureData)?void 0:s.sectionRange)||e.question_type||"Short Answer";e.question_type;a.has(i)||a.set(i,{questions:[],options:e.options||(null==(t=e.structureData)?void 0:t.options)||null,structureData:e.structureData,taskInstruction:(null==(n=e.structureData)?void 0:n.taskInstruction)||""}),a.get(i).questions.push(e),e.options&&!a.get(i).options&&(a.get(i).options=e.options),(null==(r=e.structureData)?void 0:r.options)&&!a.get(i).options&&(a.get(i).options=e.structureData.options)});const n=[];a.forEach((e,s)=>{var t,a,r,i,o,l;e.questions.sort((e,s)=>(e.question_number||0)-(s.question_number||0));const c=(null==(t=e.questions[0])?void 0:t.question_number)||1,d=(null==(a=e.questions[e.questions.length-1])?void 0:a.question_number)||c,m=(null==(r=e.questions[0])?void 0:r.question_type)||"Short Answer";n.push({sectionTitle:(null==(i=e.structureData)?void 0:i.sectionTitle)||`Questions ${c}-${d}`,questionType:m,instructions:(null==(o=e.structureData)?void 0:o.instructions)||"",taskInstruction:e.taskInstruction||(null==(l=e.structureData)?void 0:l.taskInstruction)||"",questionRange:c===d?`${c}`:`${c}-${d}`,options:e.options,questions:e.questions})}),n.sort((e,s)=>{var t,a;return((null==(t=e.questions[0])?void 0:t.question_number)||0)-((null==(a=s.questions[0])?void 0:a.question_number)||0)}),e[s].sections=n,console.log(`ðŸ“š Reconstructed ${n.length} sections for Passage ${s}:`,n.map(e=>`${e.questionRange} (${e.questionType})`).join(", "))}}),he(e)}ee(!1)}catch(e){console.error("âŒ Error loading test data:",e),r.error("Failed to load test data"),ee(!1)}else ee(!1)},De=(e,s)=>{he(t=>({...t,[e]:{...t[e],...s}}))},Qe=async()=>{if(!H)return void r.error("Test ID is required");if(Pe().length>0||[1,2,3].some(e=>xe[e].passageText.trim())){X(!0);try{console.log("ðŸ’¾ Saving reading test...");const e="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN1dW14bWZ6aHdsanlsYmRsZmxqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM1MTkxMjEsImV4cCI6MjA2OTA5NTEyMX0.8jqO_ciOttSxSLZnKY0i5oJmEn79ROF53TjUMYhNemI",s=`${"https://cuumxmfzhwljylbdlflj.supabase.co"}/functions/v1/save-reading-test`,t=[],a={1:[1,13],2:[14,26],3:[27,40]};[1,2,3].forEach(e=>{const s=xe[e],[n,r]=a[e];s.sections&&s.sections.length>0?s.sections.forEach(a=>{a.questions.forEach((i,o)=>{const l=i.question_number||o+1;l>=n&&l<=r&&t.push({...i,part_number:e,passage_text:s.passageText,question_number_in_part:l,question_type:a.questionType||i.question_type||"Short Answer",choices:a.options||i.options||null,structure_data:{sectionTitle:a.sectionTitle,sectionRange:a.questionRange,instructions:a.instructions,taskInstruction:a.taskInstruction,options:a.options}})})}):s.questions.forEach((a,i)=>{const o=a.question_number||i+1;o>=n&&o<=r&&t.push({...a,part_number:e,passage_text:s.passageText,question_number_in_part:o,question_type:a.question_type||"Short Answer",choices:a.options||null})})}),console.log(`ðŸ“Š Saving ${t.length} questions (strict range validation applied)`);const n={testId:H,testData:{title:Z||"IELTS Reading Test",passages:[1,2,3].map(e=>({passageNumber:e,title:xe[e].title,passageText:xe[e].passageText,questionRange:xe[e].questionRange,structureItems:xe[e].structureItems,extractionMetadata:xe[e].extractionMetadata,sections:xe[e].sections||[]}))},questions:t};console.log("ðŸ“¦ Data being sent:",JSON.stringify(n,null,2));const i=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",apikey:e,Authorization:`Bearer ${e}`},body:JSON.stringify(n)}),o=await i.json();if(!i.ok)throw new Error(o.error||"Failed to save test");console.log("âœ… Test saved successfully!"),r.success("Reading test saved successfully!")}catch(e){console.error("Error saving test:",e),r.error(`Failed to save test: ${e.message}`)}finally{X(!1)}}else r.error("Please add at least one passage or questions")};return V||K?i.jsx(R,{title:"Loading Reading Test...",showBackButton:!0,backPath:"/admin/ielts/reading",children:i.jsx("div",{className:"flex items-center justify-center min-h-96",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),i.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading reading test data..."})]})})}):U?i.jsxs(R,{title:`IELTS Reading Test - ${Z||H}`,showBackButton:!0,backPath:"/admin/ielts/reading",children:[i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-3xl font-bold tracking-tight text-[#2f241f]",children:"IELTS Reading Test Management"}),i.jsx("p",{className:"text-[#5a4a3f] mt-1",children:"Create a complete reading test with 3 passages and 40 questions total"})]}),i.jsxs(o,{className:"bg-amber-100 text-amber-800 border-amber-200 text-sm",children:["Test ID: ",null==H?void 0:H.substring(0,8),"..."]})]}),i.jsxs(l,{className:"border-2 border-[#e0d6c7] bg-[#fdfaf3] shadow-sm",children:[i.jsx(c,{className:"bg-amber-50/50 border-b border-[#e0d6c7]",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs(d,{className:"flex items-center gap-2 text-[#2f241f]",children:[i.jsx(m,{className:"w-5 h-5 text-amber-600"}),"Reading Test - All Passages (1-3)"]}),i.jsx(o,{className:"bg-white border-amber-200 text-amber-700 text-xs",children:"Preview updates instantly â†“"})]})}),i.jsxs(u,{className:"space-y-6 bg-[#fdfaf3] pt-6",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-sm font-medium text-[#2f241f]",children:"Test Name *"}),i.jsx("p",{className:"text-xs text-[#5a4a3f] mb-2",children:'Give this test a descriptive name (e.g., "IELTS Reading Test 1 - Cambridge 18")'}),i.jsx(x,{placeholder:"IELTS Reading Test 1",value:Z,onChange:e=>W(e.target.value),className:"max-w-md bg-white border-[#e0d6c7] text-[#2f241f] focus:border-amber-400"})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("div",{className:"flex items-center justify-between",children:i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium text-[#2f241f]",children:"Passages & Questions"}),i.jsx("p",{className:"text-xs text-[#5a4a3f]",children:"Upload passages and use AI to extract questions from images"})]})}),i.jsx("div",{className:"flex gap-2 border-b border-[#e0d6c7] pb-2",children:[1,2,3].map(e=>{const s=xe[e],t=s.questions.length>0,a=s.passageText.trim().length>0;return i.jsxs(h,{variant:ae===e?"default":"outline",size:"sm",onClick:()=>ne(e),className:"relative "+(ae===e?"bg-amber-600 hover:bg-amber-700 text-white ring-2 ring-amber-300":"bg-white border-[#e0d6c7] text-[#2f241f] hover:bg-amber-50"),children:["Passage ",e,t&&i.jsx(p,{className:"w-3 h-3 ml-1 text-green-500"}),a&&!t&&i.jsx(g,{className:"w-3 h-3 ml-1 text-amber-400"}),i.jsxs("span",{className:"ml-1 text-xs "+(ae===e?"text-amber-100":"text-[#5a4a3f]"),children:["(",s.questionRange,")"]})]},e)})}),(()=>{const e=Pe(),s=e.filter(e=>e.correct_answer).length;return i.jsxs(l,{className:"border-2 border-green-300 bg-gradient-to-r from-green-50 to-emerald-50 shadow-md",children:[i.jsxs(c,{className:"pb-3 bg-green-100/50 border-b border-green-200",children:[i.jsxs(d,{className:"text-base flex items-center gap-2 text-green-800",children:[i.jsx(b,{className:"w-5 h-5"}),"Full Answer Key (Q1-Q40)",i.jsxs(o,{className:"ml-auto bg-green-600 text-white",children:[s,"/",40," Answered"]})]}),i.jsx("p",{className:"text-xs text-green-700",children:"All answers across all 3 passages displayed here"})]}),i.jsxs(u,{className:"pt-4",children:[i.jsx("div",{className:"grid gap-2 grid-cols-5 sm:grid-cols-8 md:grid-cols-10 lg:grid-cols-13",children:Array.from({length:40},(e,s)=>s+1).map(s=>{const t=e.find(e=>e.question_number===s),a=(null==t?void 0:t.correct_answer)||"";return i.jsxs("div",{className:"rounded-md border px-2 py-2 text-center "+(a?"border-green-400 bg-green-100":"border-gray-200 bg-gray-50"),children:[i.jsxs("div",{className:"text-[10px] font-medium text-gray-500 mb-1",children:["Q",s]}),i.jsx(o,{variant:"outline",className:"text-xs px-1.5 py-0 font-mono "+(a?"border-green-500 bg-green-600 text-white":"border-gray-300 bg-white text-gray-400"),children:a||"-"}),i.jsx(h,{variant:"ghost",size:"xs",className:"mt-1 h-6 text-[10px] px-1 text-green-700 hover:bg-green-100",onClick:()=>{const e=window.prompt(`Set answer for Q${s}`,a||"");null!==e&&((e,s)=>{if(!s.trim())return void r.error("Answer cannot be empty");const t=Me(e);he(a=>{const n={1:{...a[1]},2:{...a[2]},3:{...a[3]}},i=n[t];if(!i)return a;const o=(i.questions||[]).map(t=>t.question_number===e?{...t,correct_answer:s.trim()}:t),l=(i.sections||[]).map(t=>({...t,questions:t.questions.map(t=>t.question_number===e?{...t,correct_answer:s.trim()}:t)}));return n[t]={...i,questions:o,sections:l},r.success(`Saved answer for Q${e}`),n})})(s,e)},children:a?"Edit":"Add"})]},s)})}),i.jsxs("div",{className:"mt-4 pt-3 border-t border-green-200 flex items-center justify-center gap-4 text-xs",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(o,{variant:"outline",className:"bg-amber-100 border-amber-300 text-amber-700",children:"P1"}),i.jsx("span",{className:"text-gray-600",children:"Q1-13"})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(o,{variant:"outline",className:"bg-orange-100 border-orange-300 text-orange-700",children:"P2"}),i.jsx("span",{className:"text-gray-600",children:"Q14-26"})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(o,{variant:"outline",className:"bg-yellow-100 border-yellow-300 text-yellow-700",children:"P3"}),i.jsx("span",{className:"text-gray-600",children:"Q27-40"})]})]})]})]})})(),i.jsxs("div",{className:"border-2 border-[#e0d6c7] rounded-lg p-4 bg-white",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("div",{children:[i.jsxs("h4",{className:"font-semibold text-lg text-[#2f241f]",children:["Passage ",ae]}),i.jsxs("p",{className:"text-sm text-[#5a4a3f]",children:["Questions ",xe[ae].questionRange," â€¢ ",xe[ae].questions.length," questions extracted"]})]}),xe[ae].questions.length>0&&i.jsxs(o,{className:"bg-amber-100 text-amber-800 border-amber-200",children:[i.jsx(p,{className:"w-3 h-3 mr-1"}),xe[ae].questions.length," Questions"]})]}),i.jsxs("div",{className:"space-y-2 mb-4",children:[i.jsx("label",{className:"text-sm font-medium text-[#2f241f]",children:"Passage Title"}),i.jsxs("div",{className:"flex gap-2 items-center",children:[i.jsx(x,{placeholder:`Passage ${ae} Title (e.g., "The History of Coffee")`,value:xe[ae].title,onChange:e=>De(ae,{title:e.target.value}),className:"max-w-lg bg-white border-[#e0d6c7] text-[#2f241f] focus:border-amber-400"}),i.jsxs(h,{onClick:Qe,disabled:J,size:"sm",className:"bg-amber-600 hover:bg-amber-700 text-white",children:[i.jsx(O,{className:"w-4 h-4 mr-1"}),J?"Saving...":"Save"]})]}),i.jsx("p",{className:"text-xs text-[#5a4a3f]",children:"ðŸ’¡ Click Save to persist the passage title to the database"})]}),i.jsxs("div",{className:"space-y-2 mb-6",children:[i.jsxs("label",{className:"text-sm font-medium text-[#2f241f]",children:[i.jsx(f,{className:"w-4 h-4 inline mr-1 text-amber-600"}),"Passage Text *"]}),i.jsx("p",{className:"text-xs text-[#5a4a3f]",children:"Paste the full reading passage text here. This will be shown to students during the test."}),i.jsx(N,{placeholder:"Paste the complete reading passage text here...",value:xe[ae].passageText,onChange:e=>De(ae,{passageText:e.target.value}),rows:12,className:"font-serif text-sm leading-relaxed bg-white border-[#e0d6c7] text-[#2f241f]"}),xe[ae].passageText&&i.jsxs("div",{className:"flex items-center justify-between p-2 bg-amber-50 rounded-lg border border-amber-200",children:[i.jsxs("p",{className:"text-xs text-amber-800 flex items-center gap-2",children:[i.jsx(p,{className:"w-3 h-3"}),xe[ae].passageText.split(" ").length," words"]}),i.jsx(h,{onClick:Qe,disabled:J,size:"sm",className:"bg-amber-600 hover:bg-amber-700 text-white",children:J?i.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}):i.jsxs(i.Fragment,{children:[i.jsx(O,{className:"w-3 h-3 mr-1"}),"Save Passage"]})})]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(j,{className:"w-4 h-4 text-amber-500"}),i.jsx("label",{className:"text-sm font-medium text-[#2f241f]",children:"Add Questions"})]}),i.jsxs(o,{className:"bg-amber-100 text-amber-800 border-amber-200 text-xs",children:[Y.length," question types supported"]})]}),i.jsxs(S,{value:re,onValueChange:e=>ie(e),children:[i.jsxs(I,{className:"grid w-full grid-cols-3 bg-[#fdfaf3] border border-[#e0d6c7]",children:[i.jsxs(F,{value:"paste",className:"gap-2 data-[state=active]:bg-amber-600 data-[state=active]:text-white",children:[i.jsx(B,{className:"w-4 h-4"}),"Copy & Paste"]}),i.jsxs(F,{value:"image",className:"gap-2 data-[state=active]:bg-amber-600 data-[state=active]:text-white",children:[i.jsx(D,{className:"w-4 h-4"}),"Image Upload"]}),i.jsxs(F,{value:"answers",className:"gap-2 data-[state=active]:bg-amber-600 data-[state=active]:text-white",children:[i.jsx(f,{className:"w-4 h-4"}),"Paste Answers"]})]}),i.jsx($,{value:"paste",className:"mt-4 space-y-4",children:i.jsxs(l,{className:"border-2 border-[#e0d6c7] bg-white",children:[i.jsxs(c,{className:"pb-3 bg-amber-50/50 border-b border-[#e0d6c7]",children:[i.jsxs(d,{className:"text-base flex items-center gap-2 text-[#2f241f]",children:[i.jsx(B,{className:"w-4 h-4 text-amber-600"}),"Paste All Questions (Auto-Detect)"]}),i.jsx("p",{className:"text-xs text-[#5a4a3f]",children:"Just paste everything! System auto-detects question types, ranges, and options."})]}),i.jsxs(u,{className:"space-y-4 pt-4 bg-[#fdfaf3]",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-1 block text-[#2f241f]",children:"Paste Questions (including headers)"}),i.jsx(N,{placeholder:"Paste entire question section here...",value:oe,onChange:e=>le(e.target.value),rows:14,className:"font-mono text-sm bg-white border-[#e0d6c7] text-[#2f241f]"})]}),me.length>0&&i.jsxs("div",{className:"p-3 bg-amber-50 rounded-lg border-2 border-amber-300",children:[i.jsxs("p",{className:"text-sm font-medium text-amber-800 mb-2 flex items-center gap-2",children:[i.jsx(p,{className:"w-4 h-4"}),"Auto-Detected ",me.length," Section",me.length>1?"s":"",":"]}),i.jsx("div",{className:"space-y-2",children:me.map((e,s)=>{var t;const a=(null==(t=e.questions[0])?void 0:t.question_number)||parseInt(e.questionRange.split("-")[0]),n=Me(a);return i.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded border border-[#e0d6c7]",children:[i.jsxs(o,{className:1===n?"bg-amber-600":2===n?"bg-orange-600":"bg-yellow-600",children:["P",n]}),i.jsx(o,{variant:"outline",className:"border-amber-200",children:e.questionRange}),i.jsx(o,{variant:"secondary",className:"bg-amber-100 text-amber-800",children:e.questionType}),i.jsxs("span",{className:"text-xs text-[#5a4a3f]",children:["(",e.questions.length," questions)"]}),e.options&&e.options.length>0&&i.jsxs("span",{className:"text-xs text-amber-600",children:["+",e.options.length," options"]})]},s)})}),i.jsx("p",{className:"text-xs text-[#5a4a3f] mt-2",children:"ðŸ“ Questions auto-assigned: 1-13 â†’ P1, 14-26 â†’ P2, 27-40 â†’ P3"})]}),oe&&0===me.length&&i.jsx("div",{className:"p-2 bg-red-50 rounded-lg border border-red-200",children:i.jsxs("p",{className:"text-xs text-red-800 flex items-center gap-2",children:[i.jsx(Q,{className:"w-3 h-3"}),'No sections detected. Make sure text includes "Questions X-Y" headers.']})}),i.jsxs(h,{onClick:()=>{if(0===me.length)return void r.error('No sections detected. Make sure your text contains "Questions X-Y" headers.');const e={1:[],2:[],3:[]};me.forEach(s=>{var t;const a=(null==(t=s.questions[0])?void 0:t.question_number)||parseInt(s.questionRange.split("-")[0]),n=Me(a);e[n].push(s)});let s=0,t=0;const a=[],n={};[1,2,3].forEach(r=>{const i=e[r];if(i.length>0){const e=xe[r],o=e.sections||[],l=e.questions||[],c=new Set;i.forEach(e=>{e.questions.forEach(e=>{e.question_number&&c.add(e.question_number)})});const d=o.filter(e=>!e.questions.some(e=>e.question_number&&c.has(e.question_number))),m=l.filter(e=>!e.question_number||!c.has(e.question_number)),u=[...d,...i],x=i.flatMap(e=>e.questions),h=[...m,...x];u.sort((e,s)=>{var t,a;return((null==(t=e.questions[0])?void 0:t.question_number)||parseInt(e.questionRange.split("-")[0])||0)-((null==(a=s.questions[0])?void 0:a.question_number)||parseInt(s.questionRange.split("-")[0])||0)}),h.sort((e,s)=>(e.question_number||0)-(s.question_number||0)),n[r]={sections:u,questions:h},s+=x.length,t+=m.length,a.push(`P${r}: +${x.length} (total: ${h.length})`),console.log(`ðŸ“ Passage ${r}: Added ${x.length} new, preserved ${m.length} existing`),console.log(`   Sections: ${u.length} total (${d.length} preserved + ${i.length} new)`)}}),Object.keys(n).length>0&&he(e=>{const s={...e};return Object.entries(n).forEach(([e,t])=>{const a=parseInt(e);s[a]={...s[a],sections:t.sections,questions:t.questions}}),console.log("ðŸ“Š Updated passagesData:",{P1:{sections:s[1].sections.length,questions:s[1].questions.length},P2:{sections:s[2].sections.length,questions:s[2].questions.length},P3:{sections:s[3].sections.length,questions:s[3].questions.length}}),s}),console.log(`âœ… Applied ${me.length} sections with ${s} new questions (${t} preserved)`),r.success(`Added ${s} questions!`,{description:t>0?`${a.join(" | ")} â€¢ ${t} existing preserved`:a.join(" | ")}),le(""),ue([])},disabled:0===me.length,className:"w-full bg-amber-600 hover:bg-amber-700 text-white",size:"lg",children:[i.jsx(v,{className:"w-4 h-4 mr-2"}),"Add ",me.length," Section",1!==me.length?"s":""," to Passage ",ae]}),i.jsxs("div",{className:"border-t border-[#e0d6c7] pt-3 mt-3",children:[i.jsx("p",{className:"text-xs font-medium text-[#5a4a3f] mb-2",children:"âœ¨ Auto-Detection Works For:"}),i.jsxs("div",{className:"flex flex-wrap gap-1",children:[i.jsx(o,{variant:"outline",className:"text-xs border-amber-200 text-[#5a4a3f]",children:"True/False/Not Given"}),i.jsx(o,{variant:"outline",className:"text-xs border-amber-200 text-[#5a4a3f]",children:"Yes/No/Not Given"}),i.jsx(o,{variant:"outline",className:"text-xs border-amber-200 text-[#5a4a3f]",children:"Matching Features"}),i.jsx(o,{variant:"outline",className:"text-xs border-amber-200 text-[#5a4a3f]",children:"Matching Headings"}),i.jsx(o,{variant:"outline",className:"text-xs border-amber-200 text-[#5a4a3f]",children:"Multiple Choice"}),i.jsx(o,{variant:"outline",className:"text-xs border-amber-200 text-[#5a4a3f]",children:"Summary Completion"}),i.jsx(o,{variant:"outline",className:"text-xs border-amber-200 text-[#5a4a3f]",children:"+8 more"})]})]})]})]})}),i.jsx($,{value:"image",className:"mt-4",children:i.jsx(G,{testId:H||"",testType:"IELTS-Reading",initialImageFile:xe[ae].imageFile,onImageSelected:e=>De(ae,{imageFile:e}),onQuestionsExtracted:(e,s)=>{console.log(`âœ¨ Passage ${ae}: AI extracted ${e.length} questions`),De(ae,{questions:e,structureItems:(null==s?void 0:s.structureItems)||[],extractionMetadata:s||null});const t=(null==s?void 0:s.questionType)?` (${s.questionType})`:"";r.success(`Passage ${ae}: ${e.length} questions extracted!${t}`)}})}),i.jsx($,{value:"answers",className:"mt-4 space-y-4",children:i.jsxs(l,{className:"border-2 border-[#e0d6c7] bg-white",children:[i.jsxs(c,{className:"pb-3 bg-amber-50/50 border-b border-[#e0d6c7]",children:[i.jsxs(d,{className:"text-base flex items-center gap-2 text-[#2f241f]",children:[i.jsx(f,{className:"w-4 h-4 text-amber-600"}),"Paste Answer Key"]}),i.jsx("p",{className:"text-xs text-[#5a4a3f]",children:'Paste all answers at once. Format: "1. A" or "1 TRUE" (one answer per line)'})]}),i.jsxs(u,{className:"space-y-4 pt-4 bg-[#fdfaf3]",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-1 block text-[#2f241f]",children:"Paste Answer Key"}),i.jsx(N,{placeholder:"1. E\n2. D\n3. C\n4. A\n5. F\n...\n9. NO\n10. YES\n11. NOT GIVEN",value:ce,onChange:e=>de(e.target.value),rows:14,className:"font-mono text-sm bg-white border-[#e0d6c7] text-[#2f241f]"})]}),ce.trim()&&i.jsxs("div",{className:"p-3 bg-amber-50 rounded-lg border-2 border-amber-300",children:[i.jsxs("p",{className:"text-sm font-medium text-amber-800 mb-2 flex items-center gap-2",children:[i.jsx(p,{className:"w-4 h-4"}),"Detected Answers:"]}),i.jsx("div",{className:"flex flex-wrap gap-1 max-h-32 overflow-y-auto",children:ce.split("\n").filter(e=>e.trim()).map((e,s)=>{const t=e.trim().match(/^(\d+)[\.\s]+\s*(.+)$/);return t?i.jsxs(o,{variant:"outline",className:"font-mono text-xs border-amber-200",children:["Q",t[1],": ",t[2].trim()]},s):null})})]}),i.jsxs(h,{onClick:()=>{if(!ce.trim())return;const e=ce.split("\n"),s=new Map;e.forEach(e=>{const t=e.trim();if(!t)return;const a=t.match(/^(\d+)[\.\s]+\s*(.+)$/);if(a){const e=parseInt(a[1]),t=a[2].trim();t&&s.set(e,t)}}),0!==s.size?he(e=>{let t=0;const a={1:{...e[1]},2:{...e[2]},3:{...e[3]}};return[1,2,3].forEach(e=>{const n=a[e];n.questions&&0!==n.questions.length&&(a[e]={...n,questions:n.questions.map(e=>e.question_number&&s.has(e.question_number)?(t++,{...e,correct_answer:s.get(e.question_number)}):e),sections:n.sections?n.sections.map(e=>({...e,questions:e.questions.map(e=>e.question_number&&s.has(e.question_number)?{...e,correct_answer:s.get(e.question_number)}:e)})):[]})}),t>0?(r.success(`Updated ${t} answers successfully!`),de("")):r.warning("No matching question numbers found to update. Add questions first."),a}):r.error('No valid answers found. Use format: "1. Answer" or "1 Answer"')},disabled:!ce.trim(),className:"w-full bg-amber-600 hover:bg-amber-700 text-white",size:"lg",children:[i.jsx(O,{className:"w-4 h-4 mr-2"}),"Save Answers to Questions"]}),i.jsxs("div",{className:"border-t border-[#e0d6c7] pt-3 mt-3",children:[i.jsx("p",{className:"text-xs font-medium text-[#5a4a3f] mb-2",children:"ðŸ“‹ Supported Formats:"}),i.jsxs("div",{className:"text-xs text-[#5a4a3f] space-y-1",children:[i.jsxs("p",{children:["â€¢ ",i.jsx("code",{className:"bg-white px-1 rounded",children:"1. E"})," - Letter answers"]}),i.jsxs("p",{children:["â€¢ ",i.jsx("code",{className:"bg-white px-1 rounded",children:"9. YES"})," - Yes/No/Not Given"]}),i.jsxs("p",{children:["â€¢ ",i.jsx("code",{className:"bg-white px-1 rounded",children:"10. TRUE"})," - True/False/Not Given"]}),i.jsxs("p",{children:["â€¢ ",i.jsx("code",{className:"bg-white px-1 rounded",children:"14. NOT GIVEN"})," - Not Given answers"]})]})]})]})]})})]})]}),0===xe[ae].questions.length&&i.jsx("div",{className:"mt-4 p-4 border-2 border-dashed border-[#e0d6c7] rounded-lg bg-[#fdfaf3]",children:i.jsxs("p",{className:"text-center text-[#5a4a3f] text-sm",children:["ðŸ“‹ Use ",i.jsx("strong",{children:"Copy & Paste"})," to paste question text, or ",i.jsx("strong",{children:"Image Upload"})," to extract from screenshots"]})}),(xe[ae].questions.length>0||xe[ae].sections.length>0)&&i.jsxs("div",{className:"mt-6 space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsxs("h5",{className:"font-medium text-[#2f241f]",children:["Extracted Questions (",xe[ae].questions.length,")"]}),xe[ae].sections.length>0&&i.jsxs("p",{className:"text-xs text-[#5a4a3f]",children:[xe[ae].sections.length," question section(s) detected"]})]}),i.jsxs(h,{variant:"outline",size:"sm",onClick:()=>De(ae,{questions:[],sections:[]}),className:"text-red-600 hover:bg-red-50 border-red-200",children:[i.jsx(L,{className:"w-3 h-3 mr-1"}),"Clear All"]})]}),xe[ae].questions.length>0&&i.jsxs(l,{className:"border-2 border-green-200 bg-green-50/30",children:[i.jsx(c,{className:"pb-2 bg-green-50/50 border-b border-green-200",children:i.jsxs(d,{className:"text-sm flex items-center gap-2 text-green-800",children:[i.jsx(b,{className:"w-4 h-4"}),"Answer Key Overview",i.jsxs(o,{variant:"outline",className:"ml-auto border-green-300 text-green-700 bg-white",children:[xe[ae].questions.filter(e=>e.correct_answer).length,"/",xe[ae].questions.length," answered"]})]})}),i.jsx(u,{className:"pt-3",children:i.jsx("div",{className:"grid gap-2 grid-cols-4 sm:grid-cols-5 md:grid-cols-6 lg:grid-cols-8",children:xe[ae].questions.map((e,s)=>i.jsx("div",{className:"rounded-md border px-2 py-2 text-sm "+(e.correct_answer?"border-green-300 bg-green-100 text-green-800":"border-amber-300 bg-amber-50 text-amber-700"),children:i.jsxs("div",{className:"flex items-center justify-between gap-1",children:[i.jsxs("span",{className:"font-semibold text-xs",children:["Q",e.question_number]}),i.jsx(o,{variant:"outline",className:"text-[10px] px-1 py-0 "+(e.correct_answer?"border-green-400 bg-green-600 text-white":"border-amber-300 bg-white text-amber-600"),children:e.correct_answer||"?"})]})},e.question_number||s))})})]}),xe[ae].sections.length>0?i.jsx("div",{className:"space-y-4 max-h-[500px] overflow-y-auto pr-2",children:xe[ae].sections.map((e,s)=>{var t,a;return i.jsxs(l,{className:"border-2 border-[#e0d6c7]",children:[i.jsxs(c,{className:"pb-2 bg-amber-50/50",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs(d,{className:"text-sm flex items-center gap-2 text-[#2f241f]",children:[i.jsx(o,{className:"bg-amber-600",children:e.questionRange}),i.jsx("span",{children:e.questionType})]}),i.jsxs(o,{variant:"outline",className:"border-amber-200 text-amber-800",children:[e.questions.length," questions"]})]}),e.instructions&&("Summary Completion"===e.questionType||"Short Answer"===e.questionType)&&i.jsx("div",{className:"mt-2 p-2 bg-[#fdfaf3] rounded border border-[#e0d6c7]",children:i.jsx("p",{className:"text-xs text-[#2f241f] leading-relaxed",children:((null==(t=e.instructions)?void 0:t.length)||0)>200?e.instructions.substring(0,200)+"...":e.instructions})}),e.instructions&&!e.taskInstruction&&"Summary Completion"!==e.questionType&&"Short Answer"!==e.questionType&&"Yes No Not Given"!==e.questionType&&"True False Not Given"!==e.questionType&&!/\b(yes|no|true|false)\b.*not given/i.test(e.instructions)&&i.jsx("p",{className:"text-xs text-[#5a4a3f] mt-1 italic",children:e.instructions})]}),i.jsxs(u,{className:"pt-3 space-y-2 bg-[#fdfaf3]",children:[i.jsxs("div",{className:"p-2 bg-white rounded border border-[#e0d6c7] mb-3",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("p",{className:"text-xs font-medium text-[#2f241f]",children:"Task Instruction:"}),i.jsxs(h,{variant:"ghost",size:"sm",onClick:()=>(e=>{var s,t;const a=null==(t=null==(s=xe[ae])?void 0:s.sections)?void 0:t[e];a&&(ke(a.taskInstruction||""),ye(e))})(s),className:"h-6 px-2 text-xs text-amber-700 hover:text-amber-900 hover:bg-amber-100",children:[i.jsx(M,{className:"w-3 h-3 mr-1"}),"Edit Instruction"]})]}),i.jsx("p",{className:"text-xs text-[#5a4a3f] italic",children:e.taskInstruction||i.jsx("span",{className:"text-amber-500",children:"No instruction set - click Edit to add"})})]}),"Multiple Choice"!==e.questionType&&i.jsxs("div",{className:"p-2 bg-white rounded border border-[#e0d6c7] mb-3",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsxs("p",{className:"text-xs font-medium text-[#2f241f]",children:["Options (",(null==(a=e.options)?void 0:a.length)||0,"):"]}),i.jsxs(h,{variant:"ghost",size:"sm",onClick:()=>(e=>{const s=xe[ae].sections[e];fe(s.options||[]),ge(e),je(""),we("")})(s),className:"h-6 px-2 text-xs text-amber-700 hover:text-amber-900 hover:bg-amber-100",children:[i.jsx(w,{className:"w-3 h-3 mr-1"}),e.options&&e.options.length>0?"Edit Options":"Add Options"]})]}),e.options&&e.options.length>0?i.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:e.options.map((e,s)=>i.jsx("div",{className:"text-xs text-[#5a4a3f] bg-white/50 px-2 py-1 rounded border border-[#e0d6c7] break-words",children:e},s))}):i.jsx("p",{className:"text-xs text-[#5a4a3f] italic",children:'No options set. Click "Add Options" to add matching options (A-G with names).'})]}),e.questions.map((t,a)=>i.jsxs("div",{className:"p-3 rounded-lg bg-[#FDFBF7] border border-[#D3C4A5] shadow-sm hover:shadow-md transition-shadow group",children:[i.jsxs("div",{className:"flex flex-row items-baseline gap-3",children:[i.jsx("div",{className:"flex-shrink-0 text-base font-semibold text-black min-w-[1.5rem] leading-relaxed",children:t.question_number}),i.jsxs("div",{className:"flex-1 text-sm text-foreground",children:[i.jsx("span",{className:"font-serif text-base text-black leading-relaxed block mb-2",children:t.question_text}),t.correct_answer&&i.jsx("div",{className:"mt-1 flex items-center gap-2",children:i.jsxs(o,{variant:"outline",className:"text-xs bg-[#FAF9F6] text-[#8B4513] border-[#D3C4A5] font-serif",children:["Answer: ",t.correct_answer]})})]}),i.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[i.jsx(h,{variant:"ghost",size:"sm",onClick:()=>((e,s)=>{var t,a,n,r;const i=null==(r=null==(n=null==(a=null==(t=xe[ae])?void 0:t.sections)?void 0:a[e])?void 0:n.questions)?void 0:r[s];i&&(Ee(i.question_text||""),Ie(i.correct_answer||""),Ae({sectionIdx:e,questionIdx:s}))})(s,a),className:"h-7 w-7 p-0 text-[#8B4513]/70 hover:text-[#8B4513] hover:bg-[#8B4513]/10",children:i.jsx(M,{className:"w-3.5 h-3.5"})}),i.jsx(h,{variant:"ghost",size:"sm",onClick:()=>((e,s)=>{var t,a;if(!(null==(t=xe[ae])?void 0:t.sections))return;const n=xe[ae].sections[e];if(!(null==(a=null==n?void 0:n.questions)?void 0:a[s]))return;const i=n.questions[s].question_number;if(!window.confirm(`Are you sure you want to delete Question ${i}?`))return;let o=xe[ae].sections.map((t,a)=>{var n,r;if(a===e){const e=t.questions.filter((e,t)=>t!==s).map(e=>({...e}));if(0===e.length)return null;const a=null==(n=e[0])?void 0:n.question_number,i=null==(r=e[e.length-1])?void 0:r.question_number;return{...t,questions:e,questionRange:a===i?`${a}`:`${a}-${i}`,sectionTitle:a===i?`Question ${a}`:`Questions ${a}-${i}`}}return{...t,questions:t.questions.map(e=>({...e}))}}).filter(e=>null!==e);o.length<xe[ae].sections.length?r.success(`Question ${i} deleted. Section removed (no questions left).`):r.success(`Question ${i} deleted`);const l=o.flatMap(e=>e.questions);De(ae,{sections:o,questions:l})})(s,a),className:"h-7 w-7 p-0 text-[#8B4513]/70 hover:text-destructive hover:bg-destructive/10",children:i.jsx(L,{className:"w-3.5 h-3.5"})})]})]}),"Multiple Choice"===e.questionType&&t.options&&t.options.length>0&&i.jsx("div",{className:"mt-3 ml-9 grid gap-1",children:t.options.map((e,s)=>i.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-2",children:[i.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-gray-200"}),e]},s))})]},a))]})]},`section-${e.questionRange}-${s}`)})}):i.jsx("div",{className:"space-y-3 max-h-[400px] overflow-y-auto pr-2 custom-scrollbar",children:xe[ae].questions.map((e,s)=>i.jsx("div",{className:"bg-[#FDFBF7] border border-[#D3C4A5] rounded-lg p-3 shadow-sm hover:shadow-md transition-all",children:i.jsxs("div",{className:"flex flex-row items-baseline gap-3",children:[i.jsx("span",{className:"flex-shrink-0 font-bold text-black text-base min-w-[1.5rem]",children:e.question_number||s+1}),i.jsxs("div",{className:"flex-1 space-y-2",children:[i.jsx("p",{className:"text-base font-serif text-black leading-relaxed",children:e.question_text}),e.options&&e.options.length>0&&i.jsxs("div",{className:"text-xs text-[#5c4b37] bg-[#FAF9F6] p-2 rounded border border-[#E8D5A3]",children:[i.jsx("span",{className:"font-semibold mr-1",children:"Options:"}),e.options.join(" | ")]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs pt-1",children:[i.jsx(o,{variant:"secondary",className:"text-[10px] px-2 h-5 bg-white/50 text-[#8B4513] border-[#D3C4A5]",children:e.question_type}),e.correct_answer&&i.jsxs("span",{className:"text-[#8B4513] font-medium flex items-center gap-1 bg-[#FAF9F6] px-2 py-0.5 rounded-full border border-[#D3C4A5]",children:[i.jsx(b,{className:"w-3 h-3"}),e.correct_answer]})]})]})]})},s))}),i.jsxs("div",{className:"mt-4 pt-4 border-t border-[#e0d6c7]",children:[i.jsx(h,{onClick:Qe,disabled:J,className:"w-full bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-700 hover:to-orange-700 text-white font-semibold py-3",size:"lg",children:J?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):i.jsxs(i.Fragment,{children:[i.jsx(O,{className:"w-5 h-5 mr-2"}),"Save Passage ",ae," Questions"]})}),i.jsx("p",{className:"text-xs text-center text-[#5a4a3f] mt-2",children:"ðŸ’¡ Save after adding questions to each passage"})]})]})]}),i.jsx("div",{className:"grid grid-cols-3 gap-2 mt-4",children:[1,2,3].map(e=>{const s=xe[e],t=s.passageText.trim().length>0,a=s.questions.length>0?"complete":t?"passage-ready":"empty";return i.jsxs("div",{className:`p-3 rounded-lg border text-center cursor-pointer transition-all ${"complete"===a?"bg-amber-100 border-amber-300":"passage-ready"===a?"bg-orange-50 border-orange-200":"bg-gray-50 border-gray-200"} ${ae===e?"ring-2 ring-amber-500":""}`,onClick:()=>ne(e),children:[i.jsxs("div",{className:"font-semibold text-sm "+("complete"===a?"text-amber-900":"text-[#2f241f]"),children:["Passage ",e]}),i.jsx("div",{className:"text-xs text-[#5a4a3f]",children:s.questionRange}),i.jsx("div",{className:"text-xs mt-1 font-medium "+("complete"===a?"text-amber-700":"passage-ready"===a?"text-orange-600":"text-gray-400"),children:"complete"===a?`${s.questions.length} Questions`:"passage-ready"===a?"Passage Added":"Empty"})]},e)})}),(xe[ae].passageText||xe[ae].questions.length>0)&&i.jsxs("div",{className:"mt-6 border-t border-[#e0d6c7] pt-6",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[i.jsx(q,{className:"w-5 h-5 text-amber-600"}),i.jsxs("h4",{className:"font-semibold text-[#2f241f]",children:["Student View Preview - Passage ",ae]}),i.jsx(o,{variant:"outline",className:"bg-amber-50 border-amber-200 text-amber-800",children:"Exactly as students will see"})]}),i.jsxs("div",{className:"border-4 border-[#e0d6c7] rounded-xl overflow-hidden shadow-lg bg-white",children:[i.jsx("div",{className:"bg-[#2f241f] text-white p-4",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("div",{children:i.jsx("h3",{className:"font-bold text-lg text-[#fdfaf3]",children:"ENGLISH AIDOL IELTS READING"})}),i.jsxs("div",{className:"text-right",children:[i.jsxs("div",{className:"text-2xl font-bold text-[#fdfaf3]",children:["Passage ",ae]}),i.jsxs("div",{className:"text-amber-200 text-sm",children:["Questions ",xe[ae].questionRange]})]})]})}),i.jsxs("div",{className:"grid grid-cols-2 divide-x divide-[#e0d6c7]",children:[i.jsxs("div",{className:"bg-[#fdfaf3] p-6 max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-[#D3C4A5] scrollbar-track-transparent hover:scrollbar-thumb-[#8B4513]/50",children:[i.jsx("h4",{className:"font-bold text-xl mb-4 text-[#2f241f] border-b border-[#e0d6c7] pb-2 font-serif",children:xe[ae].title||`Reading Passage ${ae}`}),i.jsx("div",{className:"prose prose-sm max-w-none",children:xe[ae].passageText?xe[ae].passageText.split("\n").filter(e=>e.trim()).map((e,s)=>i.jsx("p",{className:"mb-4 text-justify leading-relaxed text-[#2f241f] indent-8 first:indent-0 font-serif",children:e},s)):i.jsx("p",{className:"text-[#5a4a3f] italic",children:"No passage text added yet"})})]}),i.jsxs("div",{className:"bg-[#fdfaf3] p-6 max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-[#D3C4A5] scrollbar-track-transparent hover:scrollbar-thumb-[#8B4513]/50",children:[i.jsxs("h4",{className:"font-bold text-lg mb-4 text-black",children:["Questions ",xe[ae].questionRange]}),xe[ae].sections.length>0?i.jsx("div",{className:"space-y-6",children:xe[ae].sections.map((e,s)=>{var t,a;return i.jsxs("div",{className:"pl-0",children:[i.jsxs("div",{className:"mb-3",children:[i.jsxs("h5",{className:"font-bold text-base text-[#2f241f]",children:["Questions ",e.questionRange]}),i.jsxs("div",{className:"mt-2 group relative",children:[i.jsx(N,{value:e.taskInstruction||"",onChange:e=>{((e,s)=>{var t;if(!(null==(t=xe[ae])?void 0:t.sections))return;const a=xe[ae].sections.map((t,a)=>a===e?{...t,taskInstruction:s||void 0,questions:t.questions.map(e=>({...e}))}:{...t,questions:t.questions.map(e=>({...e}))}),n=a.flatMap(e=>e.questions);De(ae,{sections:a,questions:n})})(s,e.target.value),e.target.style.height="auto",e.target.style.height=e.target.scrollHeight+"px"},onFocus:e=>{e.target.style.height="auto",e.target.style.height=e.target.scrollHeight+"px"},placeholder:"Click to add task instruction (e.g., Choose NO MORE THAN TWO WORDS...)",className:"text-sm text-[#5a4a3f] italic bg-transparent border-none focus:ring-1 focus:ring-amber-300 focus:bg-white/50 px-1 py-1 w-full resize-none overflow-hidden",style:{boxShadow:"none",minHeight:"32px",height:"auto"},ref:s=>{s&&e.taskInstruction&&(s.style.height="auto",s.style.height=s.scrollHeight+"px")}}),!e.taskInstruction&&i.jsx("span",{className:"absolute right-2 top-1 opacity-0 group-hover:opacity-100 transition-opacity",children:i.jsx(o,{variant:"outline",className:"text-xs bg-amber-50 border-amber-200 text-amber-600",children:"+ Add instruction"})})]}),e.instructions&&!e.taskInstruction&&"Summary Completion"!==e.questionType&&"Short Answer"!==e.questionType&&"Yes No Not Given"!==e.questionType&&"True False Not Given"!==e.questionType&&!/\b(yes|no|true|false)\b.*not given/i.test(e.instructions)&&!/write\s+(yes|no|true|false)/i.test(e.instructions)&&i.jsx("p",{className:"text-sm text-[#5a4a3f] mt-2 italic",children:e.instructions}),("Yes No Not Given"===e.questionType||"True False Not Given"===e.questionType)&&i.jsx("div",{className:"mt-3 space-y-1 pl-4",children:"Yes No Not Given"===e.questionType?i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex gap-4 text-sm",children:[i.jsx("span",{className:"font-bold text-[#2f241f] w-24",children:"YES"}),i.jsx("span",{className:"text-[#5a4a3f]",children:"if the statement is true"})]}),i.jsxs("div",{className:"flex gap-4 text-sm",children:[i.jsx("span",{className:"font-bold text-[#2f241f] w-24",children:"NO"}),i.jsx("span",{className:"text-[#5a4a3f]",children:"if the statement is false"})]}),i.jsxs("div",{className:"flex gap-4 text-sm",children:[i.jsx("span",{className:"font-bold text-[#2f241f] w-24",children:"NOT GIVEN"}),i.jsx("span",{className:"text-[#5a4a3f]",children:"if the information is not given in the passage"})]})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex gap-4 text-sm",children:[i.jsx("span",{className:"font-bold text-[#2f241f] w-24",children:"TRUE"}),i.jsx("span",{className:"text-[#5a4a3f]",children:"if the statement agrees with the information"})]}),i.jsxs("div",{className:"flex gap-4 text-sm",children:[i.jsx("span",{className:"font-bold text-[#2f241f] w-24",children:"FALSE"}),i.jsx("span",{className:"text-[#5a4a3f]",children:"if the statement contradicts the information"})]}),i.jsxs("div",{className:"flex gap-4 text-sm",children:[i.jsx("span",{className:"font-bold text-[#2f241f] w-24",children:"NOT GIVEN"}),i.jsx("span",{className:"text-[#5a4a3f]",children:"if there is no information on this"})]})]})})]}),e.options&&e.options.length>0&&"True False Not Given"!==e.questionType&&"Yes No Not Given"!==e.questionType&&i.jsx("div",{className:"mb-4 p-3 bg-[#fdfaf3] rounded-lg border border-[#e0d6c7]",children:i.jsx("div",{className:"space-y-2",children:e.options.map((e,s)=>i.jsx("div",{className:"text-sm text-[#2f241f] break-words whitespace-pre-wrap",children:e},s))})}),"Summary Completion"===e.questionType||"Short Answer"===e.questionType?i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"p-4 bg-[#fdfaf3] rounded-lg border border-[#e0d6c7] relative group",children:[i.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity z-10",children:i.jsx(o,{variant:"outline",className:"text-xs bg-amber-50 border-amber-200 text-amber-700",children:"Click to edit"})}),i.jsx(N,{value:e.instructions||"",onChange:e=>{((e,s)=>{var t;if(!(null==(t=xe[ae])?void 0:t.sections))return;const a=xe[ae].sections.map((t,a)=>a===e?{...t,instructions:s,questions:t.questions.map(e=>({...e}))}:{...t,questions:t.questions.map(e=>({...e}))}),n=a.flatMap(e=>e.questions);De(ae,{sections:a,questions:n})})(s,e.target.value),e.target.style.height="auto",e.target.style.height=e.target.scrollHeight+"px"},onFocus:e=>{e.target.style.height="auto",e.target.style.height=e.target.scrollHeight+"px"},placeholder:"Enter the summary paragraph with blanks like (14)_____, (15)_____ ...",className:"text-sm text-[#2f241f] leading-relaxed bg-transparent border-none focus:ring-0 resize-none p-0 w-full overflow-hidden",style:{boxShadow:"none",minHeight:"80px",height:"auto"},ref:s=>{s&&e.instructions&&(s.style.height="auto",s.style.height=s.scrollHeight+"px")}})]}),i.jsx("div",{className:"flex flex-wrap gap-3",children:e.questions.map((e,s)=>i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"font-bold text-black text-sm mt-1",children:e.question_number}),i.jsx(x,{className:"w-32 border border-[#D3C4A5] text-sm bg-[#FAF9F6] focus:ring-1 focus:ring-[#8B4513] text-black placeholder:text-transparent",placeholder:""})]},`summary-q-${e.question_number}-${s}`))})]}):i.jsx("div",{className:"space-y-3",children:e.questions.map((t,a)=>{var n;return i.jsxs("div",{className:"flex flex-row items-baseline gap-3 p-3 transition-all group",children:[i.jsx("span",{className:"flex-shrink-0 text-sm font-medium text-black min-w-[1.5rem] leading-relaxed",children:t.question_number}),i.jsxs("div",{className:"flex-1",children:[i.jsx(N,{value:t.question_text||"",onChange:e=>{((e,s,t)=>{var a;if(!(null==(a=xe[ae])?void 0:a.sections))return;const n=xe[ae].sections.map((a,n)=>{if(n===e){const e=a.questions.map((e,a)=>a===s?{...e,question_text:t}:{...e});return{...a,questions:e}}return{...a,questions:a.questions.map(e=>({...e}))}}),r=n.flatMap(e=>e.questions);De(ae,{sections:n,questions:r})})(s,a,e.target.value),e.target.style.height="auto",e.target.style.height=e.target.scrollHeight+"px"},onFocus:e=>{e.target.style.height="auto",e.target.style.height=e.target.scrollHeight+"px"},className:"text-base text-black leading-relaxed bg-transparent border-none focus:ring-1 focus:ring-[#8B4513] focus:bg-white/50 px-1 py-0.5 w-full resize-none overflow-hidden",placeholder:"Enter question text...",style:{boxShadow:"none",minHeight:"24px",height:"auto"},ref:e=>{e&&t.question_text&&(e.style.height="auto",e.style.height=e.scrollHeight+"px")}}),"True False Not Given"===e.questionType||"Yes No Not Given"===e.questionType?i.jsx("div",{className:"flex flex-wrap gap-3 mt-1.5",children:("True False Not Given"===e.questionType?["TRUE","FALSE","NOT GIVEN"]:["YES","NO","NOT GIVEN"]).map(e=>i.jsxs("label",{className:"relative flex items-center justify-center px-4 py-1.5 min-w-[80px] rounded-md border cursor-pointer text-sm font-bold transition-all duration-200 group",children:[i.jsx("input",{type:"radio",name:`preview-q-${t.question_number}`,className:"absolute opacity-0 w-0 h-0 peer"}),i.jsx("span",{className:"text-sm font-bold text-[#5c4b37] peer-checked:text-black transition-colors tracking-wide",children:e}),i.jsx("div",{className:"absolute inset-0 rounded-md border border-[#D3C4A5] bg-[#FAF9F6] peer-checked:border-2 peer-checked:border-[#8B4513] peer-checked:bg-[#d97757] peer-checked:ring-2 peer-checked:ring-[#d97757]/50 -z-10 pointer-events-none transition-all peer-checked:shadow-lg"})]},e))}):e.options&&e.options.length>0&&e.options.some(e=>/^[A-Z]\s+/.test(e))||"Matching Features"===e.questionType||"Matching Headings"===e.questionType||"Matching Paragraph Information"===e.questionType||"Matching Sentence Endings"===e.questionType?i.jsx(x,{className:"mt-2 w-16 border border-[#D3C4A5] text-center bg-[#FAF9F6] focus:ring-1 focus:ring-[#8B4513] font-bold uppercase text-black",placeholder:"",maxLength:1}):"Multiple Choice"===e.questionType&&t.options&&t.options.length>0?i.jsx("div",{className:"grid gap-2 mt-2",children:t.options.map((e,s)=>{const a=e.match(/^([A-D])\s+(.+)$/),n=a?a[1]:String.fromCharCode(65+s),r=a?a[2]:e;return i.jsxs("label",{className:"relative flex items-center gap-3 p-3 rounded-lg bg-[#FAF9F6] border border-[#D3C4A5] cursor-pointer hover:bg-[#F2EFE5] hover:border-[#d97757]/50 transition-all duration-200 group",children:[i.jsx("input",{type:"radio",name:`preview-q-${t.question_number}`,className:"peer sr-only"}),i.jsx("div",{className:"flex-shrink-0 w-6 h-6 flex items-center justify-center font-bold text-base mr-3 text-[#8B4513]/70 peer-checked:text-black transition-colors",children:n}),i.jsx("span",{className:"text-base text-black leading-relaxed peer-checked:text-black font-medium",children:r}),i.jsx("div",{className:"absolute inset-0 rounded-lg border border-transparent peer-checked:border-2 peer-checked:border-[#8B4513] peer-checked:bg-[#d97757] peer-checked:ring-2 peer-checked:ring-[#d97757]/50 -z-10 pointer-events-none transition-all peer-checked:shadow-lg"})]},s)})}):i.jsx("div",{className:"mt-2",children:i.jsx(x,{className:"max-w-[400px] bg-[#FAF9F6] border border-[#D3C4A5] rounded-md px-3 py-2 focus:ring-1 focus:ring-[#8B4513] focus:border-[#8B4513] shadow-sm text-lg text-black h-10 placeholder:text-transparent",placeholder:""})})]})]},`q-${t.question_number}-${a}-${(null==(n=t.question_text)?void 0:n.substring(0,20))||""}`)})})]},`preview-${e.questionRange}-${s}-${e.questions.length}-${(null==(t=e.taskInstruction)?void 0:t.length)||0}-${(null==(a=e.options)?void 0:a.length)||0}`)})}):xe[ae].questions.length>0?i.jsx("div",{className:"space-y-6",children:xe[ae].questions.map((e,s)=>{var t;return i.jsx("div",{className:"py-6 px-4 group hover:bg-black/[0.02] transition-colors rounded-lg",children:i.jsxs("div",{className:"flex flex-row items-baseline gap-3",children:[i.jsx("span",{className:"flex-shrink-0 font-sans text-sm font-medium text-black min-w-[1.5rem] leading-relaxed",children:e.question_number||s+1}),i.jsxs("div",{className:"flex-1 space-y-3",children:[i.jsx("p",{className:"text-lg text-black leading-relaxed",children:e.question_text}),"True False Not Given"===e.question_type||"Yes No Not Given"===e.question_type?i.jsx("div",{className:"flex flex-wrap gap-3 mt-2",children:("True False Not Given"===e.question_type?["TRUE","FALSE","NOT GIVEN"]:["YES","NO","NOT GIVEN"]).map(t=>i.jsxs("label",{className:"relative flex items-center justify-center px-4 py-1.5 min-w-[80px] rounded-md border cursor-pointer text-sm font-bold transition-all duration-200 group",children:[i.jsx("input",{type:"radio",name:`fallback-q-${e.question_number||s}`,className:"absolute opacity-0 w-0 h-0 peer"}),i.jsx("span",{className:"text-sm font-medium text-[#5c4b37] peer-checked:text-black transition-colors tracking-wide",children:t}),i.jsx("div",{className:"absolute inset-0 rounded-md border border-[#D3C4A5] bg-[#FAF9F6] peer-checked:border-2 peer-checked:border-[#8B4513] peer-checked:bg-[#d97757] peer-checked:ring-2 peer-checked:ring-[#d97757]/50 -z-10 pointer-events-none transition-all peer-checked:shadow-lg"})]},t))}):(null==(t=e.question_type)?void 0:t.includes("Matching"))||e.options&&e.options.some(e=>/^[A-Z]\s+/.test(e))?i.jsx(x,{className:"mt-2 w-16 border border-[#D3C4A5] text-center bg-[#FAF9F6] focus:ring-1 focus:ring-[#8B4513] font-bold uppercase text-black",placeholder:"",maxLength:1}):"Multiple Choice"===e.question_type&&e.options&&e.options.length>0?i.jsx("div",{className:"grid gap-2 mt-2",children:e.options.map((t,a)=>{const n=t.match(/^([A-D])\s+(.+)$/),r=n?n[1]:String.fromCharCode(65+a),o=n?n[2]:t;return i.jsxs("label",{className:"relative flex items-center gap-3 p-3 rounded-lg bg-[#FAF9F6] border border-[#D3C4A5] cursor-pointer hover:bg-[#F2EFE5] hover:border-[#d97757]/50 transition-all duration-200 group",children:[i.jsx("input",{type:"radio",name:`fallback-q-${e.question_number||s}`,className:"peer sr-only"}),i.jsx("div",{className:"flex-shrink-0 w-6 h-6 flex items-center justify-center font-bold text-base mr-3 text-[#8B4513]/70 peer-checked:text-black transition-colors",children:r}),i.jsx("span",{className:"text-base text-black leading-relaxed peer-checked:text-black font-medium",children:o}),i.jsx("div",{className:"absolute inset-0 rounded-lg border border-transparent peer-checked:border-2 peer-checked:border-[#8B4513] peer-checked:bg-[#d97757] peer-checked:ring-2 peer-checked:ring-[#d97757]/50 -z-10 pointer-events-none transition-all peer-checked:shadow-lg"})]},a)})}):i.jsx("div",{className:"mt-2",children:i.jsx(x,{className:"max-w-[400px] bg-[#FAF9F6] border border-[#D3C4A5] rounded-md px-3 py-2 focus:ring-1 focus:ring-[#8B4513] focus:border-[#8B4513] shadow-sm text-lg text-black h-10 placeholder:text-transparent",placeholder:""})})]})]})},s)})}):i.jsx("p",{className:"text-[#5a4a3f] italic",children:"No questions added yet"})]})]}),i.jsx("div",{className:"bg-[#f0ece2] p-3 text-center text-xs text-[#5a4a3f]",children:"ðŸŽ¯ Interactive Preview â€¢ Click and type to test like a student"})]})]})]}),i.jsxs("div",{className:"bg-[#fdfaf3] rounded-lg p-4 border border-[#e0d6c7]",children:[i.jsx("h4",{className:"text-sm font-semibold text-[#2f241f] mb-2",children:"ðŸ’¡ How IELTS Reading works:"}),i.jsxs("ul",{className:"text-xs text-[#5a4a3f] space-y-1 list-disc list-inside mb-4",children:[i.jsx("li",{children:"ENGLISH AIDOL IELTS READING has 3 passages with 40 questions total"}),i.jsx("li",{children:"Questions 1-13 = Passage 1, 14-26 = Passage 2, 27-40 = Passage 3"}),i.jsxs("li",{children:[i.jsx("strong",{children:"Copy & Paste"})," questions from Cambridge books or paste text directly"]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Image Upload"})," for screenshots of question papers"]})]}),i.jsx("h4",{className:"text-sm font-semibold text-[#2f241f] mb-2",children:"ðŸ“ 14 IELTS Reading Question Types (All Supported):"}),i.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-[#5a4a3f]",children:[i.jsxs("div",{className:"space-y-1",children:[i.jsx("p",{children:"1. Matching Headings"}),i.jsx("p",{children:"2. Matching Paragraph Info"}),i.jsx("p",{children:"3. Matching Features"}),i.jsx("p",{children:"4. Matching Sentence Endings"}),i.jsx("p",{children:"5. True/False/Not Given"}),i.jsx("p",{children:"6. Multiple Choice"}),i.jsx("p",{children:"7. List of Options"})]}),i.jsxs("div",{className:"space-y-1",children:[i.jsx("p",{children:"8. Choose a Title"}),i.jsx("p",{children:"9. Short Answers"}),i.jsx("p",{children:"10. Sentence Completion"}),i.jsx("p",{children:"11. Summary Completion"}),i.jsx("p",{children:"12. Table Completion"}),i.jsx("p",{children:"13. Flow Chart Completion"}),i.jsx("p",{children:"14. Diagram Completion"})]})]})]}),i.jsxs("div",{className:"flex gap-3 justify-end pt-4 border-t border-[#e0d6c7]",children:[Pe().length>0&&i.jsx(h,{variant:"outline",onClick:async()=>{const e=Pe();if(0!==e.length){te(!0);try{console.log("ðŸ¤– Generating AI explanations with Gemini...");const s=[1,2,3].map(e=>({passageNumber:e,text:xe[e].passageText})).filter(e=>e.text),{data:t,error:a}=await P.functions.invoke("generate-reading-explanations",{body:{questions:e,passages:s}});if(a)throw a;if(!t.success)throw new Error(t.error||"Failed to generate explanations");const n={...xe};t.explanations.forEach(e=>{const s=e.passageNumber||1,t=n[s].questions.findIndex(s=>s.question_number===e.questionNumber);-1!==t&&(n[s].questions[t].explanation=e.explanation)}),he(n),r.success(`Generated explanations for ${t.explanations.length} questions!`)}catch(s){console.error("Error generating explanations:",s),r.error(`Failed to generate explanations: ${s.message}`)}finally{te(!1)}}else r.error("Please add questions first")},disabled:se,className:"border-[#e0d6c7] text-[#5a4a3f] hover:bg-[#fdfaf3]",size:"lg",children:se?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-amber-600 mr-2"}),"Generating Explanations..."]}):i.jsxs(i.Fragment,{children:[i.jsx(j,{className:"w-4 h-4 mr-2"}),"Generate AI Explanations"]})}),i.jsx(h,{onClick:Qe,disabled:J,className:"bg-amber-600 hover:bg-amber-700 text-white px-8",size:"lg",children:J?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving Test..."]}):i.jsxs(i.Fragment,{children:[i.jsx(O,{className:"w-4 h-4 mr-2"}),"Save Complete Reading Test"]})})]})]})]})]}),i.jsx(y,{open:null!==pe,onOpenChange:e=>!e&&Fe(),children:i.jsxs(T,{className:"max-w-lg bg-[#fdfaf3]",children:[i.jsxs(k,{children:[i.jsxs(_,{className:"text-[#2f241f] flex items-center gap-2",children:[i.jsx(w,{className:"w-5 h-5 text-amber-600"}),"Edit Matching Options"]}),i.jsx(A,{className:"text-[#5a4a3f]",children:"Add or remove options for this matching question section (e.g., A = Tony Brown, B = Patrick Leahy)"})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"text-sm font-medium text-[#2f241f]",children:["Current Options (",be.length,"):"]}),be.length>0?i.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:be.map((e,s)=>i.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded border border-[#e0d6c7]",children:[i.jsx("span",{className:"text-sm text-[#2f241f]",children:e}),i.jsx(h,{variant:"ghost",size:"sm",onClick:()=>(e=>{const s=be[e];fe(be.filter((s,t)=>t!==e)),r.success(`Removed option ${s.charAt(0)}`)})(s),className:"h-7 w-7 p-0 text-red-500 hover:text-red-700 hover:bg-red-50",children:i.jsx(C,{className:"w-4 h-4"})})]},s))}):i.jsx("p",{className:"text-sm text-[#5a4a3f] italic p-2 bg-amber-50 rounded border border-amber-200",children:"No options yet. Add options below."})]}),i.jsxs("div",{className:"space-y-2 pt-2 border-t border-[#e0d6c7]",children:[i.jsx("label",{className:"text-sm font-medium text-[#2f241f]",children:"Add New Option:"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(x,{placeholder:"Letter (A-Z)",value:Ne,onChange:e=>je(e.target.value.toUpperCase()),className:"w-24 bg-white border-[#e0d6c7] text-center font-bold text-[#2f241f]",maxLength:1}),i.jsx(x,{placeholder:"Name (e.g., Tony Brown)",value:ve,onChange:e=>we(e.target.value),className:"flex-1 bg-white border-[#e0d6c7] text-[#2f241f]",onKeyDown:e=>"Enter"===e.key&&$e()}),i.jsx(h,{onClick:$e,className:"bg-amber-600 hover:bg-amber-700 text-white",children:i.jsx(v,{className:"w-4 h-4"})})]}),i.jsx("p",{className:"text-xs text-[#5a4a3f]",children:"ðŸ’¡ Tip: Press Enter to quickly add options"})]}),i.jsxs("div",{className:"space-y-2 pt-2 border-t border-[#e0d6c7]",children:[i.jsx("label",{className:"text-sm font-medium text-[#2f241f]",children:"Or Paste Multiple Options:"}),i.jsx(N,{placeholder:"Paste options like:\nA  Tony Brown\nB  Patrick Leahy\nC  Bill Bowler\nD  Paul Jepson",className:"bg-white border-[#e0d6c7] text-sm font-mono h-24 text-[#2f241f]",onChange:e=>{const s=e.target.value;if(!s.trim())return;const t=s.split("\n"),a=[];for(const n of t){const e=n.match(/^\s*([A-Z])\s*[.\):\s]+\s*(.+)/i);if(e){const s=e[1].toUpperCase(),t=e[2].trim();!t||be.some(e=>e.startsWith(s+" "))||a.some(e=>e.startsWith(s+" "))||a.push(`${s}  ${t}`)}}if(a.length>0){const s=[...be,...a].sort((e,s)=>e.charCodeAt(0)-s.charCodeAt(0));fe(s),r.success(`Added ${a.length} options`),e.target.value=""}}})]})]}),i.jsxs(E,{className:"gap-2",children:[i.jsx(h,{variant:"outline",onClick:Fe,className:"border-[#e0d6c7] text-[#5a4a3f]",children:"Cancel"}),i.jsxs(h,{onClick:()=>{if(null===pe)return;const e=xe[ae].sections.map((e,s)=>s===pe?{...e,options:be.length>0?[...be]:null,questions:e.questions.map(e=>({...e}))}:{...e,questions:e.questions.map(e=>({...e}))}),s=e.flatMap(e=>e.questions);De(ae,{sections:e,questions:s}),r.success(`Options updated for ${e[pe].questionRange}`),Fe()},className:"bg-amber-600 hover:bg-amber-700 text-white",children:[i.jsx(O,{className:"w-4 h-4 mr-2"}),"Save Options"]})]})]})}),i.jsx(y,{open:null!==qe,onOpenChange:e=>!e&&Re(),children:i.jsxs(T,{className:"max-w-2xl bg-[#fdfaf3]",children:[i.jsxs(k,{children:[i.jsxs(_,{className:"text-[#2f241f] flex items-center gap-2",children:[i.jsx(M,{className:"w-5 h-5 text-amber-600"}),"Edit Task Instruction"]}),i.jsx(A,{className:"text-[#5a4a3f]",children:'Edit the instruction text that appears at the top of this question section (e.g., "Complete the summary below. Choose NO MORE THAN TWO WORDS...")'})]}),i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-sm font-medium text-[#2f241f]",children:"Instruction Text:"}),i.jsx(N,{value:Te,onChange:e=>ke(e.target.value),placeholder:"Enter the task instruction for students...",className:"bg-white border-[#e0d6c7] min-h-[150px] text-sm text-[#2f241f]"}),i.jsx("p",{className:"text-xs text-[#5a4a3f]",children:'ðŸ’¡ This is the instruction that tells students what to do (e.g., "Do the following statements agree with the information given in Reading Passage 1?")'})]})}),i.jsxs(E,{className:"gap-2",children:[i.jsx(h,{variant:"outline",onClick:Re,className:"border-[#e0d6c7] text-[#5a4a3f]",children:"Cancel"}),i.jsxs(h,{onClick:()=>{var e;if(null===qe)return;if(!(null==(e=xe[ae])?void 0:e.sections))return;const s=xe[ae].sections.map((e,s)=>s===qe?{...e,taskInstruction:Te.trim()||void 0,questions:e.questions.map(e=>({...e}))}:{...e,questions:e.questions.map(e=>({...e}))}),t=s.flatMap(e=>e.questions);De(ae,{sections:s,questions:t}),r.success(`Instruction updated for ${s[qe].questionRange}`),Re()},className:"bg-amber-600 hover:bg-amber-700 text-white",children:[i.jsx(O,{className:"w-4 h-4 mr-2"}),"Save Instruction"]})]})]})}),i.jsx(y,{open:null!==_e,onOpenChange:e=>!e&&Ge(),children:i.jsxs(T,{className:"max-w-lg bg-[#fdfaf3]",children:[i.jsxs(k,{children:[i.jsxs(_,{className:"text-[#2f241f] flex items-center gap-2",children:[i.jsx(M,{className:"w-5 h-5 text-amber-600"}),"Edit Question"]}),i.jsx(A,{className:"text-[#5a4a3f]",children:"Edit the question text and correct answer"})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-sm font-medium text-[#2f241f]",children:"Question Text:"}),i.jsx(N,{value:Ce,onChange:e=>Ee(e.target.value),placeholder:"Enter the question text...",className:"bg-white border-[#e0d6c7] min-h-[100px] text-sm text-[#2f241f]"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-sm font-medium text-[#2f241f]",children:"Correct Answer:"}),i.jsx(x,{value:Se,onChange:e=>Ie(e.target.value),placeholder:"Enter the correct answer...",className:"bg-white border-[#e0d6c7] text-sm text-[#2f241f]"}),i.jsx("p",{className:"text-xs text-[#5a4a3f]",children:"ðŸ’¡ For matching questions, enter the letter (A-E). For fill-in-the-blank, enter the word(s)."})]})]}),i.jsxs(E,{className:"gap-2",children:[i.jsx(h,{variant:"outline",onClick:Ge,className:"border-[#e0d6c7] text-[#5a4a3f]",children:"Cancel"}),i.jsxs(h,{onClick:()=>{var e,s,t;if(!_e)return;if(!(null==(e=xe[ae])?void 0:e.sections))return;const{sectionIdx:a,questionIdx:n}=_e,i=xe[ae].sections.map((e,s)=>{if(s===a){const s=e.questions.map((e,s)=>s===n?{...e,question_text:Ce.trim(),correct_answer:Se.trim()||""}:{...e});return{...e,questions:s}}return{...e,questions:e.questions.map(e=>({...e}))}}),o=i.flatMap(e=>e.questions),l=null==(t=null==(s=xe[ae].sections[a])?void 0:s.questions[n])?void 0:t.question_number;De(ae,{sections:i,questions:o}),r.success(`Question ${l} updated`),Ge()},className:"bg-amber-600 hover:bg-amber-700 text-white",children:[i.jsx(O,{className:"w-4 h-4 mr-2"}),"Save Question"]})]})]})})]}):null};export{H as default};
