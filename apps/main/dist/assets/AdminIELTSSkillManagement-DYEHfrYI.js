import{c as e,u as s,r as t,j as a}from"./vendor-react-rLLBBC7n.js";import{n as i,J as n,e as r,C as l,b as o,c,o as d,a as m,I as h,B as x,V as u}from"./index-KxDfHqNJ.js";import{A as g,a as j,b as p,c as f,d as y,e as w,f as b,g as k,h as N}from"./alert-dialog-Bvks6upm.js";import{A as I}from"./AdminLayout-DGXoIbe0.js";import{av as C,q as v,X as T,a_ as $,aY as S,ao as J,aJ as E,ax as O,aO as M}from"./vendor-ui-BGi_EvHx.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-charts-0DeywwxG.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";const L={listening:E,reading:J,writing:O,speaking:M},z=()=>{const{skill:E}=e(),O=s(),{admin:M,loading:z}=i(),[F,_]=t.useState([]),[A,Z]=t.useState(!1),[Y,R]=t.useState(""),[X,q]=t.useState(null),[U,P]=t.useState(""),B=["listening","reading","writing","speaking"];if(t.useEffect(()=>{if(!E||!B.includes(E.toLowerCase()))return console.log("Invalid or missing skill parameter:",E,"Redirecting to /admin/ielts"),void O("/admin/ielts")},[E,O]),!E||!B.includes(E.toLowerCase()))return null;const W=E?E.charAt(0).toUpperCase()+E.slice(1):"",V=null==E?void 0:E.toLowerCase(),D=V&&L[V]||J;t.useEffect(()=>{z||(M?K():O("/admin/login"))},[M,z,O,E]);const K=async()=>{if(E)try{console.log(`ğŸ” Loading ${W} tests...`);const s=E.charAt(0).toUpperCase()+E.slice(1),t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN1dW14bWZ6aHdsanlsYmRsZmxqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM1MTkxMjEsImV4cCI6MjA2OTA5NTEyMX0.8jqO_ciOttSxSLZnKY0i5oJmEn79ROF53TjUMYhNemI",a="https://cuumxmfzhwljylbdlflj.supabase.co",i=new AbortController,n=setTimeout(()=>i.abort(),5e3);try{const e=await fetch(`${a}/rest/v1/tests?test_type=eq.IELTS&order=created_at.asc`,{headers:{apikey:t,Authorization:`Bearer ${t}`,"Content-Type":"application/json"},signal:i.signal});if(clearTimeout(n),!e.ok)throw new Error(`Failed to fetch tests: ${e.status}`);const r=await e.json(),l=(null==r?void 0:r.filter(e=>e.module===s||e.skill_category===s))||[];console.log(`âœ… Found ${l.length} ${W} tests:`,l),_(l)}catch(e){throw clearTimeout(n),console.error("âŒ Fetch error:",e),e}}catch(s){console.error("âŒ Error loading skill tests:",s),n.error(`Failed to load ${W} tests`)}},G=async()=>{if(Y.trim()){Z(!0);try{console.log(`ğŸ“ Creating new ${W} test: "${Y}"`);const e=E?E.charAt(0).toUpperCase()+E.slice(1):"";let s={test_name:Y,test_type:"IELTS",module:e,skill_category:e};"writing"===E?(s.module="Writing",s.skill_category="Writing"):"speaking"===E?(s.module="Speaking",s.skill_category="Speaking"):"reading"===E?(s.module="Reading",s.skill_category="Reading"):"listening"===E&&(s.module="Listening",s.skill_category="Listening"),console.log("ğŸ’¾ Creating test via edge function:",s);const t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN1dW14bWZ6aHdsanlsYmRsZmxqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM1MTkxMjEsImV4cCI6MjA2OTA5NTEyMX0.8jqO_ciOttSxSLZnKY0i5oJmEn79ROF53TjUMYhNemI",a=`${"https://cuumxmfzhwljylbdlflj.supabase.co"}/functions/v1/create-test`,i=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",apikey:t,Authorization:`Bearer ${t}`},body:JSON.stringify(s)});if(!i.ok){const e=await i.text();throw console.error("Create function error response:",e),new Error(`Failed to create test: ${i.status} - ${e}`)}const r=(await i.json()).data;switch(console.log("âœ… Test created successfully:",r),n.success(`${W} test created successfully`),R(""),await K(),E){case"speaking":O(`/admin/ielts/test/${r.id}/speaking`);break;case"writing":O(`/admin/ielts/test/${r.id}/writing`);break;case"reading":O(`/admin/ielts/test/${r.id}/reading`);break;case"listening":O(`/admin/ielts/test/${r.id}/listening`);break;default:O(`/admin/ielts/test/${r.id}`)}}catch(e){console.error("âŒ Full error:",e),n.error(`Failed to create ${W} test: ${(null==e?void 0:e.message)||"Unknown error"}`)}finally{Z(!1)}}else n.error("Please enter a test name")},H=()=>{q(null),P("")},Q=async()=>{if(U.trim())try{const{error:e}=await u.from("tests").update({test_name:U}).eq("id",X);if(e)throw e;n.success("Test name updated successfully"),q(null),P(""),K()}catch(e){console.error("Error updating test name:",e),n.error("Failed to update test name")}else n.error("Test name cannot be empty")},ee=e=>{if(!X)switch(E){case"speaking":O(`/admin/ielts/test/${e.id}/speaking`);break;case"writing":O(`/admin/ielts/test/${e.id}/writing`);break;case"reading":O(`/admin/ielts/test/${e.id}/reading`);break;case"listening":O(`/admin/ielts/test/${e.id}/listening`);break;default:O(`/admin/ielts/test/${e.id}`)}};return z?a.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),a.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Loading ",W," Admin..."]})]})}):M?a.jsx(I,{title:`IELTS ${W} Tests`,showBackButton:!0,backPath:"/admin/ielts",children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(D,{className:"h-8 w-8 text-primary"}),a.jsxs("div",{children:[a.jsxs("h1",{className:"text-3xl font-bold tracking-tight bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",children:["IELTS ",W," Tests"]}),a.jsxs("p",{className:"text-muted-foreground",children:["Manage ",W.toLowerCase()," test content and questions"]})]})]}),a.jsxs(r,{variant:"secondary",className:"text-sm",children:[W," Management"]})]}),a.jsxs(l,{children:[a.jsxs(o,{children:[a.jsxs(c,{className:"flex items-center space-x-2",children:[a.jsx(C,{className:"h-5 w-5"}),a.jsxs("span",{children:["Create New ",W," Test"]})]}),a.jsxs(d,{children:["Add a new IELTS ",W.toLowerCase()," test to your collection"]})]}),a.jsxs(m,{className:"flex gap-3 items-end",children:[a.jsx("div",{className:"flex-1",children:a.jsx(h,{placeholder:`Test name (e.g., ${W} Test 1)`,value:Y,onChange:e=>R(e.target.value),onKeyPress:e=>"Enter"===e.key&&G()})}),a.jsx(x,{onClick:G,disabled:A,children:A?"Creating...":"Create Test"})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h3",{className:"text-xl font-semibold",children:["Existing ",W," Tests"]}),a.jsxs(r,{variant:"outline",children:[F.length," tests"]})]}),F.length>0?a.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:F.map(e=>a.jsxs(l,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>ee(e),children:[a.jsxs(o,{children:[a.jsxs(c,{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(D,{className:"w-5 h-5 text-primary"}),X===e.id?a.jsxs("div",{className:"flex items-center space-x-2",onClick:e=>e.stopPropagation(),children:[a.jsx(h,{value:U,onChange:e=>P(e.target.value),className:"text-lg font-semibold h-8",onKeyPress:e=>"Enter"===e.key&&Q()}),a.jsx(x,{size:"sm",variant:"ghost",onClick:Q,children:a.jsx(v,{className:"w-4 h-4 text-green-600"})}),a.jsx(x,{size:"sm",variant:"ghost",onClick:H,children:a.jsx(T,{className:"w-4 h-4 text-red-600"})})]}):a.jsx("span",{children:e.test_name})]}),X!==e.id&&a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(x,{size:"sm",variant:"ghost",onClick:s=>{s.stopPropagation(),(e=>{q(e.id),P(e.test_name)})(e)},children:a.jsx($,{className:"w-4 h-4"})}),a.jsxs(g,{children:[a.jsx(j,{asChild:!0,children:a.jsx(x,{size:"sm",variant:"ghost",onClick:e=>e.stopPropagation(),children:a.jsx(S,{className:"w-4 h-4 text-red-600"})})}),a.jsxs(p,{className:"z-50",children:[a.jsxs(f,{children:[a.jsx(y,{children:"Delete Test"}),a.jsxs(w,{children:['Are you sure you want to delete "',e.test_name,'"? This will also delete all questions associated with this test. This action cannot be undone.']})]}),a.jsxs(b,{children:[a.jsx(k,{children:"Cancel"}),a.jsx(N,{onClick:()=>(async(e,s)=>{try{console.log(`ğŸ—‘ï¸ Deleting test: ${s} (${e})`);const t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN1dW14bWZ6aHdsanlsYmRsZmxqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM1MTkxMjEsImV4cCI6MjA2OTA5NTEyMX0.8jqO_ciOttSxSLZnKY0i5oJmEn79ROF53TjUMYhNemI",a="https://cuumxmfzhwljylbdlflj.supabase.co/functions/v1/delete-test",i=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",apikey:t,Authorization:`Bearer ${t}`},body:JSON.stringify({testId:e})});if(!i.ok){const e=await i.text();throw console.error("Delete function error response:",e),new Error(`Failed to delete test: ${i.status} - ${e}`)}const r=await i.json();console.log("âœ… Test deleted successfully:",r),n.success(`Test "${s}" deleted successfully`),K()}catch(t){console.error("âŒ Full error:",t),n.error(`Failed to delete test: ${(null==t?void 0:t.message)||"Unknown error"}`)}})(e.id,e.test_name),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]}),a.jsxs(d,{children:["Created: ",new Date(e.created_at).toLocaleDateString()]})]}),a.jsxs(m,{children:[a.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[a.jsxs("span",{children:["Type: ",e.test_type]}),a.jsxs("span",{children:["Skill: ",e.module]})]}),a.jsxs(x,{size:"sm",className:"w-full mt-3",onClick:s=>{s.stopPropagation(),ee(e)},disabled:X===e.id,children:["Manage ",W," Content"]})]})]},e.id))}):a.jsxs("div",{className:"text-center py-12",children:[a.jsx(D,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),a.jsxs("h3",{className:"text-lg font-semibold mb-2",children:["No ",W," tests found"]}),a.jsxs("p",{className:"text-muted-foreground mb-4",children:["Create your first ",W.toLowerCase()," test to get started"]}),a.jsx(x,{onClick:()=>R(`${W} Test 1`),children:"Create First Test"})]})]})]})}):null};export{z as default};
