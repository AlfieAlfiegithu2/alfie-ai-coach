import{c as e,u as t,r as s,j as r}from"./vendor-react-rLLBBC7n.js";import{u as i,d as a,B as o,e as l,C as n,b as d,c,a as u,I as m,T as p,s as x}from"./index-BDl0jLJK.js";import{S as h}from"./separator-C0bogF69.js";import{A as g}from"./AdminLayout-DwaN-V0p.js";import{az as v,av as j,aO as f,b5 as _,aV as b,ap as N,X as y,aA as w}from"./vendor-ui-BGi_EvHx.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-charts-0DeywwxG.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";const k=()=>{const{testId:k}=e(),S=t(),{uploadAudio:A,loading:I}=i(),{toast:C}=a(),[P,E]=s.useState(""),[$,q]=s.useState(!1),[L,T]=s.useState(!1),[Q,D]=s.useState(!1),[M,U]=s.useState(!0),[z,R]=s.useState("Loading test data..."),[F,O]=s.useState(!0),[J,B]=s.useState(!0),[Y,Z]=s.useState(4),[W,X]=s.useState([{title:"Interview Question 1",prompt_text:"Audio prompt",part_number:1,time_limit:2,transcription:""},{title:"Interview Question 2",prompt_text:"Audio prompt",part_number:1,time_limit:2,transcription:""},{title:"Interview Question 3",prompt_text:"Audio prompt",part_number:1,time_limit:2,transcription:""},{title:"Interview Question 4",prompt_text:"Audio prompt",part_number:1,time_limit:2,transcription:""}]),[V,H]=s.useState({title:"Cue Card",prompt_text:"",part_number:2,time_limit:3}),[G,K]=s.useState(4),[ee,te]=s.useState([{title:"Discussion Question 1",prompt_text:"Audio prompt",part_number:3,time_limit:2,transcription:""},{title:"Discussion Question 2",prompt_text:"Audio prompt",part_number:3,time_limit:2,transcription:""},{title:"Discussion Question 3",prompt_text:"Audio prompt",part_number:3,time_limit:2,transcription:""},{title:"Discussion Question 4",prompt_text:"Audio prompt",part_number:3,time_limit:2,transcription:""}]);s.useEffect(()=>{se()},[k]);const se=async()=>{if(k)try{console.log("ðŸ“ Loading speaking test data for testId:",k),U(!0),R("Loading test data...");const e="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN1dW14bWZ6aHdsanlsYmRsZmxqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM1MTkxMjEsImV4cCI6MjA2OTA5NTEyMX0.8jqO_ciOttSxSLZnKY0i5oJmEn79ROF53TjUMYhNemI",t="https://cuumxmfzhwljylbdlflj.supabase.co",s=new AbortController,r=setTimeout(()=>s.abort(),1e4);try{console.log("ðŸ“ Fetching speaking test details via REST API...");const r=await fetch(`${t}/rest/v1/tests?id=eq.${k}&select=*`,{headers:{apikey:e,Authorization:`Bearer ${e}`,"Content-Type":"application/json"},signal:s.signal});if(r.ok){const e=await r.json(),t=null==e?void 0:e[0];t&&(console.log("âœ… Test loaded:",t.test_name),E(t.test_name))}console.log("ðŸ“ Fetching speaking prompts via REST API...");const i=await fetch(`${t}/rest/v1/speaking_prompts?test_id=eq.${k}&select=*&order=part_number.asc,title.asc`,{headers:{apikey:e,Authorization:`Bearer ${e}`,"Content-Type":"application/json"},signal:s.signal});if(i.ok){const e=await i.json();if(console.log("âœ… Speaking prompts loaded:",(null==e?void 0:e.length)||0),console.log("ðŸ“ Prompts by part:",{part1:e.filter(e=>1===e.part_number).length,part2:e.filter(e=>2===e.part_number).length,part3:e.filter(e=>3===e.part_number).length}),e.forEach((e,t)=>{console.log(`  Prompt ${t+1}: Part ${e.part_number} - ${e.title} (ID: ${e.id})`)}),e&&e.length>0){const t=e.some(e=>e.is_locked);T(t);const s=e.filter(e=>1===e.part_number),r=e.filter(e=>2===e.part_number),i=e.filter(e=>3===e.part_number);if(s.length>0){const e=s.sort((e,t)=>{var s,r;return parseInt((null==(s=e.title.match(/(\d+)/))?void 0:s[1])||"0")-parseInt((null==(r=t.title.match(/(\d+)/))?void 0:r[1])||"0")});console.log("ðŸ“ Loading part 1 prompts:",e.length,"questions"),e.forEach((e,t)=>console.log(`  Part 1 Q${t+1}:`,e.title,e.id)),Z(Math.max(e.length,1));const t=Array.from({length:Math.max(e.length,1)},(t,s)=>e[s]||W[s]||{title:`Interview Question ${s+1}`,prompt_text:"Audio prompt",part_number:1,time_limit:2,transcription:""});X(t)}if(r.length>0?(H(r[0]),O(!0)):O(!1),i.length>0){const e=i.sort((e,t)=>{var s,r;return parseInt((null==(s=e.title.match(/(\d+)/))?void 0:s[1])||"0")-parseInt((null==(r=t.title.match(/(\d+)/))?void 0:r[1])||"0")});console.log("ðŸ“ Loading part 3 prompts:",e.length,"questions"),e.forEach((e,t)=>console.log(`  Part 3 Q${t+1}:`,e.title,e.id));const t=[...ee];e.forEach((e,s)=>{s<t.length?t[s]={...t[s],...e,id:e.id}:t.push(e)}),te(t),K(Math.max(e.length,1)),B(!0),console.log("ðŸ“ Final part 3 setup:",t.length,"questions displayed")}else B(!1)}}console.log("âœ… Speaking test data loading complete"),U(!1),R("Test data loading complete"),setTimeout(()=>R(""),3e3)}finally{clearTimeout(r)}}catch(e){console.error("âŒ Error loading speaking test data:",e),U(!1),R("Failed to load test data"),C({title:"Error",description:"Failed to load test data",variant:"destructive"})}},re=async(e,t,s)=>{try{const i=await A(e);if(i.success){console.log("ðŸŽµ Audio URL received:",i.url);try{const e=await fetch(i.url,{method:"HEAD"});console.log("âœ… Audio URL accessible:",e.status,e.headers.get("content-type"))}catch(r){console.error("âŒ Audio URL not accessible:",r),C({title:"Warning",description:"Audio uploaded but may not be publicly accessible. Check R2 bucket settings.",variant:"destructive"})}if(1===t&&void 0!==s){const e=[...W];e[s].audio_url=i.url,X(e)}else if(2===t)H(e=>({...e,audio_url:i.url}));else if(3===t&&void 0!==s){const e=[...ee];e[s].audio_url=i.url,te(e)}C({title:"Success",description:"Audio uploaded successfully"})}}catch(i){console.error("Upload error:",i),C({title:"Error",description:"Failed to upload audio",variant:"destructive"})}},ie=(e,t)=>{if(1===e&&void 0!==t){const e=[...W];e[t].audio_url=void 0,X(e)}else if(2===e)H(e=>({...e,audio_url:void 0}));else if(3===e&&void 0!==t){const e=[...ee];e[t].audio_url=void 0,te(e)}C({title:"Success",description:"Audio removed"})},ae=e=>{e.preventDefault(),e.stopPropagation()},oe=async(e,t,s)=>{if(e.preventDefault(),e.stopPropagation(),L&&!Q)return;const r=Array.from(e.dataTransfer.files).find(e=>e.type.startsWith("audio/"));r?await re(r,t,s):C({title:"Invalid file",description:"Please drop an audio file",variant:"destructive"})},le=async e=>{q(!0);try{let t=[];if(console.log(`ðŸ”„ Saving Part ${e}...`),1===e)t=W.map((e,t)=>({...e,title:`Interview Question ${t+1}`,prompt_text:e.prompt_text||"Audio prompt",part_number:1,time_limit:e.time_limit||2,audio_url:e.audio_url||void 0,transcription:e.transcription||void 0})),console.log("ðŸ“ Part 1 prompts to save:",t.map(e=>({title:e.title,has_audio:!!e.audio_url,audio_url:e.audio_url})));else if(2===e){if(!F){const{error:e}=await x.from("speaking_prompts").delete().eq("test_id",k).eq("part_number",2);if(e)throw e;return void C({title:"Success",description:"Part 2 removed successfully"})}V.prompt_text.trim()&&(t=[V])}else if(3===e){if(!J){const{error:e}=await x.from("speaking_prompts").delete().eq("test_id",k).eq("part_number",3);if(e)throw e;return void C({title:"Success",description:"Part 3 removed successfully"})}t=ee.map((e,t)=>({...e,title:`Discussion Question ${t+1}`,prompt_text:e.prompt_text||"Audio prompt",part_number:3,time_limit:e.time_limit||2,audio_url:e.audio_url||void 0,transcription:e.transcription||void 0})),console.log("ðŸ“ Part 3 prompts to save:",t.map(e=>({title:e.title,has_audio:!!e.audio_url,audio_url:e.audio_url})))}if(t.length>0)if(console.log(`ðŸ’¾ Processing ${t.length} prompts...`),1===e||3===e){for(let e=0;e<t.length;e++){const s=t[e],{data:r}=await x.from("speaking_prompts").select("id, audio_url").eq("test_id",k).eq("part_number",s.part_number).eq("title",s.title).maybeSingle(),i={title:s.title,prompt_text:s.prompt_text,part_number:s.part_number,time_limit:s.time_limit,sample_answer:null,test_id:k,transcription:s.transcription||null,audio_url:s.audio_url||null,is_locked:!0};if(r){const e={...i,audio_url:void 0!==s.audio_url&&null!==s.audio_url?s.audio_url:r.audio_url||null};console.log(`ðŸ”Š Saving audio_url for ${s.title}:`,e.audio_url),console.log(`ðŸ“ Updating existing prompt: ${s.title}`);const{error:t}=await x.from("speaking_prompts").update(e).eq("id",r.id);if(t)throw t}else{console.log(`ðŸ“ Inserting new prompt: ${s.title}`);const{error:e}=await x.from("speaking_prompts").insert(i);if(e)throw e}}}else{const e=t[0],{data:s}=await x.from("speaking_prompts").select("id, audio_url").eq("test_id",k).eq("part_number",e.part_number).maybeSingle(),r={title:e.title,prompt_text:e.prompt_text,part_number:e.part_number,time_limit:e.time_limit,sample_answer:null,test_id:k,transcription:e.transcription||null,audio_url:e.audio_url||null,is_locked:!0};if(s){const t={...r,audio_url:void 0!==e.audio_url&&null!==e.audio_url?e.audio_url:s.audio_url||null};console.log("ðŸ”Š Saving audio_url for Part 2:",t.audio_url),console.log("ðŸ“ Updating existing Part 2 prompt");const{error:i}=await x.from("speaking_prompts").update(t).eq("id",s.id);if(i)throw i}else{console.log("ðŸ“ Inserting new Part 2 prompt");const{error:e}=await x.from("speaking_prompts").insert(r);if(e)throw e}}C({title:"Success",description:`Part ${e} saved successfully`}),T(!0),D(!1)}catch(t){console.error("Error saving part:",t),C({title:"Error",description:`Failed to save Part ${e}`,variant:"destructive"})}finally{q(!1)}};return r.jsx(g,{title:`${P||"IELTS Speaking Management"}`,children:r.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsxs(o,{variant:"outline",onClick:()=>S("/admin/ielts"),className:"rounded-xl",children:[r.jsx(v,{className:"w-4 h-4 mr-2"}),"Back to IELTS Admin"]}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold text-foreground",children:P?`${P} - Speaking Prompts`:"IELTS Speaking Prompts Management"}),r.jsxs("div",{className:"text-muted-foreground",children:["Manage speaking prompts for ",P?`test: ${P}`:"all IELTS tests"," ",L&&r.jsx(l,{variant:"secondary",className:"ml-2",children:"Locked"})]}),z&&r.jsx("div",{className:"text-sm text-blue-600 font-medium mt-1",children:M?r.jsxs("span",{className:"flex items-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),z]}):r.jsxs("span",{className:"text-green-600",children:["âœ“ ",z]})})]})]}),L&&!Q&&r.jsx(o,{onClick:async()=>{try{const{error:e}=await x.from("speaking_prompts").update({is_locked:!1}).eq("is_locked",!0);if(e)throw e;T(!1),D(!0),C({title:"Success",description:"Speaking prompts unlocked for modification"})}catch(e){console.error("Error unlocking prompts:",e),C({title:"Error",description:"Failed to unlock prompts",variant:"destructive"})}},variant:"outline",className:"rounded-xl",children:"Modify Prompts"})]}),r.jsxs(n,{className:"rounded-2xl border-light-border shadow-soft",children:[r.jsx(d,{children:r.jsx(c,{className:"text-lg",children:"Test Configuration"})}),r.jsxs(u,{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium",children:"Include Part 2 (Cue Card)"}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"Long turn presentation section"})]}),F?r.jsx(l,{variant:"secondary",children:"Enabled"}):r.jsxs(o,{size:"sm",variant:"outline",onClick:()=>O(!0),disabled:L&&!Q,children:[r.jsx(j,{className:"w-4 h-4 mr-1"}),"Add Part 2"]})]}),r.jsx(h,{}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium",children:"Include Part 3 (Discussion)"}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"Abstract discussion questions"})]}),J?r.jsx(l,{variant:"secondary",children:"Enabled"}):r.jsxs(o,{size:"sm",variant:"outline",onClick:()=>B(!0),disabled:L&&!Q,children:[r.jsx(j,{className:"w-4 h-4 mr-1"}),"Add Part 3"]})]})]})]}),r.jsxs(n,{className:"rounded-2xl border-light-border shadow-soft",children:[r.jsx(d,{children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"p-2 rounded-lg bg-blue-100",children:r.jsx(f,{className:"w-5 h-5 text-blue-600"})}),r.jsxs("div",{children:[r.jsx(c,{className:"text-xl",children:"Part 1: Interview"}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"Personal questions (4-5 minutes total)"})]})]}),r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("label",{className:"text-sm font-medium",children:"Questions:"}),r.jsx(m,{type:"number",min:"1",max:"6",value:Y,onChange:e=>(e=>{Z(e);const t=Array.from({length:e},(e,t)=>W[t]||{title:`Interview Question ${t+1}`,prompt_text:"Audio prompt",part_number:1,time_limit:2,transcription:""});X(t)})(parseInt(e.target.value)||1),className:"w-16 h-8 text-center rounded-xl"})]}),r.jsxs(o,{onClick:()=>le(1),disabled:$||L&&!Q,className:"rounded-xl",children:[r.jsx(_,{className:"w-4 h-4 mr-2"}),"Save Part 1"]})]})]})}),r.jsx(u,{className:"space-y-4",children:W.map((e,t)=>r.jsx(n,{className:"border-light-border bg-white/50",children:r.jsxs(u,{className:"p-4 space-y-3",onDragOver:ae,onDrop:e=>oe(e,1,t),children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs(l,{variant:"outline",children:["Audio Question ",t+1]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("input",{type:"file",accept:"audio/*",onChange:e=>{var s;const r=null==(s=e.target.files)?void 0:s[0];r&&re(r,1,t)},className:"hidden",id:`audio-part1-${t}`}),r.jsxs(o,{variant:"outline",size:"sm",onClick:()=>{var e;return null==(e=document.getElementById(`audio-part1-${t}`))?void 0:e.click()},disabled:L&&!Q,className:"rounded-xl",children:[r.jsx(b,{className:"w-4 h-4 mr-2"}),"Upload Audio"]})]})]}),e.audio_url?r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[r.jsxs("div",{className:"flex items-center space-x-2 text-sm text-green-600",children:[r.jsx(f,{className:"w-4 h-4"}),r.jsx("span",{children:"Audio uploaded successfully"})]}),r.jsx(o,{variant:"outline",size:"sm",onClick:()=>ie(1,t),disabled:L&&!Q,className:"text-red-600 border-red-200 hover:bg-red-50",children:"Remove"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("audio",{controls:!0,className:"w-full",preload:"none",onError:t=>{var s,r,i,a,o,l,n;console.error("âŒ Audio playback error:",{url:e.audio_url,error:(null==(s=t.target.error)?void 0:s.message)||"Unknown error"});const d=t.target;if(4===(null==(r=d.error)?void 0:r.code)||(null==(a=null==(i=d.error)?void 0:i.message)?void 0:a.includes("SSL"))||(null==(l=null==(o=d.error)?void 0:o.message)?void 0:l.includes("cipher"))){d.style.display="none";const e=null==(n=d.parentElement)?void 0:n.querySelector(".audio-error");e&&(e.textContent="Audio file unavailable (SSL compatibility issue)")}},onLoadedMetadata:()=>console.log("âœ… Audio metadata loaded:",e.audio_url),children:[r.jsx("source",{src:e.audio_url,type:"audio/wav"}),r.jsx("source",{src:e.audio_url,type:"audio/mpeg"}),r.jsx("source",{src:e.audio_url,type:"audio/mp3"}),"Your browser does not support the audio element."]}),r.jsxs("p",{className:"text-xs text-gray-500 break-all audio-error",children:["URL: ",e.audio_url]})]})]}):r.jsxs("div",{className:"text-center py-6 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-400 transition-colors",children:[r.jsx(f,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Upload audio for this question"}),r.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"or drag & drop an audio file here"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-sm font-medium text-foreground",children:"Question Transcription"}),r.jsx(p,{placeholder:"Enter the exact text of the audio question...",value:e.transcription||"",onChange:e=>{const s=[...W];s[t].transcription=e.target.value,X(s)},disabled:L&&!Q,className:"rounded-xl min-h-[80px]"})]})]})},t))})]}),F&&r.jsxs(n,{className:"rounded-2xl border-light-border shadow-soft",children:[r.jsx(d,{children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"p-2 rounded-lg bg-green-100",children:r.jsx(N,{className:"w-5 h-5 text-green-600"})}),r.jsxs("div",{children:[r.jsx(c,{className:"text-xl",children:"Part 2: Long Turn / Cue Card"}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"Individual presentation (3-4 minutes)"})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs(o,{variant:"ghost",size:"sm",onClick:()=>O(!1),disabled:L&&!Q,className:"text-red-600 hover:text-red-700",children:[r.jsx(y,{className:"w-4 h-4 mr-1"}),"Remove"]}),r.jsxs(o,{onClick:()=>le(2),disabled:$||L&&!Q,className:"rounded-xl",children:[r.jsx(_,{className:"w-4 h-4 mr-2"}),"Save Part 2"]})]})]})}),r.jsx(u,{children:r.jsx(n,{className:"border-light-border bg-white/50",children:r.jsxs(u,{className:"p-4 space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx(l,{variant:"outline",children:"Cue Card"}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(w,{className:"w-4 h-4"}),r.jsx(m,{type:"number",value:V.time_limit,onChange:e=>H(t=>({...t,time_limit:parseInt(e.target.value)||3})),className:"w-16 h-8 text-center rounded-xl"}),r.jsx("span",{className:"text-sm",children:"minutes"})]})]}),r.jsx(p,{placeholder:"Cue card text (e.g., 'Describe a place you would like to visit...')",value:V.prompt_text,onChange:e=>H(t=>({...t,prompt_text:e.target.value})),disabled:L&&!Q,className:"rounded-xl min-h-[120px]"})]})})})]}),J&&r.jsxs(n,{className:"rounded-2xl border-light-border shadow-soft",children:[r.jsx(d,{children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"p-2 rounded-lg bg-purple-100",children:r.jsx(f,{className:"w-5 h-5 text-purple-600"})}),r.jsxs("div",{children:[r.jsx(c,{className:"text-xl",children:"Part 3: Discussion"}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"Abstract discussion questions (4-5 minutes)"})]})]}),r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("label",{className:"text-sm font-medium",children:"Questions:"}),r.jsx(m,{type:"number",min:"1",max:"6",value:G,onChange:e=>(e=>{K(e);const t=Array.from({length:e},(e,t)=>ee[t]||{title:`Discussion Question ${t+1}`,prompt_text:"Audio prompt",part_number:3,time_limit:2,transcription:""});te(t)})(parseInt(e.target.value)||1),className:"w-16 h-8 text-center rounded-xl"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs(o,{variant:"ghost",size:"sm",onClick:()=>B(!1),disabled:L&&!Q,className:"text-red-600 hover:text-red-700",children:[r.jsx(y,{className:"w-4 h-4 mr-1"}),"Remove"]}),r.jsxs(o,{onClick:()=>le(3),disabled:$||L&&!Q,className:"rounded-xl",children:[r.jsx(_,{className:"w-4 h-4 mr-2"}),"Save Part 3"]})]})]})]})}),r.jsx(u,{className:"space-y-4",children:ee.map((e,t)=>r.jsx(n,{className:"border-light-border bg-white/50",children:r.jsxs(u,{className:"p-4 space-y-3",onDragOver:ae,onDrop:e=>oe(e,3,t),children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs(l,{variant:"outline",children:["Audio Question ",t+1]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("input",{type:"file",accept:"audio/*",onChange:e=>{var s;const r=null==(s=e.target.files)?void 0:s[0];r&&re(r,3,t)},className:"hidden",id:`audio-part3-${t}`}),r.jsxs(o,{variant:"outline",size:"sm",onClick:()=>{var e;return null==(e=document.getElementById(`audio-part3-${t}`))?void 0:e.click()},disabled:L&&!Q,className:"rounded-xl",children:[r.jsx(b,{className:"w-4 h-4 mr-2"}),"Upload Audio"]})]})]}),e.audio_url?r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[r.jsxs("div",{className:"flex items-center space-x-2 text-sm text-green-600",children:[r.jsx(f,{className:"w-4 h-4"}),r.jsx("span",{children:"Audio uploaded successfully"})]}),r.jsx(o,{variant:"outline",size:"sm",onClick:()=>ie(3,t),disabled:L&&!Q,className:"text-red-600 border-red-200 hover:bg-red-50",children:"Remove"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("audio",{controls:!0,className:"w-full",preload:"none",onError:t=>{var s,r,i,a,o,l,n;console.error("âŒ Audio playback error:",{url:e.audio_url,error:(null==(s=t.target.error)?void 0:s.message)||"Unknown error"});const d=t.target;if(4===(null==(r=d.error)?void 0:r.code)||(null==(a=null==(i=d.error)?void 0:i.message)?void 0:a.includes("SSL"))||(null==(l=null==(o=d.error)?void 0:o.message)?void 0:l.includes("cipher"))){d.style.display="none";const e=null==(n=d.parentElement)?void 0:n.querySelector(".audio-error");e&&(e.textContent="Audio file unavailable (SSL compatibility issue)")}},onLoadedMetadata:()=>console.log("âœ… Audio metadata loaded:",e.audio_url),children:[r.jsx("source",{src:e.audio_url,type:"audio/wav"}),r.jsx("source",{src:e.audio_url,type:"audio/mpeg"}),r.jsx("source",{src:e.audio_url,type:"audio/mp3"}),"Your browser does not support the audio element."]}),r.jsxs("p",{className:"text-xs text-gray-500 break-all audio-error",children:["URL: ",e.audio_url]})]})]}):r.jsxs("div",{className:"text-center py-6 border-2 border-dashed border-gray-300 rounded-lg hover:border-purple-400 transition-colors",children:[r.jsx(f,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Upload audio for this question"}),r.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"or drag & drop an audio file here"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-sm font-medium text-foreground",children:"Question Transcription"}),r.jsx(p,{placeholder:"Enter the exact text of the audio question...",value:e.transcription||"",onChange:e=>{const s=[...ee];s[t].transcription=e.target.value,te(s)},disabled:L&&!Q,className:"rounded-xl min-h-[80px]"})]})]})},t))})]})]})})};export{k as default};
