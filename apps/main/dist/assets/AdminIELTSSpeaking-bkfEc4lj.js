import{ak as e,u as t,f as s,g as r,r as i,j as a,B as l,_ as o,k as n,C as d,b as c,c as u,a as m,P as p,M as x,I as h,T as g,X as v,$ as j}from"./index-CclrDLeN.js";import{S as f}from"./separator-BxoL2RFq.js";import{A as _}from"./AdminLayout-BcK_Lo4k.js";import{s as b}from"./supabase-DUkWVuqu.js";import{S as N}from"./save-BCyOdw1X.js";import{U as y}from"./upload-D6HU0Pzn.js";import{F as w}from"./file-text-DcBxfK9M.js";const k=()=>{const{testId:k}=e(),S=t(),{uploadAudio:A,loading:I}=s(),{toast:C}=r(),[P,E]=i.useState(""),[$,q]=i.useState(!1),[L,T]=i.useState(!1),[Q,D]=i.useState(!1),[M,U]=i.useState(!0),[R,z]=i.useState("Loading test data..."),[F,O]=i.useState(!0),[J,B]=i.useState(!0),[Y,Z]=i.useState(4),[W,X]=i.useState([{title:"Interview Question 1",prompt_text:"Audio prompt",part_number:1,time_limit:2,transcription:""},{title:"Interview Question 2",prompt_text:"Audio prompt",part_number:1,time_limit:2,transcription:""},{title:"Interview Question 3",prompt_text:"Audio prompt",part_number:1,time_limit:2,transcription:""},{title:"Interview Question 4",prompt_text:"Audio prompt",part_number:1,time_limit:2,transcription:""}]),[H,V]=i.useState({title:"Cue Card",prompt_text:"",part_number:2,time_limit:3}),[G,K]=i.useState(4),[ee,te]=i.useState([{title:"Discussion Question 1",prompt_text:"Audio prompt",part_number:3,time_limit:2,transcription:""},{title:"Discussion Question 2",prompt_text:"Audio prompt",part_number:3,time_limit:2,transcription:""},{title:"Discussion Question 3",prompt_text:"Audio prompt",part_number:3,time_limit:2,transcription:""},{title:"Discussion Question 4",prompt_text:"Audio prompt",part_number:3,time_limit:2,transcription:""}]);i.useEffect(()=>{se()},[k]);const se=async()=>{if(k)try{console.log("ðŸ“ Loading speaking test data for testId:",k),U(!0),z("Loading test data...");const e="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN1dW14bWZ6aHdsanlsYmRsZmxqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM1MTkxMjEsImV4cCI6MjA2OTA5NTEyMX0.8jqO_ciOttSxSLZnKY0i5oJmEn79ROF53TjUMYhNemI",t="https://cuumxmfzhwljylbdlflj.supabase.co",s=new AbortController,r=setTimeout(()=>s.abort(),1e4);try{console.log("ðŸ“ Fetching speaking test details via REST API...");const r=await fetch(`${t}/rest/v1/tests?id=eq.${k}&select=*`,{headers:{apikey:e,Authorization:`Bearer ${e}`,"Content-Type":"application/json"},signal:s.signal});if(r.ok){const e=await r.json(),t=null==e?void 0:e[0];t&&(console.log("âœ… Test loaded:",t.test_name),E(t.test_name))}console.log("ðŸ“ Fetching speaking prompts via REST API...");const i=await fetch(`${t}/rest/v1/speaking_prompts?test_id=eq.${k}&select=*&order=part_number.asc,title.asc`,{headers:{apikey:e,Authorization:`Bearer ${e}`,"Content-Type":"application/json"},signal:s.signal});if(i.ok){const e=await i.json();if(console.log("âœ… Speaking prompts loaded:",(null==e?void 0:e.length)||0),console.log("ðŸ“ Prompts by part:",{part1:e.filter(e=>1===e.part_number).length,part2:e.filter(e=>2===e.part_number).length,part3:e.filter(e=>3===e.part_number).length}),e.forEach((e,t)=>{console.log(`  Prompt ${t+1}: Part ${e.part_number} - ${e.title} (ID: ${e.id})`)}),e&&e.length>0){const t=e.some(e=>e.is_locked);T(t);const s=e.filter(e=>1===e.part_number),r=e.filter(e=>2===e.part_number),i=e.filter(e=>3===e.part_number);if(s.length>0){const e=s.sort((e,t)=>{var s,r;return parseInt((null==(s=e.title.match(/(\d+)/))?void 0:s[1])||"0")-parseInt((null==(r=t.title.match(/(\d+)/))?void 0:r[1])||"0")});console.log("ðŸ“ Loading part 1 prompts:",e.length,"questions"),e.forEach((e,t)=>console.log(`  Part 1 Q${t+1}:`,e.title,e.id)),Z(Math.max(e.length,1));const t=Array.from({length:Math.max(e.length,1)},(t,s)=>e[s]||W[s]||{title:`Interview Question ${s+1}`,prompt_text:"Audio prompt",part_number:1,time_limit:2,transcription:""});X(t)}if(r.length>0?(V(r[0]),O(!0)):O(!1),i.length>0){const e=i.sort((e,t)=>{var s,r;return parseInt((null==(s=e.title.match(/(\d+)/))?void 0:s[1])||"0")-parseInt((null==(r=t.title.match(/(\d+)/))?void 0:r[1])||"0")});console.log("ðŸ“ Loading part 3 prompts:",e.length,"questions"),e.forEach((e,t)=>console.log(`  Part 3 Q${t+1}:`,e.title,e.id));const t=[...ee];e.forEach((e,s)=>{s<t.length?t[s]={...t[s],...e,id:e.id}:t.push(e)}),te(t),K(Math.max(e.length,1)),B(!0),console.log("ðŸ“ Final part 3 setup:",t.length,"questions displayed")}else B(!1)}}console.log("âœ… Speaking test data loading complete"),U(!1),z("Test data loading complete"),setTimeout(()=>z(""),3e3)}finally{clearTimeout(r)}}catch(e){console.error("âŒ Error loading speaking test data:",e),U(!1),z("Failed to load test data"),C({title:"Error",description:"Failed to load test data",variant:"destructive"})}},re=async(e,t,s)=>{try{const i=await A(e);if(i.success){console.log("ðŸŽµ Audio URL received:",i.url);try{const e=await fetch(i.url,{method:"HEAD"});console.log("âœ… Audio URL accessible:",e.status,e.headers.get("content-type"))}catch(r){console.error("âŒ Audio URL not accessible:",r),C({title:"Warning",description:"Audio uploaded but may not be publicly accessible. Check R2 bucket settings.",variant:"destructive"})}if(1===t&&void 0!==s){const e=[...W];e[s].audio_url=i.url,X(e)}else if(2===t)V(e=>({...e,audio_url:i.url}));else if(3===t&&void 0!==s){const e=[...ee];e[s].audio_url=i.url,te(e)}C({title:"Success",description:"Audio uploaded successfully"})}}catch(i){console.error("Upload error:",i),C({title:"Error",description:"Failed to upload audio",variant:"destructive"})}},ie=(e,t)=>{if(1===e&&void 0!==t){const e=[...W];e[t].audio_url=void 0,X(e)}else if(2===e)V(e=>({...e,audio_url:void 0}));else if(3===e&&void 0!==t){const e=[...ee];e[t].audio_url=void 0,te(e)}C({title:"Success",description:"Audio removed"})},ae=e=>{e.preventDefault(),e.stopPropagation()},le=async(e,t,s)=>{if(e.preventDefault(),e.stopPropagation(),L&&!Q)return;const r=Array.from(e.dataTransfer.files).find(e=>e.type.startsWith("audio/"));r?await re(r,t,s):C({title:"Invalid file",description:"Please drop an audio file",variant:"destructive"})},oe=async e=>{q(!0);try{let t=[];if(console.log(`ðŸ”„ Saving Part ${e}...`),1===e)t=W.map((e,t)=>({...e,title:`Interview Question ${t+1}`,prompt_text:e.prompt_text||"Audio prompt",part_number:1,time_limit:e.time_limit||2,audio_url:e.audio_url||void 0,transcription:e.transcription||void 0})),console.log("ðŸ“ Part 1 prompts to save:",t.map(e=>({title:e.title,has_audio:!!e.audio_url,audio_url:e.audio_url})));else if(2===e){if(!F){const{error:e}=await b.from("speaking_prompts").delete().eq("test_id",k).eq("part_number",2);if(e)throw e;return void C({title:"Success",description:"Part 2 removed successfully"})}H.prompt_text.trim()&&(t=[H])}else if(3===e){if(!J){const{error:e}=await b.from("speaking_prompts").delete().eq("test_id",k).eq("part_number",3);if(e)throw e;return void C({title:"Success",description:"Part 3 removed successfully"})}t=ee.map((e,t)=>({...e,title:`Discussion Question ${t+1}`,prompt_text:e.prompt_text||"Audio prompt",part_number:3,time_limit:e.time_limit||2,audio_url:e.audio_url||void 0,transcription:e.transcription||void 0})),console.log("ðŸ“ Part 3 prompts to save:",t.map(e=>({title:e.title,has_audio:!!e.audio_url,audio_url:e.audio_url})))}if(t.length>0)if(console.log(`ðŸ’¾ Processing ${t.length} prompts...`),1===e||3===e){for(let e=0;e<t.length;e++){const s=t[e],{data:r}=await b.from("speaking_prompts").select("id, audio_url").eq("test_id",k).eq("part_number",s.part_number).eq("title",s.title).maybeSingle(),i={title:s.title,prompt_text:s.prompt_text,part_number:s.part_number,time_limit:s.time_limit,sample_answer:null,test_id:k,transcription:s.transcription||null,audio_url:s.audio_url||null,is_locked:!0};if(r){const e={...i,audio_url:void 0!==s.audio_url&&null!==s.audio_url?s.audio_url:r.audio_url||null};console.log(`ðŸ”Š Saving audio_url for ${s.title}:`,e.audio_url),console.log(`ðŸ“ Updating existing prompt: ${s.title}`);const{error:t}=await b.from("speaking_prompts").update(e).eq("id",r.id);if(t)throw t}else{console.log(`ðŸ“ Inserting new prompt: ${s.title}`);const{error:e}=await b.from("speaking_prompts").insert(i);if(e)throw e}}}else{const e=t[0],{data:s}=await b.from("speaking_prompts").select("id, audio_url").eq("test_id",k).eq("part_number",e.part_number).maybeSingle(),r={title:e.title,prompt_text:e.prompt_text,part_number:e.part_number,time_limit:e.time_limit,sample_answer:null,test_id:k,transcription:e.transcription||null,audio_url:e.audio_url||null,is_locked:!0};if(s){const t={...r,audio_url:void 0!==e.audio_url&&null!==e.audio_url?e.audio_url:s.audio_url||null};console.log("ðŸ”Š Saving audio_url for Part 2:",t.audio_url),console.log("ðŸ“ Updating existing Part 2 prompt");const{error:i}=await b.from("speaking_prompts").update(t).eq("id",s.id);if(i)throw i}else{console.log("ðŸ“ Inserting new Part 2 prompt");const{error:e}=await b.from("speaking_prompts").insert(r);if(e)throw e}}C({title:"Success",description:`Part ${e} saved successfully`}),T(!0),D(!1)}catch(t){console.error("Error saving part:",t),C({title:"Error",description:`Failed to save Part ${e}`,variant:"destructive"})}finally{q(!1)}};return a.jsx(_,{title:`${P||"IELTS Speaking Management"}`,children:a.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsxs(l,{variant:"outline",onClick:()=>S("/admin/ielts"),className:"rounded-xl",children:[a.jsx(o,{className:"w-4 h-4 mr-2"}),"Back to IELTS Admin"]}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-foreground",children:P?`${P} - Speaking Prompts`:"IELTS Speaking Prompts Management"}),a.jsxs("div",{className:"text-muted-foreground",children:["Manage speaking prompts for ",P?`test: ${P}`:"all IELTS tests"," ",L&&a.jsx(n,{variant:"secondary",className:"ml-2",children:"Locked"})]}),R&&a.jsx("div",{className:"text-sm text-blue-600 font-medium mt-1",children:M?a.jsxs("span",{className:"flex items-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),R]}):a.jsxs("span",{className:"text-green-600",children:["âœ“ ",R]})})]})]}),L&&!Q&&a.jsx(l,{onClick:async()=>{try{const{error:e}=await b.from("speaking_prompts").update({is_locked:!1}).eq("is_locked",!0);if(e)throw e;T(!1),D(!0),C({title:"Success",description:"Speaking prompts unlocked for modification"})}catch(e){console.error("Error unlocking prompts:",e),C({title:"Error",description:"Failed to unlock prompts",variant:"destructive"})}},variant:"outline",className:"rounded-xl",children:"Modify Prompts"})]}),a.jsxs(d,{className:"rounded-2xl border-light-border shadow-soft",children:[a.jsx(c,{children:a.jsx(u,{className:"text-lg",children:"Test Configuration"})}),a.jsxs(m,{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Include Part 2 (Cue Card)"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Long turn presentation section"})]}),F?a.jsx(n,{variant:"secondary",children:"Enabled"}):a.jsxs(l,{size:"sm",variant:"outline",onClick:()=>O(!0),disabled:L&&!Q,children:[a.jsx(p,{className:"w-4 h-4 mr-1"}),"Add Part 2"]})]}),a.jsx(f,{}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Include Part 3 (Discussion)"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Abstract discussion questions"})]}),J?a.jsx(n,{variant:"secondary",children:"Enabled"}):a.jsxs(l,{size:"sm",variant:"outline",onClick:()=>B(!0),disabled:L&&!Q,children:[a.jsx(p,{className:"w-4 h-4 mr-1"}),"Add Part 3"]})]})]})]}),a.jsxs(d,{className:"rounded-2xl border-light-border shadow-soft",children:[a.jsx(c,{children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"p-2 rounded-lg bg-blue-100",children:a.jsx(x,{className:"w-5 h-5 text-blue-600"})}),a.jsxs("div",{children:[a.jsx(u,{className:"text-xl",children:"Part 1: Interview"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Personal questions (4-5 minutes total)"})]})]}),a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("label",{className:"text-sm font-medium",children:"Questions:"}),a.jsx(h,{type:"number",min:"1",max:"6",value:Y,onChange:e=>(e=>{Z(e);const t=Array.from({length:e},(e,t)=>W[t]||{title:`Interview Question ${t+1}`,prompt_text:"Audio prompt",part_number:1,time_limit:2,transcription:""});X(t)})(parseInt(e.target.value)||1),className:"w-16 h-8 text-center rounded-xl"})]}),a.jsxs(l,{onClick:()=>oe(1),disabled:$||L&&!Q,className:"rounded-xl",children:[a.jsx(N,{className:"w-4 h-4 mr-2"}),"Save Part 1"]})]})]})}),a.jsx(m,{className:"space-y-4",children:W.map((e,t)=>a.jsx(d,{className:"border-light-border bg-white/50",children:a.jsxs(m,{className:"p-4 space-y-3",onDragOver:ae,onDrop:e=>le(e,1,t),children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs(n,{variant:"outline",children:["Audio Question ",t+1]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("input",{type:"file",accept:"audio/*",onChange:e=>{var s;const r=null==(s=e.target.files)?void 0:s[0];r&&re(r,1,t)},className:"hidden",id:`audio-part1-${t}`}),a.jsxs(l,{variant:"outline",size:"sm",onClick:()=>{var e;return null==(e=document.getElementById(`audio-part1-${t}`))?void 0:e.click()},disabled:L&&!Q,className:"rounded-xl",children:[a.jsx(y,{className:"w-4 h-4 mr-2"}),"Upload Audio"]})]})]}),e.audio_url?a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[a.jsxs("div",{className:"flex items-center space-x-2 text-sm text-green-600",children:[a.jsx(x,{className:"w-4 h-4"}),a.jsx("span",{children:"Audio uploaded successfully"})]}),a.jsx(l,{variant:"outline",size:"sm",onClick:()=>ie(1,t),disabled:L&&!Q,className:"text-red-600 border-red-200 hover:bg-red-50",children:"Remove"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("audio",{controls:!0,className:"w-full",preload:"none",onError:t=>{var s,r,i,a,l,o,n;console.error("âŒ Audio playback error:",{url:e.audio_url,error:(null==(s=t.target.error)?void 0:s.message)||"Unknown error"});const d=t.target;if(4===(null==(r=d.error)?void 0:r.code)||(null==(a=null==(i=d.error)?void 0:i.message)?void 0:a.includes("SSL"))||(null==(o=null==(l=d.error)?void 0:l.message)?void 0:o.includes("cipher"))){d.style.display="none";const e=null==(n=d.parentElement)?void 0:n.querySelector(".audio-error");e&&(e.textContent="Audio file unavailable (SSL compatibility issue)")}},onLoadedMetadata:()=>console.log("âœ… Audio metadata loaded:",e.audio_url),children:[a.jsx("source",{src:e.audio_url,type:"audio/wav"}),a.jsx("source",{src:e.audio_url,type:"audio/mpeg"}),a.jsx("source",{src:e.audio_url,type:"audio/mp3"}),"Your browser does not support the audio element."]}),a.jsxs("p",{className:"text-xs text-gray-500 break-all audio-error",children:["URL: ",e.audio_url]})]})]}):a.jsxs("div",{className:"text-center py-6 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-400 transition-colors",children:[a.jsx(x,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Upload audio for this question"}),a.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"or drag & drop an audio file here"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium text-foreground",children:"Question Transcription"}),a.jsx(g,{placeholder:"Enter the exact text of the audio question...",value:e.transcription||"",onChange:e=>{const s=[...W];s[t].transcription=e.target.value,X(s)},disabled:L&&!Q,className:"rounded-xl min-h-[80px]"})]})]})},t))})]}),F&&a.jsxs(d,{className:"rounded-2xl border-light-border shadow-soft",children:[a.jsx(c,{children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"p-2 rounded-lg bg-green-100",children:a.jsx(w,{className:"w-5 h-5 text-green-600"})}),a.jsxs("div",{children:[a.jsx(u,{className:"text-xl",children:"Part 2: Long Turn / Cue Card"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Individual presentation (3-4 minutes)"})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs(l,{variant:"ghost",size:"sm",onClick:()=>O(!1),disabled:L&&!Q,className:"text-red-600 hover:text-red-700",children:[a.jsx(v,{className:"w-4 h-4 mr-1"}),"Remove"]}),a.jsxs(l,{onClick:()=>oe(2),disabled:$||L&&!Q,className:"rounded-xl",children:[a.jsx(N,{className:"w-4 h-4 mr-2"}),"Save Part 2"]})]})]})}),a.jsx(m,{children:a.jsx(d,{className:"border-light-border bg-white/50",children:a.jsxs(m,{className:"p-4 space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(n,{variant:"outline",children:"Cue Card"}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(j,{className:"w-4 h-4"}),a.jsx(h,{type:"number",value:H.time_limit,onChange:e=>V(t=>({...t,time_limit:parseInt(e.target.value)||3})),className:"w-16 h-8 text-center rounded-xl"}),a.jsx("span",{className:"text-sm",children:"minutes"})]})]}),a.jsx(g,{placeholder:"Cue card text (e.g., 'Describe a place you would like to visit...')",value:H.prompt_text,onChange:e=>V(t=>({...t,prompt_text:e.target.value})),disabled:L&&!Q,className:"rounded-xl min-h-[120px]"})]})})})]}),J&&a.jsxs(d,{className:"rounded-2xl border-light-border shadow-soft",children:[a.jsx(c,{children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"p-2 rounded-lg bg-purple-100",children:a.jsx(x,{className:"w-5 h-5 text-purple-600"})}),a.jsxs("div",{children:[a.jsx(u,{className:"text-xl",children:"Part 3: Discussion"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Abstract discussion questions (4-5 minutes)"})]})]}),a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("label",{className:"text-sm font-medium",children:"Questions:"}),a.jsx(h,{type:"number",min:"1",max:"6",value:G,onChange:e=>(e=>{K(e);const t=Array.from({length:e},(e,t)=>ee[t]||{title:`Discussion Question ${t+1}`,prompt_text:"Audio prompt",part_number:3,time_limit:2,transcription:""});te(t)})(parseInt(e.target.value)||1),className:"w-16 h-8 text-center rounded-xl"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs(l,{variant:"ghost",size:"sm",onClick:()=>B(!1),disabled:L&&!Q,className:"text-red-600 hover:text-red-700",children:[a.jsx(v,{className:"w-4 h-4 mr-1"}),"Remove"]}),a.jsxs(l,{onClick:()=>oe(3),disabled:$||L&&!Q,className:"rounded-xl",children:[a.jsx(N,{className:"w-4 h-4 mr-2"}),"Save Part 3"]})]})]})]})}),a.jsx(m,{className:"space-y-4",children:ee.map((e,t)=>a.jsx(d,{className:"border-light-border bg-white/50",children:a.jsxs(m,{className:"p-4 space-y-3",onDragOver:ae,onDrop:e=>le(e,3,t),children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs(n,{variant:"outline",children:["Audio Question ",t+1]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("input",{type:"file",accept:"audio/*",onChange:e=>{var s;const r=null==(s=e.target.files)?void 0:s[0];r&&re(r,3,t)},className:"hidden",id:`audio-part3-${t}`}),a.jsxs(l,{variant:"outline",size:"sm",onClick:()=>{var e;return null==(e=document.getElementById(`audio-part3-${t}`))?void 0:e.click()},disabled:L&&!Q,className:"rounded-xl",children:[a.jsx(y,{className:"w-4 h-4 mr-2"}),"Upload Audio"]})]})]}),e.audio_url?a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[a.jsxs("div",{className:"flex items-center space-x-2 text-sm text-green-600",children:[a.jsx(x,{className:"w-4 h-4"}),a.jsx("span",{children:"Audio uploaded successfully"})]}),a.jsx(l,{variant:"outline",size:"sm",onClick:()=>ie(3,t),disabled:L&&!Q,className:"text-red-600 border-red-200 hover:bg-red-50",children:"Remove"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("audio",{controls:!0,className:"w-full",preload:"none",onError:t=>{var s,r,i,a,l,o,n;console.error("âŒ Audio playback error:",{url:e.audio_url,error:(null==(s=t.target.error)?void 0:s.message)||"Unknown error"});const d=t.target;if(4===(null==(r=d.error)?void 0:r.code)||(null==(a=null==(i=d.error)?void 0:i.message)?void 0:a.includes("SSL"))||(null==(o=null==(l=d.error)?void 0:l.message)?void 0:o.includes("cipher"))){d.style.display="none";const e=null==(n=d.parentElement)?void 0:n.querySelector(".audio-error");e&&(e.textContent="Audio file unavailable (SSL compatibility issue)")}},onLoadedMetadata:()=>console.log("âœ… Audio metadata loaded:",e.audio_url),children:[a.jsx("source",{src:e.audio_url,type:"audio/wav"}),a.jsx("source",{src:e.audio_url,type:"audio/mpeg"}),a.jsx("source",{src:e.audio_url,type:"audio/mp3"}),"Your browser does not support the audio element."]}),a.jsxs("p",{className:"text-xs text-gray-500 break-all audio-error",children:["URL: ",e.audio_url]})]})]}):a.jsxs("div",{className:"text-center py-6 border-2 border-dashed border-gray-300 rounded-lg hover:border-purple-400 transition-colors",children:[a.jsx(x,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Upload audio for this question"}),a.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"or drag & drop an audio file here"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium text-foreground",children:"Question Transcription"}),a.jsx(g,{placeholder:"Enter the exact text of the audio question...",value:e.transcription||"",onChange:e=>{const s=[...ee];s[t].transcription=e.target.value,te(s)},disabled:L&&!Q,className:"rounded-xl min-h-[80px]"})]})]})},t))})]})]})})};export{k as default};
