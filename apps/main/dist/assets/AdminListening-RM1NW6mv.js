import{r as e,j as s}from"./vendor-react-JN_hy__U.js";import{u as t,d as a,B as n,C as i,a as r,I as l,b as o,c,e as d,D as m,m as u,f as x,g as h,h as j,S as b,i as p,j as g,k as v,l as N,T as f,s as C}from"./index-DXpPY1B7.js";import{C as y,a as w,b as _}from"./collapsible-CWlZ7QcT.js";import{C as S}from"./CSVImport-BoWRa86L.js";import{A as k}from"./AdminLayout-D3lPYw5Y.js";import{aV as q,aW as A,h as I,aa as E,aw as L,av as P,aN as O}from"./vendor-ui-DG51EGkO.js";import"./vendor-react-dom-Cb-iy8Oc.js";import"./vendor-animation-ClPlB6zo.js";import"./vendor-i18n-DlHrixAm.js";import"./vendor-utils-D5HPTFR9.js";import"./vendor-supabase-D7XYLCUu.js";import"./vendor-charts-BpOKEG9Z.js";import"./vendor-date-DT7Rq6D9.js";import"./alert-BV1wokst.js";const T=()=>{const{listContent:T,createContent:U,deleteContent:F,updateContent:V,uploadAudio:$,loading:Q}=t(),{toast:z}=a(),[B,M]=e.useState({}),[D,R]=e.useState(""),[W,G]=e.useState(new Set),[H,J]=e.useState(!1),[K,X]=e.useState(20),[Y,Z]=e.useState(1),[ee,se]=e.useState(1),[te,ae]=e.useState(null),[ne,ie]=e.useState(""),[re,le]=e.useState(""),[oe,ce]=e.useState(!1),[de,me]=e.useState(""),[ue,xe]=e.useState(!1),he=e.useRef(null),je=e.useRef(null),[be,pe]=e.useState(!1);e.useEffect(()=>{ge()},[]);const ge=async()=>{try{const[e,s]=await Promise.all([T("listening_sections"),T("listening_questions")]),t=e.data||[],a=s.data||[],n={};for(let i=1;i<=20;i++){n[i]={number:i,sections:{}};for(let e=1;e<=4;e++){n[i].sections[e]={number:e,parts:{},hasContent:!1};for(let s=1;s<=4;s++)n[i].sections[e].parts[s]={number:s,section:null,questions:[],hasContent:!1}}}t.forEach(e=>{var s;const t=null==(s=e.cambridge_book)?void 0:s.match(/\d+/),a=t?parseInt(t[0]):1,i=e.section_number||1,r=e.part_number||1;n[a]&&n[a].sections[i]&&n[a].sections[i].parts[r]&&(n[a].sections[i].parts[r].section=e,n[a].sections[i].parts[r].hasContent=!0,n[a].sections[i].hasContent=!0)}),a.forEach(e=>{var s;if(e.section_id){const a=t.find(s=>s.id===e.section_id);if(a){const t=null==(s=a.cambridge_book)?void 0:s.match(/\d+/),i=t?parseInt(t[0]):1,r=a.section_number||1,l=a.part_number||1;n[i]&&n[i].sections[r]&&n[i].sections[r].parts[l]&&(n[i].sections[r].parts[l].questions.push(e),n[i].sections[r].parts[l].hasContent=!0,n[i].sections[r].hasContent=!0)}}else if(e.cambridge_book&&e.section_number){const s=e.cambridge_book.match(/\d+/),t=s?parseInt(s[0]):1,a=e.section_number,i=e.part_number||1;n[t]&&n[t].sections[a]&&n[t].sections[a].parts[i]&&(n[t].sections[a].parts[i].questions.push(e),n[t].sections[a].parts[i].hasContent=!0,n[t].sections[a].hasContent=!0)}}),M(n)}catch(e){z({title:"Error",description:"Failed to load Cambridge books structure",variant:"destructive"})}},ve=Object.values(B).filter(e=>{if(!D)return!0;const s=D.toLowerCase();return`cambridge ${e.number}`.includes(s)||Object.values(e.sections).some(e=>{var t,a;return null==(a=null==(t=e.section)?void 0:t.title)?void 0:a.toLowerCase().includes(s)})}).sort((e,s)=>s.number-e.number);return s.jsx(k,{title:"Cambridge IELTS Listening",children:s.jsxs("div",{className:"max-w-6xl mx-auto",children:[s.jsxs("div",{className:"flex justify-between items-center mb-8",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-4xl font-georgia font-bold text-foreground mb-2",children:"Cambridge IELTS Listening"}),s.jsx("p",{className:"text-warm-gray",children:"Manage listening content organized by Cambridge books 1-20"})]}),s.jsxs(n,{onClick:()=>J(!0),className:"rounded-xl",style:{background:"var(--gradient-button)",border:"none"},children:[s.jsx(q,{className:"w-4 h-4 mr-2"}),"Upload Content"]})]}),s.jsx(i,{className:"mb-6 rounded-2xl border-light-border",style:{background:"var(--gradient-card)"},children:s.jsx(r,{className:"p-4",children:s.jsxs("div",{className:"relative",children:[s.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-warm-gray w-4 h-4"}),s.jsx(l,{placeholder:"Search books or sections...",value:D,onChange:e=>R(e.target.value),className:"pl-10 rounded-xl border-light-border"})]})})}),s.jsx("div",{className:"space-y-4",children:ve.map(e=>s.jsx(i,{className:"rounded-2xl border-light-border shadow-soft",style:{background:"var(--gradient-card)"},children:s.jsxs(y,{open:W.has(e.number),onOpenChange:()=>(e=>{const s=new Set(W);s.has(e)?s.delete(e):s.add(e),G(s)})(e.number),children:[s.jsx(w,{asChild:!0,children:s.jsx(o,{className:"cursor-pointer hover:bg-white/50 transition-colors",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[W.has(e.number)?s.jsx(I,{className:"w-5 h-5"}):s.jsx(E,{className:"w-5 h-5"}),s.jsx(L,{className:"w-5 h-5"}),s.jsxs(c,{className:"text-xl font-georgia",children:["Cambridge IELTS ",e.number]})]}),s.jsx("div",{className:"flex gap-2",children:Object.values(e.sections).map(e=>s.jsxs(d,{variant:e.hasContent?"default":"outline",className:"text-xs",children:["S",e.number]},e.number))})]})})}),s.jsx(_,{children:s.jsx(r,{className:"pt-0",children:s.jsx("div",{className:"grid gap-4",children:Object.values(e.sections).map(t=>s.jsxs(i,{className:"border-light-border bg-white",children:[s.jsx(o,{className:"pb-3",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(L,{className:"w-4 h-4"}),s.jsxs("h4",{className:"font-medium",children:["Section ",t.number]}),t.hasContent&&s.jsxs(d,{variant:"outline",className:"text-xs",children:[Object.values(t.parts).reduce((e,s)=>e+s.questions.length,0)," questions"]})]}),s.jsx("div",{className:"flex gap-2",children:s.jsxs(n,{size:"sm",variant:"outline",onClick:()=>{X(e.number),Z(t.number),pe(!0)},className:"rounded-xl h-7 px-2 text-xs",children:[s.jsx(P,{className:"w-3 h-3 mr-1"}),"Add Part"]})})]})}),s.jsx(r,{children:s.jsx("div",{className:"space-y-4",children:Object.values(t.parts).map(a=>s.jsxs(i,{className:"border-light-border bg-gray-50",children:[s.jsx(o,{className:"pb-2",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("h5",{className:"text-sm font-medium",children:["Part ",a.number]}),a.hasContent&&s.jsxs(d,{variant:"outline",className:"text-xs",children:[a.questions.length," questions"]})]}),s.jsx("div",{className:"flex gap-2",children:a.hasContent&&s.jsxs(m,{children:[s.jsx(u,{asChild:!0,children:s.jsx(n,{size:"sm",variant:"outline",className:"rounded-xl h-6 px-2",children:s.jsx(O,{className:"w-3 h-3"})})}),s.jsxs(x,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[s.jsx(h,{children:s.jsxs(j,{children:["Cambridge ",e.number," - Section ",t.number," - Part ",a.number]})}),s.jsxs("div",{className:"space-y-6",children:[a.section&&s.jsxs(i,{className:"p-4",children:[s.jsx("h5",{className:"font-medium mb-3",children:"Listening Section"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h6",{className:"font-medium mb-2",children:"Instructions"}),s.jsx("p",{className:"text-sm",children:a.section.instructions})]}),a.section.audio_url&&s.jsxs("div",{children:[s.jsx("h6",{className:"font-medium mb-2",children:"Audio"}),s.jsx("audio",{controls:!0,className:"w-full",children:s.jsx("source",{src:a.section.audio_url,type:"audio/mpeg"})})]}),a.section.transcript&&s.jsxs("div",{children:[s.jsx("h6",{className:"font-medium mb-2",children:"Transcript"}),s.jsx("div",{className:"text-sm bg-gray-50 p-3 rounded-lg max-h-32 overflow-y-auto",children:a.section.transcript})]})]})]}),s.jsxs(i,{className:"p-4",children:[s.jsxs("h5",{className:"font-medium mb-3",children:["Questions (",a.questions.length,")"]}),s.jsx("div",{className:"space-y-4",children:a.questions.sort((e,s)=>parseInt(e.question_number)-parseInt(s.question_number)).map(e=>s.jsx("div",{className:"border-b border-light-border pb-4 last:border-b-0",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(d,{variant:"outline",children:e.question_number}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-medium mb-2",children:e.question_text}),e.options&&s.jsx("div",{className:"text-sm space-y-1 mb-2",children:Array.isArray(e.options)?e.options.map((t,a)=>s.jsxs("div",{className:"p-2 rounded "+(t===e.correct_answer?"bg-green-50 text-green-800 font-medium":"bg-gray-50"),children:[String.fromCharCode(65+a),". ",t]},a)):s.jsxs("div",{className:"bg-green-50 text-green-800 font-medium p-2 rounded",children:["Answer: ",e.correct_answer]})}),s.jsxs("p",{className:"text-sm text-warm-gray",children:[s.jsx("span",{className:"font-medium",children:"Explanation:"})," ",e.explanation]})]})]})},e.id))})]})]})]})]})})]})}),s.jsx(r,{className:"pt-0",children:a.hasContent?s.jsx("div",{className:"text-sm text-warm-gray",children:a.section?s.jsxs("p",{children:["Section: ",a.section.title]}):s.jsx("p",{children:"Questions without section"})}):s.jsxs("div",{className:"text-center py-4 text-warm-gray",children:[s.jsx(L,{className:"w-6 h-6 mx-auto mb-2 opacity-50"}),s.jsx("p",{className:"text-xs",children:"No content yet"})]})})]},a.number))})})]},t.number))})})})]})},e.number))}),s.jsx(m,{open:H,onOpenChange:J,children:s.jsxs(x,{className:"max-w-5xl max-h-[85vh] overflow-y-auto",children:[s.jsx(h,{children:s.jsxs(j,{children:["Upload Content to Cambridge ",K,", Section ",Y]})}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Cambridge Book"}),s.jsxs(b,{value:K.toString(),onValueChange:e=>X(parseInt(e)),children:[s.jsx(p,{className:"rounded-xl border-light-border",children:s.jsx(g,{})}),s.jsx(v,{className:"rounded-xl border-light-border bg-card",children:Array.from({length:20},(e,s)=>20-s).map(e=>s.jsxs(N,{value:e.toString(),children:["Cambridge ",e]},e))})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Section"}),s.jsxs(b,{value:Y.toString(),onValueChange:e=>Z(parseInt(e)),children:[s.jsx(p,{className:"rounded-xl border-light-border",children:s.jsx(g,{})}),s.jsx(v,{className:"rounded-xl border-light-border bg-card",children:Array.from({length:4},(e,s)=>s+1).map(e=>s.jsxs(N,{value:e.toString(),children:["Section ",e]},e))})]})]})]}),s.jsxs(i,{className:"rounded-2xl border-light-border",style:{background:"white"},children:[s.jsx(o,{children:s.jsxs(c,{className:"flex items-center gap-2 text-foreground",children:[s.jsx(L,{className:"w-5 h-5"}),"Listening Section"]})}),s.jsxs(r,{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Audio File"}),s.jsxs("div",{className:"flex gap-3 items-center",children:[s.jsx("input",{ref:he,type:"file",accept:"audio/*",onChange:async e=>{var s;const t=null==(s=e.target.files)?void 0:s[0];if(t){ce(!0);try{const e=await $(t);le(e.url),z({title:"Success",description:"Audio uploaded successfully"})}catch(a){z({title:"Error",description:"Failed to upload audio",variant:"destructive"})}finally{ce(!1)}}},className:"hidden"}),s.jsxs(n,{type:"button",variant:"outline",onClick:()=>{var e;return null==(e=he.current)?void 0:e.click()},disabled:oe,className:"rounded-xl border-light-border",children:[s.jsx(q,{className:"w-4 h-4 mr-2"}),oe?"Uploading...":"Upload Audio"]}),re&&s.jsx("span",{className:"text-sm text-green-600 font-medium",children:"Audio uploaded ✓"})]}),re&&s.jsx("audio",{controls:!0,className:"w-full mt-2",children:s.jsx("source",{src:re,type:"audio/mpeg"})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Photo (Optional - for visual questions)"}),s.jsxs("div",{className:"flex gap-3 items-center",children:[s.jsx("input",{ref:je,type:"file",accept:"image/*",onChange:async e=>{var s;const t=null==(s=e.target.files)?void 0:s[0];if(t){xe(!0);try{const e=`${Date.now()}-${t.name}`,{data:s,error:a}=await C.storage.from("audio-files").upload(e,t);if(a)throw a;const{data:n}=C.storage.from("audio-files").getPublicUrl(e);me(n.publicUrl),z({title:"Success",description:"Photo uploaded successfully"})}catch(a){z({title:"Error",description:"Failed to upload photo",variant:"destructive"})}finally{xe(!1)}}},className:"hidden"}),s.jsxs(n,{type:"button",variant:"outline",onClick:()=>{var e;return null==(e=je.current)?void 0:e.click()},disabled:ue,className:"rounded-xl border-light-border",children:[s.jsx(q,{className:"w-4 h-4 mr-2"}),ue?"Uploading...":"Upload Photo"]}),de&&s.jsx("span",{className:"text-sm text-green-600 font-medium",children:"Photo uploaded ✓"})]}),de&&s.jsx("img",{src:de,alt:"Listening question visual",className:"w-full max-w-md mt-2 rounded-lg border"})]}),s.jsx(f,{placeholder:"Audio transcript (optional, for admin reference)",value:ne,onChange:e=>ie(e.target.value),rows:6,className:"rounded-xl border-light-border font-mono text-sm"})]})]}),s.jsx(S,{onImport:async e=>{try{const s={transcript:ne,audio_url:re,photo_url:de,section_number:Y,part_number:ee,test_number:K,cambridge_book:`C${K}`},t=(await U("listening_sections",s)).data.id;for(let a=0;a<e.length;a++){const s=e[a],n={question_number:s.question_number||a+1,question_type:s.question_type||"multiple_choice",question_text:s.question_text||"",correct_answer:s.correct_answer||"",explanation:s.explanation||"",options:s.options||null,section_id:t};await U("listening_questions",n)}z({title:"Success",description:`Listening section uploaded to Cambridge ${K}, Section ${Y}`}),ie(""),le(""),me(""),J(!1),ge()}catch(s){z({title:"Error",description:s.message||"Failed to upload section",variant:"destructive"})}},type:"listening"})]})]})}),te&&s.jsx(m,{open:!!te,onOpenChange:()=>ae(null),children:s.jsxs(x,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[s.jsx(h,{children:s.jsxs(j,{children:["Edit Cambridge ",te.bookNumber," - Section ",te.number]})}),s.jsxs("div",{className:"space-y-6",children:[te.section&&s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Section Title"}),s.jsx(l,{value:te.section.title,onChange:e=>ae({...te,section:{...te.section,title:e.target.value}}),className:"mb-4"}),s.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Instructions"}),s.jsx(f,{value:te.section.instructions,onChange:e=>ae({...te,section:{...te.section,instructions:e.target.value}}),rows:3,className:"mb-4"}),s.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Transcript"}),s.jsx(f,{value:te.section.transcript,onChange:e=>ae({...te,section:{...te.section,transcript:e.target.value}}),rows:6,className:"mb-4"})]}),s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-4",children:"Questions"}),te.questions.map((e,t)=>s.jsx(i,{className:"p-4 mb-4",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Question Text"}),s.jsx(f,{value:e.question_text,onChange:e=>{const s={...te};s.questions[t].question_text=e.target.value,ae(s)},className:"mt-1"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Correct Answer"}),s.jsx(l,{value:e.correct_answer,onChange:e=>{const s={...te};s.questions[t].correct_answer=e.target.value,ae(s)},className:"mt-1"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Question Type"}),s.jsxs(b,{value:e.question_type,onValueChange:e=>{const s={...te};s.questions[t].question_type=e,ae(s)},children:[s.jsx(p,{className:"mt-1",children:s.jsx(g,{})}),s.jsxs(v,{children:[s.jsx(N,{value:"multiple_choice",children:"Multiple Choice"}),s.jsx(N,{value:"fill_in_blank",children:"Fill in the Blank"}),s.jsx(N,{value:"true_false",children:"True/False"}),s.jsx(N,{value:"matching",children:"Matching"})]})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Explanation"}),s.jsx(f,{value:e.explanation,onChange:e=>{const s={...te};s.questions[t].explanation=e.target.value,ae(s)},className:"mt-1"})]})]})},e.id))]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx(n,{onClick:async()=>{if(te)try{te.section&&await V("listening_sections",{id:te.section.id,title:te.section.title,instructions:te.section.instructions,transcript:te.section.transcript});for(const e of te.questions)await V("listening_questions",{id:e.id,question_text:e.question_text,correct_answer:e.correct_answer,explanation:e.explanation,options:e.options});z({title:"Success",description:"Section updated successfully"}),ae(null),ge()}catch(e){z({title:"Error",description:"Failed to update section",variant:"destructive"})}},disabled:Q,className:"rounded-xl",style:{background:"var(--gradient-button)",border:"none"},children:"Save Changes"}),s.jsx(n,{variant:"outline",onClick:()=>ae(null),className:"rounded-xl",children:"Cancel"})]})]})]})}),s.jsx(m,{open:be,onOpenChange:pe,children:s.jsxs(x,{className:"rounded-2xl bg-card max-w-md",children:[s.jsx(h,{children:s.jsxs(j,{className:"text-xl font-georgia font-bold text-foreground",children:["Add Part to Cambridge ",K," - Section ",Y]})}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Select Part"}),s.jsxs(b,{value:ee.toString(),onValueChange:e=>se(parseInt(e)),children:[s.jsx(p,{className:"rounded-xl border-light-border",children:s.jsx(g,{})}),s.jsx(v,{className:"rounded-xl border-light-border bg-card",children:[1,2,3,4].map(e=>s.jsxs(N,{value:e.toString(),children:["Part ",e]},e))})]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(n,{onClick:()=>{J(!0),pe(!1)},className:"flex-1 rounded-xl",style:{background:"var(--gradient-button)",border:"none"},children:"Upload Content"}),s.jsx(n,{variant:"outline",onClick:()=>pe(!1),className:"rounded-xl border-light-border",children:"Cancel"})]})]})]})})]})})};export{T as default};
