import{r as e,j as r,c as s}from"./vendor-react-JN_hy__U.js";import{A as t}from"./AdminLayout-D3lPYw5Y.js";import{C as n,b as i,c as a,a as o,B as l,J as c,s as d,P as u,I as m,D as h,f as p,g as x,h as g,L as w,T as f}from"./index-DXpPY1B7.js";import{S as j}from"./separator-Bv0Pudil.js";import{A as _,a as v}from"./alert-BV1wokst.js";import"./vendor-react-dom-Cb-iy8Oc.js";import"./vendor-animation-ClPlB6zo.js";import"./vendor-ui-DG51EGkO.js";import"./vendor-i18n-DlHrixAm.js";import"./vendor-utils-D5HPTFR9.js";import"./vendor-supabase-D7XYLCUu.js";import"./vendor-charts-BpOKEG9Z.js";import"./vendor-date-DT7Rq6D9.js";const y=["QuestionFormat","original_sentence","WordOrSentence","CorrectAnswer","IncorrectAnswer1","IncorrectAnswer2","IncorrectAnswer3","Explanation"];function N(e){return e.replace(/<[^>]*>/g,"")}function b(e){const r=[];let s="",t=!1;for(let n=0;n<e.length;n++){const i=e[n];'"'===i?t&&'"'===e[n+1]?(s+='"',n++):t=!t:","!==i||t?s+=i:(r.push(s),s="")}return r.push(s),r.map(e=>e.trim())}function C(e,r,s){const t=[],n=[],i=[];let a=(e||"").replace(/^\uFEFF/,"");a=function(e){return e.replace(/[\u201C\u201D]/g,'"').replace(/[\u2018\u2019]/g,"'")}(a),a=function(e){const r=e.split(/\r?\n/).find(e=>e.trim().length>0)||"",s=(r.match(/,/g)||[]).length;return(r.match(/;/g)||[]).length>0&&0===s?e.replace(/;/g,","):e}(a);const o=a.split(/\r?\n/).map(e=>e.trim()).filter(e=>e.length>0);if(0===o.length)return{ok:!1,skill_type:r,skill_test_id:s,insert:[],warnings:[],errors:[{row:0,message:`Missing headers. Expected: ${y.join(",")}`,raw:{}}],summary:{rows_received:0,rows_valid:0,rows_with_warnings:0,rows_with_errors:0}};const l=e=>e.replace(/[^a-z0-9]/gi,"").toLowerCase(),c={QuestionFormat:["format","type","qformat"],audio_url:["audio","audiourl","audiofile","file","filename","audiofilename","mp3"],original_sentence:["transcript","transcription","original","sentence","audiotranscript"],WordOrSentence:["instruction","prompt","question","questiontext","stem"],CorrectAnswer:["answer","correct","key"],IncorrectAnswer1:["incorrect1","wrong1","distractor1","option2","choiceb","b"],IncorrectAnswer2:["incorrect2","wrong2","distractor2","option3","choicec","c"],IncorrectAnswer3:["incorrect3","wrong3","distractor3","option4","choiced","d"],Explanation:["rationale","why","notes","feedback"]},d=b(o[0]).map(e=>e.replace(/^"|"$/g,"").trim()),u={};d.forEach((e,r)=>{u[l(e)]=r});const m=e=>{var r;const s=[l(e),...(null==(r=c[e])?void 0:r.map(l))||[]];for(const t of s)if(void 0!==u[t])return u[t]},h=[];if(y.forEach(e=>{void 0===m(e)&&h.push(e)}),h.length>0)return{ok:!1,skill_type:r,skill_test_id:s,insert:[],warnings:[],errors:[{row:0,message:`Missing required headers: ${h.join("; ")}. Expected: ${y.join(",")}`,raw:Object.fromEntries(d.map((e,r)=>[r.toString(),e]))}],summary:{rows_received:0,rows_valid:0,rows_with_warnings:0,rows_with_errors:0}};const p=o.slice(1);p.forEach((e,a)=>{const o=a+1,l=b(e),c=e=>{const r=m(e);return function(e,r=300){if(e.length<=r)return e;const s=e.slice(0,r),t=Math.max(s.lastIndexOf("."),s.lastIndexOf(","),s.lastIndexOf(";"),s.lastIndexOf(":"));return(t>60?s.slice(0,t):s).trim()}(function(e){return e.replace(/[\r\n]+/g," ").replace(/\s+/g," ").trim()}(N((void 0!==r?l[r]:"")||"")))},d=e=>{const r=m(e);return N((void 0!==r?l[r]:"")||"").replace(/\r?\n/g,"\n").trim()};let u=c("QuestionFormat");const h=c("audio_url"),p=d("original_sentence"),x=d("WordOrSentence"),g=c("CorrectAnswer"),w=c("IncorrectAnswer1"),f=c("IncorrectAnswer2"),j=c("IncorrectAnswer3"),_=c("Explanation"),v={QuestionFormat:u,audio_url:h,original_sentence:p,WordOrSentence:x,CorrectAnswer:g,IncorrectAnswer1:w,IncorrectAnswer2:f,IncorrectAnswer3:j,Explanation:_};if(!u||!x||!g)return void n.push({row:o,message:"Missing critical fields",raw:v});if("Listening_Dictation"!==u&&"Listening_MultipleChoice"!==u){const e=function(e){const r=e.replace(/[^a-z]/gi,"").toLowerCase();return["listeningdictation","dictation","listening_shortanswer"].includes(r)?"Listening_Dictation":["listeningmultiplechoice","listeningmcq","comprehension"].includes(r)?"Listening_MultipleChoice":null}(u);if(!e)return void n.push({row:o,message:`Unrecognized QuestionFormat: ${u}`,raw:v});u=e,t.push({row:o,message:`Corrected QuestionFormat to ${e}`})}const y=x,C=g,k=[w,f,j].filter(Boolean);let I;if(h){const e=h.split("/").pop()||h;I=`${s}/${e}`}i.push({skill_type:r,skill_test_id:s,question_format:u,content:y,correct_answer:C,incorrect_answers:k,explanation:_||void 0,original_sentence:p||null,audio_url:I})});return{ok:i.length>0,skill_type:r,skill_test_id:s,insert:i,warnings:t,errors:n,summary:{rows_received:p.length,rows_valid:i.length,rows_with_warnings:new Set(t.map(e=>e.row)).size,rows_with_errors:n.length}}}function k({skillTestId:s,onImported:t}){const[u,m]=e.useState(null),[h,p]=e.useState([]),[x,g]=e.useState(null),[w,f]=e.useState(!1),j=e.useRef(null);return r.jsxs(n,{children:[r.jsx(i,{children:r.jsx(a,{className:"text-base",children:"Upload Listening CSV"})}),r.jsxs(o,{className:"space-y-3",children:[r.jsxs("div",{className:"flex gap-2",children:[r.jsx("input",{ref:j,type:"file",accept:".csv",className:"hidden",onChange:e=>{var r;const t=null==(r=e.target.files)?void 0:r[0];t&&(async r=>{var t;try{m(null),p([]),g(null);const e=C(await r.text(),"Listening for Details",s);if(g(e),0===e.insert.length){const r=(null==(t=e.errors[0])?void 0:t.message)||"No valid rows found in CSV";return void m(r)}e.errors.length>0&&c.warning(`${e.errors.length} row(s) have errors and will be skipped`),e.warnings.length>0&&c.message(`${e.warnings.length} warning(s) during normalization`),p(e.insert)}catch(e){m(e.message||"Failed to parse CSV")}})(t)}}),r.jsx(l,{onClick:()=>{var e;return null==(e=j.current)?void 0:e.click()},children:"Choose CSV"}),r.jsx(l,{variant:"secondary",onClick:()=>{const e=['Listening_Dictation,"listening_dict_1.mp3","We should submit the report by Friday.","Listen and type exactly what you hear.","We should submit the report by Friday.","We should submit the report by Friday","we should submit the report by friday","","The speaker said: "We should submit the report by Friday.""','Listening_MultipleChoice,"comprehension_q5.mp3","The meeting was postponed due to weather.","Why was the meeting postponed?","Because of weather","Because the presenter was late","Because of a scheduling conflict","Because the venue was closed","The audio mentions the meeting was postponed due to weather."'].join("\n"),r=new Blob(["QuestionFormat,audio_url,original_sentence,WordOrSentence,CorrectAnswer,IncorrectAnswer1,IncorrectAnswer2,IncorrectAnswer3,Explanation\n"+e],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(r),t=document.createElement("a");t.href=s,t.download="listening-for-details-template.csv",t.click(),URL.revokeObjectURL(s)},children:"Download Template"})]}),u&&r.jsx(_,{variant:"destructive",children:r.jsx(v,{children:u})}),h.length>0&&r.jsxs("div",{className:"space-y-2",children:[x&&r.jsxs("p",{className:"text-sm text-muted-foreground",children:["Parsed: ",h.length," valid row(s)",x.warnings.length>0&&` â€¢ ${x.warnings.length} warning(s)`,x.errors.length>0&&` â€¢ ${x.errors.length} error row(s) skipped`]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(l,{onClick:async()=>{if(x&&0!==x.insert.length){f(!0);try{const{error:e}=await d.from("skill_practice_questions").insert(x.insert);if(e)throw e;c.success(`Imported ${x.insert.length} questions`),p([]),g(null),null==t||t()}catch(e){console.error(e),c.error(e.message||"Import failed")}finally{f(!1)}}},disabled:w,children:w?"Importing...":"Import"}),r.jsx(l,{variant:"secondary",onClick:()=>{p([]),g(null)},children:"Cancel"})]}),r.jsxs("div",{className:"max-h-60 overflow-auto rounded border p-2 text-xs",children:[h.slice(0,10).map((e,s)=>r.jsxs("div",{className:"py-1 border-b last:border-b-0",children:[r.jsx("div",{className:"font-medium",children:e.question_format}),r.jsxs("div",{className:"text-muted-foreground",children:[r.jsx("span",{className:"font-medium",children:"Audio:"})," ",e.audio_url||"â€”"]}),e.original_sentence&&r.jsxs("div",{className:"text-muted-foreground whitespace-pre-wrap break-words",children:[r.jsx("span",{className:"font-medium",children:"Transcript:"})," ",e.original_sentence]}),r.jsx("div",{className:"text-muted-foreground",children:e.content})]},s)),h.length>10&&r.jsxs("div",{className:"text-muted-foreground",children:["...and ",h.length-10," more"]})]})]})]})]})}function I(e){const r=[...e];for(let s=r.length-1;s>0;s--){const e=Math.floor(Math.random()*(s+1));[r[s],r[e]]=[r[e],r[s]]}return r}function S(e){if(!e)return"";let r=e.trim();return r=r.replace(/^[-â€¢]\s*/,""),r=r.replace(/\*\*(.*?)\*\*/g,"$1"),r=r.replace(/\*(.*?)\*/g,"$1"),r=r.replace(/_(.*?)_/g,"$1"),r=r.replace(/`(.*?)`/g,"$1"),r}const q=s=>{const{skillTestId:t,selectedQuestionId:i,limit:a=6}=s,c=s.questions,[h,p]=e.useState([]),[x,g]=e.useState(0),[w,f]=e.useState(null),[j,_]=e.useState(""),[v,y]=e.useState(0),[N,b]=e.useState(!1);e.useEffect(()=>{(async()=>{if(c&&c.length)return p(c),g(0),f(null),_(""),y(0),void b(!1);if(!t)return;const{data:e,error:r}=await d.from("skill_practice_questions").select("id,content,question_format,correct_answer,incorrect_answers,explanation,original_sentence,audio_url").eq("skill_test_id",t);if(!r){const r=I(e??[]).slice(0,a);p(r),g(0),f(null),_(""),y(0),b(!1)}})()},[c,t,a]),e.useEffect(()=>{if(!i||!h.length)return;const e=h.findIndex(e=>e.id===i);e>=0&&(g(e),f(null),_(""),b(!1))},[i,h]);const C=h[x],k=e.useMemo(()=>C?I([C.correct_answer,...C.incorrect_answers||[]]):[],[C]),q=h.length?x/h.length*100:0;return t||c&&c.length?r.jsxs("div",{className:"space-y-4",children:[r.jsx(u,{value:q}),N?r.jsx(n,{children:r.jsxs(o,{className:"p-6 text-center space-y-3",children:[r.jsx("div",{className:"text-lg font-semibold",children:"Preview complete"}),r.jsxs("div",{className:"text-muted-foreground",children:["Score: ",v," / ",h.length]}),r.jsx(l,{onClick:()=>{g(0),y(0),f(null),_(""),b(!1)},children:"Restart preview"})]})}):C?r.jsx(n,{className:"border-light-border",children:r.jsxs(o,{className:"p-6 space-y-4",children:[r.jsxs("div",{className:"text-xs text-muted-foreground",children:["Question ",x+1," of ",h.length]}),C.audio_url&&r.jsxs("div",{className:"bg-muted/30 rounded-lg p-3",children:[r.jsx("div",{className:"text-sm font-medium mb-2",children:"Audio"}),r.jsxs("audio",{controls:!0,className:"w-full",children:[r.jsx("source",{src:C.audio_url.startsWith("http")?C.audio_url:`https://your-bucket.your-domain.com/${C.audio_url}`}),"Your browser does not support the audio element."]})]}),C.original_sentence&&r.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950/20 rounded-lg p-3 text-sm",children:[r.jsx("div",{className:"font-medium text-blue-900 dark:text-blue-100",children:"Transcript (admin view)"}),r.jsx("div",{className:"text-blue-700 dark:text-blue-300",children:C.original_sentence})]}),"Listening_Dictation"===C.question_format?r.jsxs("div",{children:[r.jsx("div",{className:"text-lg font-medium mb-4",children:C.content}),r.jsxs("div",{className:"space-y-3",children:[r.jsx(m,{value:j,onChange:e=>_(e.target.value),placeholder:"Type what you hear...",disabled:!!w}),!w&&r.jsx(l,{onClick:()=>{w||(f(j),C&&j.toLowerCase().trim()===C.correct_answer.toLowerCase().trim()&&y(e=>e+1))},disabled:!j.trim(),children:"Submit"})]})]}):r.jsxs("div",{children:[r.jsx("div",{className:"text-lg font-medium mb-4",children:C.content}),r.jsx("div",{className:"grid gap-3 sm:grid-cols-2",children:k.map(e=>{const s=w&&e===C.correct_answer,t=w===e&&e!==C.correct_answer;return r.jsx(l,{variant:s?"success":t?"destructive":"outline",className:"justify-start h-auto py-3",onClick:()=>(e=>{w||(f(e),C&&e===C.correct_answer&&y(e=>e+1))})(e),children:e},e)})})]}),w&&r.jsxs("div",{className:"pt-2 space-y-3",children:[r.jsxs("div",{className:"rounded-md border p-3",children:[r.jsx("div",{className:"text-sm font-medium",children:"Result"}),r.jsx("div",{className:"text-sm",children:"Listening_Dictation"===C.question_format?r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:["Your answer: ",r.jsx("span",{className:"font-mono",children:w})]}),r.jsxs("div",{children:["Correct answer: ",r.jsx("span",{className:"font-mono",children:C.correct_answer})]}),r.jsx("div",{className:"font-medium "+(w.toLowerCase().trim()===C.correct_answer.toLowerCase().trim()?"text-green-600":"text-red-600"),children:w.toLowerCase().trim()===C.correct_answer.toLowerCase().trim()?"âœ“ Correct":"âœ— Incorrect"})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:["Correct answer: ",r.jsx("span",{className:"font-medium",children:C.correct_answer})]}),r.jsx("div",{className:"font-medium "+(w===C.correct_answer?"text-green-600":"text-red-600"),children:w===C.correct_answer?"âœ“ Correct":"âœ— Incorrect"})]})})]}),C.explanation&&r.jsxs("div",{className:"rounded-md border p-3",children:[r.jsx("div",{className:"text-sm font-medium",children:"Explanation"}),r.jsx("p",{className:"text-sm text-muted-foreground",children:S(C.explanation)})]}),r.jsx(l,{onClick:()=>{x+1>=h.length?b(!0):(g(e=>e+1),f(null),_(""))},children:"Continue"})]})]})}):r.jsx("p",{className:"text-sm text-muted-foreground",children:"No questions yet. Use the CSV import above."})]}):null},$=()=>{const{id:c}=s(),[u,_]=e.useState(null),[v,y]=e.useState([]),[N,b]=e.useState(null),[C,I]=e.useState(null),S=e.useRef(null),[$,A]=e.useState({content:"",question_format:"",correct_answer:"",incorrect1:"",incorrect2:"",incorrect3:"",explanation:"",original_sentence:"",audio_url:""}),[L,F]=e.useState([]),[E,O]=e.useState(!1),[T,M]=e.useState(null),z=async()=>{if(!c)return;const{data:e}=await d.from("skill_tests").select("id,title").eq("id",c).maybeSingle();_(e??null);const{data:r}=await d.from("skill_practice_questions").select("id,content,question_format,correct_answer,incorrect_answers,explanation,original_sentence,audio_url").eq("skill_test_id",c).order("created_at",{ascending:!1});y(r??[]),F([])};e.useEffect(()=>{z()},[c]);return r.jsx(t,{title:u?`Manage: ${u.title}`:"Manage Listening Test",showBackButton:!0,children:r.jsxs("section",{className:"space-y-6",children:[c&&r.jsx(k,{skillTestId:c,onImported:z}),r.jsx(j,{}),r.jsx("div",{ref:S,children:r.jsxs(n,{children:[r.jsx(i,{children:r.jsx(a,{className:"text-base",children:"Student Preview"})}),r.jsx(o,{children:r.jsx(q,{questions:v,selectedQuestionId:C||void 0})})]})}),r.jsx(j,{}),r.jsxs(n,{children:[r.jsx(i,{children:r.jsx(a,{className:"text-base",children:"Manage Audio Files"})}),r.jsxs(o,{className:"space-y-3",children:[r.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[r.jsx(m,{type:"file",accept:"audio/mpeg,audio/mp3,audio/wav,audio/webm",onChange:e=>{var r;return M((null==(r=e.target.files)?void 0:r[0])||null)}}),r.jsx(l,{onClick:async()=>{var e;if(T&&c){O(!0);try{const r=(null==(e=T.name.split(".").pop())?void 0:e.toLowerCase())||"mp3",s=T.name.replace(/\.[^/.]+$/,"").normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9_-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").toLowerCase(),t=`${Date.now()}-${s}.${r}`,n=`admin/listening/${c}/${t}`;console.log("ðŸ“¤ Uploading listening audio to R2:",{originalName:T.name,fileName:t,size:T.size,type:T.type});const i=new FormData;i.append("file",T),i.append("path",n),i.append("contentType",T.type||"audio/mpeg"),i.append("cacheControl","public, max-age=31536000");const{data:{session:a}}=await d.auth.getSession(),o="https://cuumxmfzhwljylbdlflj.supabase.co/functions/v1/r2-upload",l=await fetch(o,{method:"POST",headers:{Authorization:(null==a?void 0:a.access_token)?`Bearer ${a.access_token}`:""},body:i});if(!l.ok){const e=await l.text();throw console.error("âŒ R2 upload error:",l.status,e),new Error(`Upload failed ${l.status}: ${e}`)}const u=await l.json();if(!u||!u.success)throw new Error((null==u?void 0:u.error)||"Upload failed");console.log("âœ… Listening audio uploaded successfully:",u.url),F([...L,{name:t,url:u.url}]),await z()}catch(r){console.error("âŒ Upload error:",r),alert(`Upload failed: ${r.message}`)}finally{O(!1),M(null)}}},disabled:!T||E,children:E?"Uploading...":"Upload Audio"})]}),r.jsxs("div",{className:"grid gap-2 sm:grid-cols-2 lg:grid-cols-3",children:[L.map(e=>r.jsxs("div",{className:"border rounded-md p-2 text-sm",children:[r.jsx("div",{className:"font-medium break-words",children:e.name}),r.jsx("audio",{controls:!0,className:"w-full mt-1",children:r.jsx("source",{src:e.url})}),r.jsx("div",{className:"flex gap-2 mt-2",children:r.jsx(l,{size:"sm",variant:"destructive",onClick:()=>(async e=>{if(c)try{console.log("ðŸ—‘ï¸ Deleting listening audio from R2:",{fileName:e});const r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN1dW14bWZ6aHdsanlsYmRsZmxqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM1MTkxMjEsImV4cCI6MjA2OTA5NTEyMX0.8jqO_ciOttSxSLZnKY0i5oJmEn79ROF53TjUMYhNemI",s="https://cuumxmfzhwljylbdlflj.supabase.co/functions/v1/r2-delete",t=`admin/listening/${c}/${e}`,n=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",apikey:r,Authorization:`Bearer ${r}`},body:JSON.stringify({path:t})});if(!n.ok){const e=await n.text();throw console.error("âŒ R2 delete error:",n.status,e),new Error(`Delete failed ${n.status}: ${e}`)}console.log("âœ… Listening audio deleted successfully"),F(L.filter(r=>r.name!==e)),await z()}catch(r){console.error("âŒ Delete error:",r),alert(`Delete failed: ${r.message}`)}})(e.name),children:"Delete"})})]},e.name)),0===L.length&&r.jsx("p",{className:"text-sm text-muted-foreground",children:"No audio yet. Upload MP3s before importing CSV."})]})]})]}),r.jsx(j,{}),r.jsxs(n,{children:[r.jsx(i,{children:r.jsx(a,{className:"text-base",children:"Question Library"})}),r.jsx(o,{className:"space-y-3",children:0===v.length?r.jsx("p",{className:"text-sm text-muted-foreground",children:"No questions yet. Upload a CSV to add questions."}):v.map(e=>r.jsx("div",{className:"p-3 border rounded-md space-y-2",children:r.jsxs("div",{className:"flex items-center justify-between gap-3",children:[r.jsxs("div",{className:"min-w-0",children:[r.jsx("div",{className:"text-xs text-muted-foreground",children:e.question_format}),e.original_sentence&&r.jsxs("div",{className:"text-sm text-muted-foreground whitespace-pre-wrap break-words",children:[r.jsx("span",{className:"font-medium",children:"Transcript:"})," ",e.original_sentence]}),e.audio_url&&r.jsx("audio",{controls:!0,className:"w-full my-2",children:r.jsx("source",{src:e.audio_url.startsWith("http")?e.audio_url:`https://your-bucket.your-domain.com/${e.audio_url}`})}),r.jsx("div",{className:"whitespace-pre-wrap break-words",children:e.content})]}),r.jsxs("div",{className:"flex gap-2 shrink-0",children:[r.jsx(l,{size:"sm",variant:"secondary",onClick:()=>{var r;I(e.id),null==(r=S.current)||r.scrollIntoView({behavior:"smooth"})},children:"Preview"}),r.jsx(l,{size:"sm",onClick:()=>(e=>{var r,s,t;b(e),A({content:e.content||"",question_format:e.question_format||"",correct_answer:e.correct_answer||"",incorrect1:(null==(r=e.incorrect_answers)?void 0:r[0])||"",incorrect2:(null==(s=e.incorrect_answers)?void 0:s[1])||"",incorrect3:(null==(t=e.incorrect_answers)?void 0:t[2])||"",explanation:e.explanation||"",original_sentence:e.original_sentence||"",audio_url:e.audio_url||""})})(e),children:"Edit"}),r.jsx(l,{size:"sm",variant:"destructive",onClick:()=>(async e=>{confirm("Delete this question?")&&(await d.from("skill_practice_questions").delete().eq("id",e),await z())})(e.id),children:"Delete"})]})]})},e.id))})]}),r.jsx(h,{open:!!N,onOpenChange:e=>{e||b(null)},children:r.jsxs(p,{className:"sm:max-w-lg",children:[r.jsx(x,{children:r.jsx(g,{children:"Edit Question"})}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{children:[r.jsx(w,{htmlFor:"question_format",children:"Format"}),r.jsx(m,{id:"question_format",value:$.question_format,onChange:e=>A({...$,question_format:e.target.value})})]}),r.jsxs("div",{children:[r.jsx(w,{htmlFor:"original_sentence",children:"Transcript (optional)"}),r.jsx(f,{id:"original_sentence",value:$.original_sentence,onChange:e=>A({...$,original_sentence:e.target.value})})]}),r.jsxs("div",{children:[r.jsx(w,{htmlFor:"content",children:"Instruction / Question"}),r.jsx(f,{id:"content",value:$.content,onChange:e=>A({...$,content:e.target.value})})]}),r.jsxs("div",{children:[r.jsx(w,{htmlFor:"audio_url",children:"Audio file (path in bucket)"}),r.jsx(m,{id:"audio_url",value:$.audio_url,onChange:e=>A({...$,audio_url:e.target.value}),placeholder:`${c}/file.mp3`})]}),r.jsxs("div",{children:[r.jsx(w,{htmlFor:"correct_answer",children:"Correct Answer"}),r.jsx(m,{id:"correct_answer",value:$.correct_answer,onChange:e=>A({...$,correct_answer:e.target.value})})]}),r.jsxs("div",{className:"grid sm:grid-cols-3 gap-3",children:[r.jsxs("div",{children:[r.jsx(w,{children:"Incorrect 1"}),r.jsx(m,{value:$.incorrect1,onChange:e=>A({...$,incorrect1:e.target.value})})]}),r.jsxs("div",{children:[r.jsx(w,{children:"Incorrect 2"}),r.jsx(m,{value:$.incorrect2,onChange:e=>A({...$,incorrect2:e.target.value})})]}),r.jsxs("div",{children:[r.jsx(w,{children:"Incorrect 3"}),r.jsx(m,{value:$.incorrect3,onChange:e=>A({...$,incorrect3:e.target.value})})]})]}),r.jsxs("div",{children:[r.jsx(w,{htmlFor:"explanation",children:"Explanation"}),r.jsx(f,{id:"explanation",value:$.explanation,onChange:e=>A({...$,explanation:e.target.value})})]})]}),r.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[r.jsx(l,{variant:"outline",onClick:()=>b(null),children:"Cancel"}),r.jsx(l,{onClick:async()=>{if(!N)return;const e=[$.incorrect1,$.incorrect2,$.incorrect3].filter(Boolean),{error:r}=await d.from("skill_practice_questions").update({content:$.content,question_format:$.question_format,correct_answer:$.correct_answer,incorrect_answers:e,explanation:$.explanation,original_sentence:$.original_sentence||null,audio_url:$.audio_url}).eq("id",N.id);r||(b(null),await z())},children:"Save"})]})]})})]})})};export{$ as default};
