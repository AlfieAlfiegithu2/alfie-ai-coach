import{u as e,r as s,j as t}from"./vendor-react-rLLBBC7n.js";import{n as l,s as a,J as i,D as r,m as c,B as n,f as d,g as o,h as m,W as x,L as h,I as u,T as j,S as p,i as g,j as v,k as f,l as y,X as N,C as b,a as _,b as w,c as C,o as T,e as E}from"./index-BDl0jLJK.js";import{A as M,a as k,b as q,c as A,d as S,e as P,f as F,g as L,h as D}from"./alert-dialog-C3e0CSUs.js";import{A as X}from"./AdminLayout-DwaN-V0p.js";import{ar as B,av as Q,ao as z,aN as H,aZ as V,aA as I,aM as J,a_ as O,aY as U,cx as Y,cy as $,cz as W,J as Z,cA as G,bE as K}from"./vendor-ui-BGi_EvHx.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-charts-0DeywwxG.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";const R=[{value:"Medical-Surgical",label:"Medical-Surgical",icon:Y},{value:"Pediatrics",label:"Pediatrics",icon:$},{value:"Maternity",label:"Maternity",icon:W},{value:"Mental Health",label:"Mental Health",icon:Z},{value:"Pharmacology",label:"Pharmacology",icon:G},{value:"Fundamentals",label:"Fundamentals",icon:K}],ee=[{value:"Easy",label:"Easy"},{value:"Medium",label:"Medium"},{value:"Hard",label:"Hard"}],se=()=>{const Y=e(),{admin:$,loading:W}=l(),[Z,G]=s.useState([]),[K,se]=s.useState(!0),[te,le]=s.useState(!1),[ae,ie]=s.useState(null),[re,ce]=s.useState({title:"",description:"",category:"Medical-Surgical",difficulty_level:"Medium",time_limit_minutes:60}),[ne,de]=s.useState({totalTests:0,publishedTests:0,totalQuestions:0,totalAttempts:0});s.useEffect(()=>{W||$?(oe(),me()):Y("/admin/login")},[$,W]);const oe=async()=>{try{const{data:e,error:s}=await a.from("nclex_tests").select("*").order("created_at",{ascending:!1});if(s)throw s;G(e||[])}catch(e){console.error("Error loading tests:",e),i.error("Failed to load tests")}finally{se(!1)}},me=async()=>{try{const{data:e}=await a.from("nclex_tests").select("id, is_published, question_count"),s=(e||[]).length,t=(e||[]).filter(e=>e.is_published).length,l=(e||[]).reduce((e,s)=>e+(s.question_count||0),0),{count:i}=await a.from("nclex_test_results").select("*",{count:"exact",head:!0});de({totalTests:s,publishedTests:t,totalQuestions:l,totalAttempts:i||0})}catch(e){console.error("Error loading stats:",e)}},xe=()=>{ce({title:"",description:"",category:"Medical-Surgical",difficulty_level:"Medium",time_limit_minutes:60})},he=e=>{switch(e){case"Easy":return"bg-green-100 text-green-700";case"Medium":return"bg-amber-100 text-amber-700";case"Hard":return"bg-red-100 text-red-700";default:return"bg-gray-100 text-gray-700"}};return W||K?t.jsx(X,{title:"NCLEX Admin",showBackButton:!0,children:t.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-teal-500"})})}):t.jsx(X,{title:"NCLEX Admin",showBackButton:!0,children:t.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[t.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[t.jsxs("div",{children:[t.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-2",children:[t.jsx(B,{className:"h-8 w-8 text-teal-500"}),"NCLEX Test Management"]}),t.jsx("p",{className:"text-muted-foreground mt-1",children:"Create and manage NCLEX practice tests with SATA and MCQ questions"})]}),t.jsxs(r,{open:te,onOpenChange:le,children:[t.jsx(c,{asChild:!0,children:t.jsxs(n,{className:"bg-gradient-to-r from-teal-500 to-cyan-500 hover:from-teal-600 hover:to-cyan-600 text-white",children:[t.jsx(Q,{className:"h-4 w-4 mr-2"}),"Create New Test"]})}),t.jsxs(d,{className:"sm:max-w-md",children:[t.jsxs(o,{children:[t.jsx(m,{children:"Create New NCLEX Test"}),t.jsx(x,{children:"Set up a new practice test. You can add questions after creation."})]}),t.jsxs("div",{className:"space-y-4 py-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(h,{htmlFor:"title",children:"Test Title *"}),t.jsx(u,{id:"title",value:re.title,onChange:e=>ce({...re,title:e.target.value}),placeholder:"e.g., Cardiovascular Nursing Quiz"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(h,{htmlFor:"description",children:"Description"}),t.jsx(j,{id:"description",value:re.description,onChange:e=>ce({...re,description:e.target.value}),placeholder:"Brief description of the test content...",rows:3})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(h,{children:"Category"}),t.jsxs(p,{value:re.category,onValueChange:e=>ce({...re,category:e}),children:[t.jsx(g,{children:t.jsx(v,{})}),t.jsx(f,{children:R.map(e=>t.jsx(y,{value:e.value,children:e.label},e.value))})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(h,{children:"Difficulty"}),t.jsxs(p,{value:re.difficulty_level,onValueChange:e=>ce({...re,difficulty_level:e}),children:[t.jsx(g,{children:t.jsx(v,{})}),t.jsx(f,{children:ee.map(e=>t.jsx(y,{value:e.value,children:e.label},e.value))})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(h,{children:"Time Limit (minutes)"}),t.jsx(u,{type:"number",value:re.time_limit_minutes,onChange:e=>ce({...re,time_limit_minutes:parseInt(e.target.value)||60}),min:5,max:180})]})]}),t.jsxs(N,{children:[t.jsx(n,{variant:"outline",onClick:()=>le(!1),children:"Cancel"}),t.jsx(n,{onClick:async()=>{if(re.title.trim())try{const{data:e,error:s}=await a.from("nclex_tests").insert({title:re.title,description:re.description||null,category:re.category,difficulty_level:re.difficulty_level,time_limit_minutes:re.time_limit_minutes,is_published:!1,created_by:(null==$?void 0:$.email)||"admin"}).select().single();if(s)throw s;i.success("Test created successfully"),le(!1),xe(),oe(),me(),e&&Y(`/admin/nclex/test/${e.id}`)}catch(e){console.error("Error creating test:",e),i.error("Failed to create test")}else i.error("Please enter a test title")},className:"bg-teal-500 hover:bg-teal-600 text-white",children:"Create Test"})]})]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsx(b,{children:t.jsx(_,{className:"p-4",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-lg bg-teal-100 flex items-center justify-center",children:t.jsx(z,{className:"h-5 w-5 text-teal-600"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-2xl font-bold",children:ne.totalTests}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Tests"})]})]})})}),t.jsx(b,{children:t.jsx(_,{className:"p-4",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center",children:t.jsx(H,{className:"h-5 w-5 text-green-600"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-2xl font-bold",children:ne.publishedTests}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Published"})]})]})})}),t.jsx(b,{children:t.jsx(_,{className:"p-4",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:t.jsx(B,{className:"h-5 w-5 text-purple-600"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-2xl font-bold",children:ne.totalQuestions}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Questions"})]})]})})}),t.jsx(b,{children:t.jsx(_,{className:"p-4",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-lg bg-amber-100 flex items-center justify-center",children:t.jsx(V,{className:"h-5 w-5 text-amber-600"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-2xl font-bold",children:ne.totalAttempts}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Attempts"})]})]})})})]}),t.jsxs(b,{children:[t.jsxs(w,{children:[t.jsx(C,{children:"All Tests"}),t.jsx(T,{children:"Click on a test to manage its questions"})]}),t.jsx(_,{children:0===Z.length?t.jsxs("div",{className:"text-center py-12",children:[t.jsx(B,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),t.jsx("p",{className:"text-muted-foreground",children:"No tests created yet"}),t.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Create your first NCLEX practice test"}),t.jsxs(n,{onClick:()=>le(!0),variant:"outline",children:[t.jsx(Q,{className:"h-4 w-4 mr-2"}),"Create Test"]})]}):t.jsx("div",{className:"space-y-3",children:Z.map(e=>{const s=(e=>{const s=R.find(s=>s.value===e);return(null==s?void 0:s.icon)||B})(e.category);return t.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-4 flex-1 cursor-pointer",onClick:()=>Y(`/admin/nclex/test/${e.id}`),children:[t.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-teal-500 to-cyan-500 flex items-center justify-center",children:t.jsx(s,{className:"h-6 w-6 text-white"})}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("h3",{className:"font-semibold",children:e.title}),e.is_published?t.jsx(E,{className:"bg-green-100 text-green-700",children:"Published"}):t.jsx(E,{variant:"secondary",children:"Draft"}),t.jsx(E,{className:he(e.difficulty_level),children:e.difficulty_level})]}),t.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[t.jsx("span",{children:e.category}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(z,{className:"h-3 w-3"}),e.question_count," questions"]}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(I,{className:"h-3 w-3"}),e.time_limit_minutes," min"]})]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(n,{variant:"ghost",size:"sm",onClick:s=>{s.stopPropagation(),(async e=>{try{const{error:s}=await a.from("nclex_tests").update({is_published:!e.is_published}).eq("id",e.id);if(s)throw s;i.success(e.is_published?"Test unpublished":"Test published"),oe(),me()}catch(s){console.error("Error toggling publish status:",s),i.error("Failed to update test")}})(e)},title:e.is_published?"Unpublish":"Publish",children:e.is_published?t.jsx(J,{className:"h-4 w-4"}):t.jsx(H,{className:"h-4 w-4"})}),t.jsx(n,{variant:"ghost",size:"sm",onClick:s=>{s.stopPropagation(),(e=>{ie(e),ce({title:e.title,description:e.description||"",category:e.category,difficulty_level:e.difficulty_level,time_limit_minutes:e.time_limit_minutes})})(e)},children:t.jsx(O,{className:"h-4 w-4"})}),t.jsxs(M,{children:[t.jsx(k,{asChild:!0,children:t.jsx(n,{variant:"ghost",size:"sm",className:"text-red-500 hover:text-red-600 hover:bg-red-50",onClick:e=>e.stopPropagation(),children:t.jsx(U,{className:"h-4 w-4"})})}),t.jsxs(q,{children:[t.jsxs(A,{children:[t.jsx(S,{children:"Delete Test?"}),t.jsxs(P,{children:['This will permanently delete "',e.title,'" and all its questions. This action cannot be undone.']})]}),t.jsxs(F,{children:[t.jsx(L,{children:"Cancel"}),t.jsx(D,{onClick:()=>(async e=>{try{await a.from("nclex_questions").delete().eq("test_id",e),await a.from("nclex_test_results").delete().eq("test_id",e);const{error:s}=await a.from("nclex_tests").delete().eq("id",e);if(s)throw s;i.success("Test deleted successfully"),oe(),me()}catch(s){console.error("Error deleting test:",s),i.error("Failed to delete test")}})(e.id),className:"bg-red-500 hover:bg-red-600",children:"Delete"})]})]})]})]})]},e.id)})})})]}),t.jsx(r,{open:!!ae,onOpenChange:e=>!e&&ie(null),children:t.jsxs(d,{className:"sm:max-w-md",children:[t.jsxs(o,{children:[t.jsx(m,{children:"Edit Test"}),t.jsx(x,{children:"Update the test details below."})]}),t.jsxs("div",{className:"space-y-4 py-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(h,{htmlFor:"edit-title",children:"Test Title *"}),t.jsx(u,{id:"edit-title",value:re.title,onChange:e=>ce({...re,title:e.target.value})})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(h,{htmlFor:"edit-description",children:"Description"}),t.jsx(j,{id:"edit-description",value:re.description,onChange:e=>ce({...re,description:e.target.value}),rows:3})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(h,{children:"Category"}),t.jsxs(p,{value:re.category,onValueChange:e=>ce({...re,category:e}),children:[t.jsx(g,{children:t.jsx(v,{})}),t.jsx(f,{children:R.map(e=>t.jsx(y,{value:e.value,children:e.label},e.value))})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(h,{children:"Difficulty"}),t.jsxs(p,{value:re.difficulty_level,onValueChange:e=>ce({...re,difficulty_level:e}),children:[t.jsx(g,{children:t.jsx(v,{})}),t.jsx(f,{children:ee.map(e=>t.jsx(y,{value:e.value,children:e.label},e.value))})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(h,{children:"Time Limit (minutes)"}),t.jsx(u,{type:"number",value:re.time_limit_minutes,onChange:e=>ce({...re,time_limit_minutes:parseInt(e.target.value)||60}),min:5,max:180})]})]}),t.jsxs(N,{children:[t.jsx(n,{variant:"outline",onClick:()=>ie(null),children:"Cancel"}),t.jsx(n,{onClick:async()=>{if(ae&&re.title.trim())try{const{error:e}=await a.from("nclex_tests").update({title:re.title,description:re.description||null,category:re.category,difficulty_level:re.difficulty_level,time_limit_minutes:re.time_limit_minutes}).eq("id",ae.id);if(e)throw e;i.success("Test updated successfully"),ie(null),xe(),oe()}catch(e){console.error("Error updating test:",e),i.error("Failed to update test")}else i.error("Please enter a test title")},className:"bg-teal-500 hover:bg-teal-600 text-white",children:"Save Changes"})]})]})})]})})};export{se as default};
