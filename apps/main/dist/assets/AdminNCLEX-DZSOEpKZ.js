import{u as e,w as s,r as t,J as l,j as i,A as a,D as r,v as c,B as n,P as d,m as o,n as m,o as x,bn as h,O as u,I as j,T as p,S as g,p as f,q as v,s as y,t as N,cc as b,C as _,a as w,e as C,E as T,b as E,d as S,y as q,l as M,R as P,ak as k,bi as A}from"./index-C36stBbp.js";import{A as F,a as L,b as D,c as B,d as H,e as Q,f as X,g as z,h as V}from"./alert-dialog-40rKjtDq.js";import{A as I}from"./AdminLayout-j7tae2vu.js";import{s as O}from"./supabase-DWL4C3fA.js";import{U}from"./users-C0swRDrc.js";import{P as $}from"./pen-line-De0vbQnq.js";import{T as J}from"./trash-2-CDHwe5Zo.js";import{S as R}from"./stethoscope-CFPdjD4n.js";import{B as Y,H as G,P as K}from"./pill-CYlpC6H2.js";import{S as W}from"./shield-D8ns6_jV.js";const Z=[{value:"Medical-Surgical",label:"Medical-Surgical",icon:R},{value:"Pediatrics",label:"Pediatrics",icon:Y},{value:"Maternity",label:"Maternity",icon:G},{value:"Mental Health",label:"Mental Health",icon:A},{value:"Pharmacology",label:"Pharmacology",icon:K},{value:"Fundamentals",label:"Fundamentals",icon:W}],ee=[{value:"Easy",label:"Easy"},{value:"Medium",label:"Medium"},{value:"Hard",label:"Hard"}],se=()=>{const A=e(),{admin:R,loading:Y}=s(),[G,K]=t.useState([]),[W,se]=t.useState(!0),[te,le]=t.useState(!1),[ie,ae]=t.useState(null),[re,ce]=t.useState({title:"",description:"",category:"Medical-Surgical",difficulty_level:"Medium",time_limit_minutes:60}),[ne,de]=t.useState({totalTests:0,publishedTests:0,totalQuestions:0,totalAttempts:0});t.useEffect(()=>{Y||R?(oe(),me()):A("/admin/login")},[R,Y]);const oe=async()=>{try{const{data:e,error:s}=await O.from("nclex_tests").select("*").order("created_at",{ascending:!1});if(s)throw s;K(e||[])}catch(e){console.error("Error loading tests:",e),l.error("Failed to load tests")}finally{se(!1)}},me=async()=>{try{const{data:e}=await O.from("nclex_tests").select("id, is_published, question_count"),s=(e||[]).length,t=(e||[]).filter(e=>e.is_published).length,l=(e||[]).reduce((e,s)=>e+(s.question_count||0),0),{count:i}=await O.from("nclex_test_results").select("*",{count:"exact",head:!0});de({totalTests:s,publishedTests:t,totalQuestions:l,totalAttempts:i||0})}catch(e){console.error("Error loading stats:",e)}},xe=()=>{ce({title:"",description:"",category:"Medical-Surgical",difficulty_level:"Medium",time_limit_minutes:60})},he=e=>{switch(e){case"Easy":return"bg-green-100 text-green-700";case"Medium":return"bg-amber-100 text-amber-700";case"Hard":return"bg-red-100 text-red-700";default:return"bg-gray-100 text-gray-700"}};return Y||W?i.jsx(I,{title:"NCLEX Admin",showBackButton:!0,children:i.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-teal-500"})})}):i.jsx(I,{title:"NCLEX Admin",showBackButton:!0,children:i.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[i.jsxs("div",{children:[i.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-2",children:[i.jsx(a,{className:"h-8 w-8 text-teal-500"}),"NCLEX Test Management"]}),i.jsx("p",{className:"text-muted-foreground mt-1",children:"Create and manage NCLEX practice tests with SATA and MCQ questions"})]}),i.jsxs(r,{open:te,onOpenChange:le,children:[i.jsx(c,{asChild:!0,children:i.jsxs(n,{className:"bg-gradient-to-r from-teal-500 to-cyan-500 hover:from-teal-600 hover:to-cyan-600 text-white",children:[i.jsx(d,{className:"h-4 w-4 mr-2"}),"Create New Test"]})}),i.jsxs(o,{className:"sm:max-w-md",children:[i.jsxs(m,{children:[i.jsx(x,{children:"Create New NCLEX Test"}),i.jsx(h,{children:"Set up a new practice test. You can add questions after creation."})]}),i.jsxs("div",{className:"space-y-4 py-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(u,{htmlFor:"title",children:"Test Title *"}),i.jsx(j,{id:"title",value:re.title,onChange:e=>ce({...re,title:e.target.value}),placeholder:"e.g., Cardiovascular Nursing Quiz"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(u,{htmlFor:"description",children:"Description"}),i.jsx(p,{id:"description",value:re.description,onChange:e=>ce({...re,description:e.target.value}),placeholder:"Brief description of the test content...",rows:3})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(u,{children:"Category"}),i.jsxs(g,{value:re.category,onValueChange:e=>ce({...re,category:e}),children:[i.jsx(f,{children:i.jsx(v,{})}),i.jsx(y,{children:Z.map(e=>i.jsx(N,{value:e.value,children:e.label},e.value))})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(u,{children:"Difficulty"}),i.jsxs(g,{value:re.difficulty_level,onValueChange:e=>ce({...re,difficulty_level:e}),children:[i.jsx(f,{children:i.jsx(v,{})}),i.jsx(y,{children:ee.map(e=>i.jsx(N,{value:e.value,children:e.label},e.value))})]})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(u,{children:"Time Limit (minutes)"}),i.jsx(j,{type:"number",value:re.time_limit_minutes,onChange:e=>ce({...re,time_limit_minutes:parseInt(e.target.value)||60}),min:5,max:180})]})]}),i.jsxs(b,{children:[i.jsx(n,{variant:"outline",onClick:()=>le(!1),children:"Cancel"}),i.jsx(n,{onClick:async()=>{if(re.title.trim())try{const{data:e,error:s}=await O.from("nclex_tests").insert({title:re.title,description:re.description||null,category:re.category,difficulty_level:re.difficulty_level,time_limit_minutes:re.time_limit_minutes,is_published:!1,created_by:(null==R?void 0:R.email)||"admin"}).select().single();if(s)throw s;l.success("Test created successfully"),le(!1),xe(),oe(),me(),e&&A(`/admin/nclex/test/${e.id}`)}catch(e){console.error("Error creating test:",e),l.error("Failed to create test")}else l.error("Please enter a test title")},className:"bg-teal-500 hover:bg-teal-600 text-white",children:"Create Test"})]})]})]})]}),i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[i.jsx(_,{children:i.jsx(w,{className:"p-4",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-lg bg-teal-100 flex items-center justify-center",children:i.jsx(C,{className:"h-5 w-5 text-teal-600"})}),i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold",children:ne.totalTests}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Tests"})]})]})})}),i.jsx(_,{children:i.jsx(w,{className:"p-4",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center",children:i.jsx(T,{className:"h-5 w-5 text-green-600"})}),i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold",children:ne.publishedTests}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Published"})]})]})})}),i.jsx(_,{children:i.jsx(w,{className:"p-4",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:i.jsx(a,{className:"h-5 w-5 text-purple-600"})}),i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold",children:ne.totalQuestions}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Questions"})]})]})})}),i.jsx(_,{children:i.jsx(w,{className:"p-4",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-lg bg-amber-100 flex items-center justify-center",children:i.jsx(U,{className:"h-5 w-5 text-amber-600"})}),i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold",children:ne.totalAttempts}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Attempts"})]})]})})})]}),i.jsxs(_,{children:[i.jsxs(E,{children:[i.jsx(S,{children:"All Tests"}),i.jsx(q,{children:"Click on a test to manage its questions"})]}),i.jsx(w,{children:0===G.length?i.jsxs("div",{className:"text-center py-12",children:[i.jsx(a,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),i.jsx("p",{className:"text-muted-foreground",children:"No tests created yet"}),i.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Create your first NCLEX practice test"}),i.jsxs(n,{onClick:()=>le(!0),variant:"outline",children:[i.jsx(d,{className:"h-4 w-4 mr-2"}),"Create Test"]})]}):i.jsx("div",{className:"space-y-3",children:G.map(e=>{const s=(e=>{const s=Z.find(s=>s.value===e);return(null==s?void 0:s.icon)||a})(e.category);return i.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[i.jsxs("div",{className:"flex items-center gap-4 flex-1 cursor-pointer",onClick:()=>A(`/admin/nclex/test/${e.id}`),children:[i.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-teal-500 to-cyan-500 flex items-center justify-center",children:i.jsx(s,{className:"h-6 w-6 text-white"})}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.jsx("h3",{className:"font-semibold",children:e.title}),e.is_published?i.jsx(M,{className:"bg-green-100 text-green-700",children:"Published"}):i.jsx(M,{variant:"secondary",children:"Draft"}),i.jsx(M,{className:he(e.difficulty_level),children:e.difficulty_level})]}),i.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[i.jsx("span",{children:e.category}),i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx(C,{className:"h-3 w-3"}),e.question_count," questions"]}),i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx(P,{className:"h-3 w-3"}),e.time_limit_minutes," min"]})]})]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(n,{variant:"ghost",size:"sm",onClick:s=>{s.stopPropagation(),(async e=>{try{const{error:s}=await O.from("nclex_tests").update({is_published:!e.is_published}).eq("id",e.id);if(s)throw s;l.success(e.is_published?"Test unpublished":"Test published"),oe(),me()}catch(s){console.error("Error toggling publish status:",s),l.error("Failed to update test")}})(e)},title:e.is_published?"Unpublish":"Publish",children:e.is_published?i.jsx(k,{className:"h-4 w-4"}):i.jsx(T,{className:"h-4 w-4"})}),i.jsx(n,{variant:"ghost",size:"sm",onClick:s=>{s.stopPropagation(),(e=>{ae(e),ce({title:e.title,description:e.description||"",category:e.category,difficulty_level:e.difficulty_level,time_limit_minutes:e.time_limit_minutes})})(e)},children:i.jsx($,{className:"h-4 w-4"})}),i.jsxs(F,{children:[i.jsx(L,{asChild:!0,children:i.jsx(n,{variant:"ghost",size:"sm",className:"text-red-500 hover:text-red-600 hover:bg-red-50",onClick:e=>e.stopPropagation(),children:i.jsx(J,{className:"h-4 w-4"})})}),i.jsxs(D,{children:[i.jsxs(B,{children:[i.jsx(H,{children:"Delete Test?"}),i.jsxs(Q,{children:['This will permanently delete "',e.title,'" and all its questions. This action cannot be undone.']})]}),i.jsxs(X,{children:[i.jsx(z,{children:"Cancel"}),i.jsx(V,{onClick:()=>(async e=>{try{await O.from("nclex_questions").delete().eq("test_id",e),await O.from("nclex_test_results").delete().eq("test_id",e);const{error:s}=await O.from("nclex_tests").delete().eq("id",e);if(s)throw s;l.success("Test deleted successfully"),oe(),me()}catch(s){console.error("Error deleting test:",s),l.error("Failed to delete test")}})(e.id),className:"bg-red-500 hover:bg-red-600",children:"Delete"})]})]})]})]})]},e.id)})})})]}),i.jsx(r,{open:!!ie,onOpenChange:e=>!e&&ae(null),children:i.jsxs(o,{className:"sm:max-w-md",children:[i.jsxs(m,{children:[i.jsx(x,{children:"Edit Test"}),i.jsx(h,{children:"Update the test details below."})]}),i.jsxs("div",{className:"space-y-4 py-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(u,{htmlFor:"edit-title",children:"Test Title *"}),i.jsx(j,{id:"edit-title",value:re.title,onChange:e=>ce({...re,title:e.target.value})})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(u,{htmlFor:"edit-description",children:"Description"}),i.jsx(p,{id:"edit-description",value:re.description,onChange:e=>ce({...re,description:e.target.value}),rows:3})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(u,{children:"Category"}),i.jsxs(g,{value:re.category,onValueChange:e=>ce({...re,category:e}),children:[i.jsx(f,{children:i.jsx(v,{})}),i.jsx(y,{children:Z.map(e=>i.jsx(N,{value:e.value,children:e.label},e.value))})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(u,{children:"Difficulty"}),i.jsxs(g,{value:re.difficulty_level,onValueChange:e=>ce({...re,difficulty_level:e}),children:[i.jsx(f,{children:i.jsx(v,{})}),i.jsx(y,{children:ee.map(e=>i.jsx(N,{value:e.value,children:e.label},e.value))})]})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(u,{children:"Time Limit (minutes)"}),i.jsx(j,{type:"number",value:re.time_limit_minutes,onChange:e=>ce({...re,time_limit_minutes:parseInt(e.target.value)||60}),min:5,max:180})]})]}),i.jsxs(b,{children:[i.jsx(n,{variant:"outline",onClick:()=>ae(null),children:"Cancel"}),i.jsx(n,{onClick:async()=>{if(ie&&re.title.trim())try{const{error:e}=await O.from("nclex_tests").update({title:re.title,description:re.description||null,category:re.category,difficulty_level:re.difficulty_level,time_limit_minutes:re.time_limit_minutes}).eq("id",ie.id);if(e)throw e;l.success("Test updated successfully"),ae(null),xe(),oe()}catch(e){console.error("Error updating test:",e),l.error("Failed to update test")}else l.error("Please enter a test title")},className:"bg-teal-500 hover:bg-teal-600 text-white",children:"Save Changes"})]})]})})]})})};export{se as default};
