import{r as e,j as s,u as t,c as r}from"./vendor-react-rLLBBC7n.js";import{C as a,b as n,c as i,o as l,a as c,L as o,T as d,B as m,e as u,J as x,s as h,n as p,D as g,f as j,g as f,h as w,W as N,S as v,i as b,j as y,k as _,l as q,I as k,X as C}from"./index-BDl0jLJK.js";import{T as A,a as S,b as T,c as Q}from"./tabs-CFW1rRMF.js";import{A as I,a as E,b as M,c as P,d as F,e as O,f as z,g as L,h as R}from"./alert-dialog-C3e0CSUs.js";import{A as B}from"./AdminLayout-DwaN-V0p.js";import{A as X,a as $}from"./alert-DtyL8j6a.js";import{S as D}from"./separator-C0bogF69.js";import{S as H}from"./scroll-area-DzIX_ywb.js";import{C as U}from"./checkbox-K7nwmoLP.js";import{E as V,ao as K,aj as W,cC as Y,bn as J,b4 as Z,cj as G,ap as ee,b7 as se,ak as te,aI as re,a_ as ae,b5 as ne,ar as ie,aN as le,av as ce,aY as oe}from"./vendor-ui-BGi_EvHx.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-charts-0DeywwxG.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";const de=({testId:t,onQuestionsImported:r})=>{const[p,g]=e.useState(""),[j,f]=e.useState(""),[w,N]=e.useState([]),[v,b]=e.useState(!1),[y,_]=e.useState(!1),[q,k]=e.useState(!1),[C,I]=e.useState(null),[E,M]=e.useState(!1),[P,F]=e.useState("questions"),O=(e,s)=>{var t;const r=[];let a=[];const n=e.split(/\n\s*\n/).filter(e=>e.trim());let i="",l=[];for(const o of n){const e=o.split("\n").map(e=>e.trim()).filter(e=>e);if(/^The\s+(nurse|client|patient)/i.test(e[0])||/^\d+\.\s*The/i.test(e[0])||e[0].includes("?")&&e.length>1){i&&l.length>0&&a.push({text:i,options:l});let s=0;for(let r=0;r<e.length;r++)if(e[r].includes("?")||e[r].toLowerCase().includes("select all that apply")){s=r;break}i=e.slice(0,s+1).join(" ");const t=e.slice(s+1);l=[];for(const e of t)if(e.includes(";"))l.push(...e.split(";").map(e=>e.trim()).filter(e=>e));else if(e.trim()){const s=e.replace(/^[a-zA-Z][.)]\s*/,"").trim();s&&l.push(s)}}else if(i){const e=o.split("\n").map(e=>e.trim()).filter(e=>e);for(const s of e)if(s.includes(";"))l.push(...s.split(";").map(e=>e.trim()).filter(e=>e));else{const e=s.replace(/^[a-zA-Z][.)]\s*/,"").trim();e&&!e.toLowerCase().startsWith("the nurse")&&l.push(e)}}}i&&l.length>0&&a.push({text:i,options:l});const c={};if(s.trim()){const e=/(\d+)\.\s*Number\s*(\d+)\s*is\s*correct\.?\s*(?:\n|\s)*Rationale:\s*([\s\S]*?)(?=\d+\.\s*Number|\n\s*\n\s*\n|$)/gi;let r;for(;null!==(r=e.exec(s));){const e=parseInt(r[1]),s=parseInt(r[2]),t=r[3].trim();c[e]={correct:[s-1],rationale:t}}if(0===Object.keys(c).length){const e=/(\d+)\.\s*Number\s*(\d+)\s*is\s*correct\.?\s*([\s\S]*?)(?=\d+\.\s*Number|$)/gi;for(;null!==(r=e.exec(s));){const e=parseInt(r[1]),s=parseInt(r[2]);let a=(null==(t=r[3])?void 0:t.trim())||"";a=a.replace(/^Rationale:\s*/i,"").trim(),c[e]||(c[e]={correct:[s-1],rationale:a})}}if(0===Object.keys(c).length){const e=s.split(/(?=\d+\.\s*Number)/i).filter(e=>e.trim());for(const s of e){const e=s.match(/(\d+)\.\s*Number\s*(\d+)\s*is\s*correct/i);if(e){const t=parseInt(e[1]),r=parseInt(e[2]);let a=s.substring(e[0].length);a=a.replace(/^[\.\s]*Rationale:\s*/i,"").trim(),c[t]={correct:[r-1],rationale:a}}}}}return a.forEach((e,s)=>{const t=s+1,a=e.text.toLowerCase().includes("select all that apply"),n=c[t]||{correct:[],rationale:""};r.push({id:`temp-${t}`,question_number:t,question_text:e.text.trim(),question_type:a?"SATA":"MCQ",options:e.options,correct_answers:n.correct,rationale:n.rationale,original_text:e.text.trim(),is_modified:!1,use_suggested:!1})}),r},z=()=>{g(""),f(""),N([]),M(!1),I(null),F("questions")};return s.jsxs(a,{children:[s.jsxs(n,{children:[s.jsxs(i,{className:"flex items-center gap-2",children:[s.jsx(V,{className:"h-5 w-5"}),"Import Questions via Copy-Paste"]}),s.jsx(l,{children:"Paste NCLEX questions with their answer key. The parser will automatically detect questions, options, correct answers, and rationales."})]}),s.jsx(c,{className:"space-y-4",children:E?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.jsxs(u,{variant:"outline",className:"text-lg px-3 py-1",children:[w.length," Questions Parsed"]}),s.jsxs(u,{variant:"secondary",children:[w.filter(e=>"SATA"===e.question_type).length," SATA"]}),s.jsxs(u,{variant:"secondary",children:[w.filter(e=>"MCQ"===e.question_type).length," MCQ"]})]}),s.jsxs(m,{variant:"ghost",size:"sm",onClick:z,children:[s.jsx(G,{className:"h-4 w-4 mr-1"}),"Start Over"]})]}),s.jsx(a,{className:"p-4 "+(w.every(e=>e.correct_answers.length>0)?"bg-green-50 dark:bg-green-900/20 border-green-200":"bg-amber-50 dark:bg-amber-900/20 border-amber-200"),children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[w.every(e=>e.correct_answers.length>0)?s.jsx(W,{className:"h-5 w-5 text-green-600"}):s.jsx(Z,{className:"h-5 w-5 text-amber-600"}),s.jsxs("div",{children:[s.jsxs("p",{className:"font-medium text-sm",children:[w.filter(e=>e.correct_answers.length>0).length," / ",w.length," questions have correct answers set"]}),s.jsxs("p",{className:"text-xs text-muted-foreground",children:[w.filter(e=>e.rationale).length," / ",w.length," have rationales"]})]})]}),w.some(e=>0===e.correct_answers.length)&&s.jsxs(u,{variant:"destructive",className:"animate-pulse",children:[w.filter(e=>0===e.correct_answers.length).length," need answers"]})]})}),s.jsx(D,{}),s.jsx(a,{className:"bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 border-purple-200 dark:border-purple-800",children:s.jsx(c,{className:"p-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center flex-shrink-0",children:s.jsx(se,{className:"h-5 w-5 text-white"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"font-semibold mb-1",children:"AI-Powered Modifications"}),s.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"Let AI suggest slight rewording to questions while preserving the exact medical meaning."}),s.jsx(m,{onClick:async()=>{if(0!==w.length){_(!0);try{const e=await fetch("https://cuumxmfzhwljylbdlflj.supabase.co/functions/v1/nclex-modify-questions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({questions:w.map(e=>({question_text:e.question_text,options:e.options,rationale:e.rationale}))})});if(!e.ok)throw new Error("Failed to get AI modifications");const s=await e.json(),t=w.map((e,t)=>{var r,a,n,i,l,c;return{...e,suggested_text:(null==(a=null==(r=s.modifications)?void 0:r[t])?void 0:a.question_text)||e.question_text,options:(null==(i=null==(n=s.modifications)?void 0:n[t])?void 0:i.options)||e.options,rationale:(null==(c=null==(l=s.modifications)?void 0:l[t])?void 0:c.rationale)||e.rationale,is_modified:!0}});N(t),x.success("AI modifications generated! Review and accept changes.")}catch(e){console.error("Error getting AI modifications:",e),x.error("Failed to generate AI modifications. You can still save the original questions.")}finally{_(!1)}}},disabled:y,className:"bg-gradient-to-r from-purple-500 to-blue-500 hover:from-purple-600 hover:to-blue-600 text-white",children:y?s.jsxs(s.Fragment,{children:[s.jsx(G,{className:"h-4 w-4 mr-2 animate-spin"}),"Generating..."]}):s.jsxs(s.Fragment,{children:[s.jsx(te,{className:"h-4 w-4 mr-2"}),"Suggest Modifications"]})})]})]})})}),w.some(e=>e.suggested_text)&&s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(m,{variant:"outline",size:"sm",onClick:()=>{const e=w.map(e=>({...e,use_suggested:!0}));N(e)},children:[s.jsx(W,{className:"h-4 w-4 mr-1 text-green-500"}),"Accept All Suggestions"]}),s.jsxs(m,{variant:"outline",size:"sm",onClick:()=>{const e=w.map(e=>({...e,use_suggested:!1}));N(e)},children:[s.jsx(re,{className:"h-4 w-4 mr-1 text-red-500"}),"Keep All Originals"]})]}),s.jsx(H,{className:"h-[500px] border rounded-lg p-4",children:s.jsx("div",{className:"space-y-6",children:w.map((e,t)=>s.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:"font-bold",children:["Q",e.question_number,"."]}),s.jsx(u,{variant:"SATA"===e.question_type?"default":"secondary",children:e.question_type}),0===e.correct_answers.length&&s.jsx(u,{variant:"destructive",className:"animate-pulse",children:"⚠️ Set correct answer"}),e.correct_answers.length>0&&s.jsxs(u,{className:"bg-green-100 text-green-700",children:[s.jsx(W,{className:"h-3 w-3 mr-1"}),"Answer set"]})]}),e.suggested_text&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(U,{checked:e.use_suggested,onCheckedChange:()=>(e=>{const s=[...w];s[e].use_suggested=!s[e].use_suggested,N(s)})(t)}),s.jsx("span",{className:"text-xs text-muted-foreground",children:"Use AI version"})]})]}),e.suggested_text&&e.suggested_text!==e.original_text?s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"p-3 rounded-lg "+(e.use_suggested?"bg-muted":"bg-green-50 dark:bg-green-900/20 border-green-200"),children:[s.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Original"}),s.jsx("p",{className:"text-sm",children:e.original_text})]}),s.jsxs("div",{className:"p-3 rounded-lg "+(e.use_suggested?"bg-purple-50 dark:bg-purple-900/20 border-purple-200":"bg-muted"),children:[s.jsxs("p",{className:"text-xs text-muted-foreground mb-1 flex items-center gap-1",children:[s.jsx(se,{className:"h-3 w-3"})," AI Suggested"]}),s.jsx("p",{className:"text-sm",children:e.suggested_text})]})]}):s.jsx("p",{className:"text-sm",children:e.question_text}),s.jsxs("div",{className:"space-y-1",children:[s.jsxs("p",{className:"text-xs text-muted-foreground mb-2 flex items-center gap-1",children:[s.jsx(ae,{className:"h-3 w-3"}),"Click options to set correct answer","SATA"===e.question_type?"(s)":"",":"]}),e.options.map((r,a)=>s.jsx("div",{onClick:()=>((e,s)=>{const t=[...w],r=t[e];"MCQ"===r.question_type?r.correct_answers=[s]:r.correct_answers.includes(s)?r.correct_answers=r.correct_answers.filter(e=>e!==s):r.correct_answers=[...r.correct_answers,s],N(t)})(t,a),className:"text-sm px-3 py-2 rounded cursor-pointer transition-all border-2 "+(e.correct_answers.includes(a)?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 border-green-400":"bg-muted border-transparent hover:border-gray-300 hover:bg-muted/80"),children:s.jsxs("div",{className:"flex items-center gap-2",children:["SATA"===e.question_type?s.jsx("div",{className:"w-4 h-4 border-2 rounded flex items-center justify-center "+(e.correct_answers.includes(a)?"border-green-500 bg-green-500":"border-gray-400"),children:e.correct_answers.includes(a)&&s.jsx(W,{className:"h-3 w-3 text-white"})}):s.jsx("div",{className:"w-4 h-4 border-2 rounded-full flex items-center justify-center "+(e.correct_answers.includes(a)?"border-green-500 bg-green-500":"border-gray-400"),children:e.correct_answers.includes(a)&&s.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})}),s.jsxs("span",{children:[a+1,". ",r]})]})},a))]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs(o,{className:"text-xs text-muted-foreground flex items-center gap-1",children:[s.jsx(ee,{className:"h-3 w-3"}),"Rationale (explain why the answer is correct):"]}),s.jsx(d,{value:e.rationale,onChange:e=>((e,s)=>{const t=[...w];t[e].rationale=s,N(t)})(t,e.target.value),placeholder:"Enter rationale for this question...",className:"text-sm min-h-[80px]"})]})]},e.id))})}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(m,{variant:"outline",onClick:z,className:"flex-1",children:"Cancel"}),s.jsx(m,{onClick:async()=>{if(0===w.length)return;const e=w.filter(e=>0===e.correct_answers.length);if(e.length>0){if(!window.confirm(`${e.length} question(s) don't have correct answers set. Save anyway?`))return}k(!0);try{const{data:e}=await h.from("nclex_questions").select("question_number").eq("test_id",t).order("question_number",{ascending:!1}).limit(1),s=e&&e.length>0?e[0].question_number+1:1,a=w.map((e,r)=>({test_id:t,question_number:s+r,question_text:e.use_suggested&&e.suggested_text?e.suggested_text:e.question_text,question_type:e.question_type,options:e.options,correct_answers:e.correct_answers,rationale:e.rationale,original_text:e.original_text,is_modified:e.use_suggested&&e.suggested_text!==e.original_text})),{error:n}=await h.from("nclex_questions").insert(a);if(n)throw n;x.success(`${a.length} questions saved successfully!`),r(w),setRawText(""),N([]),M(!1)}catch(s){console.error("Error saving questions:",s),x.error("Failed to save questions")}finally{k(!1)}},disabled:q||0===w.length,className:"flex-1 bg-teal-500 hover:bg-teal-600 text-white",children:q?s.jsxs(s.Fragment,{children:[s.jsx(G,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):s.jsxs(s.Fragment,{children:[s.jsx(ne,{className:"h-4 w-4 mr-2"}),"Save ",w.length," Questions"]})})]})]}):s.jsxs(s.Fragment,{children:[s.jsxs(A,{value:P,onValueChange:F,className:"w-full",children:[s.jsxs(S,{className:"grid w-full grid-cols-2",children:[s.jsxs(T,{value:"questions",className:"flex items-center gap-2",children:[s.jsx(K,{className:"h-4 w-4"}),"Questions",p.trim()&&s.jsx(W,{className:"h-3 w-3 text-green-500"})]}),s.jsxs(T,{value:"answers",className:"flex items-center gap-2",children:[s.jsx(Y,{className:"h-4 w-4"}),"Answer Key & Rationale",j.trim()&&s.jsx(W,{className:"h-3 w-3 text-green-500"})]})]}),s.jsxs(Q,{value:"questions",className:"space-y-3 mt-4",children:[s.jsx(o,{className:"text-sm font-medium",children:"Paste Questions Here"}),s.jsx(d,{value:p,onChange:e=>g(e.target.value),placeholder:"Paste your NCLEX questions here. Example:\n\nThe nurse is caring for a client with cardiogenic shock. The nurse expects which signs present with this client? Select all that apply.\nhypertension; slow, labored breathing\ndecreased urine output; warm, pink skin\nincreased urine output; cool, clammy skin\nhypotension; weak pulse; cool, clammy skin\n\nThe nurse is caring for a client with a sacral wound. The wound is full thickness, measures 4 cm × 6 cm with irregular borders, and is covered by a layer of black collagen. Which is this wound stage?\nStage I\nStage II\nStage III\nunstageable",className:"min-h-[250px] font-mono text-sm"}),s.jsxs(X,{className:"bg-blue-50 dark:bg-blue-900/20 border-blue-200",children:[s.jsx(J,{className:"h-4 w-4 text-blue-500"}),s.jsxs($,{className:"text-sm",children:[s.jsx("strong",{children:"Tip:"}),' Include "Select all that apply" in questions for SATA type. Options can be on separate lines or separated by semicolons.']})]})]}),s.jsxs(Q,{value:"answers",className:"space-y-3 mt-4",children:[s.jsx(o,{className:"text-sm font-medium",children:"Paste Answer Key & Rationale Here"}),s.jsx(d,{value:j,onChange:e=>f(e.target.value),placeholder:"Paste the answer key and rationales here. Example:\n\n1. Number 4 is correct.\nRationale: Hypotension, weak pulse, and cool clammy skin are classic signs of cardiogenic shock. The heart cannot pump effectively, leading to decreased cardiac output and peripheral vasoconstriction.\n\n2. Number 4 is correct.\nRationale: A wound covered by black collagen (eschar) is unstageable because the true depth cannot be determined until the eschar is removed.\n\n3. Number 1 is correct.\nRationale: A Braden score of 13 indicates high risk for skin breakdown. Scores range from 6-23, with lower scores indicating higher risk.",className:"min-h-[250px] font-mono text-sm"}),s.jsxs(X,{className:"bg-amber-50 dark:bg-amber-900/20 border-amber-200",children:[s.jsx(Z,{className:"h-4 w-4 text-amber-500"}),s.jsxs($,{className:"text-sm",children:[s.jsx("strong",{children:"Format:"}),' Use "Number X is correct" pattern. The X refers to the option number (1 = first option, 2 = second, etc.)']})]})]})]}),C&&s.jsxs(X,{variant:"destructive",children:[s.jsx(Z,{className:"h-4 w-4"}),s.jsx($,{children:C})]}),s.jsx(D,{}),s.jsx("div",{className:"flex gap-2",children:s.jsx(m,{onClick:()=>{b(!0),I(null);try{const e=O(p,j);0===e.length?(I("No questions could be parsed. Please check the format."),N([])):(N(e),M(!0),x.success(`Parsed ${e.length} questions successfully`))}catch(e){I(e.message||"Failed to parse questions"),N([])}finally{b(!1)}},disabled:!p.trim()||v,className:"flex-1 bg-teal-500 hover:bg-teal-600 text-white",children:v?s.jsxs(s.Fragment,{children:[s.jsx(G,{className:"h-4 w-4 mr-2 animate-spin"}),"Parsing..."]}):s.jsxs(s.Fragment,{children:[s.jsx(ee,{className:"h-4 w-4 mr-2"}),"Parse Questions ",j.trim()?"& Answers":""]})})}),!j.trim()&&p.trim()&&s.jsxs(X,{className:"bg-purple-50 dark:bg-purple-900/20 border-purple-200",children:[s.jsx(se,{className:"h-4 w-4 text-purple-500"}),s.jsxs($,{className:"text-sm",children:[s.jsx("strong",{children:"No answers?"})," You can still parse questions and manually set correct answers in the preview, or let AI help later."]})]})]})})]})},me=()=>{const X=t(),{testId:$}=r(),{admin:D,loading:H}=p(),[U,Y]=e.useState(null),[J,Z]=e.useState([]),[G,te]=e.useState(!0),[me,ue]=e.useState(null),[xe,he]=e.useState(!1),[pe,ge]=e.useState({question_text:"",question_type:"MCQ",options:["","","",""],correct_answers:[],rationale:""});e.useEffect(()=>{H||D?$&&je():X("/admin/login")},[D,H,$]);const je=async()=>{try{const{data:e,error:s}=await h.from("nclex_tests").select("*").eq("id",$).single();if(s||!e)return x.error("Test not found"),void X("/admin/nclex");Y(e);const{data:t,error:r}=await h.from("nclex_questions").select("*").eq("test_id",$).order("question_number",{ascending:!0});r?console.error("Error loading questions:",r):Z(t||[])}catch(e){console.error("Error:",e)}finally{te(!1)}},fe=()=>{ge({question_text:"",question_type:"MCQ",options:["","","",""],correct_answers:[],rationale:""})},we=e=>{if("MCQ"===pe.question_type)ge({...pe,correct_answers:[e]});else{const s=pe.correct_answers;s.includes(e)?ge({...pe,correct_answers:s.filter(s=>s!==e)}):ge({...pe,correct_answers:[...s,e]})}},Ne=()=>{pe.options.length<8&&ge({...pe,options:[...pe.options,""]})},ve=e=>{if(pe.options.length>2){const s=pe.options.filter((s,t)=>t!==e),t=pe.correct_answers.filter(s=>s!==e).map(s=>s>e?s-1:s);ge({...pe,options:s,correct_answers:t})}};return H||G?s.jsx(B,{title:"NCLEX Test",showBackButton:!0,children:s.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-teal-500"})})}):U?s.jsx(B,{title:U.title,showBackButton:!0,children:s.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[s.jsx(a,{children:s.jsx(c,{className:"p-6",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-teal-500 to-cyan-500 flex items-center justify-center",children:s.jsx(ie,{className:"h-7 w-7 text-white"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold",children:U.title}),s.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.jsx(u,{variant:"outline",children:U.category}),s.jsx(u,{className:"Easy"===U.difficulty_level?"bg-green-100 text-green-700":"Hard"===U.difficulty_level?"bg-red-100 text-red-700":"bg-amber-100 text-amber-700",children:U.difficulty_level}),U.is_published?s.jsx(u,{className:"bg-green-100 text-green-700",children:"Published"}):s.jsx(u,{variant:"secondary",children:"Draft"})]})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-3xl font-bold text-teal-500",children:J.length}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"Questions"})]})]})})}),s.jsxs(A,{defaultValue:"import",className:"space-y-6",children:[s.jsxs(S,{className:"grid w-full grid-cols-3",children:[s.jsxs(T,{value:"import",children:[s.jsx(V,{className:"h-4 w-4 mr-2"}),"Import Questions"]}),s.jsxs(T,{value:"questions",children:[s.jsx(ee,{className:"h-4 w-4 mr-2"}),"Manage Questions (",J.length,")"]}),s.jsxs(T,{value:"preview",children:[s.jsx(le,{className:"h-4 w-4 mr-2"}),"Preview"]})]}),s.jsx(Q,{value:"import",children:s.jsx(de,{testId:$,onQuestionsImported:e=>{je(),x.success(`${e.length} questions imported successfully`)}})}),s.jsx(Q,{value:"questions",children:s.jsxs(a,{children:[s.jsxs(n,{className:"flex flex-row items-center justify-between",children:[s.jsxs("div",{children:[s.jsx(i,{children:"Questions"}),s.jsx(l,{children:"Add, edit, or remove questions from this test"})]}),s.jsxs(m,{onClick:()=>he(!0),children:[s.jsx(ce,{className:"h-4 w-4 mr-2"}),"Add Question"]})]}),s.jsx(c,{children:0===J.length?s.jsxs("div",{className:"text-center py-12",children:[s.jsx(K,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),s.jsx("p",{className:"text-muted-foreground",children:"No questions yet"}),s.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Use the Import tab to paste questions, or add them manually"})]}):s.jsx("div",{className:"space-y-4",children:J.map((e,t)=>s.jsx("div",{className:"border rounded-lg p-4 hover:bg-muted/50 transition-colors",children:s.jsxs("div",{className:"flex items-start justify-between gap-4",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsxs("span",{className:"font-semibold text-sm",children:["Q",e.question_number,"."]}),s.jsx(u,{variant:"SATA"===e.question_type?"default":"secondary",children:e.question_type}),e.is_modified&&s.jsxs(u,{variant:"outline",className:"text-purple-600 border-purple-200",children:[s.jsx(se,{className:"h-3 w-3 mr-1"}),"AI Modified"]})]}),s.jsx("p",{className:"text-sm mb-3",children:e.question_text}),s.jsx("div",{className:"space-y-1",children:e.options.map((t,r)=>s.jsxs("div",{className:"text-xs px-2 py-1 rounded "+(e.correct_answers.includes(r)?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-muted"),children:[e.correct_answers.includes(r)&&s.jsx(W,{className:"h-3 w-3 inline mr-1"}),t]},r))}),e.rationale&&s.jsxs("p",{className:"text-xs text-muted-foreground mt-2 italic",children:["Rationale: ",e.rationale.substring(0,100),"..."]})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(m,{variant:"ghost",size:"sm",onClick:()=>(e=>{ue(e),ge({question_text:e.question_text,question_type:e.question_type,options:[...e.options,"","","",""].slice(0,4),correct_answers:[...e.correct_answers],rationale:e.rationale||""})})(e),children:s.jsx(ae,{className:"h-4 w-4"})}),s.jsxs(I,{children:[s.jsx(E,{asChild:!0,children:s.jsx(m,{variant:"ghost",size:"sm",className:"text-red-500 hover:text-red-600",children:s.jsx(oe,{className:"h-4 w-4"})})}),s.jsxs(M,{children:[s.jsxs(P,{children:[s.jsx(F,{children:"Delete Question?"}),s.jsx(O,{children:"This will permanently delete this question."})]}),s.jsxs(z,{children:[s.jsx(L,{children:"Cancel"}),s.jsx(R,{onClick:()=>(async e=>{try{const{error:s}=await h.from("nclex_questions").delete().eq("id",e);if(s)throw s;x.success("Question deleted"),je()}catch(s){console.error("Error deleting question:",s),x.error("Failed to delete question")}})(e.id),className:"bg-red-500 hover:bg-red-600",children:"Delete"})]})]})]})]})]})},e.id))})})]})}),s.jsx(Q,{value:"preview",children:s.jsxs(a,{children:[s.jsxs(n,{children:[s.jsx(i,{children:"Student Preview"}),s.jsx(l,{children:"See how questions will appear to students"})]}),s.jsx(c,{children:0===J.length?s.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No questions to preview"}):s.jsxs("div",{className:"space-y-6",children:[J.slice(0,5).map(e=>s.jsxs("div",{className:"border rounded-lg p-6",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsxs("span",{className:"text-sm text-muted-foreground",children:["Question ",e.question_number]}),s.jsx(u,{variant:"SATA"===e.question_type?"default":"secondary",children:"SATA"===e.question_type?"Select All That Apply":"Multiple Choice"})]}),s.jsx("p",{className:"text-lg mb-4",children:e.question_text}),s.jsx("div",{className:"space-y-2",children:e.options.map((t,r)=>s.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg hover:bg-muted/50 cursor-pointer",children:["SATA"===e.question_type?s.jsx("div",{className:"w-5 h-5 border-2 rounded"}):s.jsx("div",{className:"w-5 h-5 border-2 rounded-full"}),s.jsx("span",{children:t})]},r))})]},e.id)),J.length>5&&s.jsxs("p",{className:"text-center text-muted-foreground",children:["+ ",J.length-5," more questions"]})]})})]})})]}),s.jsx(g,{open:xe,onOpenChange:he,children:s.jsxs(j,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[s.jsxs(f,{children:[s.jsx(w,{children:"Add New Question"}),s.jsx(N,{children:"Create a new NCLEX question manually"})]}),s.jsxs("div",{className:"space-y-4 py-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{children:"Question Type"}),s.jsxs(v,{value:pe.question_type,onValueChange:e=>{ge({...pe,question_type:e,correct_answers:"MCQ"===e?pe.correct_answers.slice(0,1):pe.correct_answers})},children:[s.jsx(b,{children:s.jsx(y,{})}),s.jsxs(_,{children:[s.jsx(q,{value:"MCQ",children:"Multiple Choice (Single Answer)"}),s.jsx(q,{value:"SATA",children:"Select All That Apply"})]})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{children:"Question Text *"}),s.jsx(d,{value:pe.question_text,onChange:e=>ge({...pe,question_text:e.target.value}),placeholder:"Enter the question text...",rows:3})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(o,{children:"Options (click to mark as correct)"}),s.jsxs(m,{type:"button",variant:"ghost",size:"sm",onClick:Ne,children:[s.jsx(ce,{className:"h-4 w-4 mr-1"}),"Add Option"]})]}),pe.options.map((e,t)=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(m,{type:"button",variant:pe.correct_answers.includes(t)?"default":"outline",size:"sm",className:pe.correct_answers.includes(t)?"bg-green-500 hover:bg-green-600":"",onClick:()=>we(t),children:pe.correct_answers.includes(t)?s.jsx(W,{className:"h-4 w-4"}):s.jsx("span",{className:"w-4 text-center",children:t+1})}),s.jsx(k,{value:e,onChange:e=>{const s=[...pe.options];s[t]=e.target.value,ge({...pe,options:s})},placeholder:`Option ${t+1}`,className:"flex-1"}),pe.options.length>2&&s.jsx(m,{type:"button",variant:"ghost",size:"sm",onClick:()=>ve(t),className:"text-red-500",children:s.jsx(re,{className:"h-4 w-4"})})]},t)),s.jsx("p",{className:"text-xs text-muted-foreground",children:"SATA"===pe.question_type?"Select ALL correct answers":"Select ONE correct answer"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{children:"Rationale"}),s.jsx(d,{value:pe.rationale,onChange:e=>ge({...pe,rationale:e.target.value}),placeholder:"Explain why the answer(s) are correct...",rows:3})]})]}),s.jsxs(C,{children:[s.jsx(m,{variant:"outline",onClick:()=>{he(!1),fe()},children:"Cancel"}),s.jsxs(m,{onClick:async()=>{if(pe.question_text.trim())if(pe.options.filter(e=>e.trim()).length<2)x.error("Please enter at least 2 options");else if(0!==pe.correct_answers.length)try{const e=J.length>0?Math.max(...J.map(e=>e.question_number))+1:1,{error:s}=await h.from("nclex_questions").insert({test_id:$,question_number:e,question_text:pe.question_text,question_type:pe.question_type,options:pe.options.filter(e=>e.trim()),correct_answers:pe.correct_answers,rationale:pe.rationale||null});if(s)throw s;x.success("Question added successfully"),he(!1),fe(),je()}catch(e){console.error("Error adding question:",e),x.error("Failed to add question")}else x.error("Please select at least one correct answer");else x.error("Please enter question text")},className:"bg-teal-500 hover:bg-teal-600 text-white",children:[s.jsx(ne,{className:"h-4 w-4 mr-2"}),"Add Question"]})]})]})}),s.jsx(g,{open:!!me,onOpenChange:e=>!e&&ue(null),children:s.jsxs(j,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[s.jsxs(f,{children:[s.jsx(w,{children:"Edit Question"}),s.jsx(N,{children:"Update question details"})]}),s.jsxs("div",{className:"space-y-4 py-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{children:"Question Type"}),s.jsxs(v,{value:pe.question_type,onValueChange:e=>{ge({...pe,question_type:e,correct_answers:"MCQ"===e?pe.correct_answers.slice(0,1):pe.correct_answers})},children:[s.jsx(b,{children:s.jsx(y,{})}),s.jsxs(_,{children:[s.jsx(q,{value:"MCQ",children:"Multiple Choice (Single Answer)"}),s.jsx(q,{value:"SATA",children:"Select All That Apply"})]})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{children:"Question Text *"}),s.jsx(d,{value:pe.question_text,onChange:e=>ge({...pe,question_text:e.target.value}),rows:3})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(o,{children:"Options (click to mark as correct)"}),s.jsxs(m,{type:"button",variant:"ghost",size:"sm",onClick:Ne,children:[s.jsx(ce,{className:"h-4 w-4 mr-1"}),"Add Option"]})]}),pe.options.map((e,t)=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(m,{type:"button",variant:pe.correct_answers.includes(t)?"default":"outline",size:"sm",className:pe.correct_answers.includes(t)?"bg-green-500 hover:bg-green-600":"",onClick:()=>we(t),children:pe.correct_answers.includes(t)?s.jsx(W,{className:"h-4 w-4"}):s.jsx("span",{className:"w-4 text-center",children:t+1})}),s.jsx(k,{value:e,onChange:e=>{const s=[...pe.options];s[t]=e.target.value,ge({...pe,options:s})},className:"flex-1"}),pe.options.length>2&&s.jsx(m,{type:"button",variant:"ghost",size:"sm",onClick:()=>ve(t),className:"text-red-500",children:s.jsx(re,{className:"h-4 w-4"})})]},t))]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{children:"Rationale"}),s.jsx(d,{value:pe.rationale,onChange:e=>ge({...pe,rationale:e.target.value}),rows:3})]})]}),s.jsxs(C,{children:[s.jsx(m,{variant:"outline",onClick:()=>{ue(null),fe()},children:"Cancel"}),s.jsxs(m,{onClick:async()=>{if(me)try{const{error:e}=await h.from("nclex_questions").update({question_text:pe.question_text,question_type:pe.question_type,options:pe.options.filter(e=>e.trim()),correct_answers:pe.correct_answers,rationale:pe.rationale||null}).eq("id",me.id);if(e)throw e;x.success("Question updated successfully"),ue(null),fe(),je()}catch(e){console.error("Error updating question:",e),x.error("Failed to update question")}},className:"bg-teal-500 hover:bg-teal-600 text-white",children:[s.jsx(ne,{className:"h-4 w-4 mr-2"}),"Save Changes"]})]})]})})]})}):s.jsx(B,{title:"NCLEX Test",showBackButton:!0,children:s.jsxs("div",{className:"text-center py-12",children:[s.jsx("p",{className:"text-muted-foreground",children:"Test not found"}),s.jsx(m,{onClick:()=>X("/admin/nclex"),className:"mt-4",children:"Back to NCLEX Admin"})]})})};export{me as default};
