import{c as e,r as s,j as t,C as r,b as a,d as n,U as i,y as l,a as c,e as o,ax as d,R as m,T as x,B as h,F as u,l as p,O as g,a6 as j,J as f,u as w,G as N,w as v,A as b,E as y,P as _,D as q,m as k,n as C,o as A,bp as S,S as T,p as Q,q as I,s as E,t as M,I as P,bs as F}from"./index-CxMzLT99.js";import{T as O,a as R,b as z,c as L}from"./tabs-CFSaERaA.js";import{A as B,a as X,b as $,c as U,d as D,e as H,f as V,g as G,h as K}from"./alert-dialog-BOQfHwGZ.js";import{A as W}from"./AdminLayout-BHeTYFfK.js";import{A as Z,a as J}from"./alert-CO9oz2Sm.js";import{S as Y}from"./separator-BwJ1WXpd.js";import{S as ee}from"./scroll-area-QJB5wpdZ.js";import{C as se}from"./checkbox-RnvFcmUo.js";import{s as te}from"./supabase-DWL4C3fA.js";import{C as re}from"./circle-help-BqGRNgf9.js";import{C as ae}from"./circle-alert-ColVjy4e.js";import{R as ne}from"./refresh-cw-D5ygmlPc.js";import{W as ie}from"./wand-sparkles-TIzYWqyl.js";import{P as le}from"./pen-line-ay-KYWTd.js";import{S as ce}from"./save-BSJIamZj.js";import{T as oe}from"./trash-2-DMIxfgpl.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=e("ListChecks",[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]),me=({testId:e,onQuestionsImported:w})=>{const[N,v]=s.useState(""),[b,y]=s.useState(""),[_,q]=s.useState([]),[k,C]=s.useState(!1),[A,S]=s.useState(!1),[T,Q]=s.useState(!1),[I,E]=s.useState(null),[M,P]=s.useState(!1),[F,B]=s.useState("questions"),X=(e,s)=>{var t;const r=[];let a=[];const n=e.split(/\n\s*\n/).filter(e=>e.trim());let i="",l=[];for(const o of n){const e=o.split("\n").map(e=>e.trim()).filter(e=>e);if(/^The\s+(nurse|client|patient)/i.test(e[0])||/^\d+\.\s*The/i.test(e[0])||e[0].includes("?")&&e.length>1){i&&l.length>0&&a.push({text:i,options:l});let s=0;for(let r=0;r<e.length;r++)if(e[r].includes("?")||e[r].toLowerCase().includes("select all that apply")){s=r;break}i=e.slice(0,s+1).join(" ");const t=e.slice(s+1);l=[];for(const e of t)if(e.includes(";"))l.push(...e.split(";").map(e=>e.trim()).filter(e=>e));else if(e.trim()){const s=e.replace(/^[a-zA-Z][.)]\s*/,"").trim();s&&l.push(s)}}else if(i){const e=o.split("\n").map(e=>e.trim()).filter(e=>e);for(const s of e)if(s.includes(";"))l.push(...s.split(";").map(e=>e.trim()).filter(e=>e));else{const e=s.replace(/^[a-zA-Z][.)]\s*/,"").trim();e&&!e.toLowerCase().startsWith("the nurse")&&l.push(e)}}}i&&l.length>0&&a.push({text:i,options:l});const c={};if(s.trim()){const e=/(\d+)\.\s*Number\s*(\d+)\s*is\s*correct\.?\s*(?:\n|\s)*Rationale:\s*([\s\S]*?)(?=\d+\.\s*Number|\n\s*\n\s*\n|$)/gi;let r;for(;null!==(r=e.exec(s));){const e=parseInt(r[1]),s=parseInt(r[2]),t=r[3].trim();c[e]={correct:[s-1],rationale:t}}if(0===Object.keys(c).length){const e=/(\d+)\.\s*Number\s*(\d+)\s*is\s*correct\.?\s*([\s\S]*?)(?=\d+\.\s*Number|$)/gi;for(;null!==(r=e.exec(s));){const e=parseInt(r[1]),s=parseInt(r[2]);let a=(null==(t=r[3])?void 0:t.trim())||"";a=a.replace(/^Rationale:\s*/i,"").trim(),c[e]||(c[e]={correct:[s-1],rationale:a})}}if(0===Object.keys(c).length){const e=s.split(/(?=\d+\.\s*Number)/i).filter(e=>e.trim());for(const s of e){const e=s.match(/(\d+)\.\s*Number\s*(\d+)\s*is\s*correct/i);if(e){const t=parseInt(e[1]),r=parseInt(e[2]);let a=s.substring(e[0].length);a=a.replace(/^[\.\s]*Rationale:\s*/i,"").trim(),c[t]={correct:[r-1],rationale:a}}}}}return a.forEach((e,s)=>{const t=s+1,a=e.text.toLowerCase().includes("select all that apply"),n=c[t]||{correct:[],rationale:""};r.push({id:`temp-${t}`,question_number:t,question_text:e.text.trim(),question_type:a?"SATA":"MCQ",options:e.options,correct_answers:n.correct,rationale:n.rationale,original_text:e.text.trim(),is_modified:!1,use_suggested:!1})}),r},$=()=>{v(""),y(""),q([]),P(!1),E(null),B("questions")};return t.jsxs(r,{children:[t.jsxs(a,{children:[t.jsxs(n,{className:"flex items-center gap-2",children:[t.jsx(i,{className:"h-5 w-5"}),"Import Questions via Copy-Paste"]}),t.jsx(l,{children:"Paste NCLEX questions with their answer key. The parser will automatically detect questions, options, correct answers, and rationales."})]}),t.jsx(c,{className:"space-y-4",children:M?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[t.jsxs(p,{variant:"outline",className:"text-lg px-3 py-1",children:[_.length," Questions Parsed"]}),t.jsxs(p,{variant:"secondary",children:[_.filter(e=>"SATA"===e.question_type).length," SATA"]}),t.jsxs(p,{variant:"secondary",children:[_.filter(e=>"MCQ"===e.question_type).length," MCQ"]})]}),t.jsxs(h,{variant:"ghost",size:"sm",onClick:$,children:[t.jsx(ne,{className:"h-4 w-4 mr-1"}),"Start Over"]})]}),t.jsx(r,{className:"p-4 "+(_.every(e=>e.correct_answers.length>0)?"bg-green-50 dark:bg-green-900/20 border-green-200":"bg-amber-50 dark:bg-amber-900/20 border-amber-200"),children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[_.every(e=>e.correct_answers.length>0)?t.jsx(d,{className:"h-5 w-5 text-green-600"}):t.jsx(ae,{className:"h-5 w-5 text-amber-600"}),t.jsxs("div",{children:[t.jsxs("p",{className:"font-medium text-sm",children:[_.filter(e=>e.correct_answers.length>0).length," / ",_.length," questions have correct answers set"]}),t.jsxs("p",{className:"text-xs text-muted-foreground",children:[_.filter(e=>e.rationale).length," / ",_.length," have rationales"]})]})]}),_.some(e=>0===e.correct_answers.length)&&t.jsxs(p,{variant:"destructive",className:"animate-pulse",children:[_.filter(e=>0===e.correct_answers.length).length," need answers"]})]})}),t.jsx(Y,{}),t.jsx(r,{className:"bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 border-purple-200 dark:border-purple-800",children:t.jsx(c,{className:"p-4",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center flex-shrink-0",children:t.jsx(ie,{className:"h-5 w-5 text-white"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-semibold mb-1",children:"AI-Powered Modifications"}),t.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"Let AI suggest slight rewording to questions while preserving the exact medical meaning."}),t.jsx(h,{onClick:async()=>{if(0!==_.length){S(!0);try{const e=await fetch("https://cuumxmfzhwljylbdlflj.supabase.co/functions/v1/nclex-modify-questions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({questions:_.map(e=>({question_text:e.question_text,options:e.options,rationale:e.rationale}))})});if(!e.ok)throw new Error("Failed to get AI modifications");const s=await e.json(),t=_.map((e,t)=>{var r,a,n,i,l,c;return{...e,suggested_text:(null==(a=null==(r=s.modifications)?void 0:r[t])?void 0:a.question_text)||e.question_text,options:(null==(i=null==(n=s.modifications)?void 0:n[t])?void 0:i.options)||e.options,rationale:(null==(c=null==(l=s.modifications)?void 0:l[t])?void 0:c.rationale)||e.rationale,is_modified:!0}});q(t),f.success("AI modifications generated! Review and accept changes.")}catch(e){console.error("Error getting AI modifications:",e),f.error("Failed to generate AI modifications. You can still save the original questions.")}finally{S(!1)}}},disabled:A,className:"bg-gradient-to-r from-purple-500 to-blue-500 hover:from-purple-600 hover:to-blue-600 text-white",children:A?t.jsxs(t.Fragment,{children:[t.jsx(ne,{className:"h-4 w-4 mr-2 animate-spin"}),"Generating..."]}):t.jsxs(t.Fragment,{children:[t.jsx(g,{className:"h-4 w-4 mr-2"}),"Suggest Modifications"]})})]})]})})}),_.some(e=>e.suggested_text)&&t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(h,{variant:"outline",size:"sm",onClick:()=>{const e=_.map(e=>({...e,use_suggested:!0}));q(e)},children:[t.jsx(d,{className:"h-4 w-4 mr-1 text-green-500"}),"Accept All Suggestions"]}),t.jsxs(h,{variant:"outline",size:"sm",onClick:()=>{const e=_.map(e=>({...e,use_suggested:!1}));q(e)},children:[t.jsx(j,{className:"h-4 w-4 mr-1 text-red-500"}),"Keep All Originals"]})]}),t.jsx(ee,{className:"h-[500px] border rounded-lg p-4",children:t.jsx("div",{className:"space-y-6",children:_.map((e,s)=>t.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"font-bold",children:["Q",e.question_number,"."]}),t.jsx(p,{variant:"SATA"===e.question_type?"default":"secondary",children:e.question_type}),0===e.correct_answers.length&&t.jsx(p,{variant:"destructive",className:"animate-pulse",children:"⚠️ Set correct answer"}),e.correct_answers.length>0&&t.jsxs(p,{className:"bg-green-100 text-green-700",children:[t.jsx(d,{className:"h-3 w-3 mr-1"}),"Answer set"]})]}),e.suggested_text&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(se,{checked:e.use_suggested,onCheckedChange:()=>(e=>{const s=[..._];s[e].use_suggested=!s[e].use_suggested,q(s)})(s)}),t.jsx("span",{className:"text-xs text-muted-foreground",children:"Use AI version"})]})]}),e.suggested_text&&e.suggested_text!==e.original_text?t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"p-3 rounded-lg "+(e.use_suggested?"bg-muted":"bg-green-50 dark:bg-green-900/20 border-green-200"),children:[t.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Original"}),t.jsx("p",{className:"text-sm",children:e.original_text})]}),t.jsxs("div",{className:"p-3 rounded-lg "+(e.use_suggested?"bg-purple-50 dark:bg-purple-900/20 border-purple-200":"bg-muted"),children:[t.jsxs("p",{className:"text-xs text-muted-foreground mb-1 flex items-center gap-1",children:[t.jsx(ie,{className:"h-3 w-3"})," AI Suggested"]}),t.jsx("p",{className:"text-sm",children:e.suggested_text})]})]}):t.jsx("p",{className:"text-sm",children:e.question_text}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("p",{className:"text-xs text-muted-foreground mb-2 flex items-center gap-1",children:[t.jsx(le,{className:"h-3 w-3"}),"Click options to set correct answer","SATA"===e.question_type?"(s)":"",":"]}),e.options.map((r,a)=>t.jsx("div",{onClick:()=>((e,s)=>{const t=[..._],r=t[e];"MCQ"===r.question_type?r.correct_answers=[s]:r.correct_answers.includes(s)?r.correct_answers=r.correct_answers.filter(e=>e!==s):r.correct_answers=[...r.correct_answers,s],q(t)})(s,a),className:"text-sm px-3 py-2 rounded cursor-pointer transition-all border-2 "+(e.correct_answers.includes(a)?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 border-green-400":"bg-muted border-transparent hover:border-gray-300 hover:bg-muted/80"),children:t.jsxs("div",{className:"flex items-center gap-2",children:["SATA"===e.question_type?t.jsx("div",{className:"w-4 h-4 border-2 rounded flex items-center justify-center "+(e.correct_answers.includes(a)?"border-green-500 bg-green-500":"border-gray-400"),children:e.correct_answers.includes(a)&&t.jsx(d,{className:"h-3 w-3 text-white"})}):t.jsx("div",{className:"w-4 h-4 border-2 rounded-full flex items-center justify-center "+(e.correct_answers.includes(a)?"border-green-500 bg-green-500":"border-gray-400"),children:e.correct_answers.includes(a)&&t.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})}),t.jsxs("span",{children:[a+1,". ",r]})]})},a))]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(m,{className:"text-xs text-muted-foreground flex items-center gap-1",children:[t.jsx(u,{className:"h-3 w-3"}),"Rationale (explain why the answer is correct):"]}),t.jsx(x,{value:e.rationale,onChange:e=>((e,s)=>{const t=[..._];t[e].rationale=s,q(t)})(s,e.target.value),placeholder:"Enter rationale for this question...",className:"text-sm min-h-[80px]"})]})]},e.id))})}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(h,{variant:"outline",onClick:$,className:"flex-1",children:"Cancel"}),t.jsx(h,{onClick:async()=>{if(0===_.length)return;const s=_.filter(e=>0===e.correct_answers.length);if(s.length>0){if(!window.confirm(`${s.length} question(s) don't have correct answers set. Save anyway?`))return}Q(!0);try{const{data:s}=await te.from("nclex_questions").select("question_number").eq("test_id",e).order("question_number",{ascending:!1}).limit(1),t=s&&s.length>0?s[0].question_number+1:1,r=_.map((s,r)=>({test_id:e,question_number:t+r,question_text:s.use_suggested&&s.suggested_text?s.suggested_text:s.question_text,question_type:s.question_type,options:s.options,correct_answers:s.correct_answers,rationale:s.rationale,original_text:s.original_text,is_modified:s.use_suggested&&s.suggested_text!==s.original_text})),{error:a}=await te.from("nclex_questions").insert(r);if(a)throw a;f.success(`${r.length} questions saved successfully!`),w(_),setRawText(""),q([]),P(!1)}catch(t){console.error("Error saving questions:",t),f.error("Failed to save questions")}finally{Q(!1)}},disabled:T||0===_.length,className:"flex-1 bg-teal-500 hover:bg-teal-600 text-white",children:T?t.jsxs(t.Fragment,{children:[t.jsx(ne,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):t.jsxs(t.Fragment,{children:[t.jsx(ce,{className:"h-4 w-4 mr-2"}),"Save ",_.length," Questions"]})})]})]}):t.jsxs(t.Fragment,{children:[t.jsxs(O,{value:F,onValueChange:B,className:"w-full",children:[t.jsxs(R,{className:"grid w-full grid-cols-2",children:[t.jsxs(z,{value:"questions",className:"flex items-center gap-2",children:[t.jsx(o,{className:"h-4 w-4"}),"Questions",N.trim()&&t.jsx(d,{className:"h-3 w-3 text-green-500"})]}),t.jsxs(z,{value:"answers",className:"flex items-center gap-2",children:[t.jsx(de,{className:"h-4 w-4"}),"Answer Key & Rationale",b.trim()&&t.jsx(d,{className:"h-3 w-3 text-green-500"})]})]}),t.jsxs(L,{value:"questions",className:"space-y-3 mt-4",children:[t.jsx(m,{className:"text-sm font-medium",children:"Paste Questions Here"}),t.jsx(x,{value:N,onChange:e=>v(e.target.value),placeholder:"Paste your NCLEX questions here. Example:\n\nThe nurse is caring for a client with cardiogenic shock. The nurse expects which signs present with this client? Select all that apply.\nhypertension; slow, labored breathing\ndecreased urine output; warm, pink skin\nincreased urine output; cool, clammy skin\nhypotension; weak pulse; cool, clammy skin\n\nThe nurse is caring for a client with a sacral wound. The wound is full thickness, measures 4 cm × 6 cm with irregular borders, and is covered by a layer of black collagen. Which is this wound stage?\nStage I\nStage II\nStage III\nunstageable",className:"min-h-[250px] font-mono text-sm"}),t.jsxs(Z,{className:"bg-blue-50 dark:bg-blue-900/20 border-blue-200",children:[t.jsx(re,{className:"h-4 w-4 text-blue-500"}),t.jsxs(J,{className:"text-sm",children:[t.jsx("strong",{children:"Tip:"}),' Include "Select all that apply" in questions for SATA type. Options can be on separate lines or separated by semicolons.']})]})]}),t.jsxs(L,{value:"answers",className:"space-y-3 mt-4",children:[t.jsx(m,{className:"text-sm font-medium",children:"Paste Answer Key & Rationale Here"}),t.jsx(x,{value:b,onChange:e=>y(e.target.value),placeholder:"Paste the answer key and rationales here. Example:\n\n1. Number 4 is correct.\nRationale: Hypotension, weak pulse, and cool clammy skin are classic signs of cardiogenic shock. The heart cannot pump effectively, leading to decreased cardiac output and peripheral vasoconstriction.\n\n2. Number 4 is correct.\nRationale: A wound covered by black collagen (eschar) is unstageable because the true depth cannot be determined until the eschar is removed.\n\n3. Number 1 is correct.\nRationale: A Braden score of 13 indicates high risk for skin breakdown. Scores range from 6-23, with lower scores indicating higher risk.",className:"min-h-[250px] font-mono text-sm"}),t.jsxs(Z,{className:"bg-amber-50 dark:bg-amber-900/20 border-amber-200",children:[t.jsx(ae,{className:"h-4 w-4 text-amber-500"}),t.jsxs(J,{className:"text-sm",children:[t.jsx("strong",{children:"Format:"}),' Use "Number X is correct" pattern. The X refers to the option number (1 = first option, 2 = second, etc.)']})]})]})]}),I&&t.jsxs(Z,{variant:"destructive",children:[t.jsx(ae,{className:"h-4 w-4"}),t.jsx(J,{children:I})]}),t.jsx(Y,{}),t.jsx("div",{className:"flex gap-2",children:t.jsx(h,{onClick:()=>{C(!0),E(null);try{const e=X(N,b);0===e.length?(E("No questions could be parsed. Please check the format."),q([])):(q(e),P(!0),f.success(`Parsed ${e.length} questions successfully`))}catch(e){E(e.message||"Failed to parse questions"),q([])}finally{C(!1)}},disabled:!N.trim()||k,className:"flex-1 bg-teal-500 hover:bg-teal-600 text-white",children:k?t.jsxs(t.Fragment,{children:[t.jsx(ne,{className:"h-4 w-4 mr-2 animate-spin"}),"Parsing..."]}):t.jsxs(t.Fragment,{children:[t.jsx(u,{className:"h-4 w-4 mr-2"}),"Parse Questions ",b.trim()?"& Answers":""]})})}),!b.trim()&&N.trim()&&t.jsxs(Z,{className:"bg-purple-50 dark:bg-purple-900/20 border-purple-200",children:[t.jsx(ie,{className:"h-4 w-4 text-purple-500"}),t.jsxs(J,{className:"text-sm",children:[t.jsx("strong",{children:"No answers?"})," You can still parse questions and manually set correct answers in the preview, or let AI help later."]})]})]})})]})},xe=()=>{const e=w(),{testId:g}=N(),{admin:Z,loading:J}=v(),[Y,ee]=s.useState(null),[se,re]=s.useState([]),[ae,ne]=s.useState(!0),[de,xe]=s.useState(null),[he,ue]=s.useState(!1),[pe,ge]=s.useState({question_text:"",question_type:"MCQ",options:["","","",""],correct_answers:[],rationale:""});s.useEffect(()=>{J||Z?g&&je():e("/admin/login")},[Z,J,g]);const je=async()=>{try{const{data:s,error:t}=await te.from("nclex_tests").select("*").eq("id",g).single();if(t||!s)return f.error("Test not found"),void e("/admin/nclex");ee(s);const{data:r,error:a}=await te.from("nclex_questions").select("*").eq("test_id",g).order("question_number",{ascending:!0});a?console.error("Error loading questions:",a):re(r||[])}catch(s){console.error("Error:",s)}finally{ne(!1)}},fe=()=>{ge({question_text:"",question_type:"MCQ",options:["","","",""],correct_answers:[],rationale:""})},we=e=>{if("MCQ"===pe.question_type)ge({...pe,correct_answers:[e]});else{const s=pe.correct_answers;s.includes(e)?ge({...pe,correct_answers:s.filter(s=>s!==e)}):ge({...pe,correct_answers:[...s,e]})}},Ne=()=>{pe.options.length<8&&ge({...pe,options:[...pe.options,""]})},ve=e=>{if(pe.options.length>2){const s=pe.options.filter((s,t)=>t!==e),t=pe.correct_answers.filter(s=>s!==e).map(s=>s>e?s-1:s);ge({...pe,options:s,correct_answers:t})}};return J||ae?t.jsx(W,{title:"NCLEX Test",showBackButton:!0,children:t.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-teal-500"})})}):Y?t.jsx(W,{title:Y.title,showBackButton:!0,children:t.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[t.jsx(r,{children:t.jsx(c,{className:"p-6",children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-teal-500 to-cyan-500 flex items-center justify-center",children:t.jsx(b,{className:"h-7 w-7 text-white"})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold",children:Y.title}),t.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[t.jsx(p,{variant:"outline",children:Y.category}),t.jsx(p,{className:"Easy"===Y.difficulty_level?"bg-green-100 text-green-700":"Hard"===Y.difficulty_level?"bg-red-100 text-red-700":"bg-amber-100 text-amber-700",children:Y.difficulty_level}),Y.is_published?t.jsx(p,{className:"bg-green-100 text-green-700",children:"Published"}):t.jsx(p,{variant:"secondary",children:"Draft"})]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"text-3xl font-bold text-teal-500",children:se.length}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Questions"})]})]})})}),t.jsxs(O,{defaultValue:"import",className:"space-y-6",children:[t.jsxs(R,{className:"grid w-full grid-cols-3",children:[t.jsxs(z,{value:"import",children:[t.jsx(i,{className:"h-4 w-4 mr-2"}),"Import Questions"]}),t.jsxs(z,{value:"questions",children:[t.jsx(u,{className:"h-4 w-4 mr-2"}),"Manage Questions (",se.length,")"]}),t.jsxs(z,{value:"preview",children:[t.jsx(y,{className:"h-4 w-4 mr-2"}),"Preview"]})]}),t.jsx(L,{value:"import",children:t.jsx(me,{testId:g,onQuestionsImported:e=>{je(),f.success(`${e.length} questions imported successfully`)}})}),t.jsx(L,{value:"questions",children:t.jsxs(r,{children:[t.jsxs(a,{className:"flex flex-row items-center justify-between",children:[t.jsxs("div",{children:[t.jsx(n,{children:"Questions"}),t.jsx(l,{children:"Add, edit, or remove questions from this test"})]}),t.jsxs(h,{onClick:()=>ue(!0),children:[t.jsx(_,{className:"h-4 w-4 mr-2"}),"Add Question"]})]}),t.jsx(c,{children:0===se.length?t.jsxs("div",{className:"text-center py-12",children:[t.jsx(o,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),t.jsx("p",{className:"text-muted-foreground",children:"No questions yet"}),t.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Use the Import tab to paste questions, or add them manually"})]}):t.jsx("div",{className:"space-y-4",children:se.map((e,s)=>t.jsx("div",{className:"border rounded-lg p-4 hover:bg-muted/50 transition-colors",children:t.jsxs("div",{className:"flex items-start justify-between gap-4",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsxs("span",{className:"font-semibold text-sm",children:["Q",e.question_number,"."]}),t.jsx(p,{variant:"SATA"===e.question_type?"default":"secondary",children:e.question_type}),e.is_modified&&t.jsxs(p,{variant:"outline",className:"text-purple-600 border-purple-200",children:[t.jsx(ie,{className:"h-3 w-3 mr-1"}),"AI Modified"]})]}),t.jsx("p",{className:"text-sm mb-3",children:e.question_text}),t.jsx("div",{className:"space-y-1",children:e.options.map((s,r)=>t.jsxs("div",{className:"text-xs px-2 py-1 rounded "+(e.correct_answers.includes(r)?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-muted"),children:[e.correct_answers.includes(r)&&t.jsx(d,{className:"h-3 w-3 inline mr-1"}),s]},r))}),e.rationale&&t.jsxs("p",{className:"text-xs text-muted-foreground mt-2 italic",children:["Rationale: ",e.rationale.substring(0,100),"..."]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(h,{variant:"ghost",size:"sm",onClick:()=>(e=>{xe(e),ge({question_text:e.question_text,question_type:e.question_type,options:[...e.options,"","","",""].slice(0,4),correct_answers:[...e.correct_answers],rationale:e.rationale||""})})(e),children:t.jsx(le,{className:"h-4 w-4"})}),t.jsxs(B,{children:[t.jsx(X,{asChild:!0,children:t.jsx(h,{variant:"ghost",size:"sm",className:"text-red-500 hover:text-red-600",children:t.jsx(oe,{className:"h-4 w-4"})})}),t.jsxs($,{children:[t.jsxs(U,{children:[t.jsx(D,{children:"Delete Question?"}),t.jsx(H,{children:"This will permanently delete this question."})]}),t.jsxs(V,{children:[t.jsx(G,{children:"Cancel"}),t.jsx(K,{onClick:()=>(async e=>{try{const{error:s}=await te.from("nclex_questions").delete().eq("id",e);if(s)throw s;f.success("Question deleted"),je()}catch(s){console.error("Error deleting question:",s),f.error("Failed to delete question")}})(e.id),className:"bg-red-500 hover:bg-red-600",children:"Delete"})]})]})]})]})]})},e.id))})})]})}),t.jsx(L,{value:"preview",children:t.jsxs(r,{children:[t.jsxs(a,{children:[t.jsx(n,{children:"Student Preview"}),t.jsx(l,{children:"See how questions will appear to students"})]}),t.jsx(c,{children:0===se.length?t.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No questions to preview"}):t.jsxs("div",{className:"space-y-6",children:[se.slice(0,5).map(e=>t.jsxs("div",{className:"border rounded-lg p-6",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsxs("span",{className:"text-sm text-muted-foreground",children:["Question ",e.question_number]}),t.jsx(p,{variant:"SATA"===e.question_type?"default":"secondary",children:"SATA"===e.question_type?"Select All That Apply":"Multiple Choice"})]}),t.jsx("p",{className:"text-lg mb-4",children:e.question_text}),t.jsx("div",{className:"space-y-2",children:e.options.map((s,r)=>t.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg hover:bg-muted/50 cursor-pointer",children:["SATA"===e.question_type?t.jsx("div",{className:"w-5 h-5 border-2 rounded"}):t.jsx("div",{className:"w-5 h-5 border-2 rounded-full"}),t.jsx("span",{children:s})]},r))})]},e.id)),se.length>5&&t.jsxs("p",{className:"text-center text-muted-foreground",children:["+ ",se.length-5," more questions"]})]})})]})})]}),t.jsx(q,{open:he,onOpenChange:ue,children:t.jsxs(k,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[t.jsxs(C,{children:[t.jsx(A,{children:"Add New Question"}),t.jsx(S,{children:"Create a new NCLEX question manually"})]}),t.jsxs("div",{className:"space-y-4 py-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(m,{children:"Question Type"}),t.jsxs(T,{value:pe.question_type,onValueChange:e=>{ge({...pe,question_type:e,correct_answers:"MCQ"===e?pe.correct_answers.slice(0,1):pe.correct_answers})},children:[t.jsx(Q,{children:t.jsx(I,{})}),t.jsxs(E,{children:[t.jsx(M,{value:"MCQ",children:"Multiple Choice (Single Answer)"}),t.jsx(M,{value:"SATA",children:"Select All That Apply"})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(m,{children:"Question Text *"}),t.jsx(x,{value:pe.question_text,onChange:e=>ge({...pe,question_text:e.target.value}),placeholder:"Enter the question text...",rows:3})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(m,{children:"Options (click to mark as correct)"}),t.jsxs(h,{type:"button",variant:"ghost",size:"sm",onClick:Ne,children:[t.jsx(_,{className:"h-4 w-4 mr-1"}),"Add Option"]})]}),pe.options.map((e,s)=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(h,{type:"button",variant:pe.correct_answers.includes(s)?"default":"outline",size:"sm",className:pe.correct_answers.includes(s)?"bg-green-500 hover:bg-green-600":"",onClick:()=>we(s),children:pe.correct_answers.includes(s)?t.jsx(d,{className:"h-4 w-4"}):t.jsx("span",{className:"w-4 text-center",children:s+1})}),t.jsx(P,{value:e,onChange:e=>{const t=[...pe.options];t[s]=e.target.value,ge({...pe,options:t})},placeholder:`Option ${s+1}`,className:"flex-1"}),pe.options.length>2&&t.jsx(h,{type:"button",variant:"ghost",size:"sm",onClick:()=>ve(s),className:"text-red-500",children:t.jsx(j,{className:"h-4 w-4"})})]},s)),t.jsx("p",{className:"text-xs text-muted-foreground",children:"SATA"===pe.question_type?"Select ALL correct answers":"Select ONE correct answer"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(m,{children:"Rationale"}),t.jsx(x,{value:pe.rationale,onChange:e=>ge({...pe,rationale:e.target.value}),placeholder:"Explain why the answer(s) are correct...",rows:3})]})]}),t.jsxs(F,{children:[t.jsx(h,{variant:"outline",onClick:()=>{ue(!1),fe()},children:"Cancel"}),t.jsxs(h,{onClick:async()=>{if(pe.question_text.trim())if(pe.options.filter(e=>e.trim()).length<2)f.error("Please enter at least 2 options");else if(0!==pe.correct_answers.length)try{const e=se.length>0?Math.max(...se.map(e=>e.question_number))+1:1,{error:s}=await te.from("nclex_questions").insert({test_id:g,question_number:e,question_text:pe.question_text,question_type:pe.question_type,options:pe.options.filter(e=>e.trim()),correct_answers:pe.correct_answers,rationale:pe.rationale||null});if(s)throw s;f.success("Question added successfully"),ue(!1),fe(),je()}catch(e){console.error("Error adding question:",e),f.error("Failed to add question")}else f.error("Please select at least one correct answer");else f.error("Please enter question text")},className:"bg-teal-500 hover:bg-teal-600 text-white",children:[t.jsx(ce,{className:"h-4 w-4 mr-2"}),"Add Question"]})]})]})}),t.jsx(q,{open:!!de,onOpenChange:e=>!e&&xe(null),children:t.jsxs(k,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[t.jsxs(C,{children:[t.jsx(A,{children:"Edit Question"}),t.jsx(S,{children:"Update question details"})]}),t.jsxs("div",{className:"space-y-4 py-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(m,{children:"Question Type"}),t.jsxs(T,{value:pe.question_type,onValueChange:e=>{ge({...pe,question_type:e,correct_answers:"MCQ"===e?pe.correct_answers.slice(0,1):pe.correct_answers})},children:[t.jsx(Q,{children:t.jsx(I,{})}),t.jsxs(E,{children:[t.jsx(M,{value:"MCQ",children:"Multiple Choice (Single Answer)"}),t.jsx(M,{value:"SATA",children:"Select All That Apply"})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(m,{children:"Question Text *"}),t.jsx(x,{value:pe.question_text,onChange:e=>ge({...pe,question_text:e.target.value}),rows:3})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(m,{children:"Options (click to mark as correct)"}),t.jsxs(h,{type:"button",variant:"ghost",size:"sm",onClick:Ne,children:[t.jsx(_,{className:"h-4 w-4 mr-1"}),"Add Option"]})]}),pe.options.map((e,s)=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(h,{type:"button",variant:pe.correct_answers.includes(s)?"default":"outline",size:"sm",className:pe.correct_answers.includes(s)?"bg-green-500 hover:bg-green-600":"",onClick:()=>we(s),children:pe.correct_answers.includes(s)?t.jsx(d,{className:"h-4 w-4"}):t.jsx("span",{className:"w-4 text-center",children:s+1})}),t.jsx(P,{value:e,onChange:e=>{const t=[...pe.options];t[s]=e.target.value,ge({...pe,options:t})},className:"flex-1"}),pe.options.length>2&&t.jsx(h,{type:"button",variant:"ghost",size:"sm",onClick:()=>ve(s),className:"text-red-500",children:t.jsx(j,{className:"h-4 w-4"})})]},s))]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(m,{children:"Rationale"}),t.jsx(x,{value:pe.rationale,onChange:e=>ge({...pe,rationale:e.target.value}),rows:3})]})]}),t.jsxs(F,{children:[t.jsx(h,{variant:"outline",onClick:()=>{xe(null),fe()},children:"Cancel"}),t.jsxs(h,{onClick:async()=>{if(de)try{const{error:e}=await te.from("nclex_questions").update({question_text:pe.question_text,question_type:pe.question_type,options:pe.options.filter(e=>e.trim()),correct_answers:pe.correct_answers,rationale:pe.rationale||null}).eq("id",de.id);if(e)throw e;f.success("Question updated successfully"),xe(null),fe(),je()}catch(e){console.error("Error updating question:",e),f.error("Failed to update question")}},className:"bg-teal-500 hover:bg-teal-600 text-white",children:[t.jsx(ce,{className:"h-4 w-4 mr-2"}),"Save Changes"]})]})]})})]})}):t.jsx(W,{title:"NCLEX Test",showBackButton:!0,children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("p",{className:"text-muted-foreground",children:"Test not found"}),t.jsx(h,{onClick:()=>e("/admin/nclex"),className:"mt-4",children:"Back to NCLEX Admin"})]})})};export{xe as default};
