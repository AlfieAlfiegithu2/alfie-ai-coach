import{u as e,c as s,r as t,j as a}from"./vendor-react-rLLBBC7n.js";import{n as r,s as i,J as n,B as l,e as o,C as c,a as d,b as p,c as m,L as h,I as x,T as u}from"./index-KxDfHqNJ.js";import{T as g,a as j,b as f,c as w}from"./tabs-BVz_B7Kx.js";import{A as v,a as b,b as N,c as y,d as _,e as D,f as k,g as C,h as A}from"./alert-dialog-Bvks6upm.js";import{A as E}from"./AdminLayout-DGXoIbe0.js";import{I as S}from"./ImageQuestionExtractor-CyDub9QF.js";import{av as P,X as I,b5 as q,a_ as R,aY as M}from"./vendor-ui-BGi_EvHx.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-charts-0DeywwxG.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";const O={fill_blanks_dropdown:{name:"Fill in the Blanks (Dropdown)",description:"Select the correct word from dropdown options",hasPassage:!0,hasOptions:!0,isMultipleAnswer:!1,isReorder:!1,isDragDrop:!1,isDropdown:!0,instructions:"In the text below some words are missing. From each drop-down list, choose the option that best completes the text."},mcq_multiple_answers:{name:"Multiple Choice, Multiple Answers",description:"Select all correct answers from the options",hasPassage:!0,hasOptions:!0,isMultipleAnswer:!0,isReorder:!1,isDragDrop:!1,isDropdown:!1,instructions:"Read the text and answer the question by selecting all the correct responses. More than one response is correct."},reorder_paragraph:{name:"Reorder Paragraph",description:"Arrange text boxes in the correct order",hasPassage:!1,hasOptions:!1,isMultipleAnswer:!1,isReorder:!0,isDragDrop:!1,isDropdown:!1,instructions:"The text boxes in the left panel have been placed in a random order. Restore the original order by dragging the text boxes to the right panel."},fill_blanks_drag_drop:{name:"Fill in the Blanks (Drag and Drop)",description:"Drag words to fill in the blanks",hasPassage:!0,hasOptions:!0,isMultipleAnswer:!1,isReorder:!1,isDragDrop:!0,isDropdown:!1,instructions:"In the text below some words are missing. Drag words from the box below to the appropriate place in the text. There are more words than you need to fill the gaps."},mcq_single_answer:{name:"Multiple Choice, Single Answer",description:"Select the single correct answer",hasPassage:!0,hasOptions:!0,isMultipleAnswer:!1,isReorder:!1,isDragDrop:!1,isDropdown:!1,instructions:"Read the text and answer the multiple-choice question by selecting the correct response. Only one response is correct."}},T=()=>{const T=e(),{type:B}=s(),{admin:z,loading:F}=r(),[$,L]=t.useState([]),[Q,U]=t.useState(!0),[K,W]=t.useState(!1),[H,J]=t.useState(!1),[V,Y]=t.useState(null),[G,X]=t.useState("manual"),[Z,ee]=t.useState({title:"",prompt_text:"",passage_text:"",correct_answer:"",explanation:"",difficulty:"medium"}),[se,te]=t.useState(["","","",""]),[ae,re]=t.useState([{id:"1",text:""},{id:"2",text:""},{id:"3",text:""},{id:"4",text:""}]),[ie,ne]=t.useState([]),le=B?O[B]:null;t.useEffect(()=>{F||z||T("/admin/login")},[z,F,T]),t.useEffect(()=>{B&&z&&oe()},[B,z]);const oe=async()=>{if(B){U(!0);try{const{data:e,error:s}=await i.from("pte_items").select("*").eq("pte_section_type",B).order("created_at",{ascending:!1});if(s)throw s;L(e||[])}catch(e){console.error("Error loading items:",e),n.error("Failed to load items")}finally{U(!1)}}},ce=()=>{ee({title:"",prompt_text:"",passage_text:"",correct_answer:"",explanation:"",difficulty:"medium"}),te(["","","",""]),re([{id:"1",text:""},{id:"2",text:""},{id:"3",text:""},{id:"4",text:""}]),ne([]),Y(null),J(!1)},de=()=>{te([...se,""])},pe=e=>{te(se.filter((s,t)=>t!==e))},me=(e,s)=>{const t=[...se];t[e]=s,te(t)};return F||Q?a.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):le?a.jsx(E,{title:`PTE: ${le.name}`,showBackButton:!0,backPath:"/admin/pte",children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold",children:le.name}),a.jsx("p",{className:"text-muted-foreground",children:le.description})]}),a.jsxs(o,{variant:"secondary",className:"bg-blue-100 text-blue-700",children:[$.length," items"]})]}),a.jsx(c,{className:"bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800",children:a.jsx(d,{className:"pt-4",children:a.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[a.jsx("strong",{children:"Instructions:"})," ",le.instructions]})})}),H?a.jsxs(c,{children:[a.jsx(p,{children:a.jsx(m,{children:V?"Edit Item":"Add New Item"})}),a.jsx(d,{className:"space-y-4",children:a.jsxs(g,{value:G,onValueChange:X,children:[a.jsxs(j,{className:"grid w-full grid-cols-2",children:[a.jsx(f,{value:"manual",children:"Manual Entry"}),a.jsx(f,{value:"ai",children:"AI Extract from Screenshot"})]}),a.jsxs(w,{value:"manual",className:"space-y-4 pt-4",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(h,{children:"Title (Optional)"}),a.jsx(x,{value:Z.title,onChange:e=>ee(s=>({...s,title:e.target.value})),placeholder:"Item title"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(h,{children:"Difficulty"}),a.jsxs("select",{value:Z.difficulty,onChange:e=>ee(s=>({...s,difficulty:e.target.value})),className:"w-full h-10 px-3 rounded-md border border-input bg-background",children:[a.jsx("option",{value:"easy",children:"Easy"}),a.jsx("option",{value:"medium",children:"Medium"}),a.jsx("option",{value:"hard",children:"Hard"})]})]})]}),le.isReorder?a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(h,{children:"Paragraphs (in correct order)"}),a.jsxs(l,{type:"button",variant:"outline",size:"sm",onClick:()=>{re([...ae,{id:String(ae.length+1),text:""}])},children:[a.jsx(P,{className:"w-4 h-4 mr-1"}),"Add Paragraph"]})]}),ae.map((e,s)=>a.jsxs("div",{className:"flex gap-2 items-start",children:[a.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-muted rounded text-sm font-medium",children:s+1}),a.jsx(u,{value:e.text,onChange:e=>((e,s)=>{const t=[...ae];t[e]={...t[e],text:s},re(t)})(s,e.target.value),placeholder:`Paragraph ${s+1}`,rows:2,className:"flex-1"}),ae.length>2&&a.jsx(l,{type:"button",variant:"ghost",size:"icon",onClick:()=>(e=>{re(ae.filter((s,t)=>t!==e))})(s),children:a.jsx(I,{className:"w-4 h-4"})})]},e.id))]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(h,{children:"Question / Prompt *"}),a.jsx(u,{value:Z.prompt_text,onChange:e=>ee(s=>({...s,prompt_text:e.target.value})),placeholder:"Enter the question or prompt",rows:2})]}),le.hasPassage&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs(h,{children:["Passage Text ",le.isDropdown||le.isDragDrop?"(Use [BLANK] to mark blanks)":""]}),a.jsx(u,{value:Z.passage_text,onChange:e=>ee(s=>({...s,passage_text:e.target.value})),placeholder:le.isDropdown||le.isDragDrop?"Enter passage with [BLANK] markers where answers go...":"Enter the reading passage",rows:6})]}),le.hasOptions&&!le.isDropdown&&!le.isDragDrop&&a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(h,{children:"Answer Options"}),a.jsxs(l,{type:"button",variant:"outline",size:"sm",onClick:de,children:[a.jsx(P,{className:"w-4 h-4 mr-1"}),"Add Option"]})]}),se.map((e,s)=>a.jsxs("div",{className:"flex gap-2 items-center",children:[a.jsx(o,{variant:"outline",className:"w-8 h-8 flex items-center justify-center",children:String.fromCharCode(65+s)}),a.jsx(x,{value:e,onChange:e=>me(s,e.target.value),placeholder:`Option ${String.fromCharCode(65+s)}`,className:"flex-1"}),se.length>2&&a.jsx(l,{type:"button",variant:"ghost",size:"icon",onClick:()=>pe(s),children:a.jsx(I,{className:"w-4 h-4"})})]},s))]}),(le.isDropdown||le.isDragDrop)&&a.jsxs("div",{className:"space-y-3",children:[a.jsx(h,{children:"Word Bank (available options)"}),a.jsxs("div",{className:"flex flex-wrap gap-2",children:[se.map((e,s)=>a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(x,{value:e,onChange:e=>me(s,e.target.value),placeholder:`Word ${s+1}`,className:"w-32"}),a.jsx(l,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>pe(s),children:a.jsx(I,{className:"w-3 h-3"})})]},s)),a.jsx(l,{type:"button",variant:"outline",size:"sm",onClick:de,children:a.jsx(P,{className:"w-4 h-4"})})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs(h,{children:["Correct Answer(s)",le.isMultipleAnswer&&" (comma-separated for multiple)",(le.isDropdown||le.isDragDrop)&&" (comma-separated in order of blanks)"]}),a.jsx(x,{value:Z.correct_answer,onChange:e=>ee(s=>({...s,correct_answer:e.target.value})),placeholder:le.isMultipleAnswer?"A, C":le.isDropdown?"word1, word2, word3":"A"})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(h,{children:"Explanation (Optional)"}),a.jsx(u,{value:Z.explanation,onChange:e=>ee(s=>({...s,explanation:e.target.value})),placeholder:"Explain why the answer is correct",rows:3})]}),a.jsxs("div",{className:"flex gap-3 justify-end",children:[a.jsx(l,{variant:"outline",onClick:ce,children:"Cancel"}),a.jsxs(l,{onClick:async()=>{if(B){if(null==le?void 0:le.isReorder){if(ae.filter(e=>e.text.trim()).length<2)return void n.error("Please add at least 2 paragraphs")}else if(!Z.prompt_text.trim())return void n.error("Please enter a question/prompt");W(!0);try{const e={pte_skill:"reading",pte_section_type:B,title:Z.title||`${null==le?void 0:le.name} - ${(new Date).toLocaleDateString()}`,prompt_text:Z.prompt_text,passage_text:Z.passage_text||null,correct_answer:Z.correct_answer||null,explanation:Z.explanation||null,difficulty:Z.difficulty};if(!(null==le?void 0:le.hasOptions)||(null==le?void 0:le.isDropdown)||(null==le?void 0:le.isDragDrop)||(e.options=se.filter(e=>e.trim())),(null==le?void 0:le.isReorder)&&(e.paragraphs=ae.filter(e=>e.text.trim())),((null==le?void 0:le.isDropdown)||(null==le?void 0:le.isDragDrop))&&(e.blanks=ie,e.options=se.filter(e=>e.trim())),V){const{error:s}=await i.from("pte_items").update(e).eq("id",V);if(s)throw s;n.success("Item updated successfully")}else{const{error:s}=await i.from("pte_items").insert(e);if(s)throw s;n.success("Item created successfully")}ce(),oe()}catch(e){console.error("Error saving item:",e),n.error("Failed to save item")}finally{W(!1)}}else n.error("Invalid question type")},disabled:K,className:"bg-blue-600 hover:bg-blue-700",children:[a.jsx(q,{className:"w-4 h-4 mr-2"}),K?"Saving...":V?"Update":"Save"]})]})]}),a.jsxs(w,{value:"ai",className:"pt-4",children:[a.jsx(S,{testId:"",testType:"PTE",onQuestionsExtracted:e=>{console.log("Extracted questions:",e),e.forEach(async e=>{const s={pte_skill:"reading",pte_section_type:B,title:`Extracted - ${(new Date).toLocaleDateString()}`,prompt_text:e.question_text,passage_text:e.passage_context||null,correct_answer:e.correct_answer||null,explanation:e.explanation||null,difficulty:"medium"};e.options&&(s.options=e.options);try{const{error:e}=await i.from("pte_items").insert(s);if(e)throw e}catch(t){console.error("Error saving extracted question:",t)}}),n.success(`${e.length} questions extracted and saved`),oe()}}),a.jsx("div",{className:"flex justify-end mt-4",children:a.jsx(l,{variant:"outline",onClick:ce,children:"Close"})})]})]})})]}):a.jsxs(l,{onClick:()=>J(!0),className:"bg-blue-600 hover:bg-blue-700",children:[a.jsx(P,{className:"w-4 h-4 mr-2"}),"Add New ",le.name," Item"]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("h3",{className:"text-lg font-semibold",children:["Existing Items (",$.length,")"]}),0===$.length?a.jsx(c,{className:"border-dashed",children:a.jsxs(d,{className:"flex flex-col items-center justify-center py-12",children:[a.jsxs("p",{className:"text-muted-foreground mb-4",children:["No ",(null==le?void 0:le.name)||"Reading"," items created yet"]}),a.jsxs(l,{onClick:()=>J(!0),className:"bg-violet-600 hover:bg-violet-700",children:[a.jsx(P,{className:"w-4 h-4 mr-2"}),"Add First ",(null==le?void 0:le.name)||"Reading"," Item"]})]})}):a.jsx("div",{className:"grid gap-4",children:$.map(e=>a.jsx(c,{className:"hover:shadow-md transition-shadow",children:a.jsx(d,{className:"pt-4",children:a.jsxs("div",{className:"flex items-start justify-between gap-4",children:[a.jsxs("div",{className:"flex-1 space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("h4",{className:"font-medium",children:e.title||"Untitled"}),a.jsx(o,{variant:"outline",className:"text-xs",children:e.difficulty})]}),a.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:e.prompt_text}),e.passage_text&&a.jsxs("p",{className:"text-xs text-muted-foreground italic line-clamp-1",children:["Passage: ",e.passage_text.substring(0,100),"..."]}),e.correct_answer&&a.jsxs("p",{className:"text-xs",children:[a.jsx("span",{className:"font-medium text-green-600",children:"Answer: "}),e.correct_answer]}),e.paragraphs&&a.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.paragraphs.length," paragraphs to reorder"]}),a.jsxs("span",{className:"text-xs text-muted-foreground",children:["Created: ",new Date(e.created_at).toLocaleDateString()]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(l,{variant:"ghost",size:"icon",onClick:()=>(e=>{Y(e.id),ee({title:e.title||"",prompt_text:e.prompt_text,passage_text:e.passage_text||"",correct_answer:e.correct_answer||"",explanation:e.explanation||"",difficulty:e.difficulty||"medium"}),e.options&&te(e.options.length>=4?e.options:[...e.options,"","","",""].slice(0,4)),e.paragraphs&&re(e.paragraphs),e.blanks&&ne(e.blanks),J(!0)})(e),children:a.jsx(R,{className:"w-4 h-4"})}),a.jsxs(v,{children:[a.jsx(b,{asChild:!0,children:a.jsx(l,{variant:"ghost",size:"icon",children:a.jsx(M,{className:"w-4 h-4 text-red-500"})})}),a.jsxs(N,{children:[a.jsxs(y,{children:[a.jsx(_,{children:"Delete Item"}),a.jsx(D,{children:"Are you sure you want to delete this item? This action cannot be undone."})]}),a.jsxs(k,{children:[a.jsx(C,{children:"Cancel"}),a.jsx(A,{onClick:()=>(async e=>{try{const{error:s}=await i.from("pte_items").delete().eq("id",e);if(s)throw s;n.success("Item deleted"),oe()}catch(s){console.error("Error deleting item:",s),n.error("Failed to delete item")}})(e.id),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]})})},e.id))})]})]})}):a.jsx(E,{title:"PTE Admin",showBackButton:!0,backPath:"/admin/pte",children:a.jsxs("div",{className:"text-center py-12",children:[a.jsx("p",{className:"text-muted-foreground",children:"Invalid question type"}),a.jsx(l,{onClick:()=>T("/admin/pte"),className:"mt-4",children:"Back to PTE Admin"})]})})};export{T as default};
