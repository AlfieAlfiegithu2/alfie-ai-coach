import{u as e,G as s,w as a,r as t,J as i,j as r,B as n,l,C as o,a as c,b as d,d as m,R as u,I as h,T as p,X as x,V as g,P as j,Y as f,Z as w}from"./index-LuDcpbqT.js";import{A as v,a as y,b as N,c as _,d as b,e as k,f as I,g as A,h as L}from"./alert-dialog-UM97VjLR.js";import{A as P}from"./AdminLayout-jDRUXbY8.js";import{s as C}from"./supabase-DWL4C3fA.js";import{I as S}from"./image-7Eds706D.js";import{S as E}from"./save-PX-3dNF4.js";import{P as z}from"./pen-line-E9S2SHwF.js";import{T as D}from"./trash-2-Bk2uREXG.js";const R={read_aloud:{name:"Read Aloud",description:"Read a text aloud with correct pronunciation and intonation",hasImage:!1,hasAudio:!1,hasPassage:!0,timeLimit:40,instructions:"Look at the text below. In 30-40 seconds, you must read this text aloud as naturally and clearly as possible."},repeat_sentence:{name:"Repeat Sentence",description:"Listen and repeat the sentence exactly",hasImage:!1,hasAudio:!0,hasPassage:!1,timeLimit:15,instructions:"You will hear a sentence. Please repeat the sentence exactly as you hear it."},describe_image:{name:"Describe Image",description:"Describe an image in detail",hasImage:!0,hasAudio:!1,hasPassage:!1,timeLimit:40,instructions:"Look at the image below. In 25 seconds, please speak into the microphone and describe in detail what the image is showing."},retell_lecture:{name:"Retell Lecture",description:"Listen to a lecture and retell it in your own words",hasImage:!0,hasAudio:!0,hasPassage:!1,timeLimit:40,instructions:"You will hear a lecture. After listening to the lecture, in 10 seconds, please speak into the microphone and retell what you have just heard."},answer_short_question:{name:"Answer Short Question",description:"Answer a question with one or a few words",hasImage:!1,hasAudio:!0,hasPassage:!1,timeLimit:10,instructions:"You will hear a question. Please give a simple and short answer. Often just one or a few words is enough."},summarize_group_discussion:{name:"Summarize Group Discussion",description:"Summarize the main points of a group discussion",hasImage:!1,hasAudio:!0,hasPassage:!1,timeLimit:70,instructions:"You will hear a group discussion. You will have 10 seconds to prepare, then summarize the main points of the discussion in 70 seconds."},respond_to_situation:{name:"Respond to a Situation",description:"Respond appropriately to a given situation",hasImage:!1,hasAudio:!1,hasPassage:!0,timeLimit:40,instructions:"You will see a scenario. In 20 seconds prepare time, think about what you would say in this situation. Then speak for up to 40 seconds."},summarize_written_text:{name:"Summarize Written Text",description:"Write a one-sentence summary of a passage",hasImage:!1,hasAudio:!1,hasPassage:!0,timeLimit:600,wordLimit:75,instructions:"Read the passage below. Write a one-sentence summary of the passage. Your summary should be between 5 and 75 words."},write_essay:{name:"Write Essay",description:"Write a 200-300 word argumentative essay",hasImage:!1,hasAudio:!1,hasPassage:!1,timeLimit:1200,wordLimit:300,instructions:"You will have 20 minutes to plan, write and revise an essay about the topic below. Your response will be judged on how well you develop a position, organize your ideas, present supporting details, and control the elements of standard written English."}},$=()=>{const $=e(),{type:T}=s(),{admin:Y,loading:q}=a(),U=t.useRef(null),F=t.useRef(null),B=t.useRef(null),[W,O]=t.useState([]),[G,M]=t.useState(!0),[Q,H]=t.useState(!1),[J,V]=t.useState(null),[Z,K]=t.useState(!1),[X,ee]=t.useState(null),[se,ae]=t.useState({title:"",prompt_text:"",passage_text:"",sample_answer:"",difficulty:"medium"}),[te,ie]=t.useState(null),[re,ne]=t.useState(null),[le,oe]=t.useState(null),ce=T?R[T]:null;t.useEffect(()=>{q||Y||$("/admin/login")},[Y,q,$]),t.useEffect(()=>{T&&Y&&de()},[T,Y]);const de=async()=>{if(T){M(!0);try{const{data:e,error:s}=await C.from("pte_items").select("*").eq("pte_section_type",T).order("created_at",{ascending:!1});if(s)throw s;O(e||[])}catch(e){console.error("Error loading items:",e),i.error("Failed to load items")}finally{M(!1)}}},me=(e,s)=>{var a;const t=null==(a=e.target.files)?void 0:a[0];if(t)if("image"===s){ie(t);const e=new FileReader;e.onloadend=()=>{ne(e.result)},e.readAsDataURL(t)}else oe(t)},ue=()=>{ae({title:"",prompt_text:"",passage_text:"",sample_answer:"",difficulty:"medium"}),ie(null),ne(null),oe(null),ee(null),K(!1)};return q||G?r.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):ce?r.jsxs(P,{title:`PTE: ${ce.name}`,showBackButton:!0,backPath:"/admin/pte",children:[r.jsx("audio",{ref:U,onEnded:()=>V(null),className:"hidden"}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold",children:ce.name}),r.jsx("p",{className:"text-muted-foreground",children:ce.description})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(l,{variant:"secondary",className:"bg-violet-100 text-violet-700",children:[W.length," items"]}),r.jsxs(l,{variant:"outline",children:["Time: ",ce.timeLimit>=60?`${Math.floor(ce.timeLimit/60)} min`:`${ce.timeLimit} sec`]}),ce.wordLimit&&r.jsxs(l,{variant:"outline",children:["Words: ",ce.wordLimit]})]})]}),r.jsx(o,{className:"bg-violet-50 dark:bg-violet-950/20 border-violet-200 dark:border-violet-800",children:r.jsx(c,{className:"pt-4",children:r.jsxs("p",{className:"text-sm text-violet-700 dark:text-violet-300",children:[r.jsx("strong",{children:"Instructions:"})," ",ce.instructions]})})}),Z?r.jsxs(o,{children:[r.jsx(d,{children:r.jsx(m,{children:X?"Edit Item":"Add New Item"})}),r.jsxs(c,{className:"space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(u,{children:"Title (Optional)"}),r.jsx(h,{value:se.title,onChange:e=>ae(s=>({...s,title:e.target.value})),placeholder:`${ce.name} prompt title`})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(u,{children:"Difficulty"}),r.jsxs("select",{value:se.difficulty,onChange:e=>ae(s=>({...s,difficulty:e.target.value})),className:"w-full h-10 px-3 rounded-md border border-input bg-background",children:[r.jsx("option",{value:"easy",children:"Easy"}),r.jsx("option",{value:"medium",children:"Medium"}),r.jsx("option",{value:"hard",children:"Hard"})]})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(u,{children:"Prompt / Question *"}),r.jsx(p,{value:se.prompt_text,onChange:e=>ae(s=>({...s,prompt_text:e.target.value})),placeholder:"Enter the prompt or question text",rows:3})]}),ce.hasPassage&&r.jsxs("div",{className:"space-y-2",children:[r.jsx(u,{children:"Passage Text"}),r.jsx(p,{value:se.passage_text,onChange:e=>ae(s=>({...s,passage_text:e.target.value})),placeholder:"Enter the passage text for reading or summarizing",rows:6})]}),ce.hasImage&&r.jsxs("div",{className:"space-y-2",children:[r.jsx(u,{children:"Image"}),r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("input",{ref:F,type:"file",accept:"image/*",onChange:e=>me(e,"image"),className:"hidden"}),r.jsxs(n,{type:"button",variant:"outline",onClick:()=>{var e;return null==(e=F.current)?void 0:e.click()},children:[r.jsx(S,{className:"w-4 h-4 mr-2"}),"Upload Image"]}),re&&r.jsxs("div",{className:"relative",children:[r.jsx("img",{src:re,alt:"Preview",className:"h-20 w-20 object-cover rounded"}),r.jsx(n,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-6 w-6",onClick:()=>{ie(null),ne(null)},children:r.jsx(x,{className:"w-3 h-3"})})]})]})]}),ce.hasAudio&&r.jsxs("div",{className:"space-y-2",children:[r.jsx(u,{children:"Audio"}),r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("input",{ref:B,type:"file",accept:"audio/*",onChange:e=>me(e,"audio"),className:"hidden"}),r.jsxs(n,{type:"button",variant:"outline",onClick:()=>{var e;return null==(e=B.current)?void 0:e.click()},children:[r.jsx(g,{className:"w-4 h-4 mr-2"}),"Upload Audio"]}),le&&r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(l,{variant:"secondary",children:le.name}),r.jsx(n,{type:"button",variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>oe(null),children:r.jsx(x,{className:"w-3 h-3"})})]})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(u,{children:"Sample Answer (Optional)"}),r.jsx(p,{value:se.sample_answer,onChange:e=>ae(s=>({...s,sample_answer:e.target.value})),placeholder:"Enter a sample answer for reference",rows:4})]}),r.jsxs("div",{className:"flex gap-3 justify-end",children:[r.jsx(n,{variant:"outline",onClick:ue,children:"Cancel"}),r.jsxs(n,{onClick:async()=>{if(T&&se.prompt_text.trim()){H(!0);try{let e=null,s=null;te&&(e=await(async e=>{try{const s=`pte/${T}/${Date.now()}_${e.name}`,{data:a,error:t}=await C.storage.from("images").upload(s,e,{upsert:!0});if(t)throw t;const{data:{publicUrl:i}}=C.storage.from("images").getPublicUrl(s);return i}catch(s){return console.error("Error uploading image:",s),i.error("Failed to upload image"),null}})(te)),le&&(s=await(async e=>{try{const s=`pte/${T}/${Date.now()}_${e.name}`,{data:a,error:t}=await C.storage.from("audio").upload(s,e,{upsert:!0});if(t)throw t;const{data:{publicUrl:i}}=C.storage.from("audio").getPublicUrl(s);return i}catch(s){return console.error("Error uploading audio:",s),i.error("Failed to upload audio"),null}})(le));const a={pte_skill:"speaking_writing",pte_section_type:T,title:se.title||`${null==ce?void 0:ce.name} - ${(new Date).toLocaleDateString()}`,prompt_text:se.prompt_text,passage_text:se.passage_text||null,sample_answer:se.sample_answer||null,time_limit:(null==ce?void 0:ce.timeLimit)||60,word_limit:(null==ce?void 0:ce.wordLimit)||null,difficulty:se.difficulty,...e&&{image_url:e},...s&&{audio_url:s}};if(X){const{error:e}=await C.from("pte_items").update(a).eq("id",X);if(e)throw e;i.success("Item updated successfully")}else{const{error:e}=await C.from("pte_items").insert(a);if(e)throw e;i.success("Item created successfully")}ue(),de()}catch(e){console.error("Error saving item:",e),i.error("Failed to save item")}finally{H(!1)}}else i.error("Please fill in the required fields")},disabled:Q,className:"bg-violet-600 hover:bg-violet-700",children:[r.jsx(E,{className:"w-4 h-4 mr-2"}),Q?"Saving...":X?"Update":"Save"]})]})]})]}):r.jsxs(n,{onClick:()=>K(!0),className:"bg-violet-600 hover:bg-violet-700",children:[r.jsx(j,{className:"w-4 h-4 mr-2"}),"Add New ",ce.name," Item"]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("h3",{className:"text-lg font-semibold",children:["Existing Items (",W.length,")"]}),0===W.length?r.jsx(o,{className:"border-dashed",children:r.jsxs(c,{className:"flex flex-col items-center justify-center py-12",children:[r.jsxs("p",{className:"text-muted-foreground mb-4",children:["No ",ce.name," items created yet"]}),r.jsxs(n,{onClick:()=>K(!0),className:"bg-violet-600 hover:bg-violet-700",children:[r.jsx(j,{className:"w-4 h-4 mr-2"}),"Add First ",ce.name," Item"]})]})}):r.jsx("div",{className:"grid gap-4",children:W.map(e=>r.jsx(o,{className:"hover:shadow-md transition-shadow",children:r.jsx(c,{className:"pt-4",children:r.jsxs("div",{className:"flex items-start justify-between gap-4",children:[r.jsxs("div",{className:"flex-1 space-y-2",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("h4",{className:"font-medium",children:e.title||"Untitled"}),r.jsx(l,{variant:"outline",className:"text-xs",children:e.difficulty})]}),r.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:e.prompt_text}),e.passage_text&&r.jsxs("p",{className:"text-xs text-muted-foreground italic line-clamp-1",children:["Passage: ",e.passage_text]}),r.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.image_url&&r.jsx("img",{src:e.image_url,alt:"Preview",className:"h-12 w-12 object-cover rounded"}),e.audio_url&&r.jsxs(n,{variant:"outline",size:"sm",onClick:()=>{return s=e.id,a=e.audio_url,void(J===s?(null==(t=U.current)||t.pause(),V(null)):U.current&&(U.current.src=a,U.current.play(),V(s)));var s,a,t},children:[J===e.id?r.jsx(f,{className:"w-3 h-3 mr-1"}):r.jsx(w,{className:"w-3 h-3 mr-1"}),"Audio"]}),r.jsxs("span",{className:"text-xs text-muted-foreground",children:["Created: ",new Date(e.created_at).toLocaleDateString()]})]})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(n,{variant:"ghost",size:"icon",onClick:()=>(e=>{ee(e.id),ae({title:e.title||"",prompt_text:e.prompt_text,passage_text:e.passage_text||"",sample_answer:e.sample_answer||"",difficulty:e.difficulty||"medium"}),e.image_url&&ne(e.image_url),K(!0)})(e),children:r.jsx(z,{className:"w-4 h-4"})}),r.jsxs(v,{children:[r.jsx(y,{asChild:!0,children:r.jsx(n,{variant:"ghost",size:"icon",children:r.jsx(D,{className:"w-4 h-4 text-red-500"})})}),r.jsxs(N,{children:[r.jsxs(_,{children:[r.jsx(b,{children:"Delete Item"}),r.jsx(k,{children:"Are you sure you want to delete this item? This action cannot be undone."})]}),r.jsxs(I,{children:[r.jsx(A,{children:"Cancel"}),r.jsx(L,{onClick:()=>(async e=>{try{const{error:s}=await C.from("pte_items").delete().eq("id",e);if(s)throw s;i.success("Item deleted"),de()}catch(s){console.error("Error deleting item:",s),i.error("Failed to delete item")}})(e.id),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]})})},e.id))})]})]})]}):r.jsx(P,{title:"PTE Admin",showBackButton:!0,backPath:"/admin/pte",children:r.jsxs("div",{className:"text-center py-12",children:[r.jsx("p",{className:"text-muted-foreground",children:"Invalid question type"}),r.jsx(n,{onClick:()=>$("/admin/pte"),className:"mt-4",children:"Back to PTE Admin"})]})})};export{$ as default};
