import{u as e,c as s,r as a,j as t}from"./vendor-react-rLLBBC7n.js";import{n as i,s as r,J as n,B as l,e as o,C as d,a as c,b as m,c as u,L as h,I as p,T as x}from"./index-KxDfHqNJ.js";import{A as g,a as j,b as v,c as f,d as w,e as y,f as N,g as _,h as b}from"./alert-dialog-Bvks6upm.js";import{A as k}from"./AdminLayout-DGXoIbe0.js";import{aS as L,X as A,aw as I,b5 as P,av as C,aK as S,aL as E,a_ as z,aY as D}from"./vendor-ui-BGi_EvHx.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-charts-0DeywwxG.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";const R={read_aloud:{name:"Read Aloud",description:"Read a text aloud with correct pronunciation and intonation",hasImage:!1,hasAudio:!1,hasPassage:!0,timeLimit:40,instructions:"Look at the text below. In 30-40 seconds, you must read this text aloud as naturally and clearly as possible."},repeat_sentence:{name:"Repeat Sentence",description:"Listen and repeat the sentence exactly",hasImage:!1,hasAudio:!0,hasPassage:!1,timeLimit:15,instructions:"You will hear a sentence. Please repeat the sentence exactly as you hear it."},describe_image:{name:"Describe Image",description:"Describe an image in detail",hasImage:!0,hasAudio:!1,hasPassage:!1,timeLimit:40,instructions:"Look at the image below. In 25 seconds, please speak into the microphone and describe in detail what the image is showing."},retell_lecture:{name:"Retell Lecture",description:"Listen to a lecture and retell it in your own words",hasImage:!0,hasAudio:!0,hasPassage:!1,timeLimit:40,instructions:"You will hear a lecture. After listening to the lecture, in 10 seconds, please speak into the microphone and retell what you have just heard."},answer_short_question:{name:"Answer Short Question",description:"Answer a question with one or a few words",hasImage:!1,hasAudio:!0,hasPassage:!1,timeLimit:10,instructions:"You will hear a question. Please give a simple and short answer. Often just one or a few words is enough."},summarize_group_discussion:{name:"Summarize Group Discussion",description:"Summarize the main points of a group discussion",hasImage:!1,hasAudio:!0,hasPassage:!1,timeLimit:70,instructions:"You will hear a group discussion. You will have 10 seconds to prepare, then summarize the main points of the discussion in 70 seconds."},respond_to_situation:{name:"Respond to a Situation",description:"Respond appropriately to a given situation",hasImage:!1,hasAudio:!1,hasPassage:!0,timeLimit:40,instructions:"You will see a scenario. In 20 seconds prepare time, think about what you would say in this situation. Then speak for up to 40 seconds."},summarize_written_text:{name:"Summarize Written Text",description:"Write a one-sentence summary of a passage",hasImage:!1,hasAudio:!1,hasPassage:!0,timeLimit:600,wordLimit:75,instructions:"Read the passage below. Write a one-sentence summary of the passage. Your summary should be between 5 and 75 words."},write_essay:{name:"Write Essay",description:"Write a 200-300 word argumentative essay",hasImage:!1,hasAudio:!1,hasPassage:!1,timeLimit:1200,wordLimit:300,instructions:"You will have 20 minutes to plan, write and revise an essay about the topic below. Your response will be judged on how well you develop a position, organize your ideas, present supporting details, and control the elements of standard written English."}},$=()=>{const $=e(),{type:T}=s(),{admin:Y,loading:q}=i(),U=a.useRef(null),F=a.useRef(null),B=a.useRef(null),[W,O]=a.useState([]),[M,Q]=a.useState(!0),[G,H]=a.useState(!1),[J,K]=a.useState(null),[V,X]=a.useState(!1),[Z,ee]=a.useState(null),[se,ae]=a.useState({title:"",prompt_text:"",passage_text:"",sample_answer:"",difficulty:"medium"}),[te,ie]=a.useState(null),[re,ne]=a.useState(null),[le,oe]=a.useState(null),de=T?R[T]:null;a.useEffect(()=>{q||Y||$("/admin/login")},[Y,q,$]),a.useEffect(()=>{T&&Y&&ce()},[T,Y]);const ce=async()=>{if(T){Q(!0);try{const{data:e,error:s}=await r.from("pte_items").select("*").eq("pte_section_type",T).order("created_at",{ascending:!1});if(s)throw s;O(e||[])}catch(e){console.error("Error loading items:",e),n.error("Failed to load items")}finally{Q(!1)}}},me=(e,s)=>{var a;const t=null==(a=e.target.files)?void 0:a[0];if(t)if("image"===s){ie(t);const e=new FileReader;e.onloadend=()=>{ne(e.result)},e.readAsDataURL(t)}else oe(t)},ue=()=>{ae({title:"",prompt_text:"",passage_text:"",sample_answer:"",difficulty:"medium"}),ie(null),ne(null),oe(null),ee(null),X(!1)};return q||M?t.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):de?t.jsxs(k,{title:`PTE: ${de.name}`,showBackButton:!0,backPath:"/admin/pte",children:[t.jsx("audio",{ref:U,onEnded:()=>K(null),className:"hidden"}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold",children:de.name}),t.jsx("p",{className:"text-muted-foreground",children:de.description})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(o,{variant:"secondary",className:"bg-violet-100 text-violet-700",children:[W.length," items"]}),t.jsxs(o,{variant:"outline",children:["Time: ",de.timeLimit>=60?`${Math.floor(de.timeLimit/60)} min`:`${de.timeLimit} sec`]}),de.wordLimit&&t.jsxs(o,{variant:"outline",children:["Words: ",de.wordLimit]})]})]}),t.jsx(d,{className:"bg-violet-50 dark:bg-violet-950/20 border-violet-200 dark:border-violet-800",children:t.jsx(c,{className:"pt-4",children:t.jsxs("p",{className:"text-sm text-violet-700 dark:text-violet-300",children:[t.jsx("strong",{children:"Instructions:"})," ",de.instructions]})})}),V?t.jsxs(d,{children:[t.jsx(m,{children:t.jsx(u,{children:Z?"Edit Item":"Add New Item"})}),t.jsxs(c,{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(h,{children:"Title (Optional)"}),t.jsx(p,{value:se.title,onChange:e=>ae(s=>({...s,title:e.target.value})),placeholder:`${de.name} prompt title`})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(h,{children:"Difficulty"}),t.jsxs("select",{value:se.difficulty,onChange:e=>ae(s=>({...s,difficulty:e.target.value})),className:"w-full h-10 px-3 rounded-md border border-input bg-background",children:[t.jsx("option",{value:"easy",children:"Easy"}),t.jsx("option",{value:"medium",children:"Medium"}),t.jsx("option",{value:"hard",children:"Hard"})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(h,{children:"Prompt / Question *"}),t.jsx(x,{value:se.prompt_text,onChange:e=>ae(s=>({...s,prompt_text:e.target.value})),placeholder:"Enter the prompt or question text",rows:3})]}),de.hasPassage&&t.jsxs("div",{className:"space-y-2",children:[t.jsx(h,{children:"Passage Text"}),t.jsx(x,{value:se.passage_text,onChange:e=>ae(s=>({...s,passage_text:e.target.value})),placeholder:"Enter the passage text for reading or summarizing",rows:6})]}),de.hasImage&&t.jsxs("div",{className:"space-y-2",children:[t.jsx(h,{children:"Image"}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("input",{ref:F,type:"file",accept:"image/*",onChange:e=>me(e,"image"),className:"hidden"}),t.jsxs(l,{type:"button",variant:"outline",onClick:()=>{var e;return null==(e=F.current)?void 0:e.click()},children:[t.jsx(L,{className:"w-4 h-4 mr-2"}),"Upload Image"]}),re&&t.jsxs("div",{className:"relative",children:[t.jsx("img",{src:re,alt:"Preview",className:"h-20 w-20 object-cover rounded"}),t.jsx(l,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-6 w-6",onClick:()=>{ie(null),ne(null)},children:t.jsx(A,{className:"w-3 h-3"})})]})]})]}),de.hasAudio&&t.jsxs("div",{className:"space-y-2",children:[t.jsx(h,{children:"Audio"}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("input",{ref:B,type:"file",accept:"audio/*",onChange:e=>me(e,"audio"),className:"hidden"}),t.jsxs(l,{type:"button",variant:"outline",onClick:()=>{var e;return null==(e=B.current)?void 0:e.click()},children:[t.jsx(I,{className:"w-4 h-4 mr-2"}),"Upload Audio"]}),le&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(o,{variant:"secondary",children:le.name}),t.jsx(l,{type:"button",variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>oe(null),children:t.jsx(A,{className:"w-3 h-3"})})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(h,{children:"Sample Answer (Optional)"}),t.jsx(x,{value:se.sample_answer,onChange:e=>ae(s=>({...s,sample_answer:e.target.value})),placeholder:"Enter a sample answer for reference",rows:4})]}),t.jsxs("div",{className:"flex gap-3 justify-end",children:[t.jsx(l,{variant:"outline",onClick:ue,children:"Cancel"}),t.jsxs(l,{onClick:async()=>{if(T&&se.prompt_text.trim()){H(!0);try{let e=null,s=null;te&&(e=await(async e=>{try{const s=`pte/${T}/${Date.now()}_${e.name}`,{data:a,error:t}=await r.storage.from("images").upload(s,e,{upsert:!0});if(t)throw t;const{data:{publicUrl:i}}=r.storage.from("images").getPublicUrl(s);return i}catch(s){return console.error("Error uploading image:",s),n.error("Failed to upload image"),null}})(te)),le&&(s=await(async e=>{try{const s=`pte/${T}/${Date.now()}_${e.name}`,{data:a,error:t}=await r.storage.from("audio").upload(s,e,{upsert:!0});if(t)throw t;const{data:{publicUrl:i}}=r.storage.from("audio").getPublicUrl(s);return i}catch(s){return console.error("Error uploading audio:",s),n.error("Failed to upload audio"),null}})(le));const a={pte_skill:"speaking_writing",pte_section_type:T,title:se.title||`${null==de?void 0:de.name} - ${(new Date).toLocaleDateString()}`,prompt_text:se.prompt_text,passage_text:se.passage_text||null,sample_answer:se.sample_answer||null,time_limit:(null==de?void 0:de.timeLimit)||60,word_limit:(null==de?void 0:de.wordLimit)||null,difficulty:se.difficulty,...e&&{image_url:e},...s&&{audio_url:s}};if(Z){const{error:e}=await r.from("pte_items").update(a).eq("id",Z);if(e)throw e;n.success("Item updated successfully")}else{const{error:e}=await r.from("pte_items").insert(a);if(e)throw e;n.success("Item created successfully")}ue(),ce()}catch(e){console.error("Error saving item:",e),n.error("Failed to save item")}finally{H(!1)}}else n.error("Please fill in the required fields")},disabled:G,className:"bg-violet-600 hover:bg-violet-700",children:[t.jsx(P,{className:"w-4 h-4 mr-2"}),G?"Saving...":Z?"Update":"Save"]})]})]})]}):t.jsxs(l,{onClick:()=>X(!0),className:"bg-violet-600 hover:bg-violet-700",children:[t.jsx(C,{className:"w-4 h-4 mr-2"}),"Add New ",de.name," Item"]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("h3",{className:"text-lg font-semibold",children:["Existing Items (",W.length,")"]}),0===W.length?t.jsx(d,{className:"border-dashed",children:t.jsxs(c,{className:"flex flex-col items-center justify-center py-12",children:[t.jsxs("p",{className:"text-muted-foreground mb-4",children:["No ",de.name," items created yet"]}),t.jsxs(l,{onClick:()=>X(!0),className:"bg-violet-600 hover:bg-violet-700",children:[t.jsx(C,{className:"w-4 h-4 mr-2"}),"Add First ",de.name," Item"]})]})}):t.jsx("div",{className:"grid gap-4",children:W.map(e=>t.jsx(d,{className:"hover:shadow-md transition-shadow",children:t.jsx(c,{className:"pt-4",children:t.jsxs("div",{className:"flex items-start justify-between gap-4",children:[t.jsxs("div",{className:"flex-1 space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h4",{className:"font-medium",children:e.title||"Untitled"}),t.jsx(o,{variant:"outline",className:"text-xs",children:e.difficulty})]}),t.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:e.prompt_text}),e.passage_text&&t.jsxs("p",{className:"text-xs text-muted-foreground italic line-clamp-1",children:["Passage: ",e.passage_text]}),t.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.image_url&&t.jsx("img",{src:e.image_url,alt:"Preview",className:"h-12 w-12 object-cover rounded"}),e.audio_url&&t.jsxs(l,{variant:"outline",size:"sm",onClick:()=>{return s=e.id,a=e.audio_url,void(J===s?(null==(t=U.current)||t.pause(),K(null)):U.current&&(U.current.src=a,U.current.play(),K(s)));var s,a,t},children:[J===e.id?t.jsx(S,{className:"w-3 h-3 mr-1"}):t.jsx(E,{className:"w-3 h-3 mr-1"}),"Audio"]}),t.jsxs("span",{className:"text-xs text-muted-foreground",children:["Created: ",new Date(e.created_at).toLocaleDateString()]})]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(l,{variant:"ghost",size:"icon",onClick:()=>(e=>{ee(e.id),ae({title:e.title||"",prompt_text:e.prompt_text,passage_text:e.passage_text||"",sample_answer:e.sample_answer||"",difficulty:e.difficulty||"medium"}),e.image_url&&ne(e.image_url),X(!0)})(e),children:t.jsx(z,{className:"w-4 h-4"})}),t.jsxs(g,{children:[t.jsx(j,{asChild:!0,children:t.jsx(l,{variant:"ghost",size:"icon",children:t.jsx(D,{className:"w-4 h-4 text-red-500"})})}),t.jsxs(v,{children:[t.jsxs(f,{children:[t.jsx(w,{children:"Delete Item"}),t.jsx(y,{children:"Are you sure you want to delete this item? This action cannot be undone."})]}),t.jsxs(N,{children:[t.jsx(_,{children:"Cancel"}),t.jsx(b,{onClick:()=>(async e=>{try{const{error:s}=await r.from("pte_items").delete().eq("id",e);if(s)throw s;n.success("Item deleted"),ce()}catch(s){console.error("Error deleting item:",s),n.error("Failed to delete item")}})(e.id),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]})})},e.id))})]})]})]}):t.jsx(k,{title:"PTE Admin",showBackButton:!0,backPath:"/admin/pte",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("p",{className:"text-muted-foreground",children:"Invalid question type"}),t.jsx(l,{onClick:()=>$("/admin/pte"),className:"mt-4",children:"Back to PTE Admin"})]})})};export{$ as default};
