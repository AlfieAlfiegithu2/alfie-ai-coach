import{u as e,r as s,j as a}from"./vendor-react-rLLBBC7n.js";import{s as l,J as r,B as t,C as i,a as n,e as c,D as d,f as o,g as u,h as m,W as x,L as h,I as p,T as j,S as g,i as v,j as f,k as N,l as b,X as y}from"./index-KxDfHqNJ.js";import{S as w}from"./switch-Rf9jiFN5.js";import{A as C,a as P,b as _,c as k,d as S,e as F,f as E,g as A,h as T}from"./alert-dialog-Bvks6upm.js";import{A as L}from"./AdminLayout-DGXoIbe0.js";import{u as z}from"./cloudflare-r2-NK5E1VTl.js";import{av as D,cE as B,aN as $,aJ as I,aA as R,y as U,aK as q,aL as M,aX as V,aY as G,aV as J,aS as X}from"./vendor-ui-BGi_EvHx.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-charts-0DeywwxG.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";const Y=[{value:"general",label:"General English"},{value:"ielts",label:"IELTS Preparation"},{value:"business",label:"Business English"},{value:"pronunciation",label:"Pronunciation"},{value:"vocabulary",label:"Vocabulary"},{value:"grammar",label:"Grammar"},{value:"listening",label:"Listening Practice"},{value:"culture",label:"Culture & Idioms"}],Z=[{value:"beginner",label:"Beginner",color:"bg-green-100 text-green-800"},{value:"intermediate",label:"Intermediate",color:"bg-blue-100 text-blue-800"},{value:"advanced",label:"Advanced",color:"bg-purple-100 text-purple-800"}],K=()=>{e();const[K,O]=s.useState([]),[W,H]=s.useState(!0),[Q,ee]=s.useState(!1),[se,ae]=s.useState(null),[le,re]=s.useState(!1),[te,ie]=s.useState(null),[ne,ce]=s.useState(""),[de,oe]=s.useState(""),[ue,me]=s.useState("general"),[xe,he]=s.useState("intermediate"),[pe,je]=s.useState(""),[ge,ve]=s.useState(!1),[fe,Ne]=s.useState(null),[be,ye]=s.useState(null),[we,Ce]=s.useState(""),[Pe,_e]=s.useState(""),[ke,Se]=s.useState(!1),[Fe,Ee]=s.useState(!1),Ae=s.useRef(null),Te=s.useRef(null),Le=s.useRef(null);s.useEffect(()=>{ze()},[]);const ze=async()=>{try{H(!0);const{data:e,error:s}=await l.from("podcasts").select("*").order("created_at",{ascending:!1});if(s)throw s;O(e||[])}catch(e){console.error("Error loading podcasts:",e),r.error("Failed to load podcasts")}finally{H(!1)}},De=()=>{ce(""),oe(""),me("general"),he("intermediate"),je(""),ve(!1),Ne(null),ye(null),Ce(""),_e(""),ae(null)},Be=()=>{De(),ee(!0)},$e=e=>{if(!e)return"--:--";return`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`};return a.jsxs(L,{title:"Podcast Management",showBackButton:!0,children:[a.jsx("audio",{ref:Le,onEnded:()=>ie(null),className:"hidden"}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Podcasts"}),a.jsx("p",{className:"text-gray-600 mt-1",children:"Create and manage audio podcasts for students"})]}),a.jsxs(t,{onClick:Be,className:"gap-2",children:[a.jsx(D,{className:"w-4 h-4"}),"Create Podcast"]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsx(i,{children:a.jsxs(n,{className:"p-4 flex items-center gap-4",children:[a.jsx("div",{className:"p-3 rounded-full bg-purple-100",children:a.jsx(B,{className:"w-6 h-6 text-purple-600"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-2xl font-bold",children:K.length}),a.jsx("p",{className:"text-sm text-gray-600",children:"Total Podcasts"})]})]})}),a.jsx(i,{children:a.jsxs(n,{className:"p-4 flex items-center gap-4",children:[a.jsx("div",{className:"p-3 rounded-full bg-green-100",children:a.jsx($,{className:"w-6 h-6 text-green-600"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-2xl font-bold",children:K.filter(e=>e.is_published).length}),a.jsx("p",{className:"text-sm text-gray-600",children:"Published"})]})]})}),a.jsx(i,{children:a.jsxs(n,{className:"p-4 flex items-center gap-4",children:[a.jsx("div",{className:"p-3 rounded-full bg-blue-100",children:a.jsx(I,{className:"w-6 h-6 text-blue-600"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-2xl font-bold",children:K.reduce((e,s)=>e+s.play_count,0)}),a.jsx("p",{className:"text-sm text-gray-600",children:"Total Plays"})]})]})}),a.jsx(i,{children:a.jsxs(n,{className:"p-4 flex items-center gap-4",children:[a.jsx("div",{className:"p-3 rounded-full bg-orange-100",children:a.jsx(R,{className:"w-6 h-6 text-orange-600"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-2xl font-bold",children:$e(K.reduce((e,s)=>e+(s.duration_seconds||0),0))}),a.jsx("p",{className:"text-sm text-gray-600",children:"Total Duration"})]})]})})]}),W?a.jsxs("div",{className:"text-center py-12",children:[a.jsx(U,{className:"w-8 h-8 animate-spin mx-auto text-gray-400"}),a.jsx("p",{className:"mt-4 text-gray-600",children:"Loading podcasts..."})]}):0===K.length?a.jsx(i,{children:a.jsxs(n,{className:"p-12 text-center",children:[a.jsx(B,{className:"w-16 h-16 mx-auto text-gray-300 mb-4"}),a.jsx("h3",{className:"text-xl font-semibold text-gray-700 mb-2",children:"No Podcasts Yet"}),a.jsx("p",{className:"text-gray-600 mb-6",children:"Create your first podcast to share with students"}),a.jsxs(t,{onClick:Be,children:[a.jsx(D,{className:"w-4 h-4 mr-2"}),"Create First Podcast"]})]})}):a.jsx("div",{className:"grid gap-4",children:K.map(e=>{var s,d,o;return a.jsx(i,{className:"hover:shadow-md transition-shadow",children:a.jsx(n,{className:"p-6",children:a.jsxs("div",{className:"flex gap-4",children:[a.jsx("div",{className:"flex-shrink-0",children:e.cover_image_url?a.jsx("img",{src:e.cover_image_url,alt:e.title,className:"w-24 h-24 rounded-lg object-cover"}):a.jsx("div",{className:"w-24 h-24 rounded-lg bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center",children:a.jsx(I,{className:"w-10 h-10 text-white"})})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-start justify-between gap-4",children:[a.jsxs("div",{className:"min-w-0",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 truncate",children:e.title}),a.jsx("p",{className:"text-sm text-gray-600 line-clamp-2 mt-1",children:e.description||"No description"})]}),a.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:a.jsx(c,{variant:e.is_published?"default":"secondary",children:e.is_published?"Published":"Draft"})})]}),a.jsxs("div",{className:"flex items-center gap-4 mt-3",children:[a.jsx(c,{variant:"outline",className:null==(s=Z.find(s=>s.value===e.level))?void 0:s.color,children:null==(d=Z.find(s=>s.value===e.level))?void 0:d.label}),a.jsx("span",{className:"text-sm text-gray-500",children:null==(o=Y.find(s=>s.value===e.category))?void 0:o.label}),a.jsxs("span",{className:"text-sm text-gray-500 flex items-center gap-1",children:[a.jsx(R,{className:"w-4 h-4"}),$e(e.duration_seconds)]}),a.jsxs("span",{className:"text-sm text-gray-500 flex items-center gap-1",children:[a.jsx(I,{className:"w-4 h-4"}),e.play_count," plays"]})]}),a.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[a.jsx(t,{variant:"outline",size:"sm",onClick:()=>(e=>{var s;te===e.id?(null==(s=Le.current)||s.pause(),ie(null)):Le.current&&(Le.current.src=e.audio_url,Le.current.play(),ie(e.id))})(e),className:"gap-1",children:te===e.id?a.jsxs(a.Fragment,{children:[a.jsx(q,{className:"w-4 h-4"}),"Pause"]}):a.jsxs(a.Fragment,{children:[a.jsx(M,{className:"w-4 h-4"}),"Preview"]})}),a.jsxs(t,{variant:"outline",size:"sm",onClick:()=>(e=>{ae(e),ce(e.title),oe(e.description||""),me(e.category),he(e.level),je(e.transcript||""),ve(e.is_published),Ce(e.audio_url),_e(e.cover_image_url||""),ee(!0)})(e),className:"gap-1",children:[a.jsx(V,{className:"w-4 h-4"}),"Edit"]}),a.jsx(t,{variant:"outline",size:"sm",onClick:()=>(async e=>{try{const{error:s}=await l.from("podcasts").update({is_published:!e.is_published}).eq("id",e.id);if(s)throw s;r.success(e.is_published?"Podcast unpublished":"Podcast published"),ze()}catch(s){console.error("Error toggling publish:",s),r.error("Failed to update podcast")}})(e),children:e.is_published?"Unpublish":"Publish"}),a.jsxs(C,{children:[a.jsx(P,{asChild:!0,children:a.jsx(t,{variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700",children:a.jsx(G,{className:"w-4 h-4"})})}),a.jsxs(_,{children:[a.jsxs(k,{children:[a.jsx(S,{children:"Delete Podcast"}),a.jsxs(F,{children:['Are you sure you want to delete "',e.title,'"? This action cannot be undone.']})]}),a.jsxs(E,{children:[a.jsx(A,{children:"Cancel"}),a.jsx(T,{onClick:()=>(async e=>{try{const{error:s}=await l.from("podcasts").delete().eq("id",e);if(s)throw s;r.success("Podcast deleted successfully"),ze()}catch(s){console.error("Error deleting podcast:",s),r.error(s.message||"Failed to delete podcast")}})(e.id),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]})]})})},e.id)})})]}),a.jsx(d,{open:Q,onOpenChange:ee,children:a.jsxs(o,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[a.jsxs(u,{children:[a.jsx(m,{children:se?"Edit Podcast":"Create New Podcast"}),a.jsx(x,{children:se?"Update the podcast details below":"Fill in the details to create a new podcast episode"})]}),a.jsxs("div",{className:"space-y-6 py-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(h,{htmlFor:"title",children:"Title *"}),a.jsx(p,{id:"title",value:ne,onChange:e=>ce(e.target.value),placeholder:"Episode title..."})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(h,{htmlFor:"description",children:"Description"}),a.jsx(j,{id:"description",value:de,onChange:e=>oe(e.target.value),placeholder:"Brief description of the episode...",rows:3})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(h,{children:"Audio File *"}),a.jsx("input",{ref:Ae,type:"file",accept:"audio/*",onChange:e=>{var s;const a=null==(s=e.target.files)?void 0:s[0];a&&(Ne(a),(async e=>{try{Se(!0);const s=`podcasts/audio/${Date.now()}-${e.name.replace(/[^a-zA-Z0-9.-]/g,"_")}`,a=await z(e,s,{contentType:e.type||"audio/mpeg"});a.url&&(Ce(a.url),r.success("Audio uploaded successfully!"),new Audio(a.url).addEventListener("loadedmetadata",()=>{}))}catch(s){console.error("Error uploading audio:",s),r.error("Failed to upload audio")}finally{Se(!1)}})(a))},className:"hidden"}),we?a.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 rounded-lg border border-green-200",children:[a.jsx(B,{className:"w-5 h-5 text-green-600"}),a.jsx("span",{className:"text-sm text-green-800 flex-1 truncate",children:"Audio uploaded successfully"}),a.jsx(t,{variant:"outline",size:"sm",onClick:()=>{var e;return null==(e=Ae.current)?void 0:e.click()},disabled:ke,children:"Replace"})]}):a.jsx(t,{variant:"outline",onClick:()=>{var e;return null==(e=Ae.current)?void 0:e.click()},disabled:ke,className:"w-full h-20 border-dashed",children:ke?a.jsxs(a.Fragment,{children:[a.jsx(U,{className:"w-5 h-5 mr-2 animate-spin"}),"Uploading..."]}):a.jsxs(a.Fragment,{children:[a.jsx(J,{className:"w-5 h-5 mr-2"}),"Click to upload audio file"]})})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(h,{children:"Cover Image (optional)"}),a.jsx("input",{ref:Te,type:"file",accept:"image/*",onChange:e=>{var s;const a=null==(s=e.target.files)?void 0:s[0];a&&(ye(a),(async e=>{try{Ee(!0);const s=`podcasts/covers/${Date.now()}-${e.name.replace(/[^a-zA-Z0-9.-]/g,"_")}`,a=await z(e,s,{contentType:e.type||"image/jpeg"});a.url&&(_e(a.url),r.success("Cover image uploaded successfully!"))}catch(s){console.error("Error uploading cover:",s),r.error("Failed to upload cover image")}finally{Ee(!1)}})(a))},className:"hidden"}),Pe?a.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[a.jsx("img",{src:Pe,alt:"Cover",className:"w-16 h-16 rounded object-cover"}),a.jsx("span",{className:"text-sm text-blue-800 flex-1",children:"Cover image uploaded"}),a.jsx(t,{variant:"outline",size:"sm",onClick:()=>{var e;return null==(e=Te.current)?void 0:e.click()},disabled:Fe,children:"Replace"})]}):a.jsx(t,{variant:"outline",onClick:()=>{var e;return null==(e=Te.current)?void 0:e.click()},disabled:Fe,className:"w-full h-16 border-dashed",children:Fe?a.jsxs(a.Fragment,{children:[a.jsx(U,{className:"w-5 h-5 mr-2 animate-spin"}),"Uploading..."]}):a.jsxs(a.Fragment,{children:[a.jsx(X,{className:"w-5 h-5 mr-2"}),"Click to upload cover image"]})})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(h,{children:"Category"}),a.jsxs(g,{value:ue,onValueChange:me,children:[a.jsx(v,{children:a.jsx(f,{})}),a.jsx(N,{children:Y.map(e=>a.jsx(b,{value:e.value,children:e.label},e.value))})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(h,{children:"Level"}),a.jsxs(g,{value:xe,onValueChange:e=>he(e),children:[a.jsx(v,{children:a.jsx(f,{})}),a.jsx(N,{children:Z.map(e=>a.jsx(b,{value:e.value,children:e.label},e.value))})]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(h,{htmlFor:"transcript",children:"Transcript (optional)"}),a.jsx(j,{id:"transcript",value:pe,onChange:e=>je(e.target.value),placeholder:"Full transcript of the audio...",rows:5})]}),a.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[a.jsxs("div",{children:[a.jsx(h,{htmlFor:"publish",className:"text-base font-medium",children:"Publish immediately"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Make this podcast visible to students"})]}),a.jsx(w,{id:"publish",checked:ge,onCheckedChange:ve})]})]}),a.jsxs(y,{children:[a.jsx(t,{variant:"outline",onClick:()=>ee(!1),children:"Cancel"}),a.jsx(t,{onClick:async()=>{try{if(!ne.trim())return void r.error("Title is required");if(!we)return void r.error("Please upload an audio file");re(!0);let s=null;try{const e=new Audio(we);await new Promise((a,l)=>{e.addEventListener("loadedmetadata",()=>{s=Math.round(e.duration),a(null)}),e.addEventListener("error",l),setTimeout(a,3e3)})}catch(e){console.log("Could not get audio duration")}const a={title:ne.trim(),description:de.trim()||null,audio_url:we,cover_image_url:Pe||null,duration_seconds:s,category:ue,level:xe,transcript:pe.trim()||null,is_published:ge};if(se){const{error:e}=await l.from("podcasts").update(a).eq("id",se.id);if(e)throw e;r.success("Podcast updated successfully!")}else{const{error:e}=await l.from("podcasts").insert(a);if(e)throw e;r.success("Podcast created successfully!")}ee(!1),De(),ze()}catch(s){console.error("Error saving podcast:",s),r.error(s.message||"Failed to save podcast")}finally{re(!1)}},disabled:le||ke||Fe,children:le?a.jsxs(a.Fragment,{children:[a.jsx(U,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):se?"Update Podcast":"Create Podcast"})]})]})})]})};export{K as default};
