import{u as e,r as s,J as a,j as l,B as r,P as t,C as i,a as c,E as n,H as d,R as o,ao as u,l as m,U as x,W as h,D as p,m as j,n as g,o as v,bm as f,O as N,I as b,T as y,S as w,p as C,q as P,s as _,t as k,bp as S}from"./index-CmOVWJw-.js";import{S as F}from"./switch-DY3r4c5Z.js";import{A as E,a as T,b as A,c as L,d as z,e as D,f as U,g as q,h as B}from"./alert-dialog-C-DFnyZD.js";import{A as I}from"./AdminLayout-C6Vwy61u.js";import{s as R}from"./supabase-DWL4C3fA.js";import{u as $}from"./cloudflare-r2-Bg99fdQ0.js";import{M}from"./music-5zGmFidZ.js";import{S as V}from"./square-pen-DdXBlzLL.js";import{T as G}from"./trash-2-C8PwyB4u.js";import{U as H}from"./upload-3qOCHoJE.js";import{I as O}from"./image-CWGu7Eoa.js";const Z=[{value:"general",label:"General English"},{value:"ielts",label:"IELTS Preparation"},{value:"business",label:"Business English"},{value:"pronunciation",label:"Pronunciation"},{value:"vocabulary",label:"Vocabulary"},{value:"grammar",label:"Grammar"},{value:"listening",label:"Listening Practice"},{value:"culture",label:"Culture & Idioms"}],J=[{value:"beginner",label:"Beginner",color:"bg-green-100 text-green-800"},{value:"intermediate",label:"Intermediate",color:"bg-blue-100 text-blue-800"},{value:"advanced",label:"Advanced",color:"bg-purple-100 text-purple-800"}],W=()=>{e();const[W,Y]=s.useState([]),[K,Q]=s.useState(!0),[X,ee]=s.useState(!1),[se,ae]=s.useState(null),[le,re]=s.useState(!1),[te,ie]=s.useState(null),[ce,ne]=s.useState(""),[de,oe]=s.useState(""),[ue,me]=s.useState("general"),[xe,he]=s.useState("intermediate"),[pe,je]=s.useState(""),[ge,ve]=s.useState(!1),[fe,Ne]=s.useState(null),[be,ye]=s.useState(null),[we,Ce]=s.useState(""),[Pe,_e]=s.useState(""),[ke,Se]=s.useState(!1),[Fe,Ee]=s.useState(!1),Te=s.useRef(null),Ae=s.useRef(null),Le=s.useRef(null);s.useEffect(()=>{ze()},[]);const ze=async()=>{try{Q(!0);const{data:e,error:s}=await R.from("podcasts").select("*").order("created_at",{ascending:!1});if(s)throw s;Y(e||[])}catch(e){console.error("Error loading podcasts:",e),a.error("Failed to load podcasts")}finally{Q(!1)}},De=()=>{ne(""),oe(""),me("general"),he("intermediate"),je(""),ve(!1),Ne(null),ye(null),Ce(""),_e(""),ae(null)},Ue=()=>{De(),ee(!0)},qe=e=>{if(!e)return"--:--";return`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`};return l.jsxs(I,{title:"Podcast Management",showBackButton:!0,children:[l.jsx("audio",{ref:Le,onEnded:()=>ie(null),className:"hidden"}),l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Podcasts"}),l.jsx("p",{className:"text-gray-600 mt-1",children:"Create and manage audio podcasts for students"})]}),l.jsxs(r,{onClick:Ue,className:"gap-2",children:[l.jsx(t,{className:"w-4 h-4"}),"Create Podcast"]})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[l.jsx(i,{children:l.jsxs(c,{className:"p-4 flex items-center gap-4",children:[l.jsx("div",{className:"p-3 rounded-full bg-purple-100",children:l.jsx(M,{className:"w-6 h-6 text-purple-600"})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-2xl font-bold",children:W.length}),l.jsx("p",{className:"text-sm text-gray-600",children:"Total Podcasts"})]})]})}),l.jsx(i,{children:l.jsxs(c,{className:"p-4 flex items-center gap-4",children:[l.jsx("div",{className:"p-3 rounded-full bg-green-100",children:l.jsx(n,{className:"w-6 h-6 text-green-600"})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-2xl font-bold",children:W.filter(e=>e.is_published).length}),l.jsx("p",{className:"text-sm text-gray-600",children:"Published"})]})]})}),l.jsx(i,{children:l.jsxs(c,{className:"p-4 flex items-center gap-4",children:[l.jsx("div",{className:"p-3 rounded-full bg-blue-100",children:l.jsx(d,{className:"w-6 h-6 text-blue-600"})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-2xl font-bold",children:W.reduce((e,s)=>e+s.play_count,0)}),l.jsx("p",{className:"text-sm text-gray-600",children:"Total Plays"})]})]})}),l.jsx(i,{children:l.jsxs(c,{className:"p-4 flex items-center gap-4",children:[l.jsx("div",{className:"p-3 rounded-full bg-orange-100",children:l.jsx(o,{className:"w-6 h-6 text-orange-600"})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-2xl font-bold",children:qe(W.reduce((e,s)=>e+(s.duration_seconds||0),0))}),l.jsx("p",{className:"text-sm text-gray-600",children:"Total Duration"})]})]})})]}),K?l.jsxs("div",{className:"text-center py-12",children:[l.jsx(u,{className:"w-8 h-8 animate-spin mx-auto text-gray-400"}),l.jsx("p",{className:"mt-4 text-gray-600",children:"Loading podcasts..."})]}):0===W.length?l.jsx(i,{children:l.jsxs(c,{className:"p-12 text-center",children:[l.jsx(M,{className:"w-16 h-16 mx-auto text-gray-300 mb-4"}),l.jsx("h3",{className:"text-xl font-semibold text-gray-700 mb-2",children:"No Podcasts Yet"}),l.jsx("p",{className:"text-gray-600 mb-6",children:"Create your first podcast to share with students"}),l.jsxs(r,{onClick:Ue,children:[l.jsx(t,{className:"w-4 h-4 mr-2"}),"Create First Podcast"]})]})}):l.jsx("div",{className:"grid gap-4",children:W.map(e=>{var s,t,n;return l.jsx(i,{className:"hover:shadow-md transition-shadow",children:l.jsx(c,{className:"p-6",children:l.jsxs("div",{className:"flex gap-4",children:[l.jsx("div",{className:"flex-shrink-0",children:e.cover_image_url?l.jsx("img",{src:e.cover_image_url,alt:e.title,className:"w-24 h-24 rounded-lg object-cover"}):l.jsx("div",{className:"w-24 h-24 rounded-lg bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center",children:l.jsx(d,{className:"w-10 h-10 text-white"})})}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsxs("div",{className:"flex items-start justify-between gap-4",children:[l.jsxs("div",{className:"min-w-0",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900 truncate",children:e.title}),l.jsx("p",{className:"text-sm text-gray-600 line-clamp-2 mt-1",children:e.description||"No description"})]}),l.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:l.jsx(m,{variant:e.is_published?"default":"secondary",children:e.is_published?"Published":"Draft"})})]}),l.jsxs("div",{className:"flex items-center gap-4 mt-3",children:[l.jsx(m,{variant:"outline",className:null==(s=J.find(s=>s.value===e.level))?void 0:s.color,children:null==(t=J.find(s=>s.value===e.level))?void 0:t.label}),l.jsx("span",{className:"text-sm text-gray-500",children:null==(n=Z.find(s=>s.value===e.category))?void 0:n.label}),l.jsxs("span",{className:"text-sm text-gray-500 flex items-center gap-1",children:[l.jsx(o,{className:"w-4 h-4"}),qe(e.duration_seconds)]}),l.jsxs("span",{className:"text-sm text-gray-500 flex items-center gap-1",children:[l.jsx(d,{className:"w-4 h-4"}),e.play_count," plays"]})]}),l.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[l.jsx(r,{variant:"outline",size:"sm",onClick:()=>(e=>{var s;te===e.id?(null==(s=Le.current)||s.pause(),ie(null)):Le.current&&(Le.current.src=e.audio_url,Le.current.play(),ie(e.id))})(e),className:"gap-1",children:te===e.id?l.jsxs(l.Fragment,{children:[l.jsx(x,{className:"w-4 h-4"}),"Pause"]}):l.jsxs(l.Fragment,{children:[l.jsx(h,{className:"w-4 h-4"}),"Preview"]})}),l.jsxs(r,{variant:"outline",size:"sm",onClick:()=>(e=>{ae(e),ne(e.title),oe(e.description||""),me(e.category),he(e.level),je(e.transcript||""),ve(e.is_published),Ce(e.audio_url),_e(e.cover_image_url||""),ee(!0)})(e),className:"gap-1",children:[l.jsx(V,{className:"w-4 h-4"}),"Edit"]}),l.jsx(r,{variant:"outline",size:"sm",onClick:()=>(async e=>{try{const{error:s}=await R.from("podcasts").update({is_published:!e.is_published}).eq("id",e.id);if(s)throw s;a.success(e.is_published?"Podcast unpublished":"Podcast published"),ze()}catch(s){console.error("Error toggling publish:",s),a.error("Failed to update podcast")}})(e),children:e.is_published?"Unpublish":"Publish"}),l.jsxs(E,{children:[l.jsx(T,{asChild:!0,children:l.jsx(r,{variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700",children:l.jsx(G,{className:"w-4 h-4"})})}),l.jsxs(A,{children:[l.jsxs(L,{children:[l.jsx(z,{children:"Delete Podcast"}),l.jsxs(D,{children:['Are you sure you want to delete "',e.title,'"? This action cannot be undone.']})]}),l.jsxs(U,{children:[l.jsx(q,{children:"Cancel"}),l.jsx(B,{onClick:()=>(async e=>{try{const{error:s}=await R.from("podcasts").delete().eq("id",e);if(s)throw s;a.success("Podcast deleted successfully"),ze()}catch(s){console.error("Error deleting podcast:",s),a.error(s.message||"Failed to delete podcast")}})(e.id),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]})]})})},e.id)})})]}),l.jsx(p,{open:X,onOpenChange:ee,children:l.jsxs(j,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[l.jsxs(g,{children:[l.jsx(v,{children:se?"Edit Podcast":"Create New Podcast"}),l.jsx(f,{children:se?"Update the podcast details below":"Fill in the details to create a new podcast episode"})]}),l.jsxs("div",{className:"space-y-6 py-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(N,{htmlFor:"title",children:"Title *"}),l.jsx(b,{id:"title",value:ce,onChange:e=>ne(e.target.value),placeholder:"Episode title..."})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(N,{htmlFor:"description",children:"Description"}),l.jsx(y,{id:"description",value:de,onChange:e=>oe(e.target.value),placeholder:"Brief description of the episode...",rows:3})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(N,{children:"Audio File *"}),l.jsx("input",{ref:Te,type:"file",accept:"audio/*",onChange:e=>{var s;const l=null==(s=e.target.files)?void 0:s[0];l&&(Ne(l),(async e=>{try{Se(!0);const s=`podcasts/audio/${Date.now()}-${e.name.replace(/[^a-zA-Z0-9.-]/g,"_")}`,l=await $(e,s,{contentType:e.type||"audio/mpeg"});l.url&&(Ce(l.url),a.success("Audio uploaded successfully!"),new Audio(l.url).addEventListener("loadedmetadata",()=>{}))}catch(s){console.error("Error uploading audio:",s),a.error("Failed to upload audio")}finally{Se(!1)}})(l))},className:"hidden"}),we?l.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 rounded-lg border border-green-200",children:[l.jsx(M,{className:"w-5 h-5 text-green-600"}),l.jsx("span",{className:"text-sm text-green-800 flex-1 truncate",children:"Audio uploaded successfully"}),l.jsx(r,{variant:"outline",size:"sm",onClick:()=>{var e;return null==(e=Te.current)?void 0:e.click()},disabled:ke,children:"Replace"})]}):l.jsx(r,{variant:"outline",onClick:()=>{var e;return null==(e=Te.current)?void 0:e.click()},disabled:ke,className:"w-full h-20 border-dashed",children:ke?l.jsxs(l.Fragment,{children:[l.jsx(u,{className:"w-5 h-5 mr-2 animate-spin"}),"Uploading..."]}):l.jsxs(l.Fragment,{children:[l.jsx(H,{className:"w-5 h-5 mr-2"}),"Click to upload audio file"]})})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(N,{children:"Cover Image (optional)"}),l.jsx("input",{ref:Ae,type:"file",accept:"image/*",onChange:e=>{var s;const l=null==(s=e.target.files)?void 0:s[0];l&&(ye(l),(async e=>{try{Ee(!0);const s=`podcasts/covers/${Date.now()}-${e.name.replace(/[^a-zA-Z0-9.-]/g,"_")}`,l=await $(e,s,{contentType:e.type||"image/jpeg"});l.url&&(_e(l.url),a.success("Cover image uploaded successfully!"))}catch(s){console.error("Error uploading cover:",s),a.error("Failed to upload cover image")}finally{Ee(!1)}})(l))},className:"hidden"}),Pe?l.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[l.jsx("img",{src:Pe,alt:"Cover",className:"w-16 h-16 rounded object-cover"}),l.jsx("span",{className:"text-sm text-blue-800 flex-1",children:"Cover image uploaded"}),l.jsx(r,{variant:"outline",size:"sm",onClick:()=>{var e;return null==(e=Ae.current)?void 0:e.click()},disabled:Fe,children:"Replace"})]}):l.jsx(r,{variant:"outline",onClick:()=>{var e;return null==(e=Ae.current)?void 0:e.click()},disabled:Fe,className:"w-full h-16 border-dashed",children:Fe?l.jsxs(l.Fragment,{children:[l.jsx(u,{className:"w-5 h-5 mr-2 animate-spin"}),"Uploading..."]}):l.jsxs(l.Fragment,{children:[l.jsx(O,{className:"w-5 h-5 mr-2"}),"Click to upload cover image"]})})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(N,{children:"Category"}),l.jsxs(w,{value:ue,onValueChange:me,children:[l.jsx(C,{children:l.jsx(P,{})}),l.jsx(_,{children:Z.map(e=>l.jsx(k,{value:e.value,children:e.label},e.value))})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(N,{children:"Level"}),l.jsxs(w,{value:xe,onValueChange:e=>he(e),children:[l.jsx(C,{children:l.jsx(P,{})}),l.jsx(_,{children:J.map(e=>l.jsx(k,{value:e.value,children:e.label},e.value))})]})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(N,{htmlFor:"transcript",children:"Transcript (optional)"}),l.jsx(y,{id:"transcript",value:pe,onChange:e=>je(e.target.value),placeholder:"Full transcript of the audio...",rows:5})]}),l.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[l.jsxs("div",{children:[l.jsx(N,{htmlFor:"publish",className:"text-base font-medium",children:"Publish immediately"}),l.jsx("p",{className:"text-sm text-gray-600",children:"Make this podcast visible to students"})]}),l.jsx(F,{id:"publish",checked:ge,onCheckedChange:ve})]})]}),l.jsxs(S,{children:[l.jsx(r,{variant:"outline",onClick:()=>ee(!1),children:"Cancel"}),l.jsx(r,{onClick:async()=>{try{if(!ce.trim())return void a.error("Title is required");if(!we)return void a.error("Please upload an audio file");re(!0);let s=null;try{const e=new Audio(we);await new Promise((a,l)=>{e.addEventListener("loadedmetadata",()=>{s=Math.round(e.duration),a(null)}),e.addEventListener("error",l),setTimeout(a,3e3)})}catch(e){console.log("Could not get audio duration")}const l={title:ce.trim(),description:de.trim()||null,audio_url:we,cover_image_url:Pe||null,duration_seconds:s,category:ue,level:xe,transcript:pe.trim()||null,is_published:ge};if(se){const{error:e}=await R.from("podcasts").update(l).eq("id",se.id);if(e)throw e;a.success("Podcast updated successfully!")}else{const{error:e}=await R.from("podcasts").insert(l);if(e)throw e;a.success("Podcast created successfully!")}ee(!1),De(),ze()}catch(s){console.error("Error saving podcast:",s),a.error(s.message||"Failed to save podcast")}finally{re(!1)}},disabled:le||ke||Fe,children:le?l.jsxs(l.Fragment,{children:[l.jsx(u,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):se?"Update Podcast":"Create Podcast"})]})]})})]})};export{W as default};
