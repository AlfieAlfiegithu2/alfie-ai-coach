import{g as e,h as s,r as t,j as a,A as n,B as i,U as r,C as l,a as o,S as c,I as d,i as m,k as u,b as x,l as h,m as p,d as j,c as b,n as g,o as v,F as N,E as f,p as C,T as _,D as q,q as w,s as y,t as S,v as k,w as E,x as P,y as I,z as $,G as O,J as T,K as F,L as Q,N as V,O as L,Q as M,R as A}from"./index-Db9rgtAn.js";import"./supabase-Bqkrifq5.js";const z=()=>{const{listContent:z,createContent:D,deleteContent:G,updateContent:B,loading:R}=e(),{toast:U}=s(),[J,K]=t.useState({}),[Y,H]=t.useState(""),[W,X]=t.useState(new Set),[Z,ee]=t.useState(null),[se,te]=t.useState(!1),[ae,ne]=t.useState(20),[ie,re]=t.useState(1),[le,oe]=t.useState(1),[ce,de]=t.useState(null),[me,ue]=t.useState(""),[xe,he]=t.useState(""),[pe,je]=t.useState([]),[be,ge]=t.useState(!1),[ve,Ne]=t.useState(!1);t.useEffect(()=>{fe()},[]);const fe=async()=>{try{const[e,s]=await Promise.all([z("tests"),z("questions")]),t=e.data||[],a=s.data||[],n={};for(let i=1;i<=20;i++){n[i]={number:i,sections:{}};for(let e=1;e<=4;e++){n[i].sections[e]={number:e,parts:{},hasContent:!1};for(let s=1;s<=3;s++)n[i].sections[e].parts[s]={number:s,passage:null,questions:[],hasContent:!1}}}t.forEach(e=>{let s=e.book_number||1;if(e.cambridge_book){const t=e.cambridge_book.match(/\d+/);t&&(s=parseInt(t[0]))}const t=e.section_number||1,a=e.part_number||1;n[s]&&n[s].sections[t]&&n[s].sections[t].parts[a]&&(n[s].sections[t].parts[a].passage=e,n[s].sections[t].parts[a].hasContent=!0,n[s].sections[t].hasContent=!0)}),a.forEach(e=>{if(e.passage_id){const s=t.find(s=>s.id===e.passage_id);if(s){const t=s.book_number||1,a=s.section_number||1,i=s.part_number||1;n[t]&&n[t].sections[a]&&n[t].sections[a].parts[i]&&(n[t].sections[a].parts[i].questions.push(e),n[t].sections[a].parts[i].hasContent=!0,n[t].sections[a].hasContent=!0)}}else if(e.cambridge_book&&e.section_number){const s=e.cambridge_book.match(/\d+/),t=s?parseInt(s[0]):1,a=e.section_number,i=e.part_number||1;n[t]&&n[t].sections[a]&&n[t].sections[a].parts[i]&&(n[t].sections[a].parts[i].questions.push(e),n[t].sections[a].parts[i].hasContent=!0,n[t].sections[a].hasContent=!0)}}),K(n)}catch(e){U({title:"Error",description:"Failed to load Cambridge books structure",variant:"destructive"})}},Ce=async()=>{var e;try{Ne(!0);const s=me||`Passage for Cambridge ${ae} Section ${ie} Part ${le}`,t=xe||"Passage content will be added later.";console.log("ðŸ”§ Admin Numbering Fix: Starting continuous numbering import for",{book:ae,section:ie,part:le,questionsCount:pe.length});await(async()=>1)();const a={title:s,content:t,book_number:ae,section_number:ie,part_number:le,cambridge_book:`C${ae}`,passage_type:"academic"};console.log("Creating passage with data:",a);const n=await D("tests",{test_name:s,test_type:"IELTS",module:"Reading"});if(!(null==(e=null==n?void 0:n.data)?void 0:e.id))throw new Error("Failed to create test - no ID returned");const i=n.data.id;console.log("Test created with ID:",i);for(let e=0;e<pe.length;e++){const s=pe[e],a={test_id:i,part_number:le,question_number_in_part:e+1,question_text:s.question_text||"",question_type:s.question_type||"Multiple Choice",choices:s.options||null,correct_answer:s.correct_answer||"",explanation:s.explanation||"",passage_text:t};console.log(`ðŸ“Š Creating question ${e+1} for Part ${le}:`,a),await D("questions",a)}U({title:"Success",description:`${pe.length} questions uploaded to Cambridge ${ae}, Section ${ie}, Part ${le} with continuous numbering`}),ue(""),he(""),je([]),ge(!1),te(!1),fe()}catch(s){console.error("Import error:",s),U({title:"Error",description:s.message||"Failed to upload questions",variant:"destructive"})}finally{Ne(!1)}},_e=Object.values(J).filter(e=>{if(!Y)return!0;const s=Y.toLowerCase();return`cambridge ${e.number}`.includes(s)||Object.values(e.sections).some(e=>{var t,a;return null==(a=null==(t=e.passage)?void 0:t.title)?void 0:a.toLowerCase().includes(s)})}).sort((e,s)=>s.number-e.number);return a.jsx(n,{title:"Cambridge IELTS Reading",children:a.jsxs("div",{className:"max-w-6xl mx-auto",children:[a.jsxs("div",{className:"flex justify-between items-center mb-8",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-4xl font-georgia font-bold text-foreground mb-2",children:"Cambridge IELTS Reading"}),a.jsx("p",{className:"text-warm-gray",children:"Manage reading content organized by Cambridge books 1-20"})]}),a.jsxs(i,{onClick:()=>te(!0),className:"rounded-xl",style:{background:"var(--gradient-button)",border:"none"},children:[a.jsx(r,{className:"w-4 h-4 mr-2"}),"Upload Content"]})]}),a.jsx(l,{className:"mb-6 rounded-2xl border-light-border",style:{background:"var(--gradient-card)"},children:a.jsx(o,{className:"p-4",children:a.jsxs("div",{className:"relative",children:[a.jsx(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-warm-gray w-4 h-4"}),a.jsx(d,{placeholder:"Search books or passages...",value:Y,onChange:e=>H(e.target.value),className:"pl-10 rounded-xl border-light-border"})]})})}),a.jsx("div",{className:"space-y-4",children:_e.map(e=>a.jsx(l,{className:"rounded-2xl border-light-border shadow-soft",style:{background:"var(--gradient-card)"},children:a.jsxs(m,{open:W.has(e.number),onOpenChange:()=>(e=>{const s=new Set(W);s.has(e)?s.delete(e):s.add(e),X(s)})(e.number),children:[a.jsx(u,{asChild:!0,children:a.jsx(x,{className:"cursor-pointer hover:bg-white/50 transition-colors",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[W.has(e.number)?a.jsx(h,{className:"w-5 h-5"}):a.jsx(p,{className:"w-5 h-5"}),a.jsx(j,{className:"w-5 h-5"}),a.jsxs(b,{className:"text-xl font-georgia",children:["Cambridge IELTS ",e.number]})]}),a.jsx("div",{className:"flex gap-2",children:Object.values(e.sections).map(e=>a.jsxs(g,{variant:e.hasContent?"default":"outline",className:"text-xs",children:["S",e.number,Object.values(e.parts).filter(e=>e.hasContent).length>0&&` (${Object.values(e.parts).filter(e=>e.hasContent).length}/3)`]},e.number))})]})})}),a.jsx(v,{children:a.jsx(o,{className:"pt-0",children:a.jsx("div",{className:"grid gap-4",children:Object.values(e.sections).map(s=>a.jsxs(l,{className:"border-light-border bg-white",children:[a.jsx(x,{className:"pb-3",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(N,{className:"w-4 h-4"}),a.jsxs("h4",{className:"font-medium",children:["Section ",s.number]}),s.hasContent&&a.jsxs(g,{variant:"outline",className:"text-xs",children:[Object.values(s.parts).reduce((e,s)=>e+s.questions.length,0)," questions"]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(i,{size:"sm",variant:"outline",onClick:()=>ee({...s,bookNumber:e.number}),children:[a.jsx(f,{className:"w-3 h-3 mr-1"}),"View"]}),a.jsxs(i,{size:"sm",variant:"outline",onClick:()=>de({...s,bookNumber:e.number}),children:[a.jsx(C,{className:"w-3 h-3 mr-1"}),"Edit"]}),a.jsxs(i,{size:"sm",variant:"outline",onClick:()=>(async(e,s)=>{var t;if(confirm(`Are you sure you want to delete all content from Cambridge ${e}, Section ${s}?`))try{const a=null==(t=J[e])?void 0:t.sections[s];if(!a)return;for(const e of a.questions)await G("reading_questions",e.id);a.passage&&await G("reading_passages",a.passage.id),U({title:"Success",description:"Section content deleted successfully"}),fe()}catch(a){U({title:"Error",description:"Failed to delete section content",variant:"destructive"})}})(e.number,s.number),children:[a.jsx(_,{className:"w-3 h-3 mr-1"}),"Delete"]})]})]})}),a.jsx(o,{className:"pt-0",children:a.jsx("div",{className:"grid grid-cols-3 gap-2",children:Object.values(s.parts).map(e=>a.jsxs("div",{className:"text-center p-2 border rounded",children:[a.jsxs("div",{className:"text-sm font-medium",children:["Part ",e.number]}),a.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.questions.length," questions"]}),e.hasContent&&a.jsxs(g,{variant:"outline",className:"text-xs mt-1",children:["Q",e.questions.length>0?Math.min(...e.questions.map(e=>e.question_number)):0,"-",e.questions.length>0?Math.max(...e.questions.map(e=>e.question_number)):0]})]},e.number))})})]},s.number))})})})]})},e.number))}),a.jsx(q,{open:se,onOpenChange:te,children:a.jsxs(w,{className:"max-w-4xl",children:[a.jsx(y,{children:a.jsx(S,{children:"Upload Content to Cambridge IELTS"})}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Book Number"}),a.jsxs(k,{value:ae.toString(),onValueChange:e=>ne(parseInt(e)),children:[a.jsx(E,{children:a.jsx(P,{})}),a.jsx(I,{children:Array.from({length:20},(e,s)=>20-s).map(e=>a.jsxs($,{value:e.toString(),children:["Cambridge ",e]},e))})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Section Number"}),a.jsxs(k,{value:ie.toString(),onValueChange:e=>re(parseInt(e)),children:[a.jsx(E,{children:a.jsx(P,{})}),a.jsx(I,{children:[1,2,3,4].map(e=>a.jsxs($,{value:e.toString(),children:["Section ",e]},e))})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Part Number"}),a.jsxs(k,{value:le.toString(),onValueChange:e=>oe(parseInt(e)),children:[a.jsx(E,{children:a.jsx(P,{})}),a.jsx(I,{children:[1,2,3].map(e=>a.jsxs($,{value:e.toString(),children:["Part ",e]},e))})]})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Passage Title"}),a.jsx(d,{value:me,onChange:e=>ue(e.target.value),placeholder:"Enter passage title (optional for CSV)"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Passage Content"}),a.jsx(O,{value:xe,onChange:e=>he(e.target.value),placeholder:"Enter passage content (optional for CSV)",rows:4})]})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium mb-2",children:"Upload Questions (CSV)"}),a.jsx(T,{onImport:Ce,onQuestionsPreview:e=>{const s=e.filter(e=>e.question_text&&e.correct_answer&&e.question_type);0!==s.length?(je(s),ge(!0)):U({title:"Error",description:"No valid questions found in CSV",variant:"destructive"})},type:"reading",cambridgeBook:`C${ae}`,testNumber:ae,sectionNumber:ie,partNumber:le})]})]})]})}),a.jsx(q,{open:be,onOpenChange:ge,children:a.jsxs(w,{children:[a.jsx(y,{children:a.jsx(S,{children:"Confirm Question Import"})}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("p",{children:["You are about to import ",a.jsxs("strong",{children:[pe.length," questions"]})," to:"]}),a.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[a.jsxs("p",{children:[a.jsx("strong",{children:"Book:"})," Cambridge ",ae]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Section:"})," ",ie]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Part:"})," ",le]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Passage Title:"})," ",me||`Default title for C${ae} S${ie} P${le}`]})]}),a.jsxs("div",{className:"flex gap-2 justify-end",children:[a.jsx(i,{variant:"outline",onClick:()=>{je([]),ge(!1)},children:"Cancel"}),a.jsx(i,{onClick:Ce,disabled:ve,children:ve?"Importing...":"Confirm Import"})]})]})]})}),a.jsx(q,{open:!!Z,onOpenChange:e=>!e&&ee(null),children:a.jsxs(w,{className:"max-w-6xl max-h-[80vh] overflow-y-auto",children:[a.jsx(y,{children:a.jsxs(S,{children:["Cambridge ",null==Z?void 0:Z.bookNumber," - Section ",null==Z?void 0:Z.number]})}),Z&&a.jsx("div",{className:"space-y-6",children:Object.values(Z.parts).map(e=>a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-semibold mb-3",children:["Part ",e.number]}),e.passage&&a.jsxs(l,{className:"mb-4",children:[a.jsx(x,{children:a.jsx(b,{className:"text-base",children:e.passage.title})}),a.jsx(o,{children:a.jsx("p",{className:"text-sm text-gray-600 whitespace-pre-wrap",children:e.passage.content})})]}),e.questions.length>0&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs("h4",{className:"font-medium",children:["Questions (",e.questions.length,")"]}),a.jsxs(F,{children:[a.jsx(Q,{children:a.jsxs(V,{children:[a.jsx(L,{className:"w-16",children:"Q#"}),a.jsx(L,{children:"Type"}),a.jsx(L,{children:"Question"}),a.jsx(L,{children:"Answer"})]})}),a.jsx(M,{children:e.questions.sort((e,s)=>e.question_number-s.question_number).map(e=>a.jsxs(V,{children:[a.jsx(A,{className:"font-medium",children:e.question_number}),a.jsx(A,{children:a.jsx(g,{variant:"outline",className:"text-xs",children:e.question_type})}),a.jsx(A,{className:"max-w-md",children:a.jsx("p",{className:"text-sm truncate",title:e.question_text,children:e.question_text})}),a.jsx(A,{children:a.jsx("span",{className:"text-sm font-medium text-green-600",children:e.correct_answer})})]},e.id))})]})]})]},e.number))})]})}),a.jsx(q,{open:!!ce,onOpenChange:e=>!e&&de(null),children:a.jsxs(w,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[a.jsx(y,{children:a.jsxs(S,{children:["Edit Cambridge ",null==ce?void 0:ce.bookNumber," - Section ",null==ce?void 0:ce.number]})}),ce&&a.jsxs("div",{className:"space-y-6",children:[Object.values(ce.parts).map(e=>a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-semibold mb-3",children:["Part ",e.number]}),e.passage&&a.jsxs("div",{className:"space-y-4 mb-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Passage Title"}),a.jsx(d,{value:e.passage.title,onChange:s=>{de(t=>({...t,parts:{...t.parts,[e.number]:{...e,passage:{...e.passage,title:s.target.value}}}}))}})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Passage Content"}),a.jsx(O,{value:e.passage.content,onChange:s=>{de(t=>({...t,parts:{...t.parts,[e.number]:{...e,passage:{...e.passage,content:s.target.value}}}}))},rows:6})]})]}),e.questions.length>0&&a.jsxs("div",{className:"space-y-4",children:[a.jsx("h4",{className:"font-medium",children:"Questions"}),e.questions.sort((e,s)=>e.question_number-s.question_number).map((s,t)=>a.jsx(l,{className:"p-4",children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("span",{className:"font-medium",children:["Q",s.question_number]}),a.jsxs(k,{value:s.question_type,onValueChange:s=>{de(a=>({...a,parts:{...a.parts,[e.number]:{...e,questions:e.questions.map((e,a)=>a===t?{...e,question_type:s}:e)}}}))},children:[a.jsx(E,{className:"w-48",children:a.jsx(P,{})}),a.jsxs(I,{children:[a.jsx($,{value:"Multiple Choice",children:"Multiple Choice"}),a.jsx($,{value:"True/False/Not Given",children:"True/False/Not Given"}),a.jsx($,{value:"Fill in the Gap",children:"Fill in the Gap"}),a.jsx($,{value:"Matching",children:"Matching"})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Question Text"}),a.jsx(O,{value:s.question_text,onChange:s=>{de(a=>({...a,parts:{...a.parts,[e.number]:{...e,questions:e.questions.map((e,a)=>a===t?{...e,question_text:s.target.value}:e)}}}))},rows:2})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Correct Answer"}),a.jsx(d,{value:s.correct_answer,onChange:s=>{de(a=>({...a,parts:{...a.parts,[e.number]:{...e,questions:e.questions.map((e,a)=>a===t?{...e,correct_answer:s.target.value}:e)}}}))}})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Explanation"}),a.jsx(d,{value:s.explanation,onChange:s=>{de(a=>({...a,parts:{...a.parts,[e.number]:{...e,questions:e.questions.map((e,a)=>a===t?{...e,explanation:s.target.value}:e)}}}))}})]})]})]})},s.id))]})]},e.number)),a.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[a.jsx(i,{variant:"outline",onClick:()=>de(null),children:"Cancel"}),a.jsx(i,{onClick:async()=>{if(ce)try{ce.passage&&await B("reading_passages",{id:ce.passage.id,title:ce.passage.title,content:ce.passage.content});for(const e of ce.questions)await B("reading_questions",{id:e.id,question_text:e.question_text,question_type:e.question_type,correct_answer:e.correct_answer,explanation:e.explanation,options:e.options});U({title:"Success",description:"Section updated successfully"}),de(null),fe()}catch(e){U({title:"Error",description:"Failed to update section",variant:"destructive"})}},children:"Save Changes"})]})]})]})})]})})};export{z as default};
