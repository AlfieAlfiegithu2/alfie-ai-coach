import{u as e,G as t,w as s,g as a,r,J as n,j as i,l,C as c,a as o,U as d,B as m,P as p,b as u,d as x,O as h,X as j,y as g,F as f,I as v,S as y,p as N,q as C,s as b,t as w,T as _}from"./index-C36stBbp.js";import{T as k,a as S,b as F,c as U,d as A,e as E}from"./table-hi_gsq19.js";import{C as $}from"./CSVImport-E8nGFi2m.js";import{A as L}from"./AdminLayout-j7tae2vu.js";import{S as T}from"./save-7hpHsJoh.js";import{S as I}from"./square-pen-1R2_YPGk.js";import{T as q}from"./trash-2-CDHwe5Zo.js";import"./supabase-DWL4C3fA.js";import"./alert-B8ZGApnB.js";import"./circle-alert-DsvRNcJP.js";import"./circle-help-Db7IRVd4.js";import"./download-CdbVqnI6.js";const R=()=>{const R=e(),{testType:P,testId:V,sectionId:M}=t(),{admin:B,loading:G}=s(),{listContent:z,createContent:D,updateContent:Q,deleteContent:J}=a(),[O,W]=r.useState([]),[H,K]=r.useState(!0),[X,Y]=r.useState(null),[Z,ee]=r.useState(!1),[te,se]=r.useState({});r.useEffect(()=>{G||B||R("/admin/login")},[B,G,R]),r.useEffect(()=>{ae()},[P,M]);const ae=async()=>{if(P&&M){K(!0);try{const e=re(),t=await z(e);W((null==t?void 0:t.data)||[])}catch(e){console.error("Error loading content:",e),n.error("Failed to load content")}finally{K(!1)}}},re=()=>"reading"===M||"listening"===M?"questions":"writing"===M?("ielts"===P?"":P+"_")+"writing_prompts":"speaking"===M?("ielts"===P?"":P+"_")+"speaking_prompts":"questions",ne=(e,t,s)=>{switch(e){case"content":case"prompt_text":case"instructions":case"transcript":return i.jsx(_,{value:t||"",onChange:e=>s(e.target.value),placeholder:`Enter ${e.replace("_"," ")}`,rows:4});case"time_limit":case"word_limit":return i.jsx(v,{type:"number",value:t||"",onChange:e=>s(parseInt(e.target.value)||0),placeholder:`Enter ${e.replace("_"," ")}`});case"task_type":case"passage_type":return i.jsxs(y,{value:t||"",onValueChange:s,children:[i.jsx(N,{children:i.jsx(C,{placeholder:`Select ${e.replace("_"," ")}`})}),i.jsxs(b,{children:["task_type"===e&&i.jsxs(i.Fragment,{children:[i.jsx(w,{value:"Essay",children:"Essay"}),i.jsx(w,{value:"Report",children:"Report"}),i.jsx(w,{value:"Letter",children:"Letter"})]}),"passage_type"===e&&i.jsxs(i.Fragment,{children:[i.jsx(w,{value:"Academic",children:"Academic"}),i.jsx(w,{value:"General",children:"General"}),i.jsx(w,{value:"Literary",children:"Literary"})]})]})]});default:return i.jsx(v,{value:t||"",onChange:e=>s(e.target.value),placeholder:`Enter ${e.replace("_"," ")}`})}};if(G)return i.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),i.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading Section Management..."})]})});if(!B)return null;const ie=(()=>{switch(M){case"reading":return{title:"Reading Passages",fields:["title","content","passage_type"],createFields:["title","content","passage_type"]};case"listening":return{title:"Listening Sections",fields:["title","instructions","audio_url","transcript"],createFields:["title","instructions","audio_url","transcript"]};case"writing":return{title:"Writing Prompts",fields:["title","prompt_text","task_type","time_limit","word_limit"],createFields:["title","prompt_text","task_type","time_limit","word_limit"]};case"speaking":return{title:"Speaking Prompts",fields:["title","prompt_text","time_limit"],createFields:["title","prompt_text","time_limit"]};default:return{title:"Content",fields:[],createFields:[]}}})();return i.jsx(L,{title:`${null==P?void 0:P.toUpperCase()} Test ${V} - ${ie.title}`,showBackButton:!0,backPath:`/admin/${P}/test/${V}`,children:i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsxs("h1",{className:"text-3xl font-bold tracking-tight bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",children:[ie.title," Management"]}),i.jsxs("p",{className:"text-muted-foreground mt-1",children:["Manage ",ie.title.toLowerCase()," for ",null==P?void 0:P.toUpperCase()," Test ",V]})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(l,{variant:"secondary",className:"text-sm",children:["Test ",V]}),i.jsxs(l,{variant:"outline",className:"text-sm",children:[null==M?void 0:M.charAt(0).toUpperCase(),null==M?void 0:M.slice(1)]})]})]}),"reading"===M?i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("h2",{className:"text-2xl font-semibold",children:"Upload Complete Reading Test Questions"}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("div",{className:"text-sm text-muted-foreground",children:[O.length," questions uploaded"]}),O.length>0&&i.jsx(l,{variant:"default",className:"bg-green-600 text-white",children:"âœ“ Questions Saved"})]})]}),i.jsx(c,{className:"border-2 border-dashed border-primary/30 bg-primary/5",children:i.jsx(o,{className:"p-6",children:i.jsxs("div",{className:"text-center space-y-4",children:[i.jsx(d,{className:"w-12 h-12 text-primary mx-auto"}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold mb-2",children:"CSV Upload for Full Reading Test"}),i.jsx("p",{className:"text-muted-foreground mb-4",children:"Upload a structured CSV file containing all 40 questions divided into 3 parts with passages and questions."})]}),i.jsx($,{onImport:async e=>{console.log("CSV Import completed successfully. Refreshing content list..."),await ae(),n.success(`Successfully imported ${e.length} questions to the database`),console.log("Content refreshed. Import workflow complete.")},type:"reading",module:P,testId:V,testType:P})]})})})]}):i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("div",{className:"flex gap-2",children:i.jsxs(m,{onClick:()=>ee(!0),className:"bg-primary hover:bg-primary/90",children:[i.jsx(p,{className:"w-4 h-4 mr-2"}),"Add New ",null==M?void 0:M.charAt(0).toUpperCase(),null==M?void 0:M.slice(1)," Content"]})}),i.jsxs("div",{className:"text-sm text-muted-foreground",children:[O.length," items total"]})]}),(Z||X)&&i.jsxs(c,{className:"border-primary/20",children:[i.jsx(u,{children:i.jsx(x,{children:Z?"Create New Content":"Edit Content"})}),i.jsxs(o,{className:"space-y-4",children:[ie.createFields.map(e=>i.jsxs("div",{className:"space-y-2",children:[i.jsx(h,{htmlFor:e,children:e.charAt(0).toUpperCase()+e.slice(1).replace("_"," ")}),ne(e,te[e],t=>se(s=>({...s,[e]:t})))]},e)),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(m,{onClick:Z?async()=>{try{const e=re(),t={...te,test_number:parseInt(V||"1"),[`${P}_book`]:`${null==P?void 0:P.toUpperCase()} 20`};await D(e,t),n.success("Content created successfully"),ee(!1),se({}),ae()}catch(e){console.error("Error creating content:",e),n.error("Failed to create content")}}:async()=>{if(X)try{const e=re();await Q(e,{...X,...te}),n.success("Content updated successfully"),Y(null),se({}),ae()}catch(e){console.error("Error updating content:",e),n.error("Failed to update content")}},className:"bg-primary hover:bg-primary/90",children:[i.jsx(T,{className:"w-4 h-4 mr-2"}),Z?"Create":"Update"]}),i.jsxs(m,{variant:"outline",onClick:()=>{Y(null),ee(!1),se({})},children:[i.jsx(j,{className:"w-4 h-4 mr-2"}),"Cancel"]})]})]})]}),i.jsxs(c,{children:[i.jsxs(u,{children:[i.jsx(x,{children:"Current Content"}),i.jsxs(g,{children:["Manage existing ",ie.title.toLowerCase()]})]}),i.jsx(o,{children:H?i.jsxs("div",{className:"text-center py-8",children:[i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),i.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading content..."})]}):0===O.length?i.jsxs("div",{className:"text-center py-8",children:[i.jsx(f,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),i.jsx("p",{className:"text-muted-foreground",children:"No content found"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:'Click "Add New Content" to get started'})]}):i.jsxs(k,{children:[i.jsx(S,{children:i.jsxs(F,{children:[i.jsx(U,{children:"Title"}),ie.fields.slice(1,3).map(e=>i.jsx(U,{children:e.charAt(0).toUpperCase()+e.slice(1).replace("_"," ")},e)),i.jsx(U,{children:"Created"}),i.jsx(U,{children:"Actions"})]})}),i.jsx(A,{children:O.map(e=>{var t;return i.jsxs(F,{children:[i.jsx(E,{className:"font-medium",children:e.title||(null==(t=e.prompt_text)?void 0:t.substring(0,50))+"..."||"Untitled"}),ie.fields.slice(1,3).map(t=>{var s,a;return i.jsx(E,{className:"max-w-[200px] truncate",children:"string"==typeof e[t]?(null==(s=e[t])?void 0:s.substring(0,50))+"...":(null==(a=e[t])?void 0:a.toString())||"-"},t)}),i.jsx(E,{children:new Date(e.created_at).toLocaleDateString()}),i.jsx(E,{children:i.jsxs("div",{className:"flex gap-2",children:[i.jsx(m,{variant:"outline",size:"sm",onClick:()=>(e=>{Y(e),se(e)})(e),children:i.jsx(I,{className:"w-4 h-4"})}),i.jsx(m,{variant:"outline",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this item?"))try{const t=re();await J(t,e),n.success("Content deleted successfully"),ae()}catch(t){console.error("Error deleting content:",t),n.error("Failed to delete content")}})(e.id),className:"text-destructive hover:text-destructive",children:i.jsx(q,{className:"w-4 h-4"})})]})})]},e.id)})})]})})]})]})})};export{R as default};
