import{u as e,ar as t,v as s,f as a,r,J as i,j as n,k as l,C as c,a as o,U as d,B as m,P as p,b as x,c as u,ae as h,X as j,x as g,I as f,S as v,o as y,p as N,q as C,s as b,T as w}from"./index-BEYDIuQu.js";import{T as _,a as k,b as S,c as F,d as A,e as E}from"./table-q2UM5aeM.js";import{C as U}from"./CSVImport-CoAL1BL7.js";import{A as $}from"./AdminLayout-Vrqj6vkm.js";import{S as I}from"./save-DsEbESVX.js";import{F as L}from"./file-text-D3GrfvaB.js";import{S as T}from"./square-pen-to4lA6do.js";import{T as q}from"./trash-2-CZEOro5I.js";import"./supabase-DUkWVuqu.js";import"./alert-DWzMWR2X.js";import"./circle-alert-r6o2xtyK.js";import"./circle-help-gkpOy2Ql.js";import"./download-BnnygLiK.js";const R=()=>{const R=e(),{testType:P,testId:V,sectionId:M}=t(),{admin:B,loading:G}=s(),{listContent:z,createContent:D,updateContent:J,deleteContent:Q}=a(),[H,W]=r.useState([]),[Y,K]=r.useState(!0),[O,X]=r.useState(null),[Z,ee]=r.useState(!1),[te,se]=r.useState({});r.useEffect(()=>{G||B||R("/admin/login")},[B,G,R]),r.useEffect(()=>{ae()},[P,M]);const ae=async()=>{if(P&&M){K(!0);try{const e=re(),t=await z(e);W((null==t?void 0:t.data)||[])}catch(e){console.error("Error loading content:",e),i.error("Failed to load content")}finally{K(!1)}}},re=()=>"reading"===M||"listening"===M?"questions":"writing"===M?("ielts"===P?"":P+"_")+"writing_prompts":"speaking"===M?("ielts"===P?"":P+"_")+"speaking_prompts":"questions",ie=(e,t,s)=>{switch(e){case"content":case"prompt_text":case"instructions":case"transcript":return n.jsx(w,{value:t||"",onChange:e=>s(e.target.value),placeholder:`Enter ${e.replace("_"," ")}`,rows:4});case"time_limit":case"word_limit":return n.jsx(f,{type:"number",value:t||"",onChange:e=>s(parseInt(e.target.value)||0),placeholder:`Enter ${e.replace("_"," ")}`});case"task_type":case"passage_type":return n.jsxs(v,{value:t||"",onValueChange:s,children:[n.jsx(y,{children:n.jsx(N,{placeholder:`Select ${e.replace("_"," ")}`})}),n.jsxs(C,{children:["task_type"===e&&n.jsxs(n.Fragment,{children:[n.jsx(b,{value:"Essay",children:"Essay"}),n.jsx(b,{value:"Report",children:"Report"}),n.jsx(b,{value:"Letter",children:"Letter"})]}),"passage_type"===e&&n.jsxs(n.Fragment,{children:[n.jsx(b,{value:"Academic",children:"Academic"}),n.jsx(b,{value:"General",children:"General"}),n.jsx(b,{value:"Literary",children:"Literary"})]})]})]});default:return n.jsx(f,{value:t||"",onChange:e=>s(e.target.value),placeholder:`Enter ${e.replace("_"," ")}`})}};if(G)return n.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),n.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading Section Management..."})]})});if(!B)return null;const ne=(()=>{switch(M){case"reading":return{title:"Reading Passages",fields:["title","content","passage_type"],createFields:["title","content","passage_type"]};case"listening":return{title:"Listening Sections",fields:["title","instructions","audio_url","transcript"],createFields:["title","instructions","audio_url","transcript"]};case"writing":return{title:"Writing Prompts",fields:["title","prompt_text","task_type","time_limit","word_limit"],createFields:["title","prompt_text","task_type","time_limit","word_limit"]};case"speaking":return{title:"Speaking Prompts",fields:["title","prompt_text","time_limit"],createFields:["title","prompt_text","time_limit"]};default:return{title:"Content",fields:[],createFields:[]}}})();return n.jsx($,{title:`${null==P?void 0:P.toUpperCase()} Test ${V} - ${ne.title}`,showBackButton:!0,backPath:`/admin/${P}/test/${V}`,children:n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsxs("h1",{className:"text-3xl font-bold tracking-tight bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",children:[ne.title," Management"]}),n.jsxs("p",{className:"text-muted-foreground mt-1",children:["Manage ",ne.title.toLowerCase()," for ",null==P?void 0:P.toUpperCase()," Test ",V]})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs(l,{variant:"secondary",className:"text-sm",children:["Test ",V]}),n.jsxs(l,{variant:"outline",className:"text-sm",children:[null==M?void 0:M.charAt(0).toUpperCase(),null==M?void 0:M.slice(1)]})]})]}),"reading"===M?n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("h2",{className:"text-2xl font-semibold",children:"Upload Complete Reading Test Questions"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:"text-sm text-muted-foreground",children:[H.length," questions uploaded"]}),H.length>0&&n.jsx(l,{variant:"default",className:"bg-green-600 text-white",children:"âœ“ Questions Saved"})]})]}),n.jsx(c,{className:"border-2 border-dashed border-primary/30 bg-primary/5",children:n.jsx(o,{className:"p-6",children:n.jsxs("div",{className:"text-center space-y-4",children:[n.jsx(d,{className:"w-12 h-12 text-primary mx-auto"}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-semibold mb-2",children:"CSV Upload for Full Reading Test"}),n.jsx("p",{className:"text-muted-foreground mb-4",children:"Upload a structured CSV file containing all 40 questions divided into 3 parts with passages and questions."})]}),n.jsx(U,{onImport:async e=>{console.log("CSV Import completed successfully. Refreshing content list..."),await ae(),i.success(`Successfully imported ${e.length} questions to the database`),console.log("Content refreshed. Import workflow complete.")},type:"reading",module:P,testId:V,testType:P})]})})})]}):n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("div",{className:"flex gap-2",children:n.jsxs(m,{onClick:()=>ee(!0),className:"bg-primary hover:bg-primary/90",children:[n.jsx(p,{className:"w-4 h-4 mr-2"}),"Add New ",null==M?void 0:M.charAt(0).toUpperCase(),null==M?void 0:M.slice(1)," Content"]})}),n.jsxs("div",{className:"text-sm text-muted-foreground",children:[H.length," items total"]})]}),(Z||O)&&n.jsxs(c,{className:"border-primary/20",children:[n.jsx(x,{children:n.jsx(u,{children:Z?"Create New Content":"Edit Content"})}),n.jsxs(o,{className:"space-y-4",children:[ne.createFields.map(e=>n.jsxs("div",{className:"space-y-2",children:[n.jsx(h,{htmlFor:e,children:e.charAt(0).toUpperCase()+e.slice(1).replace("_"," ")}),ie(e,te[e],t=>se(s=>({...s,[e]:t})))]},e)),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs(m,{onClick:Z?async()=>{try{const e=re(),t={...te,test_number:parseInt(V||"1"),[`${P}_book`]:`${null==P?void 0:P.toUpperCase()} 20`};await D(e,t),i.success("Content created successfully"),ee(!1),se({}),ae()}catch(e){console.error("Error creating content:",e),i.error("Failed to create content")}}:async()=>{if(O)try{const e=re();await J(e,{...O,...te}),i.success("Content updated successfully"),X(null),se({}),ae()}catch(e){console.error("Error updating content:",e),i.error("Failed to update content")}},className:"bg-primary hover:bg-primary/90",children:[n.jsx(I,{className:"w-4 h-4 mr-2"}),Z?"Create":"Update"]}),n.jsxs(m,{variant:"outline",onClick:()=>{X(null),ee(!1),se({})},children:[n.jsx(j,{className:"w-4 h-4 mr-2"}),"Cancel"]})]})]})]}),n.jsxs(c,{children:[n.jsxs(x,{children:[n.jsx(u,{children:"Current Content"}),n.jsxs(g,{children:["Manage existing ",ne.title.toLowerCase()]})]}),n.jsx(o,{children:Y?n.jsxs("div",{className:"text-center py-8",children:[n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),n.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading content..."})]}):0===H.length?n.jsxs("div",{className:"text-center py-8",children:[n.jsx(L,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),n.jsx("p",{className:"text-muted-foreground",children:"No content found"}),n.jsx("p",{className:"text-sm text-muted-foreground",children:'Click "Add New Content" to get started'})]}):n.jsxs(_,{children:[n.jsx(k,{children:n.jsxs(S,{children:[n.jsx(F,{children:"Title"}),ne.fields.slice(1,3).map(e=>n.jsx(F,{children:e.charAt(0).toUpperCase()+e.slice(1).replace("_"," ")},e)),n.jsx(F,{children:"Created"}),n.jsx(F,{children:"Actions"})]})}),n.jsx(A,{children:H.map(e=>{var t;return n.jsxs(S,{children:[n.jsx(E,{className:"font-medium",children:e.title||(null==(t=e.prompt_text)?void 0:t.substring(0,50))+"..."||"Untitled"}),ne.fields.slice(1,3).map(t=>{var s,a;return n.jsx(E,{className:"max-w-[200px] truncate",children:"string"==typeof e[t]?(null==(s=e[t])?void 0:s.substring(0,50))+"...":(null==(a=e[t])?void 0:a.toString())||"-"},t)}),n.jsx(E,{children:new Date(e.created_at).toLocaleDateString()}),n.jsx(E,{children:n.jsxs("div",{className:"flex gap-2",children:[n.jsx(m,{variant:"outline",size:"sm",onClick:()=>(e=>{X(e),se(e)})(e),children:n.jsx(T,{className:"w-4 h-4"})}),n.jsx(m,{variant:"outline",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this item?"))try{const t=re();await Q(t,e),i.success("Content deleted successfully"),ae()}catch(t){console.error("Error deleting content:",t),i.error("Failed to delete content")}})(e.id),className:"text-destructive hover:text-destructive",children:n.jsx(q,{className:"w-4 h-4"})})]})})]},e.id)})})]})})]})]})})};export{R as default};
