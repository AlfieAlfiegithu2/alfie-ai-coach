import{u as e,c as t,r as s,j as a}from"./vendor-react-JN_hy__U.js";import{n as r,u as n,J as i,e as l,C as c,a as o,B as d,b as m,c as u,L as p,o as x,I as h,S as j,i as g,j as f,k as v,l as y,T as N}from"./index-DXpPY1B7.js";import{T as C,a as b,b as w,c as _,d as k,e as S}from"./table-K6aSiYdl.js";import{C as F}from"./CSVImport-BoWRa86L.js";import{A}from"./AdminLayout-D3lPYw5Y.js";import{aV as E,av as L,b5 as U,X as $,ap as I,aX as T,aY as q}from"./vendor-ui-DG51EGkO.js";import"./vendor-react-dom-Cb-iy8Oc.js";import"./vendor-animation-ClPlB6zo.js";import"./vendor-i18n-DlHrixAm.js";import"./vendor-utils-D5HPTFR9.js";import"./vendor-supabase-D7XYLCUu.js";import"./vendor-charts-BpOKEG9Z.js";import"./vendor-date-DT7Rq6D9.js";import"./alert-BV1wokst.js";const R=()=>{const R=e(),{testType:V,testId:M,sectionId:P}=t(),{admin:B,loading:z}=r(),{listContent:D,createContent:G,updateContent:Q,deleteContent:J}=n(),[W,X]=s.useState([]),[Y,H]=s.useState(!0),[K,O]=s.useState(null),[Z,ee]=s.useState(!1),[te,se]=s.useState({});s.useEffect(()=>{z||B||R("/admin/login")},[B,z,R]),s.useEffect(()=>{ae()},[V,P]);const ae=async()=>{if(V&&P){H(!0);try{const e=re(),t=await D(e);X((null==t?void 0:t.data)||[])}catch(e){console.error("Error loading content:",e),i.error("Failed to load content")}finally{H(!1)}}},re=()=>"reading"===P||"listening"===P?"questions":"writing"===P?("ielts"===V?"":V+"_")+"writing_prompts":"speaking"===P?("ielts"===V?"":V+"_")+"speaking_prompts":"questions",ne=(e,t,s)=>{switch(e){case"content":case"prompt_text":case"instructions":case"transcript":return a.jsx(N,{value:t||"",onChange:e=>s(e.target.value),placeholder:`Enter ${e.replace("_"," ")}`,rows:4});case"time_limit":case"word_limit":return a.jsx(h,{type:"number",value:t||"",onChange:e=>s(parseInt(e.target.value)||0),placeholder:`Enter ${e.replace("_"," ")}`});case"task_type":case"passage_type":return a.jsxs(j,{value:t||"",onValueChange:s,children:[a.jsx(g,{children:a.jsx(f,{placeholder:`Select ${e.replace("_"," ")}`})}),a.jsxs(v,{children:["task_type"===e&&a.jsxs(a.Fragment,{children:[a.jsx(y,{value:"Essay",children:"Essay"}),a.jsx(y,{value:"Report",children:"Report"}),a.jsx(y,{value:"Letter",children:"Letter"})]}),"passage_type"===e&&a.jsxs(a.Fragment,{children:[a.jsx(y,{value:"Academic",children:"Academic"}),a.jsx(y,{value:"General",children:"General"}),a.jsx(y,{value:"Literary",children:"Literary"})]})]})]});default:return a.jsx(h,{value:t||"",onChange:e=>s(e.target.value),placeholder:`Enter ${e.replace("_"," ")}`})}};if(z)return a.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),a.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading Section Management..."})]})});if(!B)return null;const ie=(()=>{switch(P){case"reading":return{title:"Reading Passages",fields:["title","content","passage_type"],createFields:["title","content","passage_type"]};case"listening":return{title:"Listening Sections",fields:["title","instructions","audio_url","transcript"],createFields:["title","instructions","audio_url","transcript"]};case"writing":return{title:"Writing Prompts",fields:["title","prompt_text","task_type","time_limit","word_limit"],createFields:["title","prompt_text","task_type","time_limit","word_limit"]};case"speaking":return{title:"Speaking Prompts",fields:["title","prompt_text","time_limit"],createFields:["title","prompt_text","time_limit"]};default:return{title:"Content",fields:[],createFields:[]}}})();return a.jsx(A,{title:`${null==V?void 0:V.toUpperCase()} Test ${M} - ${ie.title}`,showBackButton:!0,backPath:`/admin/${V}/test/${M}`,children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsxs("h1",{className:"text-3xl font-bold tracking-tight bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",children:[ie.title," Management"]}),a.jsxs("p",{className:"text-muted-foreground mt-1",children:["Manage ",ie.title.toLowerCase()," for ",null==V?void 0:V.toUpperCase()," Test ",M]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(l,{variant:"secondary",className:"text-sm",children:["Test ",M]}),a.jsxs(l,{variant:"outline",className:"text-sm",children:[null==P?void 0:P.charAt(0).toUpperCase(),null==P?void 0:P.slice(1)]})]})]}),"reading"===P?a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h2",{className:"text-2xl font-semibold",children:"Upload Complete Reading Test Questions"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"text-sm text-muted-foreground",children:[W.length," questions uploaded"]}),W.length>0&&a.jsx(l,{variant:"default",className:"bg-green-600 text-white",children:"âœ“ Questions Saved"})]})]}),a.jsx(c,{className:"border-2 border-dashed border-primary/30 bg-primary/5",children:a.jsx(o,{className:"p-6",children:a.jsxs("div",{className:"text-center space-y-4",children:[a.jsx(E,{className:"w-12 h-12 text-primary mx-auto"}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"CSV Upload for Full Reading Test"}),a.jsx("p",{className:"text-muted-foreground mb-4",children:"Upload a structured CSV file containing all 40 questions divided into 3 parts with passages and questions."})]}),a.jsx(F,{onImport:async e=>{console.log("CSV Import completed successfully. Refreshing content list..."),await ae(),i.success(`Successfully imported ${e.length} questions to the database`),console.log("Content refreshed. Import workflow complete.")},type:"reading",module:V,testId:M,testType:V})]})})})]}):a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("div",{className:"flex gap-2",children:a.jsxs(d,{onClick:()=>ee(!0),className:"bg-primary hover:bg-primary/90",children:[a.jsx(L,{className:"w-4 h-4 mr-2"}),"Add New ",null==P?void 0:P.charAt(0).toUpperCase(),null==P?void 0:P.slice(1)," Content"]})}),a.jsxs("div",{className:"text-sm text-muted-foreground",children:[W.length," items total"]})]}),(Z||K)&&a.jsxs(c,{className:"border-primary/20",children:[a.jsx(m,{children:a.jsx(u,{children:Z?"Create New Content":"Edit Content"})}),a.jsxs(o,{className:"space-y-4",children:[ie.createFields.map(e=>a.jsxs("div",{className:"space-y-2",children:[a.jsx(p,{htmlFor:e,children:e.charAt(0).toUpperCase()+e.slice(1).replace("_"," ")}),ne(e,te[e],t=>se(s=>({...s,[e]:t})))]},e)),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(d,{onClick:Z?async()=>{try{const e=re(),t={...te,test_number:parseInt(M||"1"),[`${V}_book`]:`${null==V?void 0:V.toUpperCase()} 20`};await G(e,t),i.success("Content created successfully"),ee(!1),se({}),ae()}catch(e){console.error("Error creating content:",e),i.error("Failed to create content")}}:async()=>{if(K)try{const e=re();await Q(e,{...K,...te}),i.success("Content updated successfully"),O(null),se({}),ae()}catch(e){console.error("Error updating content:",e),i.error("Failed to update content")}},className:"bg-primary hover:bg-primary/90",children:[a.jsx(U,{className:"w-4 h-4 mr-2"}),Z?"Create":"Update"]}),a.jsxs(d,{variant:"outline",onClick:()=>{O(null),ee(!1),se({})},children:[a.jsx($,{className:"w-4 h-4 mr-2"}),"Cancel"]})]})]})]}),a.jsxs(c,{children:[a.jsxs(m,{children:[a.jsx(u,{children:"Current Content"}),a.jsxs(x,{children:["Manage existing ",ie.title.toLowerCase()]})]}),a.jsx(o,{children:Y?a.jsxs("div",{className:"text-center py-8",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),a.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading content..."})]}):0===W.length?a.jsxs("div",{className:"text-center py-8",children:[a.jsx(I,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),a.jsx("p",{className:"text-muted-foreground",children:"No content found"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:'Click "Add New Content" to get started'})]}):a.jsxs(C,{children:[a.jsx(b,{children:a.jsxs(w,{children:[a.jsx(_,{children:"Title"}),ie.fields.slice(1,3).map(e=>a.jsx(_,{children:e.charAt(0).toUpperCase()+e.slice(1).replace("_"," ")},e)),a.jsx(_,{children:"Created"}),a.jsx(_,{children:"Actions"})]})}),a.jsx(k,{children:W.map(e=>{var t;return a.jsxs(w,{children:[a.jsx(S,{className:"font-medium",children:e.title||(null==(t=e.prompt_text)?void 0:t.substring(0,50))+"..."||"Untitled"}),ie.fields.slice(1,3).map(t=>{var s,r;return a.jsx(S,{className:"max-w-[200px] truncate",children:"string"==typeof e[t]?(null==(s=e[t])?void 0:s.substring(0,50))+"...":(null==(r=e[t])?void 0:r.toString())||"-"},t)}),a.jsx(S,{children:new Date(e.created_at).toLocaleDateString()}),a.jsx(S,{children:a.jsxs("div",{className:"flex gap-2",children:[a.jsx(d,{variant:"outline",size:"sm",onClick:()=>(e=>{O(e),se(e)})(e),children:a.jsx(T,{className:"w-4 h-4"})}),a.jsx(d,{variant:"outline",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this item?"))try{const t=re();await J(t,e),i.success("Content deleted successfully"),ae()}catch(t){console.error("Error deleting content:",t),i.error("Failed to delete content")}})(e.id),className:"text-destructive hover:text-destructive",children:a.jsx(q,{className:"w-4 h-4"})})]})})]},e.id)})})]})})]})]})})};export{R as default};
