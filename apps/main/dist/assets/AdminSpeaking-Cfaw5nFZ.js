import{r as e,j as s}from"./vendor-react-JN_hy__U.js";import{u as a,d as r,B as t,C as l,a as n,I as i,b as d,c as o,e as c,D as m,m as x,f as p,g as h,h as u,S as j,i as b,j as g,k as v,l as N,T as f}from"./index-DXpPY1B7.js";import{C as w,a as C,b as y}from"./collapsible-CWlZ7QcT.js";import{A as S}from"./AdminLayout-D3lPYw5Y.js";import{aV as k,aW as _,h as T,aa as P,aO as E,aN as I,aX as L,aY as O}from"./vendor-ui-DG51EGkO.js";import"./vendor-react-dom-Cb-iy8Oc.js";import"./vendor-animation-ClPlB6zo.js";import"./vendor-i18n-DlHrixAm.js";import"./vendor-utils-D5HPTFR9.js";import"./vendor-supabase-D7XYLCUu.js";import"./vendor-charts-BpOKEG9Z.js";import"./vendor-date-DT7Rq6D9.js";const A=()=>{const{listContent:A,createContent:$,deleteContent:F,updateContent:z,loading:D}=a(),{toast:U}=r(),[V,B]=e.useState({}),[q,M]=e.useState(""),[W,X]=e.useState(new Set),[Y,G]=e.useState(!1),[H,J]=e.useState(20),[K,Q]=e.useState(1),[R,Z]=e.useState(null),[ee,se]=e.useState(""),[ae,re]=e.useState(""),[te,le]=e.useState(1),[ne,ie]=e.useState(2),[de,oe]=e.useState("");e.useEffect(()=>{ce()},[]);const ce=async()=>{try{const e=(await A("speaking_prompts")).data||[],s={};for(let a=1;a<=20;a++){s[a]={number:a,sections:{}};for(let e=1;e<=4;e++)s[a].sections[e]={number:e,prompts:[],hasContent:!1}}e.forEach(e=>{var a;const r=null==(a=e.cambridge_book)?void 0:a.match(/\d+/),t=r?parseInt(r[0]):1,l=e.test_number||1;s[t]&&s[t].sections[l]&&(s[t].sections[l].prompts.push(e),s[t].sections[l].hasContent=!0)}),B(s)}catch(e){U({title:"Error",description:"Failed to load Cambridge books structure",variant:"destructive"})}},me=Object.values(V).filter(e=>{if(!q)return!0;const s=q.toLowerCase();return`cambridge ${e.number}`.includes(s)||Object.values(e.sections).some(e=>e.prompts.some(e=>{var a;return null==(a=e.title)?void 0:a.toLowerCase().includes(s)}))}).sort((e,s)=>s.number-e.number);return s.jsx(S,{title:"Cambridge IELTS Speaking",children:s.jsxs("div",{className:"max-w-6xl mx-auto",children:[s.jsxs("div",{className:"flex justify-between items-center mb-8",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-4xl font-georgia font-bold text-foreground mb-2",children:"Cambridge IELTS Speaking"}),s.jsx("p",{className:"text-warm-gray",children:"Manage speaking prompts organized by Cambridge books 1-20"})]}),s.jsxs(t,{onClick:()=>G(!0),className:"rounded-xl",style:{background:"var(--gradient-button)",border:"none"},children:[s.jsx(k,{className:"w-4 h-4 mr-2"}),"Upload Prompt"]})]}),s.jsx(l,{className:"mb-6 rounded-2xl border-light-border",style:{background:"var(--gradient-card)"},children:s.jsx(n,{className:"p-4",children:s.jsxs("div",{className:"relative",children:[s.jsx(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-warm-gray w-4 h-4"}),s.jsx(i,{placeholder:"Search books or prompts...",value:q,onChange:e=>M(e.target.value),className:"pl-10 rounded-xl border-light-border"})]})})}),s.jsx("div",{className:"space-y-4",children:me.map(e=>s.jsx(l,{className:"rounded-2xl border-light-border shadow-soft",style:{background:"var(--gradient-card)"},children:s.jsxs(w,{open:W.has(e.number),onOpenChange:()=>(e=>{const s=new Set(W);s.has(e)?s.delete(e):s.add(e),X(s)})(e.number),children:[s.jsx(C,{asChild:!0,children:s.jsx(d,{className:"cursor-pointer hover:bg-white/50 transition-colors",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[W.has(e.number)?s.jsx(T,{className:"w-5 h-5"}):s.jsx(P,{className:"w-5 h-5"}),s.jsx(E,{className:"w-5 h-5"}),s.jsxs(o,{className:"text-xl font-georgia",children:["Cambridge IELTS ",e.number]})]}),s.jsx("div",{className:"flex gap-2",children:Object.values(e.sections).map(e=>s.jsxs(c,{variant:e.hasContent?"default":"outline",className:"text-xs",children:["T",e.number]},e.number))})]})})}),s.jsx(y,{children:s.jsx(n,{className:"pt-0",children:s.jsx("div",{className:"grid gap-4",children:Object.values(e.sections).map(a=>{var r,i;return s.jsxs(l,{className:"border-light-border bg-white",children:[s.jsx(d,{className:"pb-3",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(E,{className:"w-4 h-4"}),s.jsxs("h4",{className:"font-medium",children:["Test ",a.number]}),a.hasContent&&s.jsxs(c,{variant:"outline",className:"text-xs",children:[a.prompts.length," prompts"]})]}),s.jsx("div",{className:"flex gap-2",children:a.hasContent&&s.jsxs(s.Fragment,{children:[s.jsxs(m,{children:[s.jsx(x,{asChild:!0,children:s.jsx(t,{size:"sm",variant:"outline",className:"rounded-xl",children:s.jsx(I,{className:"w-4 h-4"})})}),s.jsxs(p,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[s.jsx(h,{children:s.jsxs(u,{children:["Cambridge ",e.number," - Test ",a.number]})}),s.jsx("div",{className:"space-y-6",children:s.jsxs(l,{className:"p-4",children:[s.jsxs("h5",{className:"font-medium mb-3",children:["Speaking Prompts (",a.prompts.length,")"]}),s.jsx("div",{className:"space-y-4",children:a.prompts.map(e=>s.jsx("div",{className:"border-b border-light-border pb-4 last:border-b-0",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsxs(c,{variant:"outline",children:["Part ",e.part_number]}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-medium mb-2",children:e.title}),s.jsx("div",{className:"text-sm bg-gray-50 p-3 rounded-lg mb-2",children:e.prompt_text}),s.jsxs("div",{className:"flex gap-4 text-xs text-warm-gray mb-2",children:[s.jsxs("span",{children:["Time: ",e.time_limit,"min"]}),s.jsxs("span",{children:["Part: ",e.part_number]})]}),e.sample_answer&&s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium mb-1",children:"Sample Answer:"}),s.jsxs("div",{className:"text-sm bg-green-50 p-3 rounded-lg",children:[e.sample_answer.substring(0,200),"..."]})]})]})]})},e.id))})]})})]})]}),s.jsx(t,{size:"sm",variant:"outline",onClick:()=>Z({...a,bookNumber:e.number}),className:"rounded-xl",children:s.jsx(L,{className:"w-4 h-4"})}),s.jsx(t,{size:"sm",variant:"destructive",onClick:()=>(async(e,s)=>{var a;if(confirm(`Are you sure you want to delete all content from Cambridge ${e}, Test ${s}?`))try{const r=null==(a=V[e])?void 0:a.sections[s];if(!r)return;for(const e of r.prompts)await F("speaking_prompts",e.id);U({title:"Success",description:"Section content deleted successfully"}),ce()}catch(r){U({title:"Error",description:"Failed to delete section content",variant:"destructive"})}})(e.number,a.number),className:"rounded-xl",children:s.jsx(O,{className:"w-4 h-4"})})]})})]})}),a.hasContent?s.jsx(n,{className:"pt-0",children:s.jsxs("div",{className:"text-sm text-warm-gray",children:[s.jsxs("p",{children:["Prompts: ",a.prompts.length]}),s.jsxs("p",{children:["Last updated: ",new Date((null==(r=a.prompts[0])?void 0:r.updated_at)||(null==(i=a.prompts[0])?void 0:i.created_at)).toLocaleDateString()]})]})}):s.jsx(n,{className:"pt-0",children:s.jsxs("div",{className:"text-center py-6 text-warm-gray",children:[s.jsx(E,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),s.jsx("p",{className:"text-sm",children:"No content yet"}),s.jsx("p",{className:"text-xs",children:"Upload prompts to add content"})]})})]},a.number)})})})})]})},e.number))}),s.jsx(m,{open:Y,onOpenChange:G,children:s.jsxs(p,{className:"max-w-4xl max-h-[85vh] overflow-y-auto",children:[s.jsx(h,{children:s.jsxs(u,{children:["Upload Prompt to Cambridge ",H,", Test ",K]})}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Cambridge Book"}),s.jsxs(j,{value:H.toString(),onValueChange:e=>J(parseInt(e)),children:[s.jsx(b,{className:"rounded-xl border-light-border",children:s.jsx(g,{})}),s.jsx(v,{className:"rounded-xl border-light-border bg-card",children:Array.from({length:20},(e,s)=>20-s).map(e=>s.jsxs(N,{value:e.toString(),children:["Cambridge ",e]},e))})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Test"}),s.jsxs(j,{value:K.toString(),onValueChange:e=>Q(parseInt(e)),children:[s.jsx(b,{className:"rounded-xl border-light-border",children:s.jsx(g,{})}),s.jsx(v,{className:"rounded-xl border-light-border bg-card",children:Array.from({length:4},(e,s)=>s+1).map(e=>s.jsxs(N,{value:e.toString(),children:["Test ",e]},e))})]})]})]}),s.jsxs(l,{className:"rounded-2xl border-light-border",style:{background:"white"},children:[s.jsx(d,{children:s.jsxs(o,{className:"flex items-center gap-2 text-foreground",children:[s.jsx(E,{className:"w-5 h-5"}),"Speaking Prompt"]})}),s.jsxs(n,{className:"space-y-4",children:[s.jsx(i,{placeholder:"Prompt Title (e.g., 'Part 2: Describe a memorable journey')",value:ee,onChange:e=>se(e.target.value),className:"rounded-xl border-light-border"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs(j,{value:te.toString(),onValueChange:e=>le(parseInt(e)),children:[s.jsx(b,{className:"rounded-xl border-light-border",children:s.jsx(g,{placeholder:"Part Number"})}),s.jsxs(v,{children:[s.jsx(N,{value:"1",children:"Part 1"}),s.jsx(N,{value:"2",children:"Part 2"}),s.jsx(N,{value:"3",children:"Part 3"})]})]}),s.jsx(i,{type:"number",placeholder:"Time Limit (minutes)",value:ne,onChange:e=>ie(parseInt(e.target.value)),className:"rounded-xl border-light-border"})]}),s.jsx(f,{placeholder:"Speaking prompt text or questions...",value:ae,onChange:e=>re(e.target.value),rows:6,className:"rounded-xl border-light-border"}),s.jsx(f,{placeholder:"Sample answer or response notes (optional)",value:de,onChange:e=>oe(e.target.value),rows:8,className:"rounded-xl border-light-border"})]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx(t,{onClick:async()=>{try{if(!ee||!ae)return void U({title:"Error",description:"Please provide prompt title and text",variant:"destructive"});const e={title:ee,prompt_text:ae,part_number:te,time_limit:ne,sample_answer:de,test_number:K,cambridge_book:`C${H}`};await $("speaking_prompts",e),U({title:"Success",description:`Speaking prompt uploaded to Cambridge ${H}, Test ${K}`}),se(""),re(""),le(1),ie(2),oe(""),G(!1),ce()}catch(e){U({title:"Error",description:e.message||"Failed to upload prompt",variant:"destructive"})}},disabled:D,className:"rounded-xl flex-1",style:{background:"var(--gradient-button)",border:"none"},children:"Upload Prompt"}),s.jsx(t,{variant:"outline",onClick:()=>G(!1),className:"rounded-xl flex-1",children:"Cancel"})]})]})]})}),R&&s.jsx(m,{open:!!R,onOpenChange:()=>Z(null),children:s.jsxs(p,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[s.jsx(h,{children:s.jsxs(u,{children:["Edit Cambridge ",R.bookNumber," - Test ",R.number]})}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-4",children:"Prompts"}),R.prompts.map((e,a)=>s.jsx(l,{className:"p-4 mb-4",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Title"}),s.jsx(i,{value:e.title,onChange:e=>{const s={...R};s.prompts[a].title=e.target.value,Z(s)},className:"mt-1"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Prompt Text"}),s.jsx(f,{value:e.prompt_text,onChange:e=>{const s={...R};s.prompts[a].prompt_text=e.target.value,Z(s)},rows:4,className:"mt-1"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Time Limit (minutes)"}),s.jsx(i,{type:"number",value:e.time_limit,onChange:e=>{const s={...R};s.prompts[a].time_limit=parseInt(e.target.value),Z(s)},className:"mt-1"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Sample Answer"}),s.jsx(f,{value:e.sample_answer,onChange:e=>{const s={...R};s.prompts[a].sample_answer=e.target.value,Z(s)},rows:6,className:"mt-1"})]})]})},e.id))]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx(t,{onClick:async()=>{if(R)try{for(const e of R.prompts)await z("speaking_prompts",{id:e.id,title:e.title,prompt_text:e.prompt_text,sample_answer:e.sample_answer,time_limit:e.time_limit});U({title:"Success",description:"Section updated successfully"}),Z(null),ce()}catch(e){U({title:"Error",description:"Failed to update section",variant:"destructive"})}},disabled:D,className:"rounded-xl",style:{background:"var(--gradient-button)",border:"none"},children:"Save Changes"}),s.jsx(t,{variant:"outline",onClick:()=>Z(null),className:"rounded-xl",children:"Cancel"})]})]})]})})]})})};export{A as default};
