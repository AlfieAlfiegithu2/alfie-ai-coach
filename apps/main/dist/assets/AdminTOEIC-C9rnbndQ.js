import{u as e,w as s,r as t,j as a,l as r,C as n,b as l,d as i,F as c,a as d,H as o,e as m,I as x,B as h,P as g,J as j,x as u,X as f,y as p}from"./index-DqajxfSZ.js";import{T as N,a as b,b as y,c as w}from"./tabs-BNj4mbzn.js";import{S as v}from"./separator-Be1RqQpH.js";import{A as C,a as T,b as P,c as k,d as E,e as I,f as L,g as O,h as q}from"./alert-dialog-2y11sD_0.js";import{A as R}from"./AdminLayout-Bp2e2mep.js";import{s as Q}from"./supabase-DWL4C3fA.js";import{C as S}from"./chart-column-DVE7zoSv.js";import{I as _}from"./image-CFrYc0KR.js";import{P as A}from"./pen-line-zST0VEjk.js";import{T as $}from"./trash-2-CMWcOHbj.js";const F=()=>{const F=e(),{admin:z,loading:D}=s(),[B,K]=t.useState([]),[M,H]=t.useState([]),[J,U]=t.useState(!1),[V,G]=t.useState(""),[W,X]=t.useState(null),[Y,Z]=t.useState(""),[ee,se]=t.useState("listening"),[te,ae]=t.useState({totalTests:0,listeningTests:0,readingTests:0,totalQuestions:0}),re=async()=>{try{const{data:e,error:s}=await Q.from("tests").select("*").eq("test_type","TOEIC").eq("skill_category","Listening").order("created_at",{ascending:!1});if(s)throw s;K(e||[]);const{data:t,error:a}=await Q.from("tests").select("*").eq("test_type","TOEIC").eq("skill_category","Reading").order("created_at",{ascending:!1});if(a)throw a;H(t||[]),ae({totalTests:((null==e?void 0:e.length)||0)+((null==t?void 0:t.length)||0),listeningTests:(null==e?void 0:e.length)||0,readingTests:(null==t?void 0:t.length)||0,totalQuestions:0})}catch(e){console.error("Error loading tests:",e),j.error("Failed to load tests")}},ne=async e=>{if(V.trim()){U(!0);try{const{data:s,error:t}=await Q.from("tests").insert({test_name:V,test_type:"TOEIC",module:e,skill_category:e}).select().single();if(t)throw t;j.success(`TOEIC ${e} test created successfully`),G(""),re(),s&&F(`/admin/toeic/${e.toLowerCase()}/${s.id}`)}catch(s){console.error("Error creating test:",s),j.error("Failed to create test")}finally{U(!1)}}else j.error("Please enter a test name")},le=()=>{X(null),Z("")},ie=async()=>{if(Y.trim())try{const{error:e}=await Q.from("tests").update({test_name:Y}).eq("id",W);if(e)throw e;j.success("Test name updated successfully"),X(null),Z(""),re()}catch(e){console.error("Error updating test name:",e),j.error("Failed to update test name")}else j.error("Test name cannot be empty")};if(t.useEffect(()=>{D||(z?re():F("/admin/login"))},[z,D,F]),D)return a.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),a.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading TOEIC Admin..."})]})});if(!z)return null;const ce=({test:e,skillCategory:s})=>a.jsxs(n,{className:"cursor-pointer hover:shadow-lg transition-shadow border-l-4 border-l-orange-500",onClick:()=>!W&&F(`/admin/toeic/${s.toLowerCase()}/${e.id}`),children:[a.jsxs(l,{className:"pb-2",children:[a.jsxs(i,{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:["Listening"===s?a.jsx(o,{className:"w-5 h-5 text-orange-500"}):a.jsx(m,{className:"w-5 h-5 text-orange-500"}),W===e.id?a.jsxs("div",{className:"flex items-center space-x-2",onClick:e=>e.stopPropagation(),children:[a.jsx(x,{value:Y,onChange:e=>Z(e.target.value),className:"text-lg font-semibold h-8",onKeyPress:e=>"Enter"===e.key&&ie()}),a.jsx(h,{size:"sm",variant:"ghost",onClick:ie,children:a.jsx(u,{className:"w-4 h-4 text-green-600"})}),a.jsx(h,{size:"sm",variant:"ghost",onClick:le,children:a.jsx(f,{className:"w-4 h-4 text-red-600"})})]}):a.jsx("span",{children:e.test_name})]}),W!==e.id&&a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(h,{size:"sm",variant:"ghost",onClick:s=>{s.stopPropagation(),(e=>{X(e.id),Z(e.test_name)})(e)},children:a.jsx(A,{className:"w-4 h-4"})}),a.jsxs(C,{children:[a.jsx(T,{asChild:!0,children:a.jsx(h,{size:"sm",variant:"ghost",onClick:e=>e.stopPropagation(),children:a.jsx($,{className:"w-4 h-4 text-red-600"})})}),a.jsxs(P,{className:"z-50",children:[a.jsxs(k,{children:[a.jsx(E,{children:"Delete Test"}),a.jsxs(I,{children:['Are you sure you want to delete "',e.test_name,'"? This will also delete all questions. This action cannot be undone.']})]}),a.jsxs(L,{children:[a.jsx(O,{children:"Cancel"}),a.jsx(q,{onClick:()=>(async(e,s)=>{try{const{error:t}=await Q.from("questions").delete().eq("test_id",e);t&&console.error("Error deleting questions:",t);const{error:a}=await Q.from("tests").delete().eq("id",e);if(a)throw a;j.success(`Test "${s}" deleted successfully`),re()}catch(t){console.error("Error deleting test:",t),j.error("Failed to delete test")}})(e.id,e.test_name),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]}),a.jsxs(p,{children:["Created: ",new Date(e.created_at).toLocaleDateString()]})]}),a.jsxs(d,{children:[a.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[a.jsx(r,{variant:"outline",className:"bg-orange-50 text-orange-700 border-orange-200",children:s}),a.jsx("span",{children:"Listening"===s?"Parts 1-4 (100 Q)":"Parts 5-7 (100 Q)"})]}),a.jsx(h,{size:"sm",className:"w-full mt-3 bg-orange-600 hover:bg-orange-700",onClick:t=>{t.stopPropagation(),F(`/admin/toeic/${s.toLowerCase()}/${e.id}`)},disabled:W===e.id,children:"Manage Test"})]})]},e.id);return a.jsx(R,{title:"TOEIC Administration",showBackButton:!0,backPath:"/admin",children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold tracking-tight bg-gradient-to-r from-orange-500 to-amber-500 bg-clip-text text-transparent",children:"TOEIC Admin Portal"}),a.jsx("p",{className:"text-muted-foreground",children:"Manage TOEIC Listening and Reading tests"})]}),a.jsx(r,{variant:"secondary",className:"text-sm bg-orange-100 text-orange-700",children:"TOEIC Module"})]}),a.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[a.jsxs(n,{className:"border-l-4 border-l-orange-500",children:[a.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(i,{className:"text-sm font-medium",children:"Total Tests"}),a.jsx(c,{className:"h-4 w-4 text-muted-foreground"})]}),a.jsxs(d,{children:[a.jsx("div",{className:"text-2xl font-bold",children:te.totalTests}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"TOEIC practice tests"})]})]}),a.jsxs(n,{className:"border-l-4 border-l-blue-500",children:[a.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(i,{className:"text-sm font-medium",children:"Listening Tests"}),a.jsx(o,{className:"h-4 w-4 text-muted-foreground"})]}),a.jsxs(d,{children:[a.jsx("div",{className:"text-2xl font-bold",children:te.listeningTests}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Parts 1-4 (100 questions each)"})]})]}),a.jsxs(n,{className:"border-l-4 border-l-green-500",children:[a.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(i,{className:"text-sm font-medium",children:"Reading Tests"}),a.jsx(m,{className:"h-4 w-4 text-muted-foreground"})]}),a.jsxs(d,{children:[a.jsx("div",{className:"text-2xl font-bold",children:te.readingTests}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Parts 5-7 (100 questions each)"})]})]}),a.jsxs(n,{className:"border-l-4 border-l-purple-500",children:[a.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(i,{className:"text-sm font-medium",children:"TOEIC Structure"}),a.jsx(S,{className:"h-4 w-4 text-muted-foreground"})]}),a.jsxs(d,{children:[a.jsx("div",{className:"text-2xl font-bold",children:"200"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Questions per full test"})]})]})]}),a.jsxs(n,{className:"bg-gradient-to-r from-orange-50 to-amber-50 dark:from-orange-950/20 dark:to-amber-950/20",children:[a.jsx(l,{children:a.jsx(i,{className:"text-orange-700 dark:text-orange-400",children:"TOEIC Test Structure"})}),a.jsx(d,{children:a.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsxs("h4",{className:"font-semibold flex items-center gap-2 mb-3",children:[a.jsx(o,{className:"w-4 h-4"}),"Listening (45 min, 100 Q)"]}),a.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[a.jsxs("li",{className:"flex justify-between",children:[a.jsx("span",{children:"Part 1: Photos"}),a.jsx("span",{className:"font-medium",children:"6 Q"})]}),a.jsxs("li",{className:"flex justify-between",children:[a.jsx("span",{children:"Part 2: Question-Response"}),a.jsx("span",{className:"font-medium",children:"25 Q"})]}),a.jsxs("li",{className:"flex justify-between",children:[a.jsx("span",{children:"Part 3: Conversations"}),a.jsx("span",{className:"font-medium",children:"39 Q"})]}),a.jsxs("li",{className:"flex justify-between",children:[a.jsx("span",{children:"Part 4: Talks"}),a.jsx("span",{className:"font-medium",children:"30 Q"})]})]})]}),a.jsxs("div",{children:[a.jsxs("h4",{className:"font-semibold flex items-center gap-2 mb-3",children:[a.jsx(m,{className:"w-4 h-4"}),"Reading (75 min, 100 Q)"]}),a.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[a.jsxs("li",{className:"flex justify-between",children:[a.jsx("span",{children:"Part 5: Incomplete Sentences"}),a.jsx("span",{className:"font-medium",children:"40 Q"})]}),a.jsxs("li",{className:"flex justify-between",children:[a.jsx("span",{children:"Part 6: Text Completion"}),a.jsx("span",{className:"font-medium",children:"12 Q"})]}),a.jsxs("li",{className:"flex justify-between",children:[a.jsx("span",{children:"Part 7: Reading Comprehension"}),a.jsx("span",{className:"font-medium",children:"48 Q"})]})]})]})]})})]}),a.jsx(v,{}),a.jsxs(N,{value:ee,onValueChange:se,className:"space-y-4",children:[a.jsxs(b,{className:"grid w-full grid-cols-2",children:[a.jsxs(y,{value:"listening",className:"flex items-center gap-2",children:[a.jsx(o,{className:"w-4 h-4"}),"Listening Tests"]}),a.jsxs(y,{value:"reading",className:"flex items-center gap-2",children:[a.jsx(m,{className:"w-4 h-4"}),"Reading Tests"]})]}),a.jsx(w,{value:"listening",className:"space-y-4",children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-xl font-semibold",children:"TOEIC Listening Tests"}),a.jsx("p",{className:"text-muted-foreground",children:"Parts 1-4: Photos, Question-Response, Conversations, Talks"})]}),a.jsxs("div",{className:"flex gap-3 items-end",children:[a.jsx(x,{placeholder:"Test name (e.g., TOEIC Listening Test 1)",value:V,onChange:e=>G(e.target.value),onKeyPress:e=>"Enter"===e.key&&ne("Listening"),className:"max-w-sm"}),a.jsxs(h,{onClick:()=>ne("Listening"),disabled:J,className:"bg-orange-600 hover:bg-orange-700",children:[a.jsx(g,{className:"w-4 h-4 mr-2"}),J?"Creating...":"Create Test"]})]})]}),B.length>0?a.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:B.map(e=>a.jsx(ce,{test:e,skillCategory:"Listening"},e.id))}):a.jsx(n,{className:"border-dashed",children:a.jsxs(d,{className:"flex flex-col items-center justify-center py-12",children:[a.jsx(o,{className:"w-12 h-12 text-muted-foreground mb-4"}),a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Listening tests yet"}),a.jsx("p",{className:"text-muted-foreground mb-4 text-center",children:"Create your first TOEIC Listening test with Parts 1-4"}),a.jsxs("div",{className:"flex gap-3 items-center",children:[a.jsx(x,{placeholder:"Test name",value:V,onChange:e=>G(e.target.value),className:"max-w-xs"}),a.jsx(h,{onClick:()=>ne("Listening"),className:"bg-orange-600 hover:bg-orange-700",children:"Create First Test"})]})]})})]})}),a.jsx(w,{value:"reading",className:"space-y-4",children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-xl font-semibold",children:"TOEIC Reading Tests"}),a.jsx("p",{className:"text-muted-foreground",children:"Parts 5-7: Incomplete Sentences, Text Completion, Reading Comprehension"})]}),a.jsxs("div",{className:"flex gap-3 items-end",children:[a.jsx(x,{placeholder:"Test name (e.g., TOEIC Reading Test 1)",value:V,onChange:e=>G(e.target.value),onKeyPress:e=>"Enter"===e.key&&ne("Reading"),className:"max-w-sm"}),a.jsxs(h,{onClick:()=>ne("Reading"),disabled:J,className:"bg-orange-600 hover:bg-orange-700",children:[a.jsx(g,{className:"w-4 h-4 mr-2"}),J?"Creating...":"Create Test"]})]})]}),M.length>0?a.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:M.map(e=>a.jsx(ce,{test:e,skillCategory:"Reading"},e.id))}):a.jsx(n,{className:"border-dashed",children:a.jsxs(d,{className:"flex flex-col items-center justify-center py-12",children:[a.jsx(m,{className:"w-12 h-12 text-muted-foreground mb-4"}),a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Reading tests yet"}),a.jsx("p",{className:"text-muted-foreground mb-4 text-center",children:"Create your first TOEIC Reading test with Parts 5-7"}),a.jsxs("div",{className:"flex gap-3 items-center",children:[a.jsx(x,{placeholder:"Test name",value:V,onChange:e=>G(e.target.value),className:"max-w-xs"}),a.jsx(h,{onClick:()=>ne("Reading"),className:"bg-orange-600 hover:bg-orange-700",children:"Create First Test"})]})]})})]})})]}),a.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-6",children:[a.jsxs(n,{className:"border-2 border-dashed hover:border-orange-300 transition-colors",children:[a.jsx(l,{children:a.jsxs(i,{className:"flex items-center gap-2 text-lg",children:[a.jsx(_,{className:"w-5 h-5 text-orange-500"}),"AI Screenshot Parsing"]})}),a.jsx(d,{children:a.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload screenshots of TOEIC tests and let AI extract questions automatically. Supports all question types including passages with multiple questions."})})]}),a.jsxs(n,{className:"border-2 border-dashed hover:border-orange-300 transition-colors",children:[a.jsx(l,{children:a.jsxs(i,{className:"flex items-center gap-2 text-lg",children:[a.jsx(c,{className:"w-5 h-5 text-orange-500"}),"Copy-Paste Import"]})}),a.jsx(d,{children:a.jsx("p",{className:"text-sm text-muted-foreground",children:"Paste questions directly from text. AI will parse the format and create structured questions with options. Perfect for Part 5 & 6."})})]})]})]})})};export{F as default};
