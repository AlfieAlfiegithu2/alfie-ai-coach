import{u as e,w as s,r as t,j as a,l as r,C as l,b as i,d as n,F as c,a as d,H as o,e as x,I as m,B as h,P as j,J as g,x as u,X as p,y as b}from"./index-C7_FyMei.js";import{T as f,a as N,b as E,c as w}from"./tabs-DwyCwmFY.js";import{S as y}from"./separator-BF8PY3aS.js";import{A as v,a as B,b as C,c as D,d as T,e as P,f as A,g as F,h as k}from"./alert-dialog-DV3TqoF9.js";import{A as I}from"./AdminLayout-7EAXF0Tu.js";import{s as S}from"./supabase-DWL4C3fA.js";import{C as L}from"./chart-column-D9s7O5bl.js";import{I as O}from"./image-D4y-QBfG.js";import{P as _}from"./pen-line-BLPvDU0j.js";import{T as Q}from"./trash-2-DHv8MIWM.js";const R=()=>{const R=e(),{admin:$,loading:q}=s(),[z,J]=t.useState([]),[K,M]=t.useState([]),[H,U]=t.useState(!1),[V,G]=t.useState(""),[W,X]=t.useState(""),[Y,Z]=t.useState("Part5"),[ee,se]=t.useState(null),[te,ae]=t.useState(""),[re,le]=t.useState("listening"),[ie,ne]=t.useState({totalTests:0,listeningTests:0,readingTests:0,totalQuestions:0}),ce=async()=>{try{const{data:e,error:s}=await S.from("tests").select("*").eq("test_type","TOEIC").eq("skill_category","Listening").order("created_at",{ascending:!1});if(s)throw s;J(e||[]);const{data:t,error:a}=await S.from("tests").select("*").eq("test_type","TOEIC").eq("skill_category","Reading").order("created_at",{ascending:!1});if(a)throw a;M(t||[]),ne({totalTests:((null==e?void 0:e.length)||0)+((null==t?void 0:t.length)||0),listeningTests:(null==e?void 0:e.length)||0,readingTests:(null==t?void 0:t.length)||0,totalQuestions:0})}catch(e){console.error("Error loading tests:",e),g.error("Failed to load tests")}},de=async e=>{var s;const t="Listening"===e?V:W;if(t.trim()){U(!0);try{const a={test_name:t,test_type:"TOEIC",module:e,skill_category:e};"Reading"===e&&(a.test_subtype=Y);const r=await fetch("https://cuumxmfzhwljylbdlflj.supabase.co/functions/v1/create-test",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${null==(s=(await S.auth.getSession()).data.session)?void 0:s.access_token}`},body:JSON.stringify(a)}),l=await r.json();if(!r.ok||l.error)throw new Error(l.error||"Failed to create test");const i="Reading"===e?` (${Y.replace("Part","Part ")})`:"";g.success(`TOEIC ${e}${i} test created successfully`),"Listening"===e?G(""):X(""),ce(),l.data&&R(`/admin/toeic/${e.toLowerCase()}/${l.data.id}`)}catch(a){console.error("Error creating test:",a),g.error(a instanceof Error?a.message:"Failed to create test")}finally{U(!1)}}else g.error("Please enter a test name")},oe=()=>{se(null),ae("")},xe=async()=>{if(te.trim())try{const{error:e}=await S.from("tests").update({test_name:te}).eq("id",ee);if(e)throw e;g.success("Test name updated successfully"),se(null),ae(""),ce()}catch(e){console.error("Error updating test name:",e),g.error("Failed to update test name")}else g.error("Test name cannot be empty")};if(t.useEffect(()=>{q||($?ce():R("/admin/login"))},[$,q,R]),q)return a.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),a.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading TOEIC Admin..."})]})});if(!$)return null;const me=({test:e,skillCategory:s})=>a.jsxs(l,{className:"cursor-pointer hover:shadow-lg transition-shadow border-l-4 border-l-[#A68B5B] bg-[#FEF9E7] border-[#E8D5A3]",onClick:()=>!ee&&R(`/admin/toeic/${s.toLowerCase()}/${e.id}`),children:[a.jsxs(i,{className:"pb-2",children:[a.jsxs(n,{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:["Listening"===s?a.jsx(o,{className:"w-5 h-5 text-[#8B6914]"}):a.jsx(x,{className:"w-5 h-5 text-[#8B6914]"}),ee===e.id?a.jsxs("div",{className:"flex items-center space-x-2",onClick:e=>e.stopPropagation(),children:[a.jsx(m,{value:te,onChange:e=>ae(e.target.value),className:"text-lg font-semibold h-8 bg-white/50 border-[#E8D5A3]",onKeyPress:e=>"Enter"===e.key&&xe()}),a.jsx(h,{size:"sm",variant:"ghost",onClick:xe,children:a.jsx(u,{className:"w-4 h-4 text-green-600"})}),a.jsx(h,{size:"sm",variant:"ghost",onClick:oe,children:a.jsx(p,{className:"w-4 h-4 text-red-600"})})]}):a.jsx("span",{className:"text-[#5D4E37]",children:e.test_name})]}),ee!==e.id&&a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(h,{size:"sm",variant:"ghost",onClick:s=>{s.stopPropagation(),(e=>{se(e.id),ae(e.test_name)})(e)},children:a.jsx(_,{className:"w-4 h-4 text-[#8B6914]"})}),a.jsxs(v,{children:[a.jsx(B,{asChild:!0,children:a.jsx(h,{size:"sm",variant:"ghost",onClick:e=>e.stopPropagation(),children:a.jsx(Q,{className:"w-4 h-4 text-red-600"})})}),a.jsxs(C,{className:"z-50 bg-[#FEF9E7] border-[#E8D5A3]",children:[a.jsxs(D,{children:[a.jsx(T,{className:"text-[#5D4E37]",children:"Delete Test"}),a.jsxs(P,{className:"text-[#8B6914]",children:['Are you sure you want to delete "',e.test_name,'"? This will also delete all questions. This action cannot be undone.']})]}),a.jsxs(A,{children:[a.jsx(F,{className:"bg-white border-[#E8D5A3] text-[#5D4E37]",children:"Cancel"}),a.jsx(k,{onClick:()=>(async(e,s)=>{var t;try{const a=await fetch("https://cuumxmfzhwljylbdlflj.supabase.co/functions/v1/delete-test",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${null==(t=(await S.auth.getSession()).data.session)?void 0:t.access_token}`},body:JSON.stringify({testId:e})}),r=await a.json();if(!a.ok||r.error)throw new Error(r.error||"Failed to delete test");g.success(`Test "${s}" deleted successfully`),ce()}catch(a){console.error("Error deleting test:",a),g.error(a instanceof Error?a.message:"Failed to delete test")}})(e.id,e.test_name),className:"bg-red-600 hover:bg-red-700 text-white",children:"Delete"})]})]})]})]})]}),a.jsxs(b,{className:"text-[#8B6914]",children:["Created: ",new Date(e.created_at).toLocaleDateString()]})]}),a.jsxs(d,{children:[a.jsxs("div",{className:"flex items-center justify-between text-sm text-[#8B6914]",children:[a.jsx(r,{variant:"outline",className:"bg-[#FEF9E7] text-[#8B6914] border-[#E8D5A3]",children:s}),a.jsx("span",{children:"Listening"===s?"Parts 1-4 (100 Q)":e.test_subtype?`${e.test_subtype.replace("Part","Part ")} (${"Part5"===e.test_subtype?"30":"Part6"===e.test_subtype?"16":"54"} Q)`:"Parts 5-7"})]}),a.jsx(h,{size:"sm",className:"w-full mt-3 bg-[#A68B5B] hover:bg-[#8B6914] text-white",onClick:t=>{t.stopPropagation(),R(`/admin/toeic/${s.toLowerCase()}/${e.id}`)},disabled:ee===e.id,children:"Manage Test"})]})]},e.id);return a.jsx(I,{title:"TOEIC Administration",showBackButton:!0,backPath:"/admin",children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold tracking-tight text-[#5D4E37]",children:"TOEIC Admin Portal"}),a.jsx("p",{className:"text-[#8B6914]",children:"Manage TOEIC Listening and Reading tests"})]}),a.jsx(r,{variant:"secondary",className:"text-sm bg-[#A68B5B] text-white",children:"TOEIC Module"})]}),a.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[a.jsxs(l,{className:"border-l-4 border-l-[#A68B5B] bg-[#FEF9E7] border-[#E8D5A3]",children:[a.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(n,{className:"text-sm font-medium text-[#5D4E37]",children:"Total Tests"}),a.jsx(c,{className:"h-4 w-4 text-[#8B6914]"})]}),a.jsxs(d,{children:[a.jsx("div",{className:"text-2xl font-bold text-[#5D4E37]",children:ie.totalTests}),a.jsx("p",{className:"text-xs text-[#8B6914]",children:"TOEIC practice tests"})]})]}),a.jsxs(l,{className:"border-l-4 border-l-[#C97D60] bg-[#FEF9E7] border-[#E8D5A3]",children:[a.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(n,{className:"text-sm font-medium text-[#5D4E37]",children:"Listening Tests"}),a.jsx(o,{className:"h-4 w-4 text-[#8B6914]"})]}),a.jsxs(d,{children:[a.jsx("div",{className:"text-2xl font-bold text-[#5D4E37]",children:ie.listeningTests}),a.jsx("p",{className:"text-xs text-[#8B6914]",children:"Parts 1-4 (100 questions each)"})]})]}),a.jsxs(l,{className:"border-l-4 border-l-[#8B6914] bg-[#FEF9E7] border-[#E8D5A3]",children:[a.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(n,{className:"text-sm font-medium text-[#5D4E37]",children:"Reading Tests"}),a.jsx(x,{className:"h-4 w-4 text-[#8B6914]"})]}),a.jsxs(d,{children:[a.jsx("div",{className:"text-2xl font-bold text-[#5D4E37]",children:ie.readingTests}),a.jsx("p",{className:"text-xs text-[#8B6914]",children:"Parts 5-7 (100 questions each)"})]})]}),a.jsxs(l,{className:"border-l-4 border-l-[#5D4E37] bg-[#FEF9E7] border-[#E8D5A3]",children:[a.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(n,{className:"text-sm font-medium text-[#5D4E37]",children:"TOEIC Structure"}),a.jsx(L,{className:"h-4 w-4 text-[#8B6914]"})]}),a.jsxs(d,{children:[a.jsx("div",{className:"text-2xl font-bold text-[#5D4E37]",children:"200"}),a.jsx("p",{className:"text-xs text-[#8B6914]",children:"Questions per full test"})]})]})]}),a.jsxs(l,{className:"bg-[#FEF9E7] border-[#E8D5A3]",children:[a.jsx(i,{children:a.jsx(n,{className:"text-[#5D4E37]",children:"TOEIC Test Structure"})}),a.jsx(d,{children:a.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsxs("h4",{className:"font-semibold flex items-center gap-2 mb-3 text-[#5D4E37]",children:[a.jsx(o,{className:"w-4 h-4 text-[#8B6914]"}),"Listening (45 min, 100 Q)"]}),a.jsxs("ul",{className:"space-y-2 text-sm text-[#8B6914]",children:[a.jsxs("li",{className:"flex justify-between",children:[a.jsx("span",{children:"Part 1: Photos"}),a.jsx("span",{className:"font-medium text-[#5D4E37]",children:"6 Q"})]}),a.jsxs("li",{className:"flex justify-between",children:[a.jsx("span",{children:"Part 2: Question-Response"}),a.jsx("span",{className:"font-medium text-[#5D4E37]",children:"25 Q"})]}),a.jsxs("li",{className:"flex justify-between",children:[a.jsx("span",{children:"Part 3: Conversations"}),a.jsx("span",{className:"font-medium text-[#5D4E37]",children:"39 Q"})]}),a.jsxs("li",{className:"flex justify-between",children:[a.jsx("span",{children:"Part 4: Talks"}),a.jsx("span",{className:"font-medium text-[#5D4E37]",children:"30 Q"})]})]})]}),a.jsxs("div",{children:[a.jsxs("h4",{className:"font-semibold flex items-center gap-2 mb-3 text-[#5D4E37]",children:[a.jsx(x,{className:"w-4 h-4 text-[#8B6914]"}),"Reading (75 min, 100 Q)"]}),a.jsxs("ul",{className:"space-y-2 text-sm text-[#8B6914]",children:[a.jsxs("li",{className:"flex justify-between",children:[a.jsx("span",{children:"Part 5: Incomplete Sentences"}),a.jsx("span",{className:"font-medium text-[#5D4E37]",children:"40 Q"})]}),a.jsxs("li",{className:"flex justify-between",children:[a.jsx("span",{children:"Part 6: Text Completion"}),a.jsx("span",{className:"font-medium text-[#5D4E37]",children:"12 Q"})]}),a.jsxs("li",{className:"flex justify-between",children:[a.jsx("span",{children:"Part 7: Reading Comprehension"}),a.jsx("span",{className:"font-medium text-[#5D4E37]",children:"48 Q"})]})]})]})]})})]}),a.jsx(y,{className:"bg-[#E8D5A3]"}),a.jsxs(f,{value:re,onValueChange:le,className:"space-y-4",children:[a.jsxs(N,{className:"grid w-full grid-cols-2 bg-[#E8D5A3]/20 border border-[#E8D5A3]",children:[a.jsxs(E,{value:"listening",className:"flex items-center gap-2 data-[state=active]:bg-[#FEF9E7] data-[state=active]:text-[#5D4E37] text-[#8B6914]",children:[a.jsx(o,{className:"w-4 h-4"}),"Listening Tests"]}),a.jsxs(E,{value:"reading",className:"flex items-center gap-2 data-[state=active]:bg-[#FEF9E7] data-[state=active]:text-[#5D4E37] text-[#8B6914]",children:[a.jsx(x,{className:"w-4 h-4"}),"Reading Tests"]})]}),a.jsx(w,{value:"listening",className:"space-y-4",children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-xl font-semibold text-[#5D4E37]",children:"TOEIC Listening Tests"}),a.jsx("p",{className:"text-[#8B6914]",children:"Parts 1-4: Photos, Question-Response, Conversations, Talks"})]}),a.jsxs("div",{className:"flex gap-3 items-end",children:[a.jsx(m,{placeholder:"Test name (e.g., TOEIC Listening Test 1)",value:V,onChange:e=>G(e.target.value),onKeyPress:e=>"Enter"===e.key&&de("Listening"),className:"max-w-sm bg-white/50 border-[#E8D5A3] focus:border-[#8B6914] focus:ring-[#8B6914]"}),a.jsxs(h,{onClick:()=>de("Listening"),disabled:H,className:"bg-[#A68B5B] hover:bg-[#8B6914] text-white",children:[a.jsx(j,{className:"w-4 h-4 mr-2"}),H?"Creating...":"Create Test"]})]})]}),z.length>0?a.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:z.map(e=>a.jsx(me,{test:e,skillCategory:"Listening"},e.id))}):a.jsx(l,{className:"border-dashed border-[#E8D5A3] bg-[#FEF9E7]/50",children:a.jsxs(d,{className:"flex flex-col items-center justify-center py-12",children:[a.jsx(o,{className:"w-12 h-12 text-[#A68B5B] mb-4"}),a.jsx("h3",{className:"text-lg font-semibold mb-2 text-[#5D4E37]",children:"No Listening tests yet"}),a.jsx("p",{className:"text-[#8B6914] mb-4 text-center",children:"Create your first TOEIC Listening test with Parts 1-4"}),a.jsxs("div",{className:"flex gap-3 items-center",children:[a.jsx(m,{placeholder:"Test name",value:V,onChange:e=>G(e.target.value),className:"max-w-xs bg-white/50 border-[#E8D5A3]"}),a.jsx(h,{onClick:()=>de("Listening"),className:"bg-[#A68B5B] hover:bg-[#8B6914] text-white",children:"Create First Test"})]})]})})]})}),a.jsx(w,{value:"reading",className:"space-y-4",children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-xl font-semibold text-[#5D4E37]",children:"TOEIC Reading Tests"}),a.jsx("p",{className:"text-[#8B6914]",children:"Create separate tests for Part 5, 6, or 7"})]}),a.jsxs("div",{className:"flex gap-3 items-end flex-wrap",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-xs text-[#8B6914] font-medium",children:"Select Part *"}),a.jsxs("select",{value:Y,onChange:e=>Z(e.target.value),className:"h-10 px-3 rounded-md border border-[#E8D5A3] bg-white/50 text-[#5D4E37] focus:border-[#8B6914] focus:ring-[#8B6914] focus:outline-none",children:[a.jsx("option",{value:"Part5",children:"Part 5 - Incomplete Sentences (30 Q)"}),a.jsx("option",{value:"Part6",children:"Part 6 - Text Completion (16 Q)"}),a.jsx("option",{value:"Part7",children:"Part 7 - Reading Comprehension (54 Q)"})]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-xs text-[#8B6914] font-medium",children:"Test Name"}),a.jsx(m,{placeholder:`e.g., TOEIC ${Y.replace("Part","Part ")} - Test 1`,value:W,onChange:e=>X(e.target.value),onKeyPress:e=>"Enter"===e.key&&de("Reading"),className:"w-64 bg-white/50 border-[#E8D5A3] focus:border-[#8B6914] focus:ring-[#8B6914]"})]}),a.jsxs(h,{onClick:()=>de("Reading"),disabled:H,className:"bg-[#A68B5B] hover:bg-[#8B6914] text-white",children:[a.jsx(j,{className:"w-4 h-4 mr-2"}),H?"Creating...":"Create Test"]})]})]}),K.length>0?a.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:K.map(e=>a.jsx(me,{test:e,skillCategory:"Reading"},e.id))}):a.jsx(l,{className:"border-dashed border-[#E8D5A3] bg-[#FEF9E7]/50",children:a.jsxs(d,{className:"flex flex-col items-center justify-center py-12",children:[a.jsx(x,{className:"w-12 h-12 text-[#A68B5B] mb-4"}),a.jsx("h3",{className:"text-lg font-semibold mb-2 text-[#5D4E37]",children:"No Reading tests yet"}),a.jsx("p",{className:"text-[#8B6914] mb-4 text-center",children:"Create separate tests for Part 5, 6, or 7"}),a.jsxs("div",{className:"flex gap-3 items-center flex-wrap justify-center",children:[a.jsxs("select",{value:Y,onChange:e=>Z(e.target.value),className:"h-10 px-3 rounded-md border border-[#E8D5A3] bg-white/50 text-[#5D4E37]",children:[a.jsx("option",{value:"Part5",children:"Part 5"}),a.jsx("option",{value:"Part6",children:"Part 6"}),a.jsx("option",{value:"Part7",children:"Part 7"})]}),a.jsx(m,{placeholder:"Test name",value:W,onChange:e=>X(e.target.value),className:"max-w-xs bg-white/50 border-[#E8D5A3]"}),a.jsx(h,{onClick:()=>de("Reading"),className:"bg-[#A68B5B] hover:bg-[#8B6914] text-white",children:"Create First Test"})]})]})})]})})]}),a.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-6",children:[a.jsxs(l,{className:"border-2 border-dashed border-[#E8D5A3] bg-[#FEF9E7] hover:bg-[#FDF6E3] transition-colors",children:[a.jsx(i,{children:a.jsxs(n,{className:"flex items-center gap-2 text-lg text-[#5D4E37]",children:[a.jsx(O,{className:"w-5 h-5 text-[#8B6914]"}),"AI Screenshot Parsing"]})}),a.jsx(d,{children:a.jsx("p",{className:"text-sm text-[#8B6914]",children:"Upload screenshots of TOEIC tests and let AI extract questions automatically. Supports all question types including passages with multiple questions."})})]}),a.jsxs(l,{className:"border-2 border-dashed border-[#E8D5A3] bg-[#FEF9E7] hover:bg-[#FDF6E3] transition-colors",children:[a.jsx(i,{children:a.jsxs(n,{className:"flex items-center gap-2 text-lg text-[#5D4E37]",children:[a.jsx(c,{className:"w-5 h-5 text-[#8B6914]"}),"Copy-Paste Import"]})}),a.jsx(d,{children:a.jsx("p",{className:"text-sm text-[#8B6914]",children:"Paste questions directly from text. AI will parse the format and create structured questions with options. Perfect for Part 5 & 6."})})]})]})]})})};export{R as default};
