import{u as e,w as s,r as t,j as a,l,C as r,b as i,d as n,F as c,a as d,H as o,e as x,I as m,B as h,P as j,J as g,x as u,X as b,y as f}from"./index-BQgnpnc4.js";import{T as N,a as p,b as E,c as w}from"./tabs-xRkXf7aB.js";import{S as y}from"./separator-CzQHfEPc.js";import{A as v,a as C,b as B,c as T,d as D,e as A,f as F,g as P,h as k}from"./alert-dialog-BnG0uxXn.js";import{A as I}from"./AdminLayout-Bikg-bCf.js";import{s as L}from"./supabase-DWL4C3fA.js";import{C as O}from"./chart-column-BpGQKd1R.js";import{I as S}from"./image-CIoTvUBQ.js";import{P as R}from"./pen-line-BIXI50iD.js";import{T as _}from"./trash-2-cxLSoE6Q.js";const Q=()=>{const Q=e(),{admin:q,loading:z}=s(),[$,J]=t.useState([]),[K,M]=t.useState([]),[H,U]=t.useState(!1),[V,G]=t.useState(""),[W,X]=t.useState(""),[Y,Z]=t.useState(null),[ee,se]=t.useState(""),[te,ae]=t.useState("listening"),[le,re]=t.useState({totalTests:0,listeningTests:0,readingTests:0,totalQuestions:0}),ie=async()=>{try{const{data:e,error:s}=await L.from("tests").select("*").eq("test_type","TOEIC").eq("skill_category","Listening").order("created_at",{ascending:!1});if(s)throw s;J(e||[]);const{data:t,error:a}=await L.from("tests").select("*").eq("test_type","TOEIC").eq("skill_category","Reading").order("created_at",{ascending:!1});if(a)throw a;M(t||[]),re({totalTests:((null==e?void 0:e.length)||0)+((null==t?void 0:t.length)||0),listeningTests:(null==e?void 0:e.length)||0,readingTests:(null==t?void 0:t.length)||0,totalQuestions:0})}catch(e){console.error("Error loading tests:",e),g.error("Failed to load tests")}},ne=async e=>{var s;const t="Listening"===e?V:W;if(t.trim()){U(!0);try{const a=await fetch("https://cuumxmfzhwljylbdlflj.supabase.co/functions/v1/create-test",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${null==(s=(await L.auth.getSession()).data.session)?void 0:s.access_token}`},body:JSON.stringify({test_name:t,test_type:"TOEIC",module:e,skill_category:e})}),l=await a.json();if(!a.ok||l.error)throw new Error(l.error||"Failed to create test");g.success(`TOEIC ${e} test created successfully`),"Listening"===e?G(""):X(""),ie(),l.data&&Q(`/admin/toeic/${e.toLowerCase()}/${l.data.id}`)}catch(a){console.error("Error creating test:",a),g.error(a instanceof Error?a.message:"Failed to create test")}finally{U(!1)}}else g.error("Please enter a test name")},ce=()=>{Z(null),se("")},de=async()=>{if(ee.trim())try{const{error:e}=await L.from("tests").update({test_name:ee}).eq("id",Y);if(e)throw e;g.success("Test name updated successfully"),Z(null),se(""),ie()}catch(e){console.error("Error updating test name:",e),g.error("Failed to update test name")}else g.error("Test name cannot be empty")};if(t.useEffect(()=>{z||(q?ie():Q("/admin/login"))},[q,z,Q]),z)return a.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),a.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading TOEIC Admin..."})]})});if(!q)return null;const oe=({test:e,skillCategory:s})=>a.jsxs(r,{className:"cursor-pointer hover:shadow-lg transition-shadow border-l-4 border-l-[#A68B5B] bg-[#FEF9E7] border-[#E8D5A3]",onClick:()=>!Y&&Q(`/admin/toeic/${s.toLowerCase()}/${e.id}`),children:[a.jsxs(i,{className:"pb-2",children:[a.jsxs(n,{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:["Listening"===s?a.jsx(o,{className:"w-5 h-5 text-[#8B6914]"}):a.jsx(x,{className:"w-5 h-5 text-[#8B6914]"}),Y===e.id?a.jsxs("div",{className:"flex items-center space-x-2",onClick:e=>e.stopPropagation(),children:[a.jsx(m,{value:ee,onChange:e=>se(e.target.value),className:"text-lg font-semibold h-8 bg-white/50 border-[#E8D5A3]",onKeyPress:e=>"Enter"===e.key&&de()}),a.jsx(h,{size:"sm",variant:"ghost",onClick:de,children:a.jsx(u,{className:"w-4 h-4 text-green-600"})}),a.jsx(h,{size:"sm",variant:"ghost",onClick:ce,children:a.jsx(b,{className:"w-4 h-4 text-red-600"})})]}):a.jsx("span",{className:"text-[#5D4E37]",children:e.test_name})]}),Y!==e.id&&a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(h,{size:"sm",variant:"ghost",onClick:s=>{s.stopPropagation(),(e=>{Z(e.id),se(e.test_name)})(e)},children:a.jsx(R,{className:"w-4 h-4 text-[#8B6914]"})}),a.jsxs(v,{children:[a.jsx(C,{asChild:!0,children:a.jsx(h,{size:"sm",variant:"ghost",onClick:e=>e.stopPropagation(),children:a.jsx(_,{className:"w-4 h-4 text-red-600"})})}),a.jsxs(B,{className:"z-50 bg-[#FEF9E7] border-[#E8D5A3]",children:[a.jsxs(T,{children:[a.jsx(D,{className:"text-[#5D4E37]",children:"Delete Test"}),a.jsxs(A,{className:"text-[#8B6914]",children:['Are you sure you want to delete "',e.test_name,'"? This will also delete all questions. This action cannot be undone.']})]}),a.jsxs(F,{children:[a.jsx(P,{className:"bg-white border-[#E8D5A3] text-[#5D4E37]",children:"Cancel"}),a.jsx(k,{onClick:()=>(async(e,s)=>{var t;try{const a=await fetch("https://cuumxmfzhwljylbdlflj.supabase.co/functions/v1/delete-test",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${null==(t=(await L.auth.getSession()).data.session)?void 0:t.access_token}`},body:JSON.stringify({testId:e})}),l=await a.json();if(!a.ok||l.error)throw new Error(l.error||"Failed to delete test");g.success(`Test "${s}" deleted successfully`),ie()}catch(a){console.error("Error deleting test:",a),g.error(a instanceof Error?a.message:"Failed to delete test")}})(e.id,e.test_name),className:"bg-red-600 hover:bg-red-700 text-white",children:"Delete"})]})]})]})]})]}),a.jsxs(f,{className:"text-[#8B6914]",children:["Created: ",new Date(e.created_at).toLocaleDateString()]})]}),a.jsxs(d,{children:[a.jsxs("div",{className:"flex items-center justify-between text-sm text-[#8B6914]",children:[a.jsx(l,{variant:"outline",className:"bg-[#FEF9E7] text-[#8B6914] border-[#E8D5A3]",children:s}),a.jsx("span",{children:"Listening"===s?"Parts 1-4 (100 Q)":"Parts 5-7 (100 Q)"})]}),a.jsx(h,{size:"sm",className:"w-full mt-3 bg-[#A68B5B] hover:bg-[#8B6914] text-white",onClick:t=>{t.stopPropagation(),Q(`/admin/toeic/${s.toLowerCase()}/${e.id}`)},disabled:Y===e.id,children:"Manage Test"})]})]},e.id);return a.jsx(I,{title:"TOEIC Administration",showBackButton:!0,backPath:"/admin",children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold tracking-tight text-[#5D4E37]",children:"TOEIC Admin Portal"}),a.jsx("p",{className:"text-[#8B6914]",children:"Manage TOEIC Listening and Reading tests"})]}),a.jsx(l,{variant:"secondary",className:"text-sm bg-[#A68B5B] text-white",children:"TOEIC Module"})]}),a.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[a.jsxs(r,{className:"border-l-4 border-l-[#A68B5B] bg-[#FEF9E7] border-[#E8D5A3]",children:[a.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(n,{className:"text-sm font-medium text-[#5D4E37]",children:"Total Tests"}),a.jsx(c,{className:"h-4 w-4 text-[#8B6914]"})]}),a.jsxs(d,{children:[a.jsx("div",{className:"text-2xl font-bold text-[#5D4E37]",children:le.totalTests}),a.jsx("p",{className:"text-xs text-[#8B6914]",children:"TOEIC practice tests"})]})]}),a.jsxs(r,{className:"border-l-4 border-l-[#C97D60] bg-[#FEF9E7] border-[#E8D5A3]",children:[a.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(n,{className:"text-sm font-medium text-[#5D4E37]",children:"Listening Tests"}),a.jsx(o,{className:"h-4 w-4 text-[#8B6914]"})]}),a.jsxs(d,{children:[a.jsx("div",{className:"text-2xl font-bold text-[#5D4E37]",children:le.listeningTests}),a.jsx("p",{className:"text-xs text-[#8B6914]",children:"Parts 1-4 (100 questions each)"})]})]}),a.jsxs(r,{className:"border-l-4 border-l-[#8B6914] bg-[#FEF9E7] border-[#E8D5A3]",children:[a.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(n,{className:"text-sm font-medium text-[#5D4E37]",children:"Reading Tests"}),a.jsx(x,{className:"h-4 w-4 text-[#8B6914]"})]}),a.jsxs(d,{children:[a.jsx("div",{className:"text-2xl font-bold text-[#5D4E37]",children:le.readingTests}),a.jsx("p",{className:"text-xs text-[#8B6914]",children:"Parts 5-7 (100 questions each)"})]})]}),a.jsxs(r,{className:"border-l-4 border-l-[#5D4E37] bg-[#FEF9E7] border-[#E8D5A3]",children:[a.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(n,{className:"text-sm font-medium text-[#5D4E37]",children:"TOEIC Structure"}),a.jsx(O,{className:"h-4 w-4 text-[#8B6914]"})]}),a.jsxs(d,{children:[a.jsx("div",{className:"text-2xl font-bold text-[#5D4E37]",children:"200"}),a.jsx("p",{className:"text-xs text-[#8B6914]",children:"Questions per full test"})]})]})]}),a.jsxs(r,{className:"bg-[#FEF9E7] border-[#E8D5A3]",children:[a.jsx(i,{children:a.jsx(n,{className:"text-[#5D4E37]",children:"TOEIC Test Structure"})}),a.jsx(d,{children:a.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsxs("h4",{className:"font-semibold flex items-center gap-2 mb-3 text-[#5D4E37]",children:[a.jsx(o,{className:"w-4 h-4 text-[#8B6914]"}),"Listening (45 min, 100 Q)"]}),a.jsxs("ul",{className:"space-y-2 text-sm text-[#8B6914]",children:[a.jsxs("li",{className:"flex justify-between",children:[a.jsx("span",{children:"Part 1: Photos"}),a.jsx("span",{className:"font-medium text-[#5D4E37]",children:"6 Q"})]}),a.jsxs("li",{className:"flex justify-between",children:[a.jsx("span",{children:"Part 2: Question-Response"}),a.jsx("span",{className:"font-medium text-[#5D4E37]",children:"25 Q"})]}),a.jsxs("li",{className:"flex justify-between",children:[a.jsx("span",{children:"Part 3: Conversations"}),a.jsx("span",{className:"font-medium text-[#5D4E37]",children:"39 Q"})]}),a.jsxs("li",{className:"flex justify-between",children:[a.jsx("span",{children:"Part 4: Talks"}),a.jsx("span",{className:"font-medium text-[#5D4E37]",children:"30 Q"})]})]})]}),a.jsxs("div",{children:[a.jsxs("h4",{className:"font-semibold flex items-center gap-2 mb-3 text-[#5D4E37]",children:[a.jsx(x,{className:"w-4 h-4 text-[#8B6914]"}),"Reading (75 min, 100 Q)"]}),a.jsxs("ul",{className:"space-y-2 text-sm text-[#8B6914]",children:[a.jsxs("li",{className:"flex justify-between",children:[a.jsx("span",{children:"Part 5: Incomplete Sentences"}),a.jsx("span",{className:"font-medium text-[#5D4E37]",children:"40 Q"})]}),a.jsxs("li",{className:"flex justify-between",children:[a.jsx("span",{children:"Part 6: Text Completion"}),a.jsx("span",{className:"font-medium text-[#5D4E37]",children:"12 Q"})]}),a.jsxs("li",{className:"flex justify-between",children:[a.jsx("span",{children:"Part 7: Reading Comprehension"}),a.jsx("span",{className:"font-medium text-[#5D4E37]",children:"48 Q"})]})]})]})]})})]}),a.jsx(y,{className:"bg-[#E8D5A3]"}),a.jsxs(N,{value:te,onValueChange:ae,className:"space-y-4",children:[a.jsxs(p,{className:"grid w-full grid-cols-2 bg-[#E8D5A3]/20 border border-[#E8D5A3]",children:[a.jsxs(E,{value:"listening",className:"flex items-center gap-2 data-[state=active]:bg-[#FEF9E7] data-[state=active]:text-[#5D4E37] text-[#8B6914]",children:[a.jsx(o,{className:"w-4 h-4"}),"Listening Tests"]}),a.jsxs(E,{value:"reading",className:"flex items-center gap-2 data-[state=active]:bg-[#FEF9E7] data-[state=active]:text-[#5D4E37] text-[#8B6914]",children:[a.jsx(x,{className:"w-4 h-4"}),"Reading Tests"]})]}),a.jsx(w,{value:"listening",className:"space-y-4",children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-xl font-semibold text-[#5D4E37]",children:"TOEIC Listening Tests"}),a.jsx("p",{className:"text-[#8B6914]",children:"Parts 1-4: Photos, Question-Response, Conversations, Talks"})]}),a.jsxs("div",{className:"flex gap-3 items-end",children:[a.jsx(m,{placeholder:"Test name (e.g., TOEIC Listening Test 1)",value:V,onChange:e=>G(e.target.value),onKeyPress:e=>"Enter"===e.key&&ne("Listening"),className:"max-w-sm bg-white/50 border-[#E8D5A3] focus:border-[#8B6914] focus:ring-[#8B6914]"}),a.jsxs(h,{onClick:()=>ne("Listening"),disabled:H,className:"bg-[#A68B5B] hover:bg-[#8B6914] text-white",children:[a.jsx(j,{className:"w-4 h-4 mr-2"}),H?"Creating...":"Create Test"]})]})]}),$.length>0?a.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:$.map(e=>a.jsx(oe,{test:e,skillCategory:"Listening"},e.id))}):a.jsx(r,{className:"border-dashed border-[#E8D5A3] bg-[#FEF9E7]/50",children:a.jsxs(d,{className:"flex flex-col items-center justify-center py-12",children:[a.jsx(o,{className:"w-12 h-12 text-[#A68B5B] mb-4"}),a.jsx("h3",{className:"text-lg font-semibold mb-2 text-[#5D4E37]",children:"No Listening tests yet"}),a.jsx("p",{className:"text-[#8B6914] mb-4 text-center",children:"Create your first TOEIC Listening test with Parts 1-4"}),a.jsxs("div",{className:"flex gap-3 items-center",children:[a.jsx(m,{placeholder:"Test name",value:V,onChange:e=>G(e.target.value),className:"max-w-xs bg-white/50 border-[#E8D5A3]"}),a.jsx(h,{onClick:()=>ne("Listening"),className:"bg-[#A68B5B] hover:bg-[#8B6914] text-white",children:"Create First Test"})]})]})})]})}),a.jsx(w,{value:"reading",className:"space-y-4",children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-xl font-semibold text-[#5D4E37]",children:"TOEIC Reading Tests"}),a.jsx("p",{className:"text-[#8B6914]",children:"Parts 5-7: Incomplete Sentences, Text Completion, Reading Comprehension"})]}),a.jsxs("div",{className:"flex gap-3 items-end",children:[a.jsx(m,{placeholder:"Test name (e.g., TOEIC Reading Test 1)",value:W,onChange:e=>X(e.target.value),onKeyPress:e=>"Enter"===e.key&&ne("Reading"),className:"max-w-sm bg-white/50 border-[#E8D5A3] focus:border-[#8B6914] focus:ring-[#8B6914]"}),a.jsxs(h,{onClick:()=>ne("Reading"),disabled:H,className:"bg-[#A68B5B] hover:bg-[#8B6914] text-white",children:[a.jsx(j,{className:"w-4 h-4 mr-2"}),H?"Creating...":"Create Test"]})]})]}),K.length>0?a.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:K.map(e=>a.jsx(oe,{test:e,skillCategory:"Reading"},e.id))}):a.jsx(r,{className:"border-dashed border-[#E8D5A3] bg-[#FEF9E7]/50",children:a.jsxs(d,{className:"flex flex-col items-center justify-center py-12",children:[a.jsx(x,{className:"w-12 h-12 text-[#A68B5B] mb-4"}),a.jsx("h3",{className:"text-lg font-semibold mb-2 text-[#5D4E37]",children:"No Reading tests yet"}),a.jsx("p",{className:"text-[#8B6914] mb-4 text-center",children:"Create your first TOEIC Reading test with Parts 5-7"}),a.jsxs("div",{className:"flex gap-3 items-center",children:[a.jsx(m,{placeholder:"Test name",value:W,onChange:e=>X(e.target.value),className:"max-w-xs bg-white/50 border-[#E8D5A3]"}),a.jsx(h,{onClick:()=>ne("Reading"),className:"bg-[#A68B5B] hover:bg-[#8B6914] text-white",children:"Create First Test"})]})]})})]})})]}),a.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-6",children:[a.jsxs(r,{className:"border-2 border-dashed border-[#E8D5A3] bg-[#FEF9E7] hover:bg-[#FDF6E3] transition-colors",children:[a.jsx(i,{children:a.jsxs(n,{className:"flex items-center gap-2 text-lg text-[#5D4E37]",children:[a.jsx(S,{className:"w-5 h-5 text-[#8B6914]"}),"AI Screenshot Parsing"]})}),a.jsx(d,{children:a.jsx("p",{className:"text-sm text-[#8B6914]",children:"Upload screenshots of TOEIC tests and let AI extract questions automatically. Supports all question types including passages with multiple questions."})})]}),a.jsxs(r,{className:"border-2 border-dashed border-[#E8D5A3] bg-[#FEF9E7] hover:bg-[#FDF6E3] transition-colors",children:[a.jsx(i,{children:a.jsxs(n,{className:"flex items-center gap-2 text-lg text-[#5D4E37]",children:[a.jsx(c,{className:"w-5 h-5 text-[#8B6914]"}),"Copy-Paste Import"]})}),a.jsx(d,{children:a.jsx("p",{className:"text-sm text-[#8B6914]",children:"Paste questions directly from text. AI will parse the format and create structured questions with options. Perfect for Part 5 & 6."})})]})]})]})})};export{Q as default};
