import{u as e,r as s,j as t}from"./vendor-react-rLLBBC7n.js";import{n as a,e as r,C as l,b as i,c as n,a as c,I as d,B as o,s as x,J as m,o as h}from"./index-KxDfHqNJ.js";import{T as j,a as g,b as u,c as p}from"./tabs-BVz_B7Kx.js";import{S as b}from"./separator-DByOkGf1.js";import{A as f,a as N,b as E,c as v,d as w,e as y,f as B,g as C,h as D}from"./alert-dialog-Bvks6upm.js";import{A as T}from"./AdminLayout-DGXoIbe0.js";import{ap as P,aJ as A,ao as F,aQ as k,av as I,aS as S,q as L,X as _,a_ as O,aY as Q}from"./vendor-ui-BGi_EvHx.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-charts-0DeywwxG.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";const R=()=>{const R=e(),{admin:$,loading:q}=a(),[z,J]=s.useState([]),[K,M]=s.useState([]),[U,V]=s.useState(!1),[Y,G]=s.useState(""),[H,W]=s.useState(""),[X,Z]=s.useState("Part5"),[ee,se]=s.useState(null),[te,ae]=s.useState(""),[re,le]=s.useState("listening"),[ie,ne]=s.useState({totalTests:0,listeningTests:0,readingTests:0,totalQuestions:0}),ce=async()=>{try{const{data:e,error:s}=await x.from("tests").select("*").eq("test_type","TOEIC").eq("skill_category","Listening").order("created_at",{ascending:!1});if(s)throw s;J(e||[]);const{data:t,error:a}=await x.from("tests").select("*").eq("test_type","TOEIC").eq("skill_category","Reading").order("created_at",{ascending:!1});if(a)throw a;M(t||[]),ne({totalTests:((null==e?void 0:e.length)||0)+((null==t?void 0:t.length)||0),listeningTests:(null==e?void 0:e.length)||0,readingTests:(null==t?void 0:t.length)||0,totalQuestions:0})}catch(e){console.error("Error loading tests:",e),m.error("Failed to load tests")}},de=async e=>{var s;const t="Listening"===e?Y:H;if(t.trim()){V(!0);try{const a={test_name:t,test_type:"TOEIC",module:e,skill_category:e};"Reading"===e&&(a.test_subtype=X);const r=await fetch("https://cuumxmfzhwljylbdlflj.supabase.co/functions/v1/create-test",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${null==(s=(await x.auth.getSession()).data.session)?void 0:s.access_token}`},body:JSON.stringify(a)}),l=await r.json();if(!r.ok||l.error)throw new Error(l.error||"Failed to create test");const i="Reading"===e?` (${X.replace("Part","Part ")})`:"";m.success(`TOEIC ${e}${i} test created successfully`),"Listening"===e?G(""):W(""),ce(),l.data&&R(`/admin/toeic/${e.toLowerCase()}/${l.data.id}`)}catch(a){console.error("Error creating test:",a),m.error(a instanceof Error?a.message:"Failed to create test")}finally{V(!1)}}else m.error("Please enter a test name")},oe=()=>{se(null),ae("")},xe=async()=>{if(te.trim())try{const{error:e}=await x.from("tests").update({test_name:te}).eq("id",ee);if(e)throw e;m.success("Test name updated successfully"),se(null),ae(""),ce()}catch(e){console.error("Error updating test name:",e),m.error("Failed to update test name")}else m.error("Test name cannot be empty")};if(s.useEffect(()=>{q||($?ce():R("/admin/login"))},[$,q,R]),q)return t.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),t.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading TOEIC Admin..."})]})});if(!$)return null;const me=({test:e,skillCategory:s})=>t.jsxs(l,{className:"cursor-pointer hover:shadow-lg transition-shadow border-l-4 border-l-[#A68B5B] bg-[#FEF9E7] border-[#E8D5A3]",onClick:()=>!ee&&R(`/admin/toeic/${s.toLowerCase()}/${e.id}`),children:[t.jsxs(i,{className:"pb-2",children:[t.jsxs(n,{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:["Listening"===s?t.jsx(A,{className:"w-5 h-5 text-[#8B6914]"}):t.jsx(F,{className:"w-5 h-5 text-[#8B6914]"}),ee===e.id?t.jsxs("div",{className:"flex items-center space-x-2",onClick:e=>e.stopPropagation(),children:[t.jsx(d,{value:te,onChange:e=>ae(e.target.value),className:"text-lg font-semibold h-8 bg-white/50 border-[#E8D5A3]",onKeyPress:e=>"Enter"===e.key&&xe()}),t.jsx(o,{size:"sm",variant:"ghost",onClick:xe,children:t.jsx(L,{className:"w-4 h-4 text-green-600"})}),t.jsx(o,{size:"sm",variant:"ghost",onClick:oe,children:t.jsx(_,{className:"w-4 h-4 text-red-600"})})]}):t.jsx("span",{className:"text-[#5D4E37]",children:e.test_name})]}),ee!==e.id&&t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(o,{size:"sm",variant:"ghost",onClick:s=>{s.stopPropagation(),(e=>{se(e.id),ae(e.test_name)})(e)},children:t.jsx(O,{className:"w-4 h-4 text-[#8B6914]"})}),t.jsxs(f,{children:[t.jsx(N,{asChild:!0,children:t.jsx(o,{size:"sm",variant:"ghost",onClick:e=>e.stopPropagation(),children:t.jsx(Q,{className:"w-4 h-4 text-red-600"})})}),t.jsxs(E,{className:"z-50 bg-[#FEF9E7] border-[#E8D5A3]",children:[t.jsxs(v,{children:[t.jsx(w,{className:"text-[#5D4E37]",children:"Delete Test"}),t.jsxs(y,{className:"text-[#8B6914]",children:['Are you sure you want to delete "',e.test_name,'"? This will also delete all questions. This action cannot be undone.']})]}),t.jsxs(B,{children:[t.jsx(C,{className:"bg-white border-[#E8D5A3] text-[#5D4E37]",children:"Cancel"}),t.jsx(D,{onClick:()=>(async(e,s)=>{var t;try{const a=await fetch("https://cuumxmfzhwljylbdlflj.supabase.co/functions/v1/delete-test",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${null==(t=(await x.auth.getSession()).data.session)?void 0:t.access_token}`},body:JSON.stringify({testId:e})}),r=await a.json();if(!a.ok||r.error)throw new Error(r.error||"Failed to delete test");m.success(`Test "${s}" deleted successfully`),ce()}catch(a){console.error("Error deleting test:",a),m.error(a instanceof Error?a.message:"Failed to delete test")}})(e.id,e.test_name),className:"bg-red-600 hover:bg-red-700 text-white",children:"Delete"})]})]})]})]})]}),t.jsxs(h,{className:"text-[#8B6914]",children:["Created: ",new Date(e.created_at).toLocaleDateString()]})]}),t.jsxs(c,{children:[t.jsxs("div",{className:"flex items-center justify-between text-sm text-[#8B6914]",children:[t.jsx(r,{variant:"outline",className:"bg-[#FEF9E7] text-[#8B6914] border-[#E8D5A3]",children:s}),t.jsx("span",{children:"Listening"===s?"Parts 1-4 (100 Q)":e.test_subtype?`${e.test_subtype.replace("Part","Part ")} (${"Part5"===e.test_subtype?"30":"Part6"===e.test_subtype?"16":"54"} Q)`:"Parts 5-7"})]}),t.jsx(o,{size:"sm",className:"w-full mt-3 bg-[#A68B5B] hover:bg-[#8B6914] text-white",onClick:t=>{t.stopPropagation(),R(`/admin/toeic/${s.toLowerCase()}/${e.id}`)},disabled:ee===e.id,children:"Manage Test"})]})]},e.id);return t.jsx(T,{title:"TOEIC Administration",showBackButton:!0,backPath:"/admin",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold tracking-tight text-[#5D4E37]",children:"TOEIC Admin Portal"}),t.jsx("p",{className:"text-[#8B6914]",children:"Manage TOEIC Listening and Reading tests"})]}),t.jsx(r,{variant:"secondary",className:"text-sm bg-[#A68B5B] text-white",children:"TOEIC Module"})]}),t.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[t.jsxs(l,{className:"border-l-4 border-l-[#A68B5B] bg-[#FEF9E7] border-[#E8D5A3]",children:[t.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(n,{className:"text-sm font-medium text-[#5D4E37]",children:"Total Tests"}),t.jsx(P,{className:"h-4 w-4 text-[#8B6914]"})]}),t.jsxs(c,{children:[t.jsx("div",{className:"text-2xl font-bold text-[#5D4E37]",children:ie.totalTests}),t.jsx("p",{className:"text-xs text-[#8B6914]",children:"TOEIC practice tests"})]})]}),t.jsxs(l,{className:"border-l-4 border-l-[#C97D60] bg-[#FEF9E7] border-[#E8D5A3]",children:[t.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(n,{className:"text-sm font-medium text-[#5D4E37]",children:"Listening Tests"}),t.jsx(A,{className:"h-4 w-4 text-[#8B6914]"})]}),t.jsxs(c,{children:[t.jsx("div",{className:"text-2xl font-bold text-[#5D4E37]",children:ie.listeningTests}),t.jsx("p",{className:"text-xs text-[#8B6914]",children:"Parts 1-4 (100 questions each)"})]})]}),t.jsxs(l,{className:"border-l-4 border-l-[#8B6914] bg-[#FEF9E7] border-[#E8D5A3]",children:[t.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(n,{className:"text-sm font-medium text-[#5D4E37]",children:"Reading Tests"}),t.jsx(F,{className:"h-4 w-4 text-[#8B6914]"})]}),t.jsxs(c,{children:[t.jsx("div",{className:"text-2xl font-bold text-[#5D4E37]",children:ie.readingTests}),t.jsx("p",{className:"text-xs text-[#8B6914]",children:"Parts 5-7 (100 questions each)"})]})]}),t.jsxs(l,{className:"border-l-4 border-l-[#5D4E37] bg-[#FEF9E7] border-[#E8D5A3]",children:[t.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(n,{className:"text-sm font-medium text-[#5D4E37]",children:"TOEIC Structure"}),t.jsx(k,{className:"h-4 w-4 text-[#8B6914]"})]}),t.jsxs(c,{children:[t.jsx("div",{className:"text-2xl font-bold text-[#5D4E37]",children:"200"}),t.jsx("p",{className:"text-xs text-[#8B6914]",children:"Questions per full test"})]})]})]}),t.jsxs(l,{className:"bg-[#FEF9E7] border-[#E8D5A3]",children:[t.jsx(i,{children:t.jsx(n,{className:"text-[#5D4E37]",children:"TOEIC Test Structure"})}),t.jsx(c,{children:t.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsxs("h4",{className:"font-semibold flex items-center gap-2 mb-3 text-[#5D4E37]",children:[t.jsx(A,{className:"w-4 h-4 text-[#8B6914]"}),"Listening (45 min, 100 Q)"]}),t.jsxs("ul",{className:"space-y-2 text-sm text-[#8B6914]",children:[t.jsxs("li",{className:"flex justify-between",children:[t.jsx("span",{children:"Part 1: Photos"}),t.jsx("span",{className:"font-medium text-[#5D4E37]",children:"6 Q"})]}),t.jsxs("li",{className:"flex justify-between",children:[t.jsx("span",{children:"Part 2: Question-Response"}),t.jsx("span",{className:"font-medium text-[#5D4E37]",children:"25 Q"})]}),t.jsxs("li",{className:"flex justify-between",children:[t.jsx("span",{children:"Part 3: Conversations"}),t.jsx("span",{className:"font-medium text-[#5D4E37]",children:"39 Q"})]}),t.jsxs("li",{className:"flex justify-between",children:[t.jsx("span",{children:"Part 4: Talks"}),t.jsx("span",{className:"font-medium text-[#5D4E37]",children:"30 Q"})]})]})]}),t.jsxs("div",{children:[t.jsxs("h4",{className:"font-semibold flex items-center gap-2 mb-3 text-[#5D4E37]",children:[t.jsx(F,{className:"w-4 h-4 text-[#8B6914]"}),"Reading (75 min, 100 Q)"]}),t.jsxs("ul",{className:"space-y-2 text-sm text-[#8B6914]",children:[t.jsxs("li",{className:"flex justify-between",children:[t.jsx("span",{children:"Part 5: Incomplete Sentences"}),t.jsx("span",{className:"font-medium text-[#5D4E37]",children:"40 Q"})]}),t.jsxs("li",{className:"flex justify-between",children:[t.jsx("span",{children:"Part 6: Text Completion"}),t.jsx("span",{className:"font-medium text-[#5D4E37]",children:"12 Q"})]}),t.jsxs("li",{className:"flex justify-between",children:[t.jsx("span",{children:"Part 7: Reading Comprehension"}),t.jsx("span",{className:"font-medium text-[#5D4E37]",children:"48 Q"})]})]})]})]})})]}),t.jsx(b,{className:"bg-[#E8D5A3]"}),t.jsxs(j,{value:re,onValueChange:le,className:"space-y-4",children:[t.jsxs(g,{className:"grid w-full grid-cols-2 bg-[#E8D5A3]/20 border border-[#E8D5A3]",children:[t.jsxs(u,{value:"listening",className:"flex items-center gap-2 data-[state=active]:bg-[#FEF9E7] data-[state=active]:text-[#5D4E37] text-[#8B6914]",children:[t.jsx(A,{className:"w-4 h-4"}),"Listening Tests"]}),t.jsxs(u,{value:"reading",className:"flex items-center gap-2 data-[state=active]:bg-[#FEF9E7] data-[state=active]:text-[#5D4E37] text-[#8B6914]",children:[t.jsx(F,{className:"w-4 h-4"}),"Reading Tests"]})]}),t.jsx(p,{value:"listening",className:"space-y-4",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-xl font-semibold text-[#5D4E37]",children:"TOEIC Listening Tests"}),t.jsx("p",{className:"text-[#8B6914]",children:"Parts 1-4: Photos, Question-Response, Conversations, Talks"})]}),t.jsxs("div",{className:"flex gap-3 items-end",children:[t.jsx(d,{placeholder:"Test name (e.g., TOEIC Listening Test 1)",value:Y,onChange:e=>G(e.target.value),onKeyPress:e=>"Enter"===e.key&&de("Listening"),className:"max-w-sm bg-white/50 border-[#E8D5A3] focus:border-[#8B6914] focus:ring-[#8B6914]"}),t.jsxs(o,{onClick:()=>de("Listening"),disabled:U,className:"bg-[#A68B5B] hover:bg-[#8B6914] text-white",children:[t.jsx(I,{className:"w-4 h-4 mr-2"}),U?"Creating...":"Create Test"]})]})]}),z.length>0?t.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:z.map(e=>t.jsx(me,{test:e,skillCategory:"Listening"},e.id))}):t.jsx(l,{className:"border-dashed border-[#E8D5A3] bg-[#FEF9E7]/50",children:t.jsxs(c,{className:"flex flex-col items-center justify-center py-12",children:[t.jsx(A,{className:"w-12 h-12 text-[#A68B5B] mb-4"}),t.jsx("h3",{className:"text-lg font-semibold mb-2 text-[#5D4E37]",children:"No Listening tests yet"}),t.jsx("p",{className:"text-[#8B6914] mb-4 text-center",children:"Create your first TOEIC Listening test with Parts 1-4"}),t.jsxs("div",{className:"flex gap-3 items-center",children:[t.jsx(d,{placeholder:"Test name",value:Y,onChange:e=>G(e.target.value),className:"max-w-xs bg-white/50 border-[#E8D5A3]"}),t.jsx(o,{onClick:()=>de("Listening"),className:"bg-[#A68B5B] hover:bg-[#8B6914] text-white",children:"Create First Test"})]})]})})]})}),t.jsx(p,{value:"reading",className:"space-y-4",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-xl font-semibold text-[#5D4E37]",children:"TOEIC Reading Tests"}),t.jsx("p",{className:"text-[#8B6914]",children:"Create separate tests for Part 5, 6, or 7"})]}),t.jsxs("div",{className:"flex gap-3 items-end flex-wrap",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx("label",{className:"text-xs text-[#8B6914] font-medium",children:"Select Part *"}),t.jsxs("select",{value:X,onChange:e=>Z(e.target.value),className:"h-10 px-3 rounded-md border border-[#E8D5A3] bg-white/50 text-[#5D4E37] focus:border-[#8B6914] focus:ring-[#8B6914] focus:outline-none",children:[t.jsx("option",{value:"Part5",children:"Part 5 - Incomplete Sentences (30 Q)"}),t.jsx("option",{value:"Part6",children:"Part 6 - Text Completion (16 Q)"}),t.jsx("option",{value:"Part7",children:"Part 7 - Reading Comprehension (54 Q)"})]})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("label",{className:"text-xs text-[#8B6914] font-medium",children:"Test Name"}),t.jsx(d,{placeholder:`e.g., TOEIC ${X.replace("Part","Part ")} - Test 1`,value:H,onChange:e=>W(e.target.value),onKeyPress:e=>"Enter"===e.key&&de("Reading"),className:"w-64 bg-white/50 border-[#E8D5A3] focus:border-[#8B6914] focus:ring-[#8B6914]"})]}),t.jsxs(o,{onClick:()=>de("Reading"),disabled:U,className:"bg-[#A68B5B] hover:bg-[#8B6914] text-white",children:[t.jsx(I,{className:"w-4 h-4 mr-2"}),U?"Creating...":"Create Test"]})]})]}),K.length>0?t.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:K.map(e=>t.jsx(me,{test:e,skillCategory:"Reading"},e.id))}):t.jsx(l,{className:"border-dashed border-[#E8D5A3] bg-[#FEF9E7]/50",children:t.jsxs(c,{className:"flex flex-col items-center justify-center py-12",children:[t.jsx(F,{className:"w-12 h-12 text-[#A68B5B] mb-4"}),t.jsx("h3",{className:"text-lg font-semibold mb-2 text-[#5D4E37]",children:"No Reading tests yet"}),t.jsx("p",{className:"text-[#8B6914] mb-4 text-center",children:"Create separate tests for Part 5, 6, or 7"}),t.jsxs("div",{className:"flex gap-3 items-center flex-wrap justify-center",children:[t.jsxs("select",{value:X,onChange:e=>Z(e.target.value),className:"h-10 px-3 rounded-md border border-[#E8D5A3] bg-white/50 text-[#5D4E37]",children:[t.jsx("option",{value:"Part5",children:"Part 5"}),t.jsx("option",{value:"Part6",children:"Part 6"}),t.jsx("option",{value:"Part7",children:"Part 7"})]}),t.jsx(d,{placeholder:"Test name",value:H,onChange:e=>W(e.target.value),className:"max-w-xs bg-white/50 border-[#E8D5A3]"}),t.jsx(o,{onClick:()=>de("Reading"),className:"bg-[#A68B5B] hover:bg-[#8B6914] text-white",children:"Create First Test"})]})]})})]})})]}),t.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-6",children:[t.jsxs(l,{className:"border-2 border-dashed border-[#E8D5A3] bg-[#FEF9E7] hover:bg-[#FDF6E3] transition-colors",children:[t.jsx(i,{children:t.jsxs(n,{className:"flex items-center gap-2 text-lg text-[#5D4E37]",children:[t.jsx(S,{className:"w-5 h-5 text-[#8B6914]"}),"AI Screenshot Parsing"]})}),t.jsx(c,{children:t.jsx("p",{className:"text-sm text-[#8B6914]",children:"Upload screenshots of TOEIC tests and let AI extract questions automatically. Supports all question types including passages with multiple questions."})})]}),t.jsxs(l,{className:"border-2 border-dashed border-[#E8D5A3] bg-[#FEF9E7] hover:bg-[#FDF6E3] transition-colors",children:[t.jsx(i,{children:t.jsxs(n,{className:"flex items-center gap-2 text-lg text-[#5D4E37]",children:[t.jsx(P,{className:"w-5 h-5 text-[#8B6914]"}),"Copy-Paste Import"]})}),t.jsx(c,{children:t.jsx("p",{className:"text-sm text-[#8B6914]",children:"Paste questions directly from text. AI will parse the format and create structured questions with options. Perfect for Part 5 & 6."})})]})]})]})})};export{R as default};
