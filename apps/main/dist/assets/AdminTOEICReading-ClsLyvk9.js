import{c as e,u as s,G as t,w as a,r,J as n,j as i,l as o,C as l,b as c,d,a as m,K as u,L as x,y as h,F as g,U as p,R as b,B as j,I as v,T as w,x as N,S as f,p as q,q as E,s as _,t as y,N as A,E as B,P as D,O as C,Q as k,k as P,e as S}from"./index-cMzFjQ8t.js";import{T as F,a as T,b as I,c as Q}from"./tabs-B9SqgW5L.js";import{A as z}from"./AdminLayout-BeDwyTOk.js";import{I as O}from"./ImageQuestionExtractor-BDMSfsVe.js";import{s as $}from"./supabase-DWL4C3fA.js";import{I as M}from"./image-R1sdBsGA.js";import{T as U}from"./trash-2-CQVGDljD.js";import{U as R}from"./upload-DjGQmJlB.js";import{W as G}from"./wand-sparkles-NQDvefd9.js";import{C as V}from"./circle-alert-DJHu9Q9b.js";import{L}from"./list-d5T8sTBz.js";import{L as K}from"./layout-grid-R4y9IkKZ.js";import{S as H}from"./save-VwNzo7EO.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=e("AlignLeft",[["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M17 18H3",key:"1amg6g"}],["path",{d:"M21 6H3",key:"1jwq7v"}]]),J=e("Newspaper",[["path",{d:"M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-2 2Zm0 0a2 2 0 0 1-2-2v-9c0-1.1.9-2 2-2h2",key:"7pis2x"}],["path",{d:"M18 14h-8",key:"sponae"}],["path",{d:"M15 18h-5",key:"95g1m2"}],["path",{d:"M10 6h8v4h-8V6Z",key:"smlsk5"}]]),W=[{number:5,name:"Incomplete Sentences",questions:40,description:"Choose the word or phrase that best completes the sentence",icon:Z,hasPassages:!1},{number:6,name:"Text Completion",questions:12,description:"Complete passages with missing words or sentences",icon:g,hasPassages:!0},{number:7,name:"Reading Comprehension",questions:48,description:"Read passages and answer questions about them",icon:J,hasPassages:!0}],X=()=>{const e=s(),{testId:Z}=t(),{admin:J,loading:X}=a(),[Y,ee]=r.useState(""),[se,te]=r.useState("5"),[ae,re]=r.useState("paste"),[ne,ie]=r.useState(!1),[oe,le]=r.useState(!1),[ce,de]=r.useState(!1),[me,ue]=r.useState(!1),[xe,he]=r.useState(0),[ge,pe]=r.useState("list"),[be,je]=r.useState(2),[ve,we]=r.useState(""),[Ne,fe]=r.useState(""),[qe,Ee]=r.useState(""),[_e,ye]=r.useState(!1),[Ae,Be]=r.useState({5:{questions:[],passages:[],saved:!1},6:{questions:[],passages:[],saved:!1},7:{questions:[],passages:[],saved:!1}});r.useEffect(()=>{X||J||e("/admin/login")},[J,X,e]),r.useEffect(()=>{Z&&De()},[Z]);const De=async()=>{if(Z)try{const{data:e,error:s}=await $.from("tests").select("*").eq("id",Z).single();if(s)throw s;ee(e.test_name);const{data:t,error:a}=await $.from("questions").select("*").eq("test_id",Z).order("question_number_in_part",{ascending:!0});if(a)throw a;const{data:r,error:n}=await $.from("toeic_passages").select("*").eq("test_id",Z).order("question_range_start",{ascending:!0}),i={5:{questions:[],passages:[],saved:!1},6:{questions:[],passages:[],saved:!1},7:{questions:[],passages:[],saved:!1}};null==t||t.forEach(e=>{const s=e.toeic_part||5;i[s]&&i[s].questions.push({id:e.id,question_number:e.question_number_in_part,question_text:e.question_text,question_type:e.question_type,options:e.choices?JSON.parse(e.choices):null,correct_answer:e.correct_answer,explanation:e.explanation||"",ai_explanation:e.ai_explanation,toeic_part:s,passage_context:e.passage_context,related_passage_id:e.related_passage_id})}),null==r||r.forEach(e=>{const s=e.part_number;i[s]&&i[s].passages.push({id:e.id,title:e.passage_title,content:e.passage_content,type:e.passage_type,imageUrl:e.passage_image_url,questionStart:e.question_range_start,questionEnd:e.question_range_end})}),Be(i)}catch(e){console.error("Error loading test data:",e),n.error("Failed to load test data")}},Ce=e=>{switch(e){case 5:return"incomplete_sentence";case 6:return"text_completion";case 7:return"reading_comprehension";default:return"multiple_choice"}},ke=async e=>{de(!0);try{const s=Ae[e].questions,{data:t,error:a}=await $.functions.invoke("toeic-generate-explanations",{body:{questions:s.map(s=>({question_number:s.question_number,question_text:s.question_text,options:s.options,correct_answer:s.correct_answer,passage_context:s.passage_context,part:e})),testType:"TOEIC Reading",part:e}});if(a)throw a;if(t.explanations){const a=s.map((e,s)=>({...e,ai_explanation:t.explanations[s]||e.ai_explanation}));Be(s=>({...s,[e]:{...s[e],questions:a,saved:!1}})),n.success("AI explanations generated!")}}catch(s){console.error("Error generating explanations:",s),n.error("Failed to generate AI explanations")}finally{de(!1)}},Pe=(e,s,t,a)=>{Be(r=>{const n=[...r[e].questions];return n[s]={...n[s],[t]:a},{...r,[e]:{...r[e],questions:n,saved:!1}}})},Se=(e,s)=>{Be(t=>{const a=t[e].questions.filter((e,t)=>t!==s);return{...t,[e]:{...t[e],questions:a,saved:!1}}})},Fe=e=>{const s=Ae[e].questions.length,t={question_number:s+1,question_text:"",question_type:Ce(e),options:["","","",""],correct_answer:"",explanation:"",toeic_part:e};Be(s=>({...s,[e]:{...s[e],questions:[...s[e].questions,t],saved:!1}})),he(s),ue(!0),n.success(`Question ${s+1} added - ready to edit!`)},Te=e=>{var s;const t=(null==(s=W.find(s=>s.number===e))?void 0:s.questions)||0,a=Ae[e].questions.length;return{current:a,expected:t,percentage:t>0?a/t*100:0}};return X?i.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):i.jsx(z,{title:"TOEIC Reading Test",showBackButton:!0,backPath:"/admin/toeic",children:i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold text-[#5D4E37]",children:Y||"TOEIC Reading Test"}),i.jsx("p",{className:"text-[#8B6914]",children:"Manage Parts 5-7 (100 questions total)"})]}),i.jsx(o,{variant:"outline",className:"bg-[#FEF9E7] text-[#8B6914] border-[#E8D5A3]",children:"TOEIC Reading"})]}),i.jsxs(l,{className:"bg-[#FEF9E7] border-[#E8D5A3]",children:[i.jsx(c,{children:i.jsx(d,{className:"text-lg text-[#5D4E37]",children:"Question Progress"})}),i.jsx(m,{children:i.jsx("div",{className:"grid grid-cols-3 gap-4",children:W.map(e=>{const s=Te(e.number),t=e.icon;return i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex items-center justify-between text-sm",children:[i.jsxs("span",{className:"flex items-center gap-1 text-[#5D4E37]",children:[i.jsx(t,{className:"w-4 h-4 text-[#8B6914]"}),"Part ",e.number]}),i.jsxs("span",{className:"text-[#8B6914]",children:[s.current,"/",s.expected]})]}),i.jsx(u,{value:s.percentage,className:"h-2 bg-[#E8D5A3]"})]},e.number)})})})]}),i.jsxs(F,{value:se,onValueChange:e=>{te(e);const s=parseInt(e);re(6===s||7===s?"passage":"paste")},children:[i.jsx(T,{className:"grid grid-cols-3 w-full bg-[#E8D5A3]/20 border border-[#E8D5A3]",children:W.map(e=>{const s=Te(e.number),t=e.icon;return i.jsxs(I,{value:String(e.number),className:"flex items-center gap-2 data-[state=active]:bg-[#FEF9E7] data-[state=active]:text-[#5D4E37] text-[#8B6914]",children:[i.jsx(t,{className:"w-4 h-4"}),i.jsxs("span",{className:"hidden sm:inline",children:["Part ",e.number]}),i.jsxs("span",{className:"sm:hidden",children:["P",e.number]}),s.current===s.expected&&s.expected>0&&i.jsx(x,{className:"w-3 h-3 text-green-500"})]},e.number)})}),W.map(e=>{var s,t,a,r,u,z,J,W,X,Y,ee,se;return i.jsxs(Q,{value:String(e.number),className:"space-y-6",children:[i.jsxs(l,{className:"bg-[#FEF9E7] border-[#E8D5A3]",children:[i.jsxs(c,{children:[i.jsxs(d,{className:"flex items-center gap-2 text-[#5D4E37]",children:[i.jsx(e.icon,{className:"w-5 h-5 text-[#8B6914]"}),"Part ",e.number,": ",e.name]}),i.jsx(h,{className:"text-[#8B6914]",children:e.description})]}),i.jsx(m,{children:i.jsxs("p",{className:"text-sm text-[#8B6914]",children:["Expected questions: ",i.jsx("span",{className:"font-semibold text-[#5D4E37]",children:e.questions})]})})]}),i.jsxs(l,{className:"bg-[#FEF9E7] border-[#E8D5A3]",children:[i.jsx(c,{children:i.jsx(d,{className:"text-lg text-[#5D4E37]",children:"Add Questions"})}),i.jsx(m,{children:i.jsxs(F,{value:ae,onValueChange:e=>re(e),children:[i.jsxs(T,{className:"grid w-full mb-4 bg-[#E8D5A3]/20 border border-[#E8D5A3] "+(e.hasPassages?"grid-cols-4":"grid-cols-3"),children:[e.hasPassages&&i.jsxs(I,{value:"passage",className:"flex items-center gap-2 data-[state=active]:bg-[#FEF9E7] data-[state=active]:text-[#5D4E37] text-[#8B6914]",children:[i.jsx(g,{className:"w-4 h-4"}),"Passage"]}),i.jsxs(I,{value:"paste",className:"flex items-center gap-2 data-[state=active]:bg-[#FEF9E7] data-[state=active]:text-[#5D4E37] text-[#8B6914]",children:[i.jsx(p,{className:"w-4 h-4"}),e.hasPassages?"Questions":"Paste Text"]}),i.jsxs(I,{value:"image",className:"flex items-center gap-2 data-[state=active]:bg-[#FEF9E7] data-[state=active]:text-[#5D4E37] text-[#8B6914]",children:[i.jsx(M,{className:"w-4 h-4"}),"Extract from Image"]}),i.jsxs(I,{value:"answers",className:"flex items-center gap-2 data-[state=active]:bg-[#FEF9E7] data-[state=active]:text-[#5D4E37] text-[#8B6914]",children:[i.jsx(x,{className:"w-4 h-4"}),"Answer Key"]})]}),e.hasPassages&&i.jsxs(Q,{value:"passage",className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx(b,{className:"text-[#5D4E37]",children:"Upload Passage Image"}),i.jsx("p",{className:"text-sm text-[#8B6914] mb-3",children:"Upload the passage image (letter, email, notice, etc.) - students will see this exact image"}),(null==(s=Ae[e.number].passages[0])?void 0:s.imageUrl)&&i.jsxs("div",{className:"mb-4 relative",children:[i.jsx("img",{src:Ae[e.number].passages[0].imageUrl,alt:"Passage",className:"max-w-full rounded-lg border-2 border-[#E8D5A3] shadow-md"}),i.jsx(j,{variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:()=>{Be(s=>({...s,[e.number]:{...s[e.number],passages:s[e.number].passages.map(e=>({...e,imageUrl:void 0})),saved:!1}})),Ee("")},children:i.jsx(U,{className:"w-4 h-4"})})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("label",{className:"cursor-pointer",children:[i.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:s=>(async(e,s)=>{var t;const a=null==(t=e.target.files)?void 0:t[0];if(a){ye(!0);try{const e=new FileReader;e.onloadend=()=>{const t=e.result;Ee(t);const a=Ae[s].passages[0],r=a?{...a,imageUrl:t}:{title:"",content:"",type:"single",imageUrl:t,questionStart:6===s?131:147,questionEnd:6===s?134:152};Be(e=>({...e,[s]:{...e[s],passages:[r],saved:!1}})),n.success("Passage image uploaded! Now add questions below.")},e.readAsDataURL(a)}catch(r){console.error("Error uploading image:",r),n.error("Failed to upload image")}finally{ye(!1)}}})(s,e.number),disabled:_e}),i.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-[#A68B5B] hover:bg-[#8B6914] text-white rounded-lg transition-colors",children:[i.jsx(R,{className:"w-4 h-4"}),_e?"Uploading...":"Choose Image"]})]}),i.jsx("span",{className:"text-sm text-[#8B6914]",children:"Supported: JPG, PNG, WebP"})]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t border-[#E8D5A3]",children:[i.jsxs("div",{children:[i.jsx(b,{className:"text-[#5D4E37]",children:"First Question #"}),i.jsx(v,{type:"number",value:(null==(t=Ae[e.number].passages[0])?void 0:t.questionStart)||(6===e.number?131:147),onChange:s=>{const t=parseInt(s.target.value)||131;Be(s=>({...s,[e.number]:{...s[e.number],passages:[{...s[e.number].passages[0]||{content:"",type:"single",questionEnd:t+3},questionStart:t}],saved:!1}}))},className:"bg-white border-[#E8D5A3]"})]}),i.jsxs("div",{children:[i.jsx(b,{className:"text-[#5D4E37]",children:"Last Question #"}),i.jsx(v,{type:"number",value:(null==(a=Ae[e.number].passages[0])?void 0:a.questionEnd)||(6===e.number?134:152),onChange:s=>{const t=parseInt(s.target.value)||134;Be(s=>({...s,[e.number]:{...s[e.number],passages:[{...s[e.number].passages[0]||{content:"",type:"single",questionStart:t-3},questionEnd:t}],saved:!1}}))},className:"bg-white border-[#E8D5A3]"})]})]})]}),i.jsxs(Q,{value:"paste",className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx(b,{className:"text-[#5D4E37]",children:6===e.number?"Paste Full Passage with Questions":"Paste TOEIC Questions"}),i.jsx("p",{className:"text-sm text-[#8B6914] mb-2",children:6===e.number?"Paste the complete passage including title, text, and inline questions (147. (A)... format)":"Paste questions in standard TOEIC format. Questions will be parsed automatically."}),i.jsx(w,{value:ve,onChange:e=>we(e.target.value),placeholder:6===e.number?"Promoting Cycling in our City\n\nAn essential element of the transportation system in many of the cities around the world is cycling. The city of Buffalo recognizes this and has developed a 10-year plan to promote more cycling in our city.\n\nThe city's development plan includes the addition of more cycling -------- to our streets.\n147. (A) admission\n(B) entrance\n(C) access\n(D) pass\n\nThis, of course, is with the intention of encouraging greater cycling -------- by our citizens...\n148. (A) participate\n(B) participation\n(C) participates\n(D) participated":"101. ------- you want to receive additional\ninformation regarding the services we\noffer, please log onto our website.\n(A) If\n(B) For\n(C) Despite\n(D) Whether\n\n102. Sandy Duncan was handpicked by the\ngeneral manager because of ------- experience.\n(A) her\n(B) hers\n(C) herself\n(D) she",rows:6===e.number?16:12,className:"font-mono text-sm bg-white border-[#E8D5A3] focus:border-[#8B6914] focus:ring-[#8B6914] text-[#5D4E37] placeholder:text-[#A68B5B]"})]}),i.jsxs(j,{onClick:()=>6===e.number?(e=>{if(ve.trim()){le(!0);try{const s=ve.trim().split("\n");let t="",a=0;for(let e=0;e<s.length;e++){const r=s[e].trim();if(r){r.length<100&&!r.match(/\d+\.\s*\(A\)/)&&(t=r,a=e+1);break}}const r=s.slice(a).join("\n"),i=/(\d{1,3})\.\s*\(A\)\s*([^\n(]+)\s*\(B\)\s*([^\n(]+)\s*\(C\)\s*([^\n(]+)\s*\(D\)\s*([^\n(]+)/g,o=[];let l;for(;null!==(l=i.exec(r));){const[s,t,a,n,i,c]=l,d=parseInt(t),m=r.substring(0,l.index).split(new RegExp("(?<=[.!?])\\s+")).slice(-2).join(" "),u=m.match(/[^.!?]*-{4,}[^.!?]*/),x=u?u[0].trim():m.trim();o.push({question_number:d,question_text:x||`Question ${d}`,question_type:"text_completion",options:[a.trim(),n.trim(),i.trim(),c.trim()],correct_answer:"",explanation:"",toeic_part:e,passage_context:r})}if(o.length>0){const s={title:t,content:r,type:"single",questionStart:o[0].question_number,questionEnd:o[o.length-1].question_number};Be(t=>({...t,[e]:{...t[e],questions:[...t[e].questions,...o],passages:[...t[e].passages,s],saved:!1}})),we(""),n.success(`Parsed passage with ${o.length} questions (${t||"Untitled"})`)}else n.error("No questions found. Make sure format is: 147. (A) option (B) option (C) option (D) option")}catch(s){console.error("Error parsing Part 6:",s),n.error("Failed to parse passage")}finally{le(!1)}}else n.error("Please enter passage text to parse")})(e.number):(e=>{if(ve.trim()){le(!0);try{let s=ve.replace(/\r\n/g,"\n").replace(/\n+/g," ").replace(/\s+/g," ").trim();[/TEST\d+\([A-D]\)[^(]*/gi,/KOD ON:[^\n]*/gi,/GO ON TO THE NEXT PAGE/gi,/NEXT PAGE/gi,/PAGE \d+/gi,/\bPART \d+\b(?!\.\s)/gi].forEach(e=>{s=s.replace(e," ")}),s=s.replace(/\s+/g," ").trim(),console.log("Normalized text:",s.substring(0,300)+"...");const t=[],a=/(\d{1,3})\.\s*([\s\S]*?)\s*\(A\)\s*([\s\S]*?)\s*\(B\)\s*([\s\S]*?)\s*\(C\)\s*([\s\S]*?)\s*\(D\)\s*([\s\S]*?)(?=\d{1,3}\.\s*[A-Z]|\d{1,3}\.\s*[a-z]|$)/g;let r;const i=[];for(;null!==(r=a.exec(s));){const[e,s,t,a,n,o,l]=r;i.push({num:parseInt(s),qText:t.trim(),optA:a.trim(),optB:n.trim(),optC:o.trim(),optD:l.trim(),fullMatch:e})}console.log("Found raw matches:",i.length);for(let n=0;n<i.length;n++){const s=i[n];let{num:a,qText:r,optA:o,optB:l,optC:c,optD:d}=s;const m=/(\d{1,3})\.\s+/g;let u,x=r;for(;null!==(u=m.exec(r));){const e=parseInt(u[1]);Math.abs(e-a)<=5&&e!==a&&(console.log(`Fixing continuation issue: removing "${u[0]}" from Q${a}`),x=x.replace(u[0]," "))}r=x.replace(/\s+/g," ").trim();const h=[/\s+\d{1,3}\.\s+.*/,/\s+[A-Z][a-z]+\s+[a-z]+\s+[a-z]+.*$/,/\s+TEST\d+.*/i,/\s+KOD\s+ON.*/i];let g=d;const p=g.match(/\s+([A-Z][a-z]+(?:\s+[a-z]+){3,})/);if(p&&void 0!==p.index&&(g=g.substring(0,p.index).trim()),h.forEach(e=>{g=g.replace(e,"")}),g=g.trim(),g.length>50){const e=g.split(/\s+/);g=e[0]}console.log(`Q${a}:`,{qText:r.substring(0,50)+(r.length>50?"...":""),optA:o,optB:l,optC:c,optD:g}),r&&r.length>5&&o&&l&&c&&g?t.push({question_number:a,question_text:r,question_type:Ce(e),options:[o,l,c,g],correct_answer:"",explanation:"",toeic_part:e}):console.log(`Q${a}: Invalid question, skipping`,{qText:r,optA:o,optB:l,optC:c,cleanOptD:g})}t.sort((e,s)=>e.question_number-s.question_number);const o=t.filter((e,s,t)=>0===s||e.question_number!==t[s-1].question_number);o.length>0?(Be(s=>({...s,[e]:{...s[e],questions:[...s[e].questions,...o],saved:!1}})),we(""),n.success(`${o.length} questions parsed successfully!`)):n.error("No questions could be parsed. Check format: 101. question text (A) opt (B) opt (C) opt (D) opt")}catch(s){console.error("Error parsing questions:",s),n.error("Failed to parse questions")}finally{le(!1)}}else n.error("Please enter question text to parse")})(e.number),disabled:oe||!ve.trim(),className:"bg-[#A68B5B] hover:bg-[#8B6914] text-white",children:[i.jsx(G,{className:"w-4 h-4 mr-2"}),oe?"Parsing...":6===e.number?"Parse Passage":"Parse Questions"]})]}),i.jsx(Q,{value:"image",children:i.jsx(O,{testId:Z||"",testType:"TOEIC",onQuestionsExtracted:s=>((e,s)=>{const t=s.map((s,t)=>({question_number:s.question_number||Ae[e].questions.length+t+1,question_text:s.question_text,question_type:s.question_type||Ce(e),options:s.options,correct_answer:s.correct_answer||"",explanation:s.explanation||"",toeic_part:e,passage_context:s.passage_context}));Be(s=>({...s,[e]:{...s[e],questions:[...s[e].questions,...t],saved:!1}})),n.success(`${s.length} questions extracted for Part ${e}`)})(e.number,s)})}),i.jsxs(Q,{value:"answers",className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx(b,{className:"text-[#5D4E37]",children:"Paste Answer Key"}),i.jsx("p",{className:"text-sm text-[#8B6914] mb-2",children:'Paste answer key in format: "101. (A) 102. (B) 103. (C)..."'}),i.jsx(w,{value:Ne,onChange:e=>fe(e.target.value),placeholder:"101. (A) 102. (A) 103. (C) 104. (C) 105. (D) 106. (A) 107. (D) 108. (B) 109. (A) 110. (B)\n111. (A) 112. (C) 113. (A) 114. (D) 115. (B) 116. (A) 117. (A) 118. (C) 119. (A) 120. (C)",rows:6,className:"font-mono text-sm bg-white/50 border-[#E8D5A3] focus:border-[#8B6914] focus:ring-[#8B6914]"})]}),i.jsxs(j,{onClick:()=>(async e=>{if(Ne.trim()){le(!0);try{const{data:s,error:t}=await $.functions.invoke("toeic-parse-answers",{body:{text:Ne,part:e}});if(t)throw t;if(s.answers){const t=Ae[e].questions.map(e=>{const t=s.answers.find(s=>s.question_number===e.question_number);return t?{...e,correct_answer:t.answer}:e});Be(s=>({...s,[e]:{...s[e],questions:t,saved:!1}})),fe(""),n.success(`${Object.keys(s.answers).length} answers matched!`)}}catch(s){console.error("Error parsing answers:",s),n.error("Failed to parse answer key")}finally{le(!1)}}else n.error("Please enter answer key text")})(e.number),disabled:oe||!Ne.trim()||0===Ae[e.number].questions.length,className:"bg-[#A68B5B] hover:bg-[#8B6914] text-white",children:[i.jsx(x,{className:"w-4 h-4 mr-2"}),oe?"Matching...":"Match Answers"]}),0===Ae[e.number].questions.length&&i.jsx("p",{className:"text-sm text-amber-600",children:"Add questions first before matching answer keys."})]})]})})]}),i.jsxs(l,{className:"bg-[#FEF9E7] border-[#E8D5A3]",children:[i.jsx(c,{children:i.jsxs("div",{className:"flex flex-col gap-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(d,{className:"text-[#5D4E37]",children:"Questions"}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsxs(o,{className:"bg-[#A68B5B] text-white",children:[Ae[e.number].questions.length," / ",e.questions]}),Ae[e.number].questions.filter(e=>e.correct_answer).length>0&&i.jsxs(o,{variant:"outline",className:"border-green-500 text-green-600 flex items-center gap-1",children:[i.jsx(N,{className:"w-3 h-3"}),Ae[e.number].questions.filter(e=>e.correct_answer).length," answered"]}),Ae[e.number].questions.filter(e=>!e.correct_answer).length>0&&i.jsxs(o,{variant:"outline",className:"border-amber-500 text-amber-600 flex items-center gap-1",children:[i.jsx(V,{className:"w-3 h-3"}),Ae[e.number].questions.filter(e=>!e.correct_answer).length," missing answers"]})]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("div",{className:"flex items-center border border-[#E8D5A3] rounded-lg overflow-hidden",children:[i.jsx(j,{variant:"ghost",size:"sm",onClick:()=>{pe("list"),ue(!1)},className:"rounded-none px-3 "+("list"!==ge||me?"text-[#5D4E37]":"bg-[#A68B5B] text-white"),title:"List View - Edit one question at a time",children:i.jsx(L,{className:"w-4 h-4"})}),i.jsx(j,{variant:"ghost",size:"sm",onClick:()=>{pe("grid"),ue(!1)},className:"rounded-none px-3 "+("grid"!==ge||me?"text-[#5D4E37]":"bg-[#A68B5B] text-white"),title:"Grid View - See multiple questions",children:i.jsx(K,{className:"w-4 h-4"})})]}),"grid"===ge&&!me&&i.jsxs(f,{value:String(be),onValueChange:e=>je(Number(e)),children:[i.jsx(q,{className:"w-24 h-8 bg-white border-[#E8D5A3] text-sm",children:i.jsx(E,{})}),i.jsxs(_,{children:[i.jsx(y,{value:"2",children:"2 columns"}),i.jsx(y,{value:"3",children:"3 columns"}),i.jsx(y,{value:"4",children:"4 columns"}),i.jsx(y,{value:"6",children:"6 columns"})]})]}),me&&i.jsx(o,{variant:"outline",className:"border-blue-400 text-blue-600 bg-blue-50",children:"Preview Mode"})]})]}),i.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.jsxs(j,{variant:"outline",size:"sm",onClick:()=>{ue(!me),he(0)},className:`border-[#E8D5A3] ${me?"bg-[#A68B5B] text-white":"text-[#5D4E37]"} hover:bg-[#E8D5A3]/20`,disabled:0===Ae[e.number].questions.length,children:[me?i.jsx(A,{className:"w-4 h-4 mr-1"}):i.jsx(B,{className:"w-4 h-4 mr-1"}),me?"Exit Preview":"Student Preview"]}),i.jsxs(j,{variant:"outline",size:"sm",onClick:()=>Fe(e.number),className:"border-[#E8D5A3] text-[#5D4E37] hover:bg-[#E8D5A3]/20",children:[i.jsx(D,{className:"w-4 h-4 mr-1"}),"Add Question"]}),i.jsxs(j,{variant:"outline",size:"sm",onClick:()=>ke(e.number),disabled:ce||0===Ae[e.number].questions.length,className:"border-[#E8D5A3] text-[#5D4E37] hover:bg-[#E8D5A3]/20",children:[i.jsx(C,{className:"w-4 h-4 mr-1"}),ce?"Generating...":"AI Explanations"]}),i.jsxs(j,{size:"sm",onClick:()=>(async e=>{if(Z){ie(!0);try{const s=Ae[e].questions,t=Ae[e].passages,{data:a,error:r}=await $.functions.invoke("save-reading-test",{body:{mode:"toeic",testId:Z,part:e,questions:s.map((e,s)=>({question_number:e.question_number||s+1,question_text:e.question_text,question_type:e.question_type,options:e.options,correct_answer:e.correct_answer,explanation:e.explanation,ai_explanation:e.ai_explanation,passage_context:e.passage_context,related_passage_id:e.related_passage_id})),passages:t.map(e=>({type:e.type,title:e.title,content:e.content,imageUrl:e.imageUrl,questionStart:e.questionStart,questionEnd:e.questionEnd}))}});if(r)throw r;if(!(null==a?void 0:a.success))throw new Error((null==a?void 0:a.error)||"Failed to save questions");Be(s=>({...s,[e]:{...s[e],saved:!0}})),n.success(`Part ${e} saved successfully! (${a.questionsCount} questions)`)}catch(s){console.error("Error saving questions:",s),n.error("Failed to save questions")}finally{ie(!1)}}})(e.number),disabled:ne||Ae[e.number].saved||0===Ae[e.number].questions.length,className:"bg-[#A68B5B] hover:bg-[#8B6914] text-white",children:[i.jsx(H,{className:"w-4 h-4 mr-1"}),ne?"Saving...":Ae[e.number].saved?"Saved":"Save Questions"]})]})]})}),i.jsx(m,{children:Ae[e.number].questions.length>0?me?i.jsxs("div",{className:"bg-gradient-to-br from-white to-[#FEF9E7]/30 rounded-2xl shadow-lg border border-[#E8D5A3]/60 overflow-hidden",children:[i.jsxs("div",{className:"bg-[#5D4E37] px-6 py-3 flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(j,{variant:"ghost",size:"icon",onClick:()=>he(Math.max(0,xe-1)),disabled:0===xe,className:"text-white/80 hover:text-white hover:bg-white/20 disabled:opacity-30 w-8 h-8",children:i.jsx(k,{className:"w-5 h-5"})}),i.jsxs(o,{className:"bg-[#A68B5B] text-white text-sm px-4 py-1.5 font-semibold",children:["Q",(null==(r=Ae[e.number].questions[xe])?void 0:r.question_number)||xe+1]}),i.jsxs("span",{className:"text-white/80 text-sm",children:[xe+1," of ",Ae[e.number].questions.length]}),i.jsx(j,{variant:"ghost",size:"icon",onClick:()=>he(Math.min(Ae[e.number].questions.length-1,xe+1)),disabled:xe>=Ae[e.number].questions.length-1,className:"text-white/80 hover:text-white hover:bg-white/20 disabled:opacity-30 w-8 h-8",children:i.jsx(P,{className:"w-5 h-5"})})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs(j,{variant:"ghost",size:"sm",onClick:()=>Fe(e.number),className:"text-white/80 hover:text-white hover:bg-white/10",children:[i.jsx(D,{className:"w-4 h-4 mr-1"}),"Add"]}),i.jsxs(j,{variant:"ghost",size:"sm",onClick:()=>ke(e.number),disabled:ce,className:"text-white/80 hover:text-white hover:bg-white/10",children:[i.jsx(C,{className:"w-4 h-4 mr-1"}),ce?"Generating...":"AI Explain"]}),i.jsxs(j,{variant:"ghost",size:"sm",onClick:()=>{Se(e.number,xe),xe>=Ae[e.number].questions.length-1&&he(Math.max(0,xe-1))},className:"text-red-300 hover:text-red-100 hover:bg-red-500/20",children:[i.jsx(U,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]}),i.jsx("div",{className:"p-8",children:e.hasPassages&&Ae[e.number].passages.length>0&&(null==(u=Ae[e.number].passages[0])?void 0:u.imageUrl)?i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"bg-white border-2 border-[#E8D5A3] rounded-lg p-4 shadow-md",children:[i.jsxs("div",{className:"flex items-center justify-between mb-3",children:[i.jsxs(o,{className:"bg-[#5D4E37] text-white",children:["Questions ",null==(z=Ae[e.number].passages[0])?void 0:z.questionStart," - ",null==(J=Ae[e.number].passages[0])?void 0:J.questionEnd]}),i.jsx("span",{className:"text-sm text-[#8B6914]",children:"Passage Document"})]}),i.jsx("img",{src:Ae[e.number].passages[0].imageUrl,alt:"Passage",className:"w-full rounded-lg border border-gray-200"})]}),i.jsxs("div",{className:"bg-[#FEF9E7] border border-[#E8D5A3] rounded-lg p-4",children:[i.jsxs("h3",{className:"text-lg font-semibold text-[#5D4E37] mb-4 flex items-center gap-2",children:[i.jsx(x,{className:"w-5 h-5 text-[#A68B5B]"}),"Answer Key (Click to set correct answer)"]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Ae[e.number].questions.map((s,t)=>{const a=t===xe;return i.jsxs("div",{className:"p-4 rounded-lg border-2 transition-all "+(a?"border-[#A68B5B] bg-white shadow-md":"border-gray-200 bg-white hover:border-[#E8D5A3]"),children:[i.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[i.jsxs(o,{className:(s.correct_answer?"bg-green-500":"bg-[#A68B5B]")+" text-white",children:["Q",s.question_number]}),s.correct_answer&&i.jsxs(o,{variant:"outline",className:"border-green-500 text-green-600",children:["✓ ",s.correct_answer]}),!s.correct_answer&&i.jsx(o,{variant:"outline",className:"border-amber-500 text-amber-600",children:"No answer set"})]}),i.jsx("div",{className:"grid grid-cols-4 gap-2",children:["A","B","C","D"].map(a=>{const r=s.correct_answer===a;return i.jsx("button",{onClick:()=>Pe(e.number,t,"correct_answer",a),className:"py-2 px-3 rounded-lg font-bold text-sm transition-all "+(r?"bg-green-500 text-white shadow-md scale-105":"bg-gray-100 text-gray-700 hover:bg-[#A68B5B] hover:text-white"),children:a},a)})})]},t)})}),i.jsx("div",{className:"mt-4 pt-4 border-t border-[#E8D5A3]",children:i.jsxs(j,{variant:"outline",onClick:()=>Fe(e.number),className:"border-[#A68B5B] text-[#5D4E37] hover:bg-[#A68B5B] hover:text-white",children:[i.jsx(D,{className:"w-4 h-4 mr-2"}),"Add Question"]})})]}),Ae[e.number].questions.filter(e=>!e.correct_answer).length>0&&i.jsxs("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-lg flex items-center gap-2 text-amber-700",children:[i.jsx(V,{className:"w-4 h-4"}),i.jsxs("span",{className:"text-sm",children:[Ae[e.number].questions.filter(e=>!e.correct_answer).length," question(s) missing answers"]})]})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"mb-8",children:[i.jsx(b,{className:"text-xs text-[#8B6914] mb-2 block uppercase tracking-wide",children:"Question Text (click to edit)"}),i.jsx(w,{value:(null==(W=Ae[e.number].questions[xe])?void 0:W.question_text)||"",onChange:s=>Pe(e.number,xe,"question_text",s.target.value),className:"text-xl text-[#5D4E37] leading-relaxed font-serif bg-transparent border-dashed border-[#E8D5A3] hover:border-[#A68B5B] focus:border-[#A68B5B] focus:ring-[#A68B5B] resize-none min-h-[100px]",placeholder:"Enter question text..."})]}),i.jsxs("div",{className:"space-y-3 mb-6",children:[i.jsx(b,{className:"text-xs text-[#8B6914] uppercase tracking-wide",children:"Options (click letter to set as correct answer)"}),((null==(X=Ae[e.number].questions[xe])?void 0:X.options)||["","","",""]).map((s,t)=>{var a;const r=String.fromCharCode(65+t),n=(null==(a=Ae[e.number].questions[xe])?void 0:a.correct_answer)===r;return i.jsxs("div",{className:"group flex items-center gap-3 p-3 rounded-xl border transition-all\n                                        "+(n?"bg-green-50 border-green-300 shadow-sm":"bg-white border-[#E8D5A3] hover:border-[#A68B5B]"),children:[i.jsx("button",{onClick:()=>Pe(e.number,xe,"correct_answer",r),className:"w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm transition-all shrink-0\n                                          "+(n?"bg-green-500 text-white shadow-md scale-110":"bg-[#FEF9E7] text-[#8B6914] hover:bg-[#A68B5B] hover:text-white border-2 border-[#E8D5A3] hover:border-[#A68B5B]"),title:n?"Correct answer":"Click to set as correct answer",children:r}),i.jsx(v,{value:s,onChange:s=>{var a;const r=[...(null==(a=Ae[e.number].questions[xe])?void 0:a.options)||["","","",""]];r[t]=s.target.value,Pe(e.number,xe,"options",r)},className:"flex-1 border-0 bg-transparent text-base focus:ring-0 focus-visible:ring-0 "+(n?"text-green-700 font-medium":"text-[#5D4E37]"),placeholder:`Option ${r}...`}),n&&i.jsx(x,{className:"w-5 h-5 text-green-500 shrink-0"})]},t)})]}),!(null==(Y=Ae[e.number].questions[xe])?void 0:Y.correct_answer)&&i.jsxs("div",{className:"flex items-center justify-center text-amber-600 bg-amber-50 p-3 rounded-lg border border-amber-200 mb-6",children:[i.jsx(V,{className:"w-4 h-4 mr-2"}),i.jsx("span",{className:"text-sm font-medium",children:"Click a letter button above to set the correct answer"})]}),(null==(ee=Ae[e.number].questions[xe])?void 0:ee.ai_explanation)&&i.jsxs("div",{className:"bg-blue-50 border border-blue-200 p-4 rounded-xl mb-6",children:[i.jsxs(b,{className:"text-xs text-blue-600 uppercase tracking-wide mb-2 block flex items-center gap-1",children:[i.jsx(C,{className:"w-3 h-3"})," AI Explanation"]}),i.jsx("p",{className:"text-sm text-blue-800",children:null==(se=Ae[e.number].questions[xe])?void 0:se.ai_explanation})]})]})}),i.jsxs("div",{className:"bg-[#FEF9E7] px-6 py-4 flex items-center justify-between border-t border-[#E8D5A3]",children:[i.jsxs(j,{variant:"outline",onClick:()=>he(Math.max(0,xe-1)),disabled:0===xe,className:"border-[#A68B5B] text-[#5D4E37] hover:bg-[#A68B5B] hover:text-white disabled:opacity-40 px-6",children:[i.jsx(k,{className:"w-4 h-4 mr-2"}),"Previous"]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"text-sm text-[#8B6914]",children:"Jump to:"}),i.jsxs(f,{value:String(xe),onValueChange:e=>he(Number(e)),children:[i.jsx(q,{className:"w-24 h-9 bg-white border-[#E8D5A3]",children:i.jsx(E,{})}),i.jsx(_,{children:Ae[e.number].questions.map((e,s)=>i.jsxs(y,{value:String(s),children:["Q",e.question_number," ",e.correct_answer?"✓":"?"]},s))})]})]}),i.jsxs(j,{variant:"outline",onClick:()=>he(Math.min(Ae[e.number].questions.length-1,xe+1)),disabled:xe>=Ae[e.number].questions.length-1,className:"border-[#A68B5B] text-[#5D4E37] hover:bg-[#A68B5B] hover:text-white disabled:opacity-40 px-6",children:["Next",i.jsx(P,{className:"w-4 h-4 ml-2"})]})]})]}):"grid"===ge?i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-center justify-between text-sm text-[#8B6914]",children:[i.jsxs("span",{children:["Showing ",Ae[e.number].questions.length," questions in ",be,"-column grid"]}),i.jsx("span",{children:"Click any card to preview or edit"})]}),i.jsx("div",{className:"grid gap-3 max-h-[600px] overflow-y-auto pr-2 pb-2",style:{gridTemplateColumns:`repeat(${be}, minmax(0, 1fr))`},children:Ae[e.number].questions.map((s,t)=>i.jsx(l,{className:"border bg-white hover:shadow-lg transition-all cursor-pointer hover:scale-[1.02] "+(s.correct_answer?"border-green-300 hover:border-green-400":"border-amber-300 hover:border-amber-400"),onClick:()=>{he(t),ue(!0)},children:i.jsxs(m,{className:"p-3",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsxs(o,{variant:"outline",className:"text-xs font-bold "+(s.correct_answer?"border-green-500 text-green-700 bg-green-50":"border-amber-500 text-amber-700 bg-amber-50"),children:["Q",s.question_number]}),i.jsxs("div",{className:"flex items-center gap-1",children:[s.correct_answer?i.jsx(o,{className:"bg-green-500 text-white text-xs px-2 font-bold",children:s.correct_answer}):i.jsx(o,{variant:"outline",className:"border-amber-400 text-amber-600 text-xs px-2",children:"No answer"}),i.jsx(j,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 opacity-50 hover:opacity-100",onClick:s=>{s.stopPropagation(),Se(e.number,t)},children:i.jsx(U,{className:"w-3 h-3 text-red-400 hover:text-red-600"})})]})]}),i.jsx("p",{className:"text-xs text-[#5D4E37] line-clamp-3 mb-2 leading-relaxed",children:s.question_text||"No question text"}),s.options&&i.jsx("div",{className:"grid grid-cols-2 gap-1",children:s.options.map((e,t)=>i.jsxs("div",{className:"text-[10px] px-1.5 py-1 rounded flex items-center gap-1 "+(s.correct_answer===String.fromCharCode(65+t)?"bg-green-100 text-green-800 font-medium border border-green-300":"bg-gray-50 text-gray-600 border border-gray-200"),children:[i.jsxs("span",{className:"font-bold",children:[String.fromCharCode(65+t),":"]}),i.jsx("span",{className:"truncate",children:e})]},t))})]})},t))})]}):i.jsx("div",{className:"space-y-4 max-h-[600px] overflow-y-auto pr-2",children:Ae[e.number].questions.map((s,t)=>i.jsx(l,{className:"border border-[#E8D5A3] bg-white/50",children:i.jsxs(m,{className:"pt-4",children:[i.jsxs("div",{className:"flex items-start justify-between mb-3",children:[i.jsxs(o,{variant:"outline",className:"border-[#E8D5A3] text-[#5D4E37]",children:["Q",s.question_number]}),i.jsxs("div",{className:"flex items-center gap-2",children:[s.correct_answer&&i.jsxs(o,{variant:"secondary",className:"bg-green-100 text-green-700",children:["Answer: ",s.correct_answer]}),i.jsx(j,{variant:"ghost",size:"sm",onClick:()=>{he(t),ue(!0)},children:i.jsx(B,{className:"w-4 h-4 text-[#8B6914]"})}),i.jsx(j,{variant:"ghost",size:"sm",onClick:()=>Se(e.number,t),children:i.jsx(U,{className:"w-4 h-4 text-red-500"})})]})]}),i.jsxs("div",{className:"space-y-3",children:[e.hasPassages&&s.passage_context&&i.jsxs("div",{className:"bg-[#FEF9E7] border border-[#E8D5A3] p-3 rounded-lg mb-3",children:[i.jsx(b,{className:"text-xs text-[#8B6914]",children:"Passage Context"}),i.jsx("p",{className:"text-sm mt-1 whitespace-pre-wrap text-[#5D4E37]",children:s.passage_context})]}),i.jsxs("div",{children:[i.jsx(b,{className:"text-[#5D4E37]",children:"Question Text"}),i.jsx(w,{value:s.question_text,onChange:s=>Pe(e.number,t,"question_text",s.target.value),rows:2,className:"bg-white border-[#E8D5A3] focus:border-[#8B6914] focus:ring-[#8B6914] text-[#5D4E37]"})]}),s.options&&i.jsxs("div",{children:[i.jsx(b,{className:"text-[#5D4E37]",children:"Options"}),i.jsx("div",{className:"grid grid-cols-2 gap-2 mt-1",children:s.options.map((a,r)=>i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("span",{className:"text-sm font-medium w-6 text-[#5D4E37]",children:["(",String.fromCharCode(65+r),")"]}),i.jsx(v,{value:a,onChange:a=>{const n=[...s.options];n[r]=a.target.value,Pe(e.number,t,"options",n)},placeholder:`Option ${String.fromCharCode(65+r)}`,className:"bg-white border-[#E8D5A3] focus:border-[#8B6914] focus:ring-[#8B6914] text-[#5D4E37]"})]},r))})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx(b,{className:"text-[#5D4E37]",children:"Correct Answer"}),i.jsxs(f,{value:s.correct_answer,onValueChange:s=>Pe(e.number,t,"correct_answer",s),children:[i.jsx(q,{className:"bg-white border-[#E8D5A3] focus:border-[#8B6914] focus:ring-[#8B6914] text-[#5D4E37]",children:i.jsx(E,{placeholder:"Select answer"})}),i.jsxs(_,{children:[i.jsx(y,{value:"A",children:"A"}),i.jsx(y,{value:"B",children:"B"}),i.jsx(y,{value:"C",children:"C"}),i.jsx(y,{value:"D",children:"D"})]})]})]}),i.jsxs("div",{children:[i.jsx(b,{className:"text-[#5D4E37]",children:"Question Type"}),i.jsx(v,{value:s.question_type,onChange:s=>Pe(e.number,t,"question_type",s.target.value),className:"bg-white border-[#E8D5A3] focus:border-[#8B6914] focus:ring-[#8B6914] text-[#5D4E37]"})]})]}),s.ai_explanation&&i.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950/20 p-3 rounded-lg",children:[i.jsx(b,{className:"text-blue-700 dark:text-blue-400",children:"AI Explanation"}),i.jsx("p",{className:"text-sm mt-1",children:s.ai_explanation})]})]})]})},t))}):i.jsxs("div",{className:"text-center py-12 text-[#8B6914]",children:[i.jsx(S,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),i.jsx("p",{children:"No questions added yet."}),i.jsx("p",{className:"text-sm",children:"Use the methods above to add questions."})]})})]})]},e.number)})]})]})})};
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */export{X as default};
