import{u as e,r as s,j as a}from"./vendor-react-JN_hy__U.js";import{n as l,s as t,J as r,D as i,m as n,B as c,f as d,g as o,h as m,W as h,L as x,I as u,T as p,S as j,i as g,j as f,k as v,l as N,C as b,a9 as w,b as y,a as C,e as k,c as S,o as T}from"./index-DXpPY1B7.js";import{S as F}from"./switch-BN6iUzgJ.js";import{A as _,a as L,b as U,c as P,d as A,e as z,f as B,g as G,h as $}from"./alert-dialog-BwGJZs3W.js";import{A as D}from"./AdminLayout-D3lPYw5Y.js";import{y as E,av as I,X as W,aV as O,aW as R,cs as M,aS as V,aM as q,aN as H,aY as J}from"./vendor-ui-DG51EGkO.js";import"./vendor-react-dom-Cb-iy8Oc.js";import"./vendor-animation-ClPlB6zo.js";import"./vendor-i18n-DlHrixAm.js";import"./vendor-utils-D5HPTFR9.js";import"./vendor-supabase-D7XYLCUu.js";import"./vendor-charts-BpOKEG9Z.js";import"./vendor-date-DT7Rq6D9.js";const Y=[{value:"writing-task1",label:"Writing Task 1 (Charts/Graphs)"},{value:"writing-task2",label:"Writing Task 2 (Essays)"},{value:"speaking",label:"Speaking"},{value:"reading",label:"Reading"},{value:"listening",label:"Listening"},{value:"general",label:"General"}],Z=()=>{const Z=e(),{admin:K,loading:Q}=l(),X=s.useRef(null),[ee,se]=s.useState([]),[ae,le]=s.useState(!0),[te,re]=s.useState(""),[ie,ne]=s.useState("all"),[ce,de]=s.useState(!1),[oe,me]=s.useState(!1),[he,xe]=s.useState(null),[ue,pe]=s.useState(null),[je,ge]=s.useState(""),[fe,ve]=s.useState(""),[Ne,be]=s.useState("general"),[we,ye]=s.useState(""),[Ce,ke]=s.useState(!0),[Se,Te]=s.useState(null);s.useEffect(()=>{Q||K?K&&Fe():Z("/admin/login")},[K,Q,Z]);const Fe=async()=>{le(!0);try{const{data:e,error:s}=await t.from("templates").select("*").order("created_at",{ascending:!1});if(s)throw s;se(e||[])}catch(e){console.error("Error loading templates:",e),r.error("Failed to load templates")}finally{le(!1)}},_e=()=>{xe(null),pe(null),ge(""),ve(""),be("general"),ye(""),ke(!0),X.current&&(X.current.value="")},Le=e=>{var s;return(null==(s=Y.find(s=>s.value===e))?void 0:s.label)||e},Ue=ee.filter(e=>{var s;const a=e.title.toLowerCase().includes(te.toLowerCase())||(null==(s=e.description)?void 0:s.toLowerCase().includes(te.toLowerCase()))||e.tags.some(e=>e.includes(te.toLowerCase())),l="all"===ie||e.category===ie;return a&&l});return Q?a.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:a.jsx(E,{className:"w-8 h-8 animate-spin"})}):K?a.jsx(D,{title:"Templates",showBackButton:!0,backPath:"/admin/ielts",children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold tracking-tight bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",children:"Templates"}),a.jsx("p",{className:"text-muted-foreground",children:"Upload and manage template images for students"})]}),a.jsxs(i,{open:ce,onOpenChange:de,children:[a.jsx(n,{asChild:!0,children:a.jsxs(c,{children:[a.jsx(I,{className:"w-4 h-4 mr-2"}),"Upload Template"]})}),a.jsxs(d,{className:"sm:max-w-lg",children:[a.jsxs(o,{children:[a.jsx(m,{children:"Upload New Template"}),a.jsx(h,{children:"Upload an image to the templates library. Images are stored on Cloudflare for fast global delivery."})]}),a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(x,{children:"Image *"}),a.jsx("input",{ref:X,type:"file",accept:"image/*",onChange:e=>{var s;const a=null==(s=e.target.files)?void 0:s[0];if(a){if(!a.type.startsWith("image/"))return void r.error("Please select an image file");if(a.size>10485760)return void r.error("Image must be less than 10MB");xe(a),pe(URL.createObjectURL(a))}},className:"hidden"}),ue?a.jsxs("div",{className:"relative",children:[a.jsx("img",{src:ue,alt:"Preview",className:"w-full h-48 object-contain rounded-lg border bg-muted"}),a.jsx(c,{size:"sm",variant:"secondary",className:"absolute top-2 right-2",onClick:()=>{xe(null),pe(null)},children:a.jsx(W,{className:"w-4 h-4"})})]}):a.jsxs("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-8 text-center cursor-pointer hover:border-primary/50 transition-colors",onClick:()=>{var e;return null==(e=X.current)?void 0:e.click()},children:[a.jsx(O,{className:"w-8 h-8 mx-auto mb-2 text-muted-foreground"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Click to upload image"}),a.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"PNG, JPG, GIF up to 10MB"})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(x,{htmlFor:"title",children:"Title *"}),a.jsx(u,{id:"title",placeholder:"e.g., Line Graph - Population Growth",value:je,onChange:e=>ge(e.target.value)})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(x,{htmlFor:"description",children:"Description"}),a.jsx(p,{id:"description",placeholder:"Brief description of the template...",value:fe,onChange:e=>ve(e.target.value),rows:2})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(x,{children:"Category"}),a.jsxs(j,{value:Ne,onValueChange:be,children:[a.jsx(g,{children:a.jsx(f,{})}),a.jsx(v,{children:Y.map(e=>a.jsx(N,{value:e.value,children:e.label},e.value))})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(x,{htmlFor:"tags",children:"Tags (comma-separated)"}),a.jsx(u,{id:"tags",placeholder:"e.g., chart, graph, statistics",value:we,onChange:e=>ye(e.target.value)})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(x,{htmlFor:"published",children:"Publish immediately"}),a.jsx(F,{id:"published",checked:Ce,onCheckedChange:ke})]})]}),a.jsxs("div",{className:"flex justify-end gap-3",children:[a.jsx(c,{variant:"outline",onClick:()=>{_e(),de(!1)},children:"Cancel"}),a.jsx(c,{onClick:async()=>{if(he&&je.trim()){me(!0);try{const e=await(async e=>{var s;const{data:a}=await t.auth.getSession(),l=`templates/${Date.now()}-${e.name.replace(/[^a-zA-Z0-9.-]/g,"_")}`,r=new FormData;r.append("file",e),r.append("path",l),r.append("contentType",e.type);const i=await fetch("https://cuumxmfzhwljylbdlflj.supabase.co/functions/v1/r2-upload",{method:"POST",headers:{Authorization:`Bearer ${null==(s=null==a?void 0:a.session)?void 0:s.access_token}`},body:r});if(!i.ok){const e=await i.json();throw new Error(e.error||"Failed to upload image")}return(await i.json()).url})(he),s=we.split(",").map(e=>e.trim().toLowerCase()).filter(e=>e.length>0),{error:a}=await t.from("templates").insert({title:je.trim(),description:fe.trim()||null,category:Ne,image_url:e,tags:s,is_published:Ce});if(a)throw a;r.success("Template uploaded successfully!"),_e(),de(!1),Fe()}catch(e){console.error("Error uploading template:",e),r.error(`Upload failed: ${e.message}`)}finally{me(!1)}}else r.error("Please provide a title and select an image")},disabled:oe||!he||!je.trim(),children:oe?a.jsxs(a.Fragment,{children:[a.jsx(E,{className:"w-4 h-4 mr-2 animate-spin"}),"Uploading..."]}):a.jsxs(a.Fragment,{children:[a.jsx(O,{className:"w-4 h-4 mr-2"}),"Upload"]})})]})]})]})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[a.jsxs("div",{className:"relative flex-1",children:[a.jsx(R,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),a.jsx(u,{placeholder:"Search templates...",value:te,onChange:e=>re(e.target.value),className:"pl-10"})]}),a.jsxs(j,{value:ie,onValueChange:ne,children:[a.jsxs(g,{className:"w-full sm:w-[200px]",children:[a.jsx(M,{className:"w-4 h-4 mr-2"}),a.jsx(f,{placeholder:"Filter by category"})]}),a.jsxs(v,{children:[a.jsx(N,{value:"all",children:"All Categories"}),Y.map(e=>a.jsx(N,{value:e.value,children:e.label},e.value))]})]})]}),a.jsxs("div",{className:"flex gap-4 text-sm text-muted-foreground",children:[a.jsxs("span",{children:[ee.length," total templates"]}),a.jsx("span",{children:"•"}),a.jsxs("span",{children:[ee.filter(e=>e.is_published).length," published"]}),a.jsx("span",{children:"•"}),a.jsxs("span",{children:[Ue.length," showing"]})]}),ae?a.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[...Array(8)].map((e,s)=>a.jsxs(b,{className:"overflow-hidden",children:[a.jsx(w,{className:"h-40 w-full"}),a.jsx(y,{className:"pb-2",children:a.jsx(w,{className:"h-5 w-3/4"})}),a.jsx(C,{children:a.jsx(w,{className:"h-4 w-1/2"})})]},s))}):0===Ue.length?a.jsx(b,{children:a.jsxs(C,{className:"py-16 text-center",children:[a.jsx(V,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground/50"}),te||"all"!==ie?a.jsxs(a.Fragment,{children:[a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No templates found"}),a.jsx("p",{className:"text-muted-foreground mb-4",children:"Try adjusting your search or filters"}),a.jsx(c,{variant:"outline",onClick:()=>{re(""),ne("all")},children:"Clear filters"})]}):a.jsxs(a.Fragment,{children:[a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No templates yet"}),a.jsx("p",{className:"text-muted-foreground mb-4",children:"Upload your first template to get started"}),a.jsxs(c,{onClick:()=>de(!0),children:[a.jsx(I,{className:"w-4 h-4 mr-2"}),"Upload Template"]})]})]})}):a.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:Ue.map(e=>a.jsxs(b,{className:"overflow-hidden group",children:[a.jsxs("div",{className:"h-40 bg-muted relative cursor-pointer overflow-hidden",onClick:()=>Te(e),children:[a.jsx("img",{src:e.image_url,alt:e.title,className:"w-full h-full object-contain group-hover:scale-105 transition-transform duration-300"}),!e.is_published&&a.jsxs(k,{variant:"secondary",className:"absolute top-2 left-2",children:[a.jsx(q,{className:"w-3 h-3 mr-1"}),"Hidden"]}),a.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors flex items-center justify-center",children:a.jsx(H,{className:"w-8 h-8 text-white opacity-0 group-hover:opacity-100 transition-opacity"})})]}),a.jsxs(y,{className:"pb-2",children:[a.jsx(S,{className:"text-sm line-clamp-1",children:e.title}),a.jsx(T,{className:"text-xs",children:Le(e.category)})]}),a.jsxs(C,{className:"space-y-3",children:[e.tags.length>0&&a.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.tags.slice(0,3).map(e=>a.jsx(k,{variant:"outline",className:"text-xs",children:e},e)),e.tags.length>3&&a.jsxs(k,{variant:"outline",className:"text-xs",children:["+",e.tags.length-3]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(c,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>(async e=>{try{const{error:s}=await t.from("templates").update({is_published:!e.is_published}).eq("id",e.id);if(s)throw s;r.success(e.is_published?"Template hidden":"Template published"),Fe()}catch(s){r.error(`Failed to update: ${s.message}`)}})(e),children:e.is_published?a.jsxs(a.Fragment,{children:[a.jsx(q,{className:"w-3 h-3 mr-1"}),"Hide"]}):a.jsxs(a.Fragment,{children:[a.jsx(H,{className:"w-3 h-3 mr-1"}),"Publish"]})}),a.jsxs(_,{children:[a.jsx(L,{asChild:!0,children:a.jsx(c,{size:"sm",variant:"ghost",children:a.jsx(J,{className:"w-4 h-4 text-red-500"})})}),a.jsxs(U,{children:[a.jsxs(P,{children:[a.jsx(A,{children:"Delete Template"}),a.jsxs(z,{children:['Are you sure you want to delete "',e.title,'"? This action cannot be undone.']})]}),a.jsxs(B,{children:[a.jsx(G,{children:"Cancel"}),a.jsx($,{onClick:()=>(async e=>{try{const{error:s}=await t.from("templates").delete().eq("id",e);if(s)throw s;r.success("Template deleted"),Fe()}catch(s){r.error(`Failed to delete: ${s.message}`)}})(e.id),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]})]},e.id))}),a.jsx(i,{open:!!Se,onOpenChange:()=>Te(null),children:a.jsx(d,{className:"sm:max-w-3xl",children:Se&&a.jsxs(a.Fragment,{children:[a.jsxs(o,{children:[a.jsx(m,{children:Se.title}),a.jsxs(h,{children:[Le(Se.category),Se.description&&` • ${Se.description}`]})]}),a.jsx("div",{className:"py-4",children:a.jsx("img",{src:Se.image_url,alt:Se.title,className:"w-full max-h-[70vh] object-contain rounded-lg"})}),Se.tags.length>0&&a.jsx("div",{className:"flex flex-wrap gap-2",children:Se.tags.map(e=>a.jsx(k,{variant:"secondary",children:e},e))})]})})})]})}):null};export{Z as default};
