import{r as e,j as s,C as a,b as t,c as o,a as r,B as l}from"./index-HK7c_X_B.js";import{A as c}from"./AdminLayout-BsfgbuSL.js";import{A as n,a as i}from"./alert-Sika6O2C.js";import{s as d}from"./supabase-DWL4C3fA.js";function u(){const[u,m]=e.useState(null),[x,h]=e.useState([]),[p,v]=e.useState(0),[j,f]=e.useState(!1),[g,b]=e.useState(null),w=e.useRef(null),y=async()=>{try{console.log("ðŸ“Š Loading vocabulary stats from vocab_cards...");const{count:e,error:s}=await d.from("vocab_cards").select("id",{count:"exact",head:!0}).eq("is_public",!0);s?(console.error("âŒ Error loading stats:",s),b({total:0})):(console.log(`âœ… Loaded stats: ${e} public vocabulary cards`),b({total:e||0}))}catch(e){console.error("âŒ Exception loading stats:",e),b({total:0})}};e.useEffect(()=>{y()},[]);return s.jsx(c,{title:"Vocabulary Book",showBackButton:!0,children:s.jsxs("section",{className:"space-y-4",children:[s.jsxs(a,{children:[s.jsx(t,{children:s.jsx(o,{className:"text-base",children:"Bulk Upload Words (CSV)"})}),s.jsxs(r,{className:"space-y-3",children:[s.jsxs("p",{className:"text-sm text-muted-foreground",children:["Format: first column ",s.jsx("code",{children:"word"}),", then language columns such as ",s.jsx("code",{children:"ko"}),", ",s.jsx("code",{children:"ja"}),", ",s.jsx("code",{children:"vi"}),", ",s.jsx("code",{children:"zh"}),", ",s.jsx("code",{children:"es"}),". Each language column should contain the translation for that word. Duplicates are upserted."]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{ref:w,type:"file",accept:".csv",className:"hidden",onChange:e=>{var s;const a=null==(s=e.target.files)?void 0:s[0];a&&(async e=>{m(null),h([]);const s=await e.text(),{data:a,error:t}=await d.functions.invoke("vocab-import",{body:{csvText:s,previewOnly:!0}});t?m(t.message||"Preview failed"):(h(a.preview||[]),v(a.totalRows||0))})(a)}}),s.jsx(l,{onClick:()=>{var e;return null==(e=w.current)?void 0:e.click()},children:"Choose CSV"}),s.jsx(l,{variant:"secondary",onClick:()=>{const e=document.createElement("a");e.href="/examples/vocabulary-sample.csv",e.download="vocab-book-sample.csv",e.click()},children:"Download Sample CSV"})]}),u&&s.jsx(n,{variant:"destructive",children:s.jsx(i,{children:u})}),x.length>0&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"text-sm",children:["Previewing ",x.length," of ",p," rows"]}),s.jsx("div",{className:"max-h-56 overflow-auto border rounded-md text-xs",children:x.slice(0,50).map((e,a)=>s.jsxs("div",{className:"px-3 py-2 border-b last:border-b-0",children:[s.jsx("span",{className:"font-medium mr-2",children:e.word}),s.jsxs("span",{className:"text-muted-foreground",children:["[",e.language_code,"]"]}),s.jsx("span",{className:"ml-2",children:e.translation})]},a))}),s.jsx(l,{onClick:async()=>{var e,s;if(0!==x.length){f(!0);try{x.map(e=>`${e.word},${e.language_code},${e.translation}`).join("\n");const a=null==(s=null==(e=w.current)?void 0:e.files)?void 0:s[0];if(!a)return m("Please re-select the CSV file before importing."),void f(!1);const t=await a.text(),{error:o}=await d.functions.invoke("vocab-import",{body:{csvText:t,previewOnly:!1}});if(o)return void m(o.message||"Import failed");h([]),await y()}finally{f(!1)}}},disabled:j,children:j?"Importing...":"Confirm Import"})]})]})]}),s.jsxs(a,{children:[s.jsx(t,{children:s.jsx(o,{className:"text-base",children:"Current Stats"})}),s.jsx(r,{children:s.jsx("div",{className:"text-sm text-muted-foreground",children:null===g?"Loading...":`Total public vocabulary words: ${g.total}`})})]})]})})}export{u as default};
