import{r as e,j as s}from"./vendor-react-JN_hy__U.js";import{A as a}from"./AdminLayout-D3lPYw5Y.js";import{C as o,b as r,c as t,a as n,B as l,s as c}from"./index-DXpPY1B7.js";import{A as i,a as d}from"./alert-BV1wokst.js";import"./vendor-react-dom-Cb-iy8Oc.js";import"./vendor-animation-ClPlB6zo.js";import"./vendor-ui-DG51EGkO.js";import"./vendor-i18n-DlHrixAm.js";import"./vendor-utils-D5HPTFR9.js";import"./vendor-supabase-D7XYLCUu.js";import"./vendor-charts-BpOKEG9Z.js";import"./vendor-date-DT7Rq6D9.js";function m(){const[m,u]=e.useState(null),[x,h]=e.useState([]),[v,p]=e.useState(0),[j,f]=e.useState(!1),[b,g]=e.useState(null),w=e.useRef(null),y=async()=>{try{console.log("ðŸ“Š Loading vocabulary stats from vocab_cards...");const{count:e,error:s}=await c.from("vocab_cards").select("id",{count:"exact",head:!0}).eq("is_public",!0);s?(console.error("âŒ Error loading stats:",s),g({total:0})):(console.log(`âœ… Loaded stats: ${e} public vocabulary cards`),g({total:e||0}))}catch(e){console.error("âŒ Exception loading stats:",e),g({total:0})}};e.useEffect(()=>{y()},[]);return s.jsx(a,{title:"Vocabulary Book",showBackButton:!0,children:s.jsxs("section",{className:"space-y-4",children:[s.jsxs(o,{children:[s.jsx(r,{children:s.jsx(t,{className:"text-base",children:"Bulk Upload Words (CSV)"})}),s.jsxs(n,{className:"space-y-3",children:[s.jsxs("p",{className:"text-sm text-muted-foreground",children:["Format: first column ",s.jsx("code",{children:"word"}),", then language columns such as ",s.jsx("code",{children:"ko"}),", ",s.jsx("code",{children:"ja"}),", ",s.jsx("code",{children:"vi"}),", ",s.jsx("code",{children:"zh"}),", ",s.jsx("code",{children:"es"}),". Each language column should contain the translation for that word. Duplicates are upserted."]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{ref:w,type:"file",accept:".csv",className:"hidden",onChange:e=>{var s;const a=null==(s=e.target.files)?void 0:s[0];a&&(async e=>{u(null),h([]);const s=await e.text(),{data:a,error:o}=await c.functions.invoke("vocab-import",{body:{csvText:s,previewOnly:!0}});o?u(o.message||"Preview failed"):(h(a.preview||[]),p(a.totalRows||0))})(a)}}),s.jsx(l,{onClick:()=>{var e;return null==(e=w.current)?void 0:e.click()},children:"Choose CSV"}),s.jsx(l,{variant:"secondary",onClick:()=>{const e=document.createElement("a");e.href="/examples/vocabulary-sample.csv",e.download="vocab-book-sample.csv",e.click()},children:"Download Sample CSV"})]}),m&&s.jsx(i,{variant:"destructive",children:s.jsx(d,{children:m})}),x.length>0&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"text-sm",children:["Previewing ",x.length," of ",v," rows"]}),s.jsx("div",{className:"max-h-56 overflow-auto border rounded-md text-xs",children:x.slice(0,50).map((e,a)=>s.jsxs("div",{className:"px-3 py-2 border-b last:border-b-0",children:[s.jsx("span",{className:"font-medium mr-2",children:e.word}),s.jsxs("span",{className:"text-muted-foreground",children:["[",e.language_code,"]"]}),s.jsx("span",{className:"ml-2",children:e.translation})]},a))}),s.jsx(l,{onClick:async()=>{var e,s;if(0!==x.length){f(!0);try{x.map(e=>`${e.word},${e.language_code},${e.translation}`).join("\n");const a=null==(s=null==(e=w.current)?void 0:e.files)?void 0:s[0];if(!a)return u("Please re-select the CSV file before importing."),void f(!1);const o=await a.text(),{error:r}=await c.functions.invoke("vocab-import",{body:{csvText:o,previewOnly:!1}});if(r)return void u(r.message||"Import failed");h([]),await y()}finally{f(!1)}}},disabled:j,children:j?"Importing...":"Confirm Import"})]})]})]}),s.jsxs(o,{children:[s.jsx(r,{children:s.jsx(t,{className:"text-base",children:"Current Stats"})}),s.jsx(n,{children:s.jsx("div",{className:"text-sm text-muted-foreground",children:null===b?"Loading...":`Total public vocabulary words: ${b.total}`})})]})]})})}export{m as default};
