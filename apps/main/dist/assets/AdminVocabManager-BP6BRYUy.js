import{a4 as e,j as s,D as a,l as t,m as n,n as l,a9 as r,bd as o,W as i,B as c,r as d,g as m,L as u,ad as x,G as h,P as g}from"./index-HK7c_X_B.js";import{s as p}from"./supabase-DWL4C3fA.js";import{C as b}from"./circle-alert-VravIU0u.js";import{B as f}from"./book-Tyu923ub.js";import{C as j}from"./chart-column-1SaGh7p6.js";import{Z as v}from"./zap-B83f532l.js";import{D as w}from"./download-BLEdLe8g.js";import{T as N}from"./trash-2-KvvQBh01.js";import{S as y}from"./search-DubE1H2a.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=e("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);function k({open:e,onOpenChange:d,progress:m,isRunning:u,onResume:x,canResume:h}){const g=m.total>0?Math.min(m.current/m.total*100,100):0,p=g>=99.9&&!u,f=m.total-m.current,j=Math.ceil(f/100),v=Math.floor(j/60),w=j%60;return s.jsx(a,{open:e,onOpenChange:d,children:s.jsxs(t,{className:"sm:max-w-md",children:[s.jsx(n,{children:s.jsxs(l,{className:"flex items-center gap-2",children:[u?s.jsx(r,{className:"h-5 w-5 animate-spin text-blue-500"}):p?s.jsx(o,{className:"h-5 w-5 text-green-500"}):s.jsx(b,{className:"h-5 w-5 text-yellow-500"}),"Translation Progress"]})}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[s.jsx("span",{className:"text-muted-foreground",children:"Progress"}),s.jsxs("span",{className:"font-semibold text-lg",children:[g.toFixed(1),"%"]})]}),s.jsx(i,{value:g,className:"h-3"}),s.jsxs("div",{className:"flex justify-between text-xs mt-1 text-muted-foreground",children:[s.jsxs("span",{children:[m.current.toLocaleString()," translated"]}),s.jsxs("span",{children:[f.toLocaleString()," remaining"]})]})]}),u&&j>0&&s.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950 rounded-lg p-3 text-sm",children:[s.jsx("p",{className:"text-muted-foreground mb-1",children:"Estimated time remaining:"}),s.jsx("p",{className:"font-semibold text-blue-600 dark:text-blue-400",children:v>0?`${v}h ${w}m`:`${w} minutes`}),s.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["~",100," translations/min ‚Ä¢ Auto-chaining in background"]})]}),m.errors>0&&s.jsxs("div",{className:"text-sm text-yellow-600 dark:text-yellow-500 flex items-center gap-2 bg-yellow-50 dark:bg-yellow-950 rounded-lg p-3",children:[s.jsx(b,{className:"h-4 w-4 flex-shrink-0"}),s.jsxs("span",{children:[m.errors," errors (will auto-retry)"]})]}),p&&s.jsxs("div",{className:"text-sm text-green-600 dark:text-green-500 font-medium bg-green-50 dark:bg-green-950 rounded-lg p-3",children:["‚úÖ Translation completed! ",m.current.toLocaleString()," translations saved across 23 languages."]}),!u&&h&&s.jsx(c,{onClick:x,className:"w-full",size:"lg",children:"Resume Translation"}),u&&s.jsxs("div",{className:"text-center space-y-2",children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Running in background. Safe to close this window."}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Edge functions auto-chain to process all words continuously"})]})]})]})})}const S="bg-gradient-to-br from-amber-50 via-orange-50 to-yellow-50",T="bg-white/80 backdrop-blur-sm border border-amber-200/50 shadow-lg shadow-amber-100/20",C="hover:shadow-xl hover:shadow-amber-200/30 hover:border-amber-300/60",_="bg-amber-500 hover:bg-amber-600 text-white",L="bg-orange-100 hover:bg-orange-200 text-orange-800 border border-orange-200",q="text-amber-900",A="text-amber-700/70",E="bg-white/90 border-amber-200 focus:border-amber-400 focus:ring-amber-400/20",P=()=>{const[e,a]=d.useState([]),[t,n]=d.useState({}),[l,r]=d.useState(""),[i,c]=d.useState(!1),[P,R]=d.useState(!1),[I,W]=d.useState(!1),[F,M]=d.useState(null),[U,z]=d.useState({total:0,publicTotal:0}),[B,D]=d.useState(""),[O,V]=d.useState(""),[G,Q]=d.useState(""),[H,J]=d.useState(""),[Y,K]=d.useState("");d.useRef(null);const[X,Z]=d.useState(null),[ee,se]=d.useState(!1),[ae,te]=d.useState(!1),[ne,le]=d.useState(null),[re,oe]=d.useState(1),[ie]=d.useState(100),[ce,de]=d.useState(0),[me,ue]=d.useState(!1),[xe,he]=d.useState({current:0,total:0,currentCard:"",currentLang:"",errors:0}),[ge,pe]=d.useState(!1),[be,fe]=d.useState(!1),[je,ve]=d.useState(null);d.useState(null);const[we,Ne]=d.useState(!0),[ye,$e]=d.useState(0),[ke,Se]=d.useState(!1),[Te,Ce]=d.useState([]),[_e,Le]=d.useState("all"),[qe,Ae]=d.useState(null),{toast:Ee}=m(),Pe=async()=>{c(!0);let e=p.from("vocab_cards").select("id, term, translation, pos, ipa, context_sentence, frequency_rank, level, created_at",{count:"exact"});null!==ne&&(e=e.eq("level",ne)),l.trim()&&(e=e.or(`term.ilike.%${l}%,translation.ilike.%${l}%`));const s=(re-1)*ie,t=s+ie-1;e=e.order("created_at",{ascending:!1}).range(s,t);const{data:n,error:r,count:o}=await e;if(!r){let e=n||[];me&&(e=[...e].sort(()=>Math.random()-.5)),a(e),de(o||0)}c(!1)},Re=async()=>{if(0===e.length)return;const s=e.map(e=>e.id),{data:a}=await p.from("vocab_translations").select("card_id, lang, translations").in("card_id",s).eq("is_system",!0),t={};null==a||a.forEach(e=>{var s;t[e.card_id]||(t[e.card_id]={}),t[e.card_id][e.lang]=(null==(s=e.translations)?void 0:s[0])||""}),n(t)},Ie=async()=>{const e=await p.from("vocab_cards").select("id",{count:"exact",head:!0}),s=await p.from("vocab_cards").select("id",{count:"exact",head:!0}).eq("is_public",!0);z({total:e.count||0,publicTotal:s.count||0})},We=async()=>{await Pe(),await Ie(),await new Promise(e=>setTimeout(e,100)),await Re()};d.useEffect(()=>{Pe(),Ie(),(async()=>{try{const{count:e}=await p.from("vocab_translation_queue").select("*",{count:"exact",head:!0}).eq("status","pending"),s=localStorage.getItem("vocabRunnerStarted");if(e&&e>0)await p.functions.invoke("process-translations",{body:{reason:"resume-pending"}}),await p.functions.invoke("kick-translations",{body:{cycles:12,parallel:3}}),pe(!0),fe(!0);else if(!s){const{data:e}=await p.functions.invoke("vocab-queue-translations",{body:{onlyMissing:!0}});await p.functions.invoke("process-translations",{body:{reason:"auto-start"}}),await p.functions.invoke("kick-translations",{body:{cycles:12,parallel:3}}),localStorage.setItem("vocabRunnerStarted",(new Date).toISOString()),Ee({title:"Auto-translation started",description:"Processing queued translations in background."}),pe(!0),fe(!0)}}catch(e){}})()},[]),d.useEffect(()=>{Pe()},[ne,re,l,me]),d.useEffect(()=>{e.length>0&&Re()},[e]);d.useEffect(()=>{(async()=>{const{data:e}=await p.rpc("is_admin");R(!!e)})()},[]);const Fe=async(e,s)=>{await p.from("vocab_cards").update(s).eq("id",e),a(a=>a.map(a=>a.id===e?{...a,...s}:a))};return s.jsx("div",{className:`min-h-screen ${S} p-6`,children:s.jsxs("div",{className:"max-w-7xl mx-auto",children:[s.jsx("div",{className:`${T} rounded-2xl p-6 mb-6`,children:s.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-amber-400 to-orange-500 text-white shadow-lg",children:s.jsx(f,{className:"w-6 h-6"})}),s.jsxs("div",{children:[s.jsx("h1",{className:`text-2xl font-bold ${q}`,children:"Vocabulary Manager"}),s.jsx("p",{className:A,children:"Manage vocabulary cards and translations"})]})]}),s.jsxs("button",{className:`flex items-center gap-2 px-4 py-2 rounded-xl ${L} transition-all duration-200`,onClick:We,disabled:i,children:[s.jsx($,{className:"w-4 h-4 "+(i?"animate-spin":"")}),i?"Loading‚Ä¶":"Refresh"]})]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[s.jsx("div",{className:`${T} ${C} rounded-xl p-4 transition-all duration-200`,children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 rounded-lg bg-amber-100",children:s.jsx(f,{className:"w-5 h-5 text-amber-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:`text-sm ${A}`,children:"Total Words"}),s.jsx("p",{className:`text-xl font-bold ${q}`,children:U.total.toLocaleString()})]})]})}),s.jsx("div",{className:`${T} ${C} rounded-xl p-4 transition-all duration-200`,children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 rounded-lg bg-emerald-100",children:s.jsx(o,{className:"w-5 h-5 text-emerald-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:`text-sm ${A}`,children:"Public Words"}),s.jsx("p",{className:`text-xl font-bold ${q}`,children:U.publicTotal.toLocaleString()})]})]})}),s.jsx("div",{className:`${T} ${C} rounded-xl p-4 transition-all duration-200`,children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 rounded-lg bg-blue-100",children:s.jsx(u,{className:"w-5 h-5 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:`text-sm ${A}`,children:"Languages"}),s.jsx("p",{className:`text-xl font-bold ${q}`,children:"69"})]})]})}),s.jsx("div",{className:`${T} ${C} rounded-xl p-4 transition-all duration-200`,children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 rounded-lg bg-purple-100",children:s.jsx(j,{className:"w-5 h-5 text-purple-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:`text-sm ${A}`,children:"Current Page"}),s.jsxs("p",{className:`text-xl font-bold ${q}`,children:[re," / ",Math.ceil(ce/ie)||1]})]})]})})]}),s.jsxs("div",{className:`${T} rounded-xl p-5 mb-6`,children:[s.jsxs("h2",{className:`text-lg font-semibold ${q} mb-4 flex items-center gap-2`,children:[s.jsx(v,{className:"w-5 h-5 text-amber-500"}),"Quick Actions"]}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3",children:[s.jsxs("button",{className:`flex flex-col items-center gap-2 p-4 rounded-xl ${L} transition-all duration-200 ${C}`,onClick:()=>(async(e,s)=>{const a=prompt("How many words to generate? (max 1000 per batch, function will auto-resume)","500");if(!a)return;const t=Math.min(parseInt(a),1e3);if(isNaN(t)||t<1)alert("Invalid number");else{se(!0);try{const{data:a,error:n}=await p.functions.invoke("vocab-frequency-seed",{body:{total:t,minLevel:e||1,maxLevel:s||4,languages:["en","ko","ja","zh","es","fr","de"]}});if(n||!(null==a?void 0:a.success))alert(`Generation failed: ${(null==a?void 0:a.error)||(null==n?void 0:n.message)||"Unknown error"}`);else{const e=a.isResume?`\n\nüìç Resumed from rank ${a.startedFromRank} (continuing from where you left off)`:"",s=a.skippedCount>0?`\n‚è≠Ô∏è Skipped ${a.skippedCount} words outside level range`:"";alert(`‚úÖ Successfully generated ${a.importedCount} real English words!${e}${s}\n\nüí° Click again to generate more advanced words automatically.`),We()}}catch(n){alert(`Generation failed: ${(null==n?void 0:n.message)||"Unknown error"}`)}finally{se(!1)}}})(),disabled:ee,children:[s.jsx(x,{className:"w-5 h-5"}),s.jsx("span",{className:"text-xs font-medium text-center",children:ee?"Generating‚Ä¶":"Generate Words"})]}),s.jsxs("button",{className:`flex flex-col items-center gap-2 p-4 rounded-xl ${L} transition-all duration-200 ${C}`,onClick:async()=>{se(!0);try{const{data:e,error:s}=await p.functions.invoke("vocab-cefr-seed",{body:{total:8e3}});if(s||!(null==e?void 0:e.success))alert(`Generation failed: ${(null==e?void 0:e.error)||(null==s?void 0:s.message)||"Unknown error"}`);else{const s=e.isResume?`\n\nüìç Resumed from rank ${e.startedFromRank}`:"";alert(`‚úÖ Successfully generated ${e.importedCount} CEFR-graded words!${s}\n\nüí° Click again to continue generating more words automatically.`),We()}}catch(e){alert(`Generation failed: ${(null==e?void 0:e.message)||"Unknown error"}`)}finally{se(!1)}},disabled:ee,children:[s.jsx(f,{className:"w-5 h-5"}),s.jsx("span",{className:"text-xs font-medium text-center",children:ee?"Generating‚Ä¶":"CEFR Words"})]}),s.jsxs("button",{className:`flex flex-col items-center gap-2 p-4 rounded-xl ${L} transition-all duration-200 ${C}`,onClick:async()=>{const e=window.prompt("Enter RAW URL for IELTS/AWL wordlist (CSV or TXT)","https://raw.githubusercontent.com/anig1scur/CEFR-Vocabulary-List/slave/B2.txt");if(e){se(!0);try{const{data:s,error:a}=await p.functions.invoke("vocab-cefr-seed",{body:{total:1e4,csvUrl:e.trim()}});if(a||!(null==s?void 0:s.success))alert(`Import failed: ${(null==s?void 0:s.error)||(null==a?void 0:a.message)||"Unknown error"}`);else{const e=s.isResume?`\n\nüìç Resumed from rank ${s.startedFromRank}`:"";alert(`‚úÖ Imported ${s.importedCount} IELTS/AWL words!${e}`),We()}}catch(s){alert(`Import failed: ${(null==s?void 0:s.message)||"Unknown error"}`)}finally{se(!1)}}},disabled:ee,children:[s.jsx(w,{className:"w-5 h-5"}),s.jsx("span",{className:"text-xs font-medium text-center",children:ee?"Importing‚Ä¶":"Import IELTS"})]}),s.jsxs("button",{className:"flex flex-col items-center gap-2 p-4 rounded-xl bg-orange-100 hover:bg-orange-200 text-orange-800 border border-orange-200 transition-all duration-200",onClick:async()=>{te(!0);try{const{data:e,error:s}=await p.functions.invoke("vocab-cleanup-junk");s||!(null==e?void 0:e.success)?alert(`Cleanup failed: ${(null==e?void 0:e.error)||(null==s?void 0:s.message)||"Unknown error"}`):(alert(`‚úÖ Cleaned up ${e.deleted} junk entries (single letters, abbreviations)`),We())}catch(e){alert(`Cleanup failed: ${(null==e?void 0:e.message)||"Unknown error"}`)}finally{te(!1)}},disabled:ae,children:[s.jsx(N,{className:"w-5 h-5"}),s.jsx("span",{className:"text-xs font-medium text-center",children:ae?"Cleaning‚Ä¶":"Clean Junk"})]}),s.jsxs("button",{className:"flex flex-col items-center gap-2 p-4 rounded-xl bg-red-100 hover:bg-red-200 text-red-800 border border-red-200 transition-all duration-200",onClick:async()=>{if(!window.confirm("‚ö†Ô∏è Are you sure you want to DELETE ALL vocabulary words? This cannot be undone!"))return;if(window.confirm("‚ö†Ô∏è‚ö†Ô∏è FINAL WARNING: This will permanently delete ALL words and translations. Type YES to confirm.")){te(!0);try{const{error:e}=await p.from("vocab_cards").delete().neq("id","00000000-0000-0000-0000-000000000000");e?alert(`Delete failed: ${e.message}`):(alert("‚úÖ All vocabulary words deleted successfully"),a([]),n({}),await Ie())}catch(e){alert(`Delete failed: ${(null==e?void 0:e.message)||"Unknown error"}`)}finally{te(!1)}}},disabled:ae,children:[s.jsx(b,{className:"w-5 h-5"}),s.jsx("span",{className:"text-xs font-medium text-center",children:ae?"Deleting‚Ä¶":"Delete All"})]}),s.jsxs("button",{className:"flex flex-col items-center gap-2 p-4 rounded-xl bg-indigo-100 hover:bg-indigo-200 text-indigo-800 border border-indigo-200 transition-all duration-200",onClick:async()=>{c(!0);try{const{data:e}=await p.rpc("get_translation_stats");e&&e.length>0&&Ae({total:e[0].total_translations||0,unique_cards:e[0].unique_cards||0,last_translation:e[0].last_translation||""});let s=p.from("vocab_translations").select("\n          id,\n          card_id,\n          lang,\n          translations,\n          created_at,\n          vocab_cards!inner(term, translation)\n        ").eq("is_system",!0).order("created_at",{ascending:!1}).limit(100);"all"!==_e&&(s=s.eq("lang",_e));const{data:a,error:t}=await s;if(t)throw t;Ce(a||[]),Se(!0)}catch(e){Ee({title:"Failed to load translations",description:(null==e?void 0:e.message)||"Unknown error",variant:"destructive"})}finally{c(!1)}},disabled:i,children:[s.jsx(h,{className:"w-5 h-5"}),s.jsx("span",{className:"text-xs font-medium text-center",children:i?"Loading‚Ä¶":"View Translations"})]})]})]}),s.jsxs("div",{className:`${T} rounded-xl p-5 mb-6`,children:[s.jsxs("h2",{className:`text-lg font-semibold ${q} mb-4 flex items-center gap-2`,children:[s.jsx(u,{className:"w-5 h-5 text-amber-500"}),"Translation Tools"]}),s.jsxs("div",{className:"flex flex-wrap gap-3",children:[s.jsxs("button",{className:"flex items-center gap-2 px-4 py-3 rounded-xl bg-purple-100 hover:bg-purple-200 text-purple-800 border border-purple-200 transition-all duration-200 font-medium",onClick:async()=>{console.log("üìä Checking translation status...");const{count:e}=await p.from("vocab_cards").select("*",{count:"exact",head:!0}).eq("is_public",!0).eq("language","en"),{count:s}=await p.from("vocab_translations").select("*",{count:"exact",head:!0}),{data:a}=await p.from("vocab_translations").select("lang"),t={};(a||[]).forEach(e=>{t[e.lang]=(t[e.lang]||0)+1});const n=Object.entries(t).sort((e,s)=>s[1]-e[1]).map(([e,s])=>`${e}: ${s}`).join("\n"),l=69*(e||0),r=s&&l?(s/l*100).toFixed(2):"0";alert(`üìä Translation Status\n\nTotal English words: ${e}\nTotal translations: ${s}\nExpected (69 langs): ${l}\nCoverage: ${r}%\n\nBy language:\n${n}`)},children:[s.jsx(j,{className:"w-4 h-4"}),"Check Status"]}),s.jsxs("button",{className:"flex items-center gap-2 px-4 py-3 rounded-xl bg-emerald-100 hover:bg-emerald-200 text-emerald-800 border border-emerald-200 transition-all duration-200 font-medium",onClick:async()=>{if(window.confirm('Queue translation jobs for 69 languages?\n\nThis uses the queue-based system.\nFor faster results, use "Smart Translate" instead.')){W(!0);try{const s=["zh","hi","es","fr","ar","bn","pt","ru","ja","ur","id","de","vi","tr","it","ko","fa","ta","th","yue","ms","te","mr","gu","kn","ml","pa","or","as","sw","ha","yo","ig","am","zu","af","pl","uk","ro","nl","el","cs","hu","sv","bg","sr","hr","sk","no","da","fi","sq","sl","et","lv","lt","uz","kk","az","mn","he","ps","ka","hy","tl","my","km","si","ne","zh-TW"],{data:a,error:t}=await p.functions.invoke("vocab-queue-translations",{body:{languages:s}});if(t||!(null==a?void 0:a.success))return console.error("‚ùå Failed to queue translation jobs",t||a),void alert((null==a?void 0:a.error)||(null==t?void 0:t.message)||"Failed to queue translation jobs");console.log("üìù Queued jobs via edge function:",a);const{count:n}=await p.from("vocab_translation_queue").select("*",{count:"exact",head:!0}).eq("status","pending"),l=n||0;alert(`‚úÖ Queued translation jobs!\n\nüìä Total pending: ${l} jobs\n\n‚ö†Ô∏è IMPORTANT: Keep this tab open!\nTranslations will process automatically.\nDo not close or refresh the page.`);let r=0;const o=l;let i=0;const c=5;let d=0;const m=3;for(console.log(`üöÄ Starting translation processing: ${o} jobs`),console.log("‚ö†Ô∏è Keep this tab open - closing it will stop translations!");r<o&&i<c&&d<m;)try{console.log(`üîÑ Calling process-translations... (${r}/${o})`);const e=Date.now(),{data:s,error:a}=await p.functions.invoke("process-translations",{body:{}}),t=Date.now()-e;console.log(`üì¶ Response (${t}ms):`,JSON.stringify({data:s,error:a},null,2));const{count:n}=await p.from("vocab_translation_queue").select("*",{count:"exact",head:!0}).eq("status","pending"),l=n||0;if(console.log(`üìä Remaining pending jobs: ${l}`),a)console.error("‚ùå Edge Function Error:",{message:a.message,status:a.status,statusText:a.statusText,details:a}),i++;else if(!(null==s?void 0:s.success)){if(console.error("‚ùå Translation batch failed:",{data:s}),i++,i>=c){alert(`‚ùå Translation stopped after ${c} consecutive failures.\n\nProcessed: ${r}/${o} translations\n\nYou can click the button again to resume from where it left off.`);break}await new Promise(e=>setTimeout(e,5e3));continue}if(i=0,l===o-r){if(d++,console.log(`‚ö†Ô∏è Empty batch detected (${d}/${m})`),d>=m){console.log("‚úÖ All jobs completed (no more pending jobs)"),r=o;break}}else d=0;r=o-l;const u=Math.round(r/o*100);if(console.log(`üìä Translation progress: ${u}% (${r}/${o})`),r%500!=0&&r!==o&&0!==l||console.log(`‚úÖ Processed ${r}/${o} translations (${l} remaining)`),0===l){console.log("üéâ All translations completed!"),r=o;break}await new Promise(e=>setTimeout(e,1e3))}catch(e){if(console.error("Batch processing error:",e),i++,i>=c){alert(`‚ùå Translation stopped due to errors.\n\nProcessed: ${r}/${o} translations\n\nError: ${e.message}`);break}await new Promise(e=>setTimeout(e,3e3))}const{count:u}=await p.from("vocab_translation_queue").select("*",{count:"exact",head:!0}).eq("status","pending");if(0===(u||0)||r>=o)alert(`üéâ Translation completed successfully!\n\n‚úÖ Processed: ${r} translations\nüåç Languages: 23\n‚úÖ No pending jobs remaining\n\nAll translations are now available!`);else{const{count:e}=await p.from("vocab_translation_queue").select("*",{count:"exact",head:!0}).eq("status","pending");alert(`‚ö†Ô∏è Translation incomplete\n\n‚úÖ Processed: ${r}/${o}\n‚è∏Ô∏è Still pending: ${e||0} jobs\n\n${i>=c?"‚ùå Stopped due to errors":"‚è∏Ô∏è Processing paused"}\n\nClick "üåç Translate All" again to resume.`)}Re(),We()}catch(s){alert(`Failed: ${(null==s?void 0:s.message)||"Unknown error"}`)}finally{W(!1)}}},disabled:I,children:[s.jsx(h,{className:"w-4 h-4"}),I?"Queuing‚Ä¶":"Queue Translations"]}),s.jsxs("button",{className:"flex items-center gap-2 px-4 py-3 rounded-xl bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white shadow-lg shadow-amber-200/50 transition-all duration-200 font-semibold",onClick:async()=>{if(!window.confirm("üöÄ Smart Batch Translation (2 Workers)\n\nThis will translate vocabulary words to 69 languages with example sentences.\n\nFeatures:\n‚Ä¢ 2 concurrent workers (3-4x faster)\n‚Ä¢ 15 cards √ó 69 languages per batch\n‚Ä¢ 15 parallel language processing\n‚Ä¢ Auto-resumes from where it left off\n\nEstimated: ~8-12 hours for full translation\nCost: ~$11 total\n\nContinue?"))return;W(!0);let e=0,s=0,a=0,t=!1;try{const n=setInterval(()=>{if(a>0){const a=Math.round((7972-s)/15*20/60);Ee({title:"‚ö° 2 Workers Active",description:`${e.toLocaleString()} translations (${s} cards) ~${a}min remaining`})}},3e4);console.log("üöÄ Starting 2 workers..."),Ee({title:"üöÄ Starting 2 Workers",description:"Translation running in parallel for maximum speed..."});const l=await Promise.all(Array.from({length:2},(n,l)=>(async n=>{var l,r,o,i,c,d;let m=null,u=0,x=0,h=0,g=0;for(;u<300&&x<3&&!t;){let f,j;u++,console.log(`üîß Worker ${n} - Batch ${u}...`);try{const e=await p.functions.invoke("vocab-batch-translate-v2",{body:{cardsPerRun:15,parallelLanguages:15,batchSize:15,continueFrom:m}});f=e.data,j=e.error,x=0}catch(b){if(console.error(`Worker ${n} fetch error:`,b),x++,x<3){await new Promise(e=>setTimeout(e,3e3));continue}break}if(j||!(null==f?void 0:f.success)){if(console.error(`Worker ${n} batch error:`,j||f),x++,x<3){await new Promise(e=>setTimeout(e,3e3));continue}break}if(h+=(null==(l=f.stats)?void 0:l.translations)||0,g+=(null==(r=f.stats)?void 0:r.cardsProcessed)||0,e+=(null==(o=f.stats)?void 0:o.translations)||0,s+=(null==(i=f.stats)?void 0:i.cardsProcessed)||0,a++,console.log(`‚úÖ Worker ${n} Batch ${u}: ${null==(c=f.stats)?void 0:c.translations} translations (${null==(d=f.stats)?void 0:d.duration}ms)`),f.completed||!f.hasMore){console.log(`üéâ Worker ${n} finished - no more cards!`),t=!0;break}m=f.continueFrom,await new Promise(e=>setTimeout(e,300+100*n))}return{workerId:n,batchCount:u,translations:h,cards:g}})(l+1)));clearInterval(n);const r=l.reduce((e,s)=>e+s.batchCount,0);console.log("üìä Final Results:",l),Ee({title:t?"üéâ Translation Complete!":"‚è∏Ô∏è Translation Paused",description:`${e.toLocaleString()} translations across ${s} cards (${r} batches)`}),We()}catch(n){Ee({title:"Translation Error",description:`Completed ${e} translations before error. Click again to continue.`,variant:"destructive"})}finally{W(!1)}},disabled:I,children:[s.jsx(v,{className:"w-4 h-4"}),I?"Translating (2 Workers)‚Ä¶":"Smart Translate ‚ö°"]})]})]}),(F||X)&&s.jsxs("div",{className:`${T} rounded-xl p-4 mb-6`,children:[F&&s.jsxs("div",{className:`text-sm ${A} mb-2`,children:["Progress: ",F.completed||0," / ",F.total||0,F.last_term&&` ‚Ä¢ Last: ${F.last_term}`,F.last_error&&s.jsxs("span",{className:"text-red-500",children:[" ‚Ä¢ Error: ",F.last_error]})]}),X&&s.jsxs("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsxs("div",{className:"text-sm font-medium text-blue-800 mb-1",children:["Audit Results (",X.type,")"]}),s.jsxs("div",{className:"text-xs text-blue-700",children:["levels"===X.type&&s.jsxs("span",{children:["Words: ",X.data.totalWords," ‚Ä¢ Invalid: ",X.data.invalidLevels]}),"translations"===X.type&&s.jsxs("span",{children:["No trans: ",X.data.noTranslations," ‚Ä¢ Partial: ",X.data.partialTranslations," ‚Ä¢ Full: ",X.data.fullTranslations]})]})]})]}),s.jsxs("div",{className:`${T} rounded-xl p-5 mb-6`,children:[s.jsxs("h2",{className:`text-lg font-semibold ${q} mb-4 flex items-center gap-2`,children:[s.jsx(g,{className:"w-5 h-5 text-amber-500"}),"Add New Word"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-3 items-end",children:[s.jsxs("div",{children:[s.jsx("label",{className:`text-xs font-medium ${A} mb-1 block`,children:"Term *"}),s.jsx("input",{className:`w-full px-3 py-2 rounded-lg ${E} border focus:ring-2 transition-all`,placeholder:"e.g., serendipity",value:B,onChange:e=>D(e.target.value)})]}),s.jsxs("div",{children:[s.jsx("label",{className:`text-xs font-medium ${A} mb-1 block`,children:"Translation"}),s.jsx("input",{className:`w-full px-3 py-2 rounded-lg ${E} border focus:ring-2 transition-all`,placeholder:"Translation",value:O,onChange:e=>V(e.target.value)})]}),s.jsxs("div",{children:[s.jsx("label",{className:`text-xs font-medium ${A} mb-1 block`,children:"POS"}),s.jsx("input",{className:`w-full px-3 py-2 rounded-lg ${E} border focus:ring-2 transition-all`,placeholder:"noun, verb...",value:G,onChange:e=>Q(e.target.value)})]}),s.jsxs("div",{children:[s.jsx("label",{className:`text-xs font-medium ${A} mb-1 block`,children:"IPA"}),s.jsx("input",{className:`w-full px-3 py-2 rounded-lg ${E} border focus:ring-2 transition-all`,placeholder:"/Àåser…ônÀàd…™p…ôti/",value:H,onChange:e=>J(e.target.value)})]}),s.jsxs("div",{children:[s.jsx("label",{className:`text-xs font-medium ${A} mb-1 block`,children:"Context"}),s.jsx("input",{className:`w-full px-3 py-2 rounded-lg ${E} border focus:ring-2 transition-all`,placeholder:"Example sentence",value:Y,onChange:e=>K(e.target.value)})]}),s.jsxs("button",{className:`px-4 py-2 rounded-lg ${_} font-medium transition-all duration-200 flex items-center justify-center gap-2`,onClick:async()=>{if(!B.trim())return void alert("Enter a term");const{data:{user:e}}=await p.auth.getUser();if(!e)return void alert("You must be signed in");const s={user_id:e.id,term:B.trim(),translation:O.trim()||null,pos:G.trim()||null,ipa:H.trim()||null,context_sentence:Y.trim()||null,language:"en"},{data:t,error:n}=await p.from("vocab_cards").insert(s).select("id, term, translation, pos, ipa, context_sentence, frequency_rank, created_at").single();n?alert(n.message):(a(e=>[t,...e]),D(""),V(""),Q(""),J(""),K(""),await Ie())},children:[s.jsx(g,{className:"w-4 h-4"}),"Add"]})]})]}),s.jsx("div",{className:`${T} rounded-xl p-5 mb-6`,children:s.jsxs("div",{className:"flex gap-3 items-center flex-wrap",children:[s.jsxs("div",{className:"flex-1 min-w-[250px] relative",children:[s.jsx(y,{className:`absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 ${A}`}),s.jsx("input",{value:l,onChange:e=>{r(e.target.value),oe(1)},placeholder:"Search terms or translations‚Ä¶",className:`w-full pl-10 pr-4 py-2.5 rounded-lg ${E} border focus:ring-2 transition-all`})]}),s.jsxs("button",{onClick:()=>{ue(!me)},className:`px-4 py-2.5 rounded-lg font-medium transition-all duration-200 ${me?"bg-amber-500 text-white":L}`,children:["üîÄ ",me?"Shuffled":"Shuffle"]}),s.jsxs("select",{value:ne||"",onChange:e=>{le(e.target.value?parseInt(e.target.value):null),oe(1)},className:`px-4 py-2.5 rounded-lg ${E} border focus:ring-2 transition-all`,children:[s.jsx("option",{value:"",children:"All Levels"}),s.jsx("option",{value:"1",children:"A1 - Beginner"}),s.jsx("option",{value:"2",children:"A2 - Elementary"}),s.jsx("option",{value:"3",children:"B1 - Intermediate"}),s.jsx("option",{value:"4",children:"B2 - Upper Intermediate"})]}),s.jsxs("div",{className:`text-sm ${A} px-3 py-2 rounded-lg bg-amber-50`,children:["Showing ",s.jsx("span",{className:"font-semibold text-amber-700",children:e.length})," of ",s.jsx("span",{className:"font-semibold text-amber-700",children:ce.toLocaleString()})," words"]})]})}),s.jsxs("div",{className:`${T} rounded-xl overflow-hidden mb-6`,children:[s.jsxs("div",{className:"flex gap-3 items-center justify-between p-4 border-b border-amber-100",children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>oe(Math.max(1,re-1)),disabled:1===re||i,className:`px-4 py-2 rounded-lg font-medium transition-all duration-200 ${L} disabled:opacity-50 disabled:cursor-not-allowed`,children:"‚Üê Previous"}),s.jsx("button",{onClick:()=>oe(re+1),disabled:re*ie>=ce||i,className:`px-4 py-2 rounded-lg font-medium transition-all duration-200 ${L} disabled:opacity-50 disabled:cursor-not-allowed`,children:"Next ‚Üí"})]}),s.jsxs("div",{className:`text-sm ${A}`,children:["Page ",s.jsx("span",{className:"font-semibold",children:re})," of ",s.jsx("span",{className:"font-semibold",children:Math.ceil(ce/ie)||1})]})]}),s.jsx("div",{className:"overflow-auto",children:s.jsxs("table",{className:"min-w-full text-sm",children:[s.jsx("thead",{className:"bg-gradient-to-r from-amber-50 to-orange-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:`text-left p-3 font-semibold ${q}`,children:"Term"}),s.jsx("th",{className:`text-left p-3 font-semibold ${q}`,children:"Translations"}),s.jsx("th",{className:`text-left p-3 font-semibold ${q}`,children:"POS"}),s.jsx("th",{className:`text-left p-3 font-semibold ${q}`,children:"IPA"}),s.jsx("th",{className:`text-left p-3 font-semibold ${q}`,children:"Context"}),s.jsx("th",{className:`text-left p-3 font-semibold ${q}`,children:"Level"}),s.jsx("th",{className:`text-left p-3 font-semibold ${q}`,children:"Freq"}),s.jsx("th",{className:`text-left p-3 font-semibold ${q}`,children:"Actions"})]})}),s.jsxs("tbody",{children:[e.map((e,n)=>s.jsxs("tr",{className:`border-t border-amber-100 ${n%2==0?"bg-white":"bg-amber-50/30"} hover:bg-amber-100/50 transition-colors`,children:[s.jsx("td",{className:`p-3 font-semibold ${q}`,children:e.term}),s.jsx("td",{className:"p-3",children:s.jsxs("div",{className:"space-y-1 max-w-xs",children:[Object.entries(t[e.id]||{}).slice(0,3).map(([e,a])=>s.jsxs("div",{className:"text-xs",children:[s.jsxs("span",{className:"font-medium text-amber-600",children:[e.toUpperCase(),":"]})," ",s.jsx("span",{className:A,children:String(a)})]},e)),Object.keys(t[e.id]||{}).length>3&&s.jsxs("div",{className:"text-xs text-amber-500",children:["+",Object.keys(t[e.id]).length-3," more"]}),(!t[e.id]||0===Object.keys(t[e.id]).length)&&s.jsx("span",{className:"text-gray-400 text-xs italic",children:"No translations"}),Object.keys(t[e.id]||{}).length>0&&s.jsxs("div",{className:"text-xs text-emerald-600 mt-1 flex items-center gap-1",children:[s.jsx(o,{className:"w-3 h-3"}),Object.keys(t[e.id]).length,"/69 languages"]})]})}),s.jsx("td",{className:"p-3",children:s.jsx("input",{className:`px-2 py-1.5 rounded-lg ${E} border w-24 text-xs`,defaultValue:e.pos||"",onBlur:s=>Fe(e.id,{pos:s.target.value})})}),s.jsx("td",{className:"p-3",children:s.jsx("input",{className:`px-2 py-1.5 rounded-lg ${E} border w-28 text-xs font-mono`,defaultValue:e.ipa||"",onBlur:s=>Fe(e.id,{ipa:s.target.value})})}),s.jsx("td",{className:"p-3 max-w-[280px]",children:s.jsx("textarea",{className:`px-2 py-1.5 rounded-lg ${E} border w-full text-xs resize-none`,rows:2,defaultValue:e.context_sentence||"",onBlur:s=>Fe(e.id,{context_sentence:s.target.value})})}),s.jsx("td",{className:"p-3 w-20 text-center",children:s.jsxs("select",{className:`px-2 py-1.5 rounded-lg ${E} border w-full text-xs`,defaultValue:e.level||1,onChange:s=>Fe(e.id,{level:parseInt(s.target.value)}),children:[s.jsx("option",{value:1,children:"A1"}),s.jsx("option",{value:2,children:"A2"}),s.jsx("option",{value:3,children:"B1"}),s.jsx("option",{value:4,children:"B2"})]})}),s.jsx("td",{className:`p-3 w-16 text-center ${A} text-xs`,children:e.frequency_rank||"-"}),s.jsx("td",{className:"p-3",children:s.jsxs("button",{className:"px-3 py-1.5 rounded-lg bg-red-100 hover:bg-red-200 text-red-700 text-xs font-medium transition-all flex items-center gap-1",onClick:()=>(async e=>{await p.from("vocab_cards").delete().eq("id",e),a(s=>s.filter(s=>s.id!==e))})(e.id),children:[s.jsx(N,{className:"w-3 h-3"}),"Delete"]})})]},e.id)),0===e.length&&s.jsx("tr",{children:s.jsx("td",{className:`p-8 text-center ${A}`,colSpan:8,children:s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsx(f,{className:"w-8 h-8 opacity-50"}),s.jsx("span",{children:"No vocabulary items found"})]})})})]})]})})]}),s.jsx(k,{open:be,onOpenChange:fe,progress:xe,isRunning:ge,onResume:()=>{(async(e,s=!1)=>{const a=["zh","hi","es","fr","ar","bn","pt","ru","ja","ur","id","de","vi","tr","it","ko","fa","ta","th","yue","ms","te","mr","gu","kn","ml","pa","or","as","sw","ha","yo","ig","am","zu","af","pl","uk","ro","nl","el","cs","hu","sv","bg","sr","hr","sk","no","da","fi","sq","sl","et","lv","lt","uz","kk","az","mn","he","ps","ka","hy","tl","my","km","si","ne","zh-TW"],t=null==e?void 0:e.offset;try{s||(pe(!0),fe(!0),$e(0)),localStorage.setItem("vocabTranslationActive","true"),localStorage.setItem("vocabTranslationStartTime",String(Date.now()));const{data:e,error:n}=await p.functions.invoke("vocab-translate-runner",{body:{languages:a,offset:t,limit:20}});if(n||!(null==e?void 0:e.success)){const s=(null==e?void 0:e.error)||(null==n?void 0:n.message)||"Unknown error";Ee({title:"Translation Started with Warning",description:s,variant:"default"})}else Ee({title:"Translation Started!",description:`Processing ${a.length} languages. Check logs for progress. This will run in the background and auto-chain.`});pe(!0)}catch(n){const e=(null==n?void 0:n.message)||"Unknown error";Ee({title:"Translation Error",description:e,variant:"destructive"})}})({offset:0})},canResume:!ge&&null!==je&&xe.errors>0}),ke&&s.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:`${T} rounded-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col`,children:[s.jsxs("div",{className:"p-5 border-b border-amber-100 flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsxs("h2",{className:`text-xl font-bold ${q} flex items-center gap-2`,children:[s.jsx(h,{className:"w-5 h-5 text-amber-500"}),"Translation Viewer"]}),s.jsx("p",{className:`text-sm ${A} mt-1`,children:qe?s.jsxs(s.Fragment,{children:[s.jsxs("span",{className:"font-semibold text-emerald-600",children:[qe.total.toLocaleString()," translations"]})," across"," ",s.jsxs("span",{className:"font-semibold",children:[qe.unique_cards.toLocaleString()," words"]})]}):"Loading stats..."})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsxs("label",{className:`flex items-center gap-2 px-4 py-2 rounded-lg ${L} cursor-pointer transition-all`,children:[s.jsx("input",{type:"checkbox",checked:we,onChange:e=>Ne(e.target.checked),className:"rounded border-amber-300"}),s.jsx("span",{className:"text-sm font-medium",children:"Auto-retry"})]}),s.jsx("button",{onClick:()=>Se(!1),className:`px-4 py-2 rounded-lg ${_} font-medium transition-all`,children:"Close"})]})]}),s.jsxs("div",{className:"overflow-auto flex-1 p-4",children:[s.jsxs("table",{className:"w-full text-sm",children:[s.jsx("thead",{className:"sticky top-0 bg-gradient-to-r from-amber-50 to-orange-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:`text-left p-3 font-semibold ${q}`,children:"English Term"}),s.jsx("th",{className:`text-left p-3 font-semibold ${q}`,children:"Language"}),s.jsx("th",{className:`text-left p-3 font-semibold ${q}`,children:"Translations"}),s.jsx("th",{className:`text-left p-3 font-semibold ${q}`,children:"Created"})]})}),s.jsx("tbody",{children:Te.map((e,a)=>{var t,n,l;return s.jsxs("tr",{className:(a%2==0?"bg-white":"bg-amber-50/30")+" hover:bg-amber-100/50 transition-colors",children:[s.jsxs("td",{className:"p-3 border-b border-amber-100",children:[s.jsx("div",{className:`font-semibold ${q}`,children:null==(t=e.vocab_cards)?void 0:t.term}),s.jsx("div",{className:`text-xs ${A}`,children:null==(n=e.vocab_cards)?void 0:n.translation})]}),s.jsx("td",{className:"p-3 border-b border-amber-100",children:s.jsx("span",{className:"px-2 py-1 bg-amber-100 text-amber-800 rounded-lg text-xs font-medium",children:null==(l=e.lang)?void 0:l.toUpperCase()})}),s.jsx("td",{className:"p-3 border-b border-amber-100",children:Array.isArray(e.translations)?s.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.translations.slice(0,5).map((e,a)=>s.jsx("span",{className:"px-2 py-1 bg-emerald-50 text-emerald-800 rounded-lg text-xs",children:e},a)),e.translations.length>5&&s.jsxs("span",{className:`text-xs ${A}`,children:["+",e.translations.length-5," more"]})]}):s.jsx("span",{className:"text-red-600 text-xs",children:"Invalid format"})}),s.jsx("td",{className:`p-3 border-b border-amber-100 text-xs ${A}`,children:new Date(e.created_at).toLocaleString()})]},e.id)})})]}),0===Te.length&&s.jsxs("div",{className:`text-center py-12 ${A}`,children:[s.jsx(h,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),s.jsx("p",{children:"No translations found"})]})]})]})})]})})};export{P as default};
