import{j as e,D as t,l as a,m as s,n,ba as l,b7 as r,W as o,B as i,r as c,g as d}from"./index-CclrDLeN.js";import{s as u}from"./supabase-DUkWVuqu.js";import{C as m}from"./circle-alert-9OtgDlfJ.js";function x({open:c,onOpenChange:d,progress:u,isRunning:x,onResume:p,canResume:g}){const h=u.total>0?Math.min(u.current/u.total*100,100):0,b=h>=99.9&&!x,f=u.total-u.current,v=Math.ceil(f/100),j=Math.floor(v/60),w=v%60;return e.jsx(t,{open:c,onOpenChange:d,children:e.jsxs(a,{className:"sm:max-w-md",children:[e.jsx(s,{children:e.jsxs(n,{className:"flex items-center gap-2",children:[x?e.jsx(l,{className:"h-5 w-5 animate-spin text-blue-500"}):b?e.jsx(r,{className:"h-5 w-5 text-green-500"}):e.jsx(m,{className:"h-5 w-5 text-yellow-500"}),"Translation Progress"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progress"}),e.jsxs("span",{className:"font-semibold text-lg",children:[h.toFixed(1),"%"]})]}),e.jsx(o,{value:h,className:"h-3"}),e.jsxs("div",{className:"flex justify-between text-xs mt-1 text-muted-foreground",children:[e.jsxs("span",{children:[u.current.toLocaleString()," translated"]}),e.jsxs("span",{children:[f.toLocaleString()," remaining"]})]})]}),x&&v>0&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950 rounded-lg p-3 text-sm",children:[e.jsx("p",{className:"text-muted-foreground mb-1",children:"Estimated time remaining:"}),e.jsx("p",{className:"font-semibold text-blue-600 dark:text-blue-400",children:j>0?`${j}h ${w}m`:`${w} minutes`}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["~",100," translations/min ‚Ä¢ Auto-chaining in background"]})]}),u.errors>0&&e.jsxs("div",{className:"text-sm text-yellow-600 dark:text-yellow-500 flex items-center gap-2 bg-yellow-50 dark:bg-yellow-950 rounded-lg p-3",children:[e.jsx(m,{className:"h-4 w-4 flex-shrink-0"}),e.jsxs("span",{children:[u.errors," errors (will auto-retry)"]})]}),b&&e.jsxs("div",{className:"text-sm text-green-600 dark:text-green-500 font-medium bg-green-50 dark:bg-green-950 rounded-lg p-3",children:["‚úÖ Translation completed! ",u.current.toLocaleString()," translations saved across 23 languages."]}),!x&&g&&e.jsx(i,{onClick:p,className:"w-full",size:"lg",children:"Resume Translation"}),x&&e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Running in background. Safe to close this window."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Edge functions auto-chain to process all words continuously"})]})]})]})})}const p=()=>{const[t,a]=c.useState([]),[s,n]=c.useState({}),[l,r]=c.useState(""),[o,i]=c.useState(!1),[m,p]=c.useState(!1),[g,h]=c.useState(!1),[b,f]=c.useState(null),[v,j]=c.useState({total:0,publicTotal:0}),[w,y]=c.useState(""),[N,k]=c.useState(""),[S,T]=c.useState(""),[$,_]=c.useState(""),[C,A]=c.useState("");c.useRef(null);const[L,q]=c.useState(null),[R,E]=c.useState(!1),[I,P]=c.useState(!1),[F,O]=c.useState(null),[U,D]=c.useState(1),[B]=c.useState(100),[W,M]=c.useState(0),[G,V]=c.useState(!1),[z,J]=c.useState({current:0,total:0,currentCard:"",currentLang:"",errors:0}),[Q,Y]=c.useState(!1),[K,H]=c.useState(!1),[X,Z]=c.useState(null);c.useState(null);const[ee,te]=c.useState(!0),[ae,se]=c.useState(0),[ne,le]=c.useState(!1),[re,oe]=c.useState([]),[ie,ce]=c.useState("all"),[de,ue]=c.useState(null),{toast:me}=d(),xe=async()=>{i(!0);let e=u.from("vocab_cards").select("id, term, translation, pos, ipa, context_sentence, frequency_rank, level, created_at",{count:"exact"});null!==F&&(e=e.eq("level",F)),l.trim()&&(e=e.or(`term.ilike.%${l}%,translation.ilike.%${l}%`));const t=(U-1)*B,s=t+B-1;e=e.order("created_at",{ascending:!1}).range(t,s);const{data:n,error:r,count:o}=await e;if(!r){let e=n||[];G&&(e=[...e].sort(()=>Math.random()-.5)),a(e),M(o||0)}i(!1)},pe=async()=>{if(0===t.length)return;const e=t.map(e=>e.id),{data:a}=await u.from("vocab_translations").select("card_id, lang, translations").in("card_id",e).eq("is_system",!0),s={};null==a||a.forEach(e=>{var t;s[e.card_id]||(s[e.card_id]={}),s[e.card_id][e.lang]=(null==(t=e.translations)?void 0:t[0])||""}),n(s)},ge=async()=>{const e=await u.from("vocab_cards").select("id",{count:"exact",head:!0}),t=await u.from("vocab_cards").select("id",{count:"exact",head:!0}).eq("is_public",!0);j({total:e.count||0,publicTotal:t.count||0})},he=async()=>{await xe(),await ge(),await new Promise(e=>setTimeout(e,100)),await pe()};c.useEffect(()=>{xe(),ge(),(async()=>{try{const{count:e}=await u.from("vocab_translation_queue").select("*",{count:"exact",head:!0}).eq("status","pending"),t=localStorage.getItem("vocabRunnerStarted");if(e&&e>0)await u.functions.invoke("process-translations",{body:{reason:"resume-pending"}}),await u.functions.invoke("kick-translations",{body:{cycles:12,parallel:3}}),Y(!0),H(!0);else if(!t){const{data:e}=await u.functions.invoke("vocab-queue-translations",{body:{onlyMissing:!0}});await u.functions.invoke("process-translations",{body:{reason:"auto-start"}}),await u.functions.invoke("kick-translations",{body:{cycles:12,parallel:3}}),localStorage.setItem("vocabRunnerStarted",(new Date).toISOString()),me({title:"Auto-translation started",description:"Processing queued translations in background."}),Y(!0),H(!0)}}catch(e){}})()},[]),c.useEffect(()=>{xe()},[F,U,l,G]);c.useEffect(()=>{(async()=>{const{data:e}=await u.rpc("is_admin");p(!!e)})()},[]);const be=async(e,t)=>{await u.from("vocab_cards").update(t).eq("id",e),a(a=>a.map(a=>a.id===e?{...a,...t}:a))};return e.jsxs("div",{className:"max-w-5xl mx-auto p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Admin ‚Ä¢ Vocabulary"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx("button",{className:"border rounded px-3 py-2",onClick:he,disabled:o,children:o?"Loading‚Ä¶":"Refresh"}),e.jsx("button",{className:"border rounded px-3 py-2 bg-purple-600 text-white font-medium",onClick:()=>(async(e,t)=>{const a=prompt("How many words to generate? (max 1000 per batch, function will auto-resume)","500");if(!a)return;const s=Math.min(parseInt(a),1e3);if(isNaN(s)||s<1)alert("Invalid number");else{E(!0);try{const{data:a,error:n}=await u.functions.invoke("vocab-frequency-seed",{body:{total:s,minLevel:e||1,maxLevel:t||4,languages:["en","ko","ja","zh","es","fr","de"]}});if(n||!(null==a?void 0:a.success))alert(`Generation failed: ${(null==a?void 0:a.error)||(null==n?void 0:n.message)||"Unknown error"}`);else{const e=a.isResume?`\n\nüìç Resumed from rank ${a.startedFromRank} (continuing from where you left off)`:"",t=a.skippedCount>0?`\n‚è≠Ô∏è Skipped ${a.skippedCount} words outside level range`:"";alert(`‚úÖ Successfully generated ${a.importedCount} real English words!${e}${t}\n\nüí° Click again to generate more advanced words automatically.`),he()}}catch(n){alert(`Generation failed: ${(null==n?void 0:n.message)||"Unknown error"}`)}finally{E(!1)}}})(),disabled:R,children:R?"‚è≥ Generating‚Ä¶":"üìö Generate All Levels"}),e.jsx("button",{className:"border rounded px-3 py-2 bg-blue-600 text-white font-medium",onClick:async()=>{E(!0);try{const{data:e,error:t}=await u.functions.invoke("vocab-cefr-seed",{body:{total:8e3}});if(t||!(null==e?void 0:e.success))alert(`Generation failed: ${(null==e?void 0:e.error)||(null==t?void 0:t.message)||"Unknown error"}`);else{const t=e.isResume?`\n\nüìç Resumed from rank ${e.startedFromRank}`:"";alert(`‚úÖ Successfully generated ${e.importedCount} CEFR-graded words!${t}\n\nüí° Click again to continue generating more words automatically.`),he()}}catch(e){alert(`Generation failed: ${(null==e?void 0:e.message)||"Unknown error"}`)}finally{E(!1)}},disabled:R,children:R?"‚è≥ Generating‚Ä¶":"üìö Generate CEFR (A1-B2)"}),e.jsx("button",{className:"border rounded px-3 py-2 bg-blue-500 text-white font-medium",onClick:async()=>{const e=window.prompt("Enter RAW URL for IELTS/AWL wordlist (CSV or TXT)","https://raw.githubusercontent.com/anig1scur/CEFR-Vocabulary-List/slave/B2.txt");if(e){E(!0);try{const{data:t,error:a}=await u.functions.invoke("vocab-cefr-seed",{body:{total:1e4,csvUrl:e.trim()}});if(a||!(null==t?void 0:t.success))alert(`Import failed: ${(null==t?void 0:t.error)||(null==a?void 0:a.message)||"Unknown error"}`);else{const e=t.isResume?`\n\nüìç Resumed from rank ${t.startedFromRank}`:"";alert(`‚úÖ Imported ${t.importedCount} IELTS/AWL words!${e}`),he()}}catch(t){alert(`Import failed: ${(null==t?void 0:t.message)||"Unknown error"}`)}finally{E(!1)}}},disabled:R,children:R?"‚è≥ Importing‚Ä¶":"üì• Import IELTS/AWL by URL"}),e.jsx("button",{className:"border rounded px-3 py-2 bg-orange-600 text-white font-medium",onClick:async()=>{P(!0);try{const{data:e,error:t}=await u.functions.invoke("vocab-cleanup-junk");t||!(null==e?void 0:e.success)?alert(`Cleanup failed: ${(null==e?void 0:e.error)||(null==t?void 0:t.message)||"Unknown error"}`):(alert(`‚úÖ Cleaned up ${e.deleted} junk entries (single letters, abbreviations)`),he())}catch(e){alert(`Cleanup failed: ${(null==e?void 0:e.message)||"Unknown error"}`)}finally{P(!1)}},disabled:I,children:I?"‚è≥ Cleaning‚Ä¶":"üßπ Clean Junk & Plurals"}),e.jsx("button",{className:"border rounded px-3 py-2 bg-red-600 text-white font-medium",onClick:async()=>{if(!window.confirm("‚ö†Ô∏è Are you sure you want to DELETE ALL vocabulary words? This cannot be undone!"))return;if(window.confirm("‚ö†Ô∏è‚ö†Ô∏è FINAL WARNING: This will permanently delete ALL words and translations. Type YES to confirm.")){P(!0);try{const{error:e}=await u.from("vocab_cards").delete().neq("id","00000000-0000-0000-0000-000000000000");e?alert(`Delete failed: ${e.message}`):(alert("‚úÖ All vocabulary words deleted successfully"),a([]),n({}),await ge())}catch(e){alert(`Delete failed: ${(null==e?void 0:e.message)||"Unknown error"}`)}finally{P(!1)}}},disabled:I,children:I?"‚è≥ Deleting‚Ä¶":"üóëÔ∏è Delete All"}),e.jsx("button",{className:"border rounded px-3 py-2 bg-indigo-600 text-white font-medium",onClick:async()=>{i(!0);try{const{data:e}=await u.rpc("get_translation_stats");e&&e.length>0&&ue({total:e[0].total_translations||0,unique_cards:e[0].unique_cards||0,last_translation:e[0].last_translation||""});let t=u.from("vocab_translations").select("\n          id,\n          card_id,\n          lang,\n          translations,\n          created_at,\n          vocab_cards!inner(term, translation)\n        ").eq("is_system",!0).order("created_at",{ascending:!1}).limit(100);"all"!==ie&&(t=t.eq("lang",ie));const{data:a,error:s}=await t;if(s)throw s;oe(a||[]),le(!0)}catch(e){me({title:"Failed to load translations",description:(null==e?void 0:e.message)||"Unknown error",variant:"destructive"})}finally{i(!1)}},disabled:o,children:o?"‚è≥ Loading‚Ä¶":"üëÅÔ∏è View Translations"}),e.jsx("button",{className:"border rounded px-3 py-2 bg-purple-600 text-white font-medium",onClick:async()=>{console.log("üìä Checking translation status...");const{count:e}=await u.from("vocab_cards").select("*",{count:"exact",head:!0}).eq("is_public",!0).eq("language","en"),{count:t}=await u.from("vocab_translations").select("*",{count:"exact",head:!0}),{data:a}=await u.from("vocab_translations").select("lang"),s={};(a||[]).forEach(e=>{s[e.lang]=(s[e.lang]||0)+1});const n=Object.entries(s).sort((e,t)=>t[1]-e[1]).map(([e,t])=>`${e}: ${t}`).join("\n"),l=23*(e||0),r=t&&l?(t/l*100).toFixed(2):"0";console.log("Translation Status:",{totalWords:e,totalTranslations:t,expectedTotal:l,coverage:`${r}%`,byLanguage:s}),alert(`üìä Translation Status\n\nTotal English words: ${e}\nTotal translations: ${t}\nExpected: ${l}\nCoverage: ${r}%\n\nBy language:\n${n}`)},children:"üìä Check Status"}),e.jsx("button",{className:"border rounded px-3 py-2 bg-green-600 text-white font-medium",onClick:async()=>{if(window.confirm("Translate all words into 23 languages with POS, IPA, and context?\n\nThis will create translation jobs for all missing translations.")){h(!0);try{const t=["ar","bn","de","es","fa","fr","hi","id","ja","kk","ko","ms","ne","pt","ru","ta","th","tr","ur","vi","yue","zh","zh-TW"],{data:a,error:s}=await u.functions.invoke("vocab-queue-translations",{body:{languages:t}});if(s||!(null==a?void 0:a.success))return console.error("‚ùå Failed to queue translation jobs",s||a),void alert((null==a?void 0:a.error)||(null==s?void 0:s.message)||"Failed to queue translation jobs");console.log("üìù Queued jobs via edge function:",a);const{count:n}=await u.from("vocab_translation_queue").select("*",{count:"exact",head:!0}).eq("status","pending"),l=n||0;alert(`‚úÖ Queued translation jobs!\n\nüìä Total pending: ${l} jobs\n\n‚ö†Ô∏è IMPORTANT: Keep this tab open!\nTranslations will process automatically.\nDo not close or refresh the page.`);let r=0;const o=l;let i=0;const c=5;let d=0;const m=3;for(console.log(`üöÄ Starting translation processing: ${o} jobs`),console.log("‚ö†Ô∏è Keep this tab open - closing it will stop translations!");r<o&&i<c&&d<m;)try{console.log(`üîÑ Calling process-translations... (${r}/${o})`);const e=Date.now(),{data:t,error:a}=await u.functions.invoke("process-translations",{body:{}}),s=Date.now()-e;console.log(`üì¶ Response (${s}ms):`,JSON.stringify({data:t,error:a},null,2));const{count:n}=await u.from("vocab_translation_queue").select("*",{count:"exact",head:!0}).eq("status","pending"),l=n||0;if(console.log(`üìä Remaining pending jobs: ${l}`),a)console.error("‚ùå Edge Function Error:",{message:a.message,status:a.status,statusText:a.statusText,details:a}),i++;else if(!(null==t?void 0:t.success)){if(console.error("‚ùå Translation batch failed:",{data:t}),i++,i>=c){alert(`‚ùå Translation stopped after ${c} consecutive failures.\n\nProcessed: ${r}/${o} translations\n\nYou can click the button again to resume from where it left off.`);break}await new Promise(e=>setTimeout(e,5e3));continue}if(i=0,l===o-r){if(d++,console.log(`‚ö†Ô∏è Empty batch detected (${d}/${m})`),d>=m){console.log("‚úÖ All jobs completed (no more pending jobs)"),r=o;break}}else d=0;r=o-l;const x=Math.round(r/o*100);if(console.log(`üìä Translation progress: ${x}% (${r}/${o})`),r%500!=0&&r!==o&&0!==l||console.log(`‚úÖ Processed ${r}/${o} translations (${l} remaining)`),0===l){console.log("üéâ All translations completed!"),r=o;break}await new Promise(e=>setTimeout(e,1e3))}catch(e){if(console.error("Batch processing error:",e),i++,i>=c){alert(`‚ùå Translation stopped due to errors.\n\nProcessed: ${r}/${o} translations\n\nError: ${e.message}`);break}await new Promise(e=>setTimeout(e,3e3))}const{count:x}=await u.from("vocab_translation_queue").select("*",{count:"exact",head:!0}).eq("status","pending");if(0===(x||0)||r>=o)alert(`üéâ Translation completed successfully!\n\n‚úÖ Processed: ${r} translations\nüåç Languages: 23\n‚úÖ No pending jobs remaining\n\nAll translations are now available!`);else{const{count:e}=await u.from("vocab_translation_queue").select("*",{count:"exact",head:!0}).eq("status","pending");alert(`‚ö†Ô∏è Translation incomplete\n\n‚úÖ Processed: ${r}/${o}\n‚è∏Ô∏è Still pending: ${e||0} jobs\n\n${i>=c?"‚ùå Stopped due to errors":"‚è∏Ô∏è Processing paused"}\n\nClick "üåç Translate All" again to resume.`)}pe(),he()}catch(t){alert(`Failed: ${(null==t?void 0:t.message)||"Unknown error"}`)}finally{h(!1)}}},disabled:g,children:g?"‚è≥ Translating All‚Ä¶":"üåç Translate All to 23 Languages"})]})]}),(b||v.total||v.publicTotal)&&e.jsxs("div",{className:"mb-3 text-xs text-slate-600 flex flex-wrap gap-4",children:[b&&e.jsxs("div",{children:["Progress: ",b.completed||0," / ",b.total||0," ",b.last_term?`‚Ä¢ Last: ${b.last_term}`:""," ",b.last_error?`‚Ä¢ Error: ${b.last_error}`:""]}),e.jsxs("div",{children:["Totals: ",v.total," total ‚Ä¢ ",v.publicTotal," public"]})]}),L&&e.jsxs("div",{className:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded",children:[e.jsxs("div",{className:"text-sm font-medium text-blue-800 mb-2",children:["Last Audit Results (",L.type,")"]}),e.jsxs("div",{className:"text-xs text-blue-700",children:["levels"===L.type&&e.jsxs("div",{children:["Total words: ",L.data.totalWords," ‚Ä¢ Invalid levels: ",L.data.invalidLevels," ‚Ä¢ Level distribution: ",JSON.stringify(L.data.levelStats)]}),"translations"===L.type&&e.jsxs("div",{children:["No translations: ",L.data.noTranslations," ‚Ä¢ Partial: ",L.data.partialTranslations," ‚Ä¢ Full: ",L.data.fullTranslations," ‚Ä¢ Queue: ",JSON.stringify(L.data.queueCounts)]})]})]}),e.jsxs("div",{className:"mb-4 border rounded p-3 bg-white/50",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Add Word"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-2 items-center",children:[e.jsx("input",{className:"border rounded px-2 py-2",placeholder:"Term (required)",value:w,onChange:e=>y(e.target.value)}),e.jsx("input",{className:"border rounded px-2 py-2",placeholder:"Translation",value:N,onChange:e=>k(e.target.value)}),e.jsx("input",{className:"border rounded px-2 py-2",placeholder:"POS",value:S,onChange:e=>T(e.target.value)}),e.jsx("input",{className:"border rounded px-2 py-2",placeholder:"IPA",value:$,onChange:e=>_(e.target.value)}),e.jsx("input",{className:"border rounded px-2 py-2",placeholder:"Context sentence",value:C,onChange:e=>A(e.target.value)}),e.jsx("button",{className:"border rounded px-3 py-2 bg-black text-white",onClick:async()=>{if(!w.trim())return void alert("Enter a term");const{data:{user:e}}=await u.auth.getUser();if(!e)return void alert("You must be signed in");const t={user_id:e.id,term:w.trim(),translation:N.trim()||null,pos:S.trim()||null,ipa:$.trim()||null,context_sentence:C.trim()||null,language:"en"},{data:s,error:n}=await u.from("vocab_cards").insert(t).select("id, term, translation, pos, ipa, context_sentence, frequency_rank, created_at").single();n?alert(n.message):(a(e=>[s,...e]),y(""),k(""),T(""),_(""),A(""),await ge())},children:"Create"})]})]}),e.jsxs("div",{className:"mb-3 flex gap-3 items-center flex-wrap",children:[e.jsx("input",{value:l,onChange:e=>{r(e.target.value),D(1)},placeholder:"Search terms or translations‚Ä¶",className:"border rounded px-3 py-2 flex-1 min-w-[200px]"}),e.jsxs("button",{onClick:()=>{V(!G)},className:"border rounded px-4 py-2 whitespace-nowrap "+(G?"bg-blue-600 text-white":"bg-white hover:bg-gray-50"),children:["üîÄ ",G?"Shuffled":"Shuffle"]}),e.jsxs("select",{value:F||"",onChange:e=>{O(e.target.value?parseInt(e.target.value):null),D(1)},className:"border rounded px-3 py-2 bg-white",children:[e.jsx("option",{value:"",children:"All Levels"}),e.jsx("option",{value:"1",children:"A1"}),e.jsx("option",{value:"2",children:"A2"}),e.jsx("option",{value:"3",children:"B1"}),e.jsx("option",{value:"4",children:"B2"})]}),e.jsxs("div",{className:"text-sm text-slate-600",children:["Showing ",t.length," of ",W," words"]})]}),e.jsxs("div",{className:"mb-3 flex gap-2 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>D(Math.max(1,U-1)),disabled:1===U||o,className:"border rounded px-3 py-1 disabled:opacity-50 disabled:cursor-not-allowed",children:"‚Üê Previous"}),e.jsx("button",{onClick:()=>D(U+1),disabled:U*B>=W||o,className:"border rounded px-3 py-1 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next ‚Üí"})]}),e.jsxs("div",{className:"text-sm text-slate-600",children:["Page ",U," of ",Math.ceil(W/B)]})]}),e.jsx("div",{className:"overflow-auto border rounded",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2",children:"Term"}),e.jsx("th",{className:"text-left p-2",children:"Translations"}),e.jsx("th",{className:"text-left p-2",children:"POS"}),e.jsx("th",{className:"text-left p-2",children:"IPA"}),e.jsx("th",{className:"text-left p-2",children:"Context"}),e.jsx("th",{className:"text-left p-2",children:"Level"}),e.jsx("th",{className:"text-left p-2",children:"Freq"}),e.jsx("th",{className:"text-left p-2",children:"Actions"})]})}),e.jsxs("tbody",{children:[t.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2 font-medium",children:t.term}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"space-y-1",children:[Object.entries(s[t.id]||{}).map(([t,a])=>e.jsxs("div",{className:"text-xs",children:[e.jsxs("span",{className:"font-medium text-blue-600",children:[t.toUpperCase(),":"]})," ",String(a)]},t)),(!s[t.id]||0===Object.keys(s[t.id]).length)&&e.jsx("span",{className:"text-gray-400 text-xs",children:"No translations yet"}),Object.keys(s[t.id]||{}).length>0&&e.jsxs("div",{className:"text-xs text-green-600 mt-1",children:["‚úÖ ",Object.keys(s[t.id]).length,"/23 languages translated"]})]})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"border rounded px-2 py-1 w-24",defaultValue:t.pos||"",onBlur:e=>be(t.id,{pos:e.target.value})})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"border rounded px-2 py-1 w-28",defaultValue:t.ipa||"",onBlur:e=>be(t.id,{ipa:e.target.value})})}),e.jsx("td",{className:"p-2 max-w-[320px]",children:e.jsx("textarea",{className:"border rounded px-2 py-1 w-full",defaultValue:t.context_sentence||"",onBlur:e=>be(t.id,{context_sentence:e.target.value})})}),e.jsx("td",{className:"p-2 w-16 text-center",children:e.jsxs("select",{className:"border rounded px-2 py-1 w-full",defaultValue:t.level||1,onChange:e=>be(t.id,{level:parseInt(e.target.value)}),children:[e.jsx("option",{value:1,children:"A1"}),e.jsx("option",{value:2,children:"A2"}),e.jsx("option",{value:3,children:"B1"}),e.jsx("option",{value:4,children:"B2"})]})}),e.jsx("td",{className:"p-2 w-16 text-center",children:t.frequency_rank||""}),e.jsx("td",{className:"p-2",children:e.jsx("button",{className:"text-red-600 underline",onClick:()=>(async e=>{await u.from("vocab_cards").delete().eq("id",e),a(t=>t.filter(t=>t.id!==e))})(t.id),children:"Delete"})})]},t.id)),0===t.length&&e.jsx("tr",{children:e.jsx("td",{className:"p-3 text-slate-500",colSpan:8,children:"No items"})})]})]})}),e.jsx(x,{open:K,onOpenChange:H,progress:z,isRunning:Q,onResume:()=>{(async(e,t=!1)=>{const a=["ar","bn","de","es","fa","fr","hi","id","ja","kk","ko","ms","ne","pt","ru","ta","th","tr","ur","vi","yue","zh","zh-TW"],s=null==e?void 0:e.offset;try{t||(Y(!0),H(!0),se(0)),localStorage.setItem("vocabTranslationActive","true"),localStorage.setItem("vocabTranslationStartTime",String(Date.now()));const{data:e,error:n}=await u.functions.invoke("vocab-translate-runner",{body:{languages:a,offset:s,limit:20}});if(n||!(null==e?void 0:e.success)){const t=(null==e?void 0:e.error)||(null==n?void 0:n.message)||"Unknown error";me({title:"Translation Started with Warning",description:t,variant:"default"})}else me({title:"Translation Started!",description:`Processing ${a.length} languages. Check logs for progress. This will run in the background and auto-chain.`});Y(!0)}catch(n){const e=(null==n?void 0:n.message)||"Unknown error";me({title:"Translation Error",description:e,variant:"destructive"})}})({offset:0})},canResume:!Q&&null!==X&&z.errors>0}),ne&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Translation Viewer"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:de?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"font-medium text-green-600",children:[de.total," total translations"]})," across"," ",e.jsxs("span",{className:"font-medium",children:[de.unique_cards," words"]})," ‚Ä¢ Last: ",new Date(de.last_translation).toLocaleString()]}):"Loading stats..."}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Showing latest 100 ‚Ä¢ Auto-retry: ",ee?"‚úÖ ON":"‚ùå OFF"," ‚Ä¢ Retry count: ",ae,"/10"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("label",{className:"flex items-center gap-2 px-3 py-2 border rounded cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",checked:ee,onChange:e=>te(e.target.checked)}),e.jsx("span",{className:"text-sm",children:"Auto-retry"})]}),e.jsx("button",{onClick:()=>le(!1),className:"px-4 py-2 border rounded hover:bg-gray-50",children:"Close"})]})]}),e.jsxs("div",{className:"overflow-auto flex-1 p-4",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2 border",children:"English Term"}),e.jsx("th",{className:"text-left p-2 border",children:"Language"}),e.jsx("th",{className:"text-left p-2 border",children:"Translations"}),e.jsx("th",{className:"text-left p-2 border",children:"Created"})]})}),e.jsx("tbody",{children:re.map(t=>{var a,s;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"p-2 border",children:[e.jsx("div",{className:"font-medium",children:null==(a=t.vocab_cards)?void 0:a.term}),e.jsx("div",{className:"text-xs text-gray-500",children:null==(s=t.vocab_cards)?void 0:s.translation})]}),e.jsx("td",{className:"p-2 border",children:e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs",children:t.lang})}),e.jsx("td",{className:"p-2 border",children:Array.isArray(t.translations)?e.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.translations.slice(0,5).map((t,a)=>e.jsx("span",{className:"px-2 py-1 bg-green-50 text-green-800 rounded text-xs",children:t},a)),t.translations.length>5&&e.jsxs("span",{className:"text-xs text-gray-500",children:["+",t.translations.length-5," more"]})]}):e.jsx("span",{className:"text-red-600 text-xs",children:"Invalid format"})}),e.jsx("td",{className:"p-2 border text-xs text-gray-500",children:new Date(t.created_at).toLocaleString()})]},t.id)})})]}),0===re.length&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No translations found"})]})]})})]})};export{p as default};
