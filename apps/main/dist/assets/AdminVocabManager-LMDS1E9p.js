import{j as e,D as s,m as a,n as t,o as n,ap as r,L as l,K as o,B as i,r as c,h as d,aa as m,N as u,a9 as x,P as g}from"./index-BcRn0esQ.js";import{s as h}from"./supabase-DWL4C3fA.js";import{C as p}from"./circle-alert-CJuYMXEg.js";import{B as b}from"./book-D2XAqG_b.js";import{R as f}from"./refresh-cw-DDtYc-g_.js";import{C as j}from"./chart-column-DeBRm5HV.js";import{Z as v}from"./zap-CLAifgsa.js";import{D as w}from"./download-BYAOWhUZ.js";import{T as N}from"./trash-2-B7VCZ8Z0.js";import{I as $}from"./image-D4wnaRjk.js";import{S as y}from"./search-CjhjHx0x.js";function k({open:c,onOpenChange:d,progress:m,isRunning:u,onResume:x,canResume:g}){const h=m.total>0?Math.min(m.current/m.total*100,100):0,b=h>=99.9&&!u,f=m.total-m.current,j=Math.ceil(f/100),v=Math.floor(j/60),w=j%60;return e.jsx(s,{open:c,onOpenChange:d,children:e.jsxs(a,{className:"sm:max-w-md",children:[e.jsx(t,{children:e.jsxs(n,{className:"flex items-center gap-2",children:[u?e.jsx(r,{className:"h-5 w-5 animate-spin text-blue-500"}):b?e.jsx(l,{className:"h-5 w-5 text-green-500"}):e.jsx(p,{className:"h-5 w-5 text-yellow-500"}),"Translation Progress"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progress"}),e.jsxs("span",{className:"font-semibold text-lg",children:[h.toFixed(1),"%"]})]}),e.jsx(o,{value:h,className:"h-3"}),e.jsxs("div",{className:"flex justify-between text-xs mt-1 text-muted-foreground",children:[e.jsxs("span",{children:[m.current.toLocaleString()," translated"]}),e.jsxs("span",{children:[f.toLocaleString()," remaining"]})]})]}),u&&j>0&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950 rounded-lg p-3 text-sm",children:[e.jsx("p",{className:"text-muted-foreground mb-1",children:"Estimated time remaining:"}),e.jsx("p",{className:"font-semibold text-blue-600 dark:text-blue-400",children:v>0?`${v}h ${w}m`:`${w} minutes`}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["~",100," translations/min ‚Ä¢ Auto-chaining in background"]})]}),m.errors>0&&e.jsxs("div",{className:"text-sm text-yellow-600 dark:text-yellow-500 flex items-center gap-2 bg-yellow-50 dark:bg-yellow-950 rounded-lg p-3",children:[e.jsx(p,{className:"h-4 w-4 flex-shrink-0"}),e.jsxs("span",{children:[m.errors," errors (will auto-retry)"]})]}),b&&e.jsxs("div",{className:"text-sm text-green-600 dark:text-green-500 font-medium bg-green-50 dark:bg-green-950 rounded-lg p-3",children:["‚úÖ Translation completed! ",m.current.toLocaleString()," translations saved across 23 languages."]}),!u&&g&&e.jsx(i,{onClick:x,className:"w-full",size:"lg",children:"Resume Translation"}),u&&e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Running in background. Safe to close this window."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Edge functions auto-chain to process all words continuously"})]})]})]})})}const S="bg-gradient-to-br from-amber-50 via-orange-50 to-yellow-50",T="bg-white/80 backdrop-blur-sm border border-amber-200/50 shadow-lg shadow-amber-100/20",C="hover:shadow-xl hover:shadow-amber-200/30 hover:border-amber-300/60",_="bg-amber-500 hover:bg-amber-600 text-white",L="bg-orange-100 hover:bg-orange-200 text-orange-800 border border-orange-200",I="text-amber-900",P="text-amber-700/70",A="bg-white/90 border-amber-200 focus:border-amber-400 focus:ring-amber-400/20",q=()=>{const[s,a]=c.useState([]),[t,n]=c.useState({}),[r,o]=c.useState(""),[i,q]=c.useState(!1),[R,E]=c.useState(!1),[F,W]=c.useState(!1),[G,U]=c.useState(null),[B,z]=c.useState({total:0,publicTotal:0}),[M,O]=c.useState(""),[D,V]=c.useState(""),[Q,J]=c.useState(""),[K,Y]=c.useState(""),[H,X]=c.useState("");c.useRef(null);const[Z,ee]=c.useState(null),[se,ae]=c.useState(!1),[te,ne]=c.useState(!1),[re,le]=c.useState(!1),[oe,ie]=c.useState(null),[ce,de]=c.useState(null),[me,ue]=c.useState(1),[xe]=c.useState(100),[ge,he]=c.useState(0),[pe,be]=c.useState(!1),[fe,je]=c.useState({current:0,total:0,currentCard:"",currentLang:"",errors:0}),[ve,we]=c.useState(!1),[Ne,$e]=c.useState(!1),[ye,ke]=c.useState(null);c.useState(null);const[Se,Te]=c.useState(!0),[Ce,_e]=c.useState(0),[Le,Ie]=c.useState(!1),[Pe,Ae]=c.useState([]),[qe,Re]=c.useState("all"),[Ee,Fe]=c.useState(null),{toast:We}=d(),Ge=async()=>{q(!0);let e=h.from("vocab_cards").select("id, term, translation, pos, ipa, context_sentence, frequency_rank, level, created_at",{count:"exact"});null!==ce&&(e=e.eq("level",ce)),r.trim()&&(e=e.or(`term.ilike.%${r}%,translation.ilike.%${r}%`));const s=(me-1)*xe,t=s+xe-1;e=e.order("created_at",{ascending:!1}).range(s,t);const{data:n,error:l,count:o}=await e;if(!l){let e=n||[];pe&&(e=[...e].sort(()=>Math.random()-.5)),a(e),he(o||0)}q(!1)},Ue=async()=>{if(0===s.length)return;const e=s.map(e=>e.id),{data:a}=await h.from("vocab_translations").select("card_id, lang, translations").in("card_id",e).eq("is_system",!0),t={};null==a||a.forEach(e=>{var s;t[e.card_id]||(t[e.card_id]={}),t[e.card_id][e.lang]=(null==(s=e.translations)?void 0:s[0])||""}),n(t)},Be=async()=>{const e=await h.from("vocab_cards").select("id",{count:"exact",head:!0}),s=await h.from("vocab_cards").select("id",{count:"exact",head:!0}).eq("is_public",!0);z({total:e.count||0,publicTotal:s.count||0})},ze=async()=>{await Ge(),await Be(),await new Promise(e=>setTimeout(e,100)),await Ue()};c.useEffect(()=>{Ge(),Be(),(async()=>{try{const{count:e}=await h.from("vocab_translation_queue").select("*",{count:"exact",head:!0}).eq("status","pending"),s=localStorage.getItem("vocabRunnerStarted");if(e&&e>0)await h.functions.invoke("process-translations",{body:{reason:"resume-pending"}}),await h.functions.invoke("kick-translations",{body:{cycles:12,parallel:3}}),we(!0),$e(!0);else if(!s){const{data:e}=await h.functions.invoke("vocab-queue-translations",{body:{onlyMissing:!0}});await h.functions.invoke("process-translations",{body:{reason:"auto-start"}}),await h.functions.invoke("kick-translations",{body:{cycles:12,parallel:3}}),localStorage.setItem("vocabRunnerStarted",(new Date).toISOString()),We({title:"Auto-translation started",description:"Processing queued translations in background."}),we(!0),$e(!0)}}catch(e){}})()},[]),c.useEffect(()=>{Ge()},[ce,me,r,pe]),c.useEffect(()=>{s.length>0&&Ue()},[s]);c.useEffect(()=>{(async()=>{const{data:e}=await h.rpc("is_admin");E(!!e)})()},[]);const Me=async(e,s)=>{await h.from("vocab_cards").update(s).eq("id",e),a(a=>a.map(a=>a.id===e?{...a,...s}:a))};return e.jsx("div",{className:`min-h-screen ${S} p-6`,children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:`${T} rounded-2xl p-6 mb-6`,children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-amber-400 to-orange-500 text-white shadow-lg",children:e.jsx(b,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h1",{className:`text-2xl font-bold ${I}`,children:"Vocabulary Manager"}),e.jsx("p",{className:P,children:"Manage vocabulary cards and translations"})]})]}),e.jsxs("button",{className:`flex items-center gap-2 px-4 py-2 rounded-xl ${L} transition-all duration-200`,onClick:ze,disabled:i,children:[e.jsx(f,{className:"w-4 h-4 "+(i?"animate-spin":"")}),i?"Loading‚Ä¶":"Refresh"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:`${T} ${C} rounded-xl p-4 transition-all duration-200`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-100",children:e.jsx(b,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${P}`,children:"Total Words"}),e.jsx("p",{className:`text-xl font-bold ${I}`,children:B.total.toLocaleString()})]})]})}),e.jsx("div",{className:`${T} ${C} rounded-xl p-4 transition-all duration-200`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-emerald-100",children:e.jsx(l,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${P}`,children:"Public Words"}),e.jsx("p",{className:`text-xl font-bold ${I}`,children:B.publicTotal.toLocaleString()})]})]})}),e.jsx("div",{className:`${T} ${C} rounded-xl p-4 transition-all duration-200`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100",children:e.jsx(m,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${P}`,children:"Languages"}),e.jsx("p",{className:`text-xl font-bold ${I}`,children:"69"})]})]})}),e.jsx("div",{className:`${T} ${C} rounded-xl p-4 transition-all duration-200`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-purple-100",children:e.jsx(j,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${P}`,children:"Current Page"}),e.jsxs("p",{className:`text-xl font-bold ${I}`,children:[me," / ",Math.ceil(ge/xe)||1]})]})]})})]}),e.jsxs("div",{className:`${T} rounded-xl p-5 mb-6`,children:[e.jsxs("h2",{className:`text-lg font-semibold ${I} mb-4 flex items-center gap-2`,children:[e.jsx(v,{className:"w-5 h-5 text-amber-500"}),"Quick Actions"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3",children:[e.jsxs("button",{className:`flex flex-col items-center gap-2 p-4 rounded-xl ${L} transition-all duration-200 ${C}`,onClick:()=>(async(e,s)=>{const a=prompt("How many words to generate? (max 1000 per batch, function will auto-resume)","500");if(!a)return;const t=Math.min(parseInt(a),1e3);if(isNaN(t)||t<1)alert("Invalid number");else{ae(!0);try{const{data:a,error:n}=await h.functions.invoke("vocab-frequency-seed",{body:{total:t,minLevel:e||1,maxLevel:s||4,languages:["en","ko","ja","zh","es","fr","de"]}});if(n||!(null==a?void 0:a.success))alert(`Generation failed: ${(null==a?void 0:a.error)||(null==n?void 0:n.message)||"Unknown error"}`);else{const e=a.isResume?`\n\nüìç Resumed from rank ${a.startedFromRank} (continuing from where you left off)`:"",s=a.skippedCount>0?`\n‚è≠Ô∏è Skipped ${a.skippedCount} words outside level range`:"";alert(`‚úÖ Successfully generated ${a.importedCount} real English words!${e}${s}\n\nüí° Click again to generate more advanced words automatically.`),ze()}}catch(n){alert(`Generation failed: ${(null==n?void 0:n.message)||"Unknown error"}`)}finally{ae(!1)}}})(),disabled:se,children:[e.jsx(u,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-medium text-center",children:se?"Generating‚Ä¶":"Generate Words"})]}),e.jsxs("button",{className:`flex flex-col items-center gap-2 p-4 rounded-xl ${L} transition-all duration-200 ${C}`,onClick:async()=>{ae(!0);try{const{data:e,error:s}=await h.functions.invoke("vocab-cefr-seed",{body:{total:8e3}});if(s||!(null==e?void 0:e.success))alert(`Generation failed: ${(null==e?void 0:e.error)||(null==s?void 0:s.message)||"Unknown error"}`);else{const s=e.isResume?`\n\nüìç Resumed from rank ${e.startedFromRank}`:"";alert(`‚úÖ Successfully generated ${e.importedCount} CEFR-graded words!${s}\n\nüí° Click again to continue generating more words automatically.`),ze()}}catch(e){alert(`Generation failed: ${(null==e?void 0:e.message)||"Unknown error"}`)}finally{ae(!1)}},disabled:se,children:[e.jsx(b,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-medium text-center",children:se?"Generating‚Ä¶":"CEFR Words"})]}),e.jsxs("button",{className:`flex flex-col items-center gap-2 p-4 rounded-xl ${L} transition-all duration-200 ${C}`,onClick:async()=>{const e=window.prompt("Enter RAW URL for IELTS/AWL wordlist (CSV or TXT)","https://raw.githubusercontent.com/anig1scur/CEFR-Vocabulary-List/slave/B2.txt");if(e){ae(!0);try{const{data:s,error:a}=await h.functions.invoke("vocab-cefr-seed",{body:{total:1e4,csvUrl:e.trim()}});if(a||!(null==s?void 0:s.success))alert(`Import failed: ${(null==s?void 0:s.error)||(null==a?void 0:a.message)||"Unknown error"}`);else{const e=s.isResume?`\n\nüìç Resumed from rank ${s.startedFromRank}`:"";alert(`‚úÖ Imported ${s.importedCount} IELTS/AWL words!${e}`),ze()}}catch(s){alert(`Import failed: ${(null==s?void 0:s.message)||"Unknown error"}`)}finally{ae(!1)}}},disabled:se,children:[e.jsx(w,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-medium text-center",children:se?"Importing‚Ä¶":"Import IELTS"})]}),e.jsxs("button",{className:"flex flex-col items-center gap-2 p-4 rounded-xl bg-orange-100 hover:bg-orange-200 text-orange-800 border border-orange-200 transition-all duration-200",onClick:async()=>{ne(!0);try{const{data:e,error:s}=await h.functions.invoke("vocab-cleanup-junk");s||!(null==e?void 0:e.success)?alert(`Cleanup failed: ${(null==e?void 0:e.error)||(null==s?void 0:s.message)||"Unknown error"}`):(alert(`‚úÖ Cleaned up ${e.deleted} junk entries (single letters, abbreviations)`),ze())}catch(e){alert(`Cleanup failed: ${(null==e?void 0:e.message)||"Unknown error"}`)}finally{ne(!1)}},disabled:te,children:[e.jsx(N,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-medium text-center",children:te?"Cleaning‚Ä¶":"Clean Junk"})]}),e.jsxs("button",{className:"flex flex-col items-center gap-2 p-4 rounded-xl bg-red-100 hover:bg-red-200 text-red-800 border border-red-200 transition-all duration-200",onClick:async()=>{if(!window.confirm("‚ö†Ô∏è Are you sure you want to DELETE ALL vocabulary words? This cannot be undone!"))return;if(window.confirm("‚ö†Ô∏è‚ö†Ô∏è FINAL WARNING: This will permanently delete ALL words and translations. Type YES to confirm.")){ne(!0);try{const{error:e}=await h.from("vocab_cards").delete().neq("id","00000000-0000-0000-0000-000000000000");e?alert(`Delete failed: ${e.message}`):(alert("‚úÖ All vocabulary words deleted successfully"),a([]),n({}),await Be())}catch(e){alert(`Delete failed: ${(null==e?void 0:e.message)||"Unknown error"}`)}finally{ne(!1)}}},disabled:te,children:[e.jsx(p,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-medium text-center",children:te?"Deleting‚Ä¶":"Delete All"})]}),e.jsxs("button",{className:"flex flex-col items-center gap-2 p-4 rounded-xl bg-indigo-100 hover:bg-indigo-200 text-indigo-800 border border-indigo-200 transition-all duration-200",onClick:async()=>{q(!0);try{const{data:e}=await h.rpc("get_translation_stats");e&&e.length>0&&Fe({total:e[0].total_translations||0,unique_cards:e[0].unique_cards||0,last_translation:e[0].last_translation||""});let s=h.from("vocab_translations").select("\n          id,\n          card_id,\n          lang,\n          translations,\n          created_at,\n          vocab_cards!inner(term, translation)\n        ").eq("is_system",!0).order("created_at",{ascending:!1}).limit(100);"all"!==qe&&(s=s.eq("lang",qe));const{data:a,error:t}=await s;if(t)throw t;Ae(a||[]),Ie(!0)}catch(e){We({title:"Failed to load translations",description:(null==e?void 0:e.message)||"Unknown error",variant:"destructive"})}finally{q(!1)}},disabled:i,children:[e.jsx(x,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-medium text-center",children:i?"Loading‚Ä¶":"View Translations"})]}),e.jsxs("button",{className:"flex flex-col items-center gap-2 p-4 rounded-xl bg-pink-100 hover:bg-pink-200 text-pink-800 border border-pink-200 transition-all duration-200",onClick:async()=>{var e,s;const{count:a}=await h.from("vocab_cards").select("id",{count:"exact",head:!0}).eq("is_public",!0).eq("language","en"),{count:t}=await h.from("vocab_images").select("id",{count:"exact",head:!0}),n=(a||0)-(t||0),r=(.003*n).toFixed(2);if(!window.confirm(`üé® Generate AI Images for Vocabulary\n\nTotal words: ${null==a?void 0:a.toLocaleString()}\nAlready have images: ${null==t?void 0:t.toLocaleString()}\nNeed images: ${n.toLocaleString()}\n\nEstimated cost: ~$${r} (Replicate Flux)\n\nImages will be stored on Cloudflare R2 (zero egress fees).\n\nContinue?`))return;le(!0),ie({generated:0,total:n});let l=0,o=null,i=!0,c=0;try{for(;i&&c<5;){console.log(`üé® Generating batch... (${l} done so far)`);const{data:a,error:t}=await h.functions.invoke("vocab-batch-images",{body:{cardsPerRun:10,continueFrom:o}});if(!t&&(null==a?void 0:a.success))c=0,l+=(null==(e=a.stats)?void 0:e.generated)||0,i=a.hasMore,o=a.continueFrom,ie({generated:l,total:n,lastCard:null==(s=a.stats)?void 0:s.lastTerm}),l%50!=0&&i||console.log(`‚úÖ Progress: ${l}/${n} images generated`),i&&await new Promise(e=>setTimeout(e,500));else{if(console.error("Batch error:",t||a),c++,c>=5){We({title:"Image Generation Paused",description:`Generated ${l} images. Click again to continue.`,variant:"destructive"});break}await new Promise(e=>setTimeout(e,3e3))}}We({title:"üéâ Image Generation Complete!",description:`Generated ${l} images for vocabulary cards.`})}catch(d){console.error("Image generation error:",d),We({title:"Image Generation Error",description:`Generated ${l} images before error. Click again to continue.`,variant:"destructive"})}finally{le(!1),ie(null)}},disabled:re,children:[e.jsx($,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-medium text-center",children:re?"Generating‚Ä¶":"Generate Images"})]})]}),oe&&e.jsxs("div",{className:"mt-4 p-3 bg-pink-50 border border-pink-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-pink-800",children:"Generating AI Images..."}),e.jsxs("span",{className:"text-sm text-pink-600",children:[oe.generated," / ",oe.total]})]}),e.jsx("div",{className:"w-full bg-pink-200 rounded-full h-2",children:e.jsx("div",{className:"bg-pink-500 h-2 rounded-full transition-all duration-300",style:{width:oe.generated/oe.total*100+"%"}})}),oe.lastCard&&e.jsxs("p",{className:"text-xs text-pink-600 mt-1",children:["Last: ",oe.lastCard]})]})]}),e.jsxs("div",{className:`${T} rounded-xl p-5 mb-6`,children:[e.jsxs("h2",{className:`text-lg font-semibold ${I} mb-4 flex items-center gap-2`,children:[e.jsx(m,{className:"w-5 h-5 text-amber-500"}),"Translation Tools"]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{className:"flex items-center gap-2 px-4 py-3 rounded-xl bg-purple-100 hover:bg-purple-200 text-purple-800 border border-purple-200 transition-all duration-200 font-medium",onClick:async()=>{console.log("üìä Checking translation status...");const{count:e}=await h.from("vocab_cards").select("*",{count:"exact",head:!0}).eq("is_public",!0).eq("language","en"),{count:s}=await h.from("vocab_translations").select("*",{count:"exact",head:!0}),{data:a}=await h.from("vocab_translations").select("lang"),t={};(a||[]).forEach(e=>{t[e.lang]=(t[e.lang]||0)+1});const n=Object.entries(t).sort((e,s)=>s[1]-e[1]).map(([e,s])=>`${e}: ${s}`).join("\n"),r=69*(e||0),l=s&&r?(s/r*100).toFixed(2):"0";alert(`üìä Translation Status\n\nTotal English words: ${e}\nTotal translations: ${s}\nExpected (69 langs): ${r}\nCoverage: ${l}%\n\nBy language:\n${n}`)},children:[e.jsx(j,{className:"w-4 h-4"}),"Check Status"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-3 rounded-xl bg-emerald-100 hover:bg-emerald-200 text-emerald-800 border border-emerald-200 transition-all duration-200 font-medium",onClick:async()=>{if(window.confirm('Queue translation jobs for 69 languages?\n\nThis uses the queue-based system.\nFor faster results, use "Smart Translate" instead.')){W(!0);try{const s=["zh","hi","es","fr","ar","bn","pt","ru","ja","ur","id","de","vi","tr","it","ko","fa","ta","th","yue","ms","te","mr","gu","kn","ml","pa","or","as","sw","ha","yo","ig","am","zu","af","pl","uk","ro","nl","el","cs","hu","sv","bg","sr","hr","sk","no","da","fi","sq","sl","et","lv","lt","uz","kk","az","mn","he","ps","ka","hy","tl","my","km","si","ne","zh-TW"],{data:a,error:t}=await h.functions.invoke("vocab-queue-translations",{body:{languages:s}});if(t||!(null==a?void 0:a.success))return console.error("‚ùå Failed to queue translation jobs",t||a),void alert((null==a?void 0:a.error)||(null==t?void 0:t.message)||"Failed to queue translation jobs");console.log("üìù Queued jobs via edge function:",a);const{count:n}=await h.from("vocab_translation_queue").select("*",{count:"exact",head:!0}).eq("status","pending"),r=n||0;alert(`‚úÖ Queued translation jobs!\n\nüìä Total pending: ${r} jobs\n\n‚ö†Ô∏è IMPORTANT: Keep this tab open!\nTranslations will process automatically.\nDo not close or refresh the page.`);let l=0;const o=r;let i=0;const c=5;let d=0;const m=3;for(console.log(`üöÄ Starting translation processing: ${o} jobs`),console.log("‚ö†Ô∏è Keep this tab open - closing it will stop translations!");l<o&&i<c&&d<m;)try{console.log(`üîÑ Calling process-translations... (${l}/${o})`);const e=Date.now(),{data:s,error:a}=await h.functions.invoke("process-translations",{body:{}}),t=Date.now()-e;console.log(`üì¶ Response (${t}ms):`,JSON.stringify({data:s,error:a},null,2));const{count:n}=await h.from("vocab_translation_queue").select("*",{count:"exact",head:!0}).eq("status","pending"),r=n||0;if(console.log(`üìä Remaining pending jobs: ${r}`),a)console.error("‚ùå Edge Function Error:",{message:a.message,status:a.status,statusText:a.statusText,details:a}),i++;else if(!(null==s?void 0:s.success)){if(console.error("‚ùå Translation batch failed:",{data:s}),i++,i>=c){alert(`‚ùå Translation stopped after ${c} consecutive failures.\n\nProcessed: ${l}/${o} translations\n\nYou can click the button again to resume from where it left off.`);break}await new Promise(e=>setTimeout(e,5e3));continue}if(i=0,r===o-l){if(d++,console.log(`‚ö†Ô∏è Empty batch detected (${d}/${m})`),d>=m){console.log("‚úÖ All jobs completed (no more pending jobs)"),l=o;break}}else d=0;l=o-r;const u=Math.round(l/o*100);if(console.log(`üìä Translation progress: ${u}% (${l}/${o})`),l%500!=0&&l!==o&&0!==r||console.log(`‚úÖ Processed ${l}/${o} translations (${r} remaining)`),0===r){console.log("üéâ All translations completed!"),l=o;break}await new Promise(e=>setTimeout(e,1e3))}catch(e){if(console.error("Batch processing error:",e),i++,i>=c){alert(`‚ùå Translation stopped due to errors.\n\nProcessed: ${l}/${o} translations\n\nError: ${e.message}`);break}await new Promise(e=>setTimeout(e,3e3))}const{count:u}=await h.from("vocab_translation_queue").select("*",{count:"exact",head:!0}).eq("status","pending");if(0===(u||0)||l>=o)alert(`üéâ Translation completed successfully!\n\n‚úÖ Processed: ${l} translations\nüåç Languages: 23\n‚úÖ No pending jobs remaining\n\nAll translations are now available!`);else{const{count:e}=await h.from("vocab_translation_queue").select("*",{count:"exact",head:!0}).eq("status","pending");alert(`‚ö†Ô∏è Translation incomplete\n\n‚úÖ Processed: ${l}/${o}\n‚è∏Ô∏è Still pending: ${e||0} jobs\n\n${i>=c?"‚ùå Stopped due to errors":"‚è∏Ô∏è Processing paused"}\n\nClick "üåç Translate All" again to resume.`)}Ue(),ze()}catch(s){alert(`Failed: ${(null==s?void 0:s.message)||"Unknown error"}`)}finally{W(!1)}}},disabled:F,children:[e.jsx(x,{className:"w-4 h-4"}),F?"Queuing‚Ä¶":"Queue Translations"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-3 rounded-xl bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white shadow-lg shadow-amber-200/50 transition-all duration-200 font-semibold",onClick:async()=>{if(!window.confirm("üöÄ Smart Batch Translation (2 Workers)\n\nThis will translate vocabulary words to 69 languages with example sentences.\n\nFeatures:\n‚Ä¢ 2 concurrent workers (3-4x faster)\n‚Ä¢ 15 cards √ó 69 languages per batch\n‚Ä¢ 15 parallel language processing\n‚Ä¢ Auto-resumes from where it left off\n\nEstimated: ~8-12 hours for full translation\nCost: ~$11 total\n\nContinue?"))return;W(!0);let e=0,s=0,a=0,t=!1;try{const n=setInterval(()=>{if(a>0){const a=Math.round((7972-s)/15*20/60);We({title:"‚ö° 2 Workers Active",description:`${e.toLocaleString()} translations (${s} cards) ~${a}min remaining`})}},3e4);console.log("üöÄ Starting 2 workers..."),We({title:"üöÄ Starting 2 Workers",description:"Translation running in parallel for maximum speed..."});const r=await Promise.all(Array.from({length:2},(n,r)=>(async n=>{var r,l,o,i,c,d;let m=null,u=0,x=0,g=0,p=0;for(;u<300&&x<3&&!t;){let f,j;u++,console.log(`üîß Worker ${n} - Batch ${u}...`);try{const e=await h.functions.invoke("vocab-batch-translate-v2",{body:{cardsPerRun:15,parallelLanguages:15,batchSize:15,continueFrom:m}});f=e.data,j=e.error,x=0}catch(b){if(console.error(`Worker ${n} fetch error:`,b),x++,x<3){await new Promise(e=>setTimeout(e,3e3));continue}break}if(j||!(null==f?void 0:f.success)){if(console.error(`Worker ${n} batch error:`,j||f),x++,x<3){await new Promise(e=>setTimeout(e,3e3));continue}break}if(g+=(null==(r=f.stats)?void 0:r.translations)||0,p+=(null==(l=f.stats)?void 0:l.cardsProcessed)||0,e+=(null==(o=f.stats)?void 0:o.translations)||0,s+=(null==(i=f.stats)?void 0:i.cardsProcessed)||0,a++,console.log(`‚úÖ Worker ${n} Batch ${u}: ${null==(c=f.stats)?void 0:c.translations} translations (${null==(d=f.stats)?void 0:d.duration}ms)`),f.completed||!f.hasMore){console.log(`üéâ Worker ${n} finished - no more cards!`),t=!0;break}m=f.continueFrom,await new Promise(e=>setTimeout(e,300+100*n))}return{workerId:n,batchCount:u,translations:g,cards:p}})(r+1)));clearInterval(n);const l=r.reduce((e,s)=>e+s.batchCount,0);console.log("üìä Final Results:",r),We({title:t?"üéâ Translation Complete!":"‚è∏Ô∏è Translation Paused",description:`${e.toLocaleString()} translations across ${s} cards (${l} batches)`}),ze()}catch(n){We({title:"Translation Error",description:`Completed ${e} translations before error. Click again to continue.`,variant:"destructive"})}finally{W(!1)}},disabled:F,children:[e.jsx(v,{className:"w-4 h-4"}),F?"Translating (2 Workers)‚Ä¶":"Smart Translate ‚ö°"]})]})]}),(G||Z)&&e.jsxs("div",{className:`${T} rounded-xl p-4 mb-6`,children:[G&&e.jsxs("div",{className:`text-sm ${P} mb-2`,children:["Progress: ",G.completed||0," / ",G.total||0,G.last_term&&` ‚Ä¢ Last: ${G.last_term}`,G.last_error&&e.jsxs("span",{className:"text-red-500",children:[" ‚Ä¢ Error: ",G.last_error]})]}),Z&&e.jsxs("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"text-sm font-medium text-blue-800 mb-1",children:["Audit Results (",Z.type,")"]}),e.jsxs("div",{className:"text-xs text-blue-700",children:["levels"===Z.type&&e.jsxs("span",{children:["Words: ",Z.data.totalWords," ‚Ä¢ Invalid: ",Z.data.invalidLevels]}),"translations"===Z.type&&e.jsxs("span",{children:["No trans: ",Z.data.noTranslations," ‚Ä¢ Partial: ",Z.data.partialTranslations," ‚Ä¢ Full: ",Z.data.fullTranslations]})]})]})]}),e.jsxs("div",{className:`${T} rounded-xl p-5 mb-6`,children:[e.jsxs("h2",{className:`text-lg font-semibold ${I} mb-4 flex items-center gap-2`,children:[e.jsx(g,{className:"w-5 h-5 text-amber-500"}),"Add New Word"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-3 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:`text-xs font-medium ${P} mb-1 block`,children:"Term *"}),e.jsx("input",{className:`w-full px-3 py-2 rounded-lg ${A} border focus:ring-2 transition-all`,placeholder:"e.g., serendipity",value:M,onChange:e=>O(e.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:`text-xs font-medium ${P} mb-1 block`,children:"Translation"}),e.jsx("input",{className:`w-full px-3 py-2 rounded-lg ${A} border focus:ring-2 transition-all`,placeholder:"Translation",value:D,onChange:e=>V(e.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:`text-xs font-medium ${P} mb-1 block`,children:"POS"}),e.jsx("input",{className:`w-full px-3 py-2 rounded-lg ${A} border focus:ring-2 transition-all`,placeholder:"noun, verb...",value:Q,onChange:e=>J(e.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:`text-xs font-medium ${P} mb-1 block`,children:"IPA"}),e.jsx("input",{className:`w-full px-3 py-2 rounded-lg ${A} border focus:ring-2 transition-all`,placeholder:"/Àåser…ônÀàd…™p…ôti/",value:K,onChange:e=>Y(e.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:`text-xs font-medium ${P} mb-1 block`,children:"Context"}),e.jsx("input",{className:`w-full px-3 py-2 rounded-lg ${A} border focus:ring-2 transition-all`,placeholder:"Example sentence",value:H,onChange:e=>X(e.target.value)})]}),e.jsxs("button",{className:`px-4 py-2 rounded-lg ${_} font-medium transition-all duration-200 flex items-center justify-center gap-2`,onClick:async()=>{if(!M.trim())return void alert("Enter a term");const{data:{user:e}}=await h.auth.getUser();if(!e)return void alert("You must be signed in");const s={user_id:e.id,term:M.trim(),translation:D.trim()||null,pos:Q.trim()||null,ipa:K.trim()||null,context_sentence:H.trim()||null,language:"en"},{data:t,error:n}=await h.from("vocab_cards").insert(s).select("id, term, translation, pos, ipa, context_sentence, frequency_rank, created_at").single();n?alert(n.message):(a(e=>[t,...e]),O(""),V(""),J(""),Y(""),X(""),await Be())},children:[e.jsx(g,{className:"w-4 h-4"}),"Add"]})]})]}),e.jsx("div",{className:`${T} rounded-xl p-5 mb-6`,children:e.jsxs("div",{className:"flex gap-3 items-center flex-wrap",children:[e.jsxs("div",{className:"flex-1 min-w-[250px] relative",children:[e.jsx(y,{className:`absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 ${P}`}),e.jsx("input",{value:r,onChange:e=>{o(e.target.value),ue(1)},placeholder:"Search terms or translations‚Ä¶",className:`w-full pl-10 pr-4 py-2.5 rounded-lg ${A} border focus:ring-2 transition-all`})]}),e.jsxs("button",{onClick:()=>{be(!pe)},className:`px-4 py-2.5 rounded-lg font-medium transition-all duration-200 ${pe?"bg-amber-500 text-white":L}`,children:["üîÄ ",pe?"Shuffled":"Shuffle"]}),e.jsxs("select",{value:ce||"",onChange:e=>{de(e.target.value?parseInt(e.target.value):null),ue(1)},className:`px-4 py-2.5 rounded-lg ${A} border focus:ring-2 transition-all`,children:[e.jsx("option",{value:"",children:"All Levels"}),e.jsx("option",{value:"1",children:"A1 - Beginner"}),e.jsx("option",{value:"2",children:"A2 - Elementary"}),e.jsx("option",{value:"3",children:"B1 - Intermediate"}),e.jsx("option",{value:"4",children:"B2 - Upper Intermediate"})]}),e.jsxs("div",{className:`text-sm ${P} px-3 py-2 rounded-lg bg-amber-50`,children:["Showing ",e.jsx("span",{className:"font-semibold text-amber-700",children:s.length})," of ",e.jsx("span",{className:"font-semibold text-amber-700",children:ge.toLocaleString()})," words"]})]})}),e.jsxs("div",{className:`${T} rounded-xl overflow-hidden mb-6`,children:[e.jsxs("div",{className:"flex gap-3 items-center justify-between p-4 border-b border-amber-100",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>ue(Math.max(1,me-1)),disabled:1===me||i,className:`px-4 py-2 rounded-lg font-medium transition-all duration-200 ${L} disabled:opacity-50 disabled:cursor-not-allowed`,children:"‚Üê Previous"}),e.jsx("button",{onClick:()=>ue(me+1),disabled:me*xe>=ge||i,className:`px-4 py-2 rounded-lg font-medium transition-all duration-200 ${L} disabled:opacity-50 disabled:cursor-not-allowed`,children:"Next ‚Üí"})]}),e.jsxs("div",{className:`text-sm ${P}`,children:["Page ",e.jsx("span",{className:"font-semibold",children:me})," of ",e.jsx("span",{className:"font-semibold",children:Math.ceil(ge/xe)||1})]})]}),e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gradient-to-r from-amber-50 to-orange-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:`text-left p-3 font-semibold ${I}`,children:"Term"}),e.jsx("th",{className:`text-left p-3 font-semibold ${I}`,children:"Translations"}),e.jsx("th",{className:`text-left p-3 font-semibold ${I}`,children:"POS"}),e.jsx("th",{className:`text-left p-3 font-semibold ${I}`,children:"IPA"}),e.jsx("th",{className:`text-left p-3 font-semibold ${I}`,children:"Context"}),e.jsx("th",{className:`text-left p-3 font-semibold ${I}`,children:"Level"}),e.jsx("th",{className:`text-left p-3 font-semibold ${I}`,children:"Freq"}),e.jsx("th",{className:`text-left p-3 font-semibold ${I}`,children:"Actions"})]})}),e.jsxs("tbody",{children:[s.map((s,n)=>e.jsxs("tr",{className:`border-t border-amber-100 ${n%2==0?"bg-white":"bg-amber-50/30"} hover:bg-amber-100/50 transition-colors`,children:[e.jsx("td",{className:`p-3 font-semibold ${I}`,children:s.term}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"space-y-1 max-w-xs",children:[Object.entries(t[s.id]||{}).slice(0,3).map(([s,a])=>e.jsxs("div",{className:"text-xs",children:[e.jsxs("span",{className:"font-medium text-amber-600",children:[s.toUpperCase(),":"]})," ",e.jsx("span",{className:P,children:String(a)})]},s)),Object.keys(t[s.id]||{}).length>3&&e.jsxs("div",{className:"text-xs text-amber-500",children:["+",Object.keys(t[s.id]).length-3," more"]}),(!t[s.id]||0===Object.keys(t[s.id]).length)&&e.jsx("span",{className:"text-gray-400 text-xs italic",children:"No translations"}),Object.keys(t[s.id]||{}).length>0&&e.jsxs("div",{className:"text-xs text-emerald-600 mt-1 flex items-center gap-1",children:[e.jsx(l,{className:"w-3 h-3"}),Object.keys(t[s.id]).length,"/69 languages"]})]})}),e.jsx("td",{className:"p-3",children:e.jsx("input",{className:`px-2 py-1.5 rounded-lg ${A} border w-24 text-xs`,defaultValue:s.pos||"",onBlur:e=>Me(s.id,{pos:e.target.value})})}),e.jsx("td",{className:"p-3",children:e.jsx("input",{className:`px-2 py-1.5 rounded-lg ${A} border w-28 text-xs font-mono`,defaultValue:s.ipa||"",onBlur:e=>Me(s.id,{ipa:e.target.value})})}),e.jsx("td",{className:"p-3 max-w-[280px]",children:e.jsx("textarea",{className:`px-2 py-1.5 rounded-lg ${A} border w-full text-xs resize-none`,rows:2,defaultValue:s.context_sentence||"",onBlur:e=>Me(s.id,{context_sentence:e.target.value})})}),e.jsx("td",{className:"p-3 w-20 text-center",children:e.jsxs("select",{className:`px-2 py-1.5 rounded-lg ${A} border w-full text-xs`,defaultValue:s.level||1,onChange:e=>Me(s.id,{level:parseInt(e.target.value)}),children:[e.jsx("option",{value:1,children:"A1"}),e.jsx("option",{value:2,children:"A2"}),e.jsx("option",{value:3,children:"B1"}),e.jsx("option",{value:4,children:"B2"})]})}),e.jsx("td",{className:`p-3 w-16 text-center ${P} text-xs`,children:s.frequency_rank||"-"}),e.jsx("td",{className:"p-3",children:e.jsxs("button",{className:"px-3 py-1.5 rounded-lg bg-red-100 hover:bg-red-200 text-red-700 text-xs font-medium transition-all flex items-center gap-1",onClick:()=>(async e=>{await h.from("vocab_cards").delete().eq("id",e),a(s=>s.filter(s=>s.id!==e))})(s.id),children:[e.jsx(N,{className:"w-3 h-3"}),"Delete"]})})]},s.id)),0===s.length&&e.jsx("tr",{children:e.jsx("td",{className:`p-8 text-center ${P}`,colSpan:8,children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(b,{className:"w-8 h-8 opacity-50"}),e.jsx("span",{children:"No vocabulary items found"})]})})})]})]})})]}),e.jsx(k,{open:Ne,onOpenChange:$e,progress:fe,isRunning:ve,onResume:()=>{(async(e,s=!1)=>{const a=["zh","hi","es","fr","ar","bn","pt","ru","ja","ur","id","de","vi","tr","it","ko","fa","ta","th","yue","ms","te","mr","gu","kn","ml","pa","or","as","sw","ha","yo","ig","am","zu","af","pl","uk","ro","nl","el","cs","hu","sv","bg","sr","hr","sk","no","da","fi","sq","sl","et","lv","lt","uz","kk","az","mn","he","ps","ka","hy","tl","my","km","si","ne","zh-TW"],t=null==e?void 0:e.offset;try{s||(we(!0),$e(!0),_e(0)),localStorage.setItem("vocabTranslationActive","true"),localStorage.setItem("vocabTranslationStartTime",String(Date.now()));const{data:e,error:n}=await h.functions.invoke("vocab-translate-runner",{body:{languages:a,offset:t,limit:20}});if(n||!(null==e?void 0:e.success)){const s=(null==e?void 0:e.error)||(null==n?void 0:n.message)||"Unknown error";We({title:"Translation Started with Warning",description:s,variant:"default"})}else We({title:"Translation Started!",description:`Processing ${a.length} languages. Check logs for progress. This will run in the background and auto-chain.`});we(!0)}catch(n){const e=(null==n?void 0:n.message)||"Unknown error";We({title:"Translation Error",description:e,variant:"destructive"})}})({offset:0})},canResume:!ve&&null!==ye&&fe.errors>0}),Le&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:`${T} rounded-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col`,children:[e.jsxs("div",{className:"p-5 border-b border-amber-100 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:`text-xl font-bold ${I} flex items-center gap-2`,children:[e.jsx(x,{className:"w-5 h-5 text-amber-500"}),"Translation Viewer"]}),e.jsx("p",{className:`text-sm ${P} mt-1`,children:Ee?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"font-semibold text-emerald-600",children:[Ee.total.toLocaleString()," translations"]})," across"," ",e.jsxs("span",{className:"font-semibold",children:[Ee.unique_cards.toLocaleString()," words"]})]}):"Loading stats..."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("label",{className:`flex items-center gap-2 px-4 py-2 rounded-lg ${L} cursor-pointer transition-all`,children:[e.jsx("input",{type:"checkbox",checked:Se,onChange:e=>Te(e.target.checked),className:"rounded border-amber-300"}),e.jsx("span",{className:"text-sm font-medium",children:"Auto-retry"})]}),e.jsx("button",{onClick:()=>Ie(!1),className:`px-4 py-2 rounded-lg ${_} font-medium transition-all`,children:"Close"})]})]}),e.jsxs("div",{className:"overflow-auto flex-1 p-4",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-gradient-to-r from-amber-50 to-orange-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:`text-left p-3 font-semibold ${I}`,children:"English Term"}),e.jsx("th",{className:`text-left p-3 font-semibold ${I}`,children:"Language"}),e.jsx("th",{className:`text-left p-3 font-semibold ${I}`,children:"Translations"}),e.jsx("th",{className:`text-left p-3 font-semibold ${I}`,children:"Created"})]})}),e.jsx("tbody",{children:Pe.map((s,a)=>{var t,n,r;return e.jsxs("tr",{className:(a%2==0?"bg-white":"bg-amber-50/30")+" hover:bg-amber-100/50 transition-colors",children:[e.jsxs("td",{className:"p-3 border-b border-amber-100",children:[e.jsx("div",{className:`font-semibold ${I}`,children:null==(t=s.vocab_cards)?void 0:t.term}),e.jsx("div",{className:`text-xs ${P}`,children:null==(n=s.vocab_cards)?void 0:n.translation})]}),e.jsx("td",{className:"p-3 border-b border-amber-100",children:e.jsx("span",{className:"px-2 py-1 bg-amber-100 text-amber-800 rounded-lg text-xs font-medium",children:null==(r=s.lang)?void 0:r.toUpperCase()})}),e.jsx("td",{className:"p-3 border-b border-amber-100",children:Array.isArray(s.translations)?e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.translations.slice(0,5).map((s,a)=>e.jsx("span",{className:"px-2 py-1 bg-emerald-50 text-emerald-800 rounded-lg text-xs",children:s},a)),s.translations.length>5&&e.jsxs("span",{className:`text-xs ${P}`,children:["+",s.translations.length-5," more"]})]}):e.jsx("span",{className:"text-red-600 text-xs",children:"Invalid format"})}),e.jsx("td",{className:`p-3 border-b border-amber-100 text-xs ${P}`,children:new Date(s.created_at).toLocaleString()})]},s.id)})})]}),0===Pe.length&&e.jsxs("div",{className:`text-center py-12 ${P}`,children:[e.jsx(x,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{children:"No translations found"})]})]})]})})]})})};export{q as default};
