import{r as e,j as s}from"./vendor-react-rLLBBC7n.js";import{u as a,d as t,B as r,C as l,a as i,I as n,b as d,c as o,e as c,D as m,m as x,f as u,g as h,h as p,S as g,i as j,j as b,k as v,l as N,T as f}from"./index-KxDfHqNJ.js";import{C as w,a as y,b as C}from"./collapsible-ts_KamNe.js";import{A as _}from"./AdminLayout-DGXoIbe0.js";import{aV as k,aW as P,h as S,aa as T,ax as E,aN as I,aX as L,aY as U}from"./vendor-ui-BGi_EvHx.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-charts-0DeywwxG.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";const F=()=>{const{listContent:F,createContent:A,deleteContent:G,updateContent:O,uploadAudio:W,loading:B}=a(),{toast:$}=t(),[R,z]=e.useState({}),[D,J]=e.useState(""),[M,V]=e.useState(new Set),[X,Y]=e.useState(!1),[q,H]=e.useState(20),[K,Q]=e.useState(1),[Z,ee]=e.useState(null),[se,ae]=e.useState(""),[te,re]=e.useState(""),[le,ie]=e.useState(""),[ne,de]=e.useState(null),[oe,ce]=e.useState(""),[me,xe]=e.useState(""),[ue,he]=e.useState(""),[pe,ge]=e.useState("");e.useEffect(()=>{je()},[]);const je=async()=>{try{const e=(await F("writing_prompts")).data||[],s={};for(let a=1;a<=20;a++){s[a]={number:a,sections:{}};for(let e=1;e<=4;e++)s[a].sections[e]={number:e,prompts:[],hasContent:!1}}e.forEach(e=>{var a;const t=null==(a=e.cambridge_book)?void 0:a.match(/\d+/),r=t?parseInt(t[0]):1,l=e.test_number||1;s[r]&&s[r].sections[l]&&(s[r].sections[l].prompts.push(e),s[r].sections[l].hasContent=!0)}),z(s)}catch(e){$({title:"Error",description:"Failed to load Cambridge books structure",variant:"destructive"})}},be=Object.values(R).filter(e=>{if(!D)return!0;const s=D.toLowerCase();return`cambridge ${e.number}`.includes(s)||Object.values(e.sections).some(e=>e.prompts.some(e=>{var a;return null==(a=e.title)?void 0:a.toLowerCase().includes(s)}))}).sort((e,s)=>s.number-e.number);return s.jsx(_,{title:"Cambridge IELTS Writing",children:s.jsxs("div",{className:"max-w-6xl mx-auto",children:[s.jsxs("div",{className:"flex justify-between items-center mb-8",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-4xl font-georgia font-bold text-foreground mb-2",children:"Cambridge IELTS Writing"}),s.jsx("p",{className:"text-warm-gray",children:"Manage writing prompts organized by Cambridge books 1-20"})]}),s.jsxs(r,{onClick:()=>Y(!0),className:"rounded-xl",style:{background:"var(--gradient-button)",border:"none"},children:[s.jsx(k,{className:"w-4 h-4 mr-2"}),"Create Writing Test"]})]}),s.jsx(l,{className:"mb-6 rounded-2xl border-light-border",style:{background:"var(--gradient-card)"},children:s.jsx(i,{className:"p-4",children:s.jsxs("div",{className:"relative",children:[s.jsx(P,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-warm-gray w-4 h-4"}),s.jsx(n,{placeholder:"Search books or prompts...",value:D,onChange:e=>J(e.target.value),className:"pl-10 rounded-xl border-light-border"})]})})}),s.jsx("div",{className:"space-y-4",children:be.map(e=>s.jsx(l,{className:"rounded-2xl border-light-border shadow-soft",style:{background:"var(--gradient-card)"},children:s.jsxs(w,{open:M.has(e.number),onOpenChange:()=>(e=>{const s=new Set(M);s.has(e)?s.delete(e):s.add(e),V(s)})(e.number),children:[s.jsx(y,{asChild:!0,children:s.jsx(d,{className:"cursor-pointer hover:bg-white/50 transition-colors",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[M.has(e.number)?s.jsx(S,{className:"w-5 h-5"}):s.jsx(T,{className:"w-5 h-5"}),s.jsx(E,{className:"w-5 h-5"}),s.jsxs(o,{className:"text-xl font-georgia",children:["Cambridge IELTS ",e.number]})]}),s.jsx("div",{className:"flex gap-2",children:Object.values(e.sections).map(e=>s.jsxs(c,{variant:e.hasContent?"default":"outline",className:"text-xs",children:["T",e.number]},e.number))})]})})}),s.jsx(C,{children:s.jsx(i,{className:"pt-0",children:s.jsx("div",{className:"grid gap-4",children:Object.values(e.sections).map(a=>{var t,n;return s.jsxs(l,{className:"border-light-border bg-white",children:[s.jsx(d,{className:"pb-3",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(E,{className:"w-4 h-4"}),s.jsxs("h4",{className:"font-medium",children:["Test ",a.number]}),a.hasContent&&s.jsxs(c,{variant:"outline",className:"text-xs",children:[a.prompts.length," prompts"]})]}),s.jsx("div",{className:"flex gap-2",children:a.hasContent&&s.jsxs(s.Fragment,{children:[s.jsxs(m,{children:[s.jsx(x,{asChild:!0,children:s.jsx(r,{size:"sm",variant:"outline",className:"rounded-xl",children:s.jsx(I,{className:"w-4 h-4"})})}),s.jsxs(u,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[s.jsx(h,{children:s.jsxs(p,{children:["Cambridge ",e.number," - Test ",a.number]})}),s.jsx("div",{className:"space-y-6",children:s.jsxs(l,{className:"p-4",children:[s.jsxs("h5",{className:"font-medium mb-3",children:["Writing Prompts (",a.prompts.length,")"]}),s.jsx("div",{className:"space-y-4",children:a.prompts.map(e=>s.jsx("div",{className:"border-b border-light-border pb-4 last:border-b-0",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(c,{variant:"outline",children:e.task_type}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-medium mb-2",children:e.title}),s.jsx("div",{className:"text-sm bg-gray-50 p-3 rounded-lg mb-2",children:e.prompt_text}),s.jsxs("div",{className:"flex gap-4 text-xs text-warm-gray mb-2",children:[s.jsxs("span",{children:["Words: ",e.word_limit]}),s.jsxs("span",{children:["Time: ",e.time_limit,"min"]}),s.jsxs("span",{children:["Task: ",e.task_number]})]}),e.sample_answer&&s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium mb-1",children:"Sample Answer:"}),s.jsxs("div",{className:"text-sm bg-green-50 p-3 rounded-lg",children:[e.sample_answer.substring(0,200),"..."]})]})]})]})},e.id))})]})})]})]}),s.jsx(r,{size:"sm",variant:"outline",onClick:()=>ee({...a,bookNumber:e.number}),className:"rounded-xl",children:s.jsx(L,{className:"w-4 h-4"})}),s.jsx(r,{size:"sm",variant:"destructive",onClick:()=>(async(e,s)=>{var a;if(confirm(`Are you sure you want to delete all content from Cambridge ${e}, Test ${s}?`))try{const t=null==(a=R[e])?void 0:a.sections[s];if(!t)return;for(const e of t.prompts)await G("writing_prompts",e.id);$({title:"Success",description:"Section content deleted successfully"}),je()}catch(t){$({title:"Error",description:"Failed to delete section content",variant:"destructive"})}})(e.number,a.number),className:"rounded-xl",children:s.jsx(U,{className:"w-4 h-4"})})]})})]})}),a.hasContent?s.jsx(i,{className:"pt-0",children:s.jsxs("div",{className:"text-sm text-warm-gray",children:[s.jsxs("p",{children:["Prompts: ",a.prompts.length]}),s.jsxs("p",{children:["Last updated: ",new Date((null==(t=a.prompts[0])?void 0:t.updated_at)||(null==(n=a.prompts[0])?void 0:n.created_at)).toLocaleDateString()]})]})}):s.jsx(i,{className:"pt-0",children:s.jsxs("div",{className:"text-center py-6 text-warm-gray",children:[s.jsx(E,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),s.jsx("p",{className:"text-sm",children:"No content yet"}),s.jsx("p",{className:"text-xs",children:"Upload prompts to add content"})]})})]},a.number)})})})})]})},e.number))}),s.jsx(m,{open:X,onOpenChange:Y,children:s.jsxs(u,{className:"max-w-4xl max-h-[85vh] overflow-y-auto",children:[s.jsx(h,{children:s.jsxs(p,{children:["Create Writing Test - Cambridge ",q,", Test ",K]})}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Cambridge Book"}),s.jsxs(g,{value:q.toString(),onValueChange:e=>H(parseInt(e)),children:[s.jsx(j,{className:"rounded-xl border-light-border",children:s.jsx(b,{})}),s.jsx(v,{className:"rounded-xl border-light-border bg-card",children:Array.from({length:20},(e,s)=>20-s).map(e=>s.jsxs(N,{value:e.toString(),children:["Cambridge ",e]},e))})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Test"}),s.jsxs(g,{value:K.toString(),onValueChange:e=>Q(parseInt(e)),children:[s.jsx(j,{className:"rounded-xl border-light-border",children:s.jsx(b,{})}),s.jsx(v,{className:"rounded-xl border-light-border bg-card",children:Array.from({length:4},(e,s)=>s+1).map(e=>s.jsxs(N,{value:e.toString(),children:["Test ",e]},e))})]})]})]}),s.jsxs(l,{className:"rounded-2xl border-light-border",style:{background:"white"},children:[s.jsx(d,{children:s.jsxs(o,{className:"flex items-center gap-2 text-foreground",children:[s.jsx(E,{className:"w-5 h-5"}),"Part 1 (Visual Task)"]})}),s.jsxs(i,{className:"space-y-4",children:[s.jsx(n,{placeholder:"Part 1 Title (e.g., 'Task 1: Bar Chart Analysis')",value:se,onChange:e=>ae(e.target.value),className:"rounded-xl border-light-border"}),s.jsx(f,{placeholder:"Part 1 prompt text...",value:te,onChange:e=>re(e.target.value),rows:4,className:"rounded-xl border-light-border"}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("label",{className:"block text-sm font-medium text-foreground",children:"Part 1 Image Upload (PNG, JPG, JPEG only)"}),s.jsx("div",{className:"border-2 border-dashed border-light-border rounded-xl p-6 hover:border-primary/50 transition-colors",children:s.jsxs("div",{className:"text-center",children:[s.jsxs(r,{type:"button",variant:"default",onClick:()=>{var e;return null==(e=document.getElementById("part1-image-upload"))?void 0:e.click()},className:"rounded-xl h-14 px-8 text-sm font-semibold",style:{background:"var(--gradient-button)",border:"none"},children:[s.jsx(k,{className:"w-5 h-5 mr-2"}),ne?"Change Image":"Upload Chart/Graph Image"]}),s.jsx("p",{className:"text-xs text-warm-gray mt-2",children:"PNG, JPG, JPEG only â€¢ Max 10MB â€¢ No PDF files"})]})}),s.jsx("input",{id:"part1-image-upload",type:"file",accept:"image/png,image/jpg,image/jpeg",onChange:e=>{var s;const a=null==(s=e.target.files)?void 0:s[0];if(a){if(!["image/png","image/jpg","image/jpeg"].includes(a.type))return $({title:"Invalid File Type",description:"Please upload PNG, JPG, or JPEG images only.",variant:"destructive"}),void(e.target.value="");if(a.size>10485760)return $({title:"File Too Large",description:"Please upload an image smaller than 10MB.",variant:"destructive"}),void(e.target.value="");de(a),ce(""),$({title:"Image Selected",description:`${a.name} ready for upload`})}},className:"hidden"}),ne&&s.jsxs("div",{className:"bg-white border border-light-border rounded-xl p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("span",{className:"text-sm font-medium text-foreground",children:"Image Preview:"}),s.jsxs("span",{className:"text-xs text-green-600 font-medium",children:["âœ… ",ne.name," (",(ne.size/1024/1024).toFixed(2)," MB)"]})]}),s.jsx("img",{src:URL.createObjectURL(ne),alt:"Part 1 preview",className:"max-w-full max-h-48 object-contain border border-gray-200 rounded-lg shadow-sm mx-auto"})]}),s.jsx("div",{className:"text-center text-sm text-warm-gray",children:s.jsx("span",{className:"font-medium",children:"OR"})}),s.jsx(n,{placeholder:"Enter image URL (alternative to file upload)",value:oe,onChange:e=>{ce(e.target.value),e.target.value&&de(null)},className:"rounded-xl border-light-border"}),oe&&!ne&&s.jsxs("div",{className:"bg-white border border-light-border rounded-xl p-4",children:[s.jsx("p",{className:"text-sm font-medium text-foreground mb-2",children:"URL Preview:"}),s.jsx("img",{src:oe,alt:"Part 1 URL preview",className:"max-w-full max-h-48 object-contain border border-gray-200 rounded-lg shadow-sm mx-auto",onError:()=>{$({title:"Invalid Image URL",description:"Please check the image URL and try again.",variant:"destructive"})}})]})]}),s.jsx(f,{placeholder:"Band 9 model answer for Part 1",value:le,onChange:e=>ie(e.target.value),rows:6,className:"rounded-xl border-light-border"})]})]}),s.jsxs(l,{className:"rounded-2xl border-light-border",style:{background:"white"},children:[s.jsx(d,{children:s.jsxs(o,{className:"flex items-center gap-2 text-foreground",children:[s.jsx(E,{className:"w-5 h-5"}),"Part 2 (Essay Task)"]})}),s.jsxs(i,{className:"space-y-4",children:[s.jsx(n,{placeholder:"Part 2 Title (e.g., 'Task 2: Opinion Essay')",value:me,onChange:e=>xe(e.target.value),className:"rounded-xl border-light-border"}),s.jsx(f,{placeholder:"Part 2 prompt text...",value:ue,onChange:e=>he(e.target.value),rows:4,className:"rounded-xl border-light-border"}),s.jsx(f,{placeholder:"Band 9 model answer for Part 2",value:pe,onChange:e=>ge(e.target.value),rows:8,className:"rounded-xl border-light-border"})]})]}),s.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:[s.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Test Configuration"}),s.jsxs("div",{className:"text-sm text-blue-700 space-y-1",children:[s.jsx("p",{children:"â€¢ Total time: 60 minutes for both parts"}),s.jsx("p",{children:"â€¢ No word limit restrictions"}),s.jsx("p",{children:"â€¢ Part 1: Visual data analysis task"}),s.jsx("p",{children:"â€¢ Part 2: Academic essay task"})]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx(r,{onClick:async()=>{try{if(!(se&&te&&me&&ue))return void $({title:"Error",description:"Please provide titles and texts for both Part 1 and Part 2",variant:"destructive"});let s=oe;if(ne){console.log("ðŸ“¸ Uploading Part 1 image...",ne.name);try{const e=await W(ne);e.success?(s=e.url,console.log("âœ… Part 1 image uploaded successfully:",s)):$({title:"Image Upload Failed",description:"Failed to upload Part 1 image. Continuing without image.",variant:"destructive"})}catch(e){console.error("âŒ Image upload error:",e),$({title:"Image Upload Error",description:"Error uploading image. Continuing without image.",variant:"destructive"})}}const a={title:se,prompt_text:te,task_type:"Task 1",task_number:1,word_limit:null,time_limit:60,sample_answer:le,test_number:K,cambridge_book:`C${q}`,image_url:s||null},t={title:me,prompt_text:ue,task_type:"Task 2",task_number:2,word_limit:null,time_limit:60,sample_answer:pe,test_number:K,cambridge_book:`C${q}`,image_url:null};console.log("ðŸ“ Creating writing prompts:",{part1Data:a,part2Data:t}),await A("writing_prompts",a),await A("writing_prompts",t),$({title:"Success",description:`Writing test created with Part 1${s?" (with image)":""} and Part 2 for Cambridge ${q}, Test ${K}`}),ae(""),re(""),ie(""),de(null),ce(""),xe(""),he(""),ge(""),Y(!1),je()}catch(s){$({title:"Error",description:s.message||"Failed to upload prompts",variant:"destructive"})}},disabled:B,className:"rounded-xl flex-1",style:{background:"var(--gradient-button)",border:"none"},children:"Create Writing Test"}),s.jsx(r,{variant:"outline",onClick:()=>Y(!1),className:"rounded-xl flex-1",children:"Cancel"})]})]})]})}),Z&&s.jsx(m,{open:!!Z,onOpenChange:()=>ee(null),children:s.jsxs(u,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[s.jsx(h,{children:s.jsxs(p,{children:["Edit Cambridge ",Z.bookNumber," - Test ",Z.number]})}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-4",children:"Prompts"}),Z.prompts.map((e,a)=>s.jsx(l,{className:"p-4 mb-4",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Title"}),s.jsx(n,{value:e.title,onChange:e=>{const s={...Z};s.prompts[a].title=e.target.value,ee(s)},className:"mt-1"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Prompt Text"}),s.jsx(f,{value:e.prompt_text,onChange:e=>{const s={...Z};s.prompts[a].prompt_text=e.target.value,ee(s)},rows:4,className:"mt-1"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Minimum Word Count"}),s.jsx(n,{type:"number",value:e.word_limit,onChange:e=>{const s={...Z};s.prompts[a].word_limit=parseInt(e.target.value),ee(s)},placeholder:"task1"===e.task_type?"150":"250",className:"mt-1"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Time Limit (minutes)"}),s.jsx(n,{type:"number",value:e.time_limit,onChange:e=>{const s={...Z};s.prompts[a].time_limit=parseInt(e.target.value),ee(s)},className:"mt-1"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Sample Answer"}),s.jsx(f,{value:e.sample_answer,onChange:e=>{const s={...Z};s.prompts[a].sample_answer=e.target.value,ee(s)},rows:6,className:"mt-1"})]})]})},e.id))]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx(r,{onClick:async()=>{if(Z)try{for(const e of Z.prompts)await O("writing_prompts",{id:e.id,title:e.title,prompt_text:e.prompt_text,sample_answer:e.sample_answer,word_limit:e.word_limit,time_limit:e.time_limit});$({title:"Success",description:"Section updated successfully"}),ee(null),je()}catch(e){$({title:"Error",description:"Failed to update section",variant:"destructive"})}},disabled:B,className:"rounded-xl",style:{background:"var(--gradient-button)",border:"none"},children:"Save Changes"}),s.jsx(r,{variant:"outline",onClick:()=>ee(null),className:"rounded-xl",children:"Cancel"})]})]})]})})]})})};export{F as default};
