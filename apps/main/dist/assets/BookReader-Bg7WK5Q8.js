import{c as e,r as s,j as a,aR as t,aA as r,aT as o,aX as l,X as i,aV as n,aW as c,aY as d,aQ as m,aZ as x,aK as h,G as p,u,bt as j,aa as f,cf as b,e as N,B as g,bn as w,ar as v,b1 as y,C as k,a as _,al as C,ap as B,Q as S,k as z,a7 as R}from"./index-B-HVUhJA.js";import{S as T}from"./scroll-area-phRw4BTh.js";import{S as A}from"./separator-Cqk6rh3G.js";import{s as M}from"./supabase-DWL4C3fA.js";import{B as q}from"./building-2-OpGyabrm.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=e("BookMarked",[["path",{d:"M10 2v8l3-3 3 3V2",key:"sqw3rj"}],["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]),H=d,L=m,G=x,P=s.forwardRef(({className:e,...s},o)=>a.jsx(t,{className:r("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s,ref:o}));P.displayName=t.displayName;const V=h("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),$=s.forwardRef(({side:e="right",className:s,children:t,...n},c)=>a.jsxs(G,{children:[a.jsx(P,{}),a.jsxs(o,{ref:c,className:r(V({side:e}),s),...n,children:[t,a.jsxs(l,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[a.jsx(i,{className:"h-4 w-4"}),a.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));$.displayName=o.displayName;const D=({className:e,...s})=>a.jsx("div",{className:r("flex flex-col space-y-2 text-center sm:text-left",e),...s});D.displayName="SheetHeader";const I=s.forwardRef(({className:e,...s},t)=>a.jsx(n,{ref:t,className:r("text-lg font-semibold text-foreground",e),...s}));I.displayName=n.displayName;s.forwardRef(({className:e,...s},t)=>a.jsx(c,{ref:t,className:r("text-sm text-muted-foreground",e),...s})).displayName=c.displayName;const Q=()=>{const{bookId:e}=p(),t=u(),[r]=j(),o="true"===r.get("preview"),[l,i]=s.useState(null),[n,c]=s.useState([]),[d,m]=s.useState(0),[x,h]=s.useState(!0),[G,P]=s.useState(!1);s.useEffect(()=>{e&&(V(),Y())},[e]);const V=async()=>{try{const{data:s,error:a}=await M.from("books").select("*").eq("id",e).maybeSingle();if(a)throw a;if(!s)return console.error("Book not found"),void Q();if("published"!==s.status&&!o)return console.error("Book is not published yet"),void Q();i(s)}catch(s){console.error("Error loading book:",s),Q()}},Q=()=>{window.history.length>1?t(-1):t("/books")},Y=async()=>{h(!0);try{let s=M.from("book_chapters").select("id, chapter_number, chapter_title, processed_content, word_count").eq("book_id",e).order("chapter_number",{ascending:!0});o||(s=s.eq("status","completed"));const{data:a,error:t}=await s;if(t)throw t;c(a||[])}catch(s){console.error("Error loading chapters:",s)}finally{h(!1)}},K=n[d],O=e=>{m(e),P(!1),window.scrollTo({top:0,behavior:"smooth"})};return x&&!l?a.jsx(f,{children:a.jsxs("div",{className:"container max-w-4xl mx-auto px-4 py-8",children:[a.jsx(b,{className:"h-12 w-3/4 mb-4"}),a.jsx(b,{className:"h-6 w-1/2 mb-8"}),a.jsx("div",{className:"space-y-4",children:[...Array(10)].map((e,s)=>a.jsx(b,{className:"h-4 w-full"},s))})]})}):l?a.jsxs(f,{children:[a.jsx(w,{title:`${l.title} | English AIdol Books`,description:l.description||`Read ${l.title} by ${l.author}`}),a.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-background to-muted/20",children:[o&&a.jsx("div",{className:"bg-amber-500/90 text-white text-center py-2 text-sm font-medium",children:"ðŸ“– Preview Mode - This book is not published yet"}),a.jsx("div",{className:"sticky top-0 z-40 bg-background/95 backdrop-blur-sm border-b",children:a.jsx("div",{className:"container max-w-4xl mx-auto px-4 py-3",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs(g,{variant:"ghost",size:"sm",onClick:Q,children:[a.jsx(v,{className:"w-4 h-4 mr-1"}),o?"Back":"Library"]}),a.jsx(A,{orientation:"vertical",className:"h-6"}),a.jsx("span",{className:"text-sm font-medium text-muted-foreground truncate max-w-[200px]",children:l.title})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("span",{className:"text-sm text-muted-foreground hidden sm:inline",children:["Chapter ",d+1," of ",n.length]}),a.jsxs(H,{open:G,onOpenChange:P,children:[a.jsx(L,{asChild:!0,children:a.jsxs(g,{variant:"outline",size:"sm",children:[a.jsx(y,{className:"w-4 h-4 mr-2"}),"Chapters"]})}),a.jsxs($,{side:"right",className:"w-80",children:[a.jsx(D,{children:a.jsxs(I,{className:"flex items-center gap-2",children:[a.jsx(E,{className:"w-5 h-5"}),"Chapters"]})}),a.jsx(T,{className:"h-[calc(100vh-100px)] mt-4",children:a.jsx("div",{className:"space-y-1 pr-4",children:n.map((e,s)=>a.jsx(g,{variant:s===d?"secondary":"ghost",className:"w-full justify-start text-left h-auto py-3",onClick:()=>O(s),children:a.jsxs("div",{children:[a.jsxs("div",{className:"font-medium",children:["Chapter ",e.chapter_number]}),e.chapter_title&&a.jsx("div",{className:"text-xs text-muted-foreground truncate",children:e.chapter_title}),e.word_count&&a.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.word_count.toLocaleString()," words"]})]})},e.id))})})]})]})]})]})})}),a.jsxs("div",{className:"container max-w-4xl mx-auto px-4 py-8",children:[0===d&&a.jsx(k,{className:"mb-8 overflow-hidden",children:a.jsxs("div",{className:"md:flex",children:[l.cover_url&&a.jsx("div",{className:"md:w-1/3",children:a.jsx("img",{src:l.cover_url,alt:l.title,className:"w-full h-64 md:h-full object-cover"})}),a.jsxs(_,{className:"p-6 "+(l.cover_url?"md:w-2/3":"w-full"),children:[a.jsx("h1",{className:"text-3xl font-bold mb-4 bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",children:l.title}),a.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground mb-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(C,{className:"w-4 h-4"}),a.jsxs("span",{children:["By ",l.author]})]}),l.company&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(q,{className:"w-4 h-4"}),a.jsx("span",{children:l.company})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(N,{className:"w-4 h-4"}),a.jsxs("span",{children:[l.total_chapters," chapters"]})]}),l.published_at&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(B,{className:"w-4 h-4"}),a.jsxs("span",{children:["Published ",(W=l.published_at,new Date(W).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}))]})]})]}),l.description&&a.jsx("p",{className:"text-muted-foreground",children:l.description})]})]})}),K?a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"text-center py-8 border-b",children:[a.jsxs("p",{className:"text-sm text-muted-foreground uppercase tracking-wider mb-2",children:["Chapter ",K.chapter_number]}),K.chapter_title&&a.jsx("h2",{className:"text-2xl font-semibold",children:K.chapter_title}),K.word_count&&a.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:[K.word_count.toLocaleString()," words"]})]}),a.jsx("article",{className:"prose prose-lg dark:prose-invert max-w-none",children:K.processed_content?(U=K.processed_content,U.split("\n\n").filter(e=>e.trim()).map((e,s)=>a.jsx("p",{className:"mb-4 leading-relaxed",children:e.trim()},s))):a.jsx("p",{className:"text-muted-foreground italic",children:"This chapter's content is not available."})}),a.jsxs("div",{className:"flex items-center justify-between pt-8 border-t",children:[a.jsxs(g,{variant:"outline",onClick:()=>{d>0&&O(d-1)},disabled:0===d,children:[a.jsx(S,{className:"w-4 h-4 mr-2"}),"Previous"]}),a.jsxs("span",{className:"text-sm text-muted-foreground",children:[d+1," / ",n.length]}),a.jsxs(g,{onClick:()=>{d<n.length-1&&O(d+1)},disabled:d===n.length-1,children:["Next",a.jsx(z,{className:"w-4 h-4 ml-2"})]})]}),d===n.length-1&&a.jsxs(k,{className:"mt-8 text-center p-8 bg-gradient-to-br from-primary/10 to-secondary/10",children:[a.jsx(N,{className:"w-12 h-12 mx-auto mb-4 text-primary"}),a.jsx("h3",{className:"text-xl font-semibold mb-2",children:"You've finished the book!"}),a.jsxs("p",{className:"text-muted-foreground mb-4",children:['Great job completing "',l.title,'"']}),a.jsxs("div",{className:"flex justify-center gap-3",children:[a.jsxs(g,{variant:"outline",onClick:()=>O(0),children:[a.jsx(R,{className:"w-4 h-4 mr-2"}),"Back to Start"]}),a.jsx(g,{onClick:Q,children:o?"Back to Admin":"Browse More Books"})]})]})]}):a.jsxs("div",{className:"text-center py-16",children:[a.jsx(N,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground"}),a.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No chapters available"}),a.jsx("p",{className:"text-muted-foreground",children:"This book doesn't have any readable chapters yet."})]})]})]})]}):a.jsx(f,{children:a.jsxs("div",{className:"container max-w-4xl mx-auto px-4 py-16 text-center",children:[a.jsx(N,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground"}),a.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Book not found"}),a.jsx("p",{className:"text-muted-foreground mb-4",children:"This book may have been removed or is not available."}),a.jsx(g,{onClick:Q,children:"Go Back"})]})});var U,W};export{Q as default};
