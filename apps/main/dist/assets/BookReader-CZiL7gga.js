import{r as e,j as s,c as a,u as t,b as r}from"./vendor-react-rLLBBC7n.js";import{N as o,s as i,y as l,aa as n,B as c,U as d,C as m,a as x}from"./index-BDl0jLJK.js";import{S as h}from"./scroll-area-DzIX_ywb.js";import{S as p}from"./separator-C0bogF69.js";import{a0 as u,a1 as j,a2 as f,X as N,a3 as b,a4 as g,a5 as v,a6 as w,a7 as y,a as k,ao as _,az as C,O as S,cD as B,U as z,cu as R,N as T,a9 as E,aa as L,aG as q}from"./vendor-ui-BGi_EvHx.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-charts-0DeywwxG.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";const A=v,D=w,G=y,P=e.forwardRef(({className:e,...a},t)=>s.jsx(u,{className:o("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...a,ref:t}));P.displayName=u.displayName;const U=k("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),$=e.forwardRef(({side:e="right",className:a,children:t,...r},i)=>s.jsxs(G,{children:[s.jsx(P,{}),s.jsxs(j,{ref:i,className:o(U({side:e}),a),...r,children:[t,s.jsxs(f,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[s.jsx(N,{className:"h-4 w-4"}),s.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));$.displayName=j.displayName;const I=({className:e,...a})=>s.jsx("div",{className:o("flex flex-col space-y-2 text-center sm:text-left",e),...a});I.displayName="SheetHeader";const M=e.forwardRef(({className:e,...a},t)=>s.jsx(b,{ref:t,className:o("text-lg font-semibold text-foreground",e),...a}));M.displayName=b.displayName;e.forwardRef(({className:e,...a},t)=>s.jsx(g,{ref:t,className:o("text-sm text-muted-foreground",e),...a})).displayName=g.displayName;const O=()=>{const{bookId:o}=a(),u=t(),[j]=r(),f="true"===j.get("preview"),[N,b]=e.useState(null),[g,v]=e.useState([]),[w,y]=e.useState(0),[k,G]=e.useState(!0),[P,U]=e.useState(!1);e.useEffect(()=>{o&&(O(),V())},[o]);const O=async()=>{try{const{data:e,error:s}=await i.from("books").select("*").eq("id",o).maybeSingle();if(s)throw s;if(!e)return console.error("Book not found"),void H();if("published"!==e.status&&!f)return console.error("Book is not published yet"),void H();b(e)}catch(e){console.error("Error loading book:",e),H()}},H=()=>{window.history.length>1?u(-1):u("/books")},V=async()=>{G(!0);try{let e=i.from("book_chapters").select("id, chapter_number, chapter_title, processed_content, word_count").eq("book_id",o).order("chapter_number",{ascending:!0});f||(e=e.eq("status","completed"));const{data:s,error:a}=await e;if(a)throw a;v(s||[])}catch(e){console.error("Error loading chapters:",e)}finally{G(!1)}},Y=g[w],F=e=>{y(e),U(!1),window.scrollTo({top:0,behavior:"smooth"})};return k&&!N?s.jsx(l,{children:s.jsxs("div",{className:"container max-w-4xl mx-auto px-4 py-8",children:[s.jsx(n,{className:"h-12 w-3/4 mb-4"}),s.jsx(n,{className:"h-6 w-1/2 mb-8"}),s.jsx("div",{className:"space-y-4",children:[...Array(10)].map((e,a)=>s.jsx(n,{className:"h-4 w-full"},a))})]})}):N?s.jsxs(l,{children:[s.jsx(d,{title:`${N.title} | English AIdol Books`,description:N.description||`Read ${N.title} by ${N.author}`}),s.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-background to-muted/20",children:[f&&s.jsx("div",{className:"bg-amber-500/90 text-white text-center py-2 text-sm font-medium",children:"ðŸ“– Preview Mode - This book is not published yet"}),s.jsx("div",{className:"sticky top-0 z-40 bg-background/95 backdrop-blur-sm border-b",children:s.jsx("div",{className:"container max-w-4xl mx-auto px-4 py-3",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs(c,{variant:"ghost",size:"sm",onClick:H,children:[s.jsx(C,{className:"w-4 h-4 mr-1"}),f?"Back":"Library"]}),s.jsx(p,{orientation:"vertical",className:"h-6"}),s.jsx("span",{className:"text-sm font-medium text-muted-foreground truncate max-w-[200px]",children:N.title})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:"text-sm text-muted-foreground hidden sm:inline",children:["Chapter ",w+1," of ",g.length]}),s.jsxs(A,{open:P,onOpenChange:U,children:[s.jsx(D,{asChild:!0,children:s.jsxs(c,{variant:"outline",size:"sm",children:[s.jsx(S,{className:"w-4 h-4 mr-2"}),"Chapters"]})}),s.jsxs($,{side:"right",className:"w-80",children:[s.jsx(I,{children:s.jsxs(M,{className:"flex items-center gap-2",children:[s.jsx(B,{className:"w-5 h-5"}),"Chapters"]})}),s.jsx(h,{className:"h-[calc(100vh-100px)] mt-4",children:s.jsx("div",{className:"space-y-1 pr-4",children:g.map((e,a)=>s.jsx(c,{variant:a===w?"secondary":"ghost",className:"w-full justify-start text-left h-auto py-3",onClick:()=>F(a),children:s.jsxs("div",{children:[s.jsxs("div",{className:"font-medium",children:["Chapter ",e.chapter_number]}),e.chapter_title&&s.jsx("div",{className:"text-xs text-muted-foreground truncate",children:e.chapter_title}),e.word_count&&s.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.word_count.toLocaleString()," words"]})]})},e.id))})})]})]})]})]})})}),s.jsxs("div",{className:"container max-w-4xl mx-auto px-4 py-8",children:[0===w&&s.jsx(m,{className:"mb-8 overflow-hidden",children:s.jsxs("div",{className:"md:flex",children:[N.cover_url&&s.jsx("div",{className:"md:w-1/3",children:s.jsx("img",{src:N.cover_url,alt:N.title,className:"w-full h-64 md:h-full object-cover"})}),s.jsxs(x,{className:"p-6 "+(N.cover_url?"md:w-2/3":"w-full"),children:[s.jsx("h1",{className:"text-3xl font-bold mb-4 bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",children:N.title}),s.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground mb-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(z,{className:"w-4 h-4"}),s.jsxs("span",{children:["By ",N.author]})]}),N.company&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(R,{className:"w-4 h-4"}),s.jsx("span",{children:N.company})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(_,{className:"w-4 h-4"}),s.jsxs("span",{children:[N.total_chapters," chapters"]})]}),N.published_at&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(T,{className:"w-4 h-4"}),s.jsxs("span",{children:["Published ",(K=N.published_at,new Date(K).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}))]})]})]}),N.description&&s.jsx("p",{className:"text-muted-foreground",children:N.description})]})]})}),Y?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center py-8 border-b",children:[s.jsxs("p",{className:"text-sm text-muted-foreground uppercase tracking-wider mb-2",children:["Chapter ",Y.chapter_number]}),Y.chapter_title&&s.jsx("h2",{className:"text-2xl font-semibold",children:Y.chapter_title}),Y.word_count&&s.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:[Y.word_count.toLocaleString()," words"]})]}),s.jsx("article",{className:"prose prose-lg dark:prose-invert max-w-none",children:Y.processed_content?(J=Y.processed_content,J.split("\n\n").filter(e=>e.trim()).map((e,a)=>s.jsx("p",{className:"mb-4 leading-relaxed",children:e.trim()},a))):s.jsx("p",{className:"text-muted-foreground italic",children:"This chapter's content is not available."})}),s.jsxs("div",{className:"flex items-center justify-between pt-8 border-t",children:[s.jsxs(c,{variant:"outline",onClick:()=>{w>0&&F(w-1)},disabled:0===w,children:[s.jsx(E,{className:"w-4 h-4 mr-2"}),"Previous"]}),s.jsxs("span",{className:"text-sm text-muted-foreground",children:[w+1," / ",g.length]}),s.jsxs(c,{onClick:()=>{w<g.length-1&&F(w+1)},disabled:w===g.length-1,children:["Next",s.jsx(L,{className:"w-4 h-4 ml-2"})]})]}),w===g.length-1&&s.jsxs(m,{className:"mt-8 text-center p-8 bg-gradient-to-br from-primary/10 to-secondary/10",children:[s.jsx(_,{className:"w-12 h-12 mx-auto mb-4 text-primary"}),s.jsx("h3",{className:"text-xl font-semibold mb-2",children:"You've finished the book!"}),s.jsxs("p",{className:"text-muted-foreground mb-4",children:['Great job completing "',N.title,'"']}),s.jsxs("div",{className:"flex justify-center gap-3",children:[s.jsxs(c,{variant:"outline",onClick:()=>F(0),children:[s.jsx(q,{className:"w-4 h-4 mr-2"}),"Back to Start"]}),s.jsx(c,{onClick:H,children:f?"Back to Admin":"Browse More Books"})]})]})]}):s.jsxs("div",{className:"text-center py-16",children:[s.jsx(_,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground"}),s.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No chapters available"}),s.jsx("p",{className:"text-muted-foreground",children:"This book doesn't have any readable chapters yet."})]})]})]})]}):s.jsx(l,{children:s.jsxs("div",{className:"container max-w-4xl mx-auto px-4 py-16 text-center",children:[s.jsx(_,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground"}),s.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Book not found"}),s.jsx("p",{className:"text-muted-foreground mb-4",children:"This book may have been removed or is not available."}),s.jsx(c,{onClick:H,children:"Go Back"})]})});var J,K};export{O as default};
