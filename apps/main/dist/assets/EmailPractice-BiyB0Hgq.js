import{u as e,a3 as s,h as a,a1 as r,r as l,j as t,a4 as c,bh as i,a5 as o,ao as n,k as d,C as m,b as x,d as h,a2 as u,y as p,a as g,l as j,B as f,c0 as b,c1 as y,z as N,T as v,a0 as k,K as w,N as _,ar as C,e as S}from"./index-BcRn0esQ.js";import{s as B}from"./supabase-DWL4C3fA.js";import{L as P}from"./lightbulb-Bkzct_M8.js";import{C as E}from"./circle-alert-CJuYMXEg.js";import{R as I}from"./refresh-cw-DDtYc-g_.js";const F=[{id:"business",label:"Business",icon:"ðŸ’¼"},{id:"tech",label:"Technology",icon:"ðŸ’»"},{id:"healthcare",label:"Healthcare",icon:"ðŸ¥"},{id:"general",label:"General",icon:"ðŸ“§"}],z=[{id:"basic",label:"Basic",color:"bg-green-100 text-green-700"},{id:"intermediate",label:"Intermediate",color:"bg-yellow-100 text-yellow-700"},{id:"advanced",label:"Advanced",color:"bg-red-100 text-red-700"}],M=()=>{var M;const q=e(),{user:A}=s(),{toast:T}=a(),D=r(),[V,R]=l.useState(!0),[G,U]=l.useState(!1),[W,Y]=l.useState(!1),[$,L]=l.useState(""),[O,H]=l.useState("business"),[K,J]=l.useState("intermediate"),[Q,X]=l.useState(null),[Z,ee]=l.useState(""),[se,ae]=l.useState(null),[re,le]=l.useState(!1),[te,ce]=l.useState(0),[ie,oe]=l.useState(null);l.useEffect(()=>{(async()=>{if(A)try{const{data:e}=await B.from("business_profiles").select("occupation, industry").eq("user_id",A.id).maybeSingle();e&&L(e.occupation);const{data:s,error:a}=await B.from("email_practice_sessions").select("overall_score").eq("user_id",A.id).not("overall_score","is",null);if(s&&s.length>0){ce(s.length);const e=s.reduce((e,s)=>e+(s.overall_score||0),0)/s.length;oe(Math.round(e))}}catch(e){console.error("Error loading user data:",e)}finally{R(!1)}else R(!1)})()},[A]);const ne=e=>e>=80?"text-green-600":e>=60?"text-yellow-600":"text-red-600";return V?t.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:D.theme.colors.background},children:t.jsx(c,{})}):t.jsxs("div",{className:"min-h-screen",style:{backgroundColor:D.theme.colors.background},children:[t.jsx(i,{title:"Email Practice - Business English",description:"Master professional email writing with AI-powered feedback. Practice various business scenarios.",keywords:"email writing, business email, professional communication, email practice"}),t.jsx(o,{title:"Email Practice",showBackButton:!0,backPath:"/business-portal",children:t.jsxs("div",{className:"max-w-6xl mx-auto px-4 space-y-6",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[t.jsx("button",{onClick:()=>q("/hero"),className:"text-muted-foreground hover:text-primary",children:t.jsx(n,{className:"h-4 w-4"})}),t.jsx(d,{className:"h-4 w-4 text-muted-foreground"}),t.jsx("button",{onClick:()=>q("/business-portal"),className:"text-muted-foreground hover:text-primary",children:"Business English"}),t.jsx(d,{className:"h-4 w-4 text-muted-foreground"}),t.jsx("span",{style:{color:D.textPrimary},children:"Email Practice"})]}),t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold",style:{color:D.textPrimary},children:"Email Practice"}),t.jsx("p",{className:"text-muted-foreground",children:"Master professional email communication"})]}),t.jsxs("div",{className:"flex gap-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-2xl font-bold",style:{color:D.textPrimary},children:te}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Completed"})]}),null!==ie&&t.jsxs("div",{className:"text-center",children:[t.jsxs("p",{className:`text-2xl font-bold ${ne(ie)}`,children:[ie,"%"]}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Avg Score"})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[!Q&&t.jsxs(m,{style:{backgroundColor:D.theme.colors.cardBackground},children:[t.jsxs(x,{children:[t.jsxs(h,{className:"flex items-center gap-2",children:[t.jsx(u,{className:"h-5 w-5 text-purple-500"}),"Select Scenario"]}),t.jsx(p,{children:"Choose a category and difficulty level to practice"})]}),t.jsxs(g,{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium mb-3 block",children:"Category"}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:F.map(e=>t.jsxs("button",{onClick:()=>H(e.id),className:"p-4 rounded-lg border-2 transition-all text-center "+(O===e.id?"border-purple-500 bg-purple-50 dark:bg-purple-950":"border-border hover:border-purple-300"),children:[t.jsx("span",{className:"text-2xl block mb-1",children:e.icon}),t.jsx("span",{className:"text-sm font-medium",children:e.label})]},e.id))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium mb-3 block",children:"Difficulty"}),t.jsx("div",{className:"flex gap-3",children:z.map(e=>t.jsx("button",{onClick:()=>J(e.id),className:"flex-1 p-3 rounded-lg border-2 transition-all "+(K===e.id?"border-purple-500":"border-border hover:border-purple-300"),children:t.jsx(j,{className:e.color,children:e.label})},e.id))})]}),t.jsxs(f,{onClick:async()=>{U(!0),ae(null),le(!1),ee("");try{const{data:e,error:s}=await B.from("email_scenario_templates").select("*").eq("scenario_category",O).eq("difficulty_level",K).eq("is_active",!0);if(e&&e.length>0){const s=e[Math.floor(Math.random()*e.length)];X({id:s.id,type:s.scenario_type,category:s.scenario_category,difficulty:s.difficulty_level,subject:s.subject_template,from:s.from_template,body:s.body_template,instructions:s.instructions||"Reply professionally to this email."})}else{const{data:e,error:s}=await B.functions.invoke("email-feedback",{body:{action:"generate_scenario",category:O,difficulty:K,occupation:$}});if(s)throw s;if(!e.success||!e.scenario)throw new Error("Failed to generate scenario");X({id:crypto.randomUUID(),...e.scenario})}}catch(e){console.error("Error loading scenario:",e),T({title:"Error",description:"Failed to load email scenario. Please try again.",variant:"destructive"})}finally{U(!1)}},disabled:G,className:"w-full bg-gradient-to-r from-purple-500 to-pink-500",size:"lg",children:[G?"Loading...":"Start Practice",t.jsx(b,{className:"h-4 w-4 ml-2"})]})]})]}),Q&&!re&&t.jsxs(t.Fragment,{children:[t.jsxs(m,{style:{backgroundColor:D.theme.colors.cardBackground},children:[t.jsx(x,{className:"pb-3",children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{children:[t.jsx(j,{className:null==(M=z.find(e=>e.id===Q.difficulty))?void 0:M.color,children:Q.difficulty}),t.jsx(h,{className:"mt-2 text-lg",children:Q.subject}),t.jsxs(p,{children:["From: ",Q.from]})]}),t.jsxs(f,{variant:"outline",size:"sm",onClick:()=>{X(null),ee("")},children:[t.jsx(y,{className:"h-4 w-4 mr-1"}),"New"]})]})}),t.jsxs(g,{children:[t.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 font-mono text-sm whitespace-pre-wrap",children:Q.body}),Q.instructions&&t.jsxs("div",{className:"mt-4 p-3 bg-purple-50 dark:bg-purple-950 rounded-lg flex items-start gap-2",children:[t.jsx(P,{className:"h-4 w-4 text-purple-500 mt-0.5 flex-shrink-0"}),t.jsxs("p",{className:"text-sm text-purple-700 dark:text-purple-300",children:[t.jsx("strong",{children:"Instructions:"})," ",Q.instructions]})]})]})]}),t.jsxs(m,{style:{backgroundColor:D.theme.colors.cardBackground},children:[t.jsx(x,{className:"pb-3",children:t.jsxs(h,{className:"flex items-center gap-2 text-lg",children:[t.jsx(N,{className:"h-5 w-5 text-purple-500"}),"Your Reply"]})}),t.jsxs(g,{className:"space-y-4",children:[t.jsx(v,{value:Z,onChange:e=>ee(e.target.value),placeholder:"Dear [Name],\n\nWrite your professional email response here...\n\nBest regards,\n[Your Name]",rows:12,className:"font-mono"}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("p",{className:"text-sm text-muted-foreground",children:[Z.length," characters"]}),t.jsxs(f,{onClick:async()=>{if(Z.trim()){if(Q){Y(!0);try{const{data:e,error:s}=await B.functions.invoke("email-feedback",{body:{action:"analyze_response",scenario:Q,response:Z,occupation:$}});if(s)throw s;if(!e.success||!e.feedback)throw new Error(e.error||"Failed to analyze response");ae(e.feedback),le(!0),A&&(await B.from("email_practice_sessions").insert({user_id:A.id,scenario_type:Q.type,scenario_category:Q.category,difficulty_level:Q.difficulty,context_subject:Q.subject,context_from:Q.from,context_body:Q.body,context_instructions:Q.instructions,student_response:Z,response_submitted_at:(new Date).toISOString(),feedback:e.feedback,overall_score:e.feedback.overallScore,improved_version:e.feedback.improvedVersion}),ce(e=>e+1),oe(s=>null===s?e.feedback.overallScore:Math.round((s*te+e.feedback.overallScore)/(te+1))))}catch(e){console.error("Error submitting response:",e),T({title:"Error",description:"Failed to analyze your response. Please try again.",variant:"destructive"})}finally{Y(!1)}}}else T({title:"Empty response",description:"Please write your email response before submitting.",variant:"destructive"})},disabled:W||!Z.trim(),children:[W?"Analyzing...":"Submit for Feedback",t.jsx(k,{className:"h-4 w-4 ml-2"})]})]})]})]})]}),re&&se&&t.jsxs(t.Fragment,{children:[t.jsx(m,{style:{backgroundColor:D.theme.colors.cardBackground},children:t.jsx(g,{className:"pt-6",children:t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:`text-5xl font-bold ${ne(se.overallScore)}`,children:[se.overallScore,"%"]}),t.jsx("p",{className:"text-lg font-medium mt-1",children:(de=se.overallScore,de>=90?"Excellent":de>=80?"Very Good":de>=70?"Good":de>=60?"Needs Work":"Practice More")}),t.jsx(w,{value:se.overallScore,className:"mt-4 h-3"})]})})}),t.jsxs(m,{style:{backgroundColor:D.theme.colors.cardBackground},children:[t.jsx(x,{children:t.jsxs(h,{className:"flex items-center gap-2",children:[t.jsx(_,{className:"h-5 w-5 text-purple-500"}),"Detailed Feedback"]})}),t.jsx(g,{className:"space-y-4",children:se.items.map((e,s)=>t.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"font-medium capitalize",children:e.category}),t.jsxs("span",{className:`font-bold ${ne(e.score)}`,children:[e.score,"/100"]})]}),t.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:e.feedback}),e.suggestions.length>0&&t.jsx("ul",{className:"text-sm space-y-1",children:e.suggestions.map((e,s)=>t.jsxs("li",{className:"flex items-start gap-2",children:[t.jsx(P,{className:"h-3 w-3 mt-1 text-yellow-500 flex-shrink-0"}),t.jsx("span",{children:e})]},s))})]},s))})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs(m,{style:{backgroundColor:D.theme.colors.cardBackground},children:[t.jsx(x,{className:"pb-2",children:t.jsxs(h,{className:"text-sm flex items-center gap-2 text-green-600",children:[t.jsx(C,{className:"h-4 w-4"}),"Strengths"]})}),t.jsx(g,{children:t.jsx("ul",{className:"text-sm space-y-2",children:se.strengths.map((e,s)=>t.jsxs("li",{className:"flex items-start gap-2",children:[t.jsx("span",{className:"text-green-500",children:"âœ“"}),e]},s))})})]}),t.jsxs(m,{style:{backgroundColor:D.theme.colors.cardBackground},children:[t.jsx(x,{className:"pb-2",children:t.jsxs(h,{className:"text-sm flex items-center gap-2 text-orange-600",children:[t.jsx(E,{className:"h-4 w-4"}),"Areas to Improve"]})}),t.jsx(g,{children:t.jsx("ul",{className:"text-sm space-y-2",children:se.improvements.map((e,s)=>t.jsxs("li",{className:"flex items-start gap-2",children:[t.jsx("span",{className:"text-orange-500",children:"â†’"}),e]},s))})})]})]}),se.improvedVersion&&t.jsxs(m,{style:{backgroundColor:D.theme.colors.cardBackground},children:[t.jsx(x,{className:"pb-2",children:t.jsxs(h,{className:"text-sm flex items-center gap-2",children:[t.jsx(S,{className:"h-4 w-4 text-blue-500"}),"Suggested Improved Version"]})}),t.jsx(g,{children:t.jsx("div",{className:"bg-blue-50 dark:bg-blue-950 rounded-lg p-4 font-mono text-sm whitespace-pre-wrap",children:se.improvedVersion})})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsxs(f,{variant:"outline",onClick:()=>{le(!1),ee("")},className:"flex-1",children:[t.jsx(I,{className:"h-4 w-4 mr-2"}),"Try Again"]}),t.jsxs(f,{onClick:()=>{X(null),ae(null),le(!1),ee("")},className:"flex-1 bg-gradient-to-r from-purple-500 to-pink-500",children:["New Scenario",t.jsx(b,{className:"h-4 w-4 ml-2"})]})]})]})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs(m,{style:{backgroundColor:D.theme.colors.cardBackground},children:[t.jsx(x,{className:"pb-3",children:t.jsxs(h,{className:"text-lg flex items-center gap-2",children:[t.jsx(P,{className:"h-5 w-5 text-yellow-500"}),"Email Writing Tips"]})}),t.jsxs(g,{className:"space-y-3 text-sm text-muted-foreground",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"Structure:"})," Use a clear greeting, body paragraphs, and sign-off"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Tone:"})," Match formality to the context and recipient"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Clarity:"})," Be concise - get to the point quickly"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Action:"})," Clearly state what you need or expect"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Proofread:"})," Check spelling and grammar before sending"]})]})]}),t.jsxs(m,{style:{backgroundColor:D.theme.colors.cardBackground},children:[t.jsx(x,{className:"pb-3",children:t.jsx(h,{className:"text-lg",children:"Professional Phrases"})}),t.jsxs(g,{className:"space-y-2 text-sm",children:[t.jsx("p",{className:"text-muted-foreground",children:"Opening:"}),t.jsx("p",{className:"italic",children:'"I hope this email finds you well."'}),t.jsx("p",{className:"italic",children:'"Thank you for your prompt response."'}),t.jsx("p",{className:"text-muted-foreground mt-3",children:"Requesting:"}),t.jsx("p",{className:"italic",children:'"I would appreciate it if you could..."'}),t.jsx("p",{className:"italic",children:'"Could you please advise on..."'}),t.jsx("p",{className:"text-muted-foreground mt-3",children:"Closing:"}),t.jsx("p",{className:"italic",children:'"Please let me know if you need any further information."'}),t.jsx("p",{className:"italic",children:'"I look forward to hearing from you."'})]})]})]})]})]})})]});var de};export{M as default};
