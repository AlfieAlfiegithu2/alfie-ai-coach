import{u as e,r as s,j as a}from"./vendor-react-rLLBBC7n.js";import{E as r,d as l,q as t,x as c,U as i,y as o,C as n,b as d,c as m,o as x,a as h,e as u,B as p,T as g,P as j,s as f}from"./index-KxDfHqNJ.js";import{aG as b,aa as y,K as N,Y as v,aH as k,cv as w,as as _,x as C,ak as S,aj as B,b4 as P,ao as E,cj as I}from"./vendor-ui-BGi_EvHx.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-charts-0DeywwxG.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";const F=[{id:"business",label:"Business",icon:"ðŸ’¼"},{id:"tech",label:"Technology",icon:"ðŸ’»"},{id:"healthcare",label:"Healthcare",icon:"ðŸ¥"},{id:"general",label:"General",icon:"ðŸ“§"}],q=[{id:"basic",label:"Basic",color:"bg-green-100 text-green-700"},{id:"intermediate",label:"Intermediate",color:"bg-yellow-100 text-yellow-700"},{id:"advanced",label:"Advanced",color:"bg-red-100 text-red-700"}],M=()=>{var M;const z=e(),{user:A}=r(),{toast:T}=l(),D=t(),[V,G]=s.useState(!0),[U,R]=s.useState(!1),[W,Y]=s.useState(!1),[$,H]=s.useState(""),[O,K]=s.useState("business"),[L,J]=s.useState("intermediate"),[Q,X]=s.useState(null),[Z,ee]=s.useState(""),[se,ae]=s.useState(null),[re,le]=s.useState(!1),[te,ce]=s.useState(0),[ie,oe]=s.useState(null);s.useEffect(()=>{(async()=>{if(A)try{const{data:e}=await f.from("business_profiles").select("occupation, industry").eq("user_id",A.id).maybeSingle();e&&H(e.occupation);const{data:s,error:a}=await f.from("email_practice_sessions").select("overall_score").eq("user_id",A.id).not("overall_score","is",null);if(s&&s.length>0){ce(s.length);const e=s.reduce((e,s)=>e+(s.overall_score||0),0)/s.length;oe(Math.round(e))}}catch(e){console.error("Error loading user data:",e)}finally{G(!1)}else G(!1)})()},[A]);const ne=e=>e>=80?"text-green-600":e>=60?"text-yellow-600":"text-red-600";return V?a.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:D.theme.colors.background},children:a.jsx(c,{})}):a.jsxs("div",{className:"min-h-screen",style:{backgroundColor:D.theme.colors.background},children:[a.jsx(i,{title:"Email Practice - Business English",description:"Master professional email writing with AI-powered feedback. Practice various business scenarios.",keywords:"email writing, business email, professional communication, email practice"}),a.jsx(o,{title:"Email Practice",showBackButton:!0,backPath:"/business-portal",children:a.jsxs("div",{className:"max-w-6xl mx-auto px-4 space-y-6",children:[a.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[a.jsx("button",{onClick:()=>z("/hero"),className:"text-muted-foreground hover:text-primary",children:a.jsx(b,{className:"h-4 w-4"})}),a.jsx(y,{className:"h-4 w-4 text-muted-foreground"}),a.jsx("button",{onClick:()=>z("/business-portal"),className:"text-muted-foreground hover:text-primary",children:"Business English"}),a.jsx(y,{className:"h-4 w-4 text-muted-foreground"}),a.jsx("span",{style:{color:D.textPrimary},children:"Email Practice"})]}),a.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold",style:{color:D.textPrimary},children:"Email Practice"}),a.jsx("p",{className:"text-muted-foreground",children:"Master professional email communication"})]}),a.jsxs("div",{className:"flex gap-4",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-2xl font-bold",style:{color:D.textPrimary},children:te}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Completed"})]}),null!==ie&&a.jsxs("div",{className:"text-center",children:[a.jsxs("p",{className:`text-2xl font-bold ${ne(ie)}`,children:[ie,"%"]}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Avg Score"})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[a.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[!Q&&a.jsxs(n,{style:{backgroundColor:D.theme.colors.cardBackground},children:[a.jsxs(d,{children:[a.jsxs(m,{className:"flex items-center gap-2",children:[a.jsx(N,{className:"h-5 w-5 text-purple-500"}),"Select Scenario"]}),a.jsx(x,{children:"Choose a category and difficulty level to practice"})]}),a.jsxs(h,{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium mb-3 block",children:"Category"}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:F.map(e=>a.jsxs("button",{onClick:()=>K(e.id),className:"p-4 rounded-lg border-2 transition-all text-center "+(O===e.id?"border-purple-500 bg-purple-50 dark:bg-purple-950":"border-border hover:border-purple-300"),children:[a.jsx("span",{className:"text-2xl block mb-1",children:e.icon}),a.jsx("span",{className:"text-sm font-medium",children:e.label})]},e.id))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium mb-3 block",children:"Difficulty"}),a.jsx("div",{className:"flex gap-3",children:q.map(e=>a.jsx("button",{onClick:()=>J(e.id),className:"flex-1 p-3 rounded-lg border-2 transition-all "+(L===e.id?"border-purple-500":"border-border hover:border-purple-300"),children:a.jsx(u,{className:e.color,children:e.label})},e.id))})]}),a.jsxs(p,{onClick:async()=>{R(!0),ae(null),le(!1),ee("");try{const{data:e,error:s}=await f.from("email_scenario_templates").select("*").eq("scenario_category",O).eq("difficulty_level",L).eq("is_active",!0);if(e&&e.length>0){const s=e[Math.floor(Math.random()*e.length)];X({id:s.id,type:s.scenario_type,category:s.scenario_category,difficulty:s.difficulty_level,subject:s.subject_template,from:s.from_template,body:s.body_template,instructions:s.instructions||"Reply professionally to this email."})}else{const{data:e,error:s}=await f.functions.invoke("email-feedback",{body:{action:"generate_scenario",category:O,difficulty:L,occupation:$}});if(s)throw s;if(!e.success||!e.scenario)throw new Error("Failed to generate scenario");X({id:crypto.randomUUID(),...e.scenario})}}catch(e){console.error("Error loading scenario:",e),T({title:"Error",description:"Failed to load email scenario. Please try again.",variant:"destructive"})}finally{R(!1)}},disabled:U,className:"w-full bg-gradient-to-r from-purple-500 to-pink-500",size:"lg",children:[U?"Loading...":"Start Practice",a.jsx(v,{className:"h-4 w-4 ml-2"})]})]})]}),Q&&!re&&a.jsxs(a.Fragment,{children:[a.jsxs(n,{style:{backgroundColor:D.theme.colors.cardBackground},children:[a.jsx(d,{className:"pb-3",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{children:[a.jsx(u,{className:null==(M=q.find(e=>e.id===Q.difficulty))?void 0:M.color,children:Q.difficulty}),a.jsx(m,{className:"mt-2 text-lg",children:Q.subject}),a.jsxs(x,{children:["From: ",Q.from]})]}),a.jsxs(p,{variant:"outline",size:"sm",onClick:()=>{X(null),ee("")},children:[a.jsx(k,{className:"h-4 w-4 mr-1"}),"New"]})]})}),a.jsxs(h,{children:[a.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 font-mono text-sm whitespace-pre-wrap",children:Q.body}),Q.instructions&&a.jsxs("div",{className:"mt-4 p-3 bg-purple-50 dark:bg-purple-950 rounded-lg flex items-start gap-2",children:[a.jsx(w,{className:"h-4 w-4 text-purple-500 mt-0.5 flex-shrink-0"}),a.jsxs("p",{className:"text-sm text-purple-700 dark:text-purple-300",children:[a.jsx("strong",{children:"Instructions:"})," ",Q.instructions]})]})]})]}),a.jsxs(n,{style:{backgroundColor:D.theme.colors.cardBackground},children:[a.jsx(d,{className:"pb-3",children:a.jsxs(m,{className:"flex items-center gap-2 text-lg",children:[a.jsx(_,{className:"h-5 w-5 text-purple-500"}),"Your Reply"]})}),a.jsxs(h,{className:"space-y-4",children:[a.jsx(g,{value:Z,onChange:e=>ee(e.target.value),placeholder:"Dear [Name],\n\nWrite your professional email response here...\n\nBest regards,\n[Your Name]",rows:12,className:"font-mono"}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("p",{className:"text-sm text-muted-foreground",children:[Z.length," characters"]}),a.jsxs(p,{onClick:async()=>{if(Z.trim()){if(Q){Y(!0);try{const{data:e,error:s}=await f.functions.invoke("email-feedback",{body:{action:"analyze_response",scenario:Q,response:Z,occupation:$}});if(s)throw s;if(!e.success||!e.feedback)throw new Error(e.error||"Failed to analyze response");ae(e.feedback),le(!0),A&&(await f.from("email_practice_sessions").insert({user_id:A.id,scenario_type:Q.type,scenario_category:Q.category,difficulty_level:Q.difficulty,context_subject:Q.subject,context_from:Q.from,context_body:Q.body,context_instructions:Q.instructions,student_response:Z,response_submitted_at:(new Date).toISOString(),feedback:e.feedback,overall_score:e.feedback.overallScore,improved_version:e.feedback.improvedVersion}),ce(e=>e+1),oe(s=>null===s?e.feedback.overallScore:Math.round((s*te+e.feedback.overallScore)/(te+1))))}catch(e){console.error("Error submitting response:",e),T({title:"Error",description:"Failed to analyze your response. Please try again.",variant:"destructive"})}finally{Y(!1)}}}else T({title:"Empty response",description:"Please write your email response before submitting.",variant:"destructive"})},disabled:W||!Z.trim(),children:[W?"Analyzing...":"Submit for Feedback",a.jsx(C,{className:"h-4 w-4 ml-2"})]})]})]})]})]}),re&&se&&a.jsxs(a.Fragment,{children:[a.jsx(n,{style:{backgroundColor:D.theme.colors.cardBackground},children:a.jsx(h,{className:"pt-6",children:a.jsxs("div",{className:"text-center",children:[a.jsxs("div",{className:`text-5xl font-bold ${ne(se.overallScore)}`,children:[se.overallScore,"%"]}),a.jsx("p",{className:"text-lg font-medium mt-1",children:(de=se.overallScore,de>=90?"Excellent":de>=80?"Very Good":de>=70?"Good":de>=60?"Needs Work":"Practice More")}),a.jsx(j,{value:se.overallScore,className:"mt-4 h-3"})]})})}),a.jsxs(n,{style:{backgroundColor:D.theme.colors.cardBackground},children:[a.jsx(d,{children:a.jsxs(m,{className:"flex items-center gap-2",children:[a.jsx(S,{className:"h-5 w-5 text-purple-500"}),"Detailed Feedback"]})}),a.jsx(h,{className:"space-y-4",children:se.items.map((e,s)=>a.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("span",{className:"font-medium capitalize",children:e.category}),a.jsxs("span",{className:`font-bold ${ne(e.score)}`,children:[e.score,"/100"]})]}),a.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:e.feedback}),e.suggestions.length>0&&a.jsx("ul",{className:"text-sm space-y-1",children:e.suggestions.map((e,s)=>a.jsxs("li",{className:"flex items-start gap-2",children:[a.jsx(w,{className:"h-3 w-3 mt-1 text-yellow-500 flex-shrink-0"}),a.jsx("span",{children:e})]},s))})]},s))})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs(n,{style:{backgroundColor:D.theme.colors.cardBackground},children:[a.jsx(d,{className:"pb-2",children:a.jsxs(m,{className:"text-sm flex items-center gap-2 text-green-600",children:[a.jsx(B,{className:"h-4 w-4"}),"Strengths"]})}),a.jsx(h,{children:a.jsx("ul",{className:"text-sm space-y-2",children:se.strengths.map((e,s)=>a.jsxs("li",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-green-500",children:"âœ“"}),e]},s))})})]}),a.jsxs(n,{style:{backgroundColor:D.theme.colors.cardBackground},children:[a.jsx(d,{className:"pb-2",children:a.jsxs(m,{className:"text-sm flex items-center gap-2 text-orange-600",children:[a.jsx(P,{className:"h-4 w-4"}),"Areas to Improve"]})}),a.jsx(h,{children:a.jsx("ul",{className:"text-sm space-y-2",children:se.improvements.map((e,s)=>a.jsxs("li",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-orange-500",children:"â†’"}),e]},s))})})]})]}),se.improvedVersion&&a.jsxs(n,{style:{backgroundColor:D.theme.colors.cardBackground},children:[a.jsx(d,{className:"pb-2",children:a.jsxs(m,{className:"text-sm flex items-center gap-2",children:[a.jsx(E,{className:"h-4 w-4 text-blue-500"}),"Suggested Improved Version"]})}),a.jsx(h,{children:a.jsx("div",{className:"bg-blue-50 dark:bg-blue-950 rounded-lg p-4 font-mono text-sm whitespace-pre-wrap",children:se.improvedVersion})})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsxs(p,{variant:"outline",onClick:()=>{le(!1),ee("")},className:"flex-1",children:[a.jsx(I,{className:"h-4 w-4 mr-2"}),"Try Again"]}),a.jsxs(p,{onClick:()=>{X(null),ae(null),le(!1),ee("")},className:"flex-1 bg-gradient-to-r from-purple-500 to-pink-500",children:["New Scenario",a.jsx(v,{className:"h-4 w-4 ml-2"})]})]})]})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs(n,{style:{backgroundColor:D.theme.colors.cardBackground},children:[a.jsx(d,{className:"pb-3",children:a.jsxs(m,{className:"text-lg flex items-center gap-2",children:[a.jsx(w,{className:"h-5 w-5 text-yellow-500"}),"Email Writing Tips"]})}),a.jsxs(h,{className:"space-y-3 text-sm text-muted-foreground",children:[a.jsxs("p",{children:[a.jsx("strong",{children:"Structure:"})," Use a clear greeting, body paragraphs, and sign-off"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Tone:"})," Match formality to the context and recipient"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Clarity:"})," Be concise - get to the point quickly"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Action:"})," Clearly state what you need or expect"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Proofread:"})," Check spelling and grammar before sending"]})]})]}),a.jsxs(n,{style:{backgroundColor:D.theme.colors.cardBackground},children:[a.jsx(d,{className:"pb-3",children:a.jsx(m,{className:"text-lg",children:"Professional Phrases"})}),a.jsxs(h,{className:"space-y-2 text-sm",children:[a.jsx("p",{className:"text-muted-foreground",children:"Opening:"}),a.jsx("p",{className:"italic",children:'"I hope this email finds you well."'}),a.jsx("p",{className:"italic",children:'"Thank you for your prompt response."'}),a.jsx("p",{className:"text-muted-foreground mt-3",children:"Requesting:"}),a.jsx("p",{className:"italic",children:'"I would appreciate it if you could..."'}),a.jsx("p",{className:"italic",children:'"Could you please advise on..."'}),a.jsx("p",{className:"text-muted-foreground mt-3",children:"Closing:"}),a.jsx("p",{className:"italic",children:'"Please let me know if you need any further information."'}),a.jsx("p",{className:"italic",children:'"I look forward to hearing from you."'})]})]})]})]})]})})]});var de};export{M as default};
