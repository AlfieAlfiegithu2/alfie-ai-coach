import{r as e,j as r,C as a,a as s,B as t,at as l,L as n,a6 as d,I as i,cd as c,c0 as o,c1 as m,G as x,u as g,a3 as h,a1 as b,a4 as u,bg as p,a5 as j,an as f,S as N,p as y,a9 as w,q as v,s as k,t as _,l as C,K as S,e as A,a2 as q,b as T,d as R,aj as E,ai as F}from"./index-BQgnpnc4.js";import{T as D,a as L,b as z,c as O}from"./tabs-xRkXf7aB.js";import{s as M}from"./supabase-DWL4C3fA.js";import{L as B}from"./lightbulb-BfxS21iL.js";import{R as H}from"./refresh-cw-BMmC64IJ.js";import{G as I}from"./grip-vertical-B2MdSO7b.js";import{C as P}from"./circle-alert-DGGk67iD.js";import{T as W}from"./trophy-mEFCvI1p.js";const G=({question:i,instruction:c,correctAnswer:o,incorrectAnswers:m,explanation:x,hint:g,onComplete:h,showResult:b=!0})=>{const[u,p]=e.useState(null),[j,f]=e.useState(!1),[N,y]=e.useState(!1),w=e.useMemo(()=>function(e){const r=[...e];for(let a=r.length-1;a>0;a--){const e=Math.floor(Math.random()*(a+1));[r[a],r[e]]=[r[e],r[a]]}return r}([o,...m]),[o,m]),v=u===o,k=e=>j?e===o?"border-emerald-500 bg-emerald-50 dark:bg-emerald-900/30 text-emerald-800 dark:text-emerald-200":e===u&&e!==o?"border-red-500 bg-red-50 dark:bg-red-900/30 text-red-800 dark:text-red-200":"border-gray-200 dark:border-gray-600 opacity-50 text-gray-500 dark:text-gray-400":u===e?"border-blue-500 bg-blue-50 dark:bg-blue-900/30 ring-2 ring-blue-200 dark:ring-blue-800 text-gray-900 dark:text-gray-100":"border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500 hover:bg-gray-50 dark:hover:bg-gray-700/50 text-gray-900 dark:text-gray-100";return r.jsx(a,{className:"w-full bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:r.jsxs(s,{className:"p-6 space-y-4",children:[c&&r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 italic",children:c}),r.jsx("div",{className:"text-lg font-medium leading-relaxed text-gray-900 dark:text-gray-100",children:i}),g&&!j&&r.jsx("div",{children:N?r.jsxs("div",{className:"flex items-start gap-2 p-3 bg-amber-50 rounded-lg border border-amber-200",children:[r.jsx(B,{className:"w-5 h-5 text-amber-500 shrink-0 mt-0.5"}),r.jsx("p",{className:"text-sm text-amber-800",children:g})]}):r.jsxs(t,{variant:"ghost",size:"sm",onClick:()=>y(!0),className:"text-amber-600 hover:text-amber-700",children:[r.jsx(B,{className:"w-4 h-4 mr-1"}),"Show Hint"]})}),r.jsx("div",{className:"grid gap-3",children:w.map((e,a)=>r.jsx("button",{onClick:()=>(e=>{j||p(e)})(e),disabled:j,className:l("w-full p-4 text-left rounded-lg border-2 transition-all duration-200",k(e),!j&&"cursor-pointer"),children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("span",{className:"w-8 h-8 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-sm font-medium shrink-0 text-gray-700 dark:text-gray-200",children:String.fromCharCode(65+a)}),r.jsx("span",{className:"flex-1 text-inherit",children:e}),j&&e===o&&r.jsx(n,{className:"w-5 h-5 text-emerald-500 shrink-0"}),j&&e===u&&e!==o&&r.jsx(d,{className:"w-5 h-5 text-red-500 shrink-0"})]})},a))}),!j&&r.jsx(t,{onClick:()=>{u&&!j&&(f(!0),h(u===o,u))},disabled:!u,className:"w-full bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600",children:"Check Answer"}),j&&b&&r.jsxs("div",{className:l("p-4 rounded-lg border-2",v?"bg-emerald-50 dark:bg-emerald-900/30 border-emerald-200 dark:border-emerald-700":"bg-red-50 dark:bg-red-900/30 border-red-200 dark:border-red-700"),children:[r.jsx("div",{className:"flex items-center gap-2 mb-2",children:v?r.jsxs(r.Fragment,{children:[r.jsx(n,{className:"w-5 h-5 text-emerald-500"}),r.jsx("span",{className:"font-semibold text-emerald-700 dark:text-emerald-300",children:"Correct!"})]}):r.jsxs(r.Fragment,{children:[r.jsx(d,{className:"w-5 h-5 text-red-500"}),r.jsx("span",{className:"font-semibold text-red-700 dark:text-red-300",children:"Not quite right"})]})}),x&&r.jsx("p",{className:l("text-sm",v?"text-emerald-700 dark:text-emerald-300":"text-red-700 dark:text-red-300"),children:x}),!v&&r.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-2",children:["The correct answer is: ",r.jsx("strong",{className:"text-gray-800 dark:text-gray-100",children:o})]})]})]})})},$=({sentence:c,instruction:o,correctAnswer:m,acceptableAnswers:x=[],explanation:g,hint:h,onComplete:b,showResult:u=!0})=>{const[p,j]=e.useState(""),[f,N]=e.useState(!1),[y,w]=e.useState(!1),v=e.useRef(null);e.useEffect(()=>{var e;null==(e=v.current)||e.focus()},[]);const k=e=>e.toLowerCase().trim().replace(/\s+/g," "),_=[m,...x].map(k).includes(k(p)),C=()=>{p.trim()&&!f&&(N(!0),b(_,p))},S=e=>{"Enter"===e.key&&C()};return r.jsx(a,{className:"w-full bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:r.jsxs(s,{className:"p-6 space-y-4",children:[o&&r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 italic",children:o}),r.jsx("div",{className:"py-2",children:(()=>{const e=c.split("___");return 1===e.length?r.jsxs("div",{className:"space-y-3",children:[r.jsx("p",{className:"text-lg leading-relaxed text-gray-900 dark:text-gray-100",children:c}),r.jsx(i,{ref:v,value:p,onChange:e=>j(e.target.value),onKeyDown:S,disabled:f,placeholder:"Type your answer...",className:l("text-lg font-medium",f&&_&&"border-emerald-500 bg-emerald-50",f&&!_&&"border-red-500 bg-red-50")})]}):r.jsx("p",{className:"text-lg leading-relaxed inline-flex flex-wrap items-center gap-1 text-gray-900 dark:text-gray-100",children:e.map((a,s)=>r.jsxs("span",{className:"inline-flex items-center gap-1",children:[r.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:a}),s<e.length-1&&r.jsx(i,{ref:0===s?v:void 0,value:p,onChange:e=>j(e.target.value),onKeyDown:S,disabled:f,placeholder:"...",className:l("inline-block w-40 text-center font-medium border-b-2 border-t-0 border-l-0 border-r-0 rounded-none bg-transparent px-2 text-gray-900 dark:text-gray-100",f&&_&&"border-emerald-500 text-emerald-700 dark:text-emerald-300",f&&!_&&"border-red-500 text-red-700 dark:text-red-300",!f&&"border-blue-400 focus:border-blue-500 dark:border-blue-500")})]},s))})})()}),h&&!f&&r.jsx("div",{children:y?r.jsxs("div",{className:"flex items-start gap-2 p-3 bg-amber-50 rounded-lg border border-amber-200",children:[r.jsx(B,{className:"w-5 h-5 text-amber-500 shrink-0 mt-0.5"}),r.jsx("p",{className:"text-sm text-amber-800",children:h})]}):r.jsxs(t,{variant:"ghost",size:"sm",onClick:()=>w(!0),className:"text-amber-600 hover:text-amber-700",children:[r.jsx(B,{className:"w-4 h-4 mr-1"}),"Show Hint"]})}),!f&&r.jsx(t,{onClick:C,disabled:!p.trim(),className:"w-full bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600",children:"Check Answer"}),f&&u&&r.jsxs("div",{className:l("p-4 rounded-lg border-2",_?"bg-emerald-50 dark:bg-emerald-900/30 border-emerald-200 dark:border-emerald-700":"bg-red-50 dark:bg-red-900/30 border-red-200 dark:border-red-700"),children:[r.jsx("div",{className:"flex items-center gap-2 mb-2",children:_?r.jsxs(r.Fragment,{children:[r.jsx(n,{className:"w-5 h-5 text-emerald-500"}),r.jsx("span",{className:"font-semibold text-emerald-700 dark:text-emerald-300",children:"Correct!"})]}):r.jsxs(r.Fragment,{children:[r.jsx(d,{className:"w-5 h-5 text-red-500"}),r.jsx("span",{className:"font-semibold text-red-700 dark:text-red-300",children:"Not quite right"})]})}),g&&r.jsx("p",{className:l("text-sm",_?"text-emerald-700 dark:text-emerald-300":"text-red-700 dark:text-red-300"),children:g}),!_&&r.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-2",children:["The correct answer is: ",r.jsx("strong",{className:"text-gray-800 dark:text-gray-100",children:m})]})]})]})})},K=({incorrectSentence:o,instruction:m,correctAnswer:x,acceptableAnswers:g=[],explanation:h,hint:b,errorHighlight:u,onComplete:p,showResult:j=!0})=>{const[f,N]=e.useState(""),[y,w]=e.useState(!1),[v,k]=e.useState(!1),_=e.useRef(null);e.useEffect(()=>{var e;null==(e=_.current)||e.focus()},[]);const C=e=>e.toLowerCase().trim().replace(/\s+/g," ").replace(/[.,!?;:]/g,""),S=[x,...g].map(C).includes(C(f)),A=()=>{f.trim()&&!y&&(w(!0),p(S,f))};return r.jsx(a,{className:"w-full bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:r.jsxs(s,{className:"p-6 space-y-4",children:[r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx(c,{className:"w-5 h-5 text-amber-500 shrink-0 mt-0.5"}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:m||"Find and correct the error in this sentence:"})]}),r.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/30 rounded-lg border border-red-200 dark:border-red-700",children:r.jsx("p",{className:"text-lg leading-relaxed text-gray-900 dark:text-gray-100",children:(()=>{if(!u)return r.jsx("span",{children:o});const e=o.split(new RegExp(`(${u})`,"i"));return r.jsx(r.Fragment,{children:e.map((e,a)=>e.toLowerCase()===u.toLowerCase()?r.jsx("span",{className:"bg-red-200 text-red-800 px-1 rounded underline decoration-wavy decoration-red-500",children:e},a):r.jsx("span",{children:e},a))})})()})}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Write the corrected sentence:"}),r.jsx(i,{ref:_,value:f,onChange:e=>N(e.target.value),onKeyDown:e=>{"Enter"===e.key&&A()},disabled:y,placeholder:"Type the correct sentence...",className:l("text-base",y&&S&&"border-emerald-500 bg-emerald-50",y&&!S&&"border-red-500 bg-red-50")})]}),b&&!y&&r.jsx("div",{children:v?r.jsxs("div",{className:"flex items-start gap-2 p-3 bg-amber-50 rounded-lg border border-amber-200",children:[r.jsx(B,{className:"w-5 h-5 text-amber-500 shrink-0 mt-0.5"}),r.jsx("p",{className:"text-sm text-amber-800",children:b})]}):r.jsxs(t,{variant:"ghost",size:"sm",onClick:()=>k(!0),className:"text-amber-600 hover:text-amber-700",children:[r.jsx(B,{className:"w-4 h-4 mr-1"}),"Show Hint"]})}),!y&&r.jsx(t,{onClick:A,disabled:!f.trim(),className:"w-full bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600",children:"Check Answer"}),y&&j&&r.jsxs("div",{className:l("p-4 rounded-lg border-2",S?"bg-emerald-50 dark:bg-emerald-900/30 border-emerald-200 dark:border-emerald-700":"bg-red-50 dark:bg-red-900/30 border-red-200 dark:border-red-700"),children:[r.jsx("div",{className:"flex items-center gap-2 mb-2",children:S?r.jsxs(r.Fragment,{children:[r.jsx(n,{className:"w-5 h-5 text-emerald-500"}),r.jsx("span",{className:"font-semibold text-emerald-700 dark:text-emerald-300",children:"Correct!"})]}):r.jsxs(r.Fragment,{children:[r.jsx(d,{className:"w-5 h-5 text-red-500"}),r.jsx("span",{className:"font-semibold text-red-700 dark:text-red-300",children:"Not quite right"})]})}),r.jsxs("div",{className:"p-3 bg-white dark:bg-gray-700 rounded border dark:border-gray-600 mb-2",children:[r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-1",children:"Correct sentence:"}),r.jsx("p",{className:"font-medium text-emerald-700 dark:text-emerald-300",children:x})]}),h&&r.jsx("p",{className:l("text-sm",S?"text-emerald-700 dark:text-emerald-300":"text-red-700 dark:text-red-300"),children:h})]})]})})},U=({originalSentence:c,instruction:m,transformationType:x,correctAnswer:g,acceptableAnswers:h=[],startingWord:b,explanation:u,hint:p,onComplete:j,showResult:f=!0})=>{const[N,y]=e.useState(b||""),[w,v]=e.useState(!1),[k,_]=e.useState(!1),C=e.useRef(null);e.useEffect(()=>{var e;null==(e=C.current)||e.focus()},[]);const S=e=>e.toLowerCase().trim().replace(/\s+/g," ").replace(/[.,!?;:]/g,""),A=[g,...h].map(S).includes(S(N)),q=()=>{N.trim()&&!w&&(v(!0),j(A,N))};return r.jsx(a,{className:"w-full",children:r.jsxs(s,{className:"p-6 space-y-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(H,{className:"w-4 h-4 text-gray-500"}),r.jsx("span",{className:l("text-xs font-medium px-2 py-1 rounded-full border",(()=>{const e=x.toLowerCase();return e.includes("passive")?"bg-purple-100 text-purple-700 border-purple-200":e.includes("reported")||e.includes("indirect")?"bg-blue-100 text-blue-700 border-blue-200":e.includes("conditional")?"bg-amber-100 text-amber-700 border-amber-200":e.includes("negative")?"bg-red-100 text-red-700 border-red-200":e.includes("question")?"bg-green-100 text-green-700 border-green-200":"bg-gray-100 text-gray-700 border-gray-200"})()),children:x})]}),r.jsx("p",{className:"text-sm text-muted-foreground",children:m||`Transform the sentence (${x}):`}),r.jsx("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:r.jsx("p",{className:"text-lg font-medium text-blue-800",children:c})}),r.jsx("div",{className:"flex items-center justify-center",children:r.jsx(o,{className:"w-6 h-6 text-gray-400"})}),r.jsxs("div",{className:"space-y-2",children:[b&&r.jsxs("p",{className:"text-sm text-gray-600",children:["Begin your answer with: ",r.jsx("strong",{children:b})]}),r.jsx(i,{ref:C,value:N,onChange:e=>y(e.target.value),onKeyDown:e=>{"Enter"===e.key&&q()},disabled:w,placeholder:"Write the transformed sentence...",className:l("text-base",w&&A&&"border-emerald-500 bg-emerald-50",w&&!A&&"border-red-500 bg-red-50")})]}),p&&!w&&r.jsx("div",{children:k?r.jsxs("div",{className:"flex items-start gap-2 p-3 bg-amber-50 rounded-lg border border-amber-200",children:[r.jsx(B,{className:"w-5 h-5 text-amber-500 shrink-0 mt-0.5"}),r.jsx("p",{className:"text-sm text-amber-800",children:p})]}):r.jsxs(t,{variant:"ghost",size:"sm",onClick:()=>_(!0),className:"text-amber-600 hover:text-amber-700",children:[r.jsx(B,{className:"w-4 h-4 mr-1"}),"Show Hint"]})}),!w&&r.jsx(t,{onClick:q,disabled:!N.trim(),className:"w-full bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600",children:"Check Answer"}),w&&f&&r.jsxs("div",{className:l("p-4 rounded-lg border-2",A?"bg-emerald-50 border-emerald-200":"bg-red-50 border-red-200"),children:[r.jsx("div",{className:"flex items-center gap-2 mb-2",children:A?r.jsxs(r.Fragment,{children:[r.jsx(n,{className:"w-5 h-5 text-emerald-500"}),r.jsx("span",{className:"font-semibold text-emerald-700",children:"Correct!"})]}):r.jsxs(r.Fragment,{children:[r.jsx(d,{className:"w-5 h-5 text-red-500"}),r.jsx("span",{className:"font-semibold text-red-700",children:"Not quite right"})]})}),r.jsxs("div",{className:"p-3 bg-white rounded border mb-2",children:[r.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Correct transformation:"}),r.jsx("p",{className:"font-medium text-emerald-700",children:g})]}),u&&r.jsx("p",{className:l("text-sm",A?"text-emerald-700":"text-red-700"),children:u})]})]})})};function V(e){const r=[...e];for(let a=r.length-1;a>0;a--){const e=Math.floor(Math.random()*(a+1));[r[a],r[e]]=[r[e],r[a]]}return r}const Y=({instruction:i,words:c,correctOrder:o,explanation:x,hint:g,onComplete:h,showResult:b=!0})=>{const[u,p]=e.useState(()=>V(c)),[j,f]=e.useState([]),[N,y]=e.useState(!1),[w,v]=e.useState(!1),[k,_]=e.useState(null),[C,S]=e.useState(null),A=j.length===o.length&&j.every((e,r)=>e.toLowerCase()===o[r].toLowerCase()),q=(e,r)=>{N||("available"===r?(p(r=>r.filter((a,s)=>s!==r.indexOf(e))),f(r=>[...r,e])):(f(r=>r.filter((a,s)=>s!==r.indexOf(e))),p(r=>[...r,e])))},T=(e,r)=>{_(e),S(r)},R=e=>{e.preventDefault()},E=(e,r)=>{k&&C&&!N&&("available"===C?p(e=>{const r=e.indexOf(k);return e.filter((e,a)=>a!==r)}):f(e=>{const r=e.indexOf(k);return e.filter((e,a)=>a!==r)}),"available"===e?p(e=>[...e,k]):f(void 0!==r?e=>{const a=[...e];return a.splice(r,0,k),a}:e=>[...e,k]),_(null),S(null))};return r.jsx(a,{className:"w-full",children:r.jsxs(s,{className:"p-6 space-y-4",children:[r.jsx("p",{className:"text-sm text-muted-foreground",children:i||"Arrange the words to form a correct sentence:"}),r.jsx("div",{className:l("min-h-[60px] p-3 rounded-lg border-2 border-dashed transition-colors",0===j.length?"border-gray-300 bg-gray-50":"border-blue-300 bg-blue-50",N&&A&&"border-emerald-400 bg-emerald-50",N&&!A&&"border-red-400 bg-red-50"),onDragOver:R,onDrop:()=>E("selected"),children:0===j.length?r.jsx("p",{className:"text-center text-gray-400 text-sm py-2",children:"Click or drag words here to build your sentence"}):r.jsx("div",{className:"flex flex-wrap gap-2",children:j.map((e,a)=>r.jsxs("div",{draggable:!N,onDragStart:()=>T(e,"selected"),onDragOver:R,onDrop:e=>{if(e.stopPropagation(),"selected"===C){((e,r)=>{N||f(a=>{const s=[...a],[t]=s.splice(e,1);return s.splice(r,0,t),s})})(j.indexOf(k),a)}else E("selected",a)},onClick:()=>q(e,"selected"),className:l("inline-flex items-center gap-1 px-3 py-2 rounded-lg font-medium text-sm cursor-pointer transition-all","bg-white border-2 shadow-sm hover:shadow-md",N?"cursor-default":"hover:scale-105",N&&A&&"border-emerald-400 text-emerald-700",N&&!A&&"border-red-400 text-red-700",!N&&"border-blue-400 text-blue-700"),children:[r.jsx(I,{className:"w-3 h-3 opacity-50"}),e]},`selected-${a}`))})}),r.jsx("div",{className:"min-h-[60px] p-3 rounded-lg bg-gray-100 border border-gray-200",onDragOver:R,onDrop:()=>E("available"),children:0===u.length?r.jsx("p",{className:"text-center text-gray-400 text-sm py-2",children:"All words used!"}):r.jsx("div",{className:"flex flex-wrap gap-2",children:u.map((e,a)=>r.jsx("div",{draggable:!N,onDragStart:()=>T(e,"available"),onClick:()=>q(e,"available"),className:l("inline-flex items-center gap-1 px-3 py-2 rounded-lg font-medium text-sm cursor-pointer transition-all","bg-white border-2 border-gray-300 text-gray-700 shadow-sm",N?"cursor-default opacity-50":"hover:border-blue-400 hover:shadow-md hover:scale-105"),children:e},`available-${a}`))})}),g&&!N&&r.jsx("div",{children:w?r.jsxs("div",{className:"flex items-start gap-2 p-3 bg-amber-50 rounded-lg border border-amber-200",children:[r.jsx(B,{className:"w-5 h-5 text-amber-500 shrink-0 mt-0.5"}),r.jsx("p",{className:"text-sm text-amber-800",children:g})]}):r.jsxs(t,{variant:"ghost",size:"sm",onClick:()=>v(!0),className:"text-amber-600 hover:text-amber-700",children:[r.jsx(B,{className:"w-4 h-4 mr-1"}),"Show Hint"]})}),!N&&r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(t,{variant:"outline",onClick:()=>{f([]),p(V(c)),y(!1)},disabled:0===j.length,className:"flex-1",children:[r.jsx(m,{className:"w-4 h-4 mr-2"}),"Reset"]}),r.jsx(t,{onClick:()=>{0===j.length||N||(y(!0),h(A,j.join(" ")))},disabled:0===j.length,className:"flex-1 bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600",children:"Check Answer"})]}),N&&b&&r.jsxs("div",{className:l("p-4 rounded-lg border-2",A?"bg-emerald-50 border-emerald-200":"bg-red-50 border-red-200"),children:[r.jsx("div",{className:"flex items-center gap-2 mb-2",children:A?r.jsxs(r.Fragment,{children:[r.jsx(n,{className:"w-5 h-5 text-emerald-500"}),r.jsx("span",{className:"font-semibold text-emerald-700",children:"Correct!"})]}):r.jsxs(r.Fragment,{children:[r.jsx(d,{className:"w-5 h-5 text-red-500"}),r.jsx("span",{className:"font-semibold text-red-700",children:"Not quite right"})]})}),!A&&r.jsxs("div",{className:"p-3 bg-white rounded border mb-2",children:[r.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Correct order:"}),r.jsx("p",{className:"font-medium text-emerald-700",children:o.join(" ")})]}),x&&r.jsx("p",{className:l("text-sm",A?"text-emerald-700":"text-red-700"),children:x})]})]})})},J=({exercise:e,onComplete:a,showResult:s=!0})=>{switch(e.type){case"multiple_choice":return r.jsx(G,{question:e.question||"",instruction:e.instruction,correctAnswer:e.correctAnswer,incorrectAnswers:e.incorrectAnswers||[],explanation:e.explanation,hint:e.hint,onComplete:a,showResult:s});case"fill_in_blank":return r.jsx($,{sentence:e.sentenceWithBlank||e.question||"",instruction:e.instruction,correctAnswer:e.correctAnswer,acceptableAnswers:e.acceptableAnswers,explanation:e.explanation,hint:e.hint,onComplete:a,showResult:s});case"error_correction":return r.jsx(K,{incorrectSentence:e.incorrectSentence||e.question||"",instruction:e.instruction,correctAnswer:e.correctAnswer,acceptableAnswers:e.acceptableAnswers,explanation:e.explanation,hint:e.hint,errorHighlight:e.errorHighlight,onComplete:a,showResult:s});case"sentence_transformation":return r.jsx(U,{originalSentence:e.originalSentence||e.question||"",instruction:e.instruction,transformationType:e.transformationType||"transformation",correctAnswer:e.correctAnswer,acceptableAnswers:e.acceptableAnswers,startingWord:e.startingWord,explanation:e.explanation,hint:e.hint,onComplete:a,showResult:s});case"drag_drop_reorder":return r.jsx(Y,{instruction:e.instruction,words:e.words||e.correctOrder||[],correctOrder:e.correctOrder||[],explanation:e.explanation,hint:e.hint,onComplete:a,showResult:s});default:return r.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:r.jsxs("p",{className:"text-red-600",children:["Unknown exercise type: ",e.type]})})}},Q=[{code:"en",name:"English",flag:"ðŸ‡¬ðŸ‡§"},{code:"es",name:"EspaÃ±ol",flag:"ðŸ‡ªðŸ‡¸"},{code:"zh",name:"ä¸­æ–‡",flag:"ðŸ‡¨ðŸ‡³"},{code:"hi",name:"à¤¹à¤¿à¤¨à¥à¤¦à¥€",flag:"ðŸ‡®ðŸ‡³"},{code:"ar",name:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",flag:"ðŸ‡¸ðŸ‡¦"},{code:"pt",name:"PortuguÃªs",flag:"ðŸ‡§ðŸ‡·"},{code:"bn",name:"à¦¬à¦¾à¦‚à¦²à¦¾",flag:"ðŸ‡§ðŸ‡©"},{code:"ru",name:"Ð ÑƒÑÑÐºÐ¸Ð¹",flag:"ðŸ‡·ðŸ‡º"},{code:"ja",name:"æ—¥æœ¬èªž",flag:"ðŸ‡¯ðŸ‡µ"},{code:"de",name:"Deutsch",flag:"ðŸ‡©ðŸ‡ª"},{code:"fr",name:"FranÃ§ais",flag:"ðŸ‡«ðŸ‡·"},{code:"ko",name:"í•œêµ­ì–´",flag:"ðŸ‡°ðŸ‡·"},{code:"vi",name:"Tiáº¿ng Viá»‡t",flag:"ðŸ‡»ðŸ‡³"},{code:"it",name:"Italiano",flag:"ðŸ‡®ðŸ‡¹"},{code:"tr",name:"TÃ¼rkÃ§e",flag:"ðŸ‡¹ðŸ‡·"},{code:"th",name:"à¹„à¸—à¸¢",flag:"ðŸ‡¹ðŸ‡­"},{code:"pl",name:"Polski",flag:"ðŸ‡µðŸ‡±"},{code:"nl",name:"Nederlands",flag:"ðŸ‡³ðŸ‡±"},{code:"id",name:"Bahasa Indonesia",flag:"ðŸ‡®ðŸ‡©"},{code:"uk",name:"Ð£ÐºÑ€Ð°Ñ—Ð½ÑÑŒÐºÐ°",flag:"ðŸ‡ºðŸ‡¦"},{code:"ms",name:"Bahasa Melayu",flag:"ðŸ‡²ðŸ‡¾"},{code:"fa",name:"ÙØ§Ø±Ø³ÛŒ",flag:"ðŸ‡®ðŸ‡·"},{code:"tl",name:"Tagalog",flag:"ðŸ‡µðŸ‡­"},{code:"ro",name:"RomÃ¢nÄƒ",flag:"ðŸ‡·ðŸ‡´"},{code:"el",name:"Î•Î»Î»Î·Î½Î¹ÎºÎ¬",flag:"ðŸ‡¬ðŸ‡·"},{code:"cs",name:"ÄŒeÅ¡tina",flag:"ðŸ‡¨ðŸ‡¿"},{code:"sv",name:"Svenska",flag:"ðŸ‡¸ðŸ‡ª"},{code:"hu",name:"Magyar",flag:"ðŸ‡­ðŸ‡º"},{code:"he",name:"×¢×‘×¨×™×ª",flag:"ðŸ‡®ðŸ‡±"}],X=()=>{const{topicSlug:d}=x(),i=g(),{user:c}=h(),H=b(),[I,G]=e.useState(null),[$,K]=e.useState(null),[U,V]=e.useState([]),[Y,X]=e.useState(!0),[Z,ee]=e.useState("theory"),[re,ae]=e.useState(0),[se,te]=e.useState(new Set),[le,ne]=e.useState(0),[de,ie]=e.useState(!1),[ce,oe]=e.useState(!1),[me,xe]=e.useState(()=>localStorage.getItem("preferred_language")||"en");e.useEffect(()=>{d&&ge()},[d,c,me]);const ge=async()=>{var e,r,a,s,t,l,n,i,o;X(!0);try{const m=me,{data:x,error:g}=await M.from("grammar_topics").select("\n          id,\n          slug,\n          level,\n          grammar_topic_translations!inner(title, description)\n        ").eq("slug",d).eq("grammar_topic_translations.language_code",m).single();if(g){const{data:t}=await M.from("grammar_topics").select("\n            id,\n            slug,\n            level,\n            grammar_topic_translations(title, description)\n          ").eq("slug",d).single();t&&G({...t,title:(null==(r=null==(e=t.grammar_topic_translations)?void 0:e[0])?void 0:r.title)||(null==d?void 0:d.replace(/-/g," ")),description:(null==(s=null==(a=t.grammar_topic_translations)?void 0:a[0])?void 0:s.description)||""})}else x&&G({...x,title:(null==(l=null==(t=x.grammar_topic_translations)?void 0:t[0])?void 0:l.title)||(null==d?void 0:d.replace(/-/g," ")),description:(null==(i=null==(n=x.grammar_topic_translations)?void 0:n[0])?void 0:i.description)||""});const h=(null==x?void 0:x.id)||null;if(h){const{data:e}=await M.from("grammar_lessons").select("\n            id,\n            grammar_lesson_translations!inner(\n              theory_title,\n              theory_definition,\n              theory_formation,\n              theory_usage,\n              theory_common_mistakes,\n              rules,\n              examples,\n              localized_tips\n            )\n          ").eq("topic_id",h).eq("grammar_lesson_translations.language_code",m).order("lesson_order").limit(1).maybeSingle();if(e){const r=null==(o=e.grammar_lesson_translations)?void 0:o[0];K({id:e.id,...r,rules:(null==r?void 0:r.rules)||[],examples:(null==r?void 0:r.examples)||[]})}const{data:r}=await M.from("grammar_exercises").select("\n            id,\n            exercise_type,\n            difficulty,\n            exercise_order,\n            correct_order,\n            transformation_type,\n            grammar_exercise_translations!inner(\n              question,\n              instruction,\n              correct_answer,\n              incorrect_answers,\n              explanation,\n              hint,\n              sentence_with_blank,\n              incorrect_sentence,\n              original_sentence\n            )\n          ").eq("topic_id",h).eq("grammar_exercise_translations.language_code",m).order("exercise_order");if(r&&V(r.map(e=>{var r;return{...e,translations:(null==(r=e.grammar_exercise_translations)?void 0:r[0])||{}}})),c){const{data:e}=await M.from("user_grammar_progress").select("*").eq("user_id",c.id).eq("topic_id",h).maybeSingle();e&&oe(e.theory_completed||!1)}}}catch(m){console.error("Error loading lesson:",m)}finally{X(!1)}},he=async()=>{if(!c||!I)return;const e=U.length>0?Math.round(le/U.length*100):0,r=be(e);await M.from("user_grammar_progress").upsert({user_id:c.id,topic_id:I.id,theory_completed:!0,exercises_completed:se.size,total_exercises:U.length,best_score:e,mastery_level:r,last_practiced_at:(new Date).toISOString()},{onConflict:"user_id,topic_id"})},be=e=>e>=90?100:e>=80?90:e>=70?80:e>=60?70:e>=50?60:Math.max(50,e);if(Y)return r.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:H.theme.colors.background},children:r.jsx(u,{})});if(!I)return r.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:H.theme.colors.background},children:r.jsxs(a,{className:"p-8 text-center",children:[r.jsx(P,{className:"w-12 h-12 mx-auto text-red-500 mb-4"}),r.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Topic Not Found"}),r.jsx("p",{className:"text-muted-foreground mb-4",children:"The grammar topic you're looking for doesn't exist."}),r.jsx(t,{onClick:()=>i("/grammar"),children:"Back to Grammar Portal"})]})});const ue={beginner:"from-emerald-400 to-green-500",intermediate:"from-blue-400 to-indigo-500",advanced:"from-purple-400 to-violet-500"},pe=U.length>0?Math.round(se.size/U.length*100):0;return r.jsxs("div",{className:"min-h-screen relative",style:{backgroundColor:H.theme.colors.background},children:[r.jsx(p,{title:`${I.title} - Grammar Lesson`,description:I.description||`Learn ${I.title} with clear explanations and interactive exercises.`}),r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-emerald-50/50 via-blue-50/50 to-purple-50/50"}),r.jsx("div",{className:"relative z-10",children:r.jsx(j,{title:I.title||"Grammar Lesson",showBackButton:!0,backPath:"/grammar",children:r.jsxs("div",{className:"max-w-4xl mx-auto px-4 md:px-6 pb-12 space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>i("/hero"),className:"text-sm text-muted-foreground hover:text-primary",children:r.jsx(f,{className:"h-4 w-4"})}),r.jsx("span",{className:"text-muted-foreground",children:"/"}),r.jsx("button",{onClick:()=>i("/grammar"),className:"text-sm text-muted-foreground hover:text-primary",children:"Grammar"}),r.jsx("span",{className:"text-muted-foreground",children:"/"}),r.jsx("span",{className:"text-sm font-medium",style:{color:H.textPrimary},children:I.title})]}),r.jsxs(N,{value:me,onValueChange:e=>{xe(e),localStorage.setItem("preferred_language",e)},children:[r.jsxs(y,{className:"w-[160px] h-9 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 shadow-sm",children:[r.jsx(w,{className:"w-4 h-4 mr-2 text-emerald-600 dark:text-emerald-400"}),r.jsx(v,{placeholder:"Language",className:"text-gray-900 dark:text-gray-100"})]}),r.jsx(k,{className:"max-h-[300px] bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 z-50 shadow-lg",children:Q.map(e=>r.jsx(_,{value:e.code,className:"cursor-pointer text-gray-900 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700",children:r.jsxs("span",{className:"flex items-center gap-2",children:[r.jsx("span",{children:e.flag}),r.jsx("span",{children:e.name})]})},e.code))})]})]}),r.jsxs(a,{className:"overflow-hidden bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:[r.jsx("div",{className:`h-2 bg-gradient-to-r ${ue[I.level]||ue.beginner}`}),r.jsx(s,{className:"p-6",children:r.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(C,{variant:"secondary",className:"capitalize",children:I.level}),ce&&r.jsxs(C,{className:"bg-emerald-100 text-emerald-700",children:[r.jsx(n,{className:"w-3 h-3 mr-1"}),"Theory Complete"]})]}),r.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2 text-gray-900 dark:text-gray-100",children:I.title}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:I.description})]}),U.length>0&&r.jsxs("div",{className:"w-full md:w-48",children:[r.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[r.jsx("span",{className:"text-muted-foreground",children:"Progress"}),r.jsxs("span",{className:"font-semibold",children:[pe,"%"]})]}),r.jsx(S,{value:pe,className:"h-2"})]})]})})]}),r.jsxs(D,{value:Z,onValueChange:e=>ee(e),children:[r.jsxs(L,{className:"grid w-full grid-cols-2 max-w-sm",children:[r.jsxs(z,{value:"theory",className:"flex items-center gap-2",children:[r.jsx(A,{className:"w-4 h-4"}),"Theory"]}),r.jsxs(z,{value:"exercises",className:"flex items-center gap-2",disabled:!$&&0===U.length,children:[r.jsx(q,{className:"w-4 h-4"}),"Exercises (",U.length,")"]})]}),r.jsx(O,{value:"theory",className:"space-y-6 mt-6",children:$?r.jsxs(r.Fragment,{children:[$.theory_definition&&r.jsxs(a,{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:[r.jsx(T,{children:r.jsxs(R,{className:"flex items-center gap-2 text-gray-900 dark:text-gray-100",children:[r.jsx(B,{className:"w-5 h-5 text-amber-500"}),"What is ",I.title,"?"]})}),r.jsx(s,{children:r.jsx("p",{className:"text-base leading-relaxed whitespace-pre-line text-gray-900 dark:text-gray-100",children:$.theory_definition})})]}),$.theory_formation&&r.jsxs(a,{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:[r.jsx(T,{children:r.jsxs(R,{className:"flex items-center gap-2 text-gray-900 dark:text-gray-100",children:[r.jsx(q,{className:"w-5 h-5 text-blue-500"}),"How to Form It"]})}),r.jsxs(s,{children:[r.jsx("p",{className:"text-base leading-relaxed whitespace-pre-line text-gray-900 dark:text-gray-100",children:$.theory_formation}),$.rules&&$.rules.length>0&&r.jsx("div",{className:"mt-4 space-y-3",children:$.rules.map((e,a)=>r.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[r.jsx("p",{className:"font-semibold text-blue-800 mb-1",children:e.title}),r.jsx("p",{className:"font-mono text-sm bg-white p-2 rounded mb-2",children:e.formula}),r.jsxs("p",{className:"text-sm text-blue-600 italic",children:["Example: ",e.example]})]},a))})]})]}),$.theory_usage&&r.jsxs(a,{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:[r.jsx(T,{children:r.jsxs(R,{className:"flex items-center gap-2 text-gray-900 dark:text-gray-100",children:[r.jsx(n,{className:"w-5 h-5 text-emerald-500"}),"When to Use It"]})}),r.jsx(s,{children:r.jsx("p",{className:"text-base leading-relaxed whitespace-pre-line text-gray-900 dark:text-gray-100",children:$.theory_usage})})]}),$.examples&&$.examples.length>0&&r.jsxs(a,{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:[r.jsx(T,{children:r.jsxs(R,{className:"flex items-center gap-2 text-gray-900 dark:text-gray-100",children:[r.jsx(A,{className:"w-5 h-5 text-purple-500"}),"Examples"]})}),r.jsx(s,{children:r.jsx("div",{className:"space-y-3",children:$.examples.map((e,a)=>r.jsx("div",{className:l("p-3 rounded-lg border",!1!==e.correct?"bg-emerald-50 border-emerald-200":"bg-red-50 border-red-200"),children:r.jsxs("div",{className:"flex items-start gap-2",children:[!1!==e.correct?r.jsx(n,{className:"w-4 h-4 text-emerald-500 mt-1 shrink-0"}):r.jsx(P,{className:"w-4 h-4 text-red-500 mt-1 shrink-0"}),r.jsxs("div",{children:[r.jsx("p",{className:l("font-medium",!1!==e.correct?"text-emerald-800":"text-red-800"),children:e.sentence}),e.translation&&r.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.translation})]})]})},a))})})]}),$.theory_common_mistakes&&r.jsxs(a,{className:"border-amber-200",style:{backgroundColor:"rgb(254 252 232)"},children:[r.jsx(T,{children:r.jsxs(R,{className:"flex items-center gap-2 text-amber-700",children:[r.jsx(P,{className:"w-5 h-5"}),"Common Mistakes to Avoid"]})}),r.jsx(s,{children:r.jsx("p",{className:"text-amber-800 leading-relaxed whitespace-pre-line",children:$.theory_common_mistakes})})]}),$.localized_tips&&r.jsxs(a,{className:"border-purple-200",style:{backgroundColor:"rgb(250 245 255)"},children:[r.jsx(T,{children:r.jsxs(R,{className:"flex items-center gap-2 text-purple-700",children:[r.jsx(E,{className:"w-5 h-5"}),"Tips for Your Language"]})}),r.jsx(s,{children:r.jsx("p",{className:"text-purple-800 leading-relaxed whitespace-pre-line",children:$.localized_tips})})]}),r.jsx("div",{className:"flex justify-center pt-4",children:r.jsxs(t,{size:"lg",onClick:async()=>{oe(!0),ee("exercises"),c&&I&&await M.from("user_grammar_progress").upsert({user_id:c.id,topic_id:I.id,theory_completed:!0,last_practiced_at:(new Date).toISOString()},{onConflict:"user_id,topic_id"})},className:"bg-gradient-to-r from-emerald-500 to-blue-500 hover:from-emerald-600 hover:to-blue-600",children:[ce?"Review Exercises":"I Understand! Continue to Exercises",r.jsx(o,{className:"w-5 h-5 ml-2"})]})})]}):r.jsxs(a,{className:"p-8 text-center bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:[r.jsx(A,{className:"w-12 h-12 mx-auto text-gray-400 dark:text-gray-500 mb-4"}),r.jsx("h3",{className:"text-lg font-semibold mb-2 text-gray-900 dark:text-gray-100",children:"Theory Coming Soon"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"The theory content for this topic is being prepared."})]})}),r.jsx(O,{value:"exercises",className:"mt-6",children:de?r.jsxs(a,{className:"overflow-hidden bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:[r.jsx("div",{className:"h-2 bg-gradient-to-r from-emerald-400 to-blue-500"}),r.jsxs(s,{className:"p-8 text-center",children:[r.jsx(W,{className:"w-16 h-16 mx-auto text-amber-500 mb-4"}),r.jsx("h2",{className:"text-2xl font-bold mb-2 text-gray-900 dark:text-gray-100",children:"Lesson Complete!"}),r.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:["You scored ",le," out of ",U.length]}),r.jsx("div",{className:"flex items-center justify-center gap-2 mb-6",children:[...Array(3)].map((e,a)=>r.jsx(E,{className:l("w-8 h-8",a<Math.ceil(le/U.length*3)?"text-amber-400 fill-current":"text-gray-300")},a))}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[r.jsxs(t,{variant:"outline",onClick:()=>{ae(0),te(new Set),ne(0),ie(!1)},children:[r.jsx(m,{className:"w-4 h-4 mr-2"}),"Try Again"]}),r.jsx(t,{onClick:()=>i("/grammar"),children:"Back to Grammar Portal"})]})]})]}):U.length>0?r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("span",{className:"text-sm text-muted-foreground",children:["Exercise ",re+1," of ",U.length]}),r.jsxs("span",{className:"text-sm font-medium text-emerald-600",children:[le," correct"]})]}),r.jsx(S,{value:re/U.length*100,className:"h-2 mb-6"}),r.jsx(J,{exercise:(e=>{const r=e.translations;return{id:e.id,type:e.exercise_type,question:r.question,instruction:r.instruction,correctAnswer:r.correct_answer,incorrectAnswers:r.incorrect_answers,explanation:r.explanation,hint:r.hint,sentenceWithBlank:r.sentence_with_blank,incorrectSentence:r.incorrect_sentence,originalSentence:r.original_sentence,transformationType:e.transformation_type,words:e.correct_order,correctOrder:e.correct_order}})(U[re]),onComplete:async(e,r)=>{const a=U[re];te(e=>new Set([...e,a.id])),e&&ne(e=>e+1),c&&await M.from("user_grammar_exercise_attempts").insert({user_id:c.id,exercise_id:a.id,user_answer:r,is_correct:e})}},U[re].id),r.jsxs("div",{className:"flex justify-between items-center pt-4",children:[re>0?r.jsxs(t,{variant:"outline",onClick:()=>ae(e=>e-1),children:[r.jsx(F,{className:"w-4 h-4 mr-2"}),"Previous"]}):r.jsx("div",{}),se.has(U[re].id)&&r.jsx(t,{onClick:()=>{re<U.length-1?ae(e=>e+1):(ie(!0),he())},children:re<U.length-1?r.jsxs(r.Fragment,{children:["Next Exercise",r.jsx(o,{className:"w-4 h-4 ml-2"})]}):r.jsxs(r.Fragment,{children:["See Results",r.jsx(W,{className:"w-4 h-4 ml-2"})]})})]})]}):r.jsxs(a,{className:"p-8 text-center bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:[r.jsx(q,{className:"w-12 h-12 mx-auto text-gray-400 dark:text-gray-500 mb-4"}),r.jsx("h3",{className:"text-lg font-semibold mb-2 text-gray-900 dark:text-gray-100",children:"Exercises Coming Soon"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Practice exercises for this topic are being prepared."})]})})]})]})})})]})};export{X as default};
