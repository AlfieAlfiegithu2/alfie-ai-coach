import{r as e,j as r,c as a,u as s}from"./vendor-react-rLLBBC7n.js";import{C as t,a as l,B as n,N as d,I as i,E as c,q as o,s as m,x,U as g,y as h,S as b,i as u,j as p,k as j,l as f,e as N,P as y,b as w,c as v}from"./index-BDl0jLJK.js";import{T as k,a as _,b as C,c as S}from"./tabs-CFW1rRMF.js";import{cv as A,at as q,aI as T,ai as E,cj as F,Y as R,bd as z,aH as D,b4 as O,aG as L,G as M,ao as I,K as P,F as B,be as H,az as W}from"./vendor-ui-BGi_EvHx.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-charts-0DeywwxG.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";const G=({question:a,instruction:s,correctAnswer:i,incorrectAnswers:c,explanation:o,hint:m,onComplete:x,showResult:g=!0})=>{const[h,b]=e.useState(null),[u,p]=e.useState(!1),[j,f]=e.useState(!1),N=e.useMemo(()=>function(e){const r=[...e];for(let a=r.length-1;a>0;a--){const e=Math.floor(Math.random()*(a+1));[r[a],r[e]]=[r[e],r[a]]}return r}([i,...c]),[i,c]),y=h===i,w=e=>u?e===i?"border-emerald-500 bg-emerald-50 dark:bg-emerald-900/30 text-emerald-800 dark:text-emerald-200":e===h&&e!==i?"border-red-500 bg-red-50 dark:bg-red-900/30 text-red-800 dark:text-red-200":"border-gray-200 dark:border-gray-600 opacity-50 text-gray-500 dark:text-gray-400":h===e?"border-blue-500 bg-blue-50 dark:bg-blue-900/30 ring-2 ring-blue-200 dark:ring-blue-800 text-gray-900 dark:text-gray-100":"border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500 hover:bg-gray-50 dark:hover:bg-gray-700/50 text-gray-900 dark:text-gray-100";return r.jsx(t,{className:"w-full bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:r.jsxs(l,{className:"p-6 space-y-4",children:[s&&r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 italic",children:s}),r.jsx("div",{className:"text-lg font-medium leading-relaxed text-gray-900 dark:text-gray-100",children:a}),m&&!u&&r.jsx("div",{children:j?r.jsxs("div",{className:"flex items-start gap-2 p-3 bg-amber-50 rounded-lg border border-amber-200",children:[r.jsx(A,{className:"w-5 h-5 text-amber-500 shrink-0 mt-0.5"}),r.jsx("p",{className:"text-sm text-amber-800",children:m})]}):r.jsxs(n,{variant:"ghost",size:"sm",onClick:()=>f(!0),className:"text-amber-600 hover:text-amber-700",children:[r.jsx(A,{className:"w-4 h-4 mr-1"}),"Show Hint"]})}),r.jsx("div",{className:"grid gap-3",children:N.map((e,a)=>r.jsx("button",{onClick:()=>(e=>{u||b(e)})(e),disabled:u,className:d("w-full p-4 text-left rounded-lg border-2 transition-all duration-200",w(e),!u&&"cursor-pointer"),children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("span",{className:"w-8 h-8 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-sm font-medium shrink-0 text-gray-700 dark:text-gray-200",children:String.fromCharCode(65+a)}),r.jsx("span",{className:"flex-1 text-inherit",children:e}),u&&e===i&&r.jsx(q,{className:"w-5 h-5 text-emerald-500 shrink-0"}),u&&e===h&&e!==i&&r.jsx(T,{className:"w-5 h-5 text-red-500 shrink-0"})]})},a))}),!u&&r.jsx(n,{onClick:()=>{h&&!u&&(p(!0),x(h===i,h))},disabled:!h,className:"w-full bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600",children:"Check Answer"}),u&&g&&r.jsxs("div",{className:d("p-4 rounded-lg border-2",y?"bg-emerald-50 dark:bg-emerald-900/30 border-emerald-200 dark:border-emerald-700":"bg-red-50 dark:bg-red-900/30 border-red-200 dark:border-red-700"),children:[r.jsx("div",{className:"flex items-center gap-2 mb-2",children:y?r.jsxs(r.Fragment,{children:[r.jsx(q,{className:"w-5 h-5 text-emerald-500"}),r.jsx("span",{className:"font-semibold text-emerald-700 dark:text-emerald-300",children:"Correct!"})]}):r.jsxs(r.Fragment,{children:[r.jsx(T,{className:"w-5 h-5 text-red-500"}),r.jsx("span",{className:"font-semibold text-red-700 dark:text-red-300",children:"Not quite right"})]})}),o&&r.jsx("p",{className:d("text-sm",y?"text-emerald-700 dark:text-emerald-300":"text-red-700 dark:text-red-300"),children:o}),!y&&r.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-2",children:["The correct answer is: ",r.jsx("strong",{className:"text-gray-800 dark:text-gray-100",children:i})]})]})]})})},$=({sentence:a,instruction:s,correctAnswer:c,acceptableAnswers:o=[],explanation:m,hint:x,onComplete:g,showResult:h=!0})=>{const[b,u]=e.useState(""),[p,j]=e.useState(!1),[f,N]=e.useState(!1),y=e.useRef(null);e.useEffect(()=>{var e;null==(e=y.current)||e.focus()},[]);const w=e=>e.toLowerCase().trim().replace(/\s+/g," "),v=[c,...o].map(w).includes(w(b)),k=()=>{b.trim()&&!p&&(j(!0),g(v,b))},_=e=>{"Enter"===e.key&&k()};return r.jsx(t,{className:"w-full bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:r.jsxs(l,{className:"p-6 space-y-4",children:[s&&r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 italic",children:s}),r.jsx("div",{className:"py-2",children:(()=>{const e=a.split("___");return 1===e.length?r.jsxs("div",{className:"space-y-3",children:[r.jsx("p",{className:"text-lg leading-relaxed text-gray-900 dark:text-gray-100",children:a}),r.jsx(i,{ref:y,value:b,onChange:e=>u(e.target.value),onKeyDown:_,disabled:p,placeholder:"Type your answer...",className:d("text-lg font-medium",p&&v&&"border-emerald-500 bg-emerald-50",p&&!v&&"border-red-500 bg-red-50")})]}):r.jsx("p",{className:"text-lg leading-relaxed inline-flex flex-wrap items-center gap-1 text-gray-900 dark:text-gray-100",children:e.map((a,s)=>r.jsxs("span",{className:"inline-flex items-center gap-1",children:[r.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:a}),s<e.length-1&&r.jsx(i,{ref:0===s?y:void 0,value:b,onChange:e=>u(e.target.value),onKeyDown:_,disabled:p,placeholder:"...",className:d("inline-block w-40 text-center font-medium border-b-2 border-t-0 border-l-0 border-r-0 rounded-none bg-transparent px-2 text-gray-900 dark:text-gray-100",p&&v&&"border-emerald-500 text-emerald-700 dark:text-emerald-300",p&&!v&&"border-red-500 text-red-700 dark:text-red-300",!p&&"border-blue-400 focus:border-blue-500 dark:border-blue-500")})]},s))})})()}),x&&!p&&r.jsx("div",{children:f?r.jsxs("div",{className:"flex items-start gap-2 p-3 bg-amber-50 rounded-lg border border-amber-200",children:[r.jsx(A,{className:"w-5 h-5 text-amber-500 shrink-0 mt-0.5"}),r.jsx("p",{className:"text-sm text-amber-800",children:x})]}):r.jsxs(n,{variant:"ghost",size:"sm",onClick:()=>N(!0),className:"text-amber-600 hover:text-amber-700",children:[r.jsx(A,{className:"w-4 h-4 mr-1"}),"Show Hint"]})}),!p&&r.jsx(n,{onClick:k,disabled:!b.trim(),className:"w-full bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600",children:"Check Answer"}),p&&h&&r.jsxs("div",{className:d("p-4 rounded-lg border-2",v?"bg-emerald-50 dark:bg-emerald-900/30 border-emerald-200 dark:border-emerald-700":"bg-red-50 dark:bg-red-900/30 border-red-200 dark:border-red-700"),children:[r.jsx("div",{className:"flex items-center gap-2 mb-2",children:v?r.jsxs(r.Fragment,{children:[r.jsx(q,{className:"w-5 h-5 text-emerald-500"}),r.jsx("span",{className:"font-semibold text-emerald-700 dark:text-emerald-300",children:"Correct!"})]}):r.jsxs(r.Fragment,{children:[r.jsx(T,{className:"w-5 h-5 text-red-500"}),r.jsx("span",{className:"font-semibold text-red-700 dark:text-red-300",children:"Not quite right"})]})}),m&&r.jsx("p",{className:d("text-sm",v?"text-emerald-700 dark:text-emerald-300":"text-red-700 dark:text-red-300"),children:m}),!v&&r.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-2",children:["The correct answer is: ",r.jsx("strong",{className:"text-gray-800 dark:text-gray-100",children:c})]})]})]})})},K=({incorrectSentence:a,instruction:s,correctAnswer:c,acceptableAnswers:o=[],explanation:m,hint:x,errorHighlight:g,onComplete:h,showResult:b=!0})=>{const[u,p]=e.useState(""),[j,f]=e.useState(!1),[N,y]=e.useState(!1),w=e.useRef(null);e.useEffect(()=>{var e;null==(e=w.current)||e.focus()},[]);const v=e=>e.toLowerCase().trim().replace(/\s+/g," ").replace(/[.,!?;:]/g,""),k=[c,...o].map(v).includes(v(u)),_=()=>{u.trim()&&!j&&(f(!0),h(k,u))};return r.jsx(t,{className:"w-full bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:r.jsxs(l,{className:"p-6 space-y-4",children:[r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx(E,{className:"w-5 h-5 text-amber-500 shrink-0 mt-0.5"}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:s||"Find and correct the error in this sentence:"})]}),r.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/30 rounded-lg border border-red-200 dark:border-red-700",children:r.jsx("p",{className:"text-lg leading-relaxed text-gray-900 dark:text-gray-100",children:(()=>{if(!g)return r.jsx("span",{children:a});const e=a.split(new RegExp(`(${g})`,"i"));return r.jsx(r.Fragment,{children:e.map((e,a)=>e.toLowerCase()===g.toLowerCase()?r.jsx("span",{className:"bg-red-200 text-red-800 px-1 rounded underline decoration-wavy decoration-red-500",children:e},a):r.jsx("span",{children:e},a))})})()})}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Write the corrected sentence:"}),r.jsx(i,{ref:w,value:u,onChange:e=>p(e.target.value),onKeyDown:e=>{"Enter"===e.key&&_()},disabled:j,placeholder:"Type the correct sentence...",className:d("text-base",j&&k&&"border-emerald-500 bg-emerald-50",j&&!k&&"border-red-500 bg-red-50")})]}),x&&!j&&r.jsx("div",{children:N?r.jsxs("div",{className:"flex items-start gap-2 p-3 bg-amber-50 rounded-lg border border-amber-200",children:[r.jsx(A,{className:"w-5 h-5 text-amber-500 shrink-0 mt-0.5"}),r.jsx("p",{className:"text-sm text-amber-800",children:x})]}):r.jsxs(n,{variant:"ghost",size:"sm",onClick:()=>y(!0),className:"text-amber-600 hover:text-amber-700",children:[r.jsx(A,{className:"w-4 h-4 mr-1"}),"Show Hint"]})}),!j&&r.jsx(n,{onClick:_,disabled:!u.trim(),className:"w-full bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600",children:"Check Answer"}),j&&b&&r.jsxs("div",{className:d("p-4 rounded-lg border-2",k?"bg-emerald-50 dark:bg-emerald-900/30 border-emerald-200 dark:border-emerald-700":"bg-red-50 dark:bg-red-900/30 border-red-200 dark:border-red-700"),children:[r.jsx("div",{className:"flex items-center gap-2 mb-2",children:k?r.jsxs(r.Fragment,{children:[r.jsx(q,{className:"w-5 h-5 text-emerald-500"}),r.jsx("span",{className:"font-semibold text-emerald-700 dark:text-emerald-300",children:"Correct!"})]}):r.jsxs(r.Fragment,{children:[r.jsx(T,{className:"w-5 h-5 text-red-500"}),r.jsx("span",{className:"font-semibold text-red-700 dark:text-red-300",children:"Not quite right"})]})}),r.jsxs("div",{className:"p-3 bg-white dark:bg-gray-700 rounded border dark:border-gray-600 mb-2",children:[r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-1",children:"Correct sentence:"}),r.jsx("p",{className:"font-medium text-emerald-700 dark:text-emerald-300",children:c})]}),m&&r.jsx("p",{className:d("text-sm",k?"text-emerald-700 dark:text-emerald-300":"text-red-700 dark:text-red-300"),children:m})]})]})})},U=({originalSentence:a,instruction:s,transformationType:c,correctAnswer:o,acceptableAnswers:m=[],startingWord:x,explanation:g,hint:h,onComplete:b,showResult:u=!0})=>{const[p,j]=e.useState(x||""),[f,N]=e.useState(!1),[y,w]=e.useState(!1),v=e.useRef(null);e.useEffect(()=>{var e;null==(e=v.current)||e.focus()},[]);const k=e=>e.toLowerCase().trim().replace(/\s+/g," ").replace(/[.,!?;:]/g,""),_=[o,...m].map(k).includes(k(p)),C=()=>{p.trim()&&!f&&(N(!0),b(_,p))};return r.jsx(t,{className:"w-full",children:r.jsxs(l,{className:"p-6 space-y-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(F,{className:"w-4 h-4 text-gray-500"}),r.jsx("span",{className:d("text-xs font-medium px-2 py-1 rounded-full border",(()=>{const e=c.toLowerCase();return e.includes("passive")?"bg-purple-100 text-purple-700 border-purple-200":e.includes("reported")||e.includes("indirect")?"bg-blue-100 text-blue-700 border-blue-200":e.includes("conditional")?"bg-amber-100 text-amber-700 border-amber-200":e.includes("negative")?"bg-red-100 text-red-700 border-red-200":e.includes("question")?"bg-green-100 text-green-700 border-green-200":"bg-gray-100 text-gray-700 border-gray-200"})()),children:c})]}),r.jsx("p",{className:"text-sm text-muted-foreground",children:s||`Transform the sentence (${c}):`}),r.jsx("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:r.jsx("p",{className:"text-lg font-medium text-blue-800",children:a})}),r.jsx("div",{className:"flex items-center justify-center",children:r.jsx(R,{className:"w-6 h-6 text-gray-400"})}),r.jsxs("div",{className:"space-y-2",children:[x&&r.jsxs("p",{className:"text-sm text-gray-600",children:["Begin your answer with: ",r.jsx("strong",{children:x})]}),r.jsx(i,{ref:v,value:p,onChange:e=>j(e.target.value),onKeyDown:e=>{"Enter"===e.key&&C()},disabled:f,placeholder:"Write the transformed sentence...",className:d("text-base",f&&_&&"border-emerald-500 bg-emerald-50",f&&!_&&"border-red-500 bg-red-50")})]}),h&&!f&&r.jsx("div",{children:y?r.jsxs("div",{className:"flex items-start gap-2 p-3 bg-amber-50 rounded-lg border border-amber-200",children:[r.jsx(A,{className:"w-5 h-5 text-amber-500 shrink-0 mt-0.5"}),r.jsx("p",{className:"text-sm text-amber-800",children:h})]}):r.jsxs(n,{variant:"ghost",size:"sm",onClick:()=>w(!0),className:"text-amber-600 hover:text-amber-700",children:[r.jsx(A,{className:"w-4 h-4 mr-1"}),"Show Hint"]})}),!f&&r.jsx(n,{onClick:C,disabled:!p.trim(),className:"w-full bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600",children:"Check Answer"}),f&&u&&r.jsxs("div",{className:d("p-4 rounded-lg border-2",_?"bg-emerald-50 border-emerald-200":"bg-red-50 border-red-200"),children:[r.jsx("div",{className:"flex items-center gap-2 mb-2",children:_?r.jsxs(r.Fragment,{children:[r.jsx(q,{className:"w-5 h-5 text-emerald-500"}),r.jsx("span",{className:"font-semibold text-emerald-700",children:"Correct!"})]}):r.jsxs(r.Fragment,{children:[r.jsx(T,{className:"w-5 h-5 text-red-500"}),r.jsx("span",{className:"font-semibold text-red-700",children:"Not quite right"})]})}),r.jsxs("div",{className:"p-3 bg-white rounded border mb-2",children:[r.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Correct transformation:"}),r.jsx("p",{className:"font-medium text-emerald-700",children:o})]}),g&&r.jsx("p",{className:d("text-sm",_?"text-emerald-700":"text-red-700"),children:g})]})]})})};function V(e){const r=[...e];for(let a=r.length-1;a>0;a--){const e=Math.floor(Math.random()*(a+1));[r[a],r[e]]=[r[e],r[a]]}return r}const Y=({instruction:a,words:s,correctOrder:i,explanation:c,hint:o,onComplete:m,showResult:x=!0})=>{const[g,h]=e.useState(()=>V(s)),[b,u]=e.useState([]),[p,j]=e.useState(!1),[f,N]=e.useState(!1),[y,w]=e.useState(null),[v,k]=e.useState(null),_=b.length===i.length&&b.every((e,r)=>e.toLowerCase()===i[r].toLowerCase()),C=(e,r)=>{p||("available"===r?(h(r=>r.filter((a,s)=>s!==r.indexOf(e))),u(r=>[...r,e])):(u(r=>r.filter((a,s)=>s!==r.indexOf(e))),h(r=>[...r,e])))},S=(e,r)=>{w(e),k(r)},E=e=>{e.preventDefault()},F=(e,r)=>{y&&v&&!p&&("available"===v?h(e=>{const r=e.indexOf(y);return e.filter((e,a)=>a!==r)}):u(e=>{const r=e.indexOf(y);return e.filter((e,a)=>a!==r)}),"available"===e?h(e=>[...e,y]):u(void 0!==r?e=>{const a=[...e];return a.splice(r,0,y),a}:e=>[...e,y]),w(null),k(null))};return r.jsx(t,{className:"w-full",children:r.jsxs(l,{className:"p-6 space-y-4",children:[r.jsx("p",{className:"text-sm text-muted-foreground",children:a||"Arrange the words to form a correct sentence:"}),r.jsx("div",{className:d("min-h-[60px] p-3 rounded-lg border-2 border-dashed transition-colors",0===b.length?"border-gray-300 bg-gray-50":"border-blue-300 bg-blue-50",p&&_&&"border-emerald-400 bg-emerald-50",p&&!_&&"border-red-400 bg-red-50"),onDragOver:E,onDrop:()=>F("selected"),children:0===b.length?r.jsx("p",{className:"text-center text-gray-400 text-sm py-2",children:"Click or drag words here to build your sentence"}):r.jsx("div",{className:"flex flex-wrap gap-2",children:b.map((e,a)=>r.jsxs("div",{draggable:!p,onDragStart:()=>S(e,"selected"),onDragOver:E,onDrop:e=>{if(e.stopPropagation(),"selected"===v){((e,r)=>{p||u(a=>{const s=[...a],[t]=s.splice(e,1);return s.splice(r,0,t),s})})(b.indexOf(y),a)}else F("selected",a)},onClick:()=>C(e,"selected"),className:d("inline-flex items-center gap-1 px-3 py-2 rounded-lg font-medium text-sm cursor-pointer transition-all","bg-white border-2 shadow-sm hover:shadow-md",p?"cursor-default":"hover:scale-105",p&&_&&"border-emerald-400 text-emerald-700",p&&!_&&"border-red-400 text-red-700",!p&&"border-blue-400 text-blue-700"),children:[r.jsx(z,{className:"w-3 h-3 opacity-50"}),e]},`selected-${a}`))})}),r.jsx("div",{className:"min-h-[60px] p-3 rounded-lg bg-gray-100 border border-gray-200",onDragOver:E,onDrop:()=>F("available"),children:0===g.length?r.jsx("p",{className:"text-center text-gray-400 text-sm py-2",children:"All words used!"}):r.jsx("div",{className:"flex flex-wrap gap-2",children:g.map((e,a)=>r.jsx("div",{draggable:!p,onDragStart:()=>S(e,"available"),onClick:()=>C(e,"available"),className:d("inline-flex items-center gap-1 px-3 py-2 rounded-lg font-medium text-sm cursor-pointer transition-all","bg-white border-2 border-gray-300 text-gray-700 shadow-sm",p?"cursor-default opacity-50":"hover:border-blue-400 hover:shadow-md hover:scale-105"),children:e},`available-${a}`))})}),o&&!p&&r.jsx("div",{children:f?r.jsxs("div",{className:"flex items-start gap-2 p-3 bg-amber-50 rounded-lg border border-amber-200",children:[r.jsx(A,{className:"w-5 h-5 text-amber-500 shrink-0 mt-0.5"}),r.jsx("p",{className:"text-sm text-amber-800",children:o})]}):r.jsxs(n,{variant:"ghost",size:"sm",onClick:()=>N(!0),className:"text-amber-600 hover:text-amber-700",children:[r.jsx(A,{className:"w-4 h-4 mr-1"}),"Show Hint"]})}),!p&&r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(n,{variant:"outline",onClick:()=>{u([]),h(V(s)),j(!1)},disabled:0===b.length,className:"flex-1",children:[r.jsx(D,{className:"w-4 h-4 mr-2"}),"Reset"]}),r.jsx(n,{onClick:()=>{0===b.length||p||(j(!0),m(_,b.join(" ")))},disabled:0===b.length,className:"flex-1 bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600",children:"Check Answer"})]}),p&&x&&r.jsxs("div",{className:d("p-4 rounded-lg border-2",_?"bg-emerald-50 border-emerald-200":"bg-red-50 border-red-200"),children:[r.jsx("div",{className:"flex items-center gap-2 mb-2",children:_?r.jsxs(r.Fragment,{children:[r.jsx(q,{className:"w-5 h-5 text-emerald-500"}),r.jsx("span",{className:"font-semibold text-emerald-700",children:"Correct!"})]}):r.jsxs(r.Fragment,{children:[r.jsx(T,{className:"w-5 h-5 text-red-500"}),r.jsx("span",{className:"font-semibold text-red-700",children:"Not quite right"})]})}),!_&&r.jsxs("div",{className:"p-3 bg-white rounded border mb-2",children:[r.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Correct order:"}),r.jsx("p",{className:"font-medium text-emerald-700",children:i.join(" ")})]}),c&&r.jsx("p",{className:d("text-sm",_?"text-emerald-700":"text-red-700"),children:c})]})]})})},J=({exercise:e,onComplete:a,showResult:s=!0})=>{switch(e.type){case"multiple_choice":return r.jsx(G,{question:e.question||"",instruction:e.instruction,correctAnswer:e.correctAnswer,incorrectAnswers:e.incorrectAnswers||[],explanation:e.explanation,hint:e.hint,onComplete:a,showResult:s});case"fill_in_blank":return r.jsx($,{sentence:e.sentenceWithBlank||e.question||"",instruction:e.instruction,correctAnswer:e.correctAnswer,acceptableAnswers:e.acceptableAnswers,explanation:e.explanation,hint:e.hint,onComplete:a,showResult:s});case"error_correction":return r.jsx(K,{incorrectSentence:e.incorrectSentence||e.question||"",instruction:e.instruction,correctAnswer:e.correctAnswer,acceptableAnswers:e.acceptableAnswers,explanation:e.explanation,hint:e.hint,errorHighlight:e.errorHighlight,onComplete:a,showResult:s});case"sentence_transformation":return r.jsx(U,{originalSentence:e.originalSentence||e.question||"",instruction:e.instruction,transformationType:e.transformationType||"transformation",correctAnswer:e.correctAnswer,acceptableAnswers:e.acceptableAnswers,startingWord:e.startingWord,explanation:e.explanation,hint:e.hint,onComplete:a,showResult:s});case"drag_drop_reorder":return r.jsx(Y,{instruction:e.instruction,words:e.words||e.correctOrder||[],correctOrder:e.correctOrder||[],explanation:e.explanation,hint:e.hint,onComplete:a,showResult:s});default:return r.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:r.jsxs("p",{className:"text-red-600",children:["Unknown exercise type: ",e.type]})})}},Q=[{code:"en",name:"English",flag:"ðŸ‡¬ðŸ‡§"},{code:"es",name:"EspaÃ±ol",flag:"ðŸ‡ªðŸ‡¸"},{code:"zh",name:"ä¸­æ–‡",flag:"ðŸ‡¨ðŸ‡³"},{code:"hi",name:"à¤¹à¤¿à¤¨à¥à¤¦à¥€",flag:"ðŸ‡®ðŸ‡³"},{code:"ar",name:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",flag:"ðŸ‡¸ðŸ‡¦"},{code:"pt",name:"PortuguÃªs",flag:"ðŸ‡§ðŸ‡·"},{code:"bn",name:"à¦¬à¦¾à¦‚à¦²à¦¾",flag:"ðŸ‡§ðŸ‡©"},{code:"ru",name:"Ð ÑƒÑÑÐºÐ¸Ð¹",flag:"ðŸ‡·ðŸ‡º"},{code:"ja",name:"æ—¥æœ¬èªž",flag:"ðŸ‡¯ðŸ‡µ"},{code:"de",name:"Deutsch",flag:"ðŸ‡©ðŸ‡ª"},{code:"fr",name:"FranÃ§ais",flag:"ðŸ‡«ðŸ‡·"},{code:"ko",name:"í•œêµ­ì–´",flag:"ðŸ‡°ðŸ‡·"},{code:"vi",name:"Tiáº¿ng Viá»‡t",flag:"ðŸ‡»ðŸ‡³"},{code:"it",name:"Italiano",flag:"ðŸ‡®ðŸ‡¹"},{code:"tr",name:"TÃ¼rkÃ§e",flag:"ðŸ‡¹ðŸ‡·"},{code:"th",name:"à¹„à¸—à¸¢",flag:"ðŸ‡¹ðŸ‡­"},{code:"pl",name:"Polski",flag:"ðŸ‡µðŸ‡±"},{code:"nl",name:"Nederlands",flag:"ðŸ‡³ðŸ‡±"},{code:"id",name:"Bahasa Indonesia",flag:"ðŸ‡®ðŸ‡©"},{code:"uk",name:"Ð£ÐºÑ€Ð°Ñ—Ð½ÑÑŒÐºÐ°",flag:"ðŸ‡ºðŸ‡¦"},{code:"ms",name:"Bahasa Melayu",flag:"ðŸ‡²ðŸ‡¾"},{code:"fa",name:"ÙØ§Ø±Ø³ÛŒ",flag:"ðŸ‡®ðŸ‡·"},{code:"tl",name:"Tagalog",flag:"ðŸ‡µðŸ‡­"},{code:"ro",name:"RomÃ¢nÄƒ",flag:"ðŸ‡·ðŸ‡´"},{code:"el",name:"Î•Î»Î»Î·Î½Î¹ÎºÎ¬",flag:"ðŸ‡¬ðŸ‡·"},{code:"cs",name:"ÄŒeÅ¡tina",flag:"ðŸ‡¨ðŸ‡¿"},{code:"sv",name:"Svenska",flag:"ðŸ‡¸ðŸ‡ª"},{code:"hu",name:"Magyar",flag:"ðŸ‡­ðŸ‡º"},{code:"he",name:"×¢×‘×¨×™×ª",flag:"ðŸ‡®ðŸ‡±"}],X=()=>{const{topicSlug:i}=a(),T=s(),{user:E}=c(),F=o(),[z,G]=e.useState(null),[$,K]=e.useState(null),[U,V]=e.useState([]),[Y,X]=e.useState(!0),[Z,ee]=e.useState("theory"),[re,ae]=e.useState(0),[se,te]=e.useState(new Set),[le,ne]=e.useState(0),[de,ie]=e.useState(!1),[ce,oe]=e.useState(!1),[me,xe]=e.useState(()=>localStorage.getItem("preferred_language")||"en");e.useEffect(()=>{i&&ge()},[i,E,me]);const ge=async()=>{var e,r,a,s,t,l,n,d,c;X(!0);try{const o=me,{data:x,error:g}=await m.from("grammar_topics").select("\n          id,\n          slug,\n          level,\n          grammar_topic_translations!inner(title, description)\n        ").eq("slug",i).eq("grammar_topic_translations.language_code",o).single();if(g){const{data:t}=await m.from("grammar_topics").select("\n            id,\n            slug,\n            level,\n            grammar_topic_translations(title, description)\n          ").eq("slug",i).single();t&&G({...t,title:(null==(r=null==(e=t.grammar_topic_translations)?void 0:e[0])?void 0:r.title)||(null==i?void 0:i.replace(/-/g," ")),description:(null==(s=null==(a=t.grammar_topic_translations)?void 0:a[0])?void 0:s.description)||""})}else x&&G({...x,title:(null==(l=null==(t=x.grammar_topic_translations)?void 0:t[0])?void 0:l.title)||(null==i?void 0:i.replace(/-/g," ")),description:(null==(d=null==(n=x.grammar_topic_translations)?void 0:n[0])?void 0:d.description)||""});const h=(null==x?void 0:x.id)||null;if(h){const{data:e}=await m.from("grammar_lessons").select("\n            id,\n            grammar_lesson_translations!inner(\n              theory_title,\n              theory_definition,\n              theory_formation,\n              theory_usage,\n              theory_common_mistakes,\n              rules,\n              examples,\n              localized_tips\n            )\n          ").eq("topic_id",h).eq("grammar_lesson_translations.language_code",o).order("lesson_order").limit(1).maybeSingle();if(e){const r=null==(c=e.grammar_lesson_translations)?void 0:c[0];K({id:e.id,...r,rules:(null==r?void 0:r.rules)||[],examples:(null==r?void 0:r.examples)||[]})}const{data:r}=await m.from("grammar_exercises").select("\n            id,\n            exercise_type,\n            difficulty,\n            exercise_order,\n            correct_order,\n            transformation_type,\n            grammar_exercise_translations!inner(\n              question,\n              instruction,\n              correct_answer,\n              incorrect_answers,\n              explanation,\n              hint,\n              sentence_with_blank,\n              incorrect_sentence,\n              original_sentence\n            )\n          ").eq("topic_id",h).eq("grammar_exercise_translations.language_code",o).order("exercise_order");if(r&&V(r.map(e=>{var r;return{...e,translations:(null==(r=e.grammar_exercise_translations)?void 0:r[0])||{}}})),E){const{data:e}=await m.from("user_grammar_progress").select("*").eq("user_id",E.id).eq("topic_id",h).maybeSingle();e&&oe(e.theory_completed||!1)}}}catch(o){console.error("Error loading lesson:",o)}finally{X(!1)}},he=async()=>{if(!E||!z)return;const e=U.length>0?Math.round(le/U.length*100):0,r=be(e);await m.from("user_grammar_progress").upsert({user_id:E.id,topic_id:z.id,theory_completed:!0,exercises_completed:se.size,total_exercises:U.length,best_score:e,mastery_level:r,last_practiced_at:(new Date).toISOString()},{onConflict:"user_id,topic_id"})},be=e=>e>=90?100:e>=80?90:e>=70?80:e>=60?70:e>=50?60:Math.max(50,e);if(Y)return r.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:F.theme.colors.background},children:r.jsx(x,{})});if(!z)return r.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:F.theme.colors.background},children:r.jsxs(t,{className:"p-8 text-center",children:[r.jsx(O,{className:"w-12 h-12 mx-auto text-red-500 mb-4"}),r.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Topic Not Found"}),r.jsx("p",{className:"text-muted-foreground mb-4",children:"The grammar topic you're looking for doesn't exist."}),r.jsx(n,{onClick:()=>T("/grammar"),children:"Back to Grammar Portal"})]})});const ue={beginner:"from-emerald-400 to-green-500",intermediate:"from-blue-400 to-indigo-500",advanced:"from-purple-400 to-violet-500"},pe=U.length>0?Math.round(se.size/U.length*100):0;return r.jsxs("div",{className:"min-h-screen relative",style:{backgroundColor:F.theme.colors.background},children:[r.jsx(g,{title:`${z.title} - Grammar Lesson`,description:z.description||`Learn ${z.title} with clear explanations and interactive exercises.`}),r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-emerald-50/50 via-blue-50/50 to-purple-50/50"}),r.jsx("div",{className:"relative z-10",children:r.jsx(h,{title:z.title||"Grammar Lesson",showBackButton:!0,backPath:"/grammar",children:r.jsxs("div",{className:"max-w-4xl mx-auto px-4 md:px-6 pb-12 space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>T("/hero"),className:"text-sm text-muted-foreground hover:text-primary",children:r.jsx(L,{className:"h-4 w-4"})}),r.jsx("span",{className:"text-muted-foreground",children:"/"}),r.jsx("button",{onClick:()=>T("/grammar"),className:"text-sm text-muted-foreground hover:text-primary",children:"Grammar"}),r.jsx("span",{className:"text-muted-foreground",children:"/"}),r.jsx("span",{className:"text-sm font-medium",style:{color:F.textPrimary},children:z.title})]}),r.jsxs(b,{value:me,onValueChange:e=>{xe(e),localStorage.setItem("preferred_language",e)},children:[r.jsxs(u,{className:"w-[160px] h-9 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 shadow-sm",children:[r.jsx(M,{className:"w-4 h-4 mr-2 text-emerald-600 dark:text-emerald-400"}),r.jsx(p,{placeholder:"Language",className:"text-gray-900 dark:text-gray-100"})]}),r.jsx(j,{className:"max-h-[300px] bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 z-50 shadow-lg",children:Q.map(e=>r.jsx(f,{value:e.code,className:"cursor-pointer text-gray-900 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700",children:r.jsxs("span",{className:"flex items-center gap-2",children:[r.jsx("span",{children:e.flag}),r.jsx("span",{children:e.name})]})},e.code))})]})]}),r.jsxs(t,{className:"overflow-hidden bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:[r.jsx("div",{className:`h-2 bg-gradient-to-r ${ue[z.level]||ue.beginner}`}),r.jsx(l,{className:"p-6",children:r.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(N,{variant:"secondary",className:"capitalize",children:z.level}),ce&&r.jsxs(N,{className:"bg-emerald-100 text-emerald-700",children:[r.jsx(q,{className:"w-3 h-3 mr-1"}),"Theory Complete"]})]}),r.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2 text-gray-900 dark:text-gray-100",children:z.title}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:z.description})]}),U.length>0&&r.jsxs("div",{className:"w-full md:w-48",children:[r.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[r.jsx("span",{className:"text-muted-foreground",children:"Progress"}),r.jsxs("span",{className:"font-semibold",children:[pe,"%"]})]}),r.jsx(y,{value:pe,className:"h-2"})]})]})})]}),r.jsxs(k,{value:Z,onValueChange:e=>ee(e),children:[r.jsxs(_,{className:"grid w-full grid-cols-2 max-w-sm",children:[r.jsxs(C,{value:"theory",className:"flex items-center gap-2",children:[r.jsx(I,{className:"w-4 h-4"}),"Theory"]}),r.jsxs(C,{value:"exercises",className:"flex items-center gap-2",disabled:!$&&0===U.length,children:[r.jsx(P,{className:"w-4 h-4"}),"Exercises (",U.length,")"]})]}),r.jsx(S,{value:"theory",className:"space-y-6 mt-6",children:$?r.jsxs(r.Fragment,{children:[$.theory_definition&&r.jsxs(t,{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:[r.jsx(w,{children:r.jsxs(v,{className:"flex items-center gap-2 text-gray-900 dark:text-gray-100",children:[r.jsx(A,{className:"w-5 h-5 text-amber-500"}),"What is ",z.title,"?"]})}),r.jsx(l,{children:r.jsx("p",{className:"text-base leading-relaxed whitespace-pre-line text-gray-900 dark:text-gray-100",children:$.theory_definition})})]}),$.theory_formation&&r.jsxs(t,{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:[r.jsx(w,{children:r.jsxs(v,{className:"flex items-center gap-2 text-gray-900 dark:text-gray-100",children:[r.jsx(P,{className:"w-5 h-5 text-blue-500"}),"How to Form It"]})}),r.jsxs(l,{children:[r.jsx("p",{className:"text-base leading-relaxed whitespace-pre-line text-gray-900 dark:text-gray-100",children:$.theory_formation}),$.rules&&$.rules.length>0&&r.jsx("div",{className:"mt-4 space-y-3",children:$.rules.map((e,a)=>r.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[r.jsx("p",{className:"font-semibold text-blue-800 mb-1",children:e.title}),r.jsx("p",{className:"font-mono text-sm bg-white p-2 rounded mb-2",children:e.formula}),r.jsxs("p",{className:"text-sm text-blue-600 italic",children:["Example: ",e.example]})]},a))})]})]}),$.theory_usage&&r.jsxs(t,{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:[r.jsx(w,{children:r.jsxs(v,{className:"flex items-center gap-2 text-gray-900 dark:text-gray-100",children:[r.jsx(q,{className:"w-5 h-5 text-emerald-500"}),"When to Use It"]})}),r.jsx(l,{children:r.jsx("p",{className:"text-base leading-relaxed whitespace-pre-line text-gray-900 dark:text-gray-100",children:$.theory_usage})})]}),$.examples&&$.examples.length>0&&r.jsxs(t,{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:[r.jsx(w,{children:r.jsxs(v,{className:"flex items-center gap-2 text-gray-900 dark:text-gray-100",children:[r.jsx(I,{className:"w-5 h-5 text-purple-500"}),"Examples"]})}),r.jsx(l,{children:r.jsx("div",{className:"space-y-3",children:$.examples.map((e,a)=>r.jsx("div",{className:d("p-3 rounded-lg border",!1!==e.correct?"bg-emerald-50 border-emerald-200":"bg-red-50 border-red-200"),children:r.jsxs("div",{className:"flex items-start gap-2",children:[!1!==e.correct?r.jsx(q,{className:"w-4 h-4 text-emerald-500 mt-1 shrink-0"}):r.jsx(O,{className:"w-4 h-4 text-red-500 mt-1 shrink-0"}),r.jsxs("div",{children:[r.jsx("p",{className:d("font-medium",!1!==e.correct?"text-emerald-800":"text-red-800"),children:e.sentence}),e.translation&&r.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.translation})]})]})},a))})})]}),$.theory_common_mistakes&&r.jsxs(t,{className:"border-amber-200",style:{backgroundColor:"rgb(254 252 232)"},children:[r.jsx(w,{children:r.jsxs(v,{className:"flex items-center gap-2 text-amber-700",children:[r.jsx(O,{className:"w-5 h-5"}),"Common Mistakes to Avoid"]})}),r.jsx(l,{children:r.jsx("p",{className:"text-amber-800 leading-relaxed whitespace-pre-line",children:$.theory_common_mistakes})})]}),$.localized_tips&&r.jsxs(t,{className:"border-purple-200",style:{backgroundColor:"rgb(250 245 255)"},children:[r.jsx(w,{children:r.jsxs(v,{className:"flex items-center gap-2 text-purple-700",children:[r.jsx(B,{className:"w-5 h-5"}),"Tips for Your Language"]})}),r.jsx(l,{children:r.jsx("p",{className:"text-purple-800 leading-relaxed whitespace-pre-line",children:$.localized_tips})})]}),r.jsx("div",{className:"flex justify-center pt-4",children:r.jsxs(n,{size:"lg",onClick:async()=>{oe(!0),ee("exercises"),E&&z&&await m.from("user_grammar_progress").upsert({user_id:E.id,topic_id:z.id,theory_completed:!0,last_practiced_at:(new Date).toISOString()},{onConflict:"user_id,topic_id"})},className:"bg-gradient-to-r from-emerald-500 to-blue-500 hover:from-emerald-600 hover:to-blue-600",children:[ce?"Review Exercises":"I Understand! Continue to Exercises",r.jsx(R,{className:"w-5 h-5 ml-2"})]})})]}):r.jsxs(t,{className:"p-8 text-center bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:[r.jsx(I,{className:"w-12 h-12 mx-auto text-gray-400 dark:text-gray-500 mb-4"}),r.jsx("h3",{className:"text-lg font-semibold mb-2 text-gray-900 dark:text-gray-100",children:"Theory Coming Soon"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"The theory content for this topic is being prepared."})]})}),r.jsx(S,{value:"exercises",className:"mt-6",children:de?r.jsxs(t,{className:"overflow-hidden bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:[r.jsx("div",{className:"h-2 bg-gradient-to-r from-emerald-400 to-blue-500"}),r.jsxs(l,{className:"p-8 text-center",children:[r.jsx(H,{className:"w-16 h-16 mx-auto text-amber-500 mb-4"}),r.jsx("h2",{className:"text-2xl font-bold mb-2 text-gray-900 dark:text-gray-100",children:"Lesson Complete!"}),r.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:["You scored ",le," out of ",U.length]}),r.jsx("div",{className:"flex items-center justify-center gap-2 mb-6",children:[...Array(3)].map((e,a)=>r.jsx(B,{className:d("w-8 h-8",a<Math.ceil(le/U.length*3)?"text-amber-400 fill-current":"text-gray-300")},a))}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[r.jsxs(n,{variant:"outline",onClick:()=>{ae(0),te(new Set),ne(0),ie(!1)},children:[r.jsx(D,{className:"w-4 h-4 mr-2"}),"Try Again"]}),r.jsx(n,{onClick:()=>T("/grammar"),children:"Back to Grammar Portal"})]})]})]}):U.length>0?r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("span",{className:"text-sm text-muted-foreground",children:["Exercise ",re+1," of ",U.length]}),r.jsxs("span",{className:"text-sm font-medium text-emerald-600",children:[le," correct"]})]}),r.jsx(y,{value:re/U.length*100,className:"h-2 mb-6"}),r.jsx(J,{exercise:(e=>{const r=e.translations;return{id:e.id,type:e.exercise_type,question:r.question,instruction:r.instruction,correctAnswer:r.correct_answer,incorrectAnswers:r.incorrect_answers,explanation:r.explanation,hint:r.hint,sentenceWithBlank:r.sentence_with_blank,incorrectSentence:r.incorrect_sentence,originalSentence:r.original_sentence,transformationType:e.transformation_type,words:e.correct_order,correctOrder:e.correct_order}})(U[re]),onComplete:async(e,r)=>{const a=U[re];te(e=>new Set([...e,a.id])),e&&ne(e=>e+1),E&&await m.from("user_grammar_exercise_attempts").insert({user_id:E.id,exercise_id:a.id,user_answer:r,is_correct:e})}},U[re].id),r.jsxs("div",{className:"flex justify-between items-center pt-4",children:[re>0?r.jsxs(n,{variant:"outline",onClick:()=>ae(e=>e-1),children:[r.jsx(W,{className:"w-4 h-4 mr-2"}),"Previous"]}):r.jsx("div",{}),se.has(U[re].id)&&r.jsx(n,{onClick:()=>{re<U.length-1?ae(e=>e+1):(ie(!0),he())},children:re<U.length-1?r.jsxs(r.Fragment,{children:["Next Exercise",r.jsx(R,{className:"w-4 h-4 ml-2"})]}):r.jsxs(r.Fragment,{children:["See Results",r.jsx(H,{className:"w-4 h-4 ml-2"})]})})]})]}):r.jsxs(t,{className:"p-8 text-center bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:[r.jsx(P,{className:"w-12 h-12 mx-auto text-gray-400 dark:text-gray-500 mb-4"}),r.jsx("h3",{className:"text-lg font-semibold mb-2 text-gray-900 dark:text-gray-100",children:"Exercises Coming Soon"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Practice exercises for this topic are being prepared."})]})})]})]})})})]})};export{X as default};
