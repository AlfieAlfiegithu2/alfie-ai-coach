import{u as e,A as t,ak as r,al as s,r as a,j as o,am as n,ah as i,_ as l,a6 as c,an as d,S as m,o as g,p as u,q as h,ao as p,s as x,ap as f,a as y,D as k,l as b,m as _,n as w,B as j}from"./index-ZQZvCd_l.js";import{s as v}from"./supabase-DUkWVuqu.js";import{S}from"./skills-NqzSOyzV.js";const C=[{id:"reading",title:"Reading",description:"Academic & General texts"},{id:"listening",title:"Listening",description:"Audio comprehension"},{id:"writing",title:"Writing",description:"Task 1 & Task 2"},{id:"speaking",title:"Speaking",description:"Interview & presentation"}],T=()=>{const T=e(),{user:N}=t(),{themeName:E,setTheme:P}=r(),L=s();a.useState(null);const[I,B]=a.useState(!1),[q,M]=a.useState([]),[A,$]=a.useState(!1),[z,D]=a.useState(!0),[G,O]=a.useState({}),[R,V]=a.useState({}),[W,Y]=a.useState({}),[F,H]=a.useState({completed:0,total:0});a.useEffect(()=>{let e=!0,t=0;B(!0);const r=async()=>{try{await Promise.all([J(),N?Promise.all([Q(),U()]):Promise.resolve()])}catch(s){if(console.error("Error loading IELTS portal data:",s),e&&t<2&&(t++,console.log(`ðŸ”„ Retrying IELTS portal data fetch (attempt ${t}/2)...`),await new Promise(e=>setTimeout(e,1e3*Math.pow(2,t))),e))return r();e&&D(!1)}};return r(),()=>{e=!1}},[N]),a.useEffect(()=>{N&&X()},[N,q]),a.useEffect(()=>{K()},[N]);const J=async()=>{D(!0);try{const[e,t,r]=await Promise.all([v.from("tests").select("*").ilike("test_type","IELTS").order("created_at",{ascending:!0}),v.from("questions").select("test_id, part_number, id, audio_url, choices"),v.from("speaking_prompts").select("test_id, id")]);if(e.error)throw console.error("Error fetching tests:",e.error),e.error;if(t.error)throw console.error("Error fetching questions:",t.error),t.error;if(r.error)throw console.error("Error fetching speaking prompts:",r.error),r.error;const s=e.data,a=t.data,o=r.data,n=new Map;null==s||s.forEach(e=>{n.has(e.id)||n.set(e.id,new Set);const t=(e.module||"").toLowerCase();t&&["reading","listening","writing","speaking"].includes(t)&&n.get(e.id).add(t);const r=(e.skill_category||"").toLowerCase();r&&["reading","listening","writing","speaking"].includes(r)&&n.get(e.id).add(r);const s=(e.test_name||"").toLowerCase();s.includes("reading")&&n.get(e.id).add("reading"),s.includes("listening")&&n.get(e.id).add("listening"),s.includes("writing")&&n.get(e.id).add("writing"),s.includes("speaking")&&n.get(e.id).add("speaking")}),null==a||a.forEach(e=>{e.test_id&&(n.has(e.test_id)||n.set(e.test_id,new Set),e.audio_url&&n.get(e.test_id).add("listening"),e.choices&&n.get(e.test_id).add("reading"))}),null==o||o.forEach(e=>{e.test_id&&(n.has(e.test_id)||n.set(e.test_id,new Set),n.get(e.test_id).add("speaking"))});const i=(null==s?void 0:s.map((e,t)=>{const r=n.get(e.id)||new Set,s=(null==a?void 0:a.filter(t=>t.test_id===e.id).length)||0,i=(null==o?void 0:o.filter(t=>t.test_id===e.id).length)||0,l=s+i;return{id:e.id,test_name:e.test_name,test_number:t+1,status:l>0?"complete":"incomplete",modules:Array.from(r),total_questions:s,speaking_prompts:i,comingSoon:0===l}}))||[];M(i)}catch(e){console.error("Error loading tests:",e),M([])}finally{D(!1)}},K=async()=>{try{const{data:e}=await v.from("skill_tests").select("id").eq("skill_slug","vocabulary-builder"),t=(null==e?void 0:e.length)||0;let r=0;if(N&&t>0){const t=(e||[]).map(e=>e.id),{data:s}=await v.from("user_test_progress").select("test_id,status,completed_score").eq("user_id",N.id),a=new Set(t);r=(s||[]).filter(e=>a.has(e.test_id)&&"completed"===e.status).length}H({completed:Math.min(r,t),total:t})}catch(e){console.error("Error loading vocabulary progress",e),H({completed:0,total:0})}},Q=async()=>{if(N)try{const e=["reading","listening","writing","speaking"],t=e.map(e=>v.from("test_results").select("score_percentage, created_at, test_type").eq("user_id",N.id).ilike("test_type",`%${e}%`).order("created_at",{ascending:!1}).limit(1).maybeSingle()),r=await Promise.all(t),s={};r.forEach(({data:t,error:r},a)=>{const o=e[a];if(!r&&null!=(null==t?void 0:t.score_percentage)){const e=(n=t.score_percentage)>=95?9:n>=90?8.5:n>=85?8:n>=80?7.5:n>=75?7:n>=70?6.5:n>=65?6:n>=60?5.5:n>=55?5:n>=50?4.5:n>=45?4:n>=40?3.5:n>=35?3:n>=30?2.5:n>=25?2:n>=20?1.5:n>=15?1:n>=10?.5:0;s[o]=`Band ${e}`}var n}),O(s)}catch(e){console.error("Error loading skill bands:",e)}},U=async()=>{if(N)try{const e={},t=S.map(e=>Promise.all([v.from("user_skill_progress").select("max_unlocked_level").eq("user_id",N.id).eq("skill_slug",e.slug).maybeSingle(),v.from("skill_tests").select("id",{count:"exact",head:!0}).eq("skill_slug",e.slug)]));(await Promise.all(t)).forEach(([t,r],s)=>{var a;const o=S[s],n=(null==(a=t.data)?void 0:a.max_unlocked_level)||0,i=r.count||10;e[o.slug]={completed:n,total:i}}),V(e)}catch(e){console.error("Error loading skill progress:",e)}},X=async()=>{if(N)try{const e={},t={reading:0,listening:0,writing:0,speaking:0};for(const g of q){const e=g.modules||[];e.includes("reading")&&(t.reading+=1),e.includes("listening")&&(t.listening+=1),e.includes("writing")&&(t.writing+=1),e.includes("speaking")&&(t.speaking+=1)}const[r,s,a,o]=await Promise.all([v.from("writing_test_results").select("test_result_id, user_id").eq("user_id",N.id),v.from("reading_test_results").select("test_result_id, user_id").eq("user_id",N.id),v.from("listening_test_results").select("test_result_id, user_id").eq("user_id",N.id),v.from("speaking_test_results").select("test_result_id, user_id").eq("user_id",N.id)]),n=e=>{const t=new Set;return null==e||e.forEach(e=>{e.test_result_id&&t.add(e.test_result_id)}),t.size},i=n(r.data),l=n(s.data),c=n(a.data),d=n(o.data),m=(e,t)=>{const r=Math.max(0,t);return{completed:Math.min(e,r),total:r}};e.writing=m(i,t.writing||0),e.reading=m(l,t.reading||0),e.listening=m(c,t.listening||0),e.speaking=m(d,t.speaking||0),Y(e)}catch(e){console.error("Error loading IELTS skill progress:",e)}},Z=e=>{"collocation-connect"!==e?"sentence-mastery"===e?T("/skills/sentence-mastery"):"writing"===e?$(!0):T("speaking"===e?"/ielts-speaking-test":"reading"===e?"/reading":"listening"===e?"/listening":`/skills/${e}`):T("/ai-speaking")},ee=e=>{$(!1),T(`/ielts-writing-test?training=${e}`)};return z?o.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:"dark"===L.theme.name?L.theme.colors.background:"transparent"},children:o.jsx(n,{})}):o.jsxs("div",{className:"min-h-screen relative",style:{backgroundColor:"dark"===L.theme.name?L.theme.colors.background:"transparent"},children:[o.jsx(i,{title:"IELTS Preparation Portal",description:"Complete IELTS preparation with AI-powered feedback. Practice reading, listening, writing, and speaking with personalized guidance and real exam simulations.",keywords:"IELTS preparation, IELTS practice tests, IELTS writing feedback, IELTS speaking practice, IELTS reading, IELTS listening, IELTS band score",type:"website",schemaType:"course",courseType:"IELTS",courseLevel:"Intermediate to Advanced"}),o.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"note"===L.theme.name||"minimalist"===L.theme.name||"dark"===L.theme.name?"none":"url('/1000031207.png')",backgroundColor:L.backgroundImageColor}}),o.jsxs("div",{className:"relative z-10",children:[o.jsx(l,{title:"Dashboard",showBackButton:!0,children:o.jsxs("div",{className:"space-y-3 md:space-y-4 max-w-6xl mx-auto px-3 md:px-4",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[o.jsx("button",{onClick:()=>T("/hero"),className:"inline-flex items-center gap-2 px-2 py-1 h-8 text-sm font-medium transition-colors rounded-md",style:{color:L.textSecondary,backgroundColor:"transparent"},onMouseEnter:e=>{e.currentTarget.style.color=L.buttonPrimary,e.currentTarget.style.backgroundColor=L.hoverBg},onMouseLeave:e=>{e.currentTarget.style.color=L.textSecondary,e.currentTarget.style.backgroundColor="transparent"},children:o.jsx(c,{className:"h-4 w-4"})}),o.jsx("button",{onClick:()=>T("/dashboard"),className:"inline-flex items-center gap-2 px-2 py-1 h-8 text-sm font-medium transition-colors rounded-md",style:{color:L.textSecondary,backgroundColor:"transparent"},onMouseEnter:e=>{e.currentTarget.style.color=L.buttonPrimary,e.currentTarget.style.backgroundColor=L.hoverBg},onMouseLeave:e=>{e.currentTarget.style.color=L.textSecondary,e.currentTarget.style.backgroundColor="transparent"},children:"Dashboard"}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(d,{className:"h-4 w-4",style:{color:L.textSecondary}}),o.jsxs(m,{value:E,onValueChange:e=>P(e),children:[o.jsx(g,{className:"w-[140px] h-8 text-sm border transition-colors",style:{backgroundColor:"glassmorphism"===L.theme.name?"rgba(255,255,255,0.8)":"dark"===L.theme.name?"rgba(255,255,255,0.1)":"minimalist"===L.theme.name?"#ffffff":L.theme.colors.cardBackground,borderColor:L.border,color:L.textPrimary},children:o.jsx(u,{placeholder:"Theme"})}),o.jsx(h,{children:Object.values(p).map(e=>o.jsx(x,{value:e.name,children:e.label},e.name))})]})]})]}),o.jsx("div",{className:"mb-8",children:o.jsx("h1",{className:"text-3xl md:text-4xl lg:text-5xl font-black text-center tracking-tight font-nunito",style:{color:L.textPrimary},children:"IELTS Portal"})}),o.jsxs("div",{className:"mb-8",children:[o.jsx("h2",{className:"text-xl md:text-2xl font-bold mb-6 text-center font-nunito tracking-tight",style:{color:L.textPrimary},children:"Study each part"}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6",children:C.map((e,t)=>{W[e.id];const r=["/reading.png","/listening.png","/writing.png","/speaking.png"][t];return o.jsx(f,{className:"cursor-pointer min-h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg",onClick:()=>Z(e.id),style:{backgroundColor:"glassmorphism"===L.theme.name?"rgba(255,255,255,0.8)":"dark"===L.theme.name?"rgba(255,255,255,0.1)":"minimalist"===L.theme.name?"#ffffff":L.theme.colors.cardBackground,borderColor:L.border,...L.cardStyle},children:o.jsxs(y,{className:"p-3 md:p-4 text-center flex-1 flex flex-col justify-center",children:[o.jsx("div",{className:"w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:o.jsx("img",{src:r,alt:`${e.title} icon`,className:"w-12 h-12 object-cover"})}),o.jsx("h3",{className:"font-semibold text-xs md:text-sm",style:{color:L.textPrimary},children:e.title})]})},e.id)})})]}),o.jsxs("div",{className:"mb-8",children:[o.jsx("h2",{className:"text-xl md:text-2xl font-bold mb-6 text-center font-nunito tracking-tight",style:{color:L.textPrimary},children:"Sharpening Your Skills"}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6",children:[o.jsx(f,{className:"cursor-pointer min-h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg",onClick:()=>T("/vocabulary"),style:{backgroundColor:"glassmorphism"===L.theme.name?"rgba(255,255,255,0.8)":"dark"===L.theme.name?"rgba(255,255,255,0.1)":"minimalist"===L.theme.name?"#ffffff":L.theme.colors.cardBackground,borderColor:L.border,...L.cardStyle},children:o.jsx(y,{className:"p-3 md:p-4 text-center flex-1 flex flex-col justify-center",children:o.jsx("h3",{className:"font-semibold text-xs md:text-sm",style:{color:L.textPrimary},children:"Vocabulary Book"})})}),S.map(e=>(R[e.slug],o.jsx(f,{className:"cursor-pointer min-h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg",onClick:()=>Z(e.slug),style:{backgroundColor:"glassmorphism"===L.theme.name?"rgba(255,255,255,0.8)":"dark"===L.theme.name?"rgba(255,255,255,0.1)":"minimalist"===L.theme.name?"#ffffff":L.theme.colors.cardBackground,borderColor:L.border,...L.cardStyle},children:o.jsx(y,{className:"p-3 md:p-4 text-center flex-1 flex flex-col justify-center",children:o.jsx("h3",{className:"font-semibold text-xs md:text-sm",style:{color:L.textPrimary},children:e.label})})},e.slug)))]})]})]})}),o.jsx(k,{open:A,onOpenChange:$,children:o.jsxs(b,{className:"sm:max-w-md border-2 shadow-xl",style:{backgroundColor:"glassmorphism"===L.theme.name?"rgba(255,255,255,0.9)":"dark"===L.theme.name?"#1e293b":L.theme.colors.cardBackground,borderColor:L.border,...L.cardStyle},children:[o.jsx(_,{className:"text-center",children:o.jsx(w,{className:"text-center text-xl font-bold",style:{color:L.textPrimary},children:"Choose IELTS Writing Type"})}),o.jsxs("div",{className:"flex flex-col gap-3 mt-2",children:[o.jsx(j,{onClick:()=>ee("Academic"),className:"w-full h-12 text-base font-medium",variant:"outline",style:{borderColor:L.border,color:L.textPrimary,backgroundColor:L.theme.colors.cardBackground},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=L.hoverBg,e.currentTarget.style.color=L.buttonPrimary},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=L.theme.colors.cardBackground,e.currentTarget.style.color=L.textPrimary},children:"Academic Training"}),o.jsx(j,{onClick:()=>ee("General"),className:"w-full h-12 text-base font-medium",variant:"outline",style:{borderColor:L.border,color:L.textPrimary,backgroundColor:L.theme.colors.cardBackground},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=L.hoverBg,e.currentTarget.style.color=L.buttonPrimary},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=L.theme.colors.cardBackground,e.currentTarget.style.color=L.textPrimary},children:"General Training"})]})]})})]})]})};export{T as default};
