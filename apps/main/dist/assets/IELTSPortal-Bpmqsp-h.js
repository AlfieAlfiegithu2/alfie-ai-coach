import{u as e,r as t,j as r}from"./vendor-react-rLLBBC7n.js";import{E as s,w as a,q as o,s as l,x as n,U as i,y as c,S as d,i as m,j as g,k as u,z as h,l as x,A as p,a as f,D as y,f as b,g as k,h as j,B as _}from"./index-BDl0jLJK.js";import{S as v}from"./skills-NqzSOyzV.js";import{aG as w,ah as N,aR as S,aS as C,ao as T}from"./vendor-ui-BGi_EvHx.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-charts-0DeywwxG.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";const E=[{id:"reading",title:"Reading",description:"Academic & General texts"},{id:"listening",title:"Listening",description:"Audio comprehension"},{id:"writing",title:"Writing",description:"Task 1 & Task 2"},{id:"speaking",title:"Speaking",description:"Interview & presentation"}],P=()=>{const P=e(),{user:L}=s(),{themeName:B,setTheme:I}=a(),q=o(),M="note"===q.theme.name;t.useState(null);const[A,$]=t.useState(!1),[G,z]=t.useState([]),[D,R]=t.useState(!1),[O,V]=t.useState(!0),[W,H]=t.useState({}),[U,Y]=t.useState({}),[F,J]=t.useState({}),[K,Q]=t.useState({completed:0,total:0});t.useEffect(()=>{let e=!0,t=0;$(!0);const r=async()=>{try{await Promise.all([X(),L?Promise.all([ee(),te()]):Promise.resolve()])}catch(s){if(console.error("Error loading IELTS portal data:",s),e&&t<2&&(t++,console.log(`ðŸ”„ Retrying IELTS portal data fetch (attempt ${t}/2)...`),await new Promise(e=>setTimeout(e,1e3*Math.pow(2,t))),e))return r();e&&V(!1)}};return r(),()=>{e=!1}},[L]),t.useEffect(()=>{L&&re()},[L,G]),t.useEffect(()=>{Z()},[L]);const X=async()=>{V(!0);try{const[e,t,r]=await Promise.all([l.from("tests").select("*").ilike("test_type","IELTS").order("created_at",{ascending:!0}),l.from("questions").select("test_id, part_number, id, audio_url, choices"),l.from("speaking_prompts").select("test_id, id")]);if(e.error)throw console.error("Error fetching tests:",e.error),e.error;if(t.error)throw console.error("Error fetching questions:",t.error),t.error;if(r.error)throw console.error("Error fetching speaking prompts:",r.error),r.error;const s=e.data,a=t.data,o=r.data,n=new Map;null==s||s.forEach(e=>{n.has(e.id)||n.set(e.id,new Set);const t=(e.module||"").toLowerCase();t&&["reading","listening","writing","speaking"].includes(t)&&n.get(e.id).add(t);const r=(e.skill_category||"").toLowerCase();r&&["reading","listening","writing","speaking"].includes(r)&&n.get(e.id).add(r);const s=(e.test_name||"").toLowerCase();s.includes("reading")&&n.get(e.id).add("reading"),s.includes("listening")&&n.get(e.id).add("listening"),s.includes("writing")&&n.get(e.id).add("writing"),s.includes("speaking")&&n.get(e.id).add("speaking")}),null==a||a.forEach(e=>{e.test_id&&(n.has(e.test_id)||n.set(e.test_id,new Set),e.audio_url&&n.get(e.test_id).add("listening"),e.choices&&n.get(e.test_id).add("reading"))}),null==o||o.forEach(e=>{e.test_id&&(n.has(e.test_id)||n.set(e.test_id,new Set),n.get(e.test_id).add("speaking"))});const i=(null==s?void 0:s.map((e,t)=>{const r=n.get(e.id)||new Set,s=(null==a?void 0:a.filter(t=>t.test_id===e.id).length)||0,l=(null==o?void 0:o.filter(t=>t.test_id===e.id).length)||0,i=s+l;return{id:e.id,test_name:e.test_name,test_number:t+1,status:i>0?"complete":"incomplete",modules:Array.from(r),total_questions:s,speaking_prompts:l,comingSoon:0===i}}))||[];z(i)}catch(e){console.error("Error loading tests:",e),z([])}finally{V(!1)}},Z=async()=>{try{const{data:e}=await l.from("skill_tests").select("id").eq("skill_slug","vocabulary-builder"),t=(null==e?void 0:e.length)||0;let r=0;if(L&&t>0){const t=(e||[]).map(e=>e.id),{data:s}=await l.from("user_test_progress").select("test_id,status,completed_score").eq("user_id",L.id),a=new Set(t);r=(s||[]).filter(e=>a.has(e.test_id)&&"completed"===e.status).length}Q({completed:Math.min(r,t),total:t})}catch(e){console.error("Error loading vocabulary progress",e),Q({completed:0,total:0})}},ee=async()=>{if(L)try{const e=["reading","listening","writing","speaking"],t=e.map(e=>l.from("test_results").select("score_percentage, created_at, test_type").eq("user_id",L.id).ilike("test_type",`%${e}%`).order("created_at",{ascending:!1}).limit(1).maybeSingle()),r=await Promise.all(t),s={};r.forEach(({data:t,error:r},a)=>{const o=e[a];if(!r&&null!=(null==t?void 0:t.score_percentage)){const e=(l=t.score_percentage)>=95?9:l>=90?8.5:l>=85?8:l>=80?7.5:l>=75?7:l>=70?6.5:l>=65?6:l>=60?5.5:l>=55?5:l>=50?4.5:l>=45?4:l>=40?3.5:l>=35?3:l>=30?2.5:l>=25?2:l>=20?1.5:l>=15?1:l>=10?.5:0;s[o]=`Band ${e}`}var l}),H(s)}catch(e){console.error("Error loading skill bands:",e)}},te=async()=>{if(L)try{const e={},t=v.map(e=>Promise.all([l.from("user_skill_progress").select("max_unlocked_level").eq("user_id",L.id).eq("skill_slug",e.slug).maybeSingle(),l.from("skill_tests").select("id",{count:"exact",head:!0}).eq("skill_slug",e.slug)]));(await Promise.all(t)).forEach(([t,r],s)=>{var a;const o=v[s],l=(null==(a=t.data)?void 0:a.max_unlocked_level)||0,n=r.count||10;e[o.slug]={completed:l,total:n}}),Y(e)}catch(e){console.error("Error loading skill progress:",e)}},re=async()=>{if(L)try{const e={},t={reading:0,listening:0,writing:0,speaking:0};for(const l of G){const e=l.modules||[];e.includes("reading")&&(t.reading+=1),e.includes("listening")&&(t.listening+=1),e.includes("writing")&&(t.writing+=1),e.includes("speaking")&&(t.speaking+=1)}const[r,s,a,o]=await Promise.all([l.from("writing_test_results").select("test_result_id, user_id").eq("user_id",L.id),l.from("reading_test_results").select("test_result_id, user_id").eq("user_id",L.id),l.from("listening_test_results").select("test_result_id, user_id").eq("user_id",L.id),l.from("speaking_test_results").select("test_result_id, user_id").eq("user_id",L.id)]),n=e=>{const t=new Set;return null==e||e.forEach(e=>{e.test_result_id&&t.add(e.test_result_id)}),t.size},i=n(r.data),c=n(s.data),d=n(a.data),m=n(o.data),g=(e,t)=>{const r=Math.max(0,t);return{completed:Math.min(e,r),total:r}};e.writing=g(i,t.writing||0),e.reading=g(c,t.reading||0),e.listening=g(d,t.listening||0),e.speaking=g(m,t.speaking||0),J(e)}catch(e){console.error("Error loading IELTS skill progress:",e)}},se=e=>{"collocation-connect"!==e?"sentence-mastery"===e?P("/skills/sentence-mastery"):"writing"===e?R(!0):P("speaking"===e?"/ielts-speaking-test":"reading"===e?"/reading":"listening"===e?"/listening":`/skills/${e}`):P("/ai-speaking")},ae=e=>{R(!1),P(`/ielts-writing-test?training=${e}`)};return O?r.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:"dark"===q.theme.name?q.theme.colors.background:"transparent"},children:r.jsx(n,{})}):r.jsxs("div",{className:"min-h-screen relative "+(M?"font-serif":""),style:{backgroundColor:"dark"===q.theme.name?q.theme.colors.background:"transparent"},children:[r.jsx(i,{title:"IELTS Preparation Portal",description:"Complete IELTS preparation with AI-powered feedback. Practice reading, listening, writing, and speaking with personalized guidance and real exam simulations.",keywords:"IELTS preparation, IELTS practice tests, IELTS writing feedback, IELTS speaking practice, IELTS reading, IELTS listening, IELTS band score",type:"website",schemaType:"course",courseType:"IELTS",courseLevel:"Intermediate to Advanced"}),r.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:M||"minimalist"===q.theme.name||"dark"===q.theme.name?"none":"url('/1000031207.png')",backgroundColor:q.backgroundImageColor}}),r.jsxs("div",{className:"relative z-10",children:[r.jsx(c,{title:"Dashboard",showBackButton:!0,children:r.jsxs("div",{className:"space-y-3 md:space-y-4 max-w-6xl mx-auto px-3 md:px-4",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[r.jsxs("button",{onClick:()=>P("/hero"),className:"inline-flex items-center gap-2 px-2 py-1 h-8 text-sm font-medium transition-colors rounded-md",style:{color:q.textSecondary,backgroundColor:"transparent"},onMouseEnter:e=>{e.currentTarget.style.color=q.buttonPrimary,e.currentTarget.style.backgroundColor=q.hoverBg},onMouseLeave:e=>{e.currentTarget.style.color=q.textSecondary,e.currentTarget.style.backgroundColor="transparent"},children:[!M&&r.jsx(w,{className:"h-4 w-4"}),M&&r.jsx("span",{children:"Home"})]}),r.jsx("button",{onClick:()=>P("/dashboard"),className:"inline-flex items-center gap-2 px-2 py-1 h-8 text-sm font-medium transition-colors rounded-md",style:{color:q.textSecondary,backgroundColor:"transparent"},onMouseEnter:e=>{e.currentTarget.style.color=q.buttonPrimary,e.currentTarget.style.backgroundColor=q.hoverBg},onMouseLeave:e=>{e.currentTarget.style.color=q.textSecondary,e.currentTarget.style.backgroundColor="transparent"},children:"Dashboard"}),r.jsxs("div",{className:"flex items-center gap-2",children:[!M&&r.jsx(N,{className:"h-4 w-4",style:{color:q.textSecondary}}),r.jsxs(d,{value:B,onValueChange:e=>I(e),children:[r.jsx(m,{className:"w-[140px] h-8 text-sm border transition-colors",style:{backgroundColor:"glassmorphism"===q.theme.name?"rgba(255,255,255,0.8)":"dark"===q.theme.name?"rgba(255,255,255,0.1)":"minimalist"===q.theme.name?"#ffffff":q.theme.colors.cardBackground,borderColor:q.border,color:q.textPrimary},children:r.jsx(g,{placeholder:"Theme"})}),r.jsx(u,{children:Object.values(h).map(e=>r.jsx(x,{value:e.name,children:e.label},e.name))})]})]})]}),r.jsx("div",{className:"mb-8",children:r.jsx("h1",{className:"text-3xl md:text-4xl lg:text-5xl font-black text-center tracking-tight font-nunito",style:{color:q.textPrimary},children:"IELTS Portal"})}),r.jsxs("div",{className:"mb-8",children:[r.jsx("h2",{className:"text-xl md:text-2xl font-bold mb-6 text-center font-nunito tracking-tight",style:{color:q.textPrimary},children:"Study each part"}),r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6",children:E.map((e,t)=>{F[e.id];const s=["/reading.png","/listening.png","/writing.png","/speaking.png"][t];return r.jsx(p,{className:"cursor-pointer min-h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg",onClick:()=>se(e.id),style:{backgroundColor:"glassmorphism"===q.theme.name?"rgba(255,255,255,0.8)":"dark"===q.theme.name?"rgba(255,255,255,0.1)":"minimalist"===q.theme.name?"#ffffff":q.theme.colors.cardBackground,borderColor:q.border,...q.cardStyle},children:r.jsxs(f,{className:"p-3 md:p-4 text-center flex-1 flex flex-col justify-center",children:[!M&&r.jsx("div",{className:"w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:r.jsx("img",{src:s,alt:`${e.title} icon`,className:"w-12 h-12 object-cover"})}),r.jsx("h3",{className:"font-semibold "+(M?"text-lg":"text-xs md:text-sm"),style:{color:q.textPrimary},children:e.title})]})},e.id)})})]}),r.jsxs("div",{className:"mb-8",children:[r.jsx("h2",{className:"text-xl md:text-2xl font-bold mb-6 text-center font-nunito tracking-tight",style:{color:q.textPrimary},children:"Sharpening Your Skills"}),r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6",children:[r.jsx(p,{className:"cursor-pointer min-h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg",onClick:()=>P("/vocabulary"),style:{backgroundColor:"glassmorphism"===q.theme.name?"rgba(255,255,255,0.8)":"dark"===q.theme.name?"rgba(255,255,255,0.1)":"minimalist"===q.theme.name?"#ffffff":q.theme.colors.cardBackground,borderColor:q.border,...q.cardStyle},children:r.jsx(f,{className:"p-3 md:p-4 text-center flex-1 flex flex-col justify-center",children:r.jsx("h3",{className:"font-semibold "+(M?"text-lg":"text-xs md:text-sm"),style:{color:q.textPrimary},children:"Vocabulary Book"})})}),r.jsx(p,{className:"cursor-pointer min-h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg",onClick:()=>P("/books"),style:{backgroundColor:"glassmorphism"===q.theme.name?"rgba(255,255,255,0.8)":"dark"===q.theme.name?"rgba(255,255,255,0.1)":"minimalist"===q.theme.name?"#ffffff":q.theme.colors.cardBackground,borderColor:q.border,...q.cardStyle},children:r.jsxs(f,{className:"p-3 md:p-4 text-center flex-1 flex flex-col justify-center",children:[!M&&r.jsx(S,{className:"w-8 h-8 mx-auto mb-2",style:{color:q.textPrimary}}),r.jsx("h3",{className:"font-semibold "+(M?"text-lg":"text-xs md:text-sm"),style:{color:q.textPrimary},children:"Books"}),!M&&r.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Educational reading"})]})}),r.jsx(p,{className:"cursor-pointer min-h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg",onClick:()=>P("/templates"),style:{backgroundColor:"glassmorphism"===q.theme.name?"rgba(255,255,255,0.8)":"dark"===q.theme.name?"rgba(255,255,255,0.1)":"minimalist"===q.theme.name?"#ffffff":q.theme.colors.cardBackground,borderColor:q.border,...q.cardStyle},children:r.jsxs(f,{className:"p-3 md:p-4 text-center flex-1 flex flex-col justify-center",children:[!M&&r.jsx(C,{className:"w-8 h-8 mx-auto mb-2",style:{color:q.textPrimary}}),r.jsx("h3",{className:"font-semibold "+(M?"text-lg":"text-xs md:text-sm"),style:{color:q.textPrimary},children:"Templates"}),!M&&r.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Charts & diagrams"})]})}),r.jsx(p,{className:"cursor-pointer min-h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg",onClick:()=>P("/grammar"),style:{backgroundColor:"glassmorphism"===q.theme.name?"rgba(255,255,255,0.8)":"dark"===q.theme.name?"rgba(255,255,255,0.1)":"minimalist"===q.theme.name?"#ffffff":q.theme.colors.cardBackground,borderColor:q.border,...q.cardStyle},children:r.jsxs(f,{className:"p-3 md:p-4 text-center flex-1 flex flex-col justify-center",children:[!M&&r.jsx(T,{className:"w-8 h-8 mx-auto mb-2",style:{color:q.textPrimary}}),r.jsx("h3",{className:"font-semibold "+(M?"text-lg":"text-xs md:text-sm"),style:{color:q.textPrimary},children:"Grammar"}),!M&&r.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Interactive lessons"})]})}),v.map(e=>(U[e.slug],r.jsx(p,{className:"cursor-pointer min-h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg",onClick:()=>se(e.slug),style:{backgroundColor:"glassmorphism"===q.theme.name?"rgba(255,255,255,0.8)":"dark"===q.theme.name?"rgba(255,255,255,0.1)":"minimalist"===q.theme.name?"#ffffff":q.theme.colors.cardBackground,borderColor:q.border,...q.cardStyle},children:r.jsx(f,{className:"p-3 md:p-4 text-center flex-1 flex flex-col justify-center",children:r.jsx("h3",{className:"font-semibold "+(M?"text-lg":"text-xs md:text-sm"),style:{color:q.textPrimary},children:e.label})})},e.slug)))]})]})]})}),r.jsx(y,{open:D,onOpenChange:R,children:r.jsxs(b,{className:"sm:max-w-md border-2 shadow-xl",style:{backgroundColor:"glassmorphism"===q.theme.name?"rgba(255,255,255,0.9)":"dark"===q.theme.name?"#1e293b":q.theme.colors.cardBackground,borderColor:q.border,...q.cardStyle},children:[r.jsx(k,{className:"text-center",children:r.jsx(j,{className:"text-center text-xl font-bold",style:{color:q.textPrimary},children:"Choose IELTS Writing Type"})}),r.jsxs("div",{className:"flex flex-col gap-3 mt-2",children:[r.jsx(_,{onClick:()=>ae("Academic"),className:"w-full h-12 text-base font-medium",variant:"outline",style:{borderColor:q.border,color:q.textPrimary,backgroundColor:q.theme.colors.cardBackground},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=q.hoverBg,e.currentTarget.style.color=q.buttonPrimary},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=q.theme.colors.cardBackground,e.currentTarget.style.color=q.textPrimary},children:"Academic Training"}),r.jsx(_,{onClick:()=>ae("General"),className:"w-full h-12 text-base font-medium",variant:"outline",style:{borderColor:q.border,color:q.textPrimary,backgroundColor:q.theme.colors.cardBackground},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=q.hoverBg,e.currentTarget.style.color=q.buttonPrimary},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=q.theme.colors.cardBackground,e.currentTarget.style.color=q.textPrimary},children:"General Training"})]})]})})]})]})};export{P as default};
