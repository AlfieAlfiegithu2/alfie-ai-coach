import{u as e,ae as t,a8 as r,a1 as s,r as a,j as o,a9 as l,bn as n,aa as i,a7 as c,ab as d,S as m,p as g,q as u,s as h,ac as x,t as p,ad as f,a as y,e as b,D as k,m as _,n as j,o as w,B as v}from"./index-DsPg4zpT.js";import{s as N}from"./supabase-DWL4C3fA.js";import{S as C}from"./skills-NqzSOyzV.js";import{L as S}from"./library-EwvjBxDG.js";import{I as T}from"./image-_A13RlCT.js";const E=[{id:"reading",title:"Reading",description:"Academic & General texts"},{id:"listening",title:"Listening",description:"Audio comprehension"},{id:"writing",title:"Writing",description:"Task 1 & Task 2"},{id:"speaking",title:"Speaking",description:"Interview & presentation"}],P=()=>{const P=e(),{user:L}=t(),{themeName:I,setTheme:B}=r(),q=s(),M="note"===q.theme.name;a.useState(null);const[A,$]=a.useState(!1),[G,z]=a.useState([]),[D,O]=a.useState(!1),[R,V]=a.useState(!0),[W,H]=a.useState({}),[Y,F]=a.useState({}),[J,K]=a.useState({}),[Q,U]=a.useState({completed:0,total:0});a.useEffect(()=>{let e=!0,t=0;$(!0);const r=async()=>{try{await Promise.all([X(),L?Promise.all([ee(),te()]):Promise.resolve()])}catch(s){if(console.error("Error loading IELTS portal data:",s),e&&t<2&&(t++,console.log(`ðŸ”„ Retrying IELTS portal data fetch (attempt ${t}/2)...`),await new Promise(e=>setTimeout(e,1e3*Math.pow(2,t))),e))return r();e&&V(!1)}};return r(),()=>{e=!1}},[L]),a.useEffect(()=>{L&&re()},[L,G]),a.useEffect(()=>{Z()},[L]);const X=async()=>{V(!0);try{const[e,t,r]=await Promise.all([N.from("tests").select("*").ilike("test_type","IELTS").order("created_at",{ascending:!0}),N.from("questions").select("test_id, part_number, id, audio_url, choices"),N.from("speaking_prompts").select("test_id, id")]);if(e.error)throw console.error("Error fetching tests:",e.error),e.error;if(t.error)throw console.error("Error fetching questions:",t.error),t.error;if(r.error)throw console.error("Error fetching speaking prompts:",r.error),r.error;const s=e.data,a=t.data,o=r.data,l=new Map;null==s||s.forEach(e=>{l.has(e.id)||l.set(e.id,new Set);const t=(e.module||"").toLowerCase();t&&["reading","listening","writing","speaking"].includes(t)&&l.get(e.id).add(t);const r=(e.skill_category||"").toLowerCase();r&&["reading","listening","writing","speaking"].includes(r)&&l.get(e.id).add(r);const s=(e.test_name||"").toLowerCase();s.includes("reading")&&l.get(e.id).add("reading"),s.includes("listening")&&l.get(e.id).add("listening"),s.includes("writing")&&l.get(e.id).add("writing"),s.includes("speaking")&&l.get(e.id).add("speaking")}),null==a||a.forEach(e=>{e.test_id&&(l.has(e.test_id)||l.set(e.test_id,new Set),e.audio_url&&l.get(e.test_id).add("listening"),e.choices&&l.get(e.test_id).add("reading"))}),null==o||o.forEach(e=>{e.test_id&&(l.has(e.test_id)||l.set(e.test_id,new Set),l.get(e.test_id).add("speaking"))});const n=(null==s?void 0:s.map((e,t)=>{const r=l.get(e.id)||new Set,s=(null==a?void 0:a.filter(t=>t.test_id===e.id).length)||0,n=(null==o?void 0:o.filter(t=>t.test_id===e.id).length)||0,i=s+n;return{id:e.id,test_name:e.test_name,test_number:t+1,status:i>0?"complete":"incomplete",modules:Array.from(r),total_questions:s,speaking_prompts:n,comingSoon:0===i}}))||[];z(n)}catch(e){console.error("Error loading tests:",e),z([])}finally{V(!1)}},Z=async()=>{try{const{data:e}=await N.from("skill_tests").select("id").eq("skill_slug","vocabulary-builder"),t=(null==e?void 0:e.length)||0;let r=0;if(L&&t>0){const t=(e||[]).map(e=>e.id),{data:s}=await N.from("user_test_progress").select("test_id,status,completed_score").eq("user_id",L.id),a=new Set(t);r=(s||[]).filter(e=>a.has(e.test_id)&&"completed"===e.status).length}U({completed:Math.min(r,t),total:t})}catch(e){console.error("Error loading vocabulary progress",e),U({completed:0,total:0})}},ee=async()=>{if(L)try{const e=["reading","listening","writing","speaking"],t=e.map(e=>N.from("test_results").select("score_percentage, created_at, test_type").eq("user_id",L.id).ilike("test_type",`%${e}%`).order("created_at",{ascending:!1}).limit(1).maybeSingle()),r=await Promise.all(t),s={};r.forEach(({data:t,error:r},a)=>{const o=e[a];if(!r&&null!=(null==t?void 0:t.score_percentage)){const e=(l=t.score_percentage)>=95?9:l>=90?8.5:l>=85?8:l>=80?7.5:l>=75?7:l>=70?6.5:l>=65?6:l>=60?5.5:l>=55?5:l>=50?4.5:l>=45?4:l>=40?3.5:l>=35?3:l>=30?2.5:l>=25?2:l>=20?1.5:l>=15?1:l>=10?.5:0;s[o]=`Band ${e}`}var l}),H(s)}catch(e){console.error("Error loading skill bands:",e)}},te=async()=>{if(L)try{const e={},t=C.map(e=>Promise.all([N.from("user_skill_progress").select("max_unlocked_level").eq("user_id",L.id).eq("skill_slug",e.slug).maybeSingle(),N.from("skill_tests").select("id",{count:"exact",head:!0}).eq("skill_slug",e.slug)]));(await Promise.all(t)).forEach(([t,r],s)=>{var a;const o=C[s],l=(null==(a=t.data)?void 0:a.max_unlocked_level)||0,n=r.count||10;e[o.slug]={completed:l,total:n}}),F(e)}catch(e){console.error("Error loading skill progress:",e)}},re=async()=>{if(L)try{const e={},t={reading:0,listening:0,writing:0,speaking:0};for(const g of G){const e=g.modules||[];e.includes("reading")&&(t.reading+=1),e.includes("listening")&&(t.listening+=1),e.includes("writing")&&(t.writing+=1),e.includes("speaking")&&(t.speaking+=1)}const[r,s,a,o]=await Promise.all([N.from("writing_test_results").select("test_result_id, user_id").eq("user_id",L.id),N.from("reading_test_results").select("test_result_id, user_id").eq("user_id",L.id),N.from("listening_test_results").select("test_result_id, user_id").eq("user_id",L.id),N.from("speaking_test_results").select("test_result_id, user_id").eq("user_id",L.id)]),l=e=>{const t=new Set;return null==e||e.forEach(e=>{e.test_result_id&&t.add(e.test_result_id)}),t.size},n=l(r.data),i=l(s.data),c=l(a.data),d=l(o.data),m=(e,t)=>{const r=Math.max(0,t);return{completed:Math.min(e,r),total:r}};e.writing=m(n,t.writing||0),e.reading=m(i,t.reading||0),e.listening=m(c,t.listening||0),e.speaking=m(d,t.speaking||0),K(e)}catch(e){console.error("Error loading IELTS skill progress:",e)}},se=e=>{"collocation-connect"!==e?"sentence-mastery"===e?P("/skills/sentence-mastery"):"writing"===e?O(!0):P("speaking"===e?"/ielts-speaking-test":"reading"===e?"/reading":"listening"===e?"/listening":`/skills/${e}`):P("/ai-speaking")},ae=e=>{O(!1),P(`/ielts-writing-test?training=${e}`)};return R?o.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:"dark"===q.theme.name?q.theme.colors.background:"transparent"},children:o.jsx(l,{})}):o.jsxs("div",{className:"min-h-screen relative "+(M?"font-serif":""),style:{backgroundColor:"dark"===q.theme.name?q.theme.colors.background:"transparent"},children:[o.jsx(n,{title:"IELTS Preparation Portal",description:"Complete IELTS preparation with AI-powered feedback. Practice reading, listening, writing, and speaking with personalized guidance and real exam simulations.",keywords:"IELTS preparation, IELTS practice tests, IELTS writing feedback, IELTS speaking practice, IELTS reading, IELTS listening, IELTS band score",type:"website",schemaType:"course",courseType:"IELTS",courseLevel:"Intermediate to Advanced"}),o.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:M||"minimalist"===q.theme.name||"dark"===q.theme.name?"none":"url('/1000031207.png')",backgroundColor:q.backgroundImageColor}}),o.jsxs("div",{className:"relative z-10",children:[o.jsx(i,{title:"Dashboard",showBackButton:!0,children:o.jsxs("div",{className:"space-y-3 md:space-y-4 max-w-6xl mx-auto px-3 md:px-4",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[o.jsxs("button",{onClick:()=>P("/hero"),className:"inline-flex items-center gap-2 px-2 py-1 h-8 text-sm font-medium transition-colors rounded-md",style:{color:q.textSecondary,backgroundColor:"transparent"},onMouseEnter:e=>{e.currentTarget.style.color=q.buttonPrimary,e.currentTarget.style.backgroundColor=q.hoverBg},onMouseLeave:e=>{e.currentTarget.style.color=q.textSecondary,e.currentTarget.style.backgroundColor="transparent"},children:[!M&&o.jsx(c,{className:"h-4 w-4"}),M&&o.jsx("span",{children:"Home"})]}),o.jsx("button",{onClick:()=>P("/dashboard"),className:"inline-flex items-center gap-2 px-2 py-1 h-8 text-sm font-medium transition-colors rounded-md",style:{color:q.textSecondary,backgroundColor:"transparent"},onMouseEnter:e=>{e.currentTarget.style.color=q.buttonPrimary,e.currentTarget.style.backgroundColor=q.hoverBg},onMouseLeave:e=>{e.currentTarget.style.color=q.textSecondary,e.currentTarget.style.backgroundColor="transparent"},children:"Dashboard"}),o.jsxs("div",{className:"flex items-center gap-2",children:[!M&&o.jsx(d,{className:"h-4 w-4",style:{color:q.textSecondary}}),o.jsxs(m,{value:I,onValueChange:e=>B(e),children:[o.jsx(g,{className:"w-[140px] h-8 text-sm border transition-colors",style:{backgroundColor:"glassmorphism"===q.theme.name?"rgba(255,255,255,0.8)":"dark"===q.theme.name?"rgba(255,255,255,0.1)":"minimalist"===q.theme.name?"#ffffff":q.theme.colors.cardBackground,borderColor:q.border,color:q.textPrimary},children:o.jsx(u,{placeholder:"Theme"})}),o.jsx(h,{children:Object.values(x).map(e=>o.jsx(p,{value:e.name,children:e.label},e.name))})]})]})]}),o.jsx("div",{className:"mb-8",children:o.jsx("h1",{className:"text-3xl md:text-4xl lg:text-5xl font-black text-center tracking-tight font-nunito",style:{color:q.textPrimary},children:"IELTS Portal"})}),o.jsxs("div",{className:"mb-8",children:[o.jsx("h2",{className:"text-xl md:text-2xl font-bold mb-6 text-center font-nunito tracking-tight",style:{color:q.textPrimary},children:"Study each part"}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6",children:E.map((e,t)=>{J[e.id];const r=["/reading.png","/listening.png","/writing.png","/speaking.png"][t];return o.jsx(f,{className:"cursor-pointer min-h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg",onClick:()=>se(e.id),style:{backgroundColor:"glassmorphism"===q.theme.name?"rgba(255,255,255,0.8)":"dark"===q.theme.name?"rgba(255,255,255,0.1)":"minimalist"===q.theme.name?"#ffffff":q.theme.colors.cardBackground,borderColor:q.border,...q.cardStyle},children:o.jsxs(y,{className:"p-3 md:p-4 text-center flex-1 flex flex-col justify-center",children:[!M&&o.jsx("div",{className:"w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:o.jsx("img",{src:r,alt:`${e.title} icon`,className:"w-12 h-12 object-cover"})}),o.jsx("h3",{className:"font-semibold "+(M?"text-lg":"text-xs md:text-sm"),style:{color:q.textPrimary},children:e.title})]})},e.id)})})]}),o.jsxs("div",{className:"mb-8",children:[o.jsx("h2",{className:"text-xl md:text-2xl font-bold mb-6 text-center font-nunito tracking-tight",style:{color:q.textPrimary},children:"Sharpening Your Skills"}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6",children:[o.jsx(f,{className:"cursor-pointer min-h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg",onClick:()=>P("/vocabulary"),style:{backgroundColor:"glassmorphism"===q.theme.name?"rgba(255,255,255,0.8)":"dark"===q.theme.name?"rgba(255,255,255,0.1)":"minimalist"===q.theme.name?"#ffffff":q.theme.colors.cardBackground,borderColor:q.border,...q.cardStyle},children:o.jsx(y,{className:"p-3 md:p-4 text-center flex-1 flex flex-col justify-center",children:o.jsx("h3",{className:"font-semibold "+(M?"text-lg":"text-xs md:text-sm"),style:{color:q.textPrimary},children:"Vocabulary Book"})})}),o.jsx(f,{className:"cursor-pointer min-h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg",onClick:()=>P("/books"),style:{backgroundColor:"glassmorphism"===q.theme.name?"rgba(255,255,255,0.8)":"dark"===q.theme.name?"rgba(255,255,255,0.1)":"minimalist"===q.theme.name?"#ffffff":q.theme.colors.cardBackground,borderColor:q.border,...q.cardStyle},children:o.jsxs(y,{className:"p-3 md:p-4 text-center flex-1 flex flex-col justify-center",children:[!M&&o.jsx(S,{className:"w-8 h-8 mx-auto mb-2",style:{color:q.textPrimary}}),o.jsx("h3",{className:"font-semibold "+(M?"text-lg":"text-xs md:text-sm"),style:{color:q.textPrimary},children:"Books"}),!M&&o.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Educational reading"})]})}),o.jsx(f,{className:"cursor-pointer min-h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg",onClick:()=>P("/templates"),style:{backgroundColor:"glassmorphism"===q.theme.name?"rgba(255,255,255,0.8)":"dark"===q.theme.name?"rgba(255,255,255,0.1)":"minimalist"===q.theme.name?"#ffffff":q.theme.colors.cardBackground,borderColor:q.border,...q.cardStyle},children:o.jsxs(y,{className:"p-3 md:p-4 text-center flex-1 flex flex-col justify-center",children:[!M&&o.jsx(T,{className:"w-8 h-8 mx-auto mb-2",style:{color:q.textPrimary}}),o.jsx("h3",{className:"font-semibold "+(M?"text-lg":"text-xs md:text-sm"),style:{color:q.textPrimary},children:"Templates"}),!M&&o.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Charts & diagrams"})]})}),o.jsx(f,{className:"cursor-pointer min-h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg",onClick:()=>P("/grammar"),style:{backgroundColor:"glassmorphism"===q.theme.name?"rgba(255,255,255,0.8)":"dark"===q.theme.name?"rgba(255,255,255,0.1)":"minimalist"===q.theme.name?"#ffffff":q.theme.colors.cardBackground,borderColor:q.border,...q.cardStyle},children:o.jsxs(y,{className:"p-3 md:p-4 text-center flex-1 flex flex-col justify-center",children:[!M&&o.jsx(b,{className:"w-8 h-8 mx-auto mb-2",style:{color:q.textPrimary}}),o.jsx("h3",{className:"font-semibold "+(M?"text-lg":"text-xs md:text-sm"),style:{color:q.textPrimary},children:"Grammar"}),!M&&o.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Interactive lessons"})]})}),C.map(e=>(Y[e.slug],o.jsx(f,{className:"cursor-pointer min-h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg",onClick:()=>se(e.slug),style:{backgroundColor:"glassmorphism"===q.theme.name?"rgba(255,255,255,0.8)":"dark"===q.theme.name?"rgba(255,255,255,0.1)":"minimalist"===q.theme.name?"#ffffff":q.theme.colors.cardBackground,borderColor:q.border,...q.cardStyle},children:o.jsx(y,{className:"p-3 md:p-4 text-center flex-1 flex flex-col justify-center",children:o.jsx("h3",{className:"font-semibold "+(M?"text-lg":"text-xs md:text-sm"),style:{color:q.textPrimary},children:e.label})})},e.slug)))]})]})]})}),o.jsx(k,{open:D,onOpenChange:O,children:o.jsxs(_,{className:"sm:max-w-md border-2 shadow-xl",style:{backgroundColor:"glassmorphism"===q.theme.name?"rgba(255,255,255,0.9)":"dark"===q.theme.name?"#1e293b":q.theme.colors.cardBackground,borderColor:q.border,...q.cardStyle},children:[o.jsx(j,{className:"text-center",children:o.jsx(w,{className:"text-center text-xl font-bold",style:{color:q.textPrimary},children:"Choose IELTS Writing Type"})}),o.jsxs("div",{className:"flex flex-col gap-3 mt-2",children:[o.jsx(v,{onClick:()=>ae("Academic"),className:"w-full h-12 text-base font-medium",variant:"outline",style:{borderColor:q.border,color:q.textPrimary,backgroundColor:q.theme.colors.cardBackground},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=q.hoverBg,e.currentTarget.style.color=q.buttonPrimary},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=q.theme.colors.cardBackground,e.currentTarget.style.color=q.textPrimary},children:"Academic Training"}),o.jsx(v,{onClick:()=>ae("General"),className:"w-full h-12 text-base font-medium",variant:"outline",style:{borderColor:q.border,color:q.textPrimary,backgroundColor:q.theme.colors.cardBackground},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=q.hoverBg,e.currentTarget.style.color=q.buttonPrimary},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=q.theme.colors.cardBackground,e.currentTarget.style.color=q.textPrimary},children:"General Training"})]})]})})]})]})};export{P as default};
