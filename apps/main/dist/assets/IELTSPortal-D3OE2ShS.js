import{u as e,A as t,ak as r,al as s,r as a,j as n,am as o,ah as i,_ as l,a6 as c,an as d,S as m,o as g,p as u,q as h,ao as p,s as x,ap as f,a as y,D as k,l as b,m as _,n as w,aq as j,B as v}from"./index-P0C1KK6y.js";import{s as S}from"./supabase-DUkWVuqu.js";import{S as T}from"./skills-NqzSOyzV.js";const C=[{id:"reading",title:"Reading",description:"Academic & General texts"},{id:"listening",title:"Listening",description:"Audio comprehension"},{id:"writing",title:"Writing",description:"Task 1 & Task 2"},{id:"speaking",title:"Speaking",description:"Interview & presentation"}],N=()=>{const N=e(),{user:E}=t(),{themeName:P,setTheme:L}=r(),I=s();a.useState(null);const[B,q]=a.useState(!1),[M,A]=a.useState([]),[$,z]=a.useState(!1),[D,G]=a.useState(!0),[O,R]=a.useState({}),[V,W]=a.useState({}),[Y,F]=a.useState({}),[H,J]=a.useState({completed:0,total:0});a.useEffect(()=>{let e=!0,t=0;q(!0);const r=async()=>{try{await Promise.all([K(),E?Promise.all([U(),X()]):Promise.resolve()])}catch(s){if(console.error("Error loading IELTS portal data:",s),e&&t<2&&(t++,console.log(`ðŸ”„ Retrying IELTS portal data fetch (attempt ${t}/2)...`),await new Promise(e=>setTimeout(e,1e3*Math.pow(2,t))),e))return r();e&&G(!1)}};return r(),()=>{e=!1}},[E]),a.useEffect(()=>{E&&Z()},[E,M]),a.useEffect(()=>{Q()},[E]);const K=async()=>{G(!0);try{const[e,t,r]=await Promise.all([S.from("tests").select("*").ilike("test_type","IELTS").order("created_at",{ascending:!0}),S.from("questions").select("test_id, part_number, id, audio_url, choices"),S.from("speaking_prompts").select("test_id, id")]);if(e.error)throw console.error("Error fetching tests:",e.error),e.error;if(t.error)throw console.error("Error fetching questions:",t.error),t.error;if(r.error)throw console.error("Error fetching speaking prompts:",r.error),r.error;const s=e.data,a=t.data,n=r.data,o=new Map;null==s||s.forEach(e=>{o.has(e.id)||o.set(e.id,new Set);const t=(e.module||"").toLowerCase();t&&["reading","listening","writing","speaking"].includes(t)&&o.get(e.id).add(t);const r=(e.skill_category||"").toLowerCase();r&&["reading","listening","writing","speaking"].includes(r)&&o.get(e.id).add(r);const s=(e.test_name||"").toLowerCase();s.includes("reading")&&o.get(e.id).add("reading"),s.includes("listening")&&o.get(e.id).add("listening"),s.includes("writing")&&o.get(e.id).add("writing"),s.includes("speaking")&&o.get(e.id).add("speaking")}),null==a||a.forEach(e=>{e.test_id&&(o.has(e.test_id)||o.set(e.test_id,new Set),e.audio_url&&o.get(e.test_id).add("listening"),e.choices&&o.get(e.test_id).add("reading"))}),null==n||n.forEach(e=>{e.test_id&&(o.has(e.test_id)||o.set(e.test_id,new Set),o.get(e.test_id).add("speaking"))});const i=(null==s?void 0:s.map((e,t)=>{const r=o.get(e.id)||new Set,s=(null==a?void 0:a.filter(t=>t.test_id===e.id).length)||0,i=(null==n?void 0:n.filter(t=>t.test_id===e.id).length)||0,l=s+i;return{id:e.id,test_name:e.test_name,test_number:t+1,status:l>0?"complete":"incomplete",modules:Array.from(r),total_questions:s,speaking_prompts:i,comingSoon:0===l}}))||[];A(i)}catch(e){console.error("Error loading tests:",e),A([])}finally{G(!1)}},Q=async()=>{try{const{data:e}=await S.from("skill_tests").select("id").eq("skill_slug","vocabulary-builder"),t=(null==e?void 0:e.length)||0;let r=0;if(E&&t>0){const t=(e||[]).map(e=>e.id),{data:s}=await S.from("user_test_progress").select("test_id,status,completed_score").eq("user_id",E.id),a=new Set(t);r=(s||[]).filter(e=>a.has(e.test_id)&&"completed"===e.status).length}J({completed:Math.min(r,t),total:t})}catch(e){console.error("Error loading vocabulary progress",e),J({completed:0,total:0})}},U=async()=>{if(E)try{const e=["reading","listening","writing","speaking"],t=e.map(e=>S.from("test_results").select("score_percentage, created_at, test_type").eq("user_id",E.id).ilike("test_type",`%${e}%`).order("created_at",{ascending:!1}).limit(1).maybeSingle()),r=await Promise.all(t),s={};r.forEach(({data:t,error:r},a)=>{const n=e[a];if(!r&&null!=(null==t?void 0:t.score_percentage)){const e=(o=t.score_percentage)>=95?9:o>=90?8.5:o>=85?8:o>=80?7.5:o>=75?7:o>=70?6.5:o>=65?6:o>=60?5.5:o>=55?5:o>=50?4.5:o>=45?4:o>=40?3.5:o>=35?3:o>=30?2.5:o>=25?2:o>=20?1.5:o>=15?1:o>=10?.5:0;s[n]=`Band ${e}`}var o}),R(s)}catch(e){console.error("Error loading skill bands:",e)}},X=async()=>{if(E)try{const e={},t=T.map(e=>Promise.all([S.from("user_skill_progress").select("max_unlocked_level").eq("user_id",E.id).eq("skill_slug",e.slug).maybeSingle(),S.from("skill_tests").select("id",{count:"exact",head:!0}).eq("skill_slug",e.slug)]));(await Promise.all(t)).forEach(([t,r],s)=>{var a;const n=T[s],o=(null==(a=t.data)?void 0:a.max_unlocked_level)||0,i=r.count||10;e[n.slug]={completed:o,total:i}}),W(e)}catch(e){console.error("Error loading skill progress:",e)}},Z=async()=>{if(E)try{const e={},t={reading:0,listening:0,writing:0,speaking:0};for(const g of M){const e=g.modules||[];e.includes("reading")&&(t.reading+=1),e.includes("listening")&&(t.listening+=1),e.includes("writing")&&(t.writing+=1),e.includes("speaking")&&(t.speaking+=1)}const[r,s,a,n]=await Promise.all([S.from("writing_test_results").select("test_result_id, user_id").eq("user_id",E.id),S.from("reading_test_results").select("test_result_id, user_id").eq("user_id",E.id),S.from("listening_test_results").select("test_result_id, user_id").eq("user_id",E.id),S.from("speaking_test_results").select("test_result_id, user_id").eq("user_id",E.id)]),o=e=>{const t=new Set;return null==e||e.forEach(e=>{e.test_result_id&&t.add(e.test_result_id)}),t.size},i=o(r.data),l=o(s.data),c=o(a.data),d=o(n.data),m=(e,t)=>{const r=Math.max(0,t);return{completed:Math.min(e,r),total:r}};e.writing=m(i,t.writing||0),e.reading=m(l,t.reading||0),e.listening=m(c,t.listening||0),e.speaking=m(d,t.speaking||0),F(e)}catch(e){console.error("Error loading IELTS skill progress:",e)}},ee=e=>{"collocation-connect"!==e?"sentence-mastery"===e?N("/skills/sentence-mastery"):"writing"===e?z(!0):N("speaking"===e?"/ielts-speaking-test":"reading"===e?"/reading":"listening"===e?"/listening":`/skills/${e}`):N("/ai-speaking")},te=e=>{z(!1),N(`/ielts-writing-test?training=${e}`)};return D?n.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:"dark"===I.theme.name?I.theme.colors.background:"transparent"},children:n.jsx(o,{})}):n.jsxs("div",{className:"min-h-screen relative",style:{backgroundColor:"dark"===I.theme.name?I.theme.colors.background:"transparent"},children:[n.jsx(i,{title:"IELTS Preparation Portal",description:"Complete IELTS preparation with AI-powered feedback. Practice reading, listening, writing, and speaking with personalized guidance and real exam simulations.",keywords:"IELTS preparation, IELTS practice tests, IELTS writing feedback, IELTS speaking practice, IELTS reading, IELTS listening, IELTS band score",type:"website",schemaType:"course",courseType:"IELTS",courseLevel:"Intermediate to Advanced"}),n.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"note"===I.theme.name||"minimalist"===I.theme.name||"dark"===I.theme.name?"none":"url('https://raw.githubusercontent.com/AlfieAlfiegithu2/alfie-ai-coach/main/public/1000031207.png')",backgroundColor:I.backgroundImageColor}}),n.jsxs("div",{className:"relative z-10",children:[n.jsx(l,{title:"Dashboard",showBackButton:!0,children:n.jsxs("div",{className:"space-y-3 md:space-y-4 max-w-6xl mx-auto px-3 md:px-4",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[n.jsx("button",{onClick:()=>N("/hero"),className:"inline-flex items-center gap-2 px-2 py-1 h-8 text-sm font-medium transition-colors rounded-md",style:{color:I.textSecondary,backgroundColor:"transparent"},onMouseEnter:e=>{e.currentTarget.style.color=I.buttonPrimary,e.currentTarget.style.backgroundColor=I.hoverBg},onMouseLeave:e=>{e.currentTarget.style.color=I.textSecondary,e.currentTarget.style.backgroundColor="transparent"},children:n.jsx(c,{className:"h-4 w-4"})}),n.jsx("button",{onClick:()=>N("/dashboard"),className:"inline-flex items-center gap-2 px-2 py-1 h-8 text-sm font-medium transition-colors rounded-md",style:{color:I.textSecondary,backgroundColor:"transparent"},onMouseEnter:e=>{e.currentTarget.style.color=I.buttonPrimary,e.currentTarget.style.backgroundColor=I.hoverBg},onMouseLeave:e=>{e.currentTarget.style.color=I.textSecondary,e.currentTarget.style.backgroundColor="transparent"},children:"Dashboard"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(d,{className:"h-4 w-4",style:{color:I.textSecondary}}),n.jsxs(m,{value:P,onValueChange:e=>L(e),children:[n.jsx(g,{className:"w-[140px] h-8 text-sm border transition-colors",style:{backgroundColor:"glassmorphism"===I.theme.name?"rgba(255,255,255,0.8)":"dark"===I.theme.name?"rgba(255,255,255,0.1)":"minimalist"===I.theme.name?"#ffffff":I.theme.colors.cardBackground,borderColor:I.border,color:I.textPrimary},children:n.jsx(u,{placeholder:"Theme"})}),n.jsx(h,{children:Object.values(p).map(e=>n.jsx(x,{value:e.name,children:e.label},e.name))})]})]})]}),n.jsx("div",{className:"mb-8",children:n.jsx("h1",{className:"text-3xl md:text-4xl lg:text-5xl font-black text-center tracking-tight font-nunito",style:{color:I.textPrimary},children:"IELTS Portal"})}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h2",{className:"text-xl md:text-2xl font-bold mb-6 text-center font-nunito tracking-tight",style:{color:I.textPrimary},children:"Study each part"}),n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6",children:C.map((e,t)=>{Y[e.id];const r=["/reading.png","/listening.png","/writing.png","/speaking.png"][t];return n.jsx(f,{className:"cursor-pointer min-h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg",onClick:()=>ee(e.id),style:{backgroundColor:"glassmorphism"===I.theme.name?"rgba(255,255,255,0.8)":"dark"===I.theme.name?"rgba(255,255,255,0.1)":"minimalist"===I.theme.name?"#ffffff":I.theme.colors.cardBackground,borderColor:I.border,...I.cardStyle},children:n.jsxs(y,{className:"p-3 md:p-4 text-center flex-1 flex flex-col justify-center",children:[n.jsx("div",{className:"w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:n.jsx("img",{src:r,alt:`${e.title} icon`,className:"w-12 h-12 object-cover"})}),n.jsx("h3",{className:"font-semibold text-xs md:text-sm",style:{color:I.textPrimary},children:e.title})]})},e.id)})})]}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h2",{className:"text-xl md:text-2xl font-bold mb-6 text-center font-nunito tracking-tight",style:{color:I.textPrimary},children:"Sharpening Your Skills"}),n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6",children:[n.jsx(f,{className:"cursor-pointer min-h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg",onClick:()=>N("/vocabulary"),style:{backgroundColor:"glassmorphism"===I.theme.name?"rgba(255,255,255,0.8)":"dark"===I.theme.name?"rgba(255,255,255,0.1)":"minimalist"===I.theme.name?"#ffffff":I.theme.colors.cardBackground,borderColor:I.border,...I.cardStyle},children:n.jsx(y,{className:"p-3 md:p-4 text-center flex-1 flex flex-col justify-center",children:n.jsx("h3",{className:"font-semibold text-xs md:text-sm",style:{color:I.textPrimary},children:"Vocabulary Book"})})}),T.map(e=>(V[e.slug],n.jsx(f,{className:"cursor-pointer min-h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg",onClick:()=>ee(e.slug),style:{backgroundColor:"glassmorphism"===I.theme.name?"rgba(255,255,255,0.8)":"dark"===I.theme.name?"rgba(255,255,255,0.1)":"minimalist"===I.theme.name?"#ffffff":I.theme.colors.cardBackground,borderColor:I.border,...I.cardStyle},children:n.jsx(y,{className:"p-3 md:p-4 text-center flex-1 flex flex-col justify-center",children:n.jsx("h3",{className:"font-semibold text-xs md:text-sm",style:{color:I.textPrimary},children:e.label})})},e.slug)))]})]})]})}),n.jsx(k,{open:$,onOpenChange:z,children:n.jsxs(b,{className:"sm:max-w-md",children:[n.jsxs(_,{className:"text-center",children:[n.jsx(w,{className:"text-center",children:"Choose IELTS Writing Type"}),n.jsx(j,{className:"text-center",children:"Select your preferred IELTS writing training module"})]}),n.jsxs("div",{className:"flex flex-col gap-3",children:[n.jsx(v,{onClick:()=>te("Academic"),className:"w-full h-12 text-base font-medium",variant:"outline",style:{borderColor:I.border,color:I.textPrimary,backgroundColor:I.theme.colors.cardBackground},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=I.hoverBg,e.currentTarget.style.color=I.buttonPrimary},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=I.theme.colors.cardBackground,e.currentTarget.style.color=I.textPrimary},children:"Academic Training"}),n.jsx(v,{onClick:()=>te("General"),className:"w-full h-12 text-base font-medium",variant:"outline",style:{borderColor:I.border,color:I.textPrimary,backgroundColor:I.theme.colors.cardBackground},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=I.hoverBg,e.currentTarget.style.color=I.buttonPrimary},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=I.theme.colors.cardBackground,e.currentTarget.style.color=I.textPrimary},children:"General Training"})]})]})})]})]})};export{N as default};
