import{u as e,A as t,ae as r,af as s,r as a,j as n,ag as i,ab as o,Z as l,a5 as c,S as d,o as m,p as g,q as u,ah as h,s as p,ai as x,a as f,D as y,l as k,m as b,n as _,aj as j,B as w}from"./index-BX4LCKf1.js";import{s as v}from"./supabase-Bqkrifq5.js";import{S}from"./skills-NqzSOyzV.js";import{P as C}from"./palette-ij48gIkQ.js";const T=[{id:"reading",title:"Reading",description:"Academic & General texts"},{id:"listening",title:"Listening",description:"Audio comprehension"},{id:"writing",title:"Writing",description:"Task 1 & Task 2"},{id:"speaking",title:"Speaking",description:"Interview & presentation"}],N=()=>{const N=e(),{user:E}=t(),{themeName:P,setTheme:L}=r(),I=s();a.useState(null);const[B,q]=a.useState(!1),[M,A]=a.useState([]),[$,z]=a.useState(!1),[D,G]=a.useState(!0),[O,V]=a.useState({}),[W,Z]=a.useState({}),[R,Y]=a.useState({}),[F,H]=a.useState({completed:0,total:0});a.useEffect(()=>{q(!0);(async()=>{await Promise.all([J(),E?Promise.all([Q(),U()]):Promise.resolve()])})()},[E]),a.useEffect(()=>{E&&X()},[E,M]),a.useEffect(()=>{K()},[E]);const J=async()=>{G(!0);try{const[e,t,r]=await Promise.all([v.from("tests").select("*").ilike("test_type","IELTS").order("created_at",{ascending:!0}),v.from("questions").select("test_id, part_number, id, audio_url, choices"),v.from("speaking_prompts").select("test_id, id")]);if(e.error)throw console.error("Error fetching tests:",e.error),e.error;if(t.error)throw console.error("Error fetching questions:",t.error),t.error;if(r.error)throw console.error("Error fetching speaking prompts:",r.error),r.error;const s=e.data,a=t.data,n=r.data,i=new Map;null==s||s.forEach(e=>{i.has(e.id)||i.set(e.id,new Set);const t=(e.module||"").toLowerCase();t&&["reading","listening","writing","speaking"].includes(t)&&i.get(e.id).add(t);const r=(e.skill_category||"").toLowerCase();r&&["reading","listening","writing","speaking"].includes(r)&&i.get(e.id).add(r);const s=(e.test_name||"").toLowerCase();s.includes("reading")&&i.get(e.id).add("reading"),s.includes("listening")&&i.get(e.id).add("listening"),s.includes("writing")&&i.get(e.id).add("writing"),s.includes("speaking")&&i.get(e.id).add("speaking")}),null==a||a.forEach(e=>{e.test_id&&(i.has(e.test_id)||i.set(e.test_id,new Set),e.audio_url&&i.get(e.test_id).add("listening"),e.choices&&i.get(e.test_id).add("reading"))}),null==n||n.forEach(e=>{e.test_id&&(i.has(e.test_id)||i.set(e.test_id,new Set),i.get(e.test_id).add("speaking"))});const o=(null==s?void 0:s.map((e,t)=>{const r=i.get(e.id)||new Set,s=(null==a?void 0:a.filter(t=>t.test_id===e.id).length)||0,o=(null==n?void 0:n.filter(t=>t.test_id===e.id).length)||0,l=s+o;return{id:e.id,test_name:e.test_name,test_number:t+1,status:l>0?"complete":"incomplete",modules:Array.from(r),total_questions:s,speaking_prompts:o,comingSoon:0===l}}))||[];A(o)}catch(e){console.error("Error loading tests:",e),A([])}finally{G(!1)}},K=async()=>{try{const{data:e}=await v.from("skill_tests").select("id").eq("skill_slug","vocabulary-builder"),t=(null==e?void 0:e.length)||0;let r=0;if(E&&t>0){const t=(e||[]).map(e=>e.id),{data:s}=await v.from("user_test_progress").select("test_id,status,completed_score").eq("user_id",E.id),a=new Set(t);r=(s||[]).filter(e=>a.has(e.test_id)&&"completed"===e.status).length}H({completed:Math.min(r,t),total:t})}catch(e){console.error("Error loading vocabulary progress",e),H({completed:0,total:0})}},Q=async()=>{if(E)try{const e=["reading","listening","writing","speaking"],t=e.map(e=>v.from("test_results").select("score_percentage, created_at, test_type").eq("user_id",E.id).ilike("test_type",`%${e}%`).order("created_at",{ascending:!1}).limit(1).maybeSingle()),r=await Promise.all(t),s={};r.forEach(({data:t,error:r},a)=>{const n=e[a];if(!r&&null!=(null==t?void 0:t.score_percentage)){const e=(i=t.score_percentage)>=95?9:i>=90?8.5:i>=85?8:i>=80?7.5:i>=75?7:i>=70?6.5:i>=65?6:i>=60?5.5:i>=55?5:i>=50?4.5:i>=45?4:i>=40?3.5:i>=35?3:i>=30?2.5:i>=25?2:i>=20?1.5:i>=15?1:i>=10?.5:0;s[n]=`Band ${e}`}var i}),V(s)}catch(e){console.error("Error loading skill bands:",e)}},U=async()=>{if(E)try{const e={},t=S.map(e=>Promise.all([v.from("user_skill_progress").select("max_unlocked_level").eq("user_id",E.id).eq("skill_slug",e.slug).maybeSingle(),v.from("skill_tests").select("id",{count:"exact",head:!0}).eq("skill_slug",e.slug)]));(await Promise.all(t)).forEach(([t,r],s)=>{var a;const n=S[s],i=(null==(a=t.data)?void 0:a.max_unlocked_level)||0,o=r.count||10;e[n.slug]={completed:i,total:o}}),Z(e)}catch(e){console.error("Error loading skill progress:",e)}},X=async()=>{if(E)try{const e={},t={reading:0,listening:0,writing:0,speaking:0};for(const g of M){const e=g.modules||[];e.includes("reading")&&(t.reading+=1),e.includes("listening")&&(t.listening+=1),e.includes("writing")&&(t.writing+=1),e.includes("speaking")&&(t.speaking+=1)}const[r,s,a,n]=await Promise.all([v.from("writing_test_results").select("test_result_id, user_id").eq("user_id",E.id),v.from("reading_test_results").select("test_result_id, user_id").eq("user_id",E.id),v.from("listening_test_results").select("test_result_id, user_id").eq("user_id",E.id),v.from("speaking_test_results").select("test_result_id, user_id").eq("user_id",E.id)]),i=e=>{const t=new Set;return null==e||e.forEach(e=>{e.test_result_id&&t.add(e.test_result_id)}),t.size},o=i(r.data),l=i(s.data),c=i(a.data),d=i(n.data),m=(e,t)=>{const r=Math.max(0,t);return{completed:Math.min(e,r),total:r}};e.writing=m(o,t.writing||0),e.reading=m(l,t.reading||0),e.listening=m(c,t.listening||0),e.speaking=m(d,t.speaking||0),Y(e)}catch(e){console.error("Error loading IELTS skill progress:",e)}},ee=e=>{"collocation-connect"!==e?"sentence-mastery"===e?N("/skills/sentence-mastery"):"writing"===e?z(!0):N("speaking"===e?"/ielts-speaking-test":"reading"===e?"/reading":"listening"===e?"/listening":`/skills/${e}`):N("/ai-speaking")},te=e=>{z(!1),N(`/ielts-writing-test?training=${e}`)};return D?n.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:"dark"===I.theme.name?I.theme.colors.background:"transparent"},children:n.jsx(i,{})}):n.jsxs("div",{className:"min-h-screen relative",style:{backgroundColor:"dark"===I.theme.name?I.theme.colors.background:"transparent"},children:[n.jsx(o,{title:"IELTS Preparation Portal",description:"Complete IELTS preparation with AI-powered feedback. Practice reading, listening, writing, and speaking with personalized guidance and real exam simulations.",keywords:"IELTS preparation, IELTS practice tests, IELTS writing feedback, IELTS speaking practice, IELTS reading, IELTS listening, IELTS band score",type:"website",schemaType:"course",courseType:"IELTS",courseLevel:"Intermediate to Advanced"}),n.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"note"===I.theme.name||"minimalist"===I.theme.name||"dark"===I.theme.name?"none":"url('https://raw.githubusercontent.com/AlfieAlfiegithu2/alfie-ai-coach/main/public/1000031207.png')",backgroundColor:I.backgroundImageColor}}),n.jsxs("div",{className:"relative z-10",children:[n.jsx(l,{title:"Dashboard",showBackButton:!0,children:n.jsxs("div",{className:"space-y-3 md:space-y-4 max-w-6xl mx-auto px-3 md:px-4",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[n.jsx("button",{onClick:()=>N("/hero"),className:"inline-flex items-center gap-2 px-2 py-1 h-8 text-sm font-medium transition-colors rounded-md",style:{color:I.textSecondary,backgroundColor:"transparent"},onMouseEnter:e=>{e.currentTarget.style.color=I.buttonPrimary,e.currentTarget.style.backgroundColor=I.hoverBg},onMouseLeave:e=>{e.currentTarget.style.color=I.textSecondary,e.currentTarget.style.backgroundColor="transparent"},children:n.jsx(c,{className:"h-4 w-4"})}),n.jsx("button",{onClick:()=>N("/dashboard"),className:"inline-flex items-center gap-2 px-2 py-1 h-8 text-sm font-medium transition-colors rounded-md",style:{color:I.textSecondary,backgroundColor:"transparent"},onMouseEnter:e=>{e.currentTarget.style.color=I.buttonPrimary,e.currentTarget.style.backgroundColor=I.hoverBg},onMouseLeave:e=>{e.currentTarget.style.color=I.textSecondary,e.currentTarget.style.backgroundColor="transparent"},children:"Dashboard"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(C,{className:"h-4 w-4",style:{color:I.textSecondary}}),n.jsxs(d,{value:P,onValueChange:e=>L(e),children:[n.jsx(m,{className:"w-[140px] h-8 text-sm border transition-colors",style:{backgroundColor:"glassmorphism"===I.theme.name?"rgba(255,255,255,0.8)":"dark"===I.theme.name?"rgba(255,255,255,0.1)":"minimalist"===I.theme.name?"#ffffff":I.theme.colors.cardBackground,borderColor:I.border,color:I.textPrimary},children:n.jsx(g,{placeholder:"Theme"})}),n.jsx(u,{children:Object.values(h).map(e=>n.jsx(p,{value:e.name,children:e.label},e.name))})]})]})]}),n.jsx("div",{className:"mb-8",children:n.jsx("h1",{className:"text-3xl md:text-4xl lg:text-5xl font-black text-center tracking-tight font-nunito",style:{color:I.textPrimary},children:"IELTS Portal"})}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h2",{className:"text-xl md:text-2xl font-bold mb-6 text-center font-nunito tracking-tight",style:{color:I.textPrimary},children:"Study each part"}),n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6",children:T.map((e,t)=>{R[e.id];const r=["/reading.png","/listening.png","/writing.png","/speaking.png"][t];return n.jsx(x,{className:"cursor-pointer min-h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg",onClick:()=>ee(e.id),style:{backgroundColor:"glassmorphism"===I.theme.name?"rgba(255,255,255,0.8)":"dark"===I.theme.name?"rgba(255,255,255,0.1)":"minimalist"===I.theme.name?"#ffffff":I.theme.colors.cardBackground,borderColor:I.border,...I.cardStyle},children:n.jsxs(f,{className:"p-3 md:p-4 text-center flex-1 flex flex-col justify-center",children:[n.jsx("div",{className:"w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:n.jsx("img",{src:r,alt:`${e.title} icon`,className:"w-12 h-12 object-cover"})}),n.jsx("h3",{className:"font-semibold text-xs md:text-sm",style:{color:I.textPrimary},children:e.title})]})},e.id)})})]}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h2",{className:"text-xl md:text-2xl font-bold mb-6 text-center font-nunito tracking-tight",style:{color:I.textPrimary},children:"Sharpening Your Skills"}),n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6",children:[n.jsx(x,{className:"cursor-pointer min-h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg",onClick:()=>N("/vocabulary"),style:{backgroundColor:"glassmorphism"===I.theme.name?"rgba(255,255,255,0.8)":"dark"===I.theme.name?"rgba(255,255,255,0.1)":"minimalist"===I.theme.name?"#ffffff":I.theme.colors.cardBackground,borderColor:I.border,...I.cardStyle},children:n.jsx(f,{className:"p-3 md:p-4 text-center flex-1 flex flex-col justify-center",children:n.jsx("h3",{className:"font-semibold text-xs md:text-sm",style:{color:I.textPrimary},children:"Vocabulary Book"})})}),S.map(e=>(W[e.slug],n.jsx(x,{className:"cursor-pointer min-h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg",onClick:()=>ee(e.slug),style:{backgroundColor:"glassmorphism"===I.theme.name?"rgba(255,255,255,0.8)":"dark"===I.theme.name?"rgba(255,255,255,0.1)":"minimalist"===I.theme.name?"#ffffff":I.theme.colors.cardBackground,borderColor:I.border,...I.cardStyle},children:n.jsx(f,{className:"p-3 md:p-4 text-center flex-1 flex flex-col justify-center",children:n.jsx("h3",{className:"font-semibold text-xs md:text-sm",style:{color:I.textPrimary},children:e.label})})},e.slug)))]})]})]})}),n.jsx(y,{open:$,onOpenChange:z,children:n.jsxs(k,{className:"sm:max-w-md",children:[n.jsxs(b,{className:"text-center",children:[n.jsx(_,{className:"text-center",children:"Choose IELTS Writing Type"}),n.jsx(j,{className:"text-center",children:"Select your preferred IELTS writing training module"})]}),n.jsxs("div",{className:"flex flex-col gap-3",children:[n.jsx(w,{onClick:()=>te("Academic"),className:"w-full h-12 text-base font-medium",variant:"outline",style:{borderColor:I.border,color:I.textPrimary,backgroundColor:I.theme.colors.cardBackground},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=I.hoverBg,e.currentTarget.style.color=I.buttonPrimary},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=I.theme.colors.cardBackground,e.currentTarget.style.color=I.textPrimary},children:"Academic Training"}),n.jsx(w,{onClick:()=>te("General"),className:"w-full h-12 text-base font-medium",variant:"outline",style:{borderColor:I.border,color:I.textPrimary,backgroundColor:I.theme.colors.cardBackground},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=I.hoverBg,e.currentTarget.style.color=I.buttonPrimary},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=I.theme.colors.cardBackground,e.currentTarget.style.color=I.textPrimary},children:"General Training"})]})]})})]})]})};export{N as default};
