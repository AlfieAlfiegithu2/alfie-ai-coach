import{ak as e,u as s,A as t,r as a,j as r,ag as i,Z as l,B as c,C as n,b as o,c as d,k as m,a as x}from"./index-BQ19MijR.js";import{s as g}from"./supabase-DUkWVuqu.js";const u=()=>{const{skill:u}=e(),h=s(),{user:p}=t(),[b,f]=a.useState([]),[j,k]=a.useState({}),[N,v]=a.useState(!0),y=u?u.charAt(0).toUpperCase()+u.slice(1):"";a.useEffect(()=>{u&&w()},[u,p]);const w=async()=>{if(u){v(!0);try{let e=[];console.log(`Loading IELTS ${y} tests...`);const s=u.charAt(0).toUpperCase()+u.slice(1),{data:t,error:a}=await g.from("tests").select("*").eq("test_type","IELTS").or(`module.eq.${s},skill_category.eq.${s}`).order("test_name",{ascending:!0});if(a)throw console.error("Error loading skill tests:",a),a;if(e=t||[],"writing"===u&&e.length>0)for(const i of e){const{count:e,error:s}=await g.from("questions").select("*",{count:"exact",head:!0}).eq("test_id",i.id);s||(i.questionsCount=e||0)}let r={};if(p&&e.length>0){const{data:e,error:s}=await g.from("test_results").select("*").eq("user_id",p.id).ilike("test_type",`%${u}%`).order("created_at",{ascending:!1});!s&&e&&(r=e.reduce((e,s)=>{const t=s.cambridge_book||s.test_type;return(!e[t]||new Date(s.created_at)>new Date(e[t].created_at))&&(e[t]=s),e},{}))}f(e),k(r)}catch(e){console.error("Error loading skill tests:",e)}finally{v(!1)}}};return N?r.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:r.jsx(i,{})}):r.jsxs("div",{className:"min-h-screen relative",children:[r.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"url('/lovable-uploads/38d81cb0-fd21-4737-b0f5-32bc5d0ae774.png')",backgroundColor:"#f3f4f6"}}),r.jsx("div",{className:"relative z-10",children:r.jsx(l,{title:`IELTS ${y} Tests`,showBackButton:!0,children:r.jsxs("div",{className:"space-y-3 md:space-y-4 max-w-6xl mx-auto px-3 md:px-4",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(c,{variant:"ghost",onClick:()=>h("/hero"),className:"text-text-secondary px-2 py-1 h-8",children:"Home"}),r.jsx(c,{variant:"ghost",onClick:()=>h("/ielts"),className:"text-text-secondary px-2 py-1 h-8",children:"IELTS Tests"})]}),r.jsxs("div",{className:"text-center space-y-4 mb-6",children:[r.jsxs("h1",{className:"text-xl md:text-2xl font-bold text-foreground",children:["IELTS ",y," Tests"]}),r.jsxs("p",{className:"text-sm md:text-base text-muted-foreground max-w-2xl mx-auto",children:["Practice authentic IELTS ",y.toLowerCase()," tests and track your progress"]})]}),r.jsx("div",{className:"space-y-4",children:b.length>0?r.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4",children:b.map(e=>{const s=e.test_name,t=j[s]||j[e.test_name],a=!!t,i=a?(l=t.score_percentage)>=95?9:l>=90?8.5:l>=85?8:l>=80?7.5:l>=75?7:l>=70?6.5:l>=65?6:l>=60?5.5:l>=55?5:l>=50?4.5:l>=45?4:l>=40?3.5:l>=35?3:l>=30?2.5:l>=25?2:l>=20?1.5:l>=15?1:l>=10?.5:0:null;var l;return r.jsxs(n,{className:"hover:shadow-lg transition-all duration-200 cursor-pointer bg-card/80 backdrop-blur-sm",onClick:()=>(e=>{h("reading"===u?`/reading/${e.id}`:"listening"===u?`/listening/${e.id}`:"writing"===u?`/ielts-writing-test/${e.id}`:"speaking"===u?`/ielts-speaking-test/${e.id}`:`/ielts-test-modules/${e.id}`)})(e),children:[r.jsx(o,{className:"pb-2",children:r.jsxs(d,{className:"text-base md:text-lg flex items-center justify-between",children:[r.jsx("span",{children:s}),a&&r.jsxs(m,{variant:"secondary",className:"text-xs",children:["Band ",i]})]})}),r.jsx(x,{className:"pt-0",children:r.jsx(c,{className:"w-full",size:"sm",children:a?"Retake Test":"Start Test"})})]},e.id)})}):r.jsxs("div",{className:"text-center py-12",children:[r.jsxs("h3",{className:"text-lg font-semibold mb-2 text-foreground",children:["No ",y," Tests Available"]}),r.jsxs("p",{className:"text-muted-foreground mb-4",children:[y," tests are being prepared. Check back soon!"]}),r.jsx(c,{onClick:()=>h("/ielts"),variant:"outline",children:"Back to IELTS Hub"})]})})]})})})]})};export{u as default};
