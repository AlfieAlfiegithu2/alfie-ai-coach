import{c as e,u as s,r as t,j as a}from"./vendor-react-JN_hy__U.js";import{E as r,s as i,x as n,y as o,B as l,C as c,b as d,c as m,e as x,a as g}from"./index-DXpPY1B7.js";import"./vendor-react-dom-Cb-iy8Oc.js";import"./vendor-animation-ClPlB6zo.js";import"./vendor-i18n-DlHrixAm.js";import"./vendor-ui-DG51EGkO.js";import"./vendor-utils-D5HPTFR9.js";import"./vendor-supabase-D7XYLCUu.js";import"./vendor-charts-BpOKEG9Z.js";import"./vendor-date-DT7Rq6D9.js";const h=()=>{const{skill:h}=e(),p=s(),{user:u}=r(),[j,f]=t.useState([]),[b,v]=t.useState({}),[y,N]=t.useState(!0),k=h?h.charAt(0).toUpperCase()+h.slice(1):"";t.useEffect(()=>{h&&w()},[h,u]);const w=async()=>{if(h){N(!0);try{let e=[];console.log(`Loading IELTS ${k} tests...`);const s=h.charAt(0).toUpperCase()+h.slice(1),{data:t,error:a}=await i.from("tests").select("*").eq("test_type","IELTS").or(`module.eq.${s},skill_category.eq.${s}`).order("test_name",{ascending:!0});if(a)throw console.error("Error loading skill tests:",a),a;if(e=t||[],("listening"===h||"reading"===h)&&e.length>0){const s=e.map(e=>e.id),{data:t,error:a}=await i.from("questions").select("test_id").in("test_id",s);if(!a&&t){const s=new Set(t.map(e=>e.test_id)),a=e.length;e=e.filter(e=>s.has(e.id)),console.log(`ðŸ“Š Filtered from ${a} to ${e.length} ${k} tests (only showing tests with questions)`)}}if("writing"===h&&e.length>0)for(const n of e){const{count:e,error:s}=await i.from("questions").select("*",{count:"exact",head:!0}).eq("test_id",n.id);s||(n.questionsCount=e||0)}let r={};if(u&&e.length>0){const{data:e,error:s}=await i.from("test_results").select("*").eq("user_id",u.id).ilike("test_type",`%${h}%`).order("created_at",{ascending:!1});!s&&e&&(r=e.reduce((e,s)=>{const t=s.cambridge_book||s.test_type;return(!e[t]||new Date(s.created_at)>new Date(e[t].created_at))&&(e[t]=s),e},{}))}f(e),v(r)}catch(e){console.error("Error loading skill tests:",e)}finally{N(!1)}}};return y?a.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:a.jsx(n,{})}):a.jsxs("div",{className:"min-h-screen relative",children:[a.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"url('/lovable-uploads/38d81cb0-fd21-4737-b0f5-32bc5d0ae774.png')",backgroundColor:"#f3f4f6"}}),a.jsx("div",{className:"relative z-10",children:a.jsx(o,{title:`IELTS ${k} Tests`,showBackButton:!0,children:a.jsxs("div",{className:"space-y-3 md:space-y-4 max-w-6xl mx-auto px-3 md:px-4",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(l,{variant:"ghost",onClick:()=>p("/hero"),className:"text-text-secondary px-2 py-1 h-8",children:"Home"}),a.jsx(l,{variant:"ghost",onClick:()=>p("/ielts"),className:"text-text-secondary px-2 py-1 h-8",children:"IELTS Tests"})]}),a.jsxs("div",{className:"text-center space-y-4 mb-6",children:[a.jsxs("h1",{className:"text-xl md:text-2xl font-bold text-foreground",children:["IELTS ",k," Tests"]}),a.jsxs("p",{className:"text-sm md:text-base text-muted-foreground max-w-2xl mx-auto",children:["Practice authentic IELTS ",k.toLowerCase()," tests and track your progress"]})]}),a.jsx("div",{className:"space-y-4",children:j.length>0?a.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4",children:j.map(e=>{const s=e.test_name,t=b[s]||b[e.test_name],r=!!t,i=r?(n=t.score_percentage)>=95?9:n>=90?8.5:n>=85?8:n>=80?7.5:n>=75?7:n>=70?6.5:n>=65?6:n>=60?5.5:n>=55?5:n>=50?4.5:n>=45?4:n>=40?3.5:n>=35?3:n>=30?2.5:n>=25?2:n>=20?1.5:n>=15?1:n>=10?.5:0:null;var n;return a.jsxs(c,{className:"hover:shadow-lg transition-all duration-200 cursor-pointer bg-card/80 backdrop-blur-sm",onClick:()=>(e=>{p("reading"===h?`/reading/${e.id}`:"listening"===h?`/listening/${e.id}`:"writing"===h?`/ielts-writing-test/${e.id}`:"speaking"===h?`/ielts-speaking-test/${e.id}`:`/ielts-test-modules/${e.id}`)})(e),children:[a.jsx(d,{className:"pb-2",children:a.jsxs(m,{className:"text-base md:text-lg flex items-center justify-between",children:[a.jsx("span",{children:s}),r&&a.jsxs(x,{variant:"secondary",className:"text-xs",children:["Band ",i]})]})}),a.jsx(g,{className:"pt-0",children:a.jsx(l,{className:"w-full",size:"sm",children:r?"Retake Test":"Start Test"})})]},e.id)})}):a.jsxs("div",{className:"text-center py-12",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-2 text-foreground",children:["No ",k," Tests Available"]}),a.jsxs("p",{className:"text-muted-foreground mb-4",children:[k," tests are being prepared. Check back soon!"]}),a.jsx(l,{onClick:()=>p("/ielts"),variant:"outline",children:"Back to IELTS Hub"})]})})]})})})]})};export{h as default};
