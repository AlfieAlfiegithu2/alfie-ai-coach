import{G as e,u as s,a2 as t,r as a,j as r,a3 as i,a4 as n,B as l,C as c,b as o,d,l as m,a as x}from"./index-C6RqRRNF.js";import{s as g}from"./supabase-DWL4C3fA.js";const h=()=>{const{skill:h}=e(),u=s(),{user:p}=t(),[f,b]=a.useState([]),[j,N]=a.useState({}),[k,y]=a.useState(!0),v=h?h.charAt(0).toUpperCase()+h.slice(1):"";a.useEffect(()=>{h&&w()},[h,p]);const w=async()=>{if(h){y(!0);try{let e=[];console.log(`Loading IELTS ${v} tests...`);const s=h.charAt(0).toUpperCase()+h.slice(1),{data:t,error:a}=await g.from("tests").select("*").eq("test_type","IELTS").or(`module.eq.${s},skill_category.eq.${s}`).order("test_name",{ascending:!0});if(a)throw console.error("Error loading skill tests:",a),a;if(e=t||[],("listening"===h||"reading"===h)&&e.length>0){const s=e.map(e=>e.id),{data:t,error:a}=await g.from("questions").select("test_id").in("test_id",s);if(!a&&t){const s=new Set(t.map(e=>e.test_id)),a=e.length;e=e.filter(e=>s.has(e.id)),console.log(`ðŸ“Š Filtered from ${a} to ${e.length} ${v} tests (only showing tests with questions)`)}}if("writing"===h&&e.length>0)for(const i of e){const{count:e,error:s}=await g.from("questions").select("*",{count:"exact",head:!0}).eq("test_id",i.id);s||(i.questionsCount=e||0)}let r={};if(p&&e.length>0){const{data:e,error:s}=await g.from("test_results").select("*").eq("user_id",p.id).ilike("test_type",`%${h}%`).order("created_at",{ascending:!1});!s&&e&&(r=e.reduce((e,s)=>{const t=s.cambridge_book||s.test_type;return(!e[t]||new Date(s.created_at)>new Date(e[t].created_at))&&(e[t]=s),e},{}))}b(e),N(r)}catch(e){console.error("Error loading skill tests:",e)}finally{y(!1)}}};return k?r.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:r.jsx(i,{})}):r.jsxs("div",{className:"min-h-screen relative",children:[r.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"url('/lovable-uploads/38d81cb0-fd21-4737-b0f5-32bc5d0ae774.png')",backgroundColor:"#f3f4f6"}}),r.jsx("div",{className:"relative z-10",children:r.jsx(n,{title:`IELTS ${v} Tests`,showBackButton:!0,children:r.jsxs("div",{className:"space-y-3 md:space-y-4 max-w-6xl mx-auto px-3 md:px-4",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(l,{variant:"ghost",onClick:()=>u("/hero"),className:"text-text-secondary px-2 py-1 h-8",children:"Home"}),r.jsx(l,{variant:"ghost",onClick:()=>u("/ielts"),className:"text-text-secondary px-2 py-1 h-8",children:"IELTS Tests"})]}),r.jsxs("div",{className:"text-center space-y-4 mb-6",children:[r.jsxs("h1",{className:"text-xl md:text-2xl font-bold text-foreground",children:["IELTS ",v," Tests"]}),r.jsxs("p",{className:"text-sm md:text-base text-muted-foreground max-w-2xl mx-auto",children:["Practice authentic IELTS ",v.toLowerCase()," tests and track your progress"]})]}),r.jsx("div",{className:"space-y-4",children:f.length>0?r.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4",children:f.map(e=>{const s=e.test_name,t=j[s]||j[e.test_name],a=!!t,i=a?(n=t.score_percentage)>=95?9:n>=90?8.5:n>=85?8:n>=80?7.5:n>=75?7:n>=70?6.5:n>=65?6:n>=60?5.5:n>=55?5:n>=50?4.5:n>=45?4:n>=40?3.5:n>=35?3:n>=30?2.5:n>=25?2:n>=20?1.5:n>=15?1:n>=10?.5:0:null;var n;return r.jsxs(c,{className:"hover:shadow-lg transition-all duration-200 cursor-pointer bg-card/80 backdrop-blur-sm",onClick:()=>(e=>{u("reading"===h?`/reading/${e.id}`:"listening"===h?`/listening/${e.id}`:"writing"===h?`/ielts-writing-test/${e.id}`:"speaking"===h?`/ielts-speaking-test/${e.id}`:`/ielts-test-modules/${e.id}`)})(e),children:[r.jsx(o,{className:"pb-2",children:r.jsxs(d,{className:"text-base md:text-lg flex items-center justify-between",children:[r.jsx("span",{children:s}),a&&r.jsxs(m,{variant:"secondary",className:"text-xs",children:["Band ",i]})]})}),r.jsx(x,{className:"pt-0",children:r.jsx(l,{className:"w-full",size:"sm",children:a?"Retake Test":"Start Test"})})]},e.id)})}):r.jsxs("div",{className:"text-center py-12",children:[r.jsxs("h3",{className:"text-lg font-semibold mb-2 text-foreground",children:["No ",v," Tests Available"]}),r.jsxs("p",{className:"text-muted-foreground mb-4",children:[v," tests are being prepared. Check back soon!"]}),r.jsx(l,{onClick:()=>u("/ielts"),variant:"outline",children:"Back to IELTS Hub"})]})})]})})})]})};export{h as default};
