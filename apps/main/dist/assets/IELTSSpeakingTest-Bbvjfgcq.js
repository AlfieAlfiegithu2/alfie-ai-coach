import{c as e,bD as t,bE as r,bF as n,bG as a,bH as o,bI as s,bJ as i,bK as l,bL as c,bM as u,bN as d,bO as m,bP as p,bQ as h,r as f,bR as g,bS as b,bT as y,bU as x,bB as v,bV as j,bW as k,bX as w,bY as N,bZ as P,b_ as C,j as S,bv as _,at as O,G as E,u as T,a3 as A,h as M,a1 as R,bC as L,a5 as $,bl as I,a as F,B as q,l as B,C as D,M as z,b as U,d as W,aC as V,bs as G,bt as H,E as K,N as Y,bu as Q,W as Z,P as J,b$ as X,Y as ee,Z as te,V as re,O as ne,X as ae,F as oe,z as se,S as ie,p as le,q as ce,s as ue,t as de,ai as me,c0 as pe,e as he,a0 as fe}from"./index-BQgnpnc4.js";import{S as ge}from"./separator-CzQHfEPc.js";import"./scroll-area-g3pwgNL-.js";import{C as be}from"./CustomAudioPlayer-XZwkh90n.js";import{g as ye,s as xe}from"./supabase-DWL4C3fA.js";import{A as ve}from"./cloudflare-r2-Bg99fdQ0.js";import"./slider-K_TMLWD_.js";import"./dropdown-menu-B6MQyGTh.js";import{C as je,a as ke,b as we,O as Ne,M as Pe,c as Ce,R as Se,S as _e}from"./shimmering-text-D_IoNKyf.js";import{F as Oe}from"./languages-CfEi4KMq.js";import{C as Ee}from"./circle-alert-DGGk67iD.js";import"./index-D7iUh4Yk.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=e("ListTree",[["path",{d:"M21 12h-8",key:"1bmf0i"}],["path",{d:"M21 6H8",key:"1pqkrb"}],["path",{d:"M21 18h-8",key:"1tm79t"}],["path",{d:"M3 6v4c0 1.1.9 2 2 2h3",key:"1ywdgy"}],["path",{d:"M3 10v6c0 1.1.9 2 2 2h3",key:"2wc746"}]]);var Ae=["points","className","baseLinePoints","connectNulls"];function Me(){return Me=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Me.apply(this,arguments)}function Re(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function Le(e){return function(e){if(Array.isArray(e))return $e(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return $e(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $e(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $e(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Ie=function(e){return e&&e.x===+e.x&&e.y===+e.y},Fe=function(e,t){var r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=[[]];return e.forEach(function(e){Ie(e)?t[t.length-1].push(e):t[t.length-1].length>0&&t.push([])}),Ie(e[0])&&t[t.length-1].push(e[0]),t[t.length-1].length<=0&&(t=t.slice(0,-1)),t}(e);t&&(r=[r.reduce(function(e,t){return[].concat(Le(e),Le(t))},[])]);var n=r.map(function(e){return e.reduce(function(e,t,r){return"".concat(e).concat(0===r?"M":"L").concat(t.x,",").concat(t.y)},"")}).join("");return 1===r.length?"".concat(n,"Z"):n},qe=function(e){var a=e.points,o=e.className,s=e.baseLinePoints,i=e.connectNulls,l=Re(e,Ae);if(!a||!a.length)return null;var c=t("recharts-polygon",o);if(s&&s.length){var u=l.stroke&&"none"!==l.stroke,d=function(e,t,r){var n=Fe(e,r);return"".concat("Z"===n.slice(-1)?n.slice(0,-1):n,"L").concat(Fe(t.reverse(),r).slice(1))}(a,s,i);return r.createElement("g",{className:c},r.createElement("path",Me({},n(l,!0),{fill:"Z"===d.slice(-1)?l.fill:"none",stroke:"none",d:d})),u?r.createElement("path",Me({},n(l,!0),{fill:"none",d:Fe(a,i)})):null,u?r.createElement("path",Me({},n(l,!0),{fill:"none",d:Fe(s,i)})):null)}var m=Fe(a,i);return r.createElement("path",Me({},n(l,!0),{fill:"Z"===m.slice(-1)?l.fill:"none",className:c,d:m}))},Be=["cx","cy","innerRadius","outerRadius","gridType","radialLines"];function De(e){return(De="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ze(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function Ue(){return Ue=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ue.apply(this,arguments)}function We(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Ve(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?We(Object(r),!0).forEach(function(t){Ge(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):We(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Ge(e,t,r){var n;return n=function(e,t){if("object"!=De(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=De(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"),(t="symbol"==De(n)?n:n+"")in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var He=function(e,t,r,n){var o="";return n.forEach(function(n,s){var i=a(t,r,e,n);o+=s?"L ".concat(i.x,",").concat(i.y):"M ".concat(i.x,",").concat(i.y)}),o+="Z"},Ke=function(e){var t=e.cx,o=e.cy,s=e.innerRadius,i=e.outerRadius,l=e.polarAngles,c=e.radialLines;if(!l||!l.length||!c)return null;var u=Ve({stroke:"#ccc"},n(e,!1));return r.createElement("g",{className:"recharts-polar-grid-angle"},l.map(function(e){var n=a(t,o,s,e),l=a(t,o,i,e);return r.createElement("line",Ue({},u,{key:"line-".concat(e),x1:n.x,y1:n.y,x2:l.x,y2:l.y}))}))},Ye=function(e){var a=e.cx,o=e.cy,s=e.radius,i=e.index,l=Ve(Ve({stroke:"#ccc"},n(e,!1)),{},{fill:"none"});return r.createElement("circle",Ue({},l,{className:t("recharts-polar-grid-concentric-circle",e.className),key:"circle-".concat(i),cx:a,cy:o,r:s}))},Qe=function(e){var a=e.radius,o=e.index,s=Ve(Ve({stroke:"#ccc"},n(e,!1)),{},{fill:"none"});return r.createElement("path",Ue({},s,{className:t("recharts-polar-grid-concentric-polygon",e.className),key:"path-".concat(o),d:He(a,e.cx,e.cy,e.polarAngles)}))},Ze=function(e){var t=e.polarRadius,n=e.gridType;return t&&t.length?r.createElement("g",{className:"recharts-polar-grid-concentric"},t.map(function(t,a){var o=a;return"circle"===n?r.createElement(Ye,Ue({key:o},e,{radius:t,index:a})):r.createElement(Qe,Ue({key:o},e,{radius:t,index:a}))})):null},Je=function(e){var t=e.cx,n=void 0===t?0:t,a=e.cy,o=void 0===a?0:a,s=e.innerRadius,i=void 0===s?0:s,l=e.outerRadius,c=void 0===l?0:l,u=e.gridType,d=void 0===u?"polygon":u,m=e.radialLines,p=void 0===m||m,h=ze(e,Be);return c<=0?null:r.createElement("g",{className:"recharts-polar-grid"},r.createElement(Ke,Ue({cx:n,cy:o,innerRadius:i,outerRadius:c,gridType:d,radialLines:p},h)),r.createElement(Ze,Ue({cx:n,cy:o,innerRadius:i,outerRadius:c,gridType:d,radialLines:p},h)))};Je.displayName="PolarGrid";var Xe=o,et=i,tt=s;const rt=ye(function(e,t){return e&&e.length?Xe(e,tt(t),et):void 0});var nt=o,at=s,ot=l;const st=ye(function(e,t){return e&&e.length?nt(e,at(t),ot):void 0});var it=["cx","cy","angle","ticks","axisLine"],lt=["ticks","tick","angle","tickFormatter","stroke"];function ct(e){return(ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ut(){return ut=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ut.apply(this,arguments)}function dt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function mt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?dt(Object(r),!0).forEach(function(t){xt(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dt(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function pt(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function ht(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,vt(n.key),n)}}function ft(e,t,r){return t=bt(t),function(e,t){if(t&&("object"===ct(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,gt()?Reflect.construct(t,r||[],bt(e).constructor):t.apply(e,r))}function gt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(gt=function(){return!!e})()}function bt(e){return(bt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function yt(e,t){return(yt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function xt(e,t,r){return(t=vt(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function vt(e){var t=function(e,t){if("object"!=ct(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=ct(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ct(t)?t:t+""}var jt=function(){function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ft(this,e,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&yt(e,t)}(e,f.PureComponent),o=e,i=[{key:"renderTickItem",value:function(e,t,n){return r.isValidElement(e)?r.cloneElement(e,t):c(e)?e(t):r.createElement(u,ut({},t,{className:"recharts-polar-radius-axis-tick-value"}),n)}}],(s=[{key:"getTickValueCoord",value:function(e){var t=e.coordinate,r=this.props,n=r.angle,o=r.cx,s=r.cy;return a(o,s,t,n)}},{key:"getTickTextAnchor",value:function(){var e;switch(this.props.orientation){case"left":e="end";break;case"right":e="start";break;default:e="middle"}return e}},{key:"getViewBox",value:function(){var e=this.props,t=e.cx,r=e.cy,n=e.angle,a=e.ticks,o=rt(a,function(e){return e.coordinate||0});return{cx:t,cy:r,startAngle:n,endAngle:n,innerRadius:st(a,function(e){return e.coordinate||0}).coordinate||0,outerRadius:o.coordinate||0}}},{key:"renderAxisLine",value:function(){var e=this.props,t=e.cx,o=e.cy,s=e.angle,i=e.ticks,l=e.axisLine,c=pt(e,it),u=i.reduce(function(e,t){return[Math.min(e[0],t.coordinate),Math.max(e[1],t.coordinate)]},[1/0,-1/0]),d=a(t,o,u[0],s),m=a(t,o,u[1],s),p=mt(mt(mt({},n(c,!1)),{},{fill:"none"},n(l,!1)),{},{x1:d.x,y1:d.y,x2:m.x,y2:m.y});return r.createElement("line",ut({className:"recharts-polar-radius-axis-line"},p))}},{key:"renderTicks",value:function(){var a=this,o=this.props,s=o.ticks,i=o.tick,l=o.angle,c=o.tickFormatter,u=o.stroke,h=pt(o,lt),f=this.getTickTextAnchor(),g=n(h,!1),b=n(i,!1),y=s.map(function(n,o){var s=a.getTickValueCoord(n),h=mt(mt(mt(mt({textAnchor:f,transform:"rotate(".concat(90-l,", ").concat(s.x,", ").concat(s.y,")")},g),{},{stroke:"none",fill:u},b),{},{index:o},s),{},{payload:n});return r.createElement(d,ut({className:t("recharts-polar-radius-axis-tick",m(i)),key:"tick-".concat(n.coordinate)},p(a.props,n,o)),e.renderTickItem(i,h,c?c(n.value,o):n.value))});return r.createElement(d,{className:"recharts-polar-radius-axis-ticks"},y)}},{key:"render",value:function(){var e=this.props,n=e.ticks,a=e.axisLine,o=e.tick;return n&&n.length?r.createElement(d,{className:t("recharts-polar-radius-axis",this.props.className)},a&&this.renderAxisLine(),o&&this.renderTicks(),h.renderCallByParent(this.props,this.getViewBox())):null}}])&&ht(o.prototype,s),i&&ht(o,i),Object.defineProperty(o,"prototype",{writable:!1}),o;var o,s,i}();function kt(e){return(kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function wt(){return wt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},wt.apply(this,arguments)}function Nt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Pt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Nt(Object(r),!0).forEach(function(t){Tt(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Nt(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Ct(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,At(n.key),n)}}function St(e,t,r){return t=Ot(t),function(e,t){if(t&&("object"===kt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,_t()?Reflect.construct(t,r||[],Ot(e).constructor):t.apply(e,r))}function _t(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(_t=function(){return!!e})()}function Ot(e){return(Ot=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Et(e,t){return(Et=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function Tt(e,t,r){return(t=At(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function At(e){var t=function(e,t){if("object"!=kt(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=kt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==kt(t)?t:t+""}xt(jt,"displayName","PolarRadiusAxis"),xt(jt,"axisType","radiusAxis"),xt(jt,"defaultProps",{type:"number",radiusAxisId:0,cx:0,cy:0,angle:0,orientation:"right",stroke:"#ccc",axisLine:!0,tick:!0,tickCount:5,allowDataOverflow:!1,scale:"auto",allowDuplicatedCategory:!0});var Mt=Math.PI/180,Rt=1e-5,Lt=function(){function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),St(this,e,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Et(e,t)}(e,f.PureComponent),o=e,i=[{key:"renderTickItem",value:function(e,t,n){return r.isValidElement(e)?r.cloneElement(e,t):c(e)?e(t):r.createElement(u,wt({},t,{className:"recharts-polar-angle-axis-tick-value"}),n)}}],(s=[{key:"getTickLineCoord",value:function(e){var t=this.props,r=t.cx,n=t.cy,o=t.radius,s=t.orientation,i=t.tickSize||8,l=a(r,n,o,e.coordinate),c=a(r,n,o+("inner"===s?-1:1)*i,e.coordinate);return{x1:l.x,y1:l.y,x2:c.x,y2:c.y}}},{key:"getTickTextAnchor",value:function(e){var t=this.props.orientation,r=Math.cos(-e.coordinate*Mt);return r>Rt?"outer"===t?"start":"end":r<-Rt?"outer"===t?"end":"start":"middle"}},{key:"renderAxisLine",value:function(){var e=this.props,t=e.cx,o=e.cy,s=e.radius,i=e.axisLine,l=e.axisLineType,c=Pt(Pt({},n(this.props,!1)),{},{fill:"none"},n(i,!1));if("circle"===l)return r.createElement(g,wt({className:"recharts-polar-angle-axis-line"},c,{cx:t,cy:o,r:s}));var u=this.props.ticks.map(function(e){return a(t,o,s,e.coordinate)});return r.createElement(qe,wt({className:"recharts-polar-angle-axis-line"},c,{points:u}))}},{key:"renderTicks",value:function(){var a=this,o=this.props,s=o.ticks,i=o.tick,l=o.tickLine,c=o.tickFormatter,u=o.stroke,h=n(this.props,!1),f=n(i,!1),g=Pt(Pt({},h),{},{fill:"none"},n(l,!1)),b=s.map(function(n,o){var s=a.getTickLineCoord(n),b=Pt(Pt(Pt({textAnchor:a.getTickTextAnchor(n)},h),{},{stroke:"none",fill:u},f),{},{index:o,payload:n,x:s.x2,y:s.y2});return r.createElement(d,wt({className:t("recharts-polar-angle-axis-tick",m(i)),key:"tick-".concat(n.coordinate)},p(a.props,n,o)),l&&r.createElement("line",wt({className:"recharts-polar-angle-axis-tick-line"},g,s)),i&&e.renderTickItem(i,b,c?c(n.value,o):n.value))});return r.createElement(d,{className:"recharts-polar-angle-axis-ticks"},b)}},{key:"render",value:function(){var e=this.props,n=e.ticks,a=e.radius,o=e.axisLine;return a<=0||!n||!n.length?null:r.createElement(d,{className:t("recharts-polar-angle-axis",this.props.className)},o&&this.renderAxisLine(),this.renderTicks())}}])&&Ct(o.prototype,s),i&&Ct(o,i),Object.defineProperty(o,"prototype",{writable:!1}),o;var o,s,i}();Tt(Lt,"displayName","PolarAngleAxis"),Tt(Lt,"axisType","angleAxis"),Tt(Lt,"defaultProps",{type:"category",angleAxisId:0,scale:"auto",cx:0,cy:0,orientation:"outer",axisLine:!0,tickLine:!0,tickSize:8,tick:!0,hide:!1,allowDuplicatedCategory:!0});const $t=ye(function(e){return e&&e.length?e[0]:void 0});var It=["key"];function Ft(e){return(Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qt(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function Bt(){return Bt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Bt.apply(this,arguments)}function Dt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function zt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Dt(Object(r),!0).forEach(function(t){Kt(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Dt(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Ut(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Yt(n.key),n)}}function Wt(e,t,r){return t=Gt(t),function(e,t){if(t&&("object"===Ft(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Vt()?Reflect.construct(t,r||[],Gt(e).constructor):t.apply(e,r))}function Vt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Vt=function(){return!!e})()}function Gt(e){return(Gt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ht(e,t){return(Ht=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function Kt(e,t,r){return(t=Yt(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Yt(e){var t=function(e,t){if("object"!=Ft(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=Ft(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Ft(t)?t:t+""}var Qt=function(){function e(){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return Kt(t=Wt(this,e,[].concat(n)),"state",{isAnimationFinished:!1}),Kt(t,"handleAnimationEnd",function(){var e=t.props.onAnimationEnd;t.setState({isAnimationFinished:!0}),c(e)&&e()}),Kt(t,"handleAnimationStart",function(){var e=t.props.onAnimationStart;t.setState({isAnimationFinished:!1}),c(e)&&e()}),Kt(t,"handleMouseEnter",function(e){var r=t.props.onMouseEnter;r&&r(t.props,e)}),Kt(t,"handleMouseLeave",function(e){var r=t.props.onMouseLeave;r&&r(t.props,e)}),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ht(e,t)}(e,f.PureComponent),a=e,s=[{key:"getDerivedStateFromProps",value:function(e,t){return e.animationId!==t.prevAnimationId?{prevAnimationId:e.animationId,curPoints:e.points,prevPoints:t.curPoints}:e.points!==t.curPoints?{curPoints:e.points}:null}},{key:"renderDotItem",value:function(e,n){var a;if(r.isValidElement(e))a=r.cloneElement(e,n);else if(c(e))a=e(n);else{var o=n.key,s=qt(n,It);a=r.createElement(g,Bt({},s,{key:o,className:t("recharts-radar-dot","boolean"!=typeof e?e.className:"")}))}return a}}],(o=[{key:"renderDots",value:function(t){var a=this.props,o=a.dot,s=a.dataKey,i=n(this.props,!1),l=n(o,!0),c=t.map(function(t,r){var n=zt(zt(zt({key:"dot-".concat(r),r:3},i),l),{},{dataKey:s,cx:t.x,cy:t.y,index:r,payload:t});return e.renderDotItem(o,n)});return r.createElement(d,{className:"recharts-radar-dots"},c)}},{key:"renderPolygonStatically",value:function(e){var t,a=this.props,o=a.shape,s=a.dot,i=a.isRange,l=a.baseLinePoints,u=a.connectNulls;return t=r.isValidElement(o)?r.cloneElement(o,zt(zt({},this.props),{},{points:e})):c(o)?o(zt(zt({},this.props),{},{points:e})):r.createElement(qe,Bt({},n(this.props,!0),{onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,points:e,baseLinePoints:i?l:null,connectNulls:u})),r.createElement(d,{className:"recharts-radar-polygon"},t,s?this.renderDots(e):null)}},{key:"renderPolygonWithAnimation",value:function(){var e=this,t=this.props,n=t.points,a=t.isAnimationActive,o=t.animationBegin,s=t.animationDuration,i=t.animationEasing,l=t.animationId,c=this.state.prevPoints;return r.createElement(b,{begin:o,duration:s,isActive:a,easing:i,from:{t:0},to:{t:1},key:"radar-".concat(l),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(t){var r=t.t,a=c&&c.length/n.length,o=n.map(function(e,t){var n=c&&c[Math.floor(t*a)];if(n){var o=y(n.x,e.x),s=y(n.y,e.y);return zt(zt({},e),{},{x:o(r),y:s(r)})}var i=y(e.cx,e.x),l=y(e.cy,e.y);return zt(zt({},e),{},{x:i(r),y:l(r)})});return e.renderPolygonStatically(o)})}},{key:"renderPolygon",value:function(){var e=this.props,t=e.points,r=e.isAnimationActive,n=e.isRange,a=this.state.prevPoints;return!(r&&t&&t.length)||n||a&&x(a,t)?this.renderPolygonStatically(t):this.renderPolygonWithAnimation()}},{key:"render",value:function(){var e=this.props,n=e.hide,a=e.className,o=e.points,s=e.isAnimationActive;if(n||!o||!o.length)return null;var i=this.state.isAnimationFinished,l=t("recharts-radar",a);return r.createElement(d,{className:l},this.renderPolygon(),(!s||i)&&v.renderCallByParent(this.props,o))}}])&&Ut(a.prototype,o),s&&Ut(a,s),Object.defineProperty(a,"prototype",{writable:!1}),a;var a,o,s}();Kt(Qt,"displayName","Radar"),Kt(Qt,"defaultProps",{angleAxisId:0,radiusAxisId:0,hide:!1,activeDot:!0,dot:!1,legendType:"rect",isAnimationActive:!j.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"}),Kt(Qt,"getComposedData",function(e){var t=e.radiusAxis,r=e.angleAxis,n=e.displayedData,o=e.dataKey,s=e.bandSize,i=r.cx,l=r.cy,c=!1,u=[],d="number"!==r.type&&null!=s?s:0;n.forEach(function(e,n){var s=k(e,r.dataKey,n),m=k(e,o),p=r.scale(s)+d,h=Array.isArray(m)?w(m):m,f=N(h)?void 0:t.scale(h);Array.isArray(m)&&m.length>=2&&(c=!0),u.push(zt(zt({},a(i,l,f,p)),{},{name:s,value:m,cx:i,cy:l,radius:f,angle:p,payload:e}))});var m=[];return c&&u.forEach(function(e){if(Array.isArray(e.value)){var r=$t(e.value),n=N(r)?void 0:t.scale(r);m.push(zt(zt({},e),{},{radius:n},a(i,l,n,e.angle)))}else m.push(e)}),{points:u,isRange:c,baseLinePoints:m}});var Zt=P({chartName:"RadarChart",GraphicalChild:Qt,axisComponents:[{axisType:"angleAxis",AxisComp:Lt},{axisType:"radiusAxis",AxisComp:jt}],formatAxisMap:C,defaultProps:{layout:"centric",startAngle:90,endAngle:-270,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});const Jt=({score:e,label:t="Score",subLabel:r,size:n=120,strokeWidth:a=8,color:o="#3b82f6"})=>{const s=(n-a)/2,i=2*s*Math.PI,l=i-e/100*i;return S.jsxs("div",{className:"relative flex flex-col items-center justify-center",style:{width:n,height:n},children:[S.jsxs("svg",{width:n,height:n,className:"transform -rotate-90",children:[S.jsx("circle",{cx:n/2,cy:n/2,r:s,stroke:"currentColor",strokeWidth:a,fill:"transparent",className:"text-slate-100 dark:text-slate-800"}),S.jsx("circle",{cx:n/2,cy:n/2,r:s,stroke:o,strokeWidth:a,fill:"transparent",strokeDasharray:i,strokeDashoffset:l,strokeLinecap:"round",className:"transition-all duration-1000 ease-out"})]}),S.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-center",children:[S.jsxs("span",{className:"text-2xl font-bold",style:{color:o},children:[e,"%"]}),t&&S.jsx("span",{className:"text-xs text-slate-500 font-medium uppercase tracking-wider",children:t}),r&&S.jsx("span",{className:"text-[10px] text-slate-400",children:r})]})]})},Xt=({metrics:e,width:t=300,height:r=250})=>{const n=[{subject:"Pronunciation",A:e.pronunciation,fullMark:100},{subject:"Intonation",A:e.intonation,fullMark:100},{subject:"Stress",A:e.stress,fullMark:100},{subject:"Rhythm",A:e.rhythm,fullMark:100}];return S.jsx("div",{className:"w-full flex justify-center",children:S.jsx("div",{style:{width:"100%",height:r,maxWidth:t},children:S.jsx(_,{width:"100%",height:"100%",children:S.jsxs(Zt,{cx:"50%",cy:"50%",outerRadius:"70%",data:n,children:[S.jsx(Je,{stroke:"#e2e8f0"}),S.jsx(Lt,{dataKey:"subject",tick:{fill:"#64748b",fontSize:11,fontWeight:600}}),S.jsx(jt,{angle:30,domain:[0,100],tick:!1,axisLine:!1}),S.jsx(Qt,{name:"Metrics",dataKey:"A",stroke:"#3b82f6",strokeWidth:2,fill:"#3b82f6",fillOpacity:.2})]})})})})};f.createContext(null);const er=({active:e=!1,processing:t=!1,deviceId:r,barWidth:n=3,barGap:a=1,barRadius:o=1.5,barColor:s,fadeEdges:i=!0,fadeWidth:l=24,height:c=64,sensitivity:u=1,smoothingTimeConstant:d=.8,fftSize:m=256,historySize:p=60,updateRate:h=30,mode:g="static",onError:b,onStreamReady:y,onStreamEnd:x,className:v,...j})=>{const k=f.useRef(null),w=f.useRef(null),N=f.useRef([]),P=f.useRef(null),C=f.useRef(null),_=f.useRef(null),E=f.useRef(0),T=f.useRef(0),A=f.useRef(null),M=f.useRef([]),R=f.useRef(0),L=f.useRef([]),$=f.useRef(!0),I=f.useRef(null),F=f.useRef(0),q="number"==typeof c?`${c}px`:c;return f.useEffect(()=>{const e=k.current,t=w.current;if(!e||!t)return;const r=new ResizeObserver(()=>{const r=t.getBoundingClientRect(),n=window.devicePixelRatio||1;e.width=r.width*n,e.height=r.height*n,e.style.width=`${r.width}px`,e.style.height=`${r.height}px`;const a=e.getContext("2d");a&&a.scale(n,n),I.current=null,F.current=r.width,$.current=!0});return r.observe(t),()=>r.disconnect()},[]),f.useEffect(()=>{if(t&&!e){let e=0;R.current=0;const t=()=>{var r;e+=.03,R.current=Math.min(1,R.current+.02);const o=[],s=Math.floor(((null==(r=w.current)?void 0:r.getBoundingClientRect().width)||200)/(n+a));if("static"===g){const t=Math.floor(s/2);for(let r=0;r<s;r++){const n=(r-t)/t,a=1-.4*Math.abs(n),s=(.2+(.25*Math.sin(1.5*e+3*n)+.2*Math.sin(.8*e-2*n)+.15*Math.cos(2*e+n)))*a;let i=s;if(M.current.length>0&&R.current<1){const e=Math.min(r,M.current.length-1);i=(M.current[e]||0)*(1-R.current)+s*R.current}o.push(Math.max(.05,Math.min(1,i)))}}else for(let t=0;t<s;t++){const r=(t-s/2)/(s/2),n=1-.4*Math.abs(r),a=(.2+(.25*Math.sin(1.5*e+.15*t)+.2*Math.sin(.8*e-.1*t)+.15*Math.cos(2*e+.05*t)))*n;let i=a;if(M.current.length>0&&R.current<1){const e=Math.floor(t/s*M.current.length);i=(M.current[e]||0)*(1-R.current)+a*R.current}o.push(Math.max(.05,Math.min(1,i)))}"static"===g?L.current=o:N.current=o,$.current=!0,A.current=requestAnimationFrame(t)};return t(),()=>{A.current&&cancelAnimationFrame(A.current)}}if(!e&&!t){if("static"===g?L.current.length>0:N.current.length>0){let e=0;const t=()=>{e+=.03,e<1?("static"===g?L.current=L.current.map(t=>t*(1-e)):N.current=N.current.map(t=>t*(1-e)),$.current=!0,requestAnimationFrame(t)):"static"===g?L.current=[]:N.current=[]};t()}}},[t,e,n,a,g]),f.useEffect(()=>{if(!e)return _.current&&(_.current.getTracks().forEach(e=>e.stop()),_.current=null,null==x||x()),C.current&&"closed"!==C.current.state&&(C.current.close(),C.current=null),void(E.current&&(cancelAnimationFrame(E.current),E.current=0));return(async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:r?{deviceId:{exact:r},echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});_.current=e,null==y||y(e);const t=new(window.AudioContext||window.webkitAudioContext),n=t.createAnalyser();n.fftSize=m,n.smoothingTimeConstant=d;t.createMediaStreamSource(e).connect(n),C.current=t,P.current=n,N.current=[]}catch(e){null==b||b(e)}})(),()=>{_.current&&(_.current.getTracks().forEach(e=>e.stop()),_.current=null,null==x||x()),C.current&&"closed"!==C.current.state&&(C.current.close(),C.current=null),E.current&&(cancelAnimationFrame(E.current),E.current=0)}},[e,r,m,d,b,y,x]),f.useEffect(()=>{const r=k.current;if(!r)return;const c=r.getContext("2d");if(!c)return;let d;const m=f=>{const b=r.getBoundingClientRect();if(e&&f-T.current>h&&(T.current=f,P.current)){const e=new Uint8Array(P.current.frequencyBinCount);if(P.current.getByteFrequencyData(e),"static"===g){const t=Math.floor(.05*e.length),r=Math.floor(.4*e.length),o=e.slice(t,r),s=Math.floor(b.width/(n+a)),i=Math.floor(s/2),l=[];for(let e=i-1;e>=0;e--){const t=Math.floor(e/i*o.length),r=Math.min(1,o[t]/255*u);l.push(Math.max(.05,r))}for(let e=0;e<i;e++){const t=Math.floor(e/i*o.length),r=Math.min(1,o[t]/255*u);l.push(Math.max(.05,r))}L.current=l,M.current=l}else{let t=0;const r=Math.floor(.05*e.length),n=Math.floor(.4*e.length),a=e.slice(r,n);for(let e=0;e<a.length;e++)t+=a[e];const o=t/a.length/255*u;N.current.push(Math.min(1,Math.max(.05,o))),M.current=[...N.current],N.current.length>p&&N.current.shift()}$.current=!0}if(!$.current&&!e)return void(d=requestAnimationFrame(m));$.current=e,c.clearRect(0,0,b.width,b.height);const y=s||getComputedStyle(r).color||"#000",x=n+a,v=Math.floor(b.width/x),j=b.height/2;if("static"===g){const r=t||e||L.current.length>0?L.current:[];for(let e=0;e<v&&e<r.length;e++){const t=r[e]||.1,a=e*x,s=Math.max(4,t*b.height*.8),i=j-s/2;c.fillStyle=y,c.globalAlpha=.4+.6*t,o>0?(c.beginPath(),c.roundRect(a,i,n,s,o),c.fill()):c.fillRect(a,i,n,s)}}else for(let e=0;e<v&&e<N.current.length;e++){const t=N.current.length-1-e,r=N.current[t]||.1,a=b.width-(e+1)*x,s=Math.max(4,r*b.height*.8),i=j-s/2;c.fillStyle=y,c.globalAlpha=.4+.6*r,o>0?(c.beginPath(),c.roundRect(a,i,n,s,o),c.fill()):c.fillRect(a,i,n,s)}if(i&&l>0&&b.width>0){if(!I.current||F.current!==b.width){const e=c.createLinearGradient(0,0,b.width,0),t=Math.min(.3,l/b.width);e.addColorStop(0,"rgba(255,255,255,1)"),e.addColorStop(t,"rgba(255,255,255,0)"),e.addColorStop(1-t,"rgba(255,255,255,0)"),e.addColorStop(1,"rgba(255,255,255,1)"),I.current=e,F.current=b.width}c.globalCompositeOperation="destination-out",c.fillStyle=I.current,c.fillRect(0,0,b.width,b.height),c.globalCompositeOperation="source-over"}c.globalAlpha=1,d=requestAnimationFrame(m)};return d=requestAnimationFrame(m),()=>{d&&cancelAnimationFrame(d)}},[e,t,u,h,p,n,a,o,s,i,l,g]),S.jsxs("div",{className:O("relative h-full w-full",v),ref:w,style:{height:q},"aria-label":e?"Live audio waveform":t?"Processing audio":"Audio waveform idle",role:"img",...j,children:[!e&&!t&&S.jsx("div",{className:"border-muted-foreground/20 absolute top-1/2 right-0 left-0 -translate-y-1/2 border-t-2 border-dotted"}),S.jsx("canvas",{className:"block h-full w-full",ref:k,"aria-hidden":"true"})]})},tr=()=>{var e,t,r,n,a;const o=E(),s=o.testId||o.testName,i=T(),{profile:l}=A(),{toast:c}=M(),u=R(),[d,m]=f.useState(null),[p,h]=f.useState([]),[g,b]=f.useState(1),[y,x]=f.useState(0),[v,j]=f.useState(!0),[k,w]=f.useState(!1),[N,P]=f.useState(!1),[C,_]=f.useState(!1),[O,ye]=f.useState(null),[Ae,Me]=f.useState(null),[Re,Le]=f.useState(0),[$e,Ie]=f.useState(60),[Fe,qe]=f.useState({}),[Be,De]=f.useState("");f.useState(!1),f.useState("");const[ze,Ue]=f.useState(!1),[We,Ve]=f.useState("en");f.useEffect(()=>{(async()=>{if(null==l?void 0:l.id)try{const{data:e}=await xe.from("user_preferences").select("preferred_feedback_language, native_language").eq("user_id",l.id).maybeSingle(),t=e,r=(null==t?void 0:t.preferred_feedback_language)||(null==t?void 0:t.native_language);r&&Oe.find(e=>e.value===r)&&Ve(r)}catch(e){console.warn("Error loading user preferred language:",e)}})()},[null==l?void 0:l.id]);const[Ge,He]=f.useState(!1),[Ke,Ye]=f.useState(!1),[Qe,Ze]=f.useState(!1),[Je,Xe]=f.useState(!1),[et,tt]=f.useState(!1),[rt,nt]=f.useState([{id:"1",type:"bot",content:"Hello! I'm Catie, your expert IELTS Speaking tutor. I'm here to guide you through strategic speaking techniques, structure, and vocabulary enhancement. What specific aspect of your speaking would you like to work on?",timestamp:new Date}]),[at,ot]=f.useState(""),[st,it]=f.useState(!1),[lt,ct]=f.useState(!1),[ut,dt]=f.useState(null),[mt,pt]=f.useState(!1),ht=f.useRef(null),ft=f.useRef(null),gt=f.useRef(null),bt=f.useRef([]),yt=f.useRef(null),xt=f.useRef(null),vt=(()=>{try{const e="undefined"!=typeof window?window.localStorage.getItem("appAudioVolume"):null,t=(e?parseInt(e,10):100)/100;return Number.isFinite(t)?Math.min(1,Math.max(0,t)):1}catch{return 1}})(),jt=f.useRef(vt);f.useEffect(()=>(s?(kt(),nt([{id:"1",type:"bot",content:"Hello! I'm Catie, your expert IELTS Speaking tutor. I'm here to guide you through strategic speaking techniques, structure, and vocabulary enhancement. What specific aspect of your speaking would you like to work on?",timestamp:new Date}])):wt(),()=>{gt.current&&clearInterval(gt.current)}),[s]),f.useEffect(()=>(Re>0?gt.current=setTimeout(()=>Le(Re-1),1e3):0===Re&&k&&Pt(),()=>{gt.current&&clearTimeout(gt.current)}),[Re,k]),f.useEffect(()=>{const e=e=>{var t;const r=null==(t=null==e?void 0:e.detail)?void 0:t.volume;"number"==typeof r&&(jt.current=r,ft.current&&(ft.current.volume=r))};return window.addEventListener("app:volume-change",e),()=>window.removeEventListener("app:volume-change",e)},[]),f.useEffect(()=>{rt.length>0&&setTimeout(()=>{const e=document.querySelector("[data-conversation-content]");e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},100)},[rt]),f.useEffect(()=>{Ze(!1),pt(!1)},[y,g]),f.useEffect(()=>{var e,t,r,n,a;if(d&&!v){let o=!0;if(1===g){const t=(null==(e=d.part1_prompts)?void 0:e.length)||0;(y>=t||y<0)&&(console.warn("‚ö†Ô∏è Invalid Part 1 state detected, resetting..."),o=!1)}else if(2===g){if(!d.part2_prompt)return console.warn("‚ö†Ô∏è Part 2 accessed but no Part 2 prompt available, going to Part 3 or completion..."),(null==(t=d.part3_prompts)?void 0:t.length)>0?(b(3),void x(0)):void Ue(!0)}else if(3===g){const e=(null==(r=d.part3_prompts)?void 0:r.length)||0;(y>=e||y<0)&&(console.warn("‚ö†Ô∏è Invalid Part 3 state detected, resetting..."),o=!1)}o||((null==(n=d.part1_prompts)?void 0:n.length)>0?(b(1),x(0)):d.part2_prompt?(b(2),x(0)):(null==(a=d.part3_prompts)?void 0:a.length)>0?(b(3),x(0)):(console.error("‚ùå No valid test parts available"),i("/ielts-portal")))}},[d,g,y,v,i]),f.useEffect(()=>{if(yt.current){const e=yt.current;e.style.setProperty("transform","scale(1)","important"),e.style.setProperty("transition","none","important");const t=t=>{e.style.setProperty("transform","scale(1)","important"),e.style.setProperty("box-shadow","0 8px 32px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.1)","important"),e.style.setProperty("transition","none","important")};return e.addEventListener("mouseenter",t),e.addEventListener("mouseleave",t),()=>{e.removeEventListener("mouseenter",t),e.removeEventListener("mouseleave",t)}}},[d,g,y]);const kt=async()=>{if(s){j(!0);try{console.log(`üîç Loading speaking test data for test ID: ${s}`);const e=s.includes("-")&&36===s.length,[t,r]=await Promise.all([e?xe.from("tests").select("id, test_name").eq("id",s).single():xe.from("tests").select("id, test_name").eq("test_name",s).eq("test_type","IELTS").eq("module","Speaking").maybeSingle(),xe.from("speaking_prompts").select("*").eq("test_id",s).order("part_number",{ascending:!0})]);if(t.error)throw t.error;const n=t.data;if(!n)return c({title:"Test Not Found",description:"This speaking test doesn't exist. Please check the test ID.",variant:"destructive"}),void i(-1);console.log("‚úÖ Test loaded:",n.test_name);let a=r.data||[];if(0===a.length&&n.id!==s){const{data:e}=await xe.from("speaking_prompts").select("*").eq("test_id",n.id).order("part_number",{ascending:!0});a=e||[]}console.log(`üìù Loaded ${a.length} total speaking prompts`);const o=[];let l=null;const u=[];a.forEach(e=>{1===e.part_number?o.push(e):2===e.part_number?l=e:3===e.part_number&&u.push(e)}),m({id:n.id,test_name:n.test_name,part1_prompts:o,part2_prompt:l,part3_prompts:u}),console.log(`‚úÖ Test ready: Part 1 (${o.length}), Part 2 (${l?1:0}), Part 3 (${u.length})`)}catch(e){console.error("‚ùå Error:",e),s&&m({id:s,test_name:"Speaking Test",part1_prompts:[],part2_prompt:null,part3_prompts:[]})}finally{j(!1)}}},wt=async()=>{j(!0);try{console.log("üìã Loading available speaking tests...");const{data:e,error:t}=await xe.from("tests").select("id, test_name, module, skill_category, created_at, speaking_prompts!inner(id)").eq("test_type","IELTS").order("created_at",{ascending:!1}).limit(50);if(t)throw console.error("‚ùå Error loading tests:",t),t;const r=(e||[]).filter(e=>{const t=(e.test_name||"").trim();return t&&t.length>=2&&!t.toLowerCase().includes("quick test")&&!["test ?","another test?",""].includes(t.toLowerCase())});console.log(`‚úÖ Found ${r.length} valid speaking tests`),h(r)}catch(e){console.error("‚ùå Error loading tests:",e),c({title:"Error",description:"Failed to load available speaking tests",variant:"destructive"}),h([])}finally{j(!1)}},Nt=()=>{try{const e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),r=e.createOscillator(),n=e.createGain();t.type="sine",t.frequency.value=523,r.type="sine",r.frequency.value=659,t.connect(n),r.connect(n),n.connect(e.destination),n.gain.setValueAtTime(1e-4,e.currentTime),n.gain.exponentialRampToValueAtTime(.05,e.currentTime+.01),t.start(),r.start(),setTimeout(()=>{n.gain.exponentialRampToValueAtTime(1e-5,e.currentTime+.15),setTimeout(()=>{t.stop(),r.stop(),e.close()},200)},120)}catch{}},Pt=()=>{if(2===g&&xt.current){const e=Math.floor((Date.now()-xt.current)/1e3),t=60;if(e<t){const r=t-e;return void c({title:"Minimum Recording Time Required",description:`For IELTS Part 2, you should speak for at least 1 minute to receive a good score. Please continue recording for ${r} more second${1!==r?"s":""}.`,variant:"destructive",duration:5e3})}}Nt(),ht.current&&k&&(ht.current.stop(),Le(0),xt.current=null)},Ct=()=>{var e,t,r,n;try{if(console.log(`üîÑ Navigation attempt: Part ${g}, Question ${y}`,{testDataExists:!!d,part1Prompts:(null==(e=null==d?void 0:d.part1_prompts)?void 0:e.length)||0,part2Prompt:!!(null==d?void 0:d.part2_prompt),part3Prompts:(null==(t=null==d?void 0:d.part3_prompts)?void 0:t.length)||0}),!d)return console.error("‚ùå Navigation failed: No test data available"),void c({title:"Navigation Error",description:"Test data not available. Please refresh the page.",variant:"destructive"});if(1===g){const e=(null==(r=d.part1_prompts)?void 0:r.length)||0;if(y<e-1){const e=y+1;x(e),Ze(!1),dt(null),pt(!1),console.log(`‚û°Ô∏è Moving to Part 1, Question ${e+1}`)}else{const e=!!d.part2_prompt,t=!!(d.part3_prompts&&d.part3_prompts.length>0);e||t?e?(b(2),x(0),Ie(60),Ze(!1),dt(null),pt(!1),console.log("‚û°Ô∏è Moving to Part 2 - Long Turn"),St()):t&&(b(3),x(0),Ze(!1),dt(null),pt(!1),console.log("‚û°Ô∏è Moving to Part 3 - Discussion (no Part 2 for this test)")):(console.log("üèÅ Part 1-only test completed - prompting for feedback language"),Ue(!0))}}else if(2===g){d.part3_prompts&&d.part3_prompts.length>0?(b(3),x(0),Ze(!1),dt(null),pt(!1),console.log("‚û°Ô∏è Moving to Part 3 - Discussion")):(console.log("üèÅ Part 2 completed - no Part 3 available, prompting for feedback language"),Ue(!0))}else if(3===g){const e=(null==(n=d.part3_prompts)?void 0:n.length)||0;if(y<e-1){const e=y+1;x(e),Ze(!1),dt(null),pt(!1),console.log(`‚û°Ô∏è Moving to Part 3, Question ${e+1}`)}else console.log("üèÅ Last question completed - prompting for feedback language"),Ue(!0)}}catch(a){console.error("‚ùå Navigation error:",a),c({title:"Navigation Error",description:"Failed to navigate. Please try again.",variant:"destructive"})}},St=()=>{const e=setInterval(()=>{Ie(t=>t<=1?(clearInterval(e),c({title:"Preparation Time Complete",description:"You may now start recording your response.",duration:5e3}),0):t-1)},1e3)},_t=e=>`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`;if(v)return S.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:"dark"===u.theme.name?u.theme.colors.background:"transparent"},children:S.jsx(L,{size:"lg",message:"Loading speaking tests..."})});if(!s)return S.jsxs("div",{className:"min-h-screen relative",style:{backgroundColor:"dark"===u.theme.name?u.theme.colors.background:"transparent"},children:[S.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"note"===u.theme.name||"minimalist"===u.theme.name||"dark"===u.theme.name?"none":"url('/1000031207.png')",backgroundColor:u.backgroundImageColor}}),S.jsx("div",{className:"relative z-10",children:S.jsx($,{title:"Available Speaking Tests",children:S.jsx("div",{className:"min-h-screen py-12",children:S.jsx("div",{className:"container mx-auto px-4",children:S.jsxs("div",{className:"max-w-4xl mx-auto",children:[S.jsx("div",{className:"mb-8 text-center",children:S.jsx("h1",{className:"text-4xl font-bold mb-2",style:{color:u.textPrimary},children:"IELTS speaking tests"})}),p.length>0?S.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:p.map(e=>S.jsx(I,{className:"cursor-pointer h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg flex items-center justify-center",onClick:()=>i(`/ielts-speaking-test/${e.id}`),style:{backgroundColor:"glassmorphism"===u.theme.name?"rgba(255,255,255,0.8)":"dark"===u.theme.name?"rgba(255,255,255,0.1)":"minimalist"===u.theme.name?"#ffffff":u.theme.colors.cardBackground,borderColor:u.border,...u.cardStyle},children:S.jsx(F,{className:"p-3 md:p-4 text-center flex items-center justify-center h-full",children:S.jsx("h3",{className:"font-semibold text-sm",style:{color:u.textPrimary},children:e.test_name})})},e.id))}):S.jsxs("div",{className:"text-center py-12",children:[S.jsx("p",{className:"text-lg mb-4",style:{color:u.textSecondary},children:"No speaking tests available yet"}),S.jsx(q,{onClick:()=>i("/ielts-portal"),variant:"outline",style:{borderColor:u.border,color:u.textPrimary,backgroundColor:"glassmorphism"===u.theme.name||"dark"===u.theme.name?"rgba(255,255,255,0.1)":"minimalist"===u.theme.name?"#ffffff":u.theme.colors.cardBackground},onMouseEnter:e=>e.currentTarget.style.backgroundColor=u.hoverBg,onMouseLeave:e=>e.currentTarget.style.backgroundColor="glassmorphism"===u.theme.name||"dark"===u.theme.name?"rgba(255,255,255,0.1)":"minimalist"===u.theme.name?"#ffffff":u.theme.colors.cardBackground,children:"Back to Portal"})]})]})})})})})]});if(!d)return S.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:S.jsxs("div",{className:"text-center",children:[S.jsx("p",{className:"text-lg text-muted-foreground",children:"Test not found"}),S.jsx(q,{onClick:()=>i("/ielts-portal"),className:"mt-4",children:"Back to Portal"})]})});if(0===d.part1_prompts.length&&!d.part2_prompt&&0===d.part3_prompts.length)return S.jsx($,{title:`IELTS Speaking - ${d.test_name}`,showBackButton:!0,children:S.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[S.jsxs("div",{className:"text-center",children:[S.jsx(B,{variant:"outline",className:"mb-4 px-4 py-1 text-primary border-primary/20",children:"IELTS SPEAKING TEST"}),S.jsx("h1",{className:"text-heading-2 mb-2",children:d.test_name})]}),S.jsx(D,{className:"card-modern",children:S.jsxs(F,{className:"p-8 text-center",children:[S.jsx(z,{className:"w-16 h-16 mx-auto mb-4 text-gray-400 dark:text-gray-500"}),S.jsx("h2",{className:"text-xl font-semibold mb-2",children:"No Speaking Content Available"}),S.jsx("p",{className:"text-muted-foreground mb-6",children:"This test doesn't have speaking content created yet. Please contact your administrator or try another test."}),S.jsxs("div",{className:"flex gap-4 justify-center",children:[S.jsx(q,{onClick:()=>i("/ielts-portal"),variant:"outline",children:"Back to Portal"}),S.jsx(q,{onClick:()=>i("/speaking"),children:"Try General Speaking Practice"})]})]})})]})});const Ot=()=>1===g?d.part1_prompts[y]:2===g?d.part2_prompt:3===g?d.part3_prompts[y]:null,Et=()=>{const e=Ot();return e?2===g?e.prompt_text||"":e.transcription||e.title||"":""},Tt=async e=>{const t=e||at.trim();if(!t||st)return;const r={id:Date.now().toString(),type:"user",content:t,timestamp:new Date};nt(e=>[...e,r]),e||ot(""),it(!0);try{const e=Et(),r=`CONTEXT: The student is practicing IELTS Speaking Part ${g}.\n\nQuestion: "${e}"\n\nPlease provide concise, practical speaking guidance (ideas, vocabulary, structure). Do NOT write a full answer.`,n=rt.filter(e=>"user"===e.type||"bot"===e.type).map(e=>({role:"user"===e.type?"user":"assistant",content:e.content}));n.push({role:"user",content:t});const{data:a,error:o}=await xe.functions.invoke("openai-chat",{body:{skipCache:!0,messages:[{role:"system",content:r},...n],context:"catbot"}});if(o)throw o;const s={id:(Date.now()+1).toString(),type:"bot",content:a.response,timestamp:new Date};nt(e=>[...e,s])}catch(n){console.error("Error sending chat message:",n),c({title:"Error",description:"Failed to get response from Catie",variant:"destructive"})}finally{it(!1)}},At=e=>{Tt(e)},Mt=Ot(),Rt=Et(),Lt=1===g?"Part 1":2===g?"Part 2":3===g?"Part 3":"Unknown Part";return S.jsxs("div",{className:"min-h-screen relative",style:{backgroundColor:"dark"===u.theme.name?u.theme.colors.background:"transparent"},children:[S.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"note"===u.theme.name||"minimalist"===u.theme.name||"dark"===u.theme.name?"none":"url('/1000031207.png')",backgroundColor:u.backgroundImageColor}}),S.jsx("div",{className:"relative z-10 min-h-screen flex flex-col",style:{backgroundColor:"dark"===u.theme.name?u.theme.colors.background:"transparent"},children:S.jsx($,{title:`IELTS Speaking - ${d.test_name}`,showBackButton:!0,children:S.jsx("div",{className:"flex-1 flex justify-center min-h-[calc(100vh-120px)] py-8 sm:items-center sm:py-8",children:S.jsxs("div",{className:"w-full max-w-4xl mx-auto space-y-4 px-4 flex flex-col",children:[S.jsx("div",{className:"text-center py-2 sm:py-2 sm:mb-0 mb-0",children:S.jsxs("span",{className:"text-lg font-semibold",style:{color:u.textPrimary},children:["Part ",g]})}),S.jsxs(D,{ref:yt,className:"backdrop-blur-sm shadow-lg rounded-2xl flex flex-col relative",style:{backgroundColor:"glassmorphism"===u.theme.name?"rgba(255,255,255,0.9)":"dark"===u.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===u.theme.name?"#ffffff":u.theme.colors.cardBackground,borderColor:u.border,backdropFilter:"glassmorphism"===u.theme.name?"blur(12px)":"dark"===u.theme.name?"blur(8px)":"none",boxShadow:"dark"===u.theme.name?"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)":"note"===u.theme.name?null==(e=u.theme.styles.cardStyle)?void 0:e.boxShadow:"0 8px 32px rgba(15, 23, 42, 0.16), 0 0 0 1px rgba(148, 163, 253, 0.06)",...u.cardStyle},children:[S.jsx(U,{children:S.jsxs(W,{className:"flex items-center justify-between",children:[S.jsx("span",{}),S.jsxs("div",{className:"flex items-center gap-3",children:[(1===g||3===g)&&S.jsx(V,{children:S.jsxs(G,{children:[S.jsx(H,{asChild:!0,children:S.jsx("div",{onClick:()=>Ze(!Qe),className:"relative inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background",style:{backgroundColor:Qe?u.buttonPrimary:"glassmorphism"===u.theme.name?"rgba(255,255,255,0.2)":"dark"===u.theme.name?"rgba(255,255,255,0.1)":"minimalist"===u.theme.name?"#e5e7eb":u.border},"data-state":Qe?"checked":"unchecked",children:S.jsx("div",{className:"pointer-events-none flex h-5 w-5 rounded-full shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0 items-center justify-center",style:{backgroundColor:"glassmorphism"===u.theme.name?"rgba(255,255,255,0.95)":"dark"===u.theme.name?"rgba(255,255,255,0.9)":"minimalist"===u.theme.name?"#ffffff":u.theme.colors.cardBackground},"data-state":Qe?"checked":"unchecked",children:Qe?S.jsx(K,{className:"w-3 h-3",style:{color:"white"}}):S.jsx(Y,{className:"w-3 h-3",style:{color:u.textSecondary}})})})}),S.jsx(Q,{children:S.jsx("p",{children:Qe?"Hide question":"Show question"})})]})}),Re>0&&S.jsxs(B,{variant:"outline",className:"flex items-center gap-2",style:{borderColor:u.border,backgroundColor:"glassmorphism"===u.theme.name?"rgba(255,255,255,0.1)":"dark"===u.theme.name?"rgba(255,255,255,0.05)":"minimalist"===u.theme.name?"#ffffff":u.theme.colors.cardBackground,color:u.textPrimary},children:[S.jsx(Z,{className:"w-4 h-4",style:{color:u.textPrimary}}),_t(Re)]})]})]})}),S.jsxs(F,{className:"space-y-4 flex flex-col relative",children:[2===g&&$e>0&&S.jsx("div",{className:"text-center",children:S.jsxs("div",{className:"flex items-center justify-center gap-2",children:[S.jsx(Z,{className:"w-5 h-5",style:{color:u.buttonPrimary}}),S.jsx("p",{className:"text-xl font-bold",style:{color:u.buttonPrimary},children:_t($e)})]})}),1===g&&d.part1_prompts.length>0&&S.jsx("div",{className:"space-y-6 relative flex flex-col min-h-[200px]",children:S.jsx("div",{className:"min-h-[200px] flex items-center justify-center flex-1",children:Qe&&S.jsx("div",{className:"text-lg font-medium text-center select-none",style:{color:u.textPrimary},children:Et()})})}),3===g&&d.part3_prompts.length>0&&S.jsx("div",{className:"space-y-6 relative flex flex-col min-h-[200px]",children:S.jsx("div",{className:"min-h-[200px] flex items-center justify-center flex-1",children:Qe&&S.jsx("div",{className:"text-lg font-medium text-center select-none",style:{color:u.textPrimary},children:Et()})})}),2===g&&Mt&&S.jsxs("div",{className:"p-6 rounded-lg",style:{backgroundColor:"glassmorphism"===u.theme.name?"rgba(255,255,255,0.1)":"dark"===u.theme.name?"rgba(255,255,255,0.05)":"minimalist"===u.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:u.border,borderWidth:"1px",borderStyle:"solid"},children:[S.jsx("h3",{className:"font-semibold mb-3",style:{color:u.textPrimary},children:"Cue Card"}),S.jsx("div",{className:"whitespace-pre-wrap text-sm leading-relaxed",style:{color:u.textSecondary},children:Mt.prompt_text})]}),2===g&&S.jsxs(S.Fragment,{children:[$e>0&&S.jsxs("div",{className:"relative rounded-lg p-4",style:{backgroundColor:"glassmorphism"===u.theme.name?"rgba(255,255,255,0.1)":"dark"===u.theme.name?"rgba(255,255,255,0.05)":"minimalist"===u.theme.name?"#fef3c7":"#FEF9E7",borderColor:u.border,borderWidth:"1px",borderStyle:"solid"},children:[S.jsx(V,{children:S.jsxs(G,{children:[S.jsx(H,{asChild:!0,children:S.jsx(q,{variant:"ghost",size:"icon",onClick:()=>{Ie(e=>e+60)},className:"absolute top-2 right-2 h-8 w-8",style:{color:u.buttonPrimary},children:S.jsx(J,{className:"w-4 h-4"})})}),S.jsx(Q,{children:S.jsx("p",{children:"Add 1 minute for notes"})})]})}),S.jsx("textarea",{placeholder:"Write your preparation notes here...",value:Be,onChange:e=>De(e.target.value),className:"w-full h-32 p-3 bg-transparent resize-none focus:outline-none",style:{color:u.textPrimary}}),S.jsx("style",{dangerouslySetInnerHTML:{__html:`\n                      textarea[placeholder="Write your preparation notes here..."]::placeholder {\n                        color: ${u.textSecondary};\n                      }\n                    `}})]}),(0===$e||k)&&Be&&S.jsxs("div",{className:"relative rounded-lg p-4",style:{backgroundColor:"glassmorphism"===u.theme.name?"rgba(255,255,255,0.1)":"dark"===u.theme.name?"rgba(255,255,255,0.05)":"minimalist"===u.theme.name?"#fef3c7":"#FEF9E7",borderColor:u.border,borderWidth:"1px",borderStyle:"solid"},children:[!k&&S.jsx(V,{children:S.jsxs(G,{children:[S.jsx(H,{asChild:!0,children:S.jsx(q,{variant:"ghost",size:"icon",onClick:()=>{Ie(60),St()},className:"absolute top-2 right-2 h-8 w-8 text-primary",children:S.jsx(J,{className:"w-4 h-4"})})}),S.jsx(Q,{children:S.jsx("p",{children:"Add 1 minute for notes"})})]})}),S.jsx("div",{className:"p-3 text-sm whitespace-pre-wrap",style:{color:u.textPrimary},children:Be})]})]}),(2===g&&0===$e||2!==g)&&S.jsx("div",{className:"text-center min-h-[80px] flex items-center justify-center relative",children:k?S.jsxs(S.Fragment,{children:[S.jsx("div",{className:"absolute -top-5 left-1/2 -translate-x-1/2 w-[130px] sm:w-[180px]",children:S.jsx(er,{active:!0,height:55,barWidth:6,barGap:2,barRadius:3,mode:"static",fadeEdges:!1,barColor:"#2563eb",sensitivity:1.2,fftSize:256,historySize:60,updateRate:30})}),S.jsx(q,{onClick:Pt,variant:"outline",size:"icon",className:"rounded-xl h-8 w-8 absolute bottom-0 left-1/2 transform -translate-x-1/2",style:{borderColor:u.border,color:u.buttonPrimary,backgroundColor:"glassmorphism"===u.theme.name?"rgba(255,255,255,0.9)":"dark"===u.theme.name?"rgba(255,255,255,0.15)":"minimalist"===u.theme.name?"#ffffff":u.theme.colors.cardBackground||"#ffffff"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=u.hoverBg||"rgba(0,0,0,0.05)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===u.theme.name?"rgba(255,255,255,0.9)":"dark"===u.theme.name?"rgba(255,255,255,0.15)":"minimalist"===u.theme.name?"#ffffff":u.theme.colors.cardBackground||"#ffffff"},children:S.jsx(X,{className:"w-4 h-4",style:{color:u.buttonPrimary||"#2563eb"}})})]}):S.jsx(V,{children:S.jsxs("div",{className:"flex items-center justify-center gap-3",children:[S.jsxs(G,{children:[S.jsx(H,{asChild:!0,children:S.jsx(q,{onClick:async()=>{try{Nt(),await new Promise(e=>setTimeout(e,100));const e=await navigator.mediaDevices.getUserMedia({audio:!0});ht.current=new MediaRecorder(e),bt.current=[],ht.current.ondataavailable=e=>{e.data.size>0&&bt.current.push(e.data)},ht.current.onstop=()=>{const t=new Blob(bt.current,{type:"audio/webm"}),r=`part${g}_q${y}`;console.log(`üíæ Saving recording for ${r}, blob size: ${t.size}`),qe(e=>{const n={...e,[r]:t};return console.log("üì± Recordings updated:",Object.keys(n)),n}),w(!1),e.getTracks().forEach(e=>e.stop())},ht.current.start(),w(!0),xt.current=Date.now(),(1===g||3===g||2===g)&&Le(120)}catch(e){console.error("Error starting recording:",e),c({title:"Recording Error",description:"Failed to start recording. Please check microphone permissions.",variant:"destructive"})}},variant:"outline",className:"rounded-xl shadow-sm h-12 w-12",size:"icon",style:{backgroundColor:"glassmorphism"===u.theme.name?"rgba(255,255,255,0.8)":"dark"===u.theme.name?"rgba(255,255,255,0.1)":"minimalist"===u.theme.name?"#ffffff":u.theme.colors.cardBackground,borderColor:u.border,color:u.textPrimary},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=u.hoverBg,e.currentTarget.style.color=u.buttonPrimary},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===u.theme.name?"rgba(255,255,255,0.8)":"dark"===u.theme.name?"rgba(255,255,255,0.1)":"minimalist"===u.theme.name?"#ffffff":u.theme.colors.cardBackground,e.currentTarget.style.color=u.textPrimary},children:S.jsx(z,{className:"w-5 h-5"})})}),S.jsx(Q,{children:S.jsx("p",{children:"Start recording your answer"})})]}),(null==Mt?void 0:Mt.audio_url)&&S.jsxs(G,{children:[S.jsx(H,{asChild:!0,children:S.jsx(q,{onClick:()=>{const e=Ot();(null==e?void 0:e.audio_url)&&(console.log(`üîÅ Repeating audio for Part ${g}`),(async e=>{var t;if(e){Je||(Xe(!0),tt(!1));try{P(!0),ft.current&&(ft.current.pause(),ft.current.currentTime=0,ft.current=null);const t=new Audio(e);t.preload="auto",t.volume=jt.current,t.onended=()=>{P(!1),console.log("‚úÖ Audio playback completed"),ft.current=null},t.onerror=e=>{P(!1),console.error("Audio playback error:",e),ft.current=null,c({title:"Audio Error",description:"Failed to play audio prompt. The audio may be inaudible or unavailable.",variant:"destructive"})},t.onloadstart=()=>{console.log("Audio loading started")},t.oncanplay=()=>{console.log("Audio can play")},t.oncanplaythrough=()=>{console.log("Audio can play through")},ft.current=t,console.log(`‚ñ∂Ô∏è Playing audio: ${e}`),t.load(),await new Promise(e=>setTimeout(e,100));const r=t.play();void 0!==r&&(await r,console.log("Audio started playing successfully"))}catch(r){console.error("Error playing audio:",r),P(!1),"NotAllowedError"===r.name||(null==(t=r.message)?void 0:t.includes("user didn't interact"))?(Je||tt(!0),console.log("Autoplay blocked - user needs to interact first")):c({title:"Audio Error",description:"Failed to play audio prompt. The audio may be inaudible or unavailable. Please try again.",variant:"destructive"}),ft.current&&(ft.current=null)}}})(e.audio_url))},disabled:N,variant:"outline",size:"icon",className:"h-12 w-12 rounded-xl",style:{borderColor:u.border,color:u.buttonPrimary,backgroundColor:"transparent"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=u.hoverBg},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:N?S.jsx(ee,{className:"w-5 h-5"}):S.jsx(te,{className:"w-5 h-5"})})}),S.jsx(Q,{children:S.jsx("p",{children:N?"Pause question audio":"Play question audio"})})]}),Fe[`part${g}_q${y}`]&&S.jsxs(G,{children:[S.jsx(H,{asChild:!0,children:S.jsx(q,{onClick:()=>{pt(!mt),mt&&C&&(()=>{if(Ae)try{Ae.pause(),Ae.currentTime=0,console.log("üõë Stopped recording playback")}catch(e){console.error("Error stopping recording playback:",e)}_(!1),ye(null),Me(null)})()},variant:"outline",size:"icon",className:"h-12 w-12 rounded-xl",style:{borderColor:u.border,color:u.buttonPrimary,backgroundColor:mt?"dark"===u.theme.name?"rgba(59, 130, 246, 0.2)":"#eff6ff":"transparent"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=u.hoverBg},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=mt?"dark"===u.theme.name?"rgba(59, 130, 246, 0.2)":"#eff6ff":"transparent"},children:S.jsx(re,{className:"w-5 h-5"})})}),S.jsx(Q,{children:S.jsx("p",{children:mt?"Hide audio player":"Listen to your recorded answer"})})]}),(console.log("üîç DEBUG: Checking evaluate button condition",{currentPart:g,currentQuestion:y,key:`part${g}_q${y}`,hasRecording:!!Fe[`part${g}_q${y}`],allRecordingKeys:Object.keys(Fe),recordingValue:Fe[`part${g}_q${y}`]}),null),Fe[`part${g}_q${y}`]&&S.jsxs(G,{children:[S.jsx(H,{asChild:!0,children:S.jsx(q,{onClick:async()=>{var e,t;const r=`part${g}_q${y}`,n=Fe[r];if(console.log("üéØ EVALUATE: Current part:",g),console.log("üéØ EVALUATE: Current question:",y),console.log("üéØ EVALUATE: Recording key:",r),console.log("üéØ EVALUATE: Recording exists:",!!n),console.log("üéØ EVALUATE: Recording size:",null==n?void 0:n.size),console.log("üéØ EVALUATE: All recording keys:",Object.keys(Fe)),!n)return console.error("‚ùå No recording found for",r),void c({title:"No Recording Found",description:"Please record your answer first before evaluating.",variant:"destructive"});ct(!0),dt(null);try{const e=await new Promise((e,t)=>{const r=new FileReader;r.onloadend=()=>{const t=r.result;e(t.split(",")[1])},r.onerror=()=>t(new Error("Failed to read audio file")),r.readAsDataURL(n)}),t=Et();console.log("üì§ Sending to Edge Function:",{audioLength:e.length,prompt:t,recordingKey:r});const{data:a,error:o}=await xe.functions.invoke("ielts-speaking-evaluator",{body:{audio:e,prompt:t}});if(o){const e=o.message||"";if(e.includes("FunctionsFetchError")||e.includes("Failed to send a request"))throw new Error("AI evaluation service is currently unavailable. Please try again in a moment.");throw o}console.log("‚úÖ Evaluation received:",a),dt(a)}catch(a){console.error("Evaluation error:",a);let r="Could not evaluate the recording. Please try again.";(null==(e=null==a?void 0:a.message)?void 0:e.includes("unavailable"))||(null==(t=null==a?void 0:a.message)?void 0:t.includes("FunctionsFetchError"))?r="AI evaluation service is temporarily unavailable. Please try again in a few moments.":(null==a?void 0:a.message)&&(r=a.message),c({title:"Evaluation Failed",description:r,variant:"destructive",duration:6e3})}finally{ct(!1)}},disabled:lt,variant:"outline",size:"icon",className:"h-12 w-12 rounded-xl relative",style:{borderColor:u.border,color:u.buttonPrimary,backgroundColor:lt?"dark"===u.theme.name?"rgba(59, 130, 246, 0.2)":"#eff6ff":"transparent"},onMouseEnter:e=>{lt||(e.currentTarget.style.backgroundColor=u.hoverBg)},onMouseLeave:e=>{lt||(e.currentTarget.style.backgroundColor="transparent")},children:lt?S.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-current border-t-transparent"}):S.jsx(ne,{className:"w-5 h-5"})})}),S.jsx(Q,{children:S.jsx("p",{children:lt?"Evaluating your answer...":"Evaluate with AI"})})]})]})})}),mt&&Fe[`part${g}_q${y}`]&&!ut&&S.jsx("div",{className:"mt-4 p-4 rounded-xl border animate-in fade-in slide-in-from-top-4 duration-300",style:{borderColor:u.border,backgroundColor:"dark"===u.theme.name?"rgba(255,255,255,0.02)":"#ffffff"},children:S.jsxs("div",{className:"space-y-3",children:[S.jsxs("h4",{className:"font-medium flex items-center gap-2 text-sm uppercase tracking-wider opacity-80",style:{color:u.textPrimary},children:[S.jsx(re,{className:"w-4 h-4"}),"Your Recorded Answer"]}),S.jsx("div",{className:"p-3 rounded-xl border",style:{borderColor:u.border,backgroundColor:"dark"===u.theme.name?"rgba(0,0,0,0.2)":"transparent"},children:S.jsx(be,{src:URL.createObjectURL(Fe[`part${g}_q${y}`]),style:{backgroundColor:"transparent",border:"none",boxShadow:"none"}})}),S.jsx("div",{className:"flex justify-end",children:S.jsx(q,{variant:"ghost",size:"sm",onClick:()=>pt(!1),className:"h-8 px-3 text-xs",style:{color:u.textSecondary},children:"Hide Player"})})]})}),lt&&S.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm animate-in fade-in duration-300",children:S.jsxs("div",{className:"flex flex-col items-center gap-4 p-8 rounded-2xl",style:{backgroundColor:"dark"===u.theme.name?"rgba(30, 41, 59, 0.95)":"rgba(255, 255, 255, 0.95)",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},children:[S.jsx(L,{size:"lg",message:""}),S.jsx("p",{className:"text-lg font-medium",style:{color:u.textPrimary},children:"Catie is evaluating your answer..."}),S.jsx("p",{className:"text-sm",style:{color:u.textSecondary},children:"This may take a few seconds"})]})}),ut&&S.jsxs("div",{className:"mt-8 p-6 rounded-2xl border animate-in fade-in slide-in-from-top-4 duration-500 max-w-3xl mx-auto text-left shadow-lg relative overflow-hidden",style:{borderColor:u.border,backgroundColor:u.theme.colors.cardBackground||"#ffffff",color:u.textPrimary},children:[S.jsxs("div",{className:"flex items-center justify-between mb-6 relative z-10",children:[S.jsxs("div",{className:"flex items-center gap-3",children:[S.jsxs("div",{className:"relative",children:[S.jsx("img",{src:"/1000031289.png",alt:"Catie AI",className:"w-14 h-14 rounded-full shadow-md object-cover ring-2 ring-offset-2",style:{ringColor:u.buttonPrimary}}),S.jsx("div",{className:"absolute -bottom-1 -right-1 w-5 h-5 rounded-full flex items-center justify-center shadow-sm border-2 border-white",style:{backgroundColor:u.buttonPrimary},children:S.jsx(ne,{className:"w-2.5 h-2.5 text-white"})})]}),S.jsx("div",{children:S.jsx("h3",{className:"font-bold text-lg",style:{color:u.textPrimary},children:"Catie's Feedback"})})]}),S.jsx(q,{variant:"ghost",size:"sm",onClick:()=>dt(null),className:"h-8 w-8 p-0 opacity-60 hover:opacity-100",children:S.jsx(ae,{className:"w-4 h-4"})})]}),S.jsx("div",{className:"mb-6 space-y-4 relative z-10",children:S.jsxs("div",{className:"rounded-xl p-4 space-y-3 border",style:{backgroundColor:"dark"===u.theme.name?"rgba(255,255,255,0.02)":"#ffffff",borderColor:u.border},children:[S.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2 text-xs uppercase tracking-wider opacity-80",style:{color:u.textPrimary},children:[S.jsx(re,{className:"w-3.5 h-3.5"}),"Your Response"]}),Fe[`part${g}_q${y}`]?S.jsx("div",{className:"p-2 rounded-xl border",style:{borderColor:u.border,backgroundColor:"dark"===u.theme.name?"rgba(0,0,0,0.2)":"transparent"},children:S.jsx(be,{src:URL.createObjectURL(Fe[`part${g}_q${y}`]),style:{backgroundColor:"transparent",border:"none",boxShadow:"none"}})}):S.jsxs("div",{className:"text-xs italic p-3 rounded-lg border flex items-center gap-2",style:{borderColor:u.border,color:u.textSecondary},children:[S.jsx(Ee,{className:"w-4 h-4"}),"Audio recording not available"]}),S.jsx("div",{className:"mt-4",children:S.jsxs("div",{className:"rounded-xl p-4 border shadow-sm relative group",style:{backgroundColor:"dark"===u.theme.name?"rgba(0,0,0,0.2)":"#ffffff",borderColor:u.border},children:[S.jsx("div",{className:"absolute top-3 right-3 opacity-20 group-hover:opacity-50 transition-opacity",children:S.jsx(oe,{className:"w-4 h-4"})}),S.jsxs("p",{className:"text-sm leading-relaxed italic",style:{color:u.textPrimary},children:['"',ut.transcription,'"']})]})})]})}),S.jsx("div",{className:"mb-8",children:S.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 items-center",children:[S.jsx("div",{className:"flex flex-col items-center justify-center p-4 rounded-2xl border",style:{backgroundColor:"dark"===u.theme.name?"rgba(255,255,255,0.03)":"minimalist"===u.theme.name?"#ffffff":"rgba(255,255,255,0.5)",borderColor:u.border},children:S.jsx(Jt,{score:Math.round(Object.values(ut.metrics||{}).reduce((e,t)=>e+t,0)/(Object.keys(ut.metrics||{}).length||1)),label:"Overall",subLabel:"Speaking Score",size:160,color:u.buttonPrimary})}),S.jsx("div",{className:"flex flex-col items-center justify-center p-2 rounded-2xl border h-[200px]",style:{backgroundColor:"dark"===u.theme.name?"rgba(255,255,255,0.03)":"minimalist"===u.theme.name?"#ffffff":"rgba(255,255,255,0.5)",borderColor:u.border},children:S.jsx(Xt,{metrics:{pronunciation:(null==(t=ut.metrics)?void 0:t.pronunciation)||0,intonation:(null==(r=ut.metrics)?void 0:r.intonation)||0,stress:(null==(n=ut.metrics)?void 0:n.stress)||0,rhythm:(null==(a=ut.metrics)?void 0:a.rhythm)||0},height:180})})]})}),S.jsx(ge,{className:"my-6",style:{backgroundColor:u.border}}),S.jsxs("div",{className:"space-y-2 mb-6",children:[S.jsxs("h3",{className:"font-semibold text-base flex items-center gap-2",style:{color:u.textPrimary},children:[S.jsx(se,{className:"w-4 h-4",style:{color:u.buttonPrimary}}),"Feedback"]}),S.jsx("p",{className:"text-sm leading-relaxed",style:{color:u.textSecondary},children:ut.feedback})]}),S.jsxs("div",{className:"p-4 rounded-xl space-y-2 mb-6 border-2",style:{backgroundColor:"dark"===u.theme.name?"rgba(255,255,255,0.05)":"glassmorphism"===u.theme.name?"rgba(255,255,255,0.7)":"minimalist"===u.theme.name?"#f0f9ff":"rgba(255,255,255,0.4)",borderColor:`${u.buttonPrimary}40`},children:[S.jsxs("h3",{className:"font-semibold flex items-center gap-2 text-xs uppercase tracking-wide",style:{color:u.buttonPrimary},children:[S.jsx(ne,{className:"w-3 h-3"}),"Try saying it like this"]}),S.jsxs("p",{className:"text-base italic font-medium",style:{color:u.textPrimary},children:['"',ut.enhancedSentence,'"']})]}),S.jsx("div",{className:"rounded-xl border p-4 space-y-3 mb-6",style:{backgroundColor:"dark"===u.theme.name?"rgba(255,255,255,0.02)":"#ffffff",borderColor:u.border},children:S.jsx("div",{className:"space-y-4",children:S.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[S.jsxs("div",{className:"p-3 rounded-lg bg-amber-50/50 border border-amber-100",children:[S.jsx("h4",{className:"text-xs font-bold text-amber-700 uppercase tracking-wider mb-1",children:"Structure Tip"}),S.jsx("p",{className:"text-sm text-stone-600",children:1===g?"Expand your answers with 'Because... For example...'. Avoid short Yes/No responses.":2===g?"Ensure you cover all bullet points and tell a coherent story with a clear beginning, middle, and end.":"Develop your arguments fully. Use abstract ideas and general examples rather than personal stories."})]}),S.jsxs("div",{className:"p-3 rounded-lg bg-blue-50/50 border border-blue-100",children:[S.jsx("h4",{className:"text-xs font-bold text-blue-700 uppercase tracking-wider mb-1",children:"Quick Win"}),S.jsx("p",{className:"text-sm text-stone-600",children:'Try adding connectors like "Actually...", "To be honest...", or "I\'d say that..." to sound more natural and fluent.'})]})]})})})]}),ze&&S.jsx("div",{className:"flex justify-center mt-4",children:S.jsxs("div",{className:"flex items-center gap-3",children:[S.jsxs(ie,{value:We,onValueChange:Ve,children:[S.jsx(le,{className:"w-[90px] h-8 text-sm border-0 bg-transparent shadow-none p-0 focus:ring-0",style:{color:u.textPrimary,"--tw-ring-color":u.buttonPrimary},children:S.jsx(ce,{placeholder:"Language"})}),S.jsx(ue,{children:Oe.map(e=>S.jsx(de,{value:e.value,children:e.label},e.value))})]}),S.jsx(q,{type:"button",onClick:()=>{try{localStorage.setItem("ielts_speaking_feedback_language",We||"en")}catch(e){console.warn("Unable to persist feedback language preference",e)}(async()=>{var e,t,r,n,a,o;try{const l=Object.entries(Fe);if(0===l.length)return void c({title:"No recordings found",description:"Please record answers before submitting.",variant:"destructive"});console.log("üìù Preparing speaking uploads:",{count:l.length,keys:l.map(([e])=>e)});const u=l.map(async([e,t],r)=>{var n,a,o,s,i,u,m,p,h,f,g,b,y,x,v,j;const k=(null==d?void 0:d.id)||"unknown",w=Date.now(),N=`speaking_${k}_${e}_${w}.webm`,P=new File([t],N,{type:"audio/webm"});try{console.log(`üì§ Uploading speaking recording [${r+1}/${l.length}]:`,{fileName:N,key:e,size:t.size});const c=await ve.uploadSpeaking(P,k,e);if(!c.success)throw console.error(`‚ùå R2 upload reported failure for ${N}:`,c.error),new Error(c.error||"Upload failed");c.url||console.warn(`‚ö†Ô∏è R2 upload returned success but no URL for ${N}. Falling back to deterministic URL.`);const h=c.url||`https://placeholder-r2/${k}/speaking/${encodeURIComponent(e)}/${w}.webm`;console.log(`‚úÖ Speaking recording uploaded successfully: ${h}`);let f="";const g=e.match(/^part(\d+)_q(\d+)$/);if(g){const e=parseInt(g[1],10),t=parseInt(g[2],10);1===e&&(null==(n=null==d?void 0:d.part1_prompts)?void 0:n[t])?f=(null==(a=d.part1_prompts[t])?void 0:a.prompt_text)||(null==(o=d.part1_prompts[t])?void 0:o.transcription)||(null==(s=d.part1_prompts[t])?void 0:s.title)||"":2===e&&(null==d?void 0:d.part2_prompt)?f=d.part2_prompt.prompt_text||d.part2_prompt.transcription||d.part2_prompt.title||"":3===e&&(null==(i=null==d?void 0:d.part3_prompts)?void 0:i[t])&&(f=(null==(u=d.part3_prompts[t])?void 0:u.prompt_text)||(null==(m=d.part3_prompts[t])?void 0:m.transcription)||(null==(p=d.part3_prompts[t])?void 0:p.title)||"")}return{part:e,audio_url:h,question_text:f,upload_error:!1}}catch(C){const t=(null==C?void 0:C.message)||("string"==typeof C?C:"Unknown upload error");console.error(`‚ùå Hard failure uploading ${N}:`,t),c({title:"Upload Warning",description:`We could not upload your recording for ${e}. We will still save your test and run analysis using available audio.`,variant:"destructive"});const r=`https://mock-r2-fallback.local/speaking/${encodeURIComponent(k)}/${encodeURIComponent(e)}/${w}.webm`;let n="";const a=e.match(/^part(\d+)_q(\d+)$/);if(a){const e=parseInt(a[1],10),t=parseInt(a[2],10);1===e&&(null==(h=null==d?void 0:d.part1_prompts)?void 0:h[t])?n=(null==(f=d.part1_prompts[t])?void 0:f.prompt_text)||(null==(g=d.part1_prompts[t])?void 0:g.transcription)||(null==(b=d.part1_prompts[t])?void 0:b.title)||"":2===e&&(null==d?void 0:d.part2_prompt)?n=d.part2_prompt.prompt_text||d.part2_prompt.transcription||d.part2_prompt.title||"":3===e&&(null==(y=null==d?void 0:d.part3_prompts)?void 0:y[t])&&(n=(null==(x=d.part3_prompts[t])?void 0:x.prompt_text)||(null==(v=d.part3_prompts[t])?void 0:v.transcription)||(null==(j=d.part3_prompts[t])?void 0:j.title)||"")}return{part:e,audio_url:r,question_text:n,upload_error:!0,error_message:t}}}),m=await Promise.all(u);if(!m||0===m.length)return console.error("‚ùå No speaking upload results returned"),void c({title:"Upload error",description:"We could not process your recordings. Please try again.",variant:"destructive"});const p=m.filter(e=>!e.upload_error).length,h=m.filter(e=>e.upload_error).length;console.log("üìä Speaking upload summary:",{total:m.length,successfulCount:p,failedCount:h});try{const{data:{user:s}}=await xe.auth.getUser();if(!s)throw new Error("User not authenticated while submitting speaking test");const c=m.map(e=>e.audio_url),{data:u,error:f}=await xe.from("test_results").insert({user_id:s.id,test_type:"speaking",total_questions:m.length,correct_answers:null,score_percentage:0,time_taken:900,audio_urls:c,audio_retention_expires_at:null,test_data:{recordings_count:m.length,parts_completed:[1,2,3],r2_upload_summary:{total:m.length,successful:p,failed:h},retention_policy:"no_auto_expiry_r2_persistent"}}).select().single();if(f||!u)throw f||new Error("Failed to create speaking test result");console.log("‚úÖ Speaking test base records saved. AI scoring will be handled by backend using stored metadata and URLs.");const g=[];for(const i of m){const l=i.part.match(/^part(\d+)/),c=l?parseInt(l[1],10):NaN;if(isNaN(c)||c<1||c>3){console.error(`Invalid part number for recording: ${i.part}`);continue}let m="";if(1===c&&(null==(e=null==d?void 0:d.part1_prompts)?void 0:e.length)){const e=i.part.match(/_q(\d+)/),n=e?parseInt(e[1],10):0;n>=0&&n<d.part1_prompts.length&&(m=(null==(t=d.part1_prompts[n])?void 0:t.prompt_text)||(null==(r=d.part1_prompts[n])?void 0:r.transcription)||"")}else if(2===c&&(null==d?void 0:d.part2_prompt))m=d.part2_prompt.prompt_text||"";else if(3===c&&(null==(n=null==d?void 0:d.part3_prompts)?void 0:n.length)){const e=i.part.match(/_q(\d+)/),t=e?parseInt(e[1],10):0;t>=0&&t<d.part3_prompts.length&&(m=(null==(a=d.part3_prompts[t])?void 0:a.prompt_text)||(null==(o=d.part3_prompts[t])?void 0:o.transcription)||"")}g.push({user_id:s.id,test_result_id:u.id,part_number:c,question_text:m,audio_url:i.audio_url,transcription:"",band_scores:{},detailed_feedback:"",duration_seconds:120})}const{error:b}=await xe.from("speaking_test_results").insert(g);if(b)throw b;console.log("‚úÖ Speaking test base records saved. Running AI scoring..."),console.log("‚ÑπÔ∏è Skipping inline AI scoring for speaking test; base records saved for backend evaluation."),qe({}),i("/ielts-speaking-results",{state:{testData:d,recordings:m,audioBlobs:Object.fromEntries(l),testResultId:u.id}})}catch(s){console.error("Error saving or scoring speaking results:",s),c({title:"Save error",description:"Failed to save or score speaking results. Your recordings may not be fully processed.",variant:"destructive"})}}catch(l){console.error("Error submitting test:",l),c({title:"Submission Error",description:"Failed to submit test. Please try again.",variant:"destructive"})}})()},className:"font-medium",style:{backgroundColor:u.buttonPrimary,color:"#ffffff"},children:"Submit"})]})}),(1===g||3===g)&&!ze&&S.jsx(V,{children:S.jsxs(S.Fragment,{children:[S.jsxs(G,{children:[S.jsx(H,{asChild:!0,children:S.jsx(q,{variant:"ghost",onClick:()=>{console.log("üîô Previous question button clicked"),y>0&&(x(y-1),Ze(!1),dt(null),pt(!1))},disabled:0===y,size:"icon",className:"absolute bottom-0 left-0 h-12 w-12",style:{color:u.textSecondary},onMouseEnter:e=>{e.currentTarget.style.color=u.buttonPrimary,e.currentTarget.style.backgroundColor="transparent"},onMouseLeave:e=>{e.currentTarget.style.color=u.textSecondary,e.currentTarget.style.backgroundColor="transparent"},children:S.jsx(me,{className:"w-5 h-5"})})}),S.jsx(Q,{children:S.jsx("p",{children:"Previous question"})})]}),S.jsxs(G,{children:[S.jsx(H,{asChild:!0,children:S.jsx(q,{variant:"ghost",onClick:()=>{console.log("üîò Next question button clicked"),Ze(!1),Ct()},disabled:!Fe[`part${g}_q${y}`],size:"icon",className:"absolute bottom-0 right-0 h-12 w-12",style:{color:u.textSecondary},onMouseEnter:e=>{e.currentTarget.style.color=u.buttonPrimary,e.currentTarget.style.backgroundColor="transparent"},onMouseLeave:e=>{e.currentTarget.style.color=u.textSecondary,e.currentTarget.style.backgroundColor="transparent"},children:S.jsx(pe,{className:"w-5 h-5"})})}),S.jsx(Q,{children:S.jsx("p",{children:Fe[`part${g}_q${y}`]?y!==((null==d?void 0:d.part1_prompts.length)||0)-1||1!==g||(null==d?void 0:d.part2_prompt)||(null==d?void 0:d.part3_prompts)&&0!==d.part3_prompts.length?"Next question":"Complete test":"Please record your answer first"})})]})]})}),2===g&&!ze&&S.jsx(V,{children:S.jsxs(G,{children:[S.jsx(H,{asChild:!0,children:S.jsx(q,{variant:"ghost",onClick:()=>{console.log("üîò Part 2 navigation button clicked"),Ct()},disabled:!Fe[`part${g}_q${y}`],size:"icon",className:"absolute bottom-0 right-0 h-12 w-12 hover:bg-transparent hover:text-foreground",style:{color:u.textSecondary},onMouseEnter:e=>{e.currentTarget.style.color=u.buttonPrimary,e.currentTarget.style.backgroundColor="transparent"},onMouseLeave:e=>{e.currentTarget.style.color=u.textSecondary,e.currentTarget.style.backgroundColor="transparent"},children:S.jsx(pe,{className:"w-5 h-5"})})}),S.jsx(Q,{children:S.jsx("p",{children:Fe[`part${g}_q${y}`]?(null==d?void 0:d.part3_prompts)&&d.part3_prompts.length>0?"Go to Part 3":"Complete test":"Please record your answer first"})})]})})]})]}),S.jsx("div",{className:"fixed bottom-6 left-6 z-40 flex items-center gap-4",children:S.jsx("button",{onClick:()=>i("/ielts-portal"),className:"text-lg cursor-pointer transition-colors",style:{color:u.textSecondary},onMouseEnter:e=>e.currentTarget.style.color=u.buttonPrimary,onMouseLeave:e=>e.currentTarget.style.color=u.textSecondary,children:"Exit Test"})}),Ge&&S.jsxs("div",{className:"fixed bottom-12 right-4 sm:bottom-20 sm:right-[420px] z-50 flex flex-col gap-2 sm:gap-3",children:[S.jsx(V,{children:S.jsxs(G,{children:[S.jsx(H,{asChild:!0,children:S.jsx(q,{variant:"outline",size:"icon",onClick:()=>At("Help with Speaking Structure"),disabled:st,className:"h-9 w-9 sm:h-12 sm:w-12 p-0 backdrop-blur-sm shadow-lg",style:{borderColor:u.border||"#e5e7eb",backgroundColor:"glassmorphism"===u.theme.name?"rgba(255,255,255,0.9)":"dark"===u.theme.name?"rgba(255,255,255,0.15)":"minimalist"===u.theme.name?"#ffffff":u.theme.colors.cardBackground||"#ffffff",color:u.buttonPrimary||"#2563eb"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=u.hoverBg||"rgba(0,0,0,0.05)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===u.theme.name?"rgba(255,255,255,0.9)":"dark"===u.theme.name?"rgba(255,255,255,0.15)":"minimalist"===u.theme.name?"#ffffff":u.theme.colors.cardBackground||"#ffffff"},children:S.jsx(Te,{className:"w-4 h-4 sm:w-6 sm:h-6",style:{color:u.buttonPrimary||"#2563eb"}})})}),S.jsx(Q,{side:"left",children:S.jsx("p",{children:"Get help with speaking structure"})})]})}),S.jsx(V,{children:S.jsxs(G,{children:[S.jsx(H,{asChild:!0,children:S.jsx(q,{variant:"outline",size:"icon",onClick:()=>At("Suggest Some Speaking Vocabulary"),disabled:st,className:"h-9 w-9 sm:h-12 sm:w-12 p-0 backdrop-blur-sm shadow-lg",style:{borderColor:u.border||"#e5e7eb",backgroundColor:"glassmorphism"===u.theme.name?"rgba(255,255,255,0.9)":"dark"===u.theme.name?"rgba(255,255,255,0.15)":"minimalist"===u.theme.name?"#ffffff":u.theme.colors.cardBackground||"#ffffff",color:u.buttonPrimary||"#2563eb"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=u.hoverBg||"rgba(0,0,0,0.05)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===u.theme.name?"rgba(255,255,255,0.9)":"dark"===u.theme.name?"rgba(255,255,255,0.15)":"minimalist"===u.theme.name?"#ffffff":u.theme.colors.cardBackground||"#ffffff"},children:S.jsx(he,{className:"w-4 h-4 sm:w-6 sm:h-6",style:{color:u.buttonPrimary||"#2563eb"}})})}),S.jsx(Q,{side:"left",children:S.jsx("p",{children:"Get vocabulary suggestions"})})]})}),S.jsx(V,{children:S.jsxs(G,{children:[S.jsx(H,{asChild:!0,children:S.jsx(q,{variant:"outline",size:"icon",onClick:()=>At("Give me 2-3 straightforward band 7+ example answers for this exact IELTS Speaking question. Just show the actual answers, no explanations."),disabled:st,className:"h-9 w-9 sm:h-12 sm:w-12 p-0 backdrop-blur-sm shadow-lg",style:{borderColor:u.border||"#e5e7eb",backgroundColor:"glassmorphism"===u.theme.name?"rgba(255,255,255,0.9)":"dark"===u.theme.name?"rgba(255,255,255,0.15)":"minimalist"===u.theme.name?"#ffffff":u.theme.colors.cardBackground||"#ffffff",color:u.buttonPrimary||"#2563eb"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=u.hoverBg||"rgba(0,0,0,0.05)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===u.theme.name?"rgba(255,255,255,0.9)":"dark"===u.theme.name?"rgba(255,255,255,0.15)":"minimalist"===u.theme.name?"#ffffff":u.theme.colors.cardBackground||"#ffffff"},children:S.jsx(ne,{className:"w-4 h-4 sm:w-6 sm:h-6",style:{color:u.buttonPrimary||"#2563eb"}})})}),S.jsx(Q,{side:"left",children:S.jsx("p",{children:"View band 7+ example answers"})})]})}),S.jsx(V,{children:S.jsxs(G,{children:[S.jsx(H,{asChild:!0,children:S.jsx(q,{variant:"outline",size:"icon",onClick:()=>At("Help me with grammar for this speaking question"),disabled:st,className:"h-9 w-9 sm:h-12 sm:w-12 p-0 backdrop-blur-sm shadow-lg",style:{borderColor:u.border||"#e5e7eb",backgroundColor:"glassmorphism"===u.theme.name?"rgba(255,255,255,0.9)":"dark"===u.theme.name?"rgba(255,255,255,0.15)":"minimalist"===u.theme.name?"#ffffff":u.theme.colors.cardBackground||"#ffffff",color:u.buttonPrimary||"#2563eb"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=u.hoverBg||"rgba(0,0,0,0.05)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===u.theme.name?"rgba(255,255,255,0.9)":"dark"===u.theme.name?"rgba(255,255,255,0.15)":"minimalist"===u.theme.name?"#ffffff":u.theme.colors.cardBackground||"#ffffff"},children:S.jsx(oe,{className:"w-4 h-4 sm:w-6 sm:h-6",style:{color:u.buttonPrimary||"#2563eb"}})})}),S.jsx(Q,{side:"left",children:S.jsx("p",{children:"Get grammar help"})})]})})]}),S.jsxs("div",{className:"fixed bottom-6 right-3 sm:bottom-6 sm:right-6 z-50",children:[Ge&&S.jsxs(D,{className:"backdrop-blur-md rounded-3xl w-[260px] h-[360px] sm:w-96 sm:h-[500px] shadow-2xl flex flex-col transform-gpu origin-bottom-right transition-all duration-260 ease-in-out "+(Ke?"opacity-100 scale-100 translate-y-0":"opacity-0 scale-75 translate-y-8"),style:{backgroundColor:"glassmorphism"===u.theme.name?"rgba(255,255,255,0.95)":"dark"===u.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===u.theme.name?"#ffffff":u.theme.colors.cardBackground,borderColor:u.border,backdropFilter:"glassmorphism"===u.theme.name?"blur(12px)":"dark"===u.theme.name?"blur(8px)":"none",...u.cardStyle},children:[S.jsx(U,{className:"pb-1 sm:pb-2 rounded-t-3xl relative",children:S.jsx("div",{className:"absolute top-1.5 right-1.5 sm:top-2 sm:right-2",children:S.jsx(q,{variant:"ghost",size:"icon",onClick:()=>{Ye(!1),setTimeout(()=>{He(!1)},260)},className:"h-7 w-7 sm:h-8 sm:w-8 p-0",style:{color:u.textPrimary},children:"‚úï"})})}),S.jsxs(F,{className:"flex-1 flex flex-col px-2.5 py-2 sm:p-4 overflow-hidden",children:[S.jsx(je,{className:"flex-1 min-h-0",children:S.jsx(ke,{className:"flex-1 min-h-0",children:0!==rt.length||st?S.jsxs(S.Fragment,{children:[S.jsxs("div",{className:"rounded-lg p-3 mb-4",style:{backgroundColor:"glassmorphism"===u.theme.name?"rgba(255,255,255,0.1)":"dark"===u.theme.name?"rgba(255,255,255,0.05)":"minimalist"===u.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:u.border,borderWidth:"1px",borderStyle:"solid"},children:[S.jsx("div",{className:"text-xs uppercase tracking-wide mb-1",style:{color:u.textSecondary},children:"Question"}),S.jsx("div",{className:"text-xs sm:text-sm font-medium",style:{color:u.textPrimary},children:Lt}),S.jsx("div",{className:"text-[10px] sm:text-sm whitespace-pre-wrap mt-1",style:{color:u.textSecondary},children:Rt||"No question available."})]}),rt.map(e=>S.jsxs(Pe,{from:"user"===e.type?"user":"assistant",children:["bot"===e.type&&S.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"52px",height:"52px",flexShrink:0},children:S.jsx("img",{src:"/1000031289.png",alt:"Catie",style:{width:"100%",height:"100%",objectFit:"cover"}})}),S.jsx(Ce,{children:S.jsx("div",{className:"px-3 py-2 rounded-xl text-sm",style:{backgroundColor:"glassmorphism"===u.theme.name?"rgba(255,255,255,0.1)":"dark"===u.theme.name?"rgba(255,255,255,0.05)":"minimalist"===u.theme.name?"#f9fafb":"rgba(255,255,255,0.5)",borderColor:u.border,borderWidth:"1px",borderStyle:"solid",color:u.textPrimary},children:S.jsx(Se,{dangerouslySetInnerHTML:{__html:e.content.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/^‚Ä¢ (.*)$/gm,"<li>$1</li>").replace(/(<li>.*<\/li>)/s,"<ul>$1</ul>").replace(/\n/g,"<br>")}})})}),"user"===e.type&&(null==l?void 0:l.avatar_url)&&S.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"52px",height:"52px",flexShrink:0},children:S.jsx("img",{src:l.avatar_url,alt:"Your avatar",style:{width:"100%",height:"100%",objectFit:"cover"}})})]},e.id)),st&&S.jsxs(Pe,{from:"assistant",children:[S.jsx(Ce,{children:S.jsx("div",{className:"px-3 py-2 rounded-xl text-sm",style:{backgroundColor:"glassmorphism"===u.theme.name?"rgba(255,255,255,0.1)":"dark"===u.theme.name?"rgba(255,255,255,0.05)":"minimalist"===u.theme.name?"#f9fafb":"rgba(255,255,255,0.5)",borderColor:u.border,borderWidth:"1px",borderStyle:"solid"},children:S.jsx(_e,{text:"Thinking..."})})}),S.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"52px",height:"52px"},children:S.jsx("img",{src:"/1000031289.png",alt:"Catie",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})]}):S.jsx(we,{icon:S.jsx(Ne,{className:"size-9 sm:size-12",style:{color:u.textSecondary}}),title:"Start a conversation",description:"Ask for help with your IELTS speaking practice"})})}),S.jsx("div",{className:"flex-shrink-0 mt-2.5 sm:mt-4",children:S.jsxs("div",{className:"flex gap-1.5 sm:gap-2",children:[S.jsx("input",{type:"text",value:at,onChange:e=>ot(e.target.value),onKeyPress:e=>"Enter"===e.key&&!st&&at.trim()&&Tt(),placeholder:"Ask for speaking help...",className:"flex-1 px-2.5 py-1.5 sm:px-3 sm:py-2 rounded-lg text-[10px] sm:text-sm focus:outline-none focus:ring-0 resize-none",style:{backgroundColor:"glassmorphism"===u.theme.name?"rgba(255,255,255,0.1)":"dark"===u.theme.name?"rgba(255,255,255,0.05)":"minimalist"===u.theme.name?"#ffffff":u.theme.colors.cardBackground,borderColor:u.border,borderWidth:"1px",borderStyle:"solid",color:u.textPrimary},disabled:st}),S.jsx("style",{dangerouslySetInnerHTML:{__html:`\n                      input[placeholder="Ask for speaking help..."]::placeholder {\n                        color: ${u.textSecondary};\n                      }\n                    `}}),S.jsx(q,{onClick:()=>Tt(),disabled:st||!at.trim(),variant:"ghost",size:"icon",className:"h-7 w-7 sm:h-8 sm:w-8 p-0",style:{color:u.textPrimary},children:st?S.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2",style:{borderColor:u.textPrimary}}):S.jsx(fe,{className:"w-4 h-4"})})]})})]})]}),!Ge&&S.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"64px",height:"64px",cursor:"pointer",boxShadow:"0 8px 20px rgba(0,0,0,0.18)",transition:"transform 0.22s ease-out, box-shadow 0.22s ease-out"},onClick:()=>{He(!0),requestAnimationFrame(()=>Ye(!0))},onMouseEnter:e=>{const t=e.currentTarget;t.style.transform="scale(1.06) translateY(-2px)",t.style.boxShadow="0 14px 30px rgba(0,0,0,0.24)"},onMouseLeave:e=>{const t=e.currentTarget;t.style.transform="scale(1.0) translateY(0px)",t.style.boxShadow="0 10px 25px rgba(0,0,0,0.15)"},children:S.jsx("img",{src:"/1000031289.png",alt:"Catie",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})]})})})})]})};export{tr as default};
