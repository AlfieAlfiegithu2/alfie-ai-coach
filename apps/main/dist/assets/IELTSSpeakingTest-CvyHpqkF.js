import{y as e,bs as t,bt as r,bu as n,bv as o,bw as a,bx as s,by as i,bz as l,bA as c,bB as d,bC as u,bD as m,bE as p,bF as h,r as f,bG as g,bH as b,bI as y,bJ as x,bn as v,bK as j,bL as w,bM as k,bN as S,bg as P,bO as N,an as C,at as _,ay as E,j as O,aq as T,as as A,ar as R,aX as L,au as M,br as $,am as I,bl as D,ak as z,u as B,A as q,g as F,af as U,bp as W,Z as H,ai as V,a as Y,B as G,k as X,C as K,M as Q,b as Z,c as J,av as ee,bc as te,bd as re,E as ne,a1 as oe,be as ae,$ as se,P as ie,bP as le,bq as ce,ac as de,V as ue,b6 as me,X as pe,O as he,a6 as fe,S as ge,o as be,p as ye,q as xe,s as ve,_ as je,bQ as we,d as ke,a7 as Se}from"./index-C8eGhmvu.js";import{S as Pe}from"./separator-Ckz6lMWW.js";import{C as Ne}from"./CustomAudioPlayer-DHxrtTFP.js";import{g as Ce,s as _e}from"./supabase-Bqkrifq5.js";import{A as Ee}from"./cloudflare-r2-DEyY8hXO.js";import"./dropdown-menu-DE7i9BFg.js";import{F as Oe,C as Te,a as Ae,b as Re,O as Le,M as Me,c as $e,R as Ie,S as De}from"./shimmering-text-D-dem92a.js";import{F as ze}from"./file-text-aXSFKid5.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=e("ListTree",[["path",{d:"M21 12h-8",key:"1bmf0i"}],["path",{d:"M21 6H8",key:"1pqkrb"}],["path",{d:"M21 18h-8",key:"1tm79t"}],["path",{d:"M3 6v4c0 1.1.9 2 2 2h3",key:"1ywdgy"}],["path",{d:"M3 10v6c0 1.1.9 2 2 2h3",key:"2wc746"}]]);var qe=["points","className","baseLinePoints","connectNulls"];function Fe(){return Fe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Fe.apply(this,arguments)}function Ue(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function We(e){return function(e){if(Array.isArray(e))return He(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return He(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return He(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function He(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Ve=function(e){return e&&e.x===+e.x&&e.y===+e.y},Ye=function(e,t){var r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=[[]];return e.forEach(function(e){Ve(e)?t[t.length-1].push(e):t[t.length-1].length>0&&t.push([])}),Ve(e[0])&&t[t.length-1].push(e[0]),t[t.length-1].length<=0&&(t=t.slice(0,-1)),t}(e);t&&(r=[r.reduce(function(e,t){return[].concat(We(e),We(t))},[])]);var n=r.map(function(e){return e.reduce(function(e,t,r){return"".concat(e).concat(0===r?"M":"L").concat(t.x,",").concat(t.y)},"")}).join("");return 1===r.length?"".concat(n,"Z"):n},Ge=function(e){var o=e.points,a=e.className,s=e.baseLinePoints,i=e.connectNulls,l=Ue(e,qe);if(!o||!o.length)return null;var c=t("recharts-polygon",a);if(s&&s.length){var d=l.stroke&&"none"!==l.stroke,u=function(e,t,r){var n=Ye(e,r);return"".concat("Z"===n.slice(-1)?n.slice(0,-1):n,"L").concat(Ye(t.reverse(),r).slice(1))}(o,s,i);return r.createElement("g",{className:c},r.createElement("path",Fe({},n(l,!0),{fill:"Z"===u.slice(-1)?l.fill:"none",stroke:"none",d:u})),d?r.createElement("path",Fe({},n(l,!0),{fill:"none",d:Ye(o,i)})):null,d?r.createElement("path",Fe({},n(l,!0),{fill:"none",d:Ye(s,i)})):null)}var m=Ye(o,i);return r.createElement("path",Fe({},n(l,!0),{fill:"Z"===m.slice(-1)?l.fill:"none",className:c,d:m}))},Xe=["cx","cy","innerRadius","outerRadius","gridType","radialLines"];function Ke(e){return(Ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Qe(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function Ze(){return Ze=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ze.apply(this,arguments)}function Je(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function et(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Je(Object(r),!0).forEach(function(t){tt(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Je(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function tt(e,t,r){var n;return n=function(e,t){if("object"!=Ke(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=Ke(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"),(t="symbol"==Ke(n)?n:n+"")in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var rt=function(e,t,r,n){var a="";return n.forEach(function(n,s){var i=o(t,r,e,n);a+=s?"L ".concat(i.x,",").concat(i.y):"M ".concat(i.x,",").concat(i.y)}),a+="Z"},nt=function(e){var t=e.cx,a=e.cy,s=e.innerRadius,i=e.outerRadius,l=e.polarAngles,c=e.radialLines;if(!l||!l.length||!c)return null;var d=et({stroke:"#ccc"},n(e,!1));return r.createElement("g",{className:"recharts-polar-grid-angle"},l.map(function(e){var n=o(t,a,s,e),l=o(t,a,i,e);return r.createElement("line",Ze({},d,{key:"line-".concat(e),x1:n.x,y1:n.y,x2:l.x,y2:l.y}))}))},ot=function(e){var o=e.cx,a=e.cy,s=e.radius,i=e.index,l=et(et({stroke:"#ccc"},n(e,!1)),{},{fill:"none"});return r.createElement("circle",Ze({},l,{className:t("recharts-polar-grid-concentric-circle",e.className),key:"circle-".concat(i),cx:o,cy:a,r:s}))},at=function(e){var o=e.radius,a=e.index,s=et(et({stroke:"#ccc"},n(e,!1)),{},{fill:"none"});return r.createElement("path",Ze({},s,{className:t("recharts-polar-grid-concentric-polygon",e.className),key:"path-".concat(a),d:rt(o,e.cx,e.cy,e.polarAngles)}))},st=function(e){var t=e.polarRadius,n=e.gridType;return t&&t.length?r.createElement("g",{className:"recharts-polar-grid-concentric"},t.map(function(t,o){var a=o;return"circle"===n?r.createElement(ot,Ze({key:a},e,{radius:t,index:o})):r.createElement(at,Ze({key:a},e,{radius:t,index:o}))})):null},it=function(e){var t=e.cx,n=void 0===t?0:t,o=e.cy,a=void 0===o?0:o,s=e.innerRadius,i=void 0===s?0:s,l=e.outerRadius,c=void 0===l?0:l,d=e.gridType,u=void 0===d?"polygon":d,m=e.radialLines,p=void 0===m||m,h=Qe(e,Xe);return c<=0?null:r.createElement("g",{className:"recharts-polar-grid"},r.createElement(nt,Ze({cx:n,cy:a,innerRadius:i,outerRadius:c,gridType:u,radialLines:p},h)),r.createElement(st,Ze({cx:n,cy:a,innerRadius:i,outerRadius:c,gridType:u,radialLines:p},h)))};it.displayName="PolarGrid";var lt=a,ct=i,dt=s;const ut=Ce(function(e,t){return e&&e.length?lt(e,dt(t),ct):void 0});var mt=a,pt=s,ht=l;const ft=Ce(function(e,t){return e&&e.length?mt(e,pt(t),ht):void 0});var gt=["cx","cy","angle","ticks","axisLine"],bt=["ticks","tick","angle","tickFormatter","stroke"];function yt(e){return(yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xt(){return xt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},xt.apply(this,arguments)}function vt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function jt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?vt(Object(r),!0).forEach(function(t){_t(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vt(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function wt(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function kt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Et(n.key),n)}}function St(e,t,r){return t=Nt(t),function(e,t){if(t&&("object"===yt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Pt()?Reflect.construct(t,r||[],Nt(e).constructor):t.apply(e,r))}function Pt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Pt=function(){return!!e})()}function Nt(e){return(Nt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ct(e,t){return(Ct=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _t(e,t,r){return(t=Et(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Et(e){var t=function(e,t){if("object"!=yt(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=yt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==yt(t)?t:t+""}var Ot=function(){function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),St(this,e,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ct(e,t)}(e,f.PureComponent),a=e,i=[{key:"renderTickItem",value:function(e,t,n){return r.isValidElement(e)?r.cloneElement(e,t):c(e)?e(t):r.createElement(d,xt({},t,{className:"recharts-polar-radius-axis-tick-value"}),n)}}],(s=[{key:"getTickValueCoord",value:function(e){var t=e.coordinate,r=this.props,n=r.angle,a=r.cx,s=r.cy;return o(a,s,t,n)}},{key:"getTickTextAnchor",value:function(){var e;switch(this.props.orientation){case"left":e="end";break;case"right":e="start";break;default:e="middle"}return e}},{key:"getViewBox",value:function(){var e=this.props,t=e.cx,r=e.cy,n=e.angle,o=e.ticks,a=ut(o,function(e){return e.coordinate||0});return{cx:t,cy:r,startAngle:n,endAngle:n,innerRadius:ft(o,function(e){return e.coordinate||0}).coordinate||0,outerRadius:a.coordinate||0}}},{key:"renderAxisLine",value:function(){var e=this.props,t=e.cx,a=e.cy,s=e.angle,i=e.ticks,l=e.axisLine,c=wt(e,gt),d=i.reduce(function(e,t){return[Math.min(e[0],t.coordinate),Math.max(e[1],t.coordinate)]},[1/0,-1/0]),u=o(t,a,d[0],s),m=o(t,a,d[1],s),p=jt(jt(jt({},n(c,!1)),{},{fill:"none"},n(l,!1)),{},{x1:u.x,y1:u.y,x2:m.x,y2:m.y});return r.createElement("line",xt({className:"recharts-polar-radius-axis-line"},p))}},{key:"renderTicks",value:function(){var o=this,a=this.props,s=a.ticks,i=a.tick,l=a.angle,c=a.tickFormatter,d=a.stroke,h=wt(a,bt),f=this.getTickTextAnchor(),g=n(h,!1),b=n(i,!1),y=s.map(function(n,a){var s=o.getTickValueCoord(n),h=jt(jt(jt(jt({textAnchor:f,transform:"rotate(".concat(90-l,", ").concat(s.x,", ").concat(s.y,")")},g),{},{stroke:"none",fill:d},b),{},{index:a},s),{},{payload:n});return r.createElement(u,xt({className:t("recharts-polar-radius-axis-tick",m(i)),key:"tick-".concat(n.coordinate)},p(o.props,n,a)),e.renderTickItem(i,h,c?c(n.value,a):n.value))});return r.createElement(u,{className:"recharts-polar-radius-axis-ticks"},y)}},{key:"render",value:function(){var e=this.props,n=e.ticks,o=e.axisLine,a=e.tick;return n&&n.length?r.createElement(u,{className:t("recharts-polar-radius-axis",this.props.className)},o&&this.renderAxisLine(),a&&this.renderTicks(),h.renderCallByParent(this.props,this.getViewBox())):null}}])&&kt(a.prototype,s),i&&kt(a,i),Object.defineProperty(a,"prototype",{writable:!1}),a;var a,s,i}();function Tt(e){return(Tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function At(){return At=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},At.apply(this,arguments)}function Rt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Lt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Rt(Object(r),!0).forEach(function(t){Bt(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rt(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Mt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,qt(n.key),n)}}function $t(e,t,r){return t=Dt(t),function(e,t){if(t&&("object"===Tt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,It()?Reflect.construct(t,r||[],Dt(e).constructor):t.apply(e,r))}function It(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(It=function(){return!!e})()}function Dt(e){return(Dt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function zt(e,t){return(zt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function Bt(e,t,r){return(t=qt(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function qt(e){var t=function(e,t){if("object"!=Tt(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=Tt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Tt(t)?t:t+""}_t(Ot,"displayName","PolarRadiusAxis"),_t(Ot,"axisType","radiusAxis"),_t(Ot,"defaultProps",{type:"number",radiusAxisId:0,cx:0,cy:0,angle:0,orientation:"right",stroke:"#ccc",axisLine:!0,tick:!0,tickCount:5,allowDataOverflow:!1,scale:"auto",allowDuplicatedCategory:!0});var Ft=Math.PI/180,Ut=1e-5,Wt=function(){function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),$t(this,e,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&zt(e,t)}(e,f.PureComponent),a=e,i=[{key:"renderTickItem",value:function(e,t,n){return r.isValidElement(e)?r.cloneElement(e,t):c(e)?e(t):r.createElement(d,At({},t,{className:"recharts-polar-angle-axis-tick-value"}),n)}}],(s=[{key:"getTickLineCoord",value:function(e){var t=this.props,r=t.cx,n=t.cy,a=t.radius,s=t.orientation,i=t.tickSize||8,l=o(r,n,a,e.coordinate),c=o(r,n,a+("inner"===s?-1:1)*i,e.coordinate);return{x1:l.x,y1:l.y,x2:c.x,y2:c.y}}},{key:"getTickTextAnchor",value:function(e){var t=this.props.orientation,r=Math.cos(-e.coordinate*Ft);return r>Ut?"outer"===t?"start":"end":r<-Ut?"outer"===t?"end":"start":"middle"}},{key:"renderAxisLine",value:function(){var e=this.props,t=e.cx,a=e.cy,s=e.radius,i=e.axisLine,l=e.axisLineType,c=Lt(Lt({},n(this.props,!1)),{},{fill:"none"},n(i,!1));if("circle"===l)return r.createElement(g,At({className:"recharts-polar-angle-axis-line"},c,{cx:t,cy:a,r:s}));var d=this.props.ticks.map(function(e){return o(t,a,s,e.coordinate)});return r.createElement(Ge,At({className:"recharts-polar-angle-axis-line"},c,{points:d}))}},{key:"renderTicks",value:function(){var o=this,a=this.props,s=a.ticks,i=a.tick,l=a.tickLine,c=a.tickFormatter,d=a.stroke,h=n(this.props,!1),f=n(i,!1),g=Lt(Lt({},h),{},{fill:"none"},n(l,!1)),b=s.map(function(n,a){var s=o.getTickLineCoord(n),b=Lt(Lt(Lt({textAnchor:o.getTickTextAnchor(n)},h),{},{stroke:"none",fill:d},f),{},{index:a,payload:n,x:s.x2,y:s.y2});return r.createElement(u,At({className:t("recharts-polar-angle-axis-tick",m(i)),key:"tick-".concat(n.coordinate)},p(o.props,n,a)),l&&r.createElement("line",At({className:"recharts-polar-angle-axis-tick-line"},g,s)),i&&e.renderTickItem(i,b,c?c(n.value,a):n.value))});return r.createElement(u,{className:"recharts-polar-angle-axis-ticks"},b)}},{key:"render",value:function(){var e=this.props,n=e.ticks,o=e.radius,a=e.axisLine;return o<=0||!n||!n.length?null:r.createElement(u,{className:t("recharts-polar-angle-axis",this.props.className)},a&&this.renderAxisLine(),this.renderTicks())}}])&&Mt(a.prototype,s),i&&Mt(a,i),Object.defineProperty(a,"prototype",{writable:!1}),a;var a,s,i}();Bt(Wt,"displayName","PolarAngleAxis"),Bt(Wt,"axisType","angleAxis"),Bt(Wt,"defaultProps",{type:"category",angleAxisId:0,scale:"auto",cx:0,cy:0,orientation:"outer",axisLine:!0,tickLine:!0,tickSize:8,tick:!0,hide:!1,allowDuplicatedCategory:!0});const Ht=Ce(function(e){return e&&e.length?e[0]:void 0});var Vt=["key"];function Yt(e){return(Yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Gt(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function Xt(){return Xt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Xt.apply(this,arguments)}function Kt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Qt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Kt(Object(r),!0).forEach(function(t){nr(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Kt(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Zt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,or(n.key),n)}}function Jt(e,t,r){return t=tr(t),function(e,t){if(t&&("object"===Yt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,er()?Reflect.construct(t,r||[],tr(e).constructor):t.apply(e,r))}function er(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(er=function(){return!!e})()}function tr(e){return(tr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function rr(e,t){return(rr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function nr(e,t,r){return(t=or(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function or(e){var t=function(e,t){if("object"!=Yt(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=Yt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Yt(t)?t:t+""}var ar=function(){function e(){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return nr(t=Jt(this,e,[].concat(n)),"state",{isAnimationFinished:!1}),nr(t,"handleAnimationEnd",function(){var e=t.props.onAnimationEnd;t.setState({isAnimationFinished:!0}),c(e)&&e()}),nr(t,"handleAnimationStart",function(){var e=t.props.onAnimationStart;t.setState({isAnimationFinished:!1}),c(e)&&e()}),nr(t,"handleMouseEnter",function(e){var r=t.props.onMouseEnter;r&&r(t.props,e)}),nr(t,"handleMouseLeave",function(e){var r=t.props.onMouseLeave;r&&r(t.props,e)}),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&rr(e,t)}(e,f.PureComponent),o=e,s=[{key:"getDerivedStateFromProps",value:function(e,t){return e.animationId!==t.prevAnimationId?{prevAnimationId:e.animationId,curPoints:e.points,prevPoints:t.curPoints}:e.points!==t.curPoints?{curPoints:e.points}:null}},{key:"renderDotItem",value:function(e,n){var o;if(r.isValidElement(e))o=r.cloneElement(e,n);else if(c(e))o=e(n);else{var a=n.key,s=Gt(n,Vt);o=r.createElement(g,Xt({},s,{key:a,className:t("recharts-radar-dot","boolean"!=typeof e?e.className:"")}))}return o}}],(a=[{key:"renderDots",value:function(t){var o=this.props,a=o.dot,s=o.dataKey,i=n(this.props,!1),l=n(a,!0),c=t.map(function(t,r){var n=Qt(Qt(Qt({key:"dot-".concat(r),r:3},i),l),{},{dataKey:s,cx:t.x,cy:t.y,index:r,payload:t});return e.renderDotItem(a,n)});return r.createElement(u,{className:"recharts-radar-dots"},c)}},{key:"renderPolygonStatically",value:function(e){var t,o=this.props,a=o.shape,s=o.dot,i=o.isRange,l=o.baseLinePoints,d=o.connectNulls;return t=r.isValidElement(a)?r.cloneElement(a,Qt(Qt({},this.props),{},{points:e})):c(a)?a(Qt(Qt({},this.props),{},{points:e})):r.createElement(Ge,Xt({},n(this.props,!0),{onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,points:e,baseLinePoints:i?l:null,connectNulls:d})),r.createElement(u,{className:"recharts-radar-polygon"},t,s?this.renderDots(e):null)}},{key:"renderPolygonWithAnimation",value:function(){var e=this,t=this.props,n=t.points,o=t.isAnimationActive,a=t.animationBegin,s=t.animationDuration,i=t.animationEasing,l=t.animationId,c=this.state.prevPoints;return r.createElement(b,{begin:a,duration:s,isActive:o,easing:i,from:{t:0},to:{t:1},key:"radar-".concat(l),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(t){var r=t.t,o=c&&c.length/n.length,a=n.map(function(e,t){var n=c&&c[Math.floor(t*o)];if(n){var a=y(n.x,e.x),s=y(n.y,e.y);return Qt(Qt({},e),{},{x:a(r),y:s(r)})}var i=y(e.cx,e.x),l=y(e.cy,e.y);return Qt(Qt({},e),{},{x:i(r),y:l(r)})});return e.renderPolygonStatically(a)})}},{key:"renderPolygon",value:function(){var e=this.props,t=e.points,r=e.isAnimationActive,n=e.isRange,o=this.state.prevPoints;return!(r&&t&&t.length)||n||o&&x(o,t)?this.renderPolygonStatically(t):this.renderPolygonWithAnimation()}},{key:"render",value:function(){var e=this.props,n=e.hide,o=e.className,a=e.points,s=e.isAnimationActive;if(n||!a||!a.length)return null;var i=this.state.isAnimationFinished,l=t("recharts-radar",o);return r.createElement(u,{className:l},this.renderPolygon(),(!s||i)&&v.renderCallByParent(this.props,a))}}])&&Zt(o.prototype,a),s&&Zt(o,s),Object.defineProperty(o,"prototype",{writable:!1}),o;var o,a,s}();nr(ar,"displayName","Radar"),nr(ar,"defaultProps",{angleAxisId:0,radiusAxisId:0,hide:!1,activeDot:!0,dot:!1,legendType:"rect",isAnimationActive:!j.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"}),nr(ar,"getComposedData",function(e){var t=e.radiusAxis,r=e.angleAxis,n=e.displayedData,a=e.dataKey,s=e.bandSize,i=r.cx,l=r.cy,c=!1,d=[],u="number"!==r.type&&null!=s?s:0;n.forEach(function(e,n){var s=w(e,r.dataKey,n),m=w(e,a),p=r.scale(s)+u,h=Array.isArray(m)?k(m):m,f=S(h)?void 0:t.scale(h);Array.isArray(m)&&m.length>=2&&(c=!0),d.push(Qt(Qt({},o(i,l,f,p)),{},{name:s,value:m,cx:i,cy:l,radius:f,angle:p,payload:e}))});var m=[];return c&&d.forEach(function(e){if(Array.isArray(e.value)){var r=Ht(e.value),n=S(r)?void 0:t.scale(r);m.push(Qt(Qt({},e),{},{radius:n},o(i,l,n,e.angle)))}else m.push(e)}),{points:d,isRange:c,baseLinePoints:m}});var sr=P({chartName:"RadarChart",GraphicalChild:ar,axisComponents:[{axisType:"angleAxis",AxisComp:Wt},{axisType:"radiusAxis",AxisComp:Ot}],formatAxisMap:N,defaultProps:{layout:"centric",startAngle:90,endAngle:-270,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});var ir="ScrollArea",[lr,cr]=C(ir),[dr,ur]=lr(ir),mr=f.forwardRef((e,t)=>{const{__scopeScrollArea:r,type:n="hover",dir:o,scrollHideDelay:a=600,...s}=e,[i,l]=f.useState(null),[c,d]=f.useState(null),[u,m]=f.useState(null),[p,h]=f.useState(null),[g,b]=f.useState(null),[y,x]=f.useState(0),[v,j]=f.useState(0),[w,k]=f.useState(!1),[S,P]=f.useState(!1),N=_(t,e=>l(e)),C=E(o);return O.jsx(dr,{scope:r,type:n,dir:C,scrollHideDelay:a,scrollArea:i,viewport:c,onViewportChange:d,content:u,onContentChange:m,scrollbarX:p,onScrollbarXChange:h,scrollbarXEnabled:w,onScrollbarXEnabledChange:k,scrollbarY:g,onScrollbarYChange:b,scrollbarYEnabled:S,onScrollbarYEnabledChange:P,onCornerWidthChange:x,onCornerHeightChange:j,children:O.jsx(T.div,{dir:C,...s,ref:N,style:{position:"relative","--radix-scroll-area-corner-width":y+"px","--radix-scroll-area-corner-height":v+"px",...e.style}})})});mr.displayName=ir;var pr="ScrollAreaViewport",hr=f.forwardRef((e,t)=>{const{__scopeScrollArea:r,children:n,asChild:o,nonce:a,...s}=e,i=ur(pr,r),l=f.useRef(null),c=_(t,l,i.onViewportChange);return O.jsxs(O.Fragment,{children:[O.jsx("style",{dangerouslySetInnerHTML:{__html:"\n[data-radix-scroll-area-viewport] {\n  scrollbar-width: none;\n  -ms-overflow-style: none;\n  -webkit-overflow-scrolling: touch;\n}\n[data-radix-scroll-area-viewport]::-webkit-scrollbar {\n  display: none;\n}\n:where([data-radix-scroll-area-viewport]) {\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n}\n:where([data-radix-scroll-area-content]) {\n  flex-grow: 1;\n}\n"},nonce:a}),O.jsx(T.div,{"data-radix-scroll-area-viewport":"",...s,asChild:o,ref:c,style:{overflowX:i.scrollbarXEnabled?"scroll":"hidden",overflowY:i.scrollbarYEnabled?"scroll":"hidden",...e.style},children:qr({asChild:o,children:n},e=>O.jsx("div",{"data-radix-scroll-area-content":"",ref:i.onContentChange,style:{minWidth:i.scrollbarXEnabled?"fit-content":void 0},children:e}))})]})});hr.displayName=pr;var fr="ScrollAreaScrollbar",gr=f.forwardRef((e,t)=>{const{forceMount:r,...n}=e,o=ur(fr,e.__scopeScrollArea),{onScrollbarXEnabledChange:a,onScrollbarYEnabledChange:s}=o,i="horizontal"===e.orientation;return f.useEffect(()=>(i?a(!0):s(!0),()=>{i?a(!1):s(!1)}),[i,a,s]),"hover"===o.type?O.jsx(br,{...n,ref:t,forceMount:r}):"scroll"===o.type?O.jsx(yr,{...n,ref:t,forceMount:r}):"auto"===o.type?O.jsx(xr,{...n,ref:t,forceMount:r}):"always"===o.type?O.jsx(vr,{...n,ref:t}):null});gr.displayName=fr;var br=f.forwardRef((e,t)=>{const{forceMount:r,...n}=e,o=ur(fr,e.__scopeScrollArea),[a,s]=f.useState(!1);return f.useEffect(()=>{const e=o.scrollArea;let t=0;if(e){const r=()=>{window.clearTimeout(t),s(!0)},n=()=>{t=window.setTimeout(()=>s(!1),o.scrollHideDelay)};return e.addEventListener("pointerenter",r),e.addEventListener("pointerleave",n),()=>{window.clearTimeout(t),e.removeEventListener("pointerenter",r),e.removeEventListener("pointerleave",n)}}},[o.scrollArea,o.scrollHideDelay]),O.jsx(A,{present:r||a,children:O.jsx(xr,{"data-state":a?"visible":"hidden",...n,ref:t})})}),yr=f.forwardRef((e,t)=>{const{forceMount:r,...n}=e,o=ur(fr,e.__scopeScrollArea),a="horizontal"===e.orientation,s=zr(()=>l("SCROLL_END"),100),[i,l]=(c="hidden",d={hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}},f.useReducer((e,t)=>d[e][t]??e,c));var c,d;return f.useEffect(()=>{if("idle"===i){const e=window.setTimeout(()=>l("HIDE"),o.scrollHideDelay);return()=>window.clearTimeout(e)}},[i,o.scrollHideDelay,l]),f.useEffect(()=>{const e=o.viewport,t=a?"scrollLeft":"scrollTop";if(e){let r=e[t];const n=()=>{const n=e[t];r!==n&&(l("SCROLL"),s()),r=n};return e.addEventListener("scroll",n),()=>e.removeEventListener("scroll",n)}},[o.viewport,a,l,s]),O.jsx(A,{present:r||"hidden"!==i,children:O.jsx(vr,{"data-state":"hidden"===i?"hidden":"visible",...n,ref:t,onPointerEnter:R(e.onPointerEnter,()=>l("POINTER_ENTER")),onPointerLeave:R(e.onPointerLeave,()=>l("POINTER_LEAVE"))})})}),xr=f.forwardRef((e,t)=>{const r=ur(fr,e.__scopeScrollArea),{forceMount:n,...o}=e,[a,s]=f.useState(!1),i="horizontal"===e.orientation,l=zr(()=>{if(r.viewport){const e=r.viewport.offsetWidth<r.viewport.scrollWidth,t=r.viewport.offsetHeight<r.viewport.scrollHeight;s(i?e:t)}},10);return Br(r.viewport,l),Br(r.content,l),O.jsx(A,{present:n||a,children:O.jsx(vr,{"data-state":a?"visible":"hidden",...o,ref:t})})}),vr=f.forwardRef((e,t)=>{const{orientation:r="vertical",...n}=e,o=ur(fr,e.__scopeScrollArea),a=f.useRef(null),s=f.useRef(0),[i,l]=f.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),c=Rr(i.viewport,i.content),d={...n,sizes:i,onSizesChange:l,hasThumb:Boolean(c>0&&c<1),onThumbChange:e=>a.current=e,onThumbPointerUp:()=>s.current=0,onThumbPointerDown:e=>s.current=e};function u(e,t){return function(e,t,r,n="ltr"){const o=Lr(r),a=o/2,s=t||a,i=o-s,l=r.scrollbar.paddingStart+s,c=r.scrollbar.size-r.scrollbar.paddingEnd-i,d=r.content-r.viewport,u="ltr"===n?[0,d]:[-1*d,0];return $r([l,c],u)(e)}(e,s.current,i,t)}return"horizontal"===r?O.jsx(jr,{...d,ref:t,onThumbPositionChange:()=>{if(o.viewport&&a.current){const e=Mr(o.viewport.scrollLeft,i,o.dir);a.current.style.transform=`translate3d(${e}px, 0, 0)`}},onWheelScroll:e=>{o.viewport&&(o.viewport.scrollLeft=e)},onDragScroll:e=>{o.viewport&&(o.viewport.scrollLeft=u(e,o.dir))}}):"vertical"===r?O.jsx(wr,{...d,ref:t,onThumbPositionChange:()=>{if(o.viewport&&a.current){const e=Mr(o.viewport.scrollTop,i);a.current.style.transform=`translate3d(0, ${e}px, 0)`}},onWheelScroll:e=>{o.viewport&&(o.viewport.scrollTop=e)},onDragScroll:e=>{o.viewport&&(o.viewport.scrollTop=u(e))}}):null}),jr=f.forwardRef((e,t)=>{const{sizes:r,onSizesChange:n,...o}=e,a=ur(fr,e.__scopeScrollArea),[s,i]=f.useState(),l=f.useRef(null),c=_(t,l,a.onScrollbarXChange);return f.useEffect(()=>{l.current&&i(getComputedStyle(l.current))},[l]),O.jsx(Pr,{"data-orientation":"horizontal",...o,ref:c,sizes:r,style:{bottom:0,left:"rtl"===a.dir?"var(--radix-scroll-area-corner-width)":0,right:"ltr"===a.dir?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":Lr(r)+"px",...e.style},onThumbPointerDown:t=>e.onThumbPointerDown(t.x),onDragScroll:t=>e.onDragScroll(t.x),onWheelScroll:(t,r)=>{if(a.viewport){const n=a.viewport.scrollLeft+t.deltaX;e.onWheelScroll(n),Ir(n,r)&&t.preventDefault()}},onResize:()=>{l.current&&a.viewport&&s&&n({content:a.viewport.scrollWidth,viewport:a.viewport.offsetWidth,scrollbar:{size:l.current.clientWidth,paddingStart:Ar(s.paddingLeft),paddingEnd:Ar(s.paddingRight)}})}})}),wr=f.forwardRef((e,t)=>{const{sizes:r,onSizesChange:n,...o}=e,a=ur(fr,e.__scopeScrollArea),[s,i]=f.useState(),l=f.useRef(null),c=_(t,l,a.onScrollbarYChange);return f.useEffect(()=>{l.current&&i(getComputedStyle(l.current))},[l]),O.jsx(Pr,{"data-orientation":"vertical",...o,ref:c,sizes:r,style:{top:0,right:"ltr"===a.dir?0:void 0,left:"rtl"===a.dir?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":Lr(r)+"px",...e.style},onThumbPointerDown:t=>e.onThumbPointerDown(t.y),onDragScroll:t=>e.onDragScroll(t.y),onWheelScroll:(t,r)=>{if(a.viewport){const n=a.viewport.scrollTop+t.deltaY;e.onWheelScroll(n),Ir(n,r)&&t.preventDefault()}},onResize:()=>{l.current&&a.viewport&&s&&n({content:a.viewport.scrollHeight,viewport:a.viewport.offsetHeight,scrollbar:{size:l.current.clientHeight,paddingStart:Ar(s.paddingTop),paddingEnd:Ar(s.paddingBottom)}})}})}),[kr,Sr]=lr(fr),Pr=f.forwardRef((e,t)=>{const{__scopeScrollArea:r,sizes:n,hasThumb:o,onThumbChange:a,onThumbPointerUp:s,onThumbPointerDown:i,onThumbPositionChange:l,onDragScroll:c,onWheelScroll:d,onResize:u,...m}=e,p=ur(fr,r),[h,g]=f.useState(null),b=_(t,e=>g(e)),y=f.useRef(null),x=f.useRef(""),v=p.viewport,j=n.content-n.viewport,w=L(d),k=L(l),S=zr(u,10);function P(e){if(y.current){const t=e.clientX-y.current.left,r=e.clientY-y.current.top;c({x:t,y:r})}}return f.useEffect(()=>{const e=e=>{const t=e.target;(null==h?void 0:h.contains(t))&&w(e,j)};return document.addEventListener("wheel",e,{passive:!1}),()=>document.removeEventListener("wheel",e,{passive:!1})},[v,h,j,w]),f.useEffect(k,[n,k]),Br(h,S),Br(p.content,S),O.jsx(kr,{scope:r,scrollbar:h,hasThumb:o,onThumbChange:L(a),onThumbPointerUp:L(s),onThumbPositionChange:k,onThumbPointerDown:L(i),children:O.jsx(T.div,{...m,ref:b,style:{position:"absolute",...m.style},onPointerDown:R(e.onPointerDown,e=>{if(0===e.button){e.target.setPointerCapture(e.pointerId),y.current=h.getBoundingClientRect(),x.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",p.viewport&&(p.viewport.style.scrollBehavior="auto"),P(e)}}),onPointerMove:R(e.onPointerMove,P),onPointerUp:R(e.onPointerUp,e=>{const t=e.target;t.hasPointerCapture(e.pointerId)&&t.releasePointerCapture(e.pointerId),document.body.style.webkitUserSelect=x.current,p.viewport&&(p.viewport.style.scrollBehavior=""),y.current=null})})})}),Nr="ScrollAreaThumb",Cr=f.forwardRef((e,t)=>{const{forceMount:r,...n}=e,o=Sr(Nr,e.__scopeScrollArea);return O.jsx(A,{present:r||o.hasThumb,children:O.jsx(_r,{ref:t,...n})})}),_r=f.forwardRef((e,t)=>{const{__scopeScrollArea:r,style:n,...o}=e,a=ur(Nr,r),s=Sr(Nr,r),{onThumbPositionChange:i}=s,l=_(t,e=>s.onThumbChange(e)),c=f.useRef(),d=zr(()=>{c.current&&(c.current(),c.current=void 0)},100);return f.useEffect(()=>{const e=a.viewport;if(e){const t=()=>{if(d(),!c.current){const t=Dr(e,i);c.current=t,i()}};return i(),e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)}},[a.viewport,d,i]),O.jsx(T.div,{"data-state":s.hasThumb?"visible":"hidden",...o,ref:l,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...n},onPointerDownCapture:R(e.onPointerDownCapture,e=>{const t=e.target.getBoundingClientRect(),r=e.clientX-t.left,n=e.clientY-t.top;s.onThumbPointerDown({x:r,y:n})}),onPointerUp:R(e.onPointerUp,s.onThumbPointerUp)})});Cr.displayName=Nr;var Er="ScrollAreaCorner",Or=f.forwardRef((e,t)=>{const r=ur(Er,e.__scopeScrollArea),n=Boolean(r.scrollbarX&&r.scrollbarY);return"scroll"!==r.type&&n?O.jsx(Tr,{...e,ref:t}):null});Or.displayName=Er;var Tr=f.forwardRef((e,t)=>{const{__scopeScrollArea:r,...n}=e,o=ur(Er,r),[a,s]=f.useState(0),[i,l]=f.useState(0),c=Boolean(a&&i);return Br(o.scrollbarX,()=>{var e;const t=(null==(e=o.scrollbarX)?void 0:e.offsetHeight)||0;o.onCornerHeightChange(t),l(t)}),Br(o.scrollbarY,()=>{var e;const t=(null==(e=o.scrollbarY)?void 0:e.offsetWidth)||0;o.onCornerWidthChange(t),s(t)}),c?O.jsx(T.div,{...n,ref:t,style:{width:a,height:i,position:"absolute",right:"ltr"===o.dir?0:void 0,left:"rtl"===o.dir?0:void 0,bottom:0,...e.style}}):null});function Ar(e){return e?parseInt(e,10):0}function Rr(e,t){const r=e/t;return isNaN(r)?0:r}function Lr(e){const t=Rr(e.viewport,e.content),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,n=(e.scrollbar.size-r)*t;return Math.max(n,18)}function Mr(e,t,r="ltr"){const n=Lr(t),o=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,a=t.scrollbar.size-o,s=t.content-t.viewport,i=a-n,l=$(e,"ltr"===r?[0,s]:[-1*s,0]);return $r([0,s],[0,i])(l)}function $r(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const n=(t[1]-t[0])/(e[1]-e[0]);return t[0]+n*(r-e[0])}}function Ir(e,t){return e>0&&e<t}var Dr=(e,t=()=>{})=>{let r={left:e.scrollLeft,top:e.scrollTop},n=0;return function o(){const a={left:e.scrollLeft,top:e.scrollTop},s=r.left!==a.left,i=r.top!==a.top;(s||i)&&t(),r=a,n=window.requestAnimationFrame(o)}(),()=>window.cancelAnimationFrame(n)};function zr(e,t){const r=L(e),n=f.useRef(0);return f.useEffect(()=>()=>window.clearTimeout(n.current),[]),f.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(r,t)},[r,t])}function Br(e,t){const r=L(t);M(()=>{let t=0;if(e){const n=new ResizeObserver(()=>{cancelAnimationFrame(t),t=window.requestAnimationFrame(r)});return n.observe(e),()=>{window.cancelAnimationFrame(t),n.unobserve(e)}}},[e,r])}function qr(e,t){const{asChild:r,children:n}=e;if(!r)return"function"==typeof t?t(n):t;const o=f.Children.only(n);return f.cloneElement(o,{children:"function"==typeof t?t(o.props.children):t})}var Fr=mr,Ur=hr,Wr=Or;f.forwardRef(({className:e,children:t,...r},n)=>O.jsxs(Fr,{ref:n,className:I("relative overflow-hidden",e),...r,children:[O.jsx(Ur,{className:"h-full w-full rounded-[inherit]",children:t}),O.jsx(Hr,{}),O.jsx(Wr,{})]})).displayName=Fr.displayName;const Hr=f.forwardRef(({className:e,orientation:t="vertical",...r},n)=>O.jsx(gr,{ref:n,orientation:t,className:I("flex touch-none select-none transition-colors","vertical"===t&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===t&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...r,children:O.jsx(Cr,{className:"relative flex-1 rounded-full bg-border"})}));Hr.displayName=gr.displayName;const Vr=({score:e,label:t="Score",subLabel:r,size:n=120,strokeWidth:o=8,color:a="#3b82f6"})=>{const s=(n-o)/2,i=2*s*Math.PI,l=i-e/100*i;return O.jsxs("div",{className:"relative flex flex-col items-center justify-center",style:{width:n,height:n},children:[O.jsxs("svg",{width:n,height:n,className:"transform -rotate-90",children:[O.jsx("circle",{cx:n/2,cy:n/2,r:s,stroke:"currentColor",strokeWidth:o,fill:"transparent",className:"text-slate-100 dark:text-slate-800"}),O.jsx("circle",{cx:n/2,cy:n/2,r:s,stroke:a,strokeWidth:o,fill:"transparent",strokeDasharray:i,strokeDashoffset:l,strokeLinecap:"round",className:"transition-all duration-1000 ease-out"})]}),O.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-center",children:[O.jsxs("span",{className:"text-2xl font-bold",style:{color:a},children:[e,"%"]}),t&&O.jsx("span",{className:"text-xs text-slate-500 font-medium uppercase tracking-wider",children:t}),r&&O.jsx("span",{className:"text-[10px] text-slate-400",children:r})]})]})},Yr=({metrics:e,width:t=300,height:r=250})=>{const n=[{subject:"Pronunciation",A:e.pronunciation,fullMark:100},{subject:"Intonation",A:e.intonation,fullMark:100},{subject:"Stress",A:e.stress,fullMark:100},{subject:"Rhythm",A:e.rhythm,fullMark:100}];return O.jsx("div",{className:"w-full flex justify-center",children:O.jsx("div",{style:{width:"100%",height:r,maxWidth:t},children:O.jsx(D,{width:"100%",height:"100%",children:O.jsxs(sr,{cx:"50%",cy:"50%",outerRadius:"70%",data:n,children:[O.jsx(it,{stroke:"#e2e8f0"}),O.jsx(Wt,{dataKey:"subject",tick:{fill:"#64748b",fontSize:11,fontWeight:600}}),O.jsx(Ot,{angle:30,domain:[0,100],tick:!1,axisLine:!1}),O.jsx(ar,{name:"Metrics",dataKey:"A",stroke:"#3b82f6",strokeWidth:2,fill:"#3b82f6",fillOpacity:.2})]})})})})};f.createContext(null);const Gr=({active:e=!1,processing:t=!1,deviceId:r,barWidth:n=3,barGap:o=1,barRadius:a=1.5,barColor:s,fadeEdges:i=!0,fadeWidth:l=24,height:c=64,sensitivity:d=1,smoothingTimeConstant:u=.8,fftSize:m=256,historySize:p=60,updateRate:h=30,mode:g="static",onError:b,onStreamReady:y,onStreamEnd:x,className:v,...j})=>{const w=f.useRef(null),k=f.useRef(null),S=f.useRef([]),P=f.useRef(null),N=f.useRef(null),C=f.useRef(null),_=f.useRef(0),E=f.useRef(0),T=f.useRef(null),A=f.useRef([]),R=f.useRef(0),L=f.useRef([]),M=f.useRef(!0),$=f.useRef(null),D=f.useRef(0),z="number"==typeof c?`${c}px`:c;return f.useEffect(()=>{const e=w.current,t=k.current;if(!e||!t)return;const r=new ResizeObserver(()=>{const r=t.getBoundingClientRect(),n=window.devicePixelRatio||1;e.width=r.width*n,e.height=r.height*n,e.style.width=`${r.width}px`,e.style.height=`${r.height}px`;const o=e.getContext("2d");o&&o.scale(n,n),$.current=null,D.current=r.width,M.current=!0});return r.observe(t),()=>r.disconnect()},[]),f.useEffect(()=>{if(t&&!e){let e=0;R.current=0;const t=()=>{var r;e+=.03,R.current=Math.min(1,R.current+.02);const a=[],s=Math.floor(((null==(r=k.current)?void 0:r.getBoundingClientRect().width)||200)/(n+o));if("static"===g){const t=Math.floor(s/2);for(let r=0;r<s;r++){const n=(r-t)/t,o=1-.4*Math.abs(n),s=(.2+(.25*Math.sin(1.5*e+3*n)+.2*Math.sin(.8*e-2*n)+.15*Math.cos(2*e+n)))*o;let i=s;if(A.current.length>0&&R.current<1){const e=Math.min(r,A.current.length-1);i=(A.current[e]||0)*(1-R.current)+s*R.current}a.push(Math.max(.05,Math.min(1,i)))}}else for(let t=0;t<s;t++){const r=(t-s/2)/(s/2),n=1-.4*Math.abs(r),o=(.2+(.25*Math.sin(1.5*e+.15*t)+.2*Math.sin(.8*e-.1*t)+.15*Math.cos(2*e+.05*t)))*n;let i=o;if(A.current.length>0&&R.current<1){const e=Math.floor(t/s*A.current.length);i=(A.current[e]||0)*(1-R.current)+o*R.current}a.push(Math.max(.05,Math.min(1,i)))}"static"===g?L.current=a:S.current=a,M.current=!0,T.current=requestAnimationFrame(t)};return t(),()=>{T.current&&cancelAnimationFrame(T.current)}}if(!e&&!t){if("static"===g?L.current.length>0:S.current.length>0){let e=0;const t=()=>{e+=.03,e<1?("static"===g?L.current=L.current.map(t=>t*(1-e)):S.current=S.current.map(t=>t*(1-e)),M.current=!0,requestAnimationFrame(t)):"static"===g?L.current=[]:S.current=[]};t()}}},[t,e,n,o,g]),f.useEffect(()=>{if(!e)return C.current&&(C.current.getTracks().forEach(e=>e.stop()),C.current=null,null==x||x()),N.current&&"closed"!==N.current.state&&(N.current.close(),N.current=null),void(_.current&&(cancelAnimationFrame(_.current),_.current=0));return(async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:r?{deviceId:{exact:r},echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});C.current=e,null==y||y(e);const t=new(window.AudioContext||window.webkitAudioContext),n=t.createAnalyser();n.fftSize=m,n.smoothingTimeConstant=u;t.createMediaStreamSource(e).connect(n),N.current=t,P.current=n,S.current=[]}catch(e){null==b||b(e)}})(),()=>{C.current&&(C.current.getTracks().forEach(e=>e.stop()),C.current=null,null==x||x()),N.current&&"closed"!==N.current.state&&(N.current.close(),N.current=null),_.current&&(cancelAnimationFrame(_.current),_.current=0)}},[e,r,m,u,b,y,x]),f.useEffect(()=>{const r=w.current;if(!r)return;const c=r.getContext("2d");if(!c)return;let u;const m=f=>{const b=r.getBoundingClientRect();if(e&&f-E.current>h&&(E.current=f,P.current)){const e=new Uint8Array(P.current.frequencyBinCount);if(P.current.getByteFrequencyData(e),"static"===g){const t=Math.floor(.05*e.length),r=Math.floor(.4*e.length),a=e.slice(t,r),s=Math.floor(b.width/(n+o)),i=Math.floor(s/2),l=[];for(let e=i-1;e>=0;e--){const t=Math.floor(e/i*a.length),r=Math.min(1,a[t]/255*d);l.push(Math.max(.05,r))}for(let e=0;e<i;e++){const t=Math.floor(e/i*a.length),r=Math.min(1,a[t]/255*d);l.push(Math.max(.05,r))}L.current=l,A.current=l}else{let t=0;const r=Math.floor(.05*e.length),n=Math.floor(.4*e.length),o=e.slice(r,n);for(let e=0;e<o.length;e++)t+=o[e];const a=t/o.length/255*d;S.current.push(Math.min(1,Math.max(.05,a))),A.current=[...S.current],S.current.length>p&&S.current.shift()}M.current=!0}if(!M.current&&!e)return void(u=requestAnimationFrame(m));M.current=e,c.clearRect(0,0,b.width,b.height);const y=s||getComputedStyle(r).color||"#000",x=n+o,v=Math.floor(b.width/x),j=b.height/2;if("static"===g){const r=t||e||L.current.length>0?L.current:[];for(let e=0;e<v&&e<r.length;e++){const t=r[e]||.1,o=e*x,s=Math.max(4,t*b.height*.8),i=j-s/2;c.fillStyle=y,c.globalAlpha=.4+.6*t,a>0?(c.beginPath(),c.roundRect(o,i,n,s,a),c.fill()):c.fillRect(o,i,n,s)}}else for(let e=0;e<v&&e<S.current.length;e++){const t=S.current.length-1-e,r=S.current[t]||.1,o=b.width-(e+1)*x,s=Math.max(4,r*b.height*.8),i=j-s/2;c.fillStyle=y,c.globalAlpha=.4+.6*r,a>0?(c.beginPath(),c.roundRect(o,i,n,s,a),c.fill()):c.fillRect(o,i,n,s)}if(i&&l>0&&b.width>0){if(!$.current||D.current!==b.width){const e=c.createLinearGradient(0,0,b.width,0),t=Math.min(.3,l/b.width);e.addColorStop(0,"rgba(255,255,255,1)"),e.addColorStop(t,"rgba(255,255,255,0)"),e.addColorStop(1-t,"rgba(255,255,255,0)"),e.addColorStop(1,"rgba(255,255,255,1)"),$.current=e,D.current=b.width}c.globalCompositeOperation="destination-out",c.fillStyle=$.current,c.fillRect(0,0,b.width,b.height),c.globalCompositeOperation="source-over"}c.globalAlpha=1,u=requestAnimationFrame(m)};return u=requestAnimationFrame(m),()=>{u&&cancelAnimationFrame(u)}},[e,t,d,h,p,n,o,a,s,i,l,g]),O.jsxs("div",{className:I("relative h-full w-full",v),ref:k,style:{height:z},"aria-label":e?"Live audio waveform":t?"Processing audio":"Audio waveform idle",role:"img",...j,children:[!e&&!t&&O.jsx("div",{className:"border-muted-foreground/20 absolute top-1/2 right-0 left-0 -translate-y-1/2 border-t-2 border-dotted"}),O.jsx("canvas",{className:"block h-full w-full",ref:w,"aria-hidden":"true"})]})},Xr=()=>{var e,t,r,n,o,a,s;const i=z(),l=i.testId||i.testName,c=B(),{profile:d}=q(),{toast:u}=F(),m=U(),[p,h]=f.useState(null),[g,b]=f.useState([]),[y,x]=f.useState(1),[v,j]=f.useState(0),[w,k]=f.useState(!0),[S,P]=f.useState(!1),[N,C]=f.useState(!1),[_,E]=f.useState(!1),[T,A]=f.useState(null),[R,L]=f.useState(null),[M,$]=f.useState(0),[I,D]=f.useState(60),[Ce,qe]=f.useState({}),[Fe,Ue]=f.useState("");f.useState(!1),f.useState("");const[We,He]=f.useState(!1),[Ve,Ye]=f.useState("en");f.useEffect(()=>{(async()=>{if(null==d?void 0:d.id)try{const{data:e}=await _e.from("user_preferences").select("preferred_feedback_language, native_language").eq("user_id",d.id).maybeSingle(),t=e,r=(null==t?void 0:t.preferred_feedback_language)||(null==t?void 0:t.native_language);r&&Oe.find(e=>e.value===r)&&Ye(r)}catch(e){console.warn("Error loading user preferred language:",e)}})()},[null==d?void 0:d.id]);const[Ge,Xe]=f.useState(!1),[Ke,Qe]=f.useState(!1),[Ze,Je]=f.useState(!1),[et,tt]=f.useState(!1),[rt,nt]=f.useState(!1),[ot,at]=f.useState([{id:"1",type:"bot",content:"Hello! I'm Catie, your expert IELTS Speaking tutor. I'm here to guide you through strategic speaking techniques, structure, and vocabulary enhancement. What specific aspect of your speaking would you like to work on?",timestamp:new Date}]),[st,it]=f.useState(""),[lt,ct]=f.useState(!1),[dt,ut]=f.useState(!1),[mt,pt]=f.useState(null),ht=f.useRef(null),ft=f.useRef(null),gt=f.useRef(null),bt=f.useRef([]),yt=f.useRef(null),xt=f.useRef(null),vt=(()=>{try{const e="undefined"!=typeof window?window.localStorage.getItem("appAudioVolume"):null,t=(e?parseInt(e,10):100)/100;return Number.isFinite(t)?Math.min(1,Math.max(0,t)):1}catch{return 1}})(),jt=f.useRef(vt);f.useEffect(()=>(l?(wt(),at([{id:"1",type:"bot",content:"Hello! I'm Catie, your expert IELTS Speaking tutor. I'm here to guide you through strategic speaking techniques, structure, and vocabulary enhancement. What specific aspect of your speaking would you like to work on?",timestamp:new Date}])):kt(),()=>{gt.current&&clearInterval(gt.current)}),[l]),f.useEffect(()=>(M>0?gt.current=setTimeout(()=>$(M-1),1e3):0===M&&S&&Pt(),()=>{gt.current&&clearTimeout(gt.current)}),[M,S]),f.useEffect(()=>{const e=e=>{var t;const r=null==(t=null==e?void 0:e.detail)?void 0:t.volume;"number"==typeof r&&(jt.current=r,ft.current&&(ft.current.volume=r))};return window.addEventListener("app:volume-change",e),()=>window.removeEventListener("app:volume-change",e)},[]),f.useEffect(()=>{ot.length>0&&setTimeout(()=>{const e=document.querySelector("[data-conversation-content]");e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},100)},[ot]),f.useEffect(()=>{Je(!1)},[v,y]),f.useEffect(()=>{if(yt.current){const e=yt.current;e.style.setProperty("transform","scale(1)","important"),e.style.setProperty("transition","none","important");const t=t=>{e.style.setProperty("transform","scale(1)","important"),e.style.setProperty("box-shadow","0 8px 32px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.1)","important"),e.style.setProperty("transition","none","important")};return e.addEventListener("mouseenter",t),e.addEventListener("mouseleave",t),()=>{e.removeEventListener("mouseenter",t),e.removeEventListener("mouseleave",t)}}},[p,y,v]);const wt=async()=>{if(l){k(!0);try{console.log(` Loading speaking test data for test ID: ${l}`);const e=l.includes("-")&&36===l.length,[t,r]=await Promise.all([e?_e.from("tests").select("id, test_name").eq("id",l).single():_e.from("tests").select("id, test_name").eq("test_name",l).eq("test_type","IELTS").eq("module","Speaking").maybeSingle(),_e.from("speaking_prompts").select("*").eq("test_id",l).order("part_number",{ascending:!0})]);if(t.error)throw t.error;const n=t.data;if(!n)return u({title:"Test Not Found",description:"This speaking test doesn't exist. Please check the test ID.",variant:"destructive"}),void c(-1);console.log(" Test loaded:",n.test_name);let o=r.data||[];if(0===o.length&&n.id!==l){const{data:e}=await _e.from("speaking_prompts").select("*").eq("test_id",n.id).order("part_number",{ascending:!0});o=e||[]}console.log(` Loaded ${o.length} total speaking prompts`);const a=[];let s=null;const i=[];o.forEach(e=>{1===e.part_number?a.push(e):2===e.part_number?s=e:3===e.part_number&&i.push(e)}),h({id:n.id,test_name:n.test_name,part1_prompts:a,part2_prompt:s,part3_prompts:i}),console.log(` Test ready: Part 1 (${a.length}), Part 2 (${s?1:0}), Part 3 (${i.length})`)}catch(e){console.error(" Error:",e),l&&h({id:l,test_name:"Speaking Test",part1_prompts:[],part2_prompt:null,part3_prompts:[]})}finally{k(!1)}}},kt=async()=>{k(!0);try{console.log(" Loading available speaking tests...");const{data:e,error:t}=await _e.from("tests").select("id, test_name, module, skill_category, created_at, speaking_prompts!inner(id)").eq("test_type","IELTS").order("created_at",{ascending:!1}).limit(50);if(t)throw console.error(" Error loading tests:",t),t;const r=(e||[]).filter(e=>{const t=(e.test_name||"").trim();return t&&t.length>=2&&!t.toLowerCase().includes("quick test")&&!["test ?","another test?",""].includes(t.toLowerCase())});console.log(` Found ${r.length} valid speaking tests`),b(r)}catch(e){console.error(" Error loading tests:",e),u({title:"Error",description:"Failed to load available speaking tests",variant:"destructive"}),b([])}finally{k(!1)}},St=()=>{try{const e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),r=e.createOscillator(),n=e.createGain();t.type="sine",t.frequency.value=523,r.type="sine",r.frequency.value=659,t.connect(n),r.connect(n),n.connect(e.destination),n.gain.setValueAtTime(1e-4,e.currentTime),n.gain.exponentialRampToValueAtTime(.05,e.currentTime+.01),t.start(),r.start(),setTimeout(()=>{n.gain.exponentialRampToValueAtTime(1e-5,e.currentTime+.15),setTimeout(()=>{t.stop(),r.stop(),e.close()},200)},120)}catch{}},Pt=()=>{if(2===y&&xt.current){const e=Math.floor((Date.now()-xt.current)/1e3),t=60;if(e<t){const r=t-e;return void u({title:"Minimum Recording Time Required",description:`For IELTS Part 2, you should speak for at least 1 minute to receive a good score. Please continue recording for ${r} more second${1!==r?"s":""}.`,variant:"destructive",duration:5e3})}}St(),ht.current&&S&&(ht.current.stop(),$(0),xt.current=null)},Nt=()=>{if(R)try{R.pause(),R.currentTime=0,console.log(" Stopped recording playback")}catch(e){console.error("Error stopping recording playback:",e)}E(!1),A(null),L(null)},Ct=()=>{if(1===y)if(v<((null==p?void 0:p.part1_prompts.length)||0)-1)j(v+1),console.log(` Moving to Part 1, Question ${v+2}`);else{const e=!!(null==p?void 0:p.part2_prompt),t=!!((null==p?void 0:p.part3_prompts)&&p.part3_prompts.length>0);e||t?e?(x(2),j(0),D(60),console.log(" Moving to Part 2 - Long Turn"),_t()):t&&(x(3),j(0),console.log(" Moving to Part 3 - Discussion (no Part 2 for this test)")):(console.log(" Part 1-only test completed - prompting for feedback language (AI analysis after Part 1)."),He(!0))}else 2===y?(null==p?void 0:p.part3_prompts)&&p.part3_prompts.length>0?(x(3),j(0),console.log(" Moving to Part 3 - Discussion")):(console.log(" Part 2 completed - no Part 3 available, prompting for feedback language"),He(!0)):3===y&&(v<((null==p?void 0:p.part3_prompts.length)||0)-1?(j(v+1),console.log(` Moving to Part 3, Question ${v+2}`)):(console.log(" Last question completed - prompting for feedback language"),He(!0)))},_t=()=>{const e=setInterval(()=>{D(t=>t<=1?(clearInterval(e),u({title:"Preparation Time Complete",description:"You may now start recording your response.",duration:5e3}),0):t-1)},1e3)},Et=e=>`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`;if(w)return O.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:"dark"===m.theme.name?m.theme.colors.background:"transparent"},children:O.jsx(W,{size:"lg",message:"Loading speaking tests..."})});if(!l)return O.jsxs("div",{className:"min-h-screen relative",style:{backgroundColor:"dark"===m.theme.name?m.theme.colors.background:"transparent"},children:[O.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"note"===m.theme.name||"minimalist"===m.theme.name||"dark"===m.theme.name?"none":"url('https://raw.githubusercontent.com/AlfieAlfiegithu2/alfie-ai-coach/main/public/1000031207.png')",backgroundColor:m.backgroundImageColor}}),O.jsx("div",{className:"relative z-10",children:O.jsx(H,{title:"Available Speaking Tests",children:O.jsx("div",{className:"min-h-screen py-12",children:O.jsx("div",{className:"container mx-auto px-4",children:O.jsxs("div",{className:"max-w-4xl mx-auto",children:[O.jsx("div",{className:"mb-8 text-center",children:O.jsx("h1",{className:"text-4xl font-bold mb-2",style:{color:m.textPrimary},children:"IELTS speaking tests"})}),g.length>0?O.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:g.map(e=>O.jsx(V,{className:"cursor-pointer h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg flex items-center justify-center",onClick:()=>c(`/ielts-speaking-test/${e.id}`),style:{backgroundColor:"glassmorphism"===m.theme.name?"rgba(255,255,255,0.8)":"dark"===m.theme.name?"rgba(255,255,255,0.1)":"minimalist"===m.theme.name?"#ffffff":m.theme.colors.cardBackground,borderColor:m.border,...m.cardStyle},children:O.jsx(Y,{className:"p-3 md:p-4 text-center flex items-center justify-center h-full",children:O.jsx("h3",{className:"font-semibold text-sm",style:{color:m.textPrimary},children:e.test_name})})},e.id))}):O.jsxs("div",{className:"text-center py-12",children:[O.jsx("p",{className:"text-lg mb-4",style:{color:m.textSecondary},children:"No speaking tests available yet"}),O.jsx(G,{onClick:()=>c("/ielts-portal"),variant:"outline",style:{borderColor:m.border,color:m.textPrimary,backgroundColor:"glassmorphism"===m.theme.name||"dark"===m.theme.name?"rgba(255,255,255,0.1)":"minimalist"===m.theme.name?"#ffffff":m.theme.colors.cardBackground},onMouseEnter:e=>e.currentTarget.style.backgroundColor=m.hoverBg,onMouseLeave:e=>e.currentTarget.style.backgroundColor="glassmorphism"===m.theme.name||"dark"===m.theme.name?"rgba(255,255,255,0.1)":"minimalist"===m.theme.name?"#ffffff":m.theme.colors.cardBackground,children:"Back to Portal"})]})]})})})})})]});if(!p)return O.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:O.jsxs("div",{className:"text-center",children:[O.jsx("p",{className:"text-lg text-muted-foreground",children:"Test not found"}),O.jsx(G,{onClick:()=>c("/ielts-portal"),className:"mt-4",children:"Back to Portal"})]})});if(0===p.part1_prompts.length&&!p.part2_prompt&&0===p.part3_prompts.length)return O.jsx(H,{title:`IELTS Speaking - ${p.test_name}`,showBackButton:!0,children:O.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[O.jsxs("div",{className:"text-center",children:[O.jsx(X,{variant:"outline",className:"mb-4 px-4 py-1 text-primary border-primary/20",children:"IELTS SPEAKING TEST"}),O.jsx("h1",{className:"text-heading-2 mb-2",children:p.test_name})]}),O.jsx(K,{className:"card-modern",children:O.jsxs(Y,{className:"p-8 text-center",children:[O.jsx(Q,{className:"w-16 h-16 mx-auto mb-4 text-gray-400 dark:text-gray-500"}),O.jsx("h2",{className:"text-xl font-semibold mb-2",children:"No Speaking Content Available"}),O.jsx("p",{className:"text-muted-foreground mb-6",children:"This test doesn't have speaking content created yet. Please contact your administrator or try another test."}),O.jsxs("div",{className:"flex gap-4 justify-center",children:[O.jsx(G,{onClick:()=>c("/ielts-portal"),variant:"outline",children:"Back to Portal"}),O.jsx(G,{onClick:()=>c("/speaking"),children:"Try General Speaking Practice"})]})]})})]})});const Ot=()=>1===y?p.part1_prompts[v]:2===y?p.part2_prompt:3===y?p.part3_prompts[v]:null,Tt=()=>{const e=Ot();return e?2===y?e.prompt_text||"":e.transcription||e.title||"":""},At=async e=>{const t=e||st.trim();if(!t||lt)return;const r={id:Date.now().toString(),type:"user",content:t,timestamp:new Date};at(e=>[...e,r]),e||it(""),ct(!0);try{const e=Tt(),r=`CONTEXT: The student is practicing IELTS Speaking Part ${y}.\n\nQuestion: "${e}"\n\nPlease provide concise, practical speaking guidance (ideas, vocabulary, structure). Do NOT write a full answer.`,n=ot.filter(e=>"user"===e.type||"bot"===e.type).map(e=>({role:"user"===e.type?"user":"assistant",content:e.content}));n.push({role:"user",content:t});const{data:o,error:a}=await _e.functions.invoke("openai-chat",{body:{skipCache:!0,messages:[{role:"system",content:r},...n],context:"catbot"}});if(a)throw a;const s={id:(Date.now()+1).toString(),type:"bot",content:o.response,timestamp:new Date};at(e=>[...e,s])}catch(n){console.error("Error sending chat message:",n),u({title:"Error",description:"Failed to get response from Catie",variant:"destructive"})}finally{ct(!1)}},Rt=e=>{At(e)},Lt=Ot(),Mt=Tt(),$t=1===y?"Part 1":2===y?"Part 2":3===y?"Part 3":"Unknown Part";return O.jsxs("div",{className:"min-h-screen relative",style:{backgroundColor:"dark"===m.theme.name?m.theme.colors.background:"transparent"},children:[O.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"note"===m.theme.name||"minimalist"===m.theme.name||"dark"===m.theme.name?"none":"url('https://raw.githubusercontent.com/AlfieAlfiegithu2/alfie-ai-coach/main/public/1000031207.png')",backgroundColor:m.backgroundImageColor}}),O.jsx("div",{className:"relative z-10 min-h-screen flex flex-col",style:{backgroundColor:"dark"===m.theme.name?m.theme.colors.background:"transparent"},children:O.jsx(H,{title:`IELTS Speaking - ${p.test_name}`,showBackButton:!0,children:O.jsx("div",{className:"flex-1 flex justify-center min-h-[calc(100vh-120px)] py-8 sm:items-center sm:py-8",children:O.jsxs("div",{className:"w-full max-w-4xl mx-auto space-y-4 px-4 flex flex-col",children:[O.jsx("div",{className:"text-center py-2 sm:py-2 sm:mb-0 mb-0",children:O.jsxs("span",{className:"text-lg font-semibold",style:{color:m.textPrimary},children:["Part ",y]})}),O.jsxs(K,{ref:yt,className:"backdrop-blur-sm shadow-lg rounded-2xl flex flex-col relative",style:{backgroundColor:"glassmorphism"===m.theme.name?"rgba(255,255,255,0.9)":"dark"===m.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===m.theme.name?"#ffffff":m.theme.colors.cardBackground,borderColor:m.border,backdropFilter:"glassmorphism"===m.theme.name?"blur(12px)":"dark"===m.theme.name?"blur(8px)":"none",boxShadow:"dark"===m.theme.name?"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)":"note"===m.theme.name?null==(e=m.theme.styles.cardStyle)?void 0:e.boxShadow:"0 8px 32px rgba(15, 23, 42, 0.16), 0 0 0 1px rgba(148, 163, 253, 0.06)",...m.cardStyle},children:[O.jsx(Z,{children:O.jsxs(J,{className:"flex items-center justify-between",children:[O.jsx("span",{}),O.jsxs("div",{className:"flex items-center gap-3",children:[(1===y||3===y)&&O.jsx(ee,{children:O.jsxs(te,{children:[O.jsx(re,{asChild:!0,children:O.jsx("div",{onClick:()=>Je(!Ze),className:"relative inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background",style:{backgroundColor:Ze?m.buttonPrimary:"glassmorphism"===m.theme.name?"rgba(255,255,255,0.2)":"dark"===m.theme.name?"rgba(255,255,255,0.1)":"minimalist"===m.theme.name?"#e5e7eb":m.border},"data-state":Ze?"checked":"unchecked",children:O.jsx("div",{className:"pointer-events-none flex h-5 w-5 rounded-full shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0 items-center justify-center",style:{backgroundColor:"glassmorphism"===m.theme.name?"rgba(255,255,255,0.95)":"dark"===m.theme.name?"rgba(255,255,255,0.9)":"minimalist"===m.theme.name?"#ffffff":m.theme.colors.cardBackground},"data-state":Ze?"checked":"unchecked",children:Ze?O.jsx(ne,{className:"w-3 h-3",style:{color:"white"}}):O.jsx(oe,{className:"w-3 h-3",style:{color:m.textSecondary}})})})}),O.jsx(ae,{children:O.jsx("p",{children:Ze?"Hide question":"Show question"})})]})}),M>0&&O.jsxs(X,{variant:"outline",className:"flex items-center gap-2",style:{borderColor:m.border,backgroundColor:"glassmorphism"===m.theme.name?"rgba(255,255,255,0.1)":"dark"===m.theme.name?"rgba(255,255,255,0.05)":"minimalist"===m.theme.name?"#ffffff":m.theme.colors.cardBackground,color:m.textPrimary},children:[O.jsx(se,{className:"w-4 h-4",style:{color:m.textPrimary}}),Et(M)]})]})]})}),O.jsxs(Y,{className:"space-y-4 flex flex-col relative",children:[2===y&&I>0&&O.jsx("div",{className:"text-center",children:O.jsxs("div",{className:"flex items-center justify-center gap-2",children:[O.jsx(se,{className:"w-5 h-5",style:{color:m.buttonPrimary}}),O.jsx("p",{className:"text-xl font-bold",style:{color:m.buttonPrimary},children:Et(I)})]})}),1===y&&p.part1_prompts.length>0&&O.jsx("div",{className:"space-y-6 relative flex flex-col min-h-[200px]",children:O.jsx("div",{className:"min-h-[200px] flex items-center justify-center flex-1",children:Ze&&O.jsx("div",{className:"text-lg font-medium text-center select-none",style:{color:m.textPrimary},children:Tt()})})}),3===y&&p.part3_prompts.length>0&&O.jsx("div",{className:"space-y-6 relative flex flex-col min-h-[200px]",children:O.jsx("div",{className:"min-h-[200px] flex items-center justify-center flex-1",children:Ze&&O.jsx("div",{className:"text-lg font-medium text-center select-none",style:{color:m.textPrimary},children:Tt()})})}),2===y&&Lt&&O.jsxs("div",{className:"p-6 rounded-lg",style:{backgroundColor:"glassmorphism"===m.theme.name?"rgba(255,255,255,0.1)":"dark"===m.theme.name?"rgba(255,255,255,0.05)":"minimalist"===m.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:m.border,borderWidth:"1px",borderStyle:"solid"},children:[O.jsx("h3",{className:"font-semibold mb-3",style:{color:m.textPrimary},children:"Cue Card"}),O.jsx("div",{className:"whitespace-pre-wrap text-sm leading-relaxed",style:{color:m.textSecondary},children:Lt.prompt_text})]}),2===y&&O.jsxs(O.Fragment,{children:[I>0&&O.jsxs("div",{className:"relative rounded-lg p-4",style:{backgroundColor:"glassmorphism"===m.theme.name?"rgba(255,255,255,0.1)":"dark"===m.theme.name?"rgba(255,255,255,0.05)":"minimalist"===m.theme.name?"#fef3c7":"#FEF9E7",borderColor:m.border,borderWidth:"1px",borderStyle:"solid"},children:[O.jsx(ee,{children:O.jsxs(te,{children:[O.jsx(re,{asChild:!0,children:O.jsx(G,{variant:"ghost",size:"icon",onClick:()=>{D(e=>e+60)},className:"absolute top-2 right-2 h-8 w-8",style:{color:m.buttonPrimary},children:O.jsx(ie,{className:"w-4 h-4"})})}),O.jsx(ae,{children:O.jsx("p",{children:"Add 1 minute for notes"})})]})}),O.jsx("textarea",{placeholder:"Write your preparation notes here...",value:Fe,onChange:e=>Ue(e.target.value),className:"w-full h-32 p-3 bg-transparent resize-none focus:outline-none",style:{color:m.textPrimary}}),O.jsx("style",{dangerouslySetInnerHTML:{__html:`\n                      textarea[placeholder="Write your preparation notes here..."]::placeholder {\n                        color: ${m.textSecondary};\n                      }\n                    `}})]}),0===I&&Fe&&O.jsxs("div",{className:"relative rounded-lg p-4",style:{backgroundColor:"glassmorphism"===m.theme.name?"rgba(255,255,255,0.1)":"dark"===m.theme.name?"rgba(255,255,255,0.05)":"minimalist"===m.theme.name?"#fef3c7":"#FEF9E7",borderColor:m.border,borderWidth:"1px",borderStyle:"solid"},children:[!S&&O.jsx(ee,{children:O.jsxs(te,{children:[O.jsx(re,{asChild:!0,children:O.jsx(G,{variant:"ghost",size:"icon",onClick:()=>{D(60),_t()},className:"absolute top-2 right-2 h-8 w-8 text-primary",children:O.jsx(ie,{className:"w-4 h-4"})})}),O.jsx(ae,{children:O.jsx("p",{children:"Add 1 minute for notes"})})]})}),O.jsx("div",{className:"p-3 text-sm whitespace-pre-wrap",children:Fe})]})]}),(2===y&&0===I||2!==y)&&O.jsx("div",{className:"text-center min-h-[80px] flex items-center justify-center relative",children:S?O.jsxs(O.Fragment,{children:[O.jsx("div",{className:"absolute -top-5 left-1/2 -translate-x-1/2 w-[130px] sm:w-[180px]",children:O.jsx(Gr,{active:!0,height:55,barWidth:6,barGap:2,barRadius:3,mode:"static",fadeEdges:!1,barColor:"#2563eb",sensitivity:1.2,fftSize:256,historySize:60,updateRate:30})}),O.jsx(G,{onClick:Pt,variant:"outline",size:"icon",className:"rounded-xl h-8 w-8 absolute bottom-0 left-1/2 transform -translate-x-1/2",style:{borderColor:m.border,color:m.buttonPrimary,backgroundColor:"glassmorphism"===m.theme.name?"rgba(255,255,255,0.9)":"dark"===m.theme.name?"rgba(255,255,255,0.15)":"minimalist"===m.theme.name?"#ffffff":m.theme.colors.cardBackground||"#ffffff"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=m.hoverBg||"rgba(0,0,0,0.05)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===m.theme.name?"rgba(255,255,255,0.9)":"dark"===m.theme.name?"rgba(255,255,255,0.15)":"minimalist"===m.theme.name?"#ffffff":m.theme.colors.cardBackground||"#ffffff"},children:O.jsx(le,{className:"w-4 h-4",style:{color:m.buttonPrimary||"#2563eb"}})})]}):O.jsx(ee,{children:O.jsxs("div",{className:"flex items-center justify-center gap-3",children:[O.jsxs(te,{children:[O.jsx(re,{asChild:!0,children:O.jsx(G,{onClick:async()=>{try{St(),await new Promise(e=>setTimeout(e,100));const e=await navigator.mediaDevices.getUserMedia({audio:!0});ht.current=new MediaRecorder(e),bt.current=[],ht.current.ondataavailable=e=>{e.data.size>0&&bt.current.push(e.data)},ht.current.onstop=()=>{const t=new Blob(bt.current,{type:"audio/webm"}),r=`part${y}_q${v}`;console.log(` Saving recording for ${r}, blob size: ${t.size}`),qe(e=>{const n={...e,[r]:t};return console.log(" Recordings updated:",Object.keys(n)),n}),P(!1),e.getTracks().forEach(e=>e.stop())},ht.current.start(),P(!0),xt.current=Date.now(),(1===y||3===y||2===y)&&$(120)}catch(e){console.error("Error starting recording:",e),u({title:"Recording Error",description:"Failed to start recording. Please check microphone permissions.",variant:"destructive"})}},variant:"outline",className:"rounded-xl shadow-sm h-12 w-12",size:"icon",style:{backgroundColor:"glassmorphism"===m.theme.name?"rgba(255,255,255,0.8)":"dark"===m.theme.name?"rgba(255,255,255,0.1)":"minimalist"===m.theme.name?"#ffffff":m.theme.colors.cardBackground,borderColor:m.border,color:m.textPrimary},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=m.hoverBg,e.currentTarget.style.color=m.buttonPrimary},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===m.theme.name?"rgba(255,255,255,0.8)":"dark"===m.theme.name?"rgba(255,255,255,0.1)":"minimalist"===m.theme.name?"#ffffff":m.theme.colors.cardBackground,e.currentTarget.style.color=m.textPrimary},children:O.jsx(Q,{className:"w-5 h-5"})})}),O.jsx(ae,{children:O.jsx("p",{children:"Start recording your answer"})})]}),(null==Lt?void 0:Lt.audio_url)&&O.jsxs(te,{children:[O.jsx(re,{asChild:!0,children:O.jsx(G,{onClick:()=>{const e=Ot();(null==e?void 0:e.audio_url)&&(console.log(` Repeating audio for Part ${y}`),(async e=>{var t;if(e){et||(tt(!0),nt(!1));try{C(!0),ft.current&&(ft.current.pause(),ft.current.currentTime=0,ft.current=null);const t=new Audio(e);t.preload="auto",t.volume=jt.current,t.onended=()=>{C(!1),console.log(" Audio playback completed"),ft.current=null},t.onerror=e=>{C(!1),console.error("Audio playback error:",e),ft.current=null,u({title:"Audio Error",description:"Failed to play audio prompt. The audio may be inaudible or unavailable.",variant:"destructive"})},t.onloadstart=()=>{console.log("Audio loading started")},t.oncanplay=()=>{console.log("Audio can play")},t.oncanplaythrough=()=>{console.log("Audio can play through")},ft.current=t,console.log(` Playing audio: ${e}`),t.load(),await new Promise(e=>setTimeout(e,100));const r=t.play();void 0!==r&&(await r,console.log("Audio started playing successfully"))}catch(r){console.error("Error playing audio:",r),C(!1),"NotAllowedError"===r.name||(null==(t=r.message)?void 0:t.includes("user didn't interact"))?(et||nt(!0),console.log("Autoplay blocked - user needs to interact first")):u({title:"Audio Error",description:"Failed to play audio prompt. The audio may be inaudible or unavailable. Please try again.",variant:"destructive"}),ft.current&&(ft.current=null)}}})(e.audio_url))},disabled:N,variant:"outline",size:"icon",className:"h-12 w-12 rounded-xl",style:{borderColor:m.border,color:m.buttonPrimary,backgroundColor:"transparent"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=m.hoverBg},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:N?O.jsx(ce,{className:"w-5 h-5"}):O.jsx(de,{className:"w-5 h-5"})})}),O.jsx(ae,{children:O.jsx("p",{children:N?"Pause question audio":"Play question audio"})})]}),Ce[`part${y}_q${v}`]&&O.jsxs(te,{children:[O.jsx(re,{asChild:!0,children:O.jsx(G,{onClick:()=>{_&&T===`part${y}_q${v}`?Nt():(async e=>{const t=Ce[e];if(t)try{R&&Nt();const r=URL.createObjectURL(t),n=new Audio(r);n.volume=jt.current,L(n),n.onended=()=>{URL.revokeObjectURL(r),E(!1),A(null),L(null),console.log(` Recording playback ended: ${e}`)},n.onerror=()=>{URL.revokeObjectURL(r),E(!1),A(null),L(null),console.error(` Recording playback error: ${e}`),u({title:"Playback Error",description:"Failed to play your recording. The audio may be inaudible or corrupted.",variant:"destructive"})},await n.play(),E(!0),A(e),console.log(` Started recording playback: ${e}`)}catch(r){console.error("Error playing recording:",r),E(!1),A(null),L(null),u({title:"Playback Error",description:"Failed to play your recording",variant:"destructive"})}})(`part${y}_q${v}`)},variant:"outline",size:"icon",className:"h-12 w-12 rounded-xl",style:{borderColor:m.border,color:m.buttonPrimary,backgroundColor:"transparent"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=m.hoverBg},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:_&&T===`part${y}_q${v}`?O.jsx(ce,{className:"w-5 h-5"}):O.jsx(ue,{className:"w-5 h-5"})})}),O.jsx(ae,{children:O.jsx("p",{children:_&&T===`part${y}_q${v}`?"Stop listening to your recording":"Listen to your recorded answer"})})]}),(console.log(" DEBUG: Checking evaluate button condition",{currentPart:y,currentQuestion:v,key:`part${y}_q${v}`,hasRecording:!!Ce[`part${y}_q${v}`],allRecordingKeys:Object.keys(Ce),recordingValue:Ce[`part${y}_q${v}`]}),null),Ce[`part${y}_q${v}`]&&O.jsxs(O.Fragment,{children:[(console.log(" Rendering Evaluate Button",{key:`part${y}_q${v}`,recording:Ce[`part${y}_q${v}`]}),null),O.jsxs(te,{children:[O.jsx(re,{asChild:!0,children:O.jsxs(G,{onClick:async()=>{const e=`part${y}_q${v}`,t=Ce[e];if(console.log(" EVALUATE: Current part:",y),console.log(" EVALUATE: Current question:",v),console.log(" EVALUATE: Recording key:",e),console.log(" EVALUATE: Recording exists:",!!t),console.log(" EVALUATE: Recording size:",null==t?void 0:t.size),console.log(" EVALUATE: All recording keys:",Object.keys(Ce)),t){ut(!0),pt(null);try{const r=new FileReader;r.readAsDataURL(t),r.onloadend=async()=>{const t=r.result.split(",")[1],n=Tt();console.log(" Sending to Edge Function:",{audioLength:t.length,prompt:n,recordingKey:e});const{data:o,error:a}=await _e.functions.invoke("ielts-speaking-evaluator",{body:{audio:t,prompt:n}});if(a)throw a;console.log(" Evaluation received:",o),pt(o)}}catch(r){console.error("Evaluation error:",r),u({title:"Evaluation Failed",description:(null==r?void 0:r.message)||"Could not evaluate the recording. Please try again.",variant:"destructive"})}finally{ut(!1)}}else console.error(" No recording found for",e)},disabled:dt,variant:"outline",className:"h-12 px-4 rounded-xl gap-2",style:{borderColor:m.border,color:m.buttonPrimary,backgroundColor:dt?"dark"===m.theme.name?"rgba(59, 130, 246, 0.2)":"#eff6ff":"transparent",animation:dt?"pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite":"none"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=m.hoverBg},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[dt?O.jsx(me,{className:"w-5 h-5 animate-spin"}):O.jsx(me,{className:"w-5 h-5"}),O.jsx("span",{className:"font-medium",children:dt?"Analyzing...":"Evaluate AI"})]})}),O.jsx(ae,{children:O.jsx("p",{children:dt?"Evaluating your answer...":"Get AI feedback on this answer"})})]})]})]})})}),mt&&O.jsxs("div",{className:"mt-8 p-6 rounded-2xl border-2 animate-in fade-in slide-in-from-top-4 duration-500 max-w-3xl mx-auto text-left shadow-lg",style:{borderColor:m.border,backgroundColor:m.theme.colors.cardBackground||"#ffffff",color:m.textPrimary},children:[O.jsxs("div",{className:"flex items-center justify-between mb-6",children:[O.jsxs("div",{className:"flex items-center gap-3",children:[O.jsxs("div",{className:"relative",children:[O.jsx("img",{src:"/cat.png",alt:"Catie AI",className:"w-12 h-12 rounded-full shadow-md",style:{border:`2px solid ${m.buttonPrimary}`}}),O.jsx("div",{className:"absolute -bottom-1 -right-1 w-5 h-5 rounded-full flex items-center justify-center shadow-sm",style:{backgroundColor:m.buttonPrimary},children:O.jsx(me,{className:"w-3 h-3 text-white"})})]}),O.jsxs("div",{children:[O.jsx("h3",{className:"font-bold text-lg",style:{color:m.textPrimary},children:"Catie's Feedback"}),O.jsx("p",{className:"text-xs opacity-60",children:"AI Speaking Coach"})]})]}),O.jsx(G,{variant:"ghost",size:"sm",onClick:()=>pt(null),className:"h-8 w-8 p-0 opacity-60 hover:opacity-100",children:O.jsx(pe,{className:"w-4 h-4"})})]}),O.jsxs("div",{className:"mb-6 space-y-4",children:[O.jsxs("div",{className:"bg-slate-50 rounded-xl p-3 sm:p-4 space-y-3",style:{backgroundColor:"dark"===m.theme.name?"rgba(255,255,255,0.05)":"#f8fafc"},children:[O.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2 text-xs",style:{color:m.textPrimary},children:[O.jsx(ue,{className:"w-3 h-3"}),"Your recorded answer"]}),Ce[`part${y}_q${v}`]?O.jsx(Ne,{src:URL.createObjectURL(Ce[`part${y}_q${v}`])}):O.jsx("div",{className:"text-xs italic p-3 rounded-lg border",style:{borderColor:m.border,color:m.textSecondary},children:"Audio recording not available"}),O.jsxs("div",{className:"mt-3",children:[O.jsx("p",{className:"text-xs mb-1 font-medium",style:{color:m.textSecondary},children:"Transcript:"}),O.jsx("div",{className:"rounded-lg p-3 border",style:{backgroundColor:"dark"===m.theme.name?"rgba(0,0,0,0.2)":"#ffffff",borderColor:m.border},children:O.jsxs("p",{className:"text-xs sm:text-sm leading-relaxed italic",style:{color:m.textPrimary},children:['"',mt.transcription,'"']})})]})]}),mt.pronunciation_analysis&&O.jsxs("div",{className:"rounded-xl overflow-hidden border shadow-sm",style:{backgroundColor:"dark"===m.theme.name?"#1e293b":"#ffffff",borderColor:m.border},children:[O.jsx("div",{className:"p-4 border-b",style:{borderColor:m.border},children:O.jsxs("h4",{className:"font-bold flex items-center gap-2 text-sm",style:{color:m.textPrimary},children:[O.jsx(he,{className:"w-4 h-4",style:{color:m.buttonPrimary}}),"Pronunciation Breakdown"]})}),O.jsxs("div",{className:"p-5 space-y-8",children:[O.jsxs("div",{className:"space-y-3",children:[O.jsx("p",{className:"text-xs font-bold uppercase tracking-wider opacity-70",style:{color:m.textSecondary},children:"What you said"}),O.jsx("div",{className:"flex flex-wrap gap-2",children:null==(t=mt.pronunciation_analysis.original_spans)?void 0:t.map((e,t)=>O.jsx("span",{className:"px-3 py-1.5 rounded-lg text-base transition-all duration-300 "+("suggestion"===e.status?"font-bold ring-2 ring-offset-1":"font-medium"),style:{backgroundColor:"suggestion"===e.status?"#fee2e2":"dark"===m.theme.name?"#334155":"#f1f5f9",color:"suggestion"===e.status?"#ef4444":"dark"===m.theme.name?"#e2e8f0":"#475569",borderColor:"transparent"},children:e.text},t))})]}),O.jsxs("div",{className:"space-y-3",children:[O.jsxs("p",{className:"text-xs font-bold uppercase tracking-wider opacity-70 flex items-center gap-2",style:{color:m.buttonPrimary},children:[O.jsx(me,{className:"w-3 h-3"}),"Better Flow"]}),O.jsx("div",{className:"flex flex-wrap gap-2",children:null==(r=mt.pronunciation_analysis.suggested_spans)?void 0:r.map((e,t)=>O.jsx("span",{className:"px-3 py-1.5 rounded-lg text-base transition-all duration-300 "+("enhancement"===e.status?"font-bold ring-2 ring-offset-1 shadow-md":"font-medium"),style:{backgroundColor:"enhancement"===e.status?"#dbeafe":"dark"===m.theme.name?"#334155":"#f1f5f9",color:"enhancement"===e.status?"#2563eb":"dark"===m.theme.name?"#e2e8f0":"#475569"},children:e.text},t))})]})]})]})]}),O.jsx("div",{className:"mb-8",children:O.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 items-center",children:[O.jsx("div",{className:"flex flex-col items-center justify-center p-4 bg-slate-50 rounded-2xl border border-slate-100 dark:bg-slate-900/50 dark:border-slate-800",children:O.jsx(Vr,{score:Math.round(Object.values(mt.metrics||{}).reduce((e,t)=>e+t,0)/(Object.keys(mt.metrics||{}).length||1)),label:"Overall",subLabel:"Speaking Score",size:160,color:m.buttonPrimary})}),O.jsx("div",{className:"flex flex-col items-center justify-center p-2 bg-slate-50 rounded-2xl border border-slate-100 dark:bg-slate-900/50 dark:border-slate-800 h-[200px]",children:O.jsx(Yr,{metrics:{pronunciation:(null==(n=mt.metrics)?void 0:n.pronunciation)||0,intonation:(null==(o=mt.metrics)?void 0:o.intonation)||0,stress:(null==(a=mt.metrics)?void 0:a.stress)||0,rhythm:(null==(s=mt.metrics)?void 0:s.rhythm)||0},height:180})})]})}),O.jsx(Pe,{className:"my-6",style:{backgroundColor:m.border}}),O.jsxs("div",{className:"space-y-2 mb-6",children:[O.jsxs("h3",{className:"font-semibold text-base flex items-center gap-2",style:{color:m.textPrimary},children:[O.jsx(fe,{className:"w-4 h-4",style:{color:m.buttonPrimary}}),"Feedback"]}),O.jsx("p",{className:"text-sm leading-relaxed",style:{color:m.textSecondary},children:mt.feedback})]}),O.jsxs("div",{className:"p-4 rounded-xl space-y-2 mb-6 border-2",style:{backgroundColor:"dark"===m.theme.name?"rgba(255,255,255,0.05)":"glassmorphism"===m.theme.name?"rgba(255,255,255,0.7)":"#f0f9ff",borderColor:`${m.buttonPrimary}40`},children:[O.jsxs("h3",{className:"font-semibold flex items-center gap-2 text-xs uppercase tracking-wide",style:{color:m.buttonPrimary},children:[O.jsx(me,{className:"w-3 h-3"}),"Band 8-9 Enhanced Version"]}),O.jsxs("p",{className:"text-base italic font-medium",style:{color:m.textPrimary},children:['"',mt.enhancedSentence,'"']})]}),O.jsxs("div",{className:"space-y-4",children:[O.jsx("h3",{className:"font-semibold text-base",style:{color:m.textPrimary},children:"Detailed Analysis"}),O.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:Object.entries(mt.detailedAnalysis||{}).map(([e,t])=>O.jsxs("div",{className:"border-2 p-3 rounded-xl",style:{borderColor:m.border,backgroundColor:"dark"===m.theme.name?"rgba(255,255,255,0.03)":"glassmorphism"===m.theme.name?"rgba(255,255,255,0.4)":"#ffffff"},children:[O.jsx("span",{className:"text-xs font-bold uppercase mb-1 block",style:{color:m.buttonPrimary},children:e}),O.jsx("p",{className:"text-xs leading-relaxed",style:{color:m.textSecondary},children:t})]},e))})]})]}),We&&O.jsx("div",{className:"flex justify-center mt-4",children:O.jsxs("div",{className:"flex items-center gap-3",children:[O.jsxs(ge,{value:Ve,onValueChange:Ye,children:[O.jsx(be,{className:"w-[90px] h-8 text-sm border-0 bg-transparent shadow-none p-0 focus:ring-0",style:{color:m.textPrimary,"--tw-ring-color":m.buttonPrimary},children:O.jsx(ye,{placeholder:"Language"})}),O.jsx(xe,{children:Oe.map(e=>O.jsx(ve,{value:e.value,children:e.label},e.value))})]}),O.jsx(G,{type:"button",onClick:()=>{try{localStorage.setItem("ielts_speaking_feedback_language",Ve||"en")}catch(e){console.warn("Unable to persist feedback language preference",e)}(async()=>{var e,t,r,n,o,a;try{const i=Object.entries(Ce);if(0===i.length)return void u({title:"No recordings found",description:"Please record answers before submitting.",variant:"destructive"});console.log(" Preparing speaking uploads:",{count:i.length,keys:i.map(([e])=>e)});const l=i.map(async([e,t],r)=>{var n,o,a,s,l,c,d,m,h,f,g,b,y,x,v,j;const w=(null==p?void 0:p.id)||"unknown",k=Date.now(),S=`speaking_${w}_${e}_${k}.webm`,P=new File([t],S,{type:"audio/webm"});try{console.log(` Uploading speaking recording [${r+1}/${i.length}]:`,{fileName:S,key:e,size:t.size});const u=await Ee.uploadSpeaking(P,w,e);if(!u.success)throw console.error(` R2 upload reported failure for ${S}:`,u.error),new Error(u.error||"Upload failed");u.url||console.warn(` R2 upload returned success but no URL for ${S}. Falling back to deterministic URL.`);const h=u.url||`https://placeholder-r2/${w}/speaking/${encodeURIComponent(e)}/${k}.webm`;console.log(` Speaking recording uploaded successfully: ${h}`);let f="";const g=e.match(/^part(\d+)_q(\d+)$/);if(g){const e=parseInt(g[1],10),t=parseInt(g[2],10);1===e&&(null==(n=null==p?void 0:p.part1_prompts)?void 0:n[t])?f=(null==(o=p.part1_prompts[t])?void 0:o.prompt_text)||(null==(a=p.part1_prompts[t])?void 0:a.transcription)||(null==(s=p.part1_prompts[t])?void 0:s.title)||"":2===e&&(null==p?void 0:p.part2_prompt)?f=p.part2_prompt.prompt_text||p.part2_prompt.transcription||p.part2_prompt.title||"":3===e&&(null==(l=null==p?void 0:p.part3_prompts)?void 0:l[t])&&(f=(null==(c=p.part3_prompts[t])?void 0:c.prompt_text)||(null==(d=p.part3_prompts[t])?void 0:d.transcription)||(null==(m=p.part3_prompts[t])?void 0:m.title)||"")}return{part:e,audio_url:h,question_text:f,upload_error:!1}}catch(N){const t=(null==N?void 0:N.message)||("string"==typeof N?N:"Unknown upload error");console.error(` Hard failure uploading ${S}:`,t),u({title:"Upload Warning",description:`We could not upload your recording for ${e}. We will still save your test and run analysis using available audio.`,variant:"destructive"});const r=`https://mock-r2-fallback.local/speaking/${encodeURIComponent(w)}/${encodeURIComponent(e)}/${k}.webm`;let n="";const o=e.match(/^part(\d+)_q(\d+)$/);if(o){const e=parseInt(o[1],10),t=parseInt(o[2],10);1===e&&(null==(h=null==p?void 0:p.part1_prompts)?void 0:h[t])?n=(null==(f=p.part1_prompts[t])?void 0:f.prompt_text)||(null==(g=p.part1_prompts[t])?void 0:g.transcription)||(null==(b=p.part1_prompts[t])?void 0:b.title)||"":2===e&&(null==p?void 0:p.part2_prompt)?n=p.part2_prompt.prompt_text||p.part2_prompt.transcription||p.part2_prompt.title||"":3===e&&(null==(y=null==p?void 0:p.part3_prompts)?void 0:y[t])&&(n=(null==(x=p.part3_prompts[t])?void 0:x.prompt_text)||(null==(v=p.part3_prompts[t])?void 0:v.transcription)||(null==(j=p.part3_prompts[t])?void 0:j.title)||"")}return{part:e,audio_url:r,question_text:n,upload_error:!0,error_message:t}}}),d=await Promise.all(l);if(!d||0===d.length)return console.error(" No speaking upload results returned"),void u({title:"Upload error",description:"We could not process your recordings. Please try again.",variant:"destructive"});const m=d.filter(e=>!e.upload_error).length,h=d.filter(e=>e.upload_error).length;console.log(" Speaking upload summary:",{total:d.length,successfulCount:m,failedCount:h});try{const{data:{user:s}}=await _e.auth.getUser();if(!s)throw new Error("User not authenticated while submitting speaking test");const l=d.map(e=>e.audio_url),{data:u,error:f}=await _e.from("test_results").insert({user_id:s.id,test_type:"speaking",total_questions:d.length,correct_answers:null,score_percentage:0,time_taken:900,audio_urls:l,audio_retention_expires_at:null,test_data:{recordings_count:d.length,parts_completed:[1,2,3],r2_upload_summary:{total:d.length,successful:m,failed:h},retention_policy:"no_auto_expiry_r2_persistent"}}).select().single();if(f||!u)throw f||new Error("Failed to create speaking test result");console.log(" Speaking test base records saved. AI scoring will be handled by backend using stored metadata and URLs.");const g=[];for(const i of d){const l=i.part.match(/^part(\d+)/),c=l?parseInt(l[1],10):NaN;if(isNaN(c)||c<1||c>3){console.error(`Invalid part number for recording: ${i.part}`);continue}let d="";if(1===c&&(null==(e=null==p?void 0:p.part1_prompts)?void 0:e.length)){const e=i.part.match(/_q(\d+)/),n=e?parseInt(e[1],10):0;n>=0&&n<p.part1_prompts.length&&(d=(null==(t=p.part1_prompts[n])?void 0:t.prompt_text)||(null==(r=p.part1_prompts[n])?void 0:r.transcription)||"")}else if(2===c&&(null==p?void 0:p.part2_prompt))d=p.part2_prompt.prompt_text||"";else if(3===c&&(null==(n=null==p?void 0:p.part3_prompts)?void 0:n.length)){const e=i.part.match(/_q(\d+)/),t=e?parseInt(e[1],10):0;t>=0&&t<p.part3_prompts.length&&(d=(null==(o=p.part3_prompts[t])?void 0:o.prompt_text)||(null==(a=p.part3_prompts[t])?void 0:a.transcription)||"")}g.push({user_id:s.id,test_result_id:u.id,part_number:c,question_text:d,audio_url:i.audio_url,transcription:"",band_scores:{},detailed_feedback:"",duration_seconds:120})}const{error:b}=await _e.from("speaking_test_results").insert(g);if(b)throw b;console.log(" Speaking test base records saved. Running AI scoring..."),console.log(" Skipping inline AI scoring for speaking test; base records saved for backend evaluation."),qe({}),c("/ielts-speaking-results",{state:{testData:p,recordings:d,audioBlobs:Object.fromEntries(i),testResultId:u.id}})}catch(s){console.error("Error saving or scoring speaking results:",s),u({title:"Save error",description:"Failed to save or score speaking results. Your recordings may not be fully processed.",variant:"destructive"})}}catch(i){console.error("Error submitting test:",i),u({title:"Submission Error",description:"Failed to submit test. Please try again.",variant:"destructive"})}})()},className:"font-medium",style:{backgroundColor:m.buttonPrimary,color:"#ffffff"},children:"Submit"})]})}),(1===y||3===y)&&!We&&O.jsx(ee,{children:O.jsxs(O.Fragment,{children:[O.jsxs(te,{children:[O.jsx(re,{asChild:!0,children:O.jsx(G,{variant:"ghost",onClick:()=>{v>0&&(j(v-1),Je(!1))},disabled:0===v,size:"icon",className:"absolute bottom-0 left-0 h-12 w-12",style:{color:m.textSecondary},onMouseEnter:e=>{e.currentTarget.style.color=m.buttonPrimary,e.currentTarget.style.backgroundColor="transparent"},onMouseLeave:e=>{e.currentTarget.style.color=m.textSecondary,e.currentTarget.style.backgroundColor="transparent"},children:O.jsx(je,{className:"w-5 h-5"})})}),O.jsx(ae,{children:O.jsx("p",{children:"Previous question"})})]}),O.jsxs(te,{children:[O.jsx(re,{asChild:!0,children:O.jsx(G,{variant:"ghost",onClick:()=>{Je(!1),Ct()},disabled:void 0===Ce[`part${y}_q${v}`],size:"icon",className:"absolute bottom-0 right-0 h-12 w-12",style:{color:m.textSecondary},onMouseEnter:e=>{e.currentTarget.style.color=m.buttonPrimary,e.currentTarget.style.backgroundColor="transparent"},onMouseLeave:e=>{e.currentTarget.style.color=m.textSecondary,e.currentTarget.style.backgroundColor="transparent"},children:O.jsx(we,{className:"w-5 h-5"})})}),O.jsx(ae,{children:O.jsx("p",{children:void 0===Ce[`part${y}_q${v}`]?"Please record your answer first":v!==((null==p?void 0:p.part1_prompts.length)||0)-1||1!==y||(null==p?void 0:p.part2_prompt)||(null==p?void 0:p.part3_prompts)&&0!==p.part3_prompts.length?"Next question":"Complete test"})})]})]})}),2===y&&!We&&O.jsx(ee,{children:O.jsxs(te,{children:[O.jsx(re,{asChild:!0,children:O.jsx(G,{variant:"ghost",onClick:()=>{Ct()},disabled:void 0===Ce[`part${y}_q${v}`],size:"icon",className:"absolute bottom-0 right-0 h-12 w-12 hover:bg-transparent hover:text-foreground",children:O.jsx(we,{className:"w-5 h-5"})})}),O.jsx(ae,{children:O.jsx("p",{children:void 0===Ce[`part${y}_q${v}`]?"Please record your answer first":(null==p?void 0:p.part3_prompts)&&p.part3_prompts.length>0?"Go to Part 3":"Complete test"})})]})})]})]}),O.jsx("div",{className:"fixed bottom-6 left-6 z-40 flex items-center gap-4",children:O.jsx("button",{onClick:()=>c("/ielts-portal"),className:"text-lg cursor-pointer transition-colors",style:{color:m.textSecondary},onMouseEnter:e=>e.currentTarget.style.color=m.buttonPrimary,onMouseLeave:e=>e.currentTarget.style.color=m.textSecondary,children:"Exit Test"})}),Ge&&O.jsxs("div",{className:"fixed bottom-12 right-4 sm:bottom-20 sm:right-[420px] z-50 flex flex-col gap-2 sm:gap-3",children:[O.jsx(ee,{children:O.jsxs(te,{children:[O.jsx(re,{asChild:!0,children:O.jsx(G,{variant:"outline",size:"icon",onClick:()=>Rt("Help with Speaking Structure"),disabled:lt,className:"h-9 w-9 sm:h-12 sm:w-12 p-0 backdrop-blur-sm shadow-lg",style:{borderColor:m.border||"#e5e7eb",backgroundColor:"glassmorphism"===m.theme.name?"rgba(255,255,255,0.9)":"dark"===m.theme.name?"rgba(255,255,255,0.15)":"minimalist"===m.theme.name?"#ffffff":m.theme.colors.cardBackground||"#ffffff",color:m.buttonPrimary||"#2563eb"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=m.hoverBg||"rgba(0,0,0,0.05)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===m.theme.name?"rgba(255,255,255,0.9)":"dark"===m.theme.name?"rgba(255,255,255,0.15)":"minimalist"===m.theme.name?"#ffffff":m.theme.colors.cardBackground||"#ffffff"},children:O.jsx(Be,{className:"w-4 h-4 sm:w-6 sm:h-6",style:{color:m.buttonPrimary||"#2563eb"}})})}),O.jsx(ae,{side:"left",children:O.jsx("p",{children:"Get help with speaking structure"})})]})}),O.jsx(ee,{children:O.jsxs(te,{children:[O.jsx(re,{asChild:!0,children:O.jsx(G,{variant:"outline",size:"icon",onClick:()=>Rt("Suggest Some Speaking Vocabulary"),disabled:lt,className:"h-9 w-9 sm:h-12 sm:w-12 p-0 backdrop-blur-sm shadow-lg",style:{borderColor:m.border||"#e5e7eb",backgroundColor:"glassmorphism"===m.theme.name?"rgba(255,255,255,0.9)":"dark"===m.theme.name?"rgba(255,255,255,0.15)":"minimalist"===m.theme.name?"#ffffff":m.theme.colors.cardBackground||"#ffffff",color:m.buttonPrimary||"#2563eb"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=m.hoverBg||"rgba(0,0,0,0.05)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===m.theme.name?"rgba(255,255,255,0.9)":"dark"===m.theme.name?"rgba(255,255,255,0.15)":"minimalist"===m.theme.name?"#ffffff":m.theme.colors.cardBackground||"#ffffff"},children:O.jsx(ke,{className:"w-4 h-4 sm:w-6 sm:h-6",style:{color:m.buttonPrimary||"#2563eb"}})})}),O.jsx(ae,{side:"left",children:O.jsx("p",{children:"Get vocabulary suggestions"})})]})}),O.jsx(ee,{children:O.jsxs(te,{children:[O.jsx(re,{asChild:!0,children:O.jsx(G,{variant:"outline",size:"icon",onClick:()=>Rt("Give me 2-3 straightforward band 7+ example answers for this exact IELTS Speaking question. Just show the actual answers, no explanations."),disabled:lt,className:"h-9 w-9 sm:h-12 sm:w-12 p-0 backdrop-blur-sm shadow-lg",style:{borderColor:m.border||"#e5e7eb",backgroundColor:"glassmorphism"===m.theme.name?"rgba(255,255,255,0.9)":"dark"===m.theme.name?"rgba(255,255,255,0.15)":"minimalist"===m.theme.name?"#ffffff":m.theme.colors.cardBackground||"#ffffff",color:m.buttonPrimary||"#2563eb"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=m.hoverBg||"rgba(0,0,0,0.05)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===m.theme.name?"rgba(255,255,255,0.9)":"dark"===m.theme.name?"rgba(255,255,255,0.15)":"minimalist"===m.theme.name?"#ffffff":m.theme.colors.cardBackground||"#ffffff"},children:O.jsx(me,{className:"w-4 h-4 sm:w-6 sm:h-6",style:{color:m.buttonPrimary||"#2563eb"}})})}),O.jsx(ae,{side:"left",children:O.jsx("p",{children:"View band 7+ example answers"})})]})}),O.jsx(ee,{children:O.jsxs(te,{children:[O.jsx(re,{asChild:!0,children:O.jsx(G,{variant:"outline",size:"icon",onClick:()=>Rt("Help me with grammar for this speaking question"),disabled:lt,className:"h-9 w-9 sm:h-12 sm:w-12 p-0 backdrop-blur-sm shadow-lg",style:{borderColor:m.border||"#e5e7eb",backgroundColor:"glassmorphism"===m.theme.name?"rgba(255,255,255,0.9)":"dark"===m.theme.name?"rgba(255,255,255,0.15)":"minimalist"===m.theme.name?"#ffffff":m.theme.colors.cardBackground||"#ffffff",color:m.buttonPrimary||"#2563eb"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=m.hoverBg||"rgba(0,0,0,0.05)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===m.theme.name?"rgba(255,255,255,0.9)":"dark"===m.theme.name?"rgba(255,255,255,0.15)":"minimalist"===m.theme.name?"#ffffff":m.theme.colors.cardBackground||"#ffffff"},children:O.jsx(ze,{className:"w-4 h-4 sm:w-6 sm:h-6",style:{color:m.buttonPrimary||"#2563eb"}})})}),O.jsx(ae,{side:"left",children:O.jsx("p",{children:"Get grammar help"})})]})})]}),O.jsxs("div",{className:"fixed bottom-6 right-3 sm:bottom-6 sm:right-6 z-50",children:[Ge&&O.jsxs(K,{className:"backdrop-blur-md rounded-3xl w-[260px] h-[360px] sm:w-96 sm:h-[500px] shadow-2xl flex flex-col transform-gpu origin-bottom-right transition-all duration-260 ease-in-out "+(Ke?"opacity-100 scale-100 translate-y-0":"opacity-0 scale-75 translate-y-8"),style:{backgroundColor:"glassmorphism"===m.theme.name?"rgba(255,255,255,0.95)":"dark"===m.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===m.theme.name?"#ffffff":m.theme.colors.cardBackground,borderColor:m.border,backdropFilter:"glassmorphism"===m.theme.name?"blur(12px)":"dark"===m.theme.name?"blur(8px)":"none",...m.cardStyle},children:[O.jsx(Z,{className:"pb-1 sm:pb-2 rounded-t-3xl relative",children:O.jsx("div",{className:"absolute top-1.5 right-1.5 sm:top-2 sm:right-2",children:O.jsx(G,{variant:"ghost",size:"icon",onClick:()=>{Qe(!1),setTimeout(()=>{Xe(!1)},260)},className:"h-7 w-7 sm:h-8 sm:w-8 p-0",style:{color:m.textPrimary},children:""})})}),O.jsxs(Y,{className:"flex-1 flex flex-col px-2.5 py-2 sm:p-4 overflow-hidden",children:[O.jsx(Te,{className:"flex-1 min-h-0",children:O.jsx(Ae,{className:"flex-1 min-h-0",children:0!==ot.length||lt?O.jsxs(O.Fragment,{children:[O.jsxs("div",{className:"rounded-lg p-3 mb-4",style:{backgroundColor:"glassmorphism"===m.theme.name?"rgba(255,255,255,0.1)":"dark"===m.theme.name?"rgba(255,255,255,0.05)":"minimalist"===m.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:m.border,borderWidth:"1px",borderStyle:"solid"},children:[O.jsx("div",{className:"text-xs uppercase tracking-wide mb-1",style:{color:m.textSecondary},children:"Question"}),O.jsx("div",{className:"text-xs sm:text-sm font-medium",style:{color:m.textPrimary},children:$t}),O.jsx("div",{className:"text-[10px] sm:text-sm whitespace-pre-wrap mt-1",style:{color:m.textSecondary},children:Mt||"No question available."})]}),ot.map(e=>O.jsxs(Me,{from:"user"===e.type?"user":"assistant",children:["bot"===e.type&&O.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"52px",height:"52px",flexShrink:0},children:O.jsx("img",{src:"https://raw.githubusercontent.com/AlfieAlfiegithu2/alfie-ai-coach/main/public/1000031289.png",alt:"Catie",style:{width:"100%",height:"100%",objectFit:"cover"}})}),O.jsx($e,{children:O.jsx("div",{className:"px-3 py-2 rounded-xl text-sm",style:{backgroundColor:"glassmorphism"===m.theme.name?"rgba(255,255,255,0.1)":"dark"===m.theme.name?"rgba(255,255,255,0.05)":"minimalist"===m.theme.name?"#f9fafb":"rgba(255,255,255,0.5)",borderColor:m.border,borderWidth:"1px",borderStyle:"solid",color:m.textPrimary},children:O.jsx(Ie,{dangerouslySetInnerHTML:{__html:e.content.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/^ (.*)$/gm,"<li>$1</li>").replace(/(<li>.*<\/li>)/s,"<ul>$1</ul>").replace(/\n/g,"<br>")}})})}),"user"===e.type&&(null==d?void 0:d.avatar_url)&&O.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"52px",height:"52px",flexShrink:0},children:O.jsx("img",{src:d.avatar_url,alt:"Your avatar",style:{width:"100%",height:"100%",objectFit:"cover"}})})]},e.id)),lt&&O.jsxs(Me,{from:"assistant",children:[O.jsx($e,{children:O.jsx("div",{className:"px-3 py-2 rounded-xl text-sm",style:{backgroundColor:"glassmorphism"===m.theme.name?"rgba(255,255,255,0.1)":"dark"===m.theme.name?"rgba(255,255,255,0.05)":"minimalist"===m.theme.name?"#f9fafb":"rgba(255,255,255,0.5)",borderColor:m.border,borderWidth:"1px",borderStyle:"solid"},children:O.jsx(De,{text:"Thinking..."})})}),O.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"52px",height:"52px"},children:O.jsx("img",{src:"https://raw.githubusercontent.com/AlfieAlfiegithu2/alfie-ai-coach/main/public/1000031289.png",alt:"Catie",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})]}):O.jsx(Re,{icon:O.jsx(Le,{className:"size-9 sm:size-12",style:{color:m.textSecondary}}),title:"Start a conversation",description:"Ask for help with your IELTS speaking practice"})})}),O.jsx("div",{className:"flex-shrink-0 mt-2.5 sm:mt-4",children:O.jsxs("div",{className:"flex gap-1.5 sm:gap-2",children:[O.jsx("input",{type:"text",value:st,onChange:e=>it(e.target.value),onKeyPress:e=>"Enter"===e.key&&!lt&&st.trim()&&At(),placeholder:"Ask for speaking help...",className:"flex-1 px-2.5 py-1.5 sm:px-3 sm:py-2 rounded-lg text-[10px] sm:text-sm focus:outline-none focus:ring-0 resize-none",style:{backgroundColor:"glassmorphism"===m.theme.name?"rgba(255,255,255,0.1)":"dark"===m.theme.name?"rgba(255,255,255,0.05)":"minimalist"===m.theme.name?"#ffffff":m.theme.colors.cardBackground,borderColor:m.border,borderWidth:"1px",borderStyle:"solid",color:m.textPrimary},disabled:lt}),O.jsx("style",{dangerouslySetInnerHTML:{__html:`\n                      input[placeholder="Ask for speaking help..."]::placeholder {\n                        color: ${m.textSecondary};\n                      }\n                    `}}),O.jsx(G,{onClick:()=>At(),disabled:lt||!st.trim(),variant:"ghost",size:"icon",className:"h-7 w-7 sm:h-8 sm:w-8 p-0",style:{color:m.textPrimary},children:lt?O.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2",style:{borderColor:m.textPrimary}}):O.jsx(Se,{className:"w-4 h-4"})})]})})]})]}),!Ge&&O.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"64px",height:"64px",cursor:"pointer",boxShadow:"0 8px 20px rgba(0,0,0,0.18)",transition:"transform 0.22s ease-out, box-shadow 0.22s ease-out"},onClick:()=>{Xe(!0),requestAnimationFrame(()=>Qe(!0))},onMouseEnter:e=>{const t=e.currentTarget;t.style.transform="scale(1.06) translateY(-2px)",t.style.boxShadow="0 14px 30px rgba(0,0,0,0.24)"},onMouseLeave:e=>{const t=e.currentTarget;t.style.transform="scale(1.0) translateY(0px)",t.style.boxShadow="0 10px 25px rgba(0,0,0,0.15)"},children:O.jsx("img",{src:"https://raw.githubusercontent.com/AlfieAlfiegithu2/alfie-ai-coach/main/public/1000031289.png",alt:"Catie",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})]})})})})]})};export{Xr as default};
