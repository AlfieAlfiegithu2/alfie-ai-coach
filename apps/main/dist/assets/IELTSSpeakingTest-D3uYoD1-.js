import{y as e,bv as r,bw as t,bx as n,by as o,bz as a,bA as s,bB as i,bC as l,bD as c,bE as d,bF as u,bG as m,bH as p,bI as h,r as f,bJ as g,bK as b,bL as y,bM as x,bq as v,bN as w,bO as j,bP as k,bQ as S,bR as C,bS as N,av as P,aB as _,aF as E,j as O,ay as T,aA as A,az as R,b2 as L,aC as M,bu as $,at as I,bk as D,aq as z,u as B,A as q,g as F,al as U,bs as W,_ as H,ap as V,a as Y,B as G,k as X,C as K,M as Q,b as Z,c as J,au as ee,bg as re,bh as te,E as ne,a2 as oe,bi as ae,a0 as se,P as ie,bT as le,bt as ce,ai as de,V as ue,ad as me,X as pe,a7 as he,S as fe,o as ge,p as be,q as ye,s as xe,$ as ve,bU as we,d as je,a8 as ke}from"./index-CKnaXPOD.js";import{S as Se}from"./separator-Dq1Vm4gp.js";import{R as Ce,T as Ne,a as Pe,b as _e,C as Ee}from"./CustomAudioPlayer-D1kz1XlA.js";import{g as Oe,s as Te}from"./supabase-DWL4C3fA.js";import{A as Ae}from"./cloudflare-r2-I755hh90.js";import"./dropdown-menu-Bq-NchHY.js";import{F as Re,C as Le,a as Me,b as $e,O as Ie,M as De,c as ze,R as Be,S as qe}from"./shimmering-text-CcSTUPEM.js";import{F as Fe}from"./file-text-CjKYzIF5.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=e("ListTree",[["path",{d:"M21 12h-8",key:"1bmf0i"}],["path",{d:"M21 6H8",key:"1pqkrb"}],["path",{d:"M21 18h-8",key:"1tm79t"}],["path",{d:"M3 6v4c0 1.1.9 2 2 2h3",key:"1ywdgy"}],["path",{d:"M3 10v6c0 1.1.9 2 2 2h3",key:"2wc746"}]]);var We=["points","className","baseLinePoints","connectNulls"];function He(){return He=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},He.apply(this,arguments)}function Ve(e,r){if(null==e)return{};var t,n,o=function(e,r){if(null==e)return{};var t={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(r.indexOf(n)>=0)continue;t[n]=e[n]}return t}(e,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)t=a[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}function Ye(e){return function(e){if(Array.isArray(e))return Ge(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,r){if(!e)return;if("string"==typeof e)return Ge(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ge(e,r)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ge(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Xe=function(e){return e&&e.x===+e.x&&e.y===+e.y},Ke=function(e,r){var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=[[]];return e.forEach(function(e){Xe(e)?r[r.length-1].push(e):r[r.length-1].length>0&&r.push([])}),Xe(e[0])&&r[r.length-1].push(e[0]),r[r.length-1].length<=0&&(r=r.slice(0,-1)),r}(e);r&&(t=[t.reduce(function(e,r){return[].concat(Ye(e),Ye(r))},[])]);var n=t.map(function(e){return e.reduce(function(e,r,t){return"".concat(e).concat(0===t?"M":"L").concat(r.x,",").concat(r.y)},"")}).join("");return 1===t.length?"".concat(n,"Z"):n},Qe=function(e){var o=e.points,a=e.className,s=e.baseLinePoints,i=e.connectNulls,l=Ve(e,We);if(!o||!o.length)return null;var c=r("recharts-polygon",a);if(s&&s.length){var d=l.stroke&&"none"!==l.stroke,u=function(e,r,t){var n=Ke(e,t);return"".concat("Z"===n.slice(-1)?n.slice(0,-1):n,"L").concat(Ke(r.reverse(),t).slice(1))}(o,s,i);return t.createElement("g",{className:c},t.createElement("path",He({},n(l,!0),{fill:"Z"===u.slice(-1)?l.fill:"none",stroke:"none",d:u})),d?t.createElement("path",He({},n(l,!0),{fill:"none",d:Ke(o,i)})):null,d?t.createElement("path",He({},n(l,!0),{fill:"none",d:Ke(s,i)})):null)}var m=Ke(o,i);return t.createElement("path",He({},n(l,!0),{fill:"Z"===m.slice(-1)?l.fill:"none",className:c,d:m}))},Ze=["cx","cy","innerRadius","outerRadius","gridType","radialLines"];function Je(e){return(Je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function er(e,r){if(null==e)return{};var t,n,o=function(e,r){if(null==e)return{};var t={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(r.indexOf(n)>=0)continue;t[n]=e[n]}return t}(e,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)t=a[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}function rr(){return rr=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},rr.apply(this,arguments)}function tr(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function nr(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?tr(Object(t),!0).forEach(function(r){or(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):tr(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function or(e,r,t){var n;return n=function(e,r){if("object"!=Je(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,r||"default");if("object"!=Je(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(r,"string"),(r="symbol"==Je(n)?n:n+"")in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var ar=function(e,r,t,n){var a="";return n.forEach(function(n,s){var i=o(r,t,e,n);a+=s?"L ".concat(i.x,",").concat(i.y):"M ".concat(i.x,",").concat(i.y)}),a+="Z"},sr=function(e){var r=e.cx,a=e.cy,s=e.innerRadius,i=e.outerRadius,l=e.polarAngles,c=e.radialLines;if(!l||!l.length||!c)return null;var d=nr({stroke:"#ccc"},n(e,!1));return t.createElement("g",{className:"recharts-polar-grid-angle"},l.map(function(e){var n=o(r,a,s,e),l=o(r,a,i,e);return t.createElement("line",rr({},d,{key:"line-".concat(e),x1:n.x,y1:n.y,x2:l.x,y2:l.y}))}))},ir=function(e){var o=e.cx,a=e.cy,s=e.radius,i=e.index,l=nr(nr({stroke:"#ccc"},n(e,!1)),{},{fill:"none"});return t.createElement("circle",rr({},l,{className:r("recharts-polar-grid-concentric-circle",e.className),key:"circle-".concat(i),cx:o,cy:a,r:s}))},lr=function(e){var o=e.radius,a=e.index,s=nr(nr({stroke:"#ccc"},n(e,!1)),{},{fill:"none"});return t.createElement("path",rr({},s,{className:r("recharts-polar-grid-concentric-polygon",e.className),key:"path-".concat(a),d:ar(o,e.cx,e.cy,e.polarAngles)}))},cr=function(e){var r=e.polarRadius,n=e.gridType;return r&&r.length?t.createElement("g",{className:"recharts-polar-grid-concentric"},r.map(function(r,o){var a=o;return"circle"===n?t.createElement(ir,rr({key:a},e,{radius:r,index:o})):t.createElement(lr,rr({key:a},e,{radius:r,index:o}))})):null},dr=function(e){var r=e.cx,n=void 0===r?0:r,o=e.cy,a=void 0===o?0:o,s=e.innerRadius,i=void 0===s?0:s,l=e.outerRadius,c=void 0===l?0:l,d=e.gridType,u=void 0===d?"polygon":d,m=e.radialLines,p=void 0===m||m,h=er(e,Ze);return c<=0?null:t.createElement("g",{className:"recharts-polar-grid"},t.createElement(sr,rr({cx:n,cy:a,innerRadius:i,outerRadius:c,gridType:u,radialLines:p},h)),t.createElement(cr,rr({cx:n,cy:a,innerRadius:i,outerRadius:c,gridType:u,radialLines:p},h)))};dr.displayName="PolarGrid";var ur=a,mr=i,pr=s;const hr=Oe(function(e,r){return e&&e.length?ur(e,pr(r),mr):void 0});var fr=a,gr=s,br=l;const yr=Oe(function(e,r){return e&&e.length?fr(e,gr(r),br):void 0});var xr=["cx","cy","angle","ticks","axisLine"],vr=["ticks","tick","angle","tickFormatter","stroke"];function wr(e){return(wr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function jr(){return jr=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},jr.apply(this,arguments)}function kr(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function Sr(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?kr(Object(t),!0).forEach(function(r){Tr(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):kr(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function Cr(e,r){if(null==e)return{};var t,n,o=function(e,r){if(null==e)return{};var t={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(r.indexOf(n)>=0)continue;t[n]=e[n]}return t}(e,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)t=a[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}function Nr(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ar(n.key),n)}}function Pr(e,r,t){return r=Er(r),function(e,r){if(r&&("object"===wr(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,_r()?Reflect.construct(r,t||[],Er(e).constructor):r.apply(e,t))}function _r(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(r){}return(_r=function(){return!!e})()}function Er(e){return(Er=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Or(e,r){return(Or=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,r){return e.__proto__=r,e})(e,r)}function Tr(e,r,t){return(r=Ar(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function Ar(e){var r=function(e,r){if("object"!=wr(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,r||"default");if("object"!=wr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"==wr(r)?r:r+""}var Rr=function(){function e(){return function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),Pr(this,e,arguments)}return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),r&&Or(e,r)}(e,f.PureComponent),a=e,i=[{key:"renderTickItem",value:function(e,r,n){return t.isValidElement(e)?t.cloneElement(e,r):c(e)?e(r):t.createElement(d,jr({},r,{className:"recharts-polar-radius-axis-tick-value"}),n)}}],(s=[{key:"getTickValueCoord",value:function(e){var r=e.coordinate,t=this.props,n=t.angle,a=t.cx,s=t.cy;return o(a,s,r,n)}},{key:"getTickTextAnchor",value:function(){var e;switch(this.props.orientation){case"left":e="end";break;case"right":e="start";break;default:e="middle"}return e}},{key:"getViewBox",value:function(){var e=this.props,r=e.cx,t=e.cy,n=e.angle,o=e.ticks,a=hr(o,function(e){return e.coordinate||0});return{cx:r,cy:t,startAngle:n,endAngle:n,innerRadius:yr(o,function(e){return e.coordinate||0}).coordinate||0,outerRadius:a.coordinate||0}}},{key:"renderAxisLine",value:function(){var e=this.props,r=e.cx,a=e.cy,s=e.angle,i=e.ticks,l=e.axisLine,c=Cr(e,xr),d=i.reduce(function(e,r){return[Math.min(e[0],r.coordinate),Math.max(e[1],r.coordinate)]},[1/0,-1/0]),u=o(r,a,d[0],s),m=o(r,a,d[1],s),p=Sr(Sr(Sr({},n(c,!1)),{},{fill:"none"},n(l,!1)),{},{x1:u.x,y1:u.y,x2:m.x,y2:m.y});return t.createElement("line",jr({className:"recharts-polar-radius-axis-line"},p))}},{key:"renderTicks",value:function(){var o=this,a=this.props,s=a.ticks,i=a.tick,l=a.angle,c=a.tickFormatter,d=a.stroke,h=Cr(a,vr),f=this.getTickTextAnchor(),g=n(h,!1),b=n(i,!1),y=s.map(function(n,a){var s=o.getTickValueCoord(n),h=Sr(Sr(Sr(Sr({textAnchor:f,transform:"rotate(".concat(90-l,", ").concat(s.x,", ").concat(s.y,")")},g),{},{stroke:"none",fill:d},b),{},{index:a},s),{},{payload:n});return t.createElement(u,jr({className:r("recharts-polar-radius-axis-tick",m(i)),key:"tick-".concat(n.coordinate)},p(o.props,n,a)),e.renderTickItem(i,h,c?c(n.value,a):n.value))});return t.createElement(u,{className:"recharts-polar-radius-axis-ticks"},y)}},{key:"render",value:function(){var e=this.props,n=e.ticks,o=e.axisLine,a=e.tick;return n&&n.length?t.createElement(u,{className:r("recharts-polar-radius-axis",this.props.className)},o&&this.renderAxisLine(),a&&this.renderTicks(),h.renderCallByParent(this.props,this.getViewBox())):null}}])&&Nr(a.prototype,s),i&&Nr(a,i),Object.defineProperty(a,"prototype",{writable:!1}),a;var a,s,i}();function Lr(e){return(Lr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Mr(){return Mr=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},Mr.apply(this,arguments)}function $r(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function Ir(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?$r(Object(t),!0).forEach(function(r){Ur(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):$r(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function Dr(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Wr(n.key),n)}}function zr(e,r,t){return r=qr(r),function(e,r){if(r&&("object"===Lr(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Br()?Reflect.construct(r,t||[],qr(e).constructor):r.apply(e,t))}function Br(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(r){}return(Br=function(){return!!e})()}function qr(e){return(qr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Fr(e,r){return(Fr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,r){return e.__proto__=r,e})(e,r)}function Ur(e,r,t){return(r=Wr(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function Wr(e){var r=function(e,r){if("object"!=Lr(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,r||"default");if("object"!=Lr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"==Lr(r)?r:r+""}Tr(Rr,"displayName","PolarRadiusAxis"),Tr(Rr,"axisType","radiusAxis"),Tr(Rr,"defaultProps",{type:"number",radiusAxisId:0,cx:0,cy:0,angle:0,orientation:"right",stroke:"#ccc",axisLine:!0,tick:!0,tickCount:5,allowDataOverflow:!1,scale:"auto",allowDuplicatedCategory:!0});var Hr=Math.PI/180,Vr=1e-5,Yr=function(){function e(){return function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),zr(this,e,arguments)}return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),r&&Fr(e,r)}(e,f.PureComponent),a=e,i=[{key:"renderTickItem",value:function(e,r,n){return t.isValidElement(e)?t.cloneElement(e,r):c(e)?e(r):t.createElement(d,Mr({},r,{className:"recharts-polar-angle-axis-tick-value"}),n)}}],(s=[{key:"getTickLineCoord",value:function(e){var r=this.props,t=r.cx,n=r.cy,a=r.radius,s=r.orientation,i=r.tickSize||8,l=o(t,n,a,e.coordinate),c=o(t,n,a+("inner"===s?-1:1)*i,e.coordinate);return{x1:l.x,y1:l.y,x2:c.x,y2:c.y}}},{key:"getTickTextAnchor",value:function(e){var r=this.props.orientation,t=Math.cos(-e.coordinate*Hr);return t>Vr?"outer"===r?"start":"end":t<-Vr?"outer"===r?"end":"start":"middle"}},{key:"renderAxisLine",value:function(){var e=this.props,r=e.cx,a=e.cy,s=e.radius,i=e.axisLine,l=e.axisLineType,c=Ir(Ir({},n(this.props,!1)),{},{fill:"none"},n(i,!1));if("circle"===l)return t.createElement(g,Mr({className:"recharts-polar-angle-axis-line"},c,{cx:r,cy:a,r:s}));var d=this.props.ticks.map(function(e){return o(r,a,s,e.coordinate)});return t.createElement(Qe,Mr({className:"recharts-polar-angle-axis-line"},c,{points:d}))}},{key:"renderTicks",value:function(){var o=this,a=this.props,s=a.ticks,i=a.tick,l=a.tickLine,c=a.tickFormatter,d=a.stroke,h=n(this.props,!1),f=n(i,!1),g=Ir(Ir({},h),{},{fill:"none"},n(l,!1)),b=s.map(function(n,a){var s=o.getTickLineCoord(n),b=Ir(Ir(Ir({textAnchor:o.getTickTextAnchor(n)},h),{},{stroke:"none",fill:d},f),{},{index:a,payload:n,x:s.x2,y:s.y2});return t.createElement(u,Mr({className:r("recharts-polar-angle-axis-tick",m(i)),key:"tick-".concat(n.coordinate)},p(o.props,n,a)),l&&t.createElement("line",Mr({className:"recharts-polar-angle-axis-tick-line"},g,s)),i&&e.renderTickItem(i,b,c?c(n.value,a):n.value))});return t.createElement(u,{className:"recharts-polar-angle-axis-ticks"},b)}},{key:"render",value:function(){var e=this.props,n=e.ticks,o=e.radius,a=e.axisLine;return o<=0||!n||!n.length?null:t.createElement(u,{className:r("recharts-polar-angle-axis",this.props.className)},a&&this.renderAxisLine(),this.renderTicks())}}])&&Dr(a.prototype,s),i&&Dr(a,i),Object.defineProperty(a,"prototype",{writable:!1}),a;var a,s,i}();Ur(Yr,"displayName","PolarAngleAxis"),Ur(Yr,"axisType","angleAxis"),Ur(Yr,"defaultProps",{type:"category",angleAxisId:0,scale:"auto",cx:0,cy:0,orientation:"outer",axisLine:!0,tickLine:!0,tickSize:8,tick:!0,hide:!1,allowDuplicatedCategory:!0});const Gr=Oe(function(e){return e&&e.length?e[0]:void 0});var Xr=["key"];function Kr(e){return(Kr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Qr(e,r){if(null==e)return{};var t,n,o=function(e,r){if(null==e)return{};var t={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(r.indexOf(n)>=0)continue;t[n]=e[n]}return t}(e,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)t=a[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}function Zr(){return Zr=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},Zr.apply(this,arguments)}function Jr(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function et(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?Jr(Object(t),!0).forEach(function(r){st(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Jr(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function rt(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,it(n.key),n)}}function tt(e,r,t){return r=ot(r),function(e,r){if(r&&("object"===Kr(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,nt()?Reflect.construct(r,t||[],ot(e).constructor):r.apply(e,t))}function nt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(r){}return(nt=function(){return!!e})()}function ot(e){return(ot=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function at(e,r){return(at=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,r){return e.__proto__=r,e})(e,r)}function st(e,r,t){return(r=it(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function it(e){var r=function(e,r){if("object"!=Kr(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,r||"default");if("object"!=Kr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"==Kr(r)?r:r+""}var lt=function(){function e(){var r;!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return st(r=tt(this,e,[].concat(n)),"state",{isAnimationFinished:!1}),st(r,"handleAnimationEnd",function(){var e=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),c(e)&&e()}),st(r,"handleAnimationStart",function(){var e=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),c(e)&&e()}),st(r,"handleMouseEnter",function(e){var t=r.props.onMouseEnter;t&&t(r.props,e)}),st(r,"handleMouseLeave",function(e){var t=r.props.onMouseLeave;t&&t(r.props,e)}),r}return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),r&&at(e,r)}(e,f.PureComponent),o=e,s=[{key:"getDerivedStateFromProps",value:function(e,r){return e.animationId!==r.prevAnimationId?{prevAnimationId:e.animationId,curPoints:e.points,prevPoints:r.curPoints}:e.points!==r.curPoints?{curPoints:e.points}:null}},{key:"renderDotItem",value:function(e,n){var o;if(t.isValidElement(e))o=t.cloneElement(e,n);else if(c(e))o=e(n);else{var a=n.key,s=Qr(n,Xr);o=t.createElement(g,Zr({},s,{key:a,className:r("recharts-radar-dot","boolean"!=typeof e?e.className:"")}))}return o}}],(a=[{key:"renderDots",value:function(r){var o=this.props,a=o.dot,s=o.dataKey,i=n(this.props,!1),l=n(a,!0),c=r.map(function(r,t){var n=et(et(et({key:"dot-".concat(t),r:3},i),l),{},{dataKey:s,cx:r.x,cy:r.y,index:t,payload:r});return e.renderDotItem(a,n)});return t.createElement(u,{className:"recharts-radar-dots"},c)}},{key:"renderPolygonStatically",value:function(e){var r,o=this.props,a=o.shape,s=o.dot,i=o.isRange,l=o.baseLinePoints,d=o.connectNulls;return r=t.isValidElement(a)?t.cloneElement(a,et(et({},this.props),{},{points:e})):c(a)?a(et(et({},this.props),{},{points:e})):t.createElement(Qe,Zr({},n(this.props,!0),{onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,points:e,baseLinePoints:i?l:null,connectNulls:d})),t.createElement(u,{className:"recharts-radar-polygon"},r,s?this.renderDots(e):null)}},{key:"renderPolygonWithAnimation",value:function(){var e=this,r=this.props,n=r.points,o=r.isAnimationActive,a=r.animationBegin,s=r.animationDuration,i=r.animationEasing,l=r.animationId,c=this.state.prevPoints;return t.createElement(b,{begin:a,duration:s,isActive:o,easing:i,from:{t:0},to:{t:1},key:"radar-".concat(l),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(r){var t=r.t,o=c&&c.length/n.length,a=n.map(function(e,r){var n=c&&c[Math.floor(r*o)];if(n){var a=y(n.x,e.x),s=y(n.y,e.y);return et(et({},e),{},{x:a(t),y:s(t)})}var i=y(e.cx,e.x),l=y(e.cy,e.y);return et(et({},e),{},{x:i(t),y:l(t)})});return e.renderPolygonStatically(a)})}},{key:"renderPolygon",value:function(){var e=this.props,r=e.points,t=e.isAnimationActive,n=e.isRange,o=this.state.prevPoints;return!(t&&r&&r.length)||n||o&&x(o,r)?this.renderPolygonStatically(r):this.renderPolygonWithAnimation()}},{key:"render",value:function(){var e=this.props,n=e.hide,o=e.className,a=e.points,s=e.isAnimationActive;if(n||!a||!a.length)return null;var i=this.state.isAnimationFinished,l=r("recharts-radar",o);return t.createElement(u,{className:l},this.renderPolygon(),(!s||i)&&v.renderCallByParent(this.props,a))}}])&&rt(o.prototype,a),s&&rt(o,s),Object.defineProperty(o,"prototype",{writable:!1}),o;var o,a,s}();st(lt,"displayName","Radar"),st(lt,"defaultProps",{angleAxisId:0,radiusAxisId:0,hide:!1,activeDot:!0,dot:!1,legendType:"rect",isAnimationActive:!w.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"}),st(lt,"getComposedData",function(e){var r=e.radiusAxis,t=e.angleAxis,n=e.displayedData,a=e.dataKey,s=e.bandSize,i=t.cx,l=t.cy,c=!1,d=[],u="number"!==t.type&&null!=s?s:0;n.forEach(function(e,n){var s=j(e,t.dataKey,n),m=j(e,a),p=t.scale(s)+u,h=Array.isArray(m)?k(m):m,f=S(h)?void 0:r.scale(h);Array.isArray(m)&&m.length>=2&&(c=!0),d.push(et(et({},o(i,l,f,p)),{},{name:s,value:m,cx:i,cy:l,radius:f,angle:p,payload:e}))});var m=[];return c&&d.forEach(function(e){if(Array.isArray(e.value)){var t=Gr(e.value),n=S(t)?void 0:r.scale(t);m.push(et(et({},e),{},{radius:n},o(i,l,n,e.angle)))}else m.push(e)}),{points:d,isRange:c,baseLinePoints:m}});var ct=C({chartName:"RadarChart",GraphicalChild:lt,axisComponents:[{axisType:"angleAxis",AxisComp:Yr},{axisType:"radiusAxis",AxisComp:Rr}],formatAxisMap:N,defaultProps:{layout:"centric",startAngle:90,endAngle:-270,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});var dt="ScrollArea",[ut,mt]=P(dt),[pt,ht]=ut(dt),ft=f.forwardRef((e,r)=>{const{__scopeScrollArea:t,type:n="hover",dir:o,scrollHideDelay:a=600,...s}=e,[i,l]=f.useState(null),[c,d]=f.useState(null),[u,m]=f.useState(null),[p,h]=f.useState(null),[g,b]=f.useState(null),[y,x]=f.useState(0),[v,w]=f.useState(0),[j,k]=f.useState(!1),[S,C]=f.useState(!1),N=_(r,e=>l(e)),P=E(o);return O.jsx(pt,{scope:t,type:n,dir:P,scrollHideDelay:a,scrollArea:i,viewport:c,onViewportChange:d,content:u,onContentChange:m,scrollbarX:p,onScrollbarXChange:h,scrollbarXEnabled:j,onScrollbarXEnabledChange:k,scrollbarY:g,onScrollbarYChange:b,scrollbarYEnabled:S,onScrollbarYEnabledChange:C,onCornerWidthChange:x,onCornerHeightChange:w,children:O.jsx(T.div,{dir:P,...s,ref:N,style:{position:"relative","--radix-scroll-area-corner-width":y+"px","--radix-scroll-area-corner-height":v+"px",...e.style}})})});ft.displayName=dt;var gt="ScrollAreaViewport",bt=f.forwardRef((e,r)=>{const{__scopeScrollArea:t,children:n,asChild:o,nonce:a,...s}=e,i=ht(gt,t),l=f.useRef(null),c=_(r,l,i.onViewportChange);return O.jsxs(O.Fragment,{children:[O.jsx("style",{dangerouslySetInnerHTML:{__html:"\n[data-radix-scroll-area-viewport] {\n  scrollbar-width: none;\n  -ms-overflow-style: none;\n  -webkit-overflow-scrolling: touch;\n}\n[data-radix-scroll-area-viewport]::-webkit-scrollbar {\n  display: none;\n}\n:where([data-radix-scroll-area-viewport]) {\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n}\n:where([data-radix-scroll-area-content]) {\n  flex-grow: 1;\n}\n"},nonce:a}),O.jsx(T.div,{"data-radix-scroll-area-viewport":"",...s,asChild:o,ref:c,style:{overflowX:i.scrollbarXEnabled?"scroll":"hidden",overflowY:i.scrollbarYEnabled?"scroll":"hidden",...e.style},children:Wt({asChild:o,children:n},e=>O.jsx("div",{"data-radix-scroll-area-content":"",ref:i.onContentChange,style:{minWidth:i.scrollbarXEnabled?"fit-content":void 0},children:e}))})]})});bt.displayName=gt;var yt="ScrollAreaScrollbar",xt=f.forwardRef((e,r)=>{const{forceMount:t,...n}=e,o=ht(yt,e.__scopeScrollArea),{onScrollbarXEnabledChange:a,onScrollbarYEnabledChange:s}=o,i="horizontal"===e.orientation;return f.useEffect(()=>(i?a(!0):s(!0),()=>{i?a(!1):s(!1)}),[i,a,s]),"hover"===o.type?O.jsx(vt,{...n,ref:r,forceMount:t}):"scroll"===o.type?O.jsx(wt,{...n,ref:r,forceMount:t}):"auto"===o.type?O.jsx(jt,{...n,ref:r,forceMount:t}):"always"===o.type?O.jsx(kt,{...n,ref:r}):null});xt.displayName=yt;var vt=f.forwardRef((e,r)=>{const{forceMount:t,...n}=e,o=ht(yt,e.__scopeScrollArea),[a,s]=f.useState(!1);return f.useEffect(()=>{const e=o.scrollArea;let r=0;if(e){const t=()=>{window.clearTimeout(r),s(!0)},n=()=>{r=window.setTimeout(()=>s(!1),o.scrollHideDelay)};return e.addEventListener("pointerenter",t),e.addEventListener("pointerleave",n),()=>{window.clearTimeout(r),e.removeEventListener("pointerenter",t),e.removeEventListener("pointerleave",n)}}},[o.scrollArea,o.scrollHideDelay]),O.jsx(A,{present:t||a,children:O.jsx(jt,{"data-state":a?"visible":"hidden",...n,ref:r})})}),wt=f.forwardRef((e,r)=>{const{forceMount:t,...n}=e,o=ht(yt,e.__scopeScrollArea),a="horizontal"===e.orientation,s=Ft(()=>l("SCROLL_END"),100),[i,l]=(c="hidden",d={hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}},f.useReducer((e,r)=>d[e][r]??e,c));var c,d;return f.useEffect(()=>{if("idle"===i){const e=window.setTimeout(()=>l("HIDE"),o.scrollHideDelay);return()=>window.clearTimeout(e)}},[i,o.scrollHideDelay,l]),f.useEffect(()=>{const e=o.viewport,r=a?"scrollLeft":"scrollTop";if(e){let t=e[r];const n=()=>{const n=e[r];t!==n&&(l("SCROLL"),s()),t=n};return e.addEventListener("scroll",n),()=>e.removeEventListener("scroll",n)}},[o.viewport,a,l,s]),O.jsx(A,{present:t||"hidden"!==i,children:O.jsx(kt,{"data-state":"hidden"===i?"hidden":"visible",...n,ref:r,onPointerEnter:R(e.onPointerEnter,()=>l("POINTER_ENTER")),onPointerLeave:R(e.onPointerLeave,()=>l("POINTER_LEAVE"))})})}),jt=f.forwardRef((e,r)=>{const t=ht(yt,e.__scopeScrollArea),{forceMount:n,...o}=e,[a,s]=f.useState(!1),i="horizontal"===e.orientation,l=Ft(()=>{if(t.viewport){const e=t.viewport.offsetWidth<t.viewport.scrollWidth,r=t.viewport.offsetHeight<t.viewport.scrollHeight;s(i?e:r)}},10);return Ut(t.viewport,l),Ut(t.content,l),O.jsx(A,{present:n||a,children:O.jsx(kt,{"data-state":a?"visible":"hidden",...o,ref:r})})}),kt=f.forwardRef((e,r)=>{const{orientation:t="vertical",...n}=e,o=ht(yt,e.__scopeScrollArea),a=f.useRef(null),s=f.useRef(0),[i,l]=f.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),c=$t(i.viewport,i.content),d={...n,sizes:i,onSizesChange:l,hasThumb:Boolean(c>0&&c<1),onThumbChange:e=>a.current=e,onThumbPointerUp:()=>s.current=0,onThumbPointerDown:e=>s.current=e};function u(e,r){return function(e,r,t,n="ltr"){const o=It(t),a=o/2,s=r||a,i=o-s,l=t.scrollbar.paddingStart+s,c=t.scrollbar.size-t.scrollbar.paddingEnd-i,d=t.content-t.viewport,u="ltr"===n?[0,d]:[-1*d,0];return zt([l,c],u)(e)}(e,s.current,i,r)}return"horizontal"===t?O.jsx(St,{...d,ref:r,onThumbPositionChange:()=>{if(o.viewport&&a.current){const e=Dt(o.viewport.scrollLeft,i,o.dir);a.current.style.transform=`translate3d(${e}px, 0, 0)`}},onWheelScroll:e=>{o.viewport&&(o.viewport.scrollLeft=e)},onDragScroll:e=>{o.viewport&&(o.viewport.scrollLeft=u(e,o.dir))}}):"vertical"===t?O.jsx(Ct,{...d,ref:r,onThumbPositionChange:()=>{if(o.viewport&&a.current){const e=Dt(o.viewport.scrollTop,i);a.current.style.transform=`translate3d(0, ${e}px, 0)`}},onWheelScroll:e=>{o.viewport&&(o.viewport.scrollTop=e)},onDragScroll:e=>{o.viewport&&(o.viewport.scrollTop=u(e))}}):null}),St=f.forwardRef((e,r)=>{const{sizes:t,onSizesChange:n,...o}=e,a=ht(yt,e.__scopeScrollArea),[s,i]=f.useState(),l=f.useRef(null),c=_(r,l,a.onScrollbarXChange);return f.useEffect(()=>{l.current&&i(getComputedStyle(l.current))},[l]),O.jsx(_t,{"data-orientation":"horizontal",...o,ref:c,sizes:t,style:{bottom:0,left:"rtl"===a.dir?"var(--radix-scroll-area-corner-width)":0,right:"ltr"===a.dir?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":It(t)+"px",...e.style},onThumbPointerDown:r=>e.onThumbPointerDown(r.x),onDragScroll:r=>e.onDragScroll(r.x),onWheelScroll:(r,t)=>{if(a.viewport){const n=a.viewport.scrollLeft+r.deltaX;e.onWheelScroll(n),Bt(n,t)&&r.preventDefault()}},onResize:()=>{l.current&&a.viewport&&s&&n({content:a.viewport.scrollWidth,viewport:a.viewport.offsetWidth,scrollbar:{size:l.current.clientWidth,paddingStart:Mt(s.paddingLeft),paddingEnd:Mt(s.paddingRight)}})}})}),Ct=f.forwardRef((e,r)=>{const{sizes:t,onSizesChange:n,...o}=e,a=ht(yt,e.__scopeScrollArea),[s,i]=f.useState(),l=f.useRef(null),c=_(r,l,a.onScrollbarYChange);return f.useEffect(()=>{l.current&&i(getComputedStyle(l.current))},[l]),O.jsx(_t,{"data-orientation":"vertical",...o,ref:c,sizes:t,style:{top:0,right:"ltr"===a.dir?0:void 0,left:"rtl"===a.dir?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":It(t)+"px",...e.style},onThumbPointerDown:r=>e.onThumbPointerDown(r.y),onDragScroll:r=>e.onDragScroll(r.y),onWheelScroll:(r,t)=>{if(a.viewport){const n=a.viewport.scrollTop+r.deltaY;e.onWheelScroll(n),Bt(n,t)&&r.preventDefault()}},onResize:()=>{l.current&&a.viewport&&s&&n({content:a.viewport.scrollHeight,viewport:a.viewport.offsetHeight,scrollbar:{size:l.current.clientHeight,paddingStart:Mt(s.paddingTop),paddingEnd:Mt(s.paddingBottom)}})}})}),[Nt,Pt]=ut(yt),_t=f.forwardRef((e,r)=>{const{__scopeScrollArea:t,sizes:n,hasThumb:o,onThumbChange:a,onThumbPointerUp:s,onThumbPointerDown:i,onThumbPositionChange:l,onDragScroll:c,onWheelScroll:d,onResize:u,...m}=e,p=ht(yt,t),[h,g]=f.useState(null),b=_(r,e=>g(e)),y=f.useRef(null),x=f.useRef(""),v=p.viewport,w=n.content-n.viewport,j=L(d),k=L(l),S=Ft(u,10);function C(e){if(y.current){const r=e.clientX-y.current.left,t=e.clientY-y.current.top;c({x:r,y:t})}}return f.useEffect(()=>{const e=e=>{const r=e.target;(null==h?void 0:h.contains(r))&&j(e,w)};return document.addEventListener("wheel",e,{passive:!1}),()=>document.removeEventListener("wheel",e,{passive:!1})},[v,h,w,j]),f.useEffect(k,[n,k]),Ut(h,S),Ut(p.content,S),O.jsx(Nt,{scope:t,scrollbar:h,hasThumb:o,onThumbChange:L(a),onThumbPointerUp:L(s),onThumbPositionChange:k,onThumbPointerDown:L(i),children:O.jsx(T.div,{...m,ref:b,style:{position:"absolute",...m.style},onPointerDown:R(e.onPointerDown,e=>{if(0===e.button){e.target.setPointerCapture(e.pointerId),y.current=h.getBoundingClientRect(),x.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",p.viewport&&(p.viewport.style.scrollBehavior="auto"),C(e)}}),onPointerMove:R(e.onPointerMove,C),onPointerUp:R(e.onPointerUp,e=>{const r=e.target;r.hasPointerCapture(e.pointerId)&&r.releasePointerCapture(e.pointerId),document.body.style.webkitUserSelect=x.current,p.viewport&&(p.viewport.style.scrollBehavior=""),y.current=null})})})}),Et="ScrollAreaThumb",Ot=f.forwardRef((e,r)=>{const{forceMount:t,...n}=e,o=Pt(Et,e.__scopeScrollArea);return O.jsx(A,{present:t||o.hasThumb,children:O.jsx(Tt,{ref:r,...n})})}),Tt=f.forwardRef((e,r)=>{const{__scopeScrollArea:t,style:n,...o}=e,a=ht(Et,t),s=Pt(Et,t),{onThumbPositionChange:i}=s,l=_(r,e=>s.onThumbChange(e)),c=f.useRef(),d=Ft(()=>{c.current&&(c.current(),c.current=void 0)},100);return f.useEffect(()=>{const e=a.viewport;if(e){const r=()=>{if(d(),!c.current){const r=qt(e,i);c.current=r,i()}};return i(),e.addEventListener("scroll",r),()=>e.removeEventListener("scroll",r)}},[a.viewport,d,i]),O.jsx(T.div,{"data-state":s.hasThumb?"visible":"hidden",...o,ref:l,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...n},onPointerDownCapture:R(e.onPointerDownCapture,e=>{const r=e.target.getBoundingClientRect(),t=e.clientX-r.left,n=e.clientY-r.top;s.onThumbPointerDown({x:t,y:n})}),onPointerUp:R(e.onPointerUp,s.onThumbPointerUp)})});Ot.displayName=Et;var At="ScrollAreaCorner",Rt=f.forwardRef((e,r)=>{const t=ht(At,e.__scopeScrollArea),n=Boolean(t.scrollbarX&&t.scrollbarY);return"scroll"!==t.type&&n?O.jsx(Lt,{...e,ref:r}):null});Rt.displayName=At;var Lt=f.forwardRef((e,r)=>{const{__scopeScrollArea:t,...n}=e,o=ht(At,t),[a,s]=f.useState(0),[i,l]=f.useState(0),c=Boolean(a&&i);return Ut(o.scrollbarX,()=>{var e;const r=(null==(e=o.scrollbarX)?void 0:e.offsetHeight)||0;o.onCornerHeightChange(r),l(r)}),Ut(o.scrollbarY,()=>{var e;const r=(null==(e=o.scrollbarY)?void 0:e.offsetWidth)||0;o.onCornerWidthChange(r),s(r)}),c?O.jsx(T.div,{...n,ref:r,style:{width:a,height:i,position:"absolute",right:"ltr"===o.dir?0:void 0,left:"rtl"===o.dir?0:void 0,bottom:0,...e.style}}):null});function Mt(e){return e?parseInt(e,10):0}function $t(e,r){const t=e/r;return isNaN(t)?0:t}function It(e){const r=$t(e.viewport,e.content),t=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,n=(e.scrollbar.size-t)*r;return Math.max(n,18)}function Dt(e,r,t="ltr"){const n=It(r),o=r.scrollbar.paddingStart+r.scrollbar.paddingEnd,a=r.scrollbar.size-o,s=r.content-r.viewport,i=a-n,l=$(e,"ltr"===t?[0,s]:[-1*s,0]);return zt([0,s],[0,i])(l)}function zt(e,r){return t=>{if(e[0]===e[1]||r[0]===r[1])return r[0];const n=(r[1]-r[0])/(e[1]-e[0]);return r[0]+n*(t-e[0])}}function Bt(e,r){return e>0&&e<r}var qt=(e,r=()=>{})=>{let t={left:e.scrollLeft,top:e.scrollTop},n=0;return function o(){const a={left:e.scrollLeft,top:e.scrollTop},s=t.left!==a.left,i=t.top!==a.top;(s||i)&&r(),t=a,n=window.requestAnimationFrame(o)}(),()=>window.cancelAnimationFrame(n)};function Ft(e,r){const t=L(e),n=f.useRef(0);return f.useEffect(()=>()=>window.clearTimeout(n.current),[]),f.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(t,r)},[t,r])}function Ut(e,r){const t=L(r);M(()=>{let r=0;if(e){const n=new ResizeObserver(()=>{cancelAnimationFrame(r),r=window.requestAnimationFrame(t)});return n.observe(e),()=>{window.cancelAnimationFrame(r),n.unobserve(e)}}},[e,t])}function Wt(e,r){const{asChild:t,children:n}=e;if(!t)return"function"==typeof r?r(n):r;const o=f.Children.only(n);return f.cloneElement(o,{children:"function"==typeof r?r(o.props.children):r})}var Ht=ft,Vt=bt,Yt=Rt;f.forwardRef(({className:e,children:r,...t},n)=>O.jsxs(Ht,{ref:n,className:I("relative overflow-hidden",e),...t,children:[O.jsx(Vt,{className:"h-full w-full rounded-[inherit]",children:r}),O.jsx(Gt,{}),O.jsx(Yt,{})]})).displayName=Ht.displayName;const Gt=f.forwardRef(({className:e,orientation:r="vertical",...t},n)=>O.jsx(xt,{ref:n,orientation:r,className:I("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...t,children:O.jsx(Ot,{className:"relative flex-1 rounded-full bg-border"})}));Gt.displayName=xt.displayName;const Xt=({score:e,label:r="Score",subLabel:t,size:n=120,strokeWidth:o=8,color:a="#3b82f6"})=>{const s=(n-o)/2,i=2*s*Math.PI,l=i-e/100*i;return O.jsxs("div",{className:"relative flex flex-col items-center justify-center",style:{width:n,height:n},children:[O.jsxs("svg",{width:n,height:n,className:"transform -rotate-90",children:[O.jsx("circle",{cx:n/2,cy:n/2,r:s,stroke:"currentColor",strokeWidth:o,fill:"transparent",className:"text-slate-100 dark:text-slate-800"}),O.jsx("circle",{cx:n/2,cy:n/2,r:s,stroke:a,strokeWidth:o,fill:"transparent",strokeDasharray:i,strokeDashoffset:l,strokeLinecap:"round",className:"transition-all duration-1000 ease-out"})]}),O.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-center",children:[O.jsxs("span",{className:"text-2xl font-bold",style:{color:a},children:[e,"%"]}),r&&O.jsx("span",{className:"text-xs text-slate-500 font-medium uppercase tracking-wider",children:r}),t&&O.jsx("span",{className:"text-[10px] text-slate-400",children:t})]})]})},Kt=({metrics:e,width:r=300,height:t=250})=>{const n=[{subject:"Pronunciation",A:e.pronunciation,fullMark:100},{subject:"Intonation",A:e.intonation,fullMark:100},{subject:"Stress",A:e.stress,fullMark:100},{subject:"Rhythm",A:e.rhythm,fullMark:100}];return O.jsx("div",{className:"w-full flex justify-center",children:O.jsx("div",{style:{width:"100%",height:t,maxWidth:r},children:O.jsx(D,{width:"100%",height:"100%",children:O.jsxs(ct,{cx:"50%",cy:"50%",outerRadius:"70%",data:n,children:[O.jsx(dr,{stroke:"#e2e8f0"}),O.jsx(Yr,{dataKey:"subject",tick:{fill:"#64748b",fontSize:11,fontWeight:600}}),O.jsx(Rr,{angle:30,domain:[0,100],tick:!1,axisLine:!1}),O.jsx(lt,{name:"Metrics",dataKey:"A",stroke:"#3b82f6",strokeWidth:2,fill:"#3b82f6",fillOpacity:.2})]})})})})};f.createContext(null);f.forwardRef(({className:e,...r},t)=>O.jsxs(Ce,{ref:t,className:I("relative flex w-full touch-none select-none items-center",e),...r,children:[O.jsx(Ne,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:O.jsx(Pe,{className:"absolute h-full bg-primary"})}),O.jsx(_e,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})).displayName=Ce.displayName;const Qt=({active:e=!1,processing:r=!1,deviceId:t,barWidth:n=3,barGap:o=1,barRadius:a=1.5,barColor:s,fadeEdges:i=!0,fadeWidth:l=24,height:c=64,sensitivity:d=1,smoothingTimeConstant:u=.8,fftSize:m=256,historySize:p=60,updateRate:h=30,mode:g="static",onError:b,onStreamReady:y,onStreamEnd:x,className:v,...w})=>{const j=f.useRef(null),k=f.useRef(null),S=f.useRef([]),C=f.useRef(null),N=f.useRef(null),P=f.useRef(null),_=f.useRef(0),E=f.useRef(0),T=f.useRef(null),A=f.useRef([]),R=f.useRef(0),L=f.useRef([]),M=f.useRef(!0),$=f.useRef(null),D=f.useRef(0),z="number"==typeof c?`${c}px`:c;return f.useEffect(()=>{const e=j.current,r=k.current;if(!e||!r)return;const t=new ResizeObserver(()=>{const t=r.getBoundingClientRect(),n=window.devicePixelRatio||1;e.width=t.width*n,e.height=t.height*n,e.style.width=`${t.width}px`,e.style.height=`${t.height}px`;const o=e.getContext("2d");o&&o.scale(n,n),$.current=null,D.current=t.width,M.current=!0});return t.observe(r),()=>t.disconnect()},[]),f.useEffect(()=>{if(r&&!e){let e=0;R.current=0;const r=()=>{var t;e+=.03,R.current=Math.min(1,R.current+.02);const a=[],s=Math.floor(((null==(t=k.current)?void 0:t.getBoundingClientRect().width)||200)/(n+o));if("static"===g){const r=Math.floor(s/2);for(let t=0;t<s;t++){const n=(t-r)/r,o=1-.4*Math.abs(n),s=(.2+(.25*Math.sin(1.5*e+3*n)+.2*Math.sin(.8*e-2*n)+.15*Math.cos(2*e+n)))*o;let i=s;if(A.current.length>0&&R.current<1){const e=Math.min(t,A.current.length-1);i=(A.current[e]||0)*(1-R.current)+s*R.current}a.push(Math.max(.05,Math.min(1,i)))}}else for(let r=0;r<s;r++){const t=(r-s/2)/(s/2),n=1-.4*Math.abs(t),o=(.2+(.25*Math.sin(1.5*e+.15*r)+.2*Math.sin(.8*e-.1*r)+.15*Math.cos(2*e+.05*r)))*n;let i=o;if(A.current.length>0&&R.current<1){const e=Math.floor(r/s*A.current.length);i=(A.current[e]||0)*(1-R.current)+o*R.current}a.push(Math.max(.05,Math.min(1,i)))}"static"===g?L.current=a:S.current=a,M.current=!0,T.current=requestAnimationFrame(r)};return r(),()=>{T.current&&cancelAnimationFrame(T.current)}}if(!e&&!r){if("static"===g?L.current.length>0:S.current.length>0){let e=0;const r=()=>{e+=.03,e<1?("static"===g?L.current=L.current.map(r=>r*(1-e)):S.current=S.current.map(r=>r*(1-e)),M.current=!0,requestAnimationFrame(r)):"static"===g?L.current=[]:S.current=[]};r()}}},[r,e,n,o,g]),f.useEffect(()=>{if(!e)return P.current&&(P.current.getTracks().forEach(e=>e.stop()),P.current=null,null==x||x()),N.current&&"closed"!==N.current.state&&(N.current.close(),N.current=null),void(_.current&&(cancelAnimationFrame(_.current),_.current=0));return(async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:t?{deviceId:{exact:t},echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});P.current=e,null==y||y(e);const r=new(window.AudioContext||window.webkitAudioContext),n=r.createAnalyser();n.fftSize=m,n.smoothingTimeConstant=u;r.createMediaStreamSource(e).connect(n),N.current=r,C.current=n,S.current=[]}catch(e){null==b||b(e)}})(),()=>{P.current&&(P.current.getTracks().forEach(e=>e.stop()),P.current=null,null==x||x()),N.current&&"closed"!==N.current.state&&(N.current.close(),N.current=null),_.current&&(cancelAnimationFrame(_.current),_.current=0)}},[e,t,m,u,b,y,x]),f.useEffect(()=>{const t=j.current;if(!t)return;const c=t.getContext("2d");if(!c)return;let u;const m=f=>{const b=t.getBoundingClientRect();if(e&&f-E.current>h&&(E.current=f,C.current)){const e=new Uint8Array(C.current.frequencyBinCount);if(C.current.getByteFrequencyData(e),"static"===g){const r=Math.floor(.05*e.length),t=Math.floor(.4*e.length),a=e.slice(r,t),s=Math.floor(b.width/(n+o)),i=Math.floor(s/2),l=[];for(let e=i-1;e>=0;e--){const r=Math.floor(e/i*a.length),t=Math.min(1,a[r]/255*d);l.push(Math.max(.05,t))}for(let e=0;e<i;e++){const r=Math.floor(e/i*a.length),t=Math.min(1,a[r]/255*d);l.push(Math.max(.05,t))}L.current=l,A.current=l}else{let r=0;const t=Math.floor(.05*e.length),n=Math.floor(.4*e.length),o=e.slice(t,n);for(let e=0;e<o.length;e++)r+=o[e];const a=r/o.length/255*d;S.current.push(Math.min(1,Math.max(.05,a))),A.current=[...S.current],S.current.length>p&&S.current.shift()}M.current=!0}if(!M.current&&!e)return void(u=requestAnimationFrame(m));M.current=e,c.clearRect(0,0,b.width,b.height);const y=s||getComputedStyle(t).color||"#000",x=n+o,v=Math.floor(b.width/x),w=b.height/2;if("static"===g){const t=r||e||L.current.length>0?L.current:[];for(let e=0;e<v&&e<t.length;e++){const r=t[e]||.1,o=e*x,s=Math.max(4,r*b.height*.8),i=w-s/2;c.fillStyle=y,c.globalAlpha=.4+.6*r,a>0?(c.beginPath(),c.roundRect(o,i,n,s,a),c.fill()):c.fillRect(o,i,n,s)}}else for(let e=0;e<v&&e<S.current.length;e++){const r=S.current.length-1-e,t=S.current[r]||.1,o=b.width-(e+1)*x,s=Math.max(4,t*b.height*.8),i=w-s/2;c.fillStyle=y,c.globalAlpha=.4+.6*t,a>0?(c.beginPath(),c.roundRect(o,i,n,s,a),c.fill()):c.fillRect(o,i,n,s)}if(i&&l>0&&b.width>0){if(!$.current||D.current!==b.width){const e=c.createLinearGradient(0,0,b.width,0),r=Math.min(.3,l/b.width);e.addColorStop(0,"rgba(255,255,255,1)"),e.addColorStop(r,"rgba(255,255,255,0)"),e.addColorStop(1-r,"rgba(255,255,255,0)"),e.addColorStop(1,"rgba(255,255,255,1)"),$.current=e,D.current=b.width}c.globalCompositeOperation="destination-out",c.fillStyle=$.current,c.fillRect(0,0,b.width,b.height),c.globalCompositeOperation="source-over"}c.globalAlpha=1,u=requestAnimationFrame(m)};return u=requestAnimationFrame(m),()=>{u&&cancelAnimationFrame(u)}},[e,r,d,h,p,n,o,a,s,i,l,g]),O.jsxs("div",{className:I("relative h-full w-full",v),ref:k,style:{height:z},"aria-label":e?"Live audio waveform":r?"Processing audio":"Audio waveform idle",role:"img",...w,children:[!e&&!r&&O.jsx("div",{className:"border-muted-foreground/20 absolute top-1/2 right-0 left-0 -translate-y-1/2 border-t-2 border-dotted"}),O.jsx("canvas",{className:"block h-full w-full",ref:j,"aria-hidden":"true"})]})},Zt=()=>{var e,r,t,n,o;const a=z(),s=a.testId||a.testName,i=B(),{profile:l}=q(),{toast:c}=F(),d=U(),[u,m]=f.useState(null),[p,h]=f.useState([]),[g,b]=f.useState(1),[y,x]=f.useState(0),[v,w]=f.useState(!0),[j,k]=f.useState(!1),[S,C]=f.useState(!1),[N,P]=f.useState(!1),[_,E]=f.useState(null),[T,A]=f.useState(null),[R,L]=f.useState(0),[M,$]=f.useState(60),[I,D]=f.useState({}),[Ce,Ne]=f.useState("");f.useState(!1),f.useState("");const[Pe,_e]=f.useState(!1),[Oe,We]=f.useState("en");f.useEffect(()=>{(async()=>{if(null==l?void 0:l.id)try{const{data:e}=await Te.from("user_preferences").select("preferred_feedback_language, native_language").eq("user_id",l.id).maybeSingle(),r=e,t=(null==r?void 0:r.preferred_feedback_language)||(null==r?void 0:r.native_language);t&&Re.find(e=>e.value===t)&&We(t)}catch(e){console.warn("Error loading user preferred language:",e)}})()},[null==l?void 0:l.id]);const[He,Ve]=f.useState(!1),[Ye,Ge]=f.useState(!1),[Xe,Ke]=f.useState(!1),[Qe,Ze]=f.useState(!1),[Je,er]=f.useState(!1),[rr,tr]=f.useState([{id:"1",type:"bot",content:"Hello! I'm Catie, your expert IELTS Speaking tutor. I'm here to guide you through strategic speaking techniques, structure, and vocabulary enhancement. What specific aspect of your speaking would you like to work on?",timestamp:new Date}]),[nr,or]=f.useState(""),[ar,sr]=f.useState(!1),[ir,lr]=f.useState(!1),[cr,dr]=f.useState(null),ur=f.useRef(null),mr=f.useRef(null),pr=f.useRef(null),hr=f.useRef([]),fr=f.useRef(null),gr=f.useRef(null),br=(()=>{try{const e="undefined"!=typeof window?window.localStorage.getItem("appAudioVolume"):null,r=(e?parseInt(e,10):100)/100;return Number.isFinite(r)?Math.min(1,Math.max(0,r)):1}catch{return 1}})(),yr=f.useRef(br);f.useEffect(()=>(s?(xr(),tr([{id:"1",type:"bot",content:"Hello! I'm Catie, your expert IELTS Speaking tutor. I'm here to guide you through strategic speaking techniques, structure, and vocabulary enhancement. What specific aspect of your speaking would you like to work on?",timestamp:new Date}])):vr(),()=>{pr.current&&clearInterval(pr.current)}),[s]),f.useEffect(()=>(R>0?pr.current=setTimeout(()=>L(R-1),1e3):0===R&&j&&jr(),()=>{pr.current&&clearTimeout(pr.current)}),[R,j]),f.useEffect(()=>{const e=e=>{var r;const t=null==(r=null==e?void 0:e.detail)?void 0:r.volume;"number"==typeof t&&(yr.current=t,mr.current&&(mr.current.volume=t))};return window.addEventListener("app:volume-change",e),()=>window.removeEventListener("app:volume-change",e)},[]),f.useEffect(()=>{rr.length>0&&setTimeout(()=>{const e=document.querySelector("[data-conversation-content]");e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},100)},[rr]),f.useEffect(()=>{Ke(!1)},[y,g]),f.useEffect(()=>{if(fr.current){const e=fr.current;e.style.setProperty("transform","scale(1)","important"),e.style.setProperty("transition","none","important");const r=r=>{e.style.setProperty("transform","scale(1)","important"),e.style.setProperty("box-shadow","0 8px 32px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.1)","important"),e.style.setProperty("transition","none","important")};return e.addEventListener("mouseenter",r),e.addEventListener("mouseleave",r),()=>{e.removeEventListener("mouseenter",r),e.removeEventListener("mouseleave",r)}}},[u,g,y]);const xr=async()=>{if(s){w(!0);try{console.log(` Loading speaking test data for test ID: ${s}`);const e=s.includes("-")&&36===s.length,[r,t]=await Promise.all([e?Te.from("tests").select("id, test_name").eq("id",s).single():Te.from("tests").select("id, test_name").eq("test_name",s).eq("test_type","IELTS").eq("module","Speaking").maybeSingle(),Te.from("speaking_prompts").select("*").eq("test_id",s).order("part_number",{ascending:!0})]);if(r.error)throw r.error;const n=r.data;if(!n)return c({title:"Test Not Found",description:"This speaking test doesn't exist. Please check the test ID.",variant:"destructive"}),void i(-1);console.log(" Test loaded:",n.test_name);let o=t.data||[];if(0===o.length&&n.id!==s){const{data:e}=await Te.from("speaking_prompts").select("*").eq("test_id",n.id).order("part_number",{ascending:!0});o=e||[]}console.log(` Loaded ${o.length} total speaking prompts`);const a=[];let l=null;const d=[];o.forEach(e=>{1===e.part_number?a.push(e):2===e.part_number?l=e:3===e.part_number&&d.push(e)}),m({id:n.id,test_name:n.test_name,part1_prompts:a,part2_prompt:l,part3_prompts:d}),console.log(` Test ready: Part 1 (${a.length}), Part 2 (${l?1:0}), Part 3 (${d.length})`)}catch(e){console.error(" Error:",e),s&&m({id:s,test_name:"Speaking Test",part1_prompts:[],part2_prompt:null,part3_prompts:[]})}finally{w(!1)}}},vr=async()=>{w(!0);try{console.log(" Loading available speaking tests...");const{data:e,error:r}=await Te.from("tests").select("id, test_name, module, skill_category, created_at, speaking_prompts!inner(id)").eq("test_type","IELTS").order("created_at",{ascending:!1}).limit(50);if(r)throw console.error(" Error loading tests:",r),r;const t=(e||[]).filter(e=>{const r=(e.test_name||"").trim();return r&&r.length>=2&&!r.toLowerCase().includes("quick test")&&!["test ?","another test?",""].includes(r.toLowerCase())});console.log(` Found ${t.length} valid speaking tests`),h(t)}catch(e){console.error(" Error loading tests:",e),c({title:"Error",description:"Failed to load available speaking tests",variant:"destructive"}),h([])}finally{w(!1)}},wr=()=>{try{const e=new(window.AudioContext||window.webkitAudioContext),r=e.createOscillator(),t=e.createOscillator(),n=e.createGain();r.type="sine",r.frequency.value=523,t.type="sine",t.frequency.value=659,r.connect(n),t.connect(n),n.connect(e.destination),n.gain.setValueAtTime(1e-4,e.currentTime),n.gain.exponentialRampToValueAtTime(.05,e.currentTime+.01),r.start(),t.start(),setTimeout(()=>{n.gain.exponentialRampToValueAtTime(1e-5,e.currentTime+.15),setTimeout(()=>{r.stop(),t.stop(),e.close()},200)},120)}catch{}},jr=()=>{if(2===g&&gr.current){const e=Math.floor((Date.now()-gr.current)/1e3),r=60;if(e<r){const t=r-e;return void c({title:"Minimum Recording Time Required",description:`For IELTS Part 2, you should speak for at least 1 minute to receive a good score. Please continue recording for ${t} more second${1!==t?"s":""}.`,variant:"destructive",duration:5e3})}}wr(),ur.current&&j&&(ur.current.stop(),L(0),gr.current=null)},kr=()=>{if(T)try{T.pause(),T.currentTime=0,console.log(" Stopped recording playback")}catch(e){console.error("Error stopping recording playback:",e)}P(!1),E(null),A(null)},Sr=()=>{if(1===g)if(y<((null==u?void 0:u.part1_prompts.length)||0)-1)x(y+1),console.log(` Moving to Part 1, Question ${y+2}`);else{const e=!!(null==u?void 0:u.part2_prompt),r=!!((null==u?void 0:u.part3_prompts)&&u.part3_prompts.length>0);e||r?e?(b(2),x(0),$(60),console.log(" Moving to Part 2 - Long Turn"),Cr()):r&&(b(3),x(0),console.log(" Moving to Part 3 - Discussion (no Part 2 for this test)")):(console.log(" Part 1-only test completed - prompting for feedback language (AI analysis after Part 1)."),_e(!0))}else 2===g?(null==u?void 0:u.part3_prompts)&&u.part3_prompts.length>0?(b(3),x(0),console.log(" Moving to Part 3 - Discussion")):(console.log(" Part 2 completed - no Part 3 available, prompting for feedback language"),_e(!0)):3===g&&(y<((null==u?void 0:u.part3_prompts.length)||0)-1?(x(y+1),console.log(` Moving to Part 3, Question ${y+2}`)):(console.log(" Last question completed - prompting for feedback language"),_e(!0)))},Cr=()=>{const e=setInterval(()=>{$(r=>r<=1?(clearInterval(e),c({title:"Preparation Time Complete",description:"You may now start recording your response.",duration:5e3}),0):r-1)},1e3)},Nr=e=>`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`;if(v)return O.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:"dark"===d.theme.name?d.theme.colors.background:"transparent"},children:O.jsx(W,{size:"lg",message:"Loading speaking tests..."})});if(!s)return O.jsxs("div",{className:"min-h-screen relative",style:{backgroundColor:"dark"===d.theme.name?d.theme.colors.background:"transparent"},children:[O.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"note"===d.theme.name||"minimalist"===d.theme.name||"dark"===d.theme.name?"none":"url('/1000031207.png')",backgroundColor:d.backgroundImageColor}}),O.jsx("div",{className:"relative z-10",children:O.jsx(H,{title:"Available Speaking Tests",children:O.jsx("div",{className:"min-h-screen py-12",children:O.jsx("div",{className:"container mx-auto px-4",children:O.jsxs("div",{className:"max-w-4xl mx-auto",children:[O.jsx("div",{className:"mb-8 text-center",children:O.jsx("h1",{className:"text-4xl font-bold mb-2",style:{color:d.textPrimary},children:"IELTS speaking tests"})}),p.length>0?O.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:p.map(e=>O.jsx(V,{className:"cursor-pointer h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg flex items-center justify-center",onClick:()=>i(`/ielts-speaking-test/${e.id}`),style:{backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.8)":"dark"===d.theme.name?"rgba(255,255,255,0.1)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground,borderColor:d.border,...d.cardStyle},children:O.jsx(Y,{className:"p-3 md:p-4 text-center flex items-center justify-center h-full",children:O.jsx("h3",{className:"font-semibold text-sm",style:{color:d.textPrimary},children:e.test_name})})},e.id))}):O.jsxs("div",{className:"text-center py-12",children:[O.jsx("p",{className:"text-lg mb-4",style:{color:d.textSecondary},children:"No speaking tests available yet"}),O.jsx(G,{onClick:()=>i("/ielts-portal"),variant:"outline",style:{borderColor:d.border,color:d.textPrimary,backgroundColor:"glassmorphism"===d.theme.name||"dark"===d.theme.name?"rgba(255,255,255,0.1)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground},onMouseEnter:e=>e.currentTarget.style.backgroundColor=d.hoverBg,onMouseLeave:e=>e.currentTarget.style.backgroundColor="glassmorphism"===d.theme.name||"dark"===d.theme.name?"rgba(255,255,255,0.1)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground,children:"Back to Portal"})]})]})})})})})]});if(!u)return O.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:O.jsxs("div",{className:"text-center",children:[O.jsx("p",{className:"text-lg text-muted-foreground",children:"Test not found"}),O.jsx(G,{onClick:()=>i("/ielts-portal"),className:"mt-4",children:"Back to Portal"})]})});if(0===u.part1_prompts.length&&!u.part2_prompt&&0===u.part3_prompts.length)return O.jsx(H,{title:`IELTS Speaking - ${u.test_name}`,showBackButton:!0,children:O.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[O.jsxs("div",{className:"text-center",children:[O.jsx(X,{variant:"outline",className:"mb-4 px-4 py-1 text-primary border-primary/20",children:"IELTS SPEAKING TEST"}),O.jsx("h1",{className:"text-heading-2 mb-2",children:u.test_name})]}),O.jsx(K,{className:"card-modern",children:O.jsxs(Y,{className:"p-8 text-center",children:[O.jsx(Q,{className:"w-16 h-16 mx-auto mb-4 text-gray-400 dark:text-gray-500"}),O.jsx("h2",{className:"text-xl font-semibold mb-2",children:"No Speaking Content Available"}),O.jsx("p",{className:"text-muted-foreground mb-6",children:"This test doesn't have speaking content created yet. Please contact your administrator or try another test."}),O.jsxs("div",{className:"flex gap-4 justify-center",children:[O.jsx(G,{onClick:()=>i("/ielts-portal"),variant:"outline",children:"Back to Portal"}),O.jsx(G,{onClick:()=>i("/speaking"),children:"Try General Speaking Practice"})]})]})})]})});const Pr=()=>1===g?u.part1_prompts[y]:2===g?u.part2_prompt:3===g?u.part3_prompts[y]:null,_r=()=>{const e=Pr();return e?2===g?e.prompt_text||"":e.transcription||e.title||"":""},Er=async e=>{const r=e||nr.trim();if(!r||ar)return;const t={id:Date.now().toString(),type:"user",content:r,timestamp:new Date};tr(e=>[...e,t]),e||or(""),sr(!0);try{const e=_r(),t=`CONTEXT: The student is practicing IELTS Speaking Part ${g}.\n\nQuestion: "${e}"\n\nPlease provide concise, practical speaking guidance (ideas, vocabulary, structure). Do NOT write a full answer.`,n=rr.filter(e=>"user"===e.type||"bot"===e.type).map(e=>({role:"user"===e.type?"user":"assistant",content:e.content}));n.push({role:"user",content:r});const{data:o,error:a}=await Te.functions.invoke("openai-chat",{body:{skipCache:!0,messages:[{role:"system",content:t},...n],context:"catbot"}});if(a)throw a;const s={id:(Date.now()+1).toString(),type:"bot",content:o.response,timestamp:new Date};tr(e=>[...e,s])}catch(n){console.error("Error sending chat message:",n),c({title:"Error",description:"Failed to get response from Catie",variant:"destructive"})}finally{sr(!1)}},Or=e=>{Er(e)},Tr=Pr(),Ar=_r(),Rr=1===g?"Part 1":2===g?"Part 2":3===g?"Part 3":"Unknown Part";return O.jsxs("div",{className:"min-h-screen relative",style:{backgroundColor:"dark"===d.theme.name?d.theme.colors.background:"transparent"},children:[O.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"note"===d.theme.name||"minimalist"===d.theme.name||"dark"===d.theme.name?"none":"url('/1000031207.png')",backgroundColor:d.backgroundImageColor}}),O.jsx("div",{className:"relative z-10 min-h-screen flex flex-col",style:{backgroundColor:"dark"===d.theme.name?d.theme.colors.background:"transparent"},children:O.jsx(H,{title:`IELTS Speaking - ${u.test_name}`,showBackButton:!0,children:O.jsx("div",{className:"flex-1 flex justify-center min-h-[calc(100vh-120px)] py-8 sm:items-center sm:py-8",children:O.jsxs("div",{className:"w-full max-w-4xl mx-auto space-y-4 px-4 flex flex-col",children:[O.jsx("div",{className:"text-center py-2 sm:py-2 sm:mb-0 mb-0",children:O.jsxs("span",{className:"text-lg font-semibold",style:{color:d.textPrimary},children:["Part ",g]})}),O.jsxs(K,{ref:fr,className:"backdrop-blur-sm shadow-lg rounded-2xl flex flex-col relative",style:{backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.9)":"dark"===d.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground,borderColor:d.border,backdropFilter:"glassmorphism"===d.theme.name?"blur(12px)":"dark"===d.theme.name?"blur(8px)":"none",boxShadow:"dark"===d.theme.name?"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)":"note"===d.theme.name?null==(e=d.theme.styles.cardStyle)?void 0:e.boxShadow:"0 8px 32px rgba(15, 23, 42, 0.16), 0 0 0 1px rgba(148, 163, 253, 0.06)",...d.cardStyle},children:[O.jsx(Z,{children:O.jsxs(J,{className:"flex items-center justify-between",children:[O.jsx("span",{}),O.jsxs("div",{className:"flex items-center gap-3",children:[(1===g||3===g)&&O.jsx(ee,{children:O.jsxs(re,{children:[O.jsx(te,{asChild:!0,children:O.jsx("div",{onClick:()=>Ke(!Xe),className:"relative inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background",style:{backgroundColor:Xe?d.buttonPrimary:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.2)":"dark"===d.theme.name?"rgba(255,255,255,0.1)":"minimalist"===d.theme.name?"#e5e7eb":d.border},"data-state":Xe?"checked":"unchecked",children:O.jsx("div",{className:"pointer-events-none flex h-5 w-5 rounded-full shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0 items-center justify-center",style:{backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.95)":"dark"===d.theme.name?"rgba(255,255,255,0.9)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground},"data-state":Xe?"checked":"unchecked",children:Xe?O.jsx(ne,{className:"w-3 h-3",style:{color:"white"}}):O.jsx(oe,{className:"w-3 h-3",style:{color:d.textSecondary}})})})}),O.jsx(ae,{children:O.jsx("p",{children:Xe?"Hide question":"Show question"})})]})}),R>0&&O.jsxs(X,{variant:"outline",className:"flex items-center gap-2",style:{borderColor:d.border,backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.1)":"dark"===d.theme.name?"rgba(255,255,255,0.05)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground,color:d.textPrimary},children:[O.jsx(se,{className:"w-4 h-4",style:{color:d.textPrimary}}),Nr(R)]})]})]})}),O.jsxs(Y,{className:"space-y-4 flex flex-col relative",children:[2===g&&M>0&&O.jsx("div",{className:"text-center",children:O.jsxs("div",{className:"flex items-center justify-center gap-2",children:[O.jsx(se,{className:"w-5 h-5",style:{color:d.buttonPrimary}}),O.jsx("p",{className:"text-xl font-bold",style:{color:d.buttonPrimary},children:Nr(M)})]})}),1===g&&u.part1_prompts.length>0&&O.jsx("div",{className:"space-y-6 relative flex flex-col min-h-[200px]",children:O.jsx("div",{className:"min-h-[200px] flex items-center justify-center flex-1",children:Xe&&O.jsx("div",{className:"text-lg font-medium text-center select-none",style:{color:d.textPrimary},children:_r()})})}),3===g&&u.part3_prompts.length>0&&O.jsx("div",{className:"space-y-6 relative flex flex-col min-h-[200px]",children:O.jsx("div",{className:"min-h-[200px] flex items-center justify-center flex-1",children:Xe&&O.jsx("div",{className:"text-lg font-medium text-center select-none",style:{color:d.textPrimary},children:_r()})})}),2===g&&Tr&&O.jsxs("div",{className:"p-6 rounded-lg",style:{backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.1)":"dark"===d.theme.name?"rgba(255,255,255,0.05)":"minimalist"===d.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:d.border,borderWidth:"1px",borderStyle:"solid"},children:[O.jsx("h3",{className:"font-semibold mb-3",style:{color:d.textPrimary},children:"Cue Card"}),O.jsx("div",{className:"whitespace-pre-wrap text-sm leading-relaxed",style:{color:d.textSecondary},children:Tr.prompt_text})]}),2===g&&O.jsxs(O.Fragment,{children:[M>0&&O.jsxs("div",{className:"relative rounded-lg p-4",style:{backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.1)":"dark"===d.theme.name?"rgba(255,255,255,0.05)":"minimalist"===d.theme.name?"#fef3c7":"#FEF9E7",borderColor:d.border,borderWidth:"1px",borderStyle:"solid"},children:[O.jsx(ee,{children:O.jsxs(re,{children:[O.jsx(te,{asChild:!0,children:O.jsx(G,{variant:"ghost",size:"icon",onClick:()=>{$(e=>e+60)},className:"absolute top-2 right-2 h-8 w-8",style:{color:d.buttonPrimary},children:O.jsx(ie,{className:"w-4 h-4"})})}),O.jsx(ae,{children:O.jsx("p",{children:"Add 1 minute for notes"})})]})}),O.jsx("textarea",{placeholder:"Write your preparation notes here...",value:Ce,onChange:e=>Ne(e.target.value),className:"w-full h-32 p-3 bg-transparent resize-none focus:outline-none",style:{color:d.textPrimary}}),O.jsx("style",{dangerouslySetInnerHTML:{__html:`\n                      textarea[placeholder="Write your preparation notes here..."]::placeholder {\n                        color: ${d.textSecondary};\n                      }\n                    `}})]}),0===M&&Ce&&O.jsxs("div",{className:"relative rounded-lg p-4",style:{backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.1)":"dark"===d.theme.name?"rgba(255,255,255,0.05)":"minimalist"===d.theme.name?"#fef3c7":"#FEF9E7",borderColor:d.border,borderWidth:"1px",borderStyle:"solid"},children:[!j&&O.jsx(ee,{children:O.jsxs(re,{children:[O.jsx(te,{asChild:!0,children:O.jsx(G,{variant:"ghost",size:"icon",onClick:()=>{$(60),Cr()},className:"absolute top-2 right-2 h-8 w-8 text-primary",children:O.jsx(ie,{className:"w-4 h-4"})})}),O.jsx(ae,{children:O.jsx("p",{children:"Add 1 minute for notes"})})]})}),O.jsx("div",{className:"p-3 text-sm whitespace-pre-wrap",children:Ce})]})]}),(2===g&&0===M||2!==g)&&O.jsx("div",{className:"text-center min-h-[80px] flex items-center justify-center relative",children:j?O.jsxs(O.Fragment,{children:[O.jsx("div",{className:"absolute -top-5 left-1/2 -translate-x-1/2 w-[130px] sm:w-[180px]",children:O.jsx(Qt,{active:!0,height:55,barWidth:6,barGap:2,barRadius:3,mode:"static",fadeEdges:!1,barColor:"#2563eb",sensitivity:1.2,fftSize:256,historySize:60,updateRate:30})}),O.jsx(G,{onClick:jr,variant:"outline",size:"icon",className:"rounded-xl h-8 w-8 absolute bottom-0 left-1/2 transform -translate-x-1/2",style:{borderColor:d.border,color:d.buttonPrimary,backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.9)":"dark"===d.theme.name?"rgba(255,255,255,0.15)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground||"#ffffff"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=d.hoverBg||"rgba(0,0,0,0.05)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===d.theme.name?"rgba(255,255,255,0.9)":"dark"===d.theme.name?"rgba(255,255,255,0.15)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground||"#ffffff"},children:O.jsx(le,{className:"w-4 h-4",style:{color:d.buttonPrimary||"#2563eb"}})})]}):O.jsx(ee,{children:O.jsxs("div",{className:"flex items-center justify-center gap-3",children:[O.jsxs(re,{children:[O.jsx(te,{asChild:!0,children:O.jsx(G,{onClick:async()=>{try{wr(),await new Promise(e=>setTimeout(e,100));const e=await navigator.mediaDevices.getUserMedia({audio:!0});ur.current=new MediaRecorder(e),hr.current=[],ur.current.ondataavailable=e=>{e.data.size>0&&hr.current.push(e.data)},ur.current.onstop=()=>{const r=new Blob(hr.current,{type:"audio/webm"}),t=`part${g}_q${y}`;console.log(` Saving recording for ${t}, blob size: ${r.size}`),D(e=>{const n={...e,[t]:r};return console.log(" Recordings updated:",Object.keys(n)),n}),k(!1),e.getTracks().forEach(e=>e.stop())},ur.current.start(),k(!0),gr.current=Date.now(),(1===g||3===g||2===g)&&L(120)}catch(e){console.error("Error starting recording:",e),c({title:"Recording Error",description:"Failed to start recording. Please check microphone permissions.",variant:"destructive"})}},variant:"outline",className:"rounded-xl shadow-sm h-12 w-12",size:"icon",style:{backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.8)":"dark"===d.theme.name?"rgba(255,255,255,0.1)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground,borderColor:d.border,color:d.textPrimary},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=d.hoverBg,e.currentTarget.style.color=d.buttonPrimary},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===d.theme.name?"rgba(255,255,255,0.8)":"dark"===d.theme.name?"rgba(255,255,255,0.1)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground,e.currentTarget.style.color=d.textPrimary},children:O.jsx(Q,{className:"w-5 h-5"})})}),O.jsx(ae,{children:O.jsx("p",{children:"Start recording your answer"})})]}),(null==Tr?void 0:Tr.audio_url)&&O.jsxs(re,{children:[O.jsx(te,{asChild:!0,children:O.jsx(G,{onClick:()=>{const e=Pr();(null==e?void 0:e.audio_url)&&(console.log(` Repeating audio for Part ${g}`),(async e=>{var r;if(e){Qe||(Ze(!0),er(!1));try{C(!0),mr.current&&(mr.current.pause(),mr.current.currentTime=0,mr.current=null);const r=new Audio(e);r.preload="auto",r.volume=yr.current,r.onended=()=>{C(!1),console.log(" Audio playback completed"),mr.current=null},r.onerror=e=>{C(!1),console.error("Audio playback error:",e),mr.current=null,c({title:"Audio Error",description:"Failed to play audio prompt. The audio may be inaudible or unavailable.",variant:"destructive"})},r.onloadstart=()=>{console.log("Audio loading started")},r.oncanplay=()=>{console.log("Audio can play")},r.oncanplaythrough=()=>{console.log("Audio can play through")},mr.current=r,console.log(` Playing audio: ${e}`),r.load(),await new Promise(e=>setTimeout(e,100));const t=r.play();void 0!==t&&(await t,console.log("Audio started playing successfully"))}catch(t){console.error("Error playing audio:",t),C(!1),"NotAllowedError"===t.name||(null==(r=t.message)?void 0:r.includes("user didn't interact"))?(Qe||er(!0),console.log("Autoplay blocked - user needs to interact first")):c({title:"Audio Error",description:"Failed to play audio prompt. The audio may be inaudible or unavailable. Please try again.",variant:"destructive"}),mr.current&&(mr.current=null)}}})(e.audio_url))},disabled:S,variant:"outline",size:"icon",className:"h-12 w-12 rounded-xl",style:{borderColor:d.border,color:d.buttonPrimary,backgroundColor:"transparent"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=d.hoverBg},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:S?O.jsx(ce,{className:"w-5 h-5"}):O.jsx(de,{className:"w-5 h-5"})})}),O.jsx(ae,{children:O.jsx("p",{children:S?"Pause question audio":"Play question audio"})})]}),I[`part${g}_q${y}`]&&O.jsxs(re,{children:[O.jsx(te,{asChild:!0,children:O.jsx(G,{onClick:()=>{N&&_===`part${g}_q${y}`?kr():(async e=>{const r=I[e];if(r)try{T&&kr();const t=URL.createObjectURL(r),n=new Audio(t);n.volume=yr.current,A(n),n.onended=()=>{URL.revokeObjectURL(t),P(!1),E(null),A(null),console.log(` Recording playback ended: ${e}`)},n.onerror=()=>{URL.revokeObjectURL(t),P(!1),E(null),A(null),console.error(` Recording playback error: ${e}`),c({title:"Playback Error",description:"Failed to play your recording. The audio may be inaudible or corrupted.",variant:"destructive"})},await n.play(),P(!0),E(e),console.log(` Started recording playback: ${e}`)}catch(t){console.error("Error playing recording:",t),P(!1),E(null),A(null),c({title:"Playback Error",description:"Failed to play your recording",variant:"destructive"})}})(`part${g}_q${y}`)},variant:"outline",size:"icon",className:"h-12 w-12 rounded-xl",style:{borderColor:d.border,color:d.buttonPrimary,backgroundColor:"transparent"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=d.hoverBg},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:N&&_===`part${g}_q${y}`?O.jsx(ce,{className:"w-5 h-5"}):O.jsx(ue,{className:"w-5 h-5"})})}),O.jsx(ae,{children:O.jsx("p",{children:N&&_===`part${g}_q${y}`?"Stop listening to your recording":"Listen to your recorded answer"})})]}),(console.log(" DEBUG: Checking evaluate button condition",{currentPart:g,currentQuestion:y,key:`part${g}_q${y}`,hasRecording:!!I[`part${g}_q${y}`],allRecordingKeys:Object.keys(I),recordingValue:I[`part${g}_q${y}`]}),null),I[`part${g}_q${y}`]&&O.jsxs(re,{children:[O.jsx(te,{asChild:!0,children:O.jsx(G,{onClick:async()=>{const e=`part${g}_q${y}`,r=I[e];if(console.log(" EVALUATE: Current part:",g),console.log(" EVALUATE: Current question:",y),console.log(" EVALUATE: Recording key:",e),console.log(" EVALUATE: Recording exists:",!!r),console.log(" EVALUATE: Recording size:",null==r?void 0:r.size),console.log(" EVALUATE: All recording keys:",Object.keys(I)),r){lr(!0),dr(null);try{const t=new FileReader;t.readAsDataURL(r),t.onloadend=async()=>{const r=t.result.split(",")[1],n=_r();console.log(" Sending to Edge Function:",{audioLength:r.length,prompt:n,recordingKey:e});const{data:o,error:a}=await Te.functions.invoke("ielts-speaking-evaluator",{body:{audio:r,prompt:n}});if(a)throw a;console.log(" Evaluation received:",o),dr(o)}}catch(t){console.error("Evaluation error:",t),c({title:"Evaluation Failed",description:(null==t?void 0:t.message)||"Could not evaluate the recording. Please try again.",variant:"destructive"})}finally{lr(!1)}}else console.error(" No recording found for",e)},disabled:ir,variant:"outline",size:"icon",className:"h-12 w-12 rounded-xl",style:{borderColor:d.border,color:d.buttonPrimary,backgroundColor:ir?"dark"===d.theme.name?"rgba(59, 130, 246, 0.2)":"#eff6ff":"transparent",animation:ir?"pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite":"none"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=d.hoverBg},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:ir?O.jsx(me,{className:"w-5 h-5 animate-spin"}):O.jsx(me,{className:"w-5 h-5"})})}),O.jsx(ae,{children:O.jsx("p",{children:ir?"Evaluating your answer...":"Evaluate with AI"})})]})]})})}),cr&&O.jsxs("div",{className:"mt-8 p-6 rounded-2xl border animate-in fade-in slide-in-from-top-4 duration-500 max-w-3xl mx-auto text-left shadow-lg relative overflow-hidden",style:{borderColor:d.border,backgroundColor:d.theme.colors.cardBackground||"#ffffff",color:d.textPrimary},children:[O.jsxs("div",{className:"flex items-center justify-between mb-6 relative z-10",children:[O.jsxs("div",{className:"flex items-center gap-3",children:[O.jsxs("div",{className:"relative",children:[O.jsx("img",{src:"/1000031289.png",alt:"Catie AI",className:"w-14 h-14 rounded-full shadow-md object-cover ring-2 ring-offset-2",style:{ringColor:d.buttonPrimary}}),O.jsx("div",{className:"absolute -bottom-1 -right-1 w-5 h-5 rounded-full flex items-center justify-center shadow-sm border-2 border-white",style:{backgroundColor:d.buttonPrimary},children:O.jsx(me,{className:"w-2.5 h-2.5 text-white"})})]}),O.jsx("div",{children:O.jsx("h3",{className:"font-bold text-lg",style:{color:d.textPrimary},children:"Catie's Feedback"})})]}),O.jsx(G,{variant:"ghost",size:"sm",onClick:()=>dr(null),className:"h-8 w-8 p-0 opacity-60 hover:opacity-100",children:O.jsx(pe,{className:"w-4 h-4"})})]}),O.jsx("div",{className:"mb-6 space-y-4 relative z-10",children:O.jsxs("div",{className:"rounded-xl p-4 space-y-3 border",style:{backgroundColor:"dark"===d.theme.name?"rgba(255,255,255,0.02)":"#ffffff",borderColor:d.border},children:[O.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2 text-xs uppercase tracking-wider opacity-80",style:{color:d.textPrimary},children:[O.jsx(ue,{className:"w-3.5 h-3.5"}),"Your Response"]}),I[`part${g}_q${y}`]?O.jsx("div",{className:"p-2 rounded-xl border",style:{borderColor:d.border,backgroundColor:"dark"===d.theme.name?"rgba(0,0,0,0.2)":"transparent"},children:O.jsx(Ee,{src:URL.createObjectURL(I[`part${g}_q${y}`]),style:{backgroundColor:"transparent",border:"none",boxShadow:"none"}})}):O.jsxs("div",{className:"text-xs italic p-3 rounded-lg border flex items-center gap-2",style:{borderColor:d.border,color:d.textSecondary},children:[O.jsx(AlertCircle,{className:"w-4 h-4"}),"Audio recording not available"]}),O.jsx("div",{className:"mt-4",children:O.jsxs("div",{className:"rounded-xl p-4 border shadow-sm relative group",style:{backgroundColor:"dark"===d.theme.name?"rgba(0,0,0,0.2)":"#ffffff",borderColor:d.border},children:[O.jsx("div",{className:"absolute top-3 right-3 opacity-20 group-hover:opacity-50 transition-opacity",children:O.jsx(Fe,{className:"w-4 h-4"})}),O.jsxs("p",{className:"text-sm leading-relaxed italic",style:{color:d.textPrimary},children:['"',cr.transcription,'"']})]})})]})}),O.jsx("div",{className:"mb-8",children:O.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 items-center",children:[O.jsx("div",{className:"flex flex-col items-center justify-center p-4 rounded-2xl border",style:{backgroundColor:"dark"===d.theme.name?"rgba(255,255,255,0.03)":"minimalist"===d.theme.name?"#ffffff":"rgba(255,255,255,0.5)",borderColor:d.border},children:O.jsx(Xt,{score:Math.round(Object.values(cr.metrics||{}).reduce((e,r)=>e+r,0)/(Object.keys(cr.metrics||{}).length||1)),label:"Overall",subLabel:"Speaking Score",size:160,color:d.buttonPrimary})}),O.jsx("div",{className:"flex flex-col items-center justify-center p-2 rounded-2xl border h-[200px]",style:{backgroundColor:"dark"===d.theme.name?"rgba(255,255,255,0.03)":"minimalist"===d.theme.name?"#ffffff":"rgba(255,255,255,0.5)",borderColor:d.border},children:O.jsx(Kt,{metrics:{pronunciation:(null==(r=cr.metrics)?void 0:r.pronunciation)||0,intonation:(null==(t=cr.metrics)?void 0:t.intonation)||0,stress:(null==(n=cr.metrics)?void 0:n.stress)||0,rhythm:(null==(o=cr.metrics)?void 0:o.rhythm)||0},height:180})})]})}),O.jsx(Se,{className:"my-6",style:{backgroundColor:d.border}}),O.jsxs("div",{className:"space-y-2 mb-6",children:[O.jsxs("h3",{className:"font-semibold text-base flex items-center gap-2",style:{color:d.textPrimary},children:[O.jsx(he,{className:"w-4 h-4",style:{color:d.buttonPrimary}}),"Feedback"]}),O.jsx("p",{className:"text-sm leading-relaxed",style:{color:d.textSecondary},children:cr.feedback})]}),O.jsxs("div",{className:"p-4 rounded-xl space-y-2 mb-6 border-2",style:{backgroundColor:"dark"===d.theme.name?"rgba(255,255,255,0.05)":"glassmorphism"===d.theme.name?"rgba(255,255,255,0.7)":"minimalist"===d.theme.name?"#f0f9ff":"rgba(255,255,255,0.4)",borderColor:`${d.buttonPrimary}40`},children:[O.jsxs("h3",{className:"font-semibold flex items-center gap-2 text-xs uppercase tracking-wide",style:{color:d.buttonPrimary},children:[O.jsx(me,{className:"w-3 h-3"}),"Try saying it like this"]}),O.jsxs("p",{className:"text-base italic font-medium",style:{color:d.textPrimary},children:['"',cr.enhancedSentence,'"']})]}),O.jsx("div",{className:"rounded-xl border p-4 space-y-3 mb-6",style:{backgroundColor:"dark"===d.theme.name?"rgba(255,255,255,0.02)":"#ffffff",borderColor:d.border},children:O.jsx("div",{className:"space-y-4",children:O.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[O.jsxs("div",{className:"p-3 rounded-lg bg-amber-50/50 border border-amber-100",children:[O.jsx("h4",{className:"text-xs font-bold text-amber-700 uppercase tracking-wider mb-1",children:"Structure Tip"}),O.jsx("p",{className:"text-sm text-stone-600",children:1===g?"Expand your answers with 'Because... For example...'. Avoid short Yes/No responses.":2===g?"Ensure you cover all bullet points and tell a coherent story with a clear beginning, middle, and end.":"Develop your arguments fully. Use abstract ideas and general examples rather than personal stories."})]}),O.jsxs("div",{className:"p-3 rounded-lg bg-blue-50/50 border border-blue-100",children:[O.jsx("h4",{className:"text-xs font-bold text-blue-700 uppercase tracking-wider mb-1",children:"Quick Win"}),O.jsx("p",{className:"text-sm text-stone-600",children:'Try adding connectors like "Actually...", "To be honest...", or "I\'d say that..." to sound more natural and fluent.'})]})]})})})]}),Pe&&O.jsx("div",{className:"flex justify-center mt-4",children:O.jsxs("div",{className:"flex items-center gap-3",children:[O.jsxs(fe,{value:Oe,onValueChange:We,children:[O.jsx(ge,{className:"w-[90px] h-8 text-sm border-0 bg-transparent shadow-none p-0 focus:ring-0",style:{color:d.textPrimary,"--tw-ring-color":d.buttonPrimary},children:O.jsx(be,{placeholder:"Language"})}),O.jsx(ye,{children:Re.map(e=>O.jsx(xe,{value:e.value,children:e.label},e.value))})]}),O.jsx(G,{type:"button",onClick:()=>{try{localStorage.setItem("ielts_speaking_feedback_language",Oe||"en")}catch(e){console.warn("Unable to persist feedback language preference",e)}(async()=>{var e,r,t,n,o,a;try{const l=Object.entries(I);if(0===l.length)return void c({title:"No recordings found",description:"Please record answers before submitting.",variant:"destructive"});console.log(" Preparing speaking uploads:",{count:l.length,keys:l.map(([e])=>e)});const d=l.map(async([e,r],t)=>{var n,o,a,s,i,d,m,p,h,f,g,b,y,x,v,w;const j=(null==u?void 0:u.id)||"unknown",k=Date.now(),S=`speaking_${j}_${e}_${k}.webm`,C=new File([r],S,{type:"audio/webm"});try{console.log(` Uploading speaking recording [${t+1}/${l.length}]:`,{fileName:S,key:e,size:r.size});const c=await Ae.uploadSpeaking(C,j,e);if(!c.success)throw console.error(` R2 upload reported failure for ${S}:`,c.error),new Error(c.error||"Upload failed");c.url||console.warn(` R2 upload returned success but no URL for ${S}. Falling back to deterministic URL.`);const h=c.url||`https://placeholder-r2/${j}/speaking/${encodeURIComponent(e)}/${k}.webm`;console.log(` Speaking recording uploaded successfully: ${h}`);let f="";const g=e.match(/^part(\d+)_q(\d+)$/);if(g){const e=parseInt(g[1],10),r=parseInt(g[2],10);1===e&&(null==(n=null==u?void 0:u.part1_prompts)?void 0:n[r])?f=(null==(o=u.part1_prompts[r])?void 0:o.prompt_text)||(null==(a=u.part1_prompts[r])?void 0:a.transcription)||(null==(s=u.part1_prompts[r])?void 0:s.title)||"":2===e&&(null==u?void 0:u.part2_prompt)?f=u.part2_prompt.prompt_text||u.part2_prompt.transcription||u.part2_prompt.title||"":3===e&&(null==(i=null==u?void 0:u.part3_prompts)?void 0:i[r])&&(f=(null==(d=u.part3_prompts[r])?void 0:d.prompt_text)||(null==(m=u.part3_prompts[r])?void 0:m.transcription)||(null==(p=u.part3_prompts[r])?void 0:p.title)||"")}return{part:e,audio_url:h,question_text:f,upload_error:!1}}catch(N){const r=(null==N?void 0:N.message)||("string"==typeof N?N:"Unknown upload error");console.error(` Hard failure uploading ${S}:`,r),c({title:"Upload Warning",description:`We could not upload your recording for ${e}. We will still save your test and run analysis using available audio.`,variant:"destructive"});const t=`https://mock-r2-fallback.local/speaking/${encodeURIComponent(j)}/${encodeURIComponent(e)}/${k}.webm`;let n="";const o=e.match(/^part(\d+)_q(\d+)$/);if(o){const e=parseInt(o[1],10),r=parseInt(o[2],10);1===e&&(null==(h=null==u?void 0:u.part1_prompts)?void 0:h[r])?n=(null==(f=u.part1_prompts[r])?void 0:f.prompt_text)||(null==(g=u.part1_prompts[r])?void 0:g.transcription)||(null==(b=u.part1_prompts[r])?void 0:b.title)||"":2===e&&(null==u?void 0:u.part2_prompt)?n=u.part2_prompt.prompt_text||u.part2_prompt.transcription||u.part2_prompt.title||"":3===e&&(null==(y=null==u?void 0:u.part3_prompts)?void 0:y[r])&&(n=(null==(x=u.part3_prompts[r])?void 0:x.prompt_text)||(null==(v=u.part3_prompts[r])?void 0:v.transcription)||(null==(w=u.part3_prompts[r])?void 0:w.title)||"")}return{part:e,audio_url:t,question_text:n,upload_error:!0,error_message:r}}}),m=await Promise.all(d);if(!m||0===m.length)return console.error(" No speaking upload results returned"),void c({title:"Upload error",description:"We could not process your recordings. Please try again.",variant:"destructive"});const p=m.filter(e=>!e.upload_error).length,h=m.filter(e=>e.upload_error).length;console.log(" Speaking upload summary:",{total:m.length,successfulCount:p,failedCount:h});try{const{data:{user:s}}=await Te.auth.getUser();if(!s)throw new Error("User not authenticated while submitting speaking test");const c=m.map(e=>e.audio_url),{data:d,error:f}=await Te.from("test_results").insert({user_id:s.id,test_type:"speaking",total_questions:m.length,correct_answers:null,score_percentage:0,time_taken:900,audio_urls:c,audio_retention_expires_at:null,test_data:{recordings_count:m.length,parts_completed:[1,2,3],r2_upload_summary:{total:m.length,successful:p,failed:h},retention_policy:"no_auto_expiry_r2_persistent"}}).select().single();if(f||!d)throw f||new Error("Failed to create speaking test result");console.log(" Speaking test base records saved. AI scoring will be handled by backend using stored metadata and URLs.");const g=[];for(const i of m){const l=i.part.match(/^part(\d+)/),c=l?parseInt(l[1],10):NaN;if(isNaN(c)||c<1||c>3){console.error(`Invalid part number for recording: ${i.part}`);continue}let m="";if(1===c&&(null==(e=null==u?void 0:u.part1_prompts)?void 0:e.length)){const e=i.part.match(/_q(\d+)/),n=e?parseInt(e[1],10):0;n>=0&&n<u.part1_prompts.length&&(m=(null==(r=u.part1_prompts[n])?void 0:r.prompt_text)||(null==(t=u.part1_prompts[n])?void 0:t.transcription)||"")}else if(2===c&&(null==u?void 0:u.part2_prompt))m=u.part2_prompt.prompt_text||"";else if(3===c&&(null==(n=null==u?void 0:u.part3_prompts)?void 0:n.length)){const e=i.part.match(/_q(\d+)/),r=e?parseInt(e[1],10):0;r>=0&&r<u.part3_prompts.length&&(m=(null==(o=u.part3_prompts[r])?void 0:o.prompt_text)||(null==(a=u.part3_prompts[r])?void 0:a.transcription)||"")}g.push({user_id:s.id,test_result_id:d.id,part_number:c,question_text:m,audio_url:i.audio_url,transcription:"",band_scores:{},detailed_feedback:"",duration_seconds:120})}const{error:b}=await Te.from("speaking_test_results").insert(g);if(b)throw b;console.log(" Speaking test base records saved. Running AI scoring..."),console.log(" Skipping inline AI scoring for speaking test; base records saved for backend evaluation."),D({}),i("/ielts-speaking-results",{state:{testData:u,recordings:m,audioBlobs:Object.fromEntries(l),testResultId:d.id}})}catch(s){console.error("Error saving or scoring speaking results:",s),c({title:"Save error",description:"Failed to save or score speaking results. Your recordings may not be fully processed.",variant:"destructive"})}}catch(l){console.error("Error submitting test:",l),c({title:"Submission Error",description:"Failed to submit test. Please try again.",variant:"destructive"})}})()},className:"font-medium",style:{backgroundColor:d.buttonPrimary,color:"#ffffff"},children:"Submit"})]})}),(1===g||3===g)&&!Pe&&O.jsx(ee,{children:O.jsxs(O.Fragment,{children:[O.jsxs(re,{children:[O.jsx(te,{asChild:!0,children:O.jsx(G,{variant:"ghost",onClick:()=>{y>0&&(x(y-1),Ke(!1))},disabled:0===y,size:"icon",className:"absolute bottom-0 left-0 h-12 w-12",style:{color:d.textSecondary},onMouseEnter:e=>{e.currentTarget.style.color=d.buttonPrimary,e.currentTarget.style.backgroundColor="transparent"},onMouseLeave:e=>{e.currentTarget.style.color=d.textSecondary,e.currentTarget.style.backgroundColor="transparent"},children:O.jsx(ve,{className:"w-5 h-5"})})}),O.jsx(ae,{children:O.jsx("p",{children:"Previous question"})})]}),O.jsxs(re,{children:[O.jsx(te,{asChild:!0,children:O.jsx(G,{variant:"ghost",onClick:()=>{Ke(!1),Sr()},disabled:void 0===I[`part${g}_q${y}`],size:"icon",className:"absolute bottom-0 right-0 h-12 w-12",style:{color:d.textSecondary},onMouseEnter:e=>{e.currentTarget.style.color=d.buttonPrimary,e.currentTarget.style.backgroundColor="transparent"},onMouseLeave:e=>{e.currentTarget.style.color=d.textSecondary,e.currentTarget.style.backgroundColor="transparent"},children:O.jsx(we,{className:"w-5 h-5"})})}),O.jsx(ae,{children:O.jsx("p",{children:void 0===I[`part${g}_q${y}`]?"Please record your answer first":y!==((null==u?void 0:u.part1_prompts.length)||0)-1||1!==g||(null==u?void 0:u.part2_prompt)||(null==u?void 0:u.part3_prompts)&&0!==u.part3_prompts.length?"Next question":"Complete test"})})]})]})}),2===g&&!Pe&&O.jsx(ee,{children:O.jsxs(re,{children:[O.jsx(te,{asChild:!0,children:O.jsx(G,{variant:"ghost",onClick:()=>{Sr()},disabled:void 0===I[`part${g}_q${y}`],size:"icon",className:"absolute bottom-0 right-0 h-12 w-12 hover:bg-transparent hover:text-foreground",children:O.jsx(we,{className:"w-5 h-5"})})}),O.jsx(ae,{children:O.jsx("p",{children:void 0===I[`part${g}_q${y}`]?"Please record your answer first":(null==u?void 0:u.part3_prompts)&&u.part3_prompts.length>0?"Go to Part 3":"Complete test"})})]})})]})]}),O.jsx("div",{className:"fixed bottom-6 left-6 z-40 flex items-center gap-4",children:O.jsx("button",{onClick:()=>i("/ielts-portal"),className:"text-lg cursor-pointer transition-colors",style:{color:d.textSecondary},onMouseEnter:e=>e.currentTarget.style.color=d.buttonPrimary,onMouseLeave:e=>e.currentTarget.style.color=d.textSecondary,children:"Exit Test"})}),He&&O.jsxs("div",{className:"fixed bottom-12 right-4 sm:bottom-20 sm:right-[420px] z-50 flex flex-col gap-2 sm:gap-3",children:[O.jsx(ee,{children:O.jsxs(re,{children:[O.jsx(te,{asChild:!0,children:O.jsx(G,{variant:"outline",size:"icon",onClick:()=>Or("Help with Speaking Structure"),disabled:ar,className:"h-9 w-9 sm:h-12 sm:w-12 p-0 backdrop-blur-sm shadow-lg",style:{borderColor:d.border||"#e5e7eb",backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.9)":"dark"===d.theme.name?"rgba(255,255,255,0.15)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground||"#ffffff",color:d.buttonPrimary||"#2563eb"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=d.hoverBg||"rgba(0,0,0,0.05)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===d.theme.name?"rgba(255,255,255,0.9)":"dark"===d.theme.name?"rgba(255,255,255,0.15)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground||"#ffffff"},children:O.jsx(Ue,{className:"w-4 h-4 sm:w-6 sm:h-6",style:{color:d.buttonPrimary||"#2563eb"}})})}),O.jsx(ae,{side:"left",children:O.jsx("p",{children:"Get help with speaking structure"})})]})}),O.jsx(ee,{children:O.jsxs(re,{children:[O.jsx(te,{asChild:!0,children:O.jsx(G,{variant:"outline",size:"icon",onClick:()=>Or("Suggest Some Speaking Vocabulary"),disabled:ar,className:"h-9 w-9 sm:h-12 sm:w-12 p-0 backdrop-blur-sm shadow-lg",style:{borderColor:d.border||"#e5e7eb",backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.9)":"dark"===d.theme.name?"rgba(255,255,255,0.15)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground||"#ffffff",color:d.buttonPrimary||"#2563eb"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=d.hoverBg||"rgba(0,0,0,0.05)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===d.theme.name?"rgba(255,255,255,0.9)":"dark"===d.theme.name?"rgba(255,255,255,0.15)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground||"#ffffff"},children:O.jsx(je,{className:"w-4 h-4 sm:w-6 sm:h-6",style:{color:d.buttonPrimary||"#2563eb"}})})}),O.jsx(ae,{side:"left",children:O.jsx("p",{children:"Get vocabulary suggestions"})})]})}),O.jsx(ee,{children:O.jsxs(re,{children:[O.jsx(te,{asChild:!0,children:O.jsx(G,{variant:"outline",size:"icon",onClick:()=>Or("Give me 2-3 straightforward band 7+ example answers for this exact IELTS Speaking question. Just show the actual answers, no explanations."),disabled:ar,className:"h-9 w-9 sm:h-12 sm:w-12 p-0 backdrop-blur-sm shadow-lg",style:{borderColor:d.border||"#e5e7eb",backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.9)":"dark"===d.theme.name?"rgba(255,255,255,0.15)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground||"#ffffff",color:d.buttonPrimary||"#2563eb"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=d.hoverBg||"rgba(0,0,0,0.05)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===d.theme.name?"rgba(255,255,255,0.9)":"dark"===d.theme.name?"rgba(255,255,255,0.15)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground||"#ffffff"},children:O.jsx(me,{className:"w-4 h-4 sm:w-6 sm:h-6",style:{color:d.buttonPrimary||"#2563eb"}})})}),O.jsx(ae,{side:"left",children:O.jsx("p",{children:"View band 7+ example answers"})})]})}),O.jsx(ee,{children:O.jsxs(re,{children:[O.jsx(te,{asChild:!0,children:O.jsx(G,{variant:"outline",size:"icon",onClick:()=>Or("Help me with grammar for this speaking question"),disabled:ar,className:"h-9 w-9 sm:h-12 sm:w-12 p-0 backdrop-blur-sm shadow-lg",style:{borderColor:d.border||"#e5e7eb",backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.9)":"dark"===d.theme.name?"rgba(255,255,255,0.15)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground||"#ffffff",color:d.buttonPrimary||"#2563eb"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=d.hoverBg||"rgba(0,0,0,0.05)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===d.theme.name?"rgba(255,255,255,0.9)":"dark"===d.theme.name?"rgba(255,255,255,0.15)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground||"#ffffff"},children:O.jsx(Fe,{className:"w-4 h-4 sm:w-6 sm:h-6",style:{color:d.buttonPrimary||"#2563eb"}})})}),O.jsx(ae,{side:"left",children:O.jsx("p",{children:"Get grammar help"})})]})})]}),O.jsxs("div",{className:"fixed bottom-6 right-3 sm:bottom-6 sm:right-6 z-50",children:[He&&O.jsxs(K,{className:"backdrop-blur-md rounded-3xl w-[260px] h-[360px] sm:w-96 sm:h-[500px] shadow-2xl flex flex-col transform-gpu origin-bottom-right transition-all duration-260 ease-in-out "+(Ye?"opacity-100 scale-100 translate-y-0":"opacity-0 scale-75 translate-y-8"),style:{backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.95)":"dark"===d.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground,borderColor:d.border,backdropFilter:"glassmorphism"===d.theme.name?"blur(12px)":"dark"===d.theme.name?"blur(8px)":"none",...d.cardStyle},children:[O.jsx(Z,{className:"pb-1 sm:pb-2 rounded-t-3xl relative",children:O.jsx("div",{className:"absolute top-1.5 right-1.5 sm:top-2 sm:right-2",children:O.jsx(G,{variant:"ghost",size:"icon",onClick:()=>{Ge(!1),setTimeout(()=>{Ve(!1)},260)},className:"h-7 w-7 sm:h-8 sm:w-8 p-0",style:{color:d.textPrimary},children:""})})}),O.jsxs(Y,{className:"flex-1 flex flex-col px-2.5 py-2 sm:p-4 overflow-hidden",children:[O.jsx(Le,{className:"flex-1 min-h-0",children:O.jsx(Me,{className:"flex-1 min-h-0",children:0!==rr.length||ar?O.jsxs(O.Fragment,{children:[O.jsxs("div",{className:"rounded-lg p-3 mb-4",style:{backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.1)":"dark"===d.theme.name?"rgba(255,255,255,0.05)":"minimalist"===d.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:d.border,borderWidth:"1px",borderStyle:"solid"},children:[O.jsx("div",{className:"text-xs uppercase tracking-wide mb-1",style:{color:d.textSecondary},children:"Question"}),O.jsx("div",{className:"text-xs sm:text-sm font-medium",style:{color:d.textPrimary},children:Rr}),O.jsx("div",{className:"text-[10px] sm:text-sm whitespace-pre-wrap mt-1",style:{color:d.textSecondary},children:Ar||"No question available."})]}),rr.map(e=>O.jsxs(De,{from:"user"===e.type?"user":"assistant",children:["bot"===e.type&&O.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"52px",height:"52px",flexShrink:0},children:O.jsx("img",{src:"/1000031289.png",alt:"Catie",style:{width:"100%",height:"100%",objectFit:"cover"}})}),O.jsx(ze,{children:O.jsx("div",{className:"px-3 py-2 rounded-xl text-sm",style:{backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.1)":"dark"===d.theme.name?"rgba(255,255,255,0.05)":"minimalist"===d.theme.name?"#f9fafb":"rgba(255,255,255,0.5)",borderColor:d.border,borderWidth:"1px",borderStyle:"solid",color:d.textPrimary},children:O.jsx(Be,{dangerouslySetInnerHTML:{__html:e.content.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/^ (.*)$/gm,"<li>$1</li>").replace(/(<li>.*<\/li>)/s,"<ul>$1</ul>").replace(/\n/g,"<br>")}})})}),"user"===e.type&&(null==l?void 0:l.avatar_url)&&O.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"52px",height:"52px",flexShrink:0},children:O.jsx("img",{src:l.avatar_url,alt:"Your avatar",style:{width:"100%",height:"100%",objectFit:"cover"}})})]},e.id)),ar&&O.jsxs(De,{from:"assistant",children:[O.jsx(ze,{children:O.jsx("div",{className:"px-3 py-2 rounded-xl text-sm",style:{backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.1)":"dark"===d.theme.name?"rgba(255,255,255,0.05)":"minimalist"===d.theme.name?"#f9fafb":"rgba(255,255,255,0.5)",borderColor:d.border,borderWidth:"1px",borderStyle:"solid"},children:O.jsx(qe,{text:"Thinking..."})})}),O.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"52px",height:"52px"},children:O.jsx("img",{src:"/1000031289.png",alt:"Catie",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})]}):O.jsx($e,{icon:O.jsx(Ie,{className:"size-9 sm:size-12",style:{color:d.textSecondary}}),title:"Start a conversation",description:"Ask for help with your IELTS speaking practice"})})}),O.jsx("div",{className:"flex-shrink-0 mt-2.5 sm:mt-4",children:O.jsxs("div",{className:"flex gap-1.5 sm:gap-2",children:[O.jsx("input",{type:"text",value:nr,onChange:e=>or(e.target.value),onKeyPress:e=>"Enter"===e.key&&!ar&&nr.trim()&&Er(),placeholder:"Ask for speaking help...",className:"flex-1 px-2.5 py-1.5 sm:px-3 sm:py-2 rounded-lg text-[10px] sm:text-sm focus:outline-none focus:ring-0 resize-none",style:{backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.1)":"dark"===d.theme.name?"rgba(255,255,255,0.05)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground,borderColor:d.border,borderWidth:"1px",borderStyle:"solid",color:d.textPrimary},disabled:ar}),O.jsx("style",{dangerouslySetInnerHTML:{__html:`\n                      input[placeholder="Ask for speaking help..."]::placeholder {\n                        color: ${d.textSecondary};\n                      }\n                    `}}),O.jsx(G,{onClick:()=>Er(),disabled:ar||!nr.trim(),variant:"ghost",size:"icon",className:"h-7 w-7 sm:h-8 sm:w-8 p-0",style:{color:d.textPrimary},children:ar?O.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2",style:{borderColor:d.textPrimary}}):O.jsx(ke,{className:"w-4 h-4"})})]})})]})]}),!He&&O.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"64px",height:"64px",cursor:"pointer",boxShadow:"0 8px 20px rgba(0,0,0,0.18)",transition:"transform 0.22s ease-out, box-shadow 0.22s ease-out"},onClick:()=>{Ve(!0),requestAnimationFrame(()=>Ge(!0))},onMouseEnter:e=>{const r=e.currentTarget;r.style.transform="scale(1.06) translateY(-2px)",r.style.boxShadow="0 14px 30px rgba(0,0,0,0.24)"},onMouseLeave:e=>{const r=e.currentTarget;r.style.transform="scale(1.0) translateY(0px)",r.style.boxShadow="0 10px 25px rgba(0,0,0,0.15)"},children:O.jsx("img",{src:"/1000031289.png",alt:"Catie",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})]})})})})]})};export{Zt as default};
