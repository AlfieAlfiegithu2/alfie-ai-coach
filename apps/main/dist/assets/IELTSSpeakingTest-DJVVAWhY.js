import{y as e,an as r,r as t,at as o,ay as n,j as a,aq as s,as as l,ar as i,aX as c,au as d,bq as u,am as m,aP as h,ao as p,b5 as f,b4 as g,ak as b,u as x,A as v,g as y,af as w,bo as j,Z as k,ai as S,a as C,B as _,k as N,C as E,M as P,b as T,c as R,av as A,bb as M,bc as L,E as $,a1 as D,bd as I,$ as z,P as q,br as B,bp as F,ac as U,V as H,X as W,W as O,a6 as V,S as Y,o as X,p as K,q as G,s as Q,_ as J,bs as Z,d as ee,a7 as re}from"./index-Cpj2qXug.js";import{S as te}from"./separator-ByvJyJCt.js";import{s as oe}from"./supabase-Bqkrifq5.js";import{A as ne}from"./cloudflare-r2-DEyY8hXO.js";import"./dropdown-menu-C_s18YVE.js";import{F as ae,C as se,a as le,b as ie,O as ce,M as de,c as ue,R as me,S as he}from"./shimmering-text-9YGZtvHy.js";import{S as pe}from"./sparkles-UnhxfYjP.js";import{F as fe}from"./file-text-Bkg0ixRv.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=e("ListTree",[["path",{d:"M21 12h-8",key:"1bmf0i"}],["path",{d:"M21 6H8",key:"1pqkrb"}],["path",{d:"M21 18h-8",key:"1tm79t"}],["path",{d:"M3 6v4c0 1.1.9 2 2 2h3",key:"1ywdgy"}],["path",{d:"M3 10v6c0 1.1.9 2 2 2h3",key:"2wc746"}]]);var be="ScrollArea",[xe,ve]=r(be),[ye,we]=xe(be),je=t.forwardRef((e,r)=>{const{__scopeScrollArea:l,type:i="hover",dir:c,scrollHideDelay:d=600,...u}=e,[m,h]=t.useState(null),[p,f]=t.useState(null),[g,b]=t.useState(null),[x,v]=t.useState(null),[y,w]=t.useState(null),[j,k]=t.useState(0),[S,C]=t.useState(0),[_,N]=t.useState(!1),[E,P]=t.useState(!1),T=o(r,e=>h(e)),R=n(c);return a.jsx(ye,{scope:l,type:i,dir:R,scrollHideDelay:d,scrollArea:m,viewport:p,onViewportChange:f,content:g,onContentChange:b,scrollbarX:x,onScrollbarXChange:v,scrollbarXEnabled:_,onScrollbarXEnabledChange:N,scrollbarY:y,onScrollbarYChange:w,scrollbarYEnabled:E,onScrollbarYEnabledChange:P,onCornerWidthChange:k,onCornerHeightChange:C,children:a.jsx(s.div,{dir:R,...u,ref:T,style:{position:"relative","--radix-scroll-area-corner-width":j+"px","--radix-scroll-area-corner-height":S+"px",...e.style}})})});je.displayName=be;var ke="ScrollAreaViewport",Se=t.forwardRef((e,r)=>{const{__scopeScrollArea:n,children:l,asChild:i,nonce:c,...d}=e,u=we(ke,n),m=t.useRef(null),h=o(r,m,u.onViewportChange);return a.jsxs(a.Fragment,{children:[a.jsx("style",{dangerouslySetInnerHTML:{__html:"\n[data-radix-scroll-area-viewport] {\n  scrollbar-width: none;\n  -ms-overflow-style: none;\n  -webkit-overflow-scrolling: touch;\n}\n[data-radix-scroll-area-viewport]::-webkit-scrollbar {\n  display: none;\n}\n:where([data-radix-scroll-area-viewport]) {\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n}\n:where([data-radix-scroll-area-content]) {\n  flex-grow: 1;\n}\n"},nonce:c}),a.jsx(s.div,{"data-radix-scroll-area-viewport":"",...d,asChild:i,ref:h,style:{overflowX:u.scrollbarXEnabled?"scroll":"hidden",overflowY:u.scrollbarYEnabled?"scroll":"hidden",...e.style},children:Qe({asChild:i,children:l},e=>a.jsx("div",{"data-radix-scroll-area-content":"",ref:u.onContentChange,style:{minWidth:u.scrollbarXEnabled?"fit-content":void 0},children:e}))})]})});Se.displayName=ke;var Ce="ScrollAreaScrollbar",_e=t.forwardRef((e,r)=>{const{forceMount:o,...n}=e,s=we(Ce,e.__scopeScrollArea),{onScrollbarXEnabledChange:l,onScrollbarYEnabledChange:i}=s,c="horizontal"===e.orientation;return t.useEffect(()=>(c?l(!0):i(!0),()=>{c?l(!1):i(!1)}),[c,l,i]),"hover"===s.type?a.jsx(Ne,{...n,ref:r,forceMount:o}):"scroll"===s.type?a.jsx(Ee,{...n,ref:r,forceMount:o}):"auto"===s.type?a.jsx(Pe,{...n,ref:r,forceMount:o}):"always"===s.type?a.jsx(Te,{...n,ref:r}):null});_e.displayName=Ce;var Ne=t.forwardRef((e,r)=>{const{forceMount:o,...n}=e,s=we(Ce,e.__scopeScrollArea),[i,c]=t.useState(!1);return t.useEffect(()=>{const e=s.scrollArea;let r=0;if(e){const t=()=>{window.clearTimeout(r),c(!0)},o=()=>{r=window.setTimeout(()=>c(!1),s.scrollHideDelay)};return e.addEventListener("pointerenter",t),e.addEventListener("pointerleave",o),()=>{window.clearTimeout(r),e.removeEventListener("pointerenter",t),e.removeEventListener("pointerleave",o)}}},[s.scrollArea,s.scrollHideDelay]),a.jsx(l,{present:o||i,children:a.jsx(Pe,{"data-state":i?"visible":"hidden",...n,ref:r})})}),Ee=t.forwardRef((e,r)=>{const{forceMount:o,...n}=e,s=we(Ce,e.__scopeScrollArea),c="horizontal"===e.orientation,d=Ke(()=>m("SCROLL_END"),100),[u,m]=(h="hidden",p={hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}},t.useReducer((e,r)=>p[e][r]??e,h));var h,p;return t.useEffect(()=>{if("idle"===u){const e=window.setTimeout(()=>m("HIDE"),s.scrollHideDelay);return()=>window.clearTimeout(e)}},[u,s.scrollHideDelay,m]),t.useEffect(()=>{const e=s.viewport,r=c?"scrollLeft":"scrollTop";if(e){let t=e[r];const o=()=>{const o=e[r];t!==o&&(m("SCROLL"),d()),t=o};return e.addEventListener("scroll",o),()=>e.removeEventListener("scroll",o)}},[s.viewport,c,m,d]),a.jsx(l,{present:o||"hidden"!==u,children:a.jsx(Te,{"data-state":"hidden"===u?"hidden":"visible",...n,ref:r,onPointerEnter:i(e.onPointerEnter,()=>m("POINTER_ENTER")),onPointerLeave:i(e.onPointerLeave,()=>m("POINTER_LEAVE"))})})}),Pe=t.forwardRef((e,r)=>{const o=we(Ce,e.__scopeScrollArea),{forceMount:n,...s}=e,[i,c]=t.useState(!1),d="horizontal"===e.orientation,u=Ke(()=>{if(o.viewport){const e=o.viewport.offsetWidth<o.viewport.scrollWidth,r=o.viewport.offsetHeight<o.viewport.scrollHeight;c(d?e:r)}},10);return Ge(o.viewport,u),Ge(o.content,u),a.jsx(l,{present:n||i,children:a.jsx(Te,{"data-state":i?"visible":"hidden",...s,ref:r})})}),Te=t.forwardRef((e,r)=>{const{orientation:o="vertical",...n}=e,s=we(Ce,e.__scopeScrollArea),l=t.useRef(null),i=t.useRef(0),[c,d]=t.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),u=He(c.viewport,c.content),m={...n,sizes:c,onSizesChange:d,hasThumb:Boolean(u>0&&u<1),onThumbChange:e=>l.current=e,onThumbPointerUp:()=>i.current=0,onThumbPointerDown:e=>i.current=e};function h(e,r){return function(e,r,t,o="ltr"){const n=We(t),a=n/2,s=r||a,l=n-s,i=t.scrollbar.paddingStart+s,c=t.scrollbar.size-t.scrollbar.paddingEnd-l,d=t.content-t.viewport,u="ltr"===o?[0,d]:[-1*d,0];return Ve([i,c],u)(e)}(e,i.current,c,r)}return"horizontal"===o?a.jsx(Re,{...m,ref:r,onThumbPositionChange:()=>{if(s.viewport&&l.current){const e=Oe(s.viewport.scrollLeft,c,s.dir);l.current.style.transform=`translate3d(${e}px, 0, 0)`}},onWheelScroll:e=>{s.viewport&&(s.viewport.scrollLeft=e)},onDragScroll:e=>{s.viewport&&(s.viewport.scrollLeft=h(e,s.dir))}}):"vertical"===o?a.jsx(Ae,{...m,ref:r,onThumbPositionChange:()=>{if(s.viewport&&l.current){const e=Oe(s.viewport.scrollTop,c);l.current.style.transform=`translate3d(0, ${e}px, 0)`}},onWheelScroll:e=>{s.viewport&&(s.viewport.scrollTop=e)},onDragScroll:e=>{s.viewport&&(s.viewport.scrollTop=h(e))}}):null}),Re=t.forwardRef((e,r)=>{const{sizes:n,onSizesChange:s,...l}=e,i=we(Ce,e.__scopeScrollArea),[c,d]=t.useState(),u=t.useRef(null),m=o(r,u,i.onScrollbarXChange);return t.useEffect(()=>{u.current&&d(getComputedStyle(u.current))},[u]),a.jsx($e,{"data-orientation":"horizontal",...l,ref:m,sizes:n,style:{bottom:0,left:"rtl"===i.dir?"var(--radix-scroll-area-corner-width)":0,right:"ltr"===i.dir?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":We(n)+"px",...e.style},onThumbPointerDown:r=>e.onThumbPointerDown(r.x),onDragScroll:r=>e.onDragScroll(r.x),onWheelScroll:(r,t)=>{if(i.viewport){const o=i.viewport.scrollLeft+r.deltaX;e.onWheelScroll(o),Ye(o,t)&&r.preventDefault()}},onResize:()=>{u.current&&i.viewport&&c&&s({content:i.viewport.scrollWidth,viewport:i.viewport.offsetWidth,scrollbar:{size:u.current.clientWidth,paddingStart:Ue(c.paddingLeft),paddingEnd:Ue(c.paddingRight)}})}})}),Ae=t.forwardRef((e,r)=>{const{sizes:n,onSizesChange:s,...l}=e,i=we(Ce,e.__scopeScrollArea),[c,d]=t.useState(),u=t.useRef(null),m=o(r,u,i.onScrollbarYChange);return t.useEffect(()=>{u.current&&d(getComputedStyle(u.current))},[u]),a.jsx($e,{"data-orientation":"vertical",...l,ref:m,sizes:n,style:{top:0,right:"ltr"===i.dir?0:void 0,left:"rtl"===i.dir?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":We(n)+"px",...e.style},onThumbPointerDown:r=>e.onThumbPointerDown(r.y),onDragScroll:r=>e.onDragScroll(r.y),onWheelScroll:(r,t)=>{if(i.viewport){const o=i.viewport.scrollTop+r.deltaY;e.onWheelScroll(o),Ye(o,t)&&r.preventDefault()}},onResize:()=>{u.current&&i.viewport&&c&&s({content:i.viewport.scrollHeight,viewport:i.viewport.offsetHeight,scrollbar:{size:u.current.clientHeight,paddingStart:Ue(c.paddingTop),paddingEnd:Ue(c.paddingBottom)}})}})}),[Me,Le]=xe(Ce),$e=t.forwardRef((e,r)=>{const{__scopeScrollArea:n,sizes:l,hasThumb:d,onThumbChange:u,onThumbPointerUp:m,onThumbPointerDown:h,onThumbPositionChange:p,onDragScroll:f,onWheelScroll:g,onResize:b,...x}=e,v=we(Ce,n),[y,w]=t.useState(null),j=o(r,e=>w(e)),k=t.useRef(null),S=t.useRef(""),C=v.viewport,_=l.content-l.viewport,N=c(g),E=c(p),P=Ke(b,10);function T(e){if(k.current){const r=e.clientX-k.current.left,t=e.clientY-k.current.top;f({x:r,y:t})}}return t.useEffect(()=>{const e=e=>{const r=e.target;(null==y?void 0:y.contains(r))&&N(e,_)};return document.addEventListener("wheel",e,{passive:!1}),()=>document.removeEventListener("wheel",e,{passive:!1})},[C,y,_,N]),t.useEffect(E,[l,E]),Ge(y,P),Ge(v.content,P),a.jsx(Me,{scope:n,scrollbar:y,hasThumb:d,onThumbChange:c(u),onThumbPointerUp:c(m),onThumbPositionChange:E,onThumbPointerDown:c(h),children:a.jsx(s.div,{...x,ref:j,style:{position:"absolute",...x.style},onPointerDown:i(e.onPointerDown,e=>{if(0===e.button){e.target.setPointerCapture(e.pointerId),k.current=y.getBoundingClientRect(),S.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",v.viewport&&(v.viewport.style.scrollBehavior="auto"),T(e)}}),onPointerMove:i(e.onPointerMove,T),onPointerUp:i(e.onPointerUp,e=>{const r=e.target;r.hasPointerCapture(e.pointerId)&&r.releasePointerCapture(e.pointerId),document.body.style.webkitUserSelect=S.current,v.viewport&&(v.viewport.style.scrollBehavior=""),k.current=null})})})}),De="ScrollAreaThumb",Ie=t.forwardRef((e,r)=>{const{forceMount:t,...o}=e,n=Le(De,e.__scopeScrollArea);return a.jsx(l,{present:t||n.hasThumb,children:a.jsx(ze,{ref:r,...o})})}),ze=t.forwardRef((e,r)=>{const{__scopeScrollArea:n,style:l,...c}=e,d=we(De,n),u=Le(De,n),{onThumbPositionChange:m}=u,h=o(r,e=>u.onThumbChange(e)),p=t.useRef(),f=Ke(()=>{p.current&&(p.current(),p.current=void 0)},100);return t.useEffect(()=>{const e=d.viewport;if(e){const r=()=>{if(f(),!p.current){const r=Xe(e,m);p.current=r,m()}};return m(),e.addEventListener("scroll",r),()=>e.removeEventListener("scroll",r)}},[d.viewport,f,m]),a.jsx(s.div,{"data-state":u.hasThumb?"visible":"hidden",...c,ref:h,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...l},onPointerDownCapture:i(e.onPointerDownCapture,e=>{const r=e.target.getBoundingClientRect(),t=e.clientX-r.left,o=e.clientY-r.top;u.onThumbPointerDown({x:t,y:o})}),onPointerUp:i(e.onPointerUp,u.onThumbPointerUp)})});Ie.displayName=De;var qe="ScrollAreaCorner",Be=t.forwardRef((e,r)=>{const t=we(qe,e.__scopeScrollArea),o=Boolean(t.scrollbarX&&t.scrollbarY);return"scroll"!==t.type&&o?a.jsx(Fe,{...e,ref:r}):null});Be.displayName=qe;var Fe=t.forwardRef((e,r)=>{const{__scopeScrollArea:o,...n}=e,l=we(qe,o),[i,c]=t.useState(0),[d,u]=t.useState(0),m=Boolean(i&&d);return Ge(l.scrollbarX,()=>{var e;const r=(null==(e=l.scrollbarX)?void 0:e.offsetHeight)||0;l.onCornerHeightChange(r),u(r)}),Ge(l.scrollbarY,()=>{var e;const r=(null==(e=l.scrollbarY)?void 0:e.offsetWidth)||0;l.onCornerWidthChange(r),c(r)}),m?a.jsx(s.div,{...n,ref:r,style:{width:i,height:d,position:"absolute",right:"ltr"===l.dir?0:void 0,left:"rtl"===l.dir?0:void 0,bottom:0,...e.style}}):null});function Ue(e){return e?parseInt(e,10):0}function He(e,r){const t=e/r;return isNaN(t)?0:t}function We(e){const r=He(e.viewport,e.content),t=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,o=(e.scrollbar.size-t)*r;return Math.max(o,18)}function Oe(e,r,t="ltr"){const o=We(r),n=r.scrollbar.paddingStart+r.scrollbar.paddingEnd,a=r.scrollbar.size-n,s=r.content-r.viewport,l=a-o,i=u(e,"ltr"===t?[0,s]:[-1*s,0]);return Ve([0,s],[0,l])(i)}function Ve(e,r){return t=>{if(e[0]===e[1]||r[0]===r[1])return r[0];const o=(r[1]-r[0])/(e[1]-e[0]);return r[0]+o*(t-e[0])}}function Ye(e,r){return e>0&&e<r}var Xe=(e,r=()=>{})=>{let t={left:e.scrollLeft,top:e.scrollTop},o=0;return function n(){const a={left:e.scrollLeft,top:e.scrollTop},s=t.left!==a.left,l=t.top!==a.top;(s||l)&&r(),t=a,o=window.requestAnimationFrame(n)}(),()=>window.cancelAnimationFrame(o)};function Ke(e,r){const o=c(e),n=t.useRef(0);return t.useEffect(()=>()=>window.clearTimeout(n.current),[]),t.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(o,r)},[o,r])}function Ge(e,r){const t=c(r);d(()=>{let r=0;if(e){const o=new ResizeObserver(()=>{cancelAnimationFrame(r),r=window.requestAnimationFrame(t)});return o.observe(e),()=>{window.cancelAnimationFrame(r),o.unobserve(e)}}},[e,t])}function Qe(e,r){const{asChild:o,children:n}=e;if(!o)return"function"==typeof r?r(n):r;const a=t.Children.only(n);return t.cloneElement(a,{children:"function"==typeof r?r(a.props.children):r})}var Je=je,Ze=Se,er=Be;t.forwardRef(({className:e,children:r,...t},o)=>a.jsxs(Je,{ref:o,className:m("relative overflow-hidden",e),...t,children:[a.jsx(Ze,{className:"h-full w-full rounded-[inherit]",children:r}),a.jsx(rr,{}),a.jsx(er,{})]})).displayName=Je.displayName;const rr=t.forwardRef(({className:e,orientation:r="vertical",...t},o)=>a.jsx(_e,{ref:o,orientation:r,className:m("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...t,children:a.jsx(Ie,{className:"relative flex-1 rounded-full bg-border"})}));rr.displayName=_e.displayName,t.createContext(null);var tr=["PageUp","PageDown"],or=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],nr={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},ar="Slider",[sr,lr,ir]=h(ar),[cr,dr]=r(ar,[ir]),[ur,mr]=cr(ar),hr=t.forwardRef((e,r)=>{const{name:o,min:n=0,max:s=100,step:l=1,orientation:c="horizontal",disabled:d=!1,minStepsBetweenThumbs:m=0,defaultValue:h=[n],value:f,onValueChange:g=()=>{},onValueCommit:b=()=>{},inverted:x=!1,form:v,...y}=e,w=t.useRef(new Set),j=t.useRef(0),k="horizontal"===c?gr:br,[S=[],C]=p({prop:f,defaultProp:h,onChange:e=>{var r;null==(r=[...w.current][j.current])||r.focus(),g(e)}}),_=t.useRef(S);function N(e,r,{commit:t}={commit:!1}){const o=function(e){return(String(e).split(".")[1]||"").length}(l),a=function(e,r){const t=Math.pow(10,r);return Math.round(e*t)/t}(Math.round((e-n)/l)*l+n,o),i=u(a,[n,s]);C((e=[])=>{const o=function(e=[],r,t){const o=[...e];return o[t]=r,o.sort((e,r)=>e-r)}(e,i,r);if(function(e,r){if(r>0){const t=function(e){return e.slice(0,-1).map((r,t)=>e[t+1]-r)}(e);return Math.min(...t)>=r}return!0}(o,m*l)){j.current=o.indexOf(i);const r=String(o)!==String(e);return r&&t&&b(o),r?o:e}return e})}return a.jsx(ur,{scope:e.__scopeSlider,name:o,disabled:d,min:n,max:s,valueIndexToChangeRef:j,thumbs:w.current,values:S,orientation:c,form:v,children:a.jsx(sr.Provider,{scope:e.__scopeSlider,children:a.jsx(sr.Slot,{scope:e.__scopeSlider,children:a.jsx(k,{"aria-disabled":d,"data-disabled":d?"":void 0,...y,ref:r,onPointerDown:i(y.onPointerDown,()=>{d||(_.current=S)}),min:n,max:s,inverted:x,onSlideStart:d?void 0:function(e){const r=function(e,r){if(1===e.length)return 0;const t=e.map(e=>Math.abs(e-r)),o=Math.min(...t);return t.indexOf(o)}(S,e);N(e,r)},onSlideMove:d?void 0:function(e){N(e,j.current)},onSlideEnd:d?void 0:function(){const e=_.current[j.current];S[j.current]!==e&&b(S)},onHomeKeyDown:()=>!d&&N(n,0,{commit:!0}),onEndKeyDown:()=>!d&&N(s,S.length-1,{commit:!0}),onStepKeyDown:({event:e,direction:r})=>{if(!d){const t=tr.includes(e.key)||e.shiftKey&&or.includes(e.key)?10:1,o=j.current;N(S[o]+l*t*r,o,{commit:!0})}}})})})})});hr.displayName=ar;var[pr,fr]=cr(ar,{startEdge:"left",endEdge:"right",size:"width",direction:1}),gr=t.forwardRef((e,r)=>{const{min:s,max:l,dir:i,inverted:c,onSlideStart:d,onSlideMove:u,onSlideEnd:m,onStepKeyDown:h,...p}=e,[f,g]=t.useState(null),b=o(r,e=>g(e)),x=t.useRef(),v=n(i),y="ltr"===v,w=y&&!c||!y&&c;function j(e){const r=x.current||f.getBoundingClientRect(),t=Er([0,r.width],w?[s,l]:[l,s]);return x.current=r,t(e-r.left)}return a.jsx(pr,{scope:e.__scopeSlider,startEdge:w?"left":"right",endEdge:w?"right":"left",direction:w?1:-1,size:"width",children:a.jsx(xr,{dir:v,"data-orientation":"horizontal",...p,ref:b,style:{...p.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:e=>{const r=j(e.clientX);null==d||d(r)},onSlideMove:e=>{const r=j(e.clientX);null==u||u(r)},onSlideEnd:()=>{x.current=void 0,null==m||m()},onStepKeyDown:e=>{const r=nr[w?"from-left":"from-right"].includes(e.key);null==h||h({event:e,direction:r?-1:1})}})})}),br=t.forwardRef((e,r)=>{const{min:n,max:s,inverted:l,onSlideStart:i,onSlideMove:c,onSlideEnd:d,onStepKeyDown:u,...m}=e,h=t.useRef(null),p=o(r,h),f=t.useRef(),g=!l;function b(e){const r=f.current||h.current.getBoundingClientRect(),t=Er([0,r.height],g?[s,n]:[n,s]);return f.current=r,t(e-r.top)}return a.jsx(pr,{scope:e.__scopeSlider,startEdge:g?"bottom":"top",endEdge:g?"top":"bottom",size:"height",direction:g?1:-1,children:a.jsx(xr,{"data-orientation":"vertical",...m,ref:p,style:{...m.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:e=>{const r=b(e.clientY);null==i||i(r)},onSlideMove:e=>{const r=b(e.clientY);null==c||c(r)},onSlideEnd:()=>{f.current=void 0,null==d||d()},onStepKeyDown:e=>{const r=nr[g?"from-bottom":"from-top"].includes(e.key);null==u||u({event:e,direction:r?-1:1})}})})}),xr=t.forwardRef((e,r)=>{const{__scopeSlider:t,onSlideStart:o,onSlideMove:n,onSlideEnd:l,onHomeKeyDown:c,onEndKeyDown:d,onStepKeyDown:u,...m}=e,h=mr(ar,t);return a.jsx(s.span,{...m,ref:r,onKeyDown:i(e.onKeyDown,e=>{"Home"===e.key?(c(e),e.preventDefault()):"End"===e.key?(d(e),e.preventDefault()):tr.concat(or).includes(e.key)&&(u(e),e.preventDefault())}),onPointerDown:i(e.onPointerDown,e=>{const r=e.target;r.setPointerCapture(e.pointerId),e.preventDefault(),h.thumbs.has(r)?r.focus():o(e)}),onPointerMove:i(e.onPointerMove,e=>{e.target.hasPointerCapture(e.pointerId)&&n(e)}),onPointerUp:i(e.onPointerUp,e=>{const r=e.target;r.hasPointerCapture(e.pointerId)&&(r.releasePointerCapture(e.pointerId),l(e))})})}),vr="SliderTrack",yr=t.forwardRef((e,r)=>{const{__scopeSlider:t,...o}=e,n=mr(vr,t);return a.jsx(s.span,{"data-disabled":n.disabled?"":void 0,"data-orientation":n.orientation,...o,ref:r})});yr.displayName=vr;var wr="SliderRange",jr=t.forwardRef((e,r)=>{const{__scopeSlider:n,...l}=e,i=mr(wr,n),c=fr(wr,n),d=t.useRef(null),u=o(r,d),m=i.values.length,h=i.values.map(e=>Nr(e,i.min,i.max)),p=m>1?Math.min(...h):0,f=100-Math.max(...h);return a.jsx(s.span,{"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,...l,ref:u,style:{...e.style,[c.startEdge]:p+"%",[c.endEdge]:f+"%"}})});jr.displayName=wr;var kr="SliderThumb",Sr=t.forwardRef((e,r)=>{const n=lr(e.__scopeSlider),[s,l]=t.useState(null),i=o(r,e=>l(e)),c=t.useMemo(()=>s?n().findIndex(e=>e.ref.current===s):-1,[n,s]);return a.jsx(Cr,{...e,ref:i,index:c})}),Cr=t.forwardRef((e,r)=>{const{__scopeSlider:n,index:l,name:c,...d}=e,u=mr(kr,n),m=fr(kr,n),[h,p]=t.useState(null),g=o(r,e=>p(e)),b=!h||(u.form||!!h.closest("form")),x=f(h),v=u.values[l],y=void 0===v?0:Nr(v,u.min,u.max),w=function(e,r){return r>2?`Value ${e+1} of ${r}`:2===r?["Minimum","Maximum"][e]:void 0}(l,u.values.length),j=null==x?void 0:x[m.size],k=j?function(e,r,t){const o=e/2,n=Er([0,50],[0,o]);return(o-n(r)*t)*t}(j,y,m.direction):0;return t.useEffect(()=>{if(h)return u.thumbs.add(h),()=>{u.thumbs.delete(h)}},[h,u.thumbs]),a.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[m.startEdge]:`calc(${y}% + ${k}px)`},children:[a.jsx(sr.ItemSlot,{scope:e.__scopeSlider,children:a.jsx(s.span,{role:"slider","aria-label":e["aria-label"]||w,"aria-valuemin":u.min,"aria-valuenow":v,"aria-valuemax":u.max,"aria-orientation":u.orientation,"data-orientation":u.orientation,"data-disabled":u.disabled?"":void 0,tabIndex:u.disabled?void 0:0,...d,ref:g,style:void 0===v?{display:"none"}:e.style,onFocus:i(e.onFocus,()=>{u.valueIndexToChangeRef.current=l})})}),b&&a.jsx(_r,{name:c??(u.name?u.name+(u.values.length>1?"[]":""):void 0),form:u.form,value:v},l)]})});Sr.displayName=kr;var _r=e=>{const{value:r,...o}=e,n=t.useRef(null),s=g(r);return t.useEffect(()=>{const e=n.current,t=window.HTMLInputElement.prototype,o=Object.getOwnPropertyDescriptor(t,"value").set;if(s!==r&&o){const t=new Event("input",{bubbles:!0});o.call(e,r),e.dispatchEvent(t)}},[s,r]),a.jsx("input",{style:{display:"none"},...o,ref:n,defaultValue:r})};function Nr(e,r,t){return u(100/(t-r)*(e-r),[0,100])}function Er(e,r){return t=>{if(e[0]===e[1]||r[0]===r[1])return r[0];const o=(r[1]-r[0])/(e[1]-e[0]);return r[0]+o*(t-e[0])}}var Pr=hr,Tr=yr,Rr=jr,Ar=Sr;t.forwardRef(({className:e,...r},t)=>a.jsxs(Pr,{ref:t,className:m("relative flex w-full touch-none select-none items-center",e),...r,children:[a.jsx(Tr,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:a.jsx(Rr,{className:"absolute h-full bg-primary"})}),a.jsx(Ar,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})).displayName=Pr.displayName;const Mr=({active:e=!1,processing:r=!1,deviceId:o,barWidth:n=3,barGap:s=1,barRadius:l=1.5,barColor:i,fadeEdges:c=!0,fadeWidth:d=24,height:u=64,sensitivity:h=1,smoothingTimeConstant:p=.8,fftSize:f=256,historySize:g=60,updateRate:b=30,mode:x="static",onError:v,onStreamReady:y,onStreamEnd:w,className:j,...k})=>{const S=t.useRef(null),C=t.useRef(null),_=t.useRef([]),N=t.useRef(null),E=t.useRef(null),P=t.useRef(null),T=t.useRef(0),R=t.useRef(0),A=t.useRef(null),M=t.useRef([]),L=t.useRef(0),$=t.useRef([]),D=t.useRef(!0),I=t.useRef(null),z=t.useRef(0),q="number"==typeof u?`${u}px`:u;return t.useEffect(()=>{const e=S.current,r=C.current;if(!e||!r)return;const t=new ResizeObserver(()=>{const t=r.getBoundingClientRect(),o=window.devicePixelRatio||1;e.width=t.width*o,e.height=t.height*o,e.style.width=`${t.width}px`,e.style.height=`${t.height}px`;const n=e.getContext("2d");n&&n.scale(o,o),I.current=null,z.current=t.width,D.current=!0});return t.observe(r),()=>t.disconnect()},[]),t.useEffect(()=>{if(r&&!e){let e=0;L.current=0;const r=()=>{var t;e+=.03,L.current=Math.min(1,L.current+.02);const o=[],a=Math.floor(((null==(t=C.current)?void 0:t.getBoundingClientRect().width)||200)/(n+s));if("static"===x){const r=Math.floor(a/2);for(let t=0;t<a;t++){const n=(t-r)/r,a=1-.4*Math.abs(n),s=(.2+(.25*Math.sin(1.5*e+3*n)+.2*Math.sin(.8*e-2*n)+.15*Math.cos(2*e+n)))*a;let l=s;if(M.current.length>0&&L.current<1){const e=Math.min(t,M.current.length-1);l=(M.current[e]||0)*(1-L.current)+s*L.current}o.push(Math.max(.05,Math.min(1,l)))}}else for(let r=0;r<a;r++){const t=(r-a/2)/(a/2),n=1-.4*Math.abs(t),s=(.2+(.25*Math.sin(1.5*e+.15*r)+.2*Math.sin(.8*e-.1*r)+.15*Math.cos(2*e+.05*r)))*n;let l=s;if(M.current.length>0&&L.current<1){const e=Math.floor(r/a*M.current.length);l=(M.current[e]||0)*(1-L.current)+s*L.current}o.push(Math.max(.05,Math.min(1,l)))}"static"===x?$.current=o:_.current=o,D.current=!0,A.current=requestAnimationFrame(r)};return r(),()=>{A.current&&cancelAnimationFrame(A.current)}}if(!e&&!r){if("static"===x?$.current.length>0:_.current.length>0){let e=0;const r=()=>{e+=.03,e<1?("static"===x?$.current=$.current.map(r=>r*(1-e)):_.current=_.current.map(r=>r*(1-e)),D.current=!0,requestAnimationFrame(r)):"static"===x?$.current=[]:_.current=[]};r()}}},[r,e,n,s,x]),t.useEffect(()=>{if(!e)return P.current&&(P.current.getTracks().forEach(e=>e.stop()),P.current=null,null==w||w()),E.current&&"closed"!==E.current.state&&(E.current.close(),E.current=null),void(T.current&&(cancelAnimationFrame(T.current),T.current=0));return(async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:o?{deviceId:{exact:o},echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});P.current=e,null==y||y(e);const r=new(window.AudioContext||window.webkitAudioContext),t=r.createAnalyser();t.fftSize=f,t.smoothingTimeConstant=p;r.createMediaStreamSource(e).connect(t),E.current=r,N.current=t,_.current=[]}catch(e){null==v||v(e)}})(),()=>{P.current&&(P.current.getTracks().forEach(e=>e.stop()),P.current=null,null==w||w()),E.current&&"closed"!==E.current.state&&(E.current.close(),E.current=null),T.current&&(cancelAnimationFrame(T.current),T.current=0)}},[e,o,f,p,v,y,w]),t.useEffect(()=>{const t=S.current;if(!t)return;const o=t.getContext("2d");if(!o)return;let a;const u=m=>{const p=t.getBoundingClientRect();if(e&&m-R.current>b&&(R.current=m,N.current)){const e=new Uint8Array(N.current.frequencyBinCount);if(N.current.getByteFrequencyData(e),"static"===x){const r=Math.floor(.05*e.length),t=Math.floor(.4*e.length),o=e.slice(r,t),a=Math.floor(p.width/(n+s)),l=Math.floor(a/2),i=[];for(let e=l-1;e>=0;e--){const r=Math.floor(e/l*o.length),t=Math.min(1,o[r]/255*h);i.push(Math.max(.05,t))}for(let e=0;e<l;e++){const r=Math.floor(e/l*o.length),t=Math.min(1,o[r]/255*h);i.push(Math.max(.05,t))}$.current=i,M.current=i}else{let r=0;const t=Math.floor(.05*e.length),o=Math.floor(.4*e.length),n=e.slice(t,o);for(let e=0;e<n.length;e++)r+=n[e];const a=r/n.length/255*h;_.current.push(Math.min(1,Math.max(.05,a))),M.current=[..._.current],_.current.length>g&&_.current.shift()}D.current=!0}if(!D.current&&!e)return void(a=requestAnimationFrame(u));D.current=e,o.clearRect(0,0,p.width,p.height);const f=i||getComputedStyle(t).color||"#000",v=n+s,y=Math.floor(p.width/v),w=p.height/2;if("static"===x){const t=r||e||$.current.length>0?$.current:[];for(let e=0;e<y&&e<t.length;e++){const r=t[e]||.1,a=e*v,s=Math.max(4,r*p.height*.8),i=w-s/2;o.fillStyle=f,o.globalAlpha=.4+.6*r,l>0?(o.beginPath(),o.roundRect(a,i,n,s,l),o.fill()):o.fillRect(a,i,n,s)}}else for(let e=0;e<y&&e<_.current.length;e++){const r=_.current.length-1-e,t=_.current[r]||.1,a=p.width-(e+1)*v,s=Math.max(4,t*p.height*.8),i=w-s/2;o.fillStyle=f,o.globalAlpha=.4+.6*t,l>0?(o.beginPath(),o.roundRect(a,i,n,s,l),o.fill()):o.fillRect(a,i,n,s)}if(c&&d>0&&p.width>0){if(!I.current||z.current!==p.width){const e=o.createLinearGradient(0,0,p.width,0),r=Math.min(.3,d/p.width);e.addColorStop(0,"rgba(255,255,255,1)"),e.addColorStop(r,"rgba(255,255,255,0)"),e.addColorStop(1-r,"rgba(255,255,255,0)"),e.addColorStop(1,"rgba(255,255,255,1)"),I.current=e,z.current=p.width}o.globalCompositeOperation="destination-out",o.fillStyle=I.current,o.fillRect(0,0,p.width,p.height),o.globalCompositeOperation="source-over"}o.globalAlpha=1,a=requestAnimationFrame(u)};return a=requestAnimationFrame(u),()=>{a&&cancelAnimationFrame(a)}},[e,r,h,b,g,n,s,l,i,c,d,x]),a.jsxs("div",{className:m("relative h-full w-full",j),ref:C,style:{height:q},"aria-label":e?"Live audio waveform":r?"Processing audio":"Audio waveform idle",role:"img",...k,children:[!e&&!r&&a.jsx("div",{className:"border-muted-foreground/20 absolute top-1/2 right-0 left-0 -translate-y-1/2 border-t-2 border-dotted"}),a.jsx("canvas",{className:"block h-full w-full",ref:S,"aria-hidden":"true"})]})},Lr=()=>{var e;const r=b(),o=r.testId||r.testName,n=x(),{profile:s}=v(),{toast:l}=y(),i=w(),[c,d]=t.useState(null),[u,m]=t.useState([]),[h,p]=t.useState(1),[f,g]=t.useState(0),[be,xe]=t.useState(!0),[ve,ye]=t.useState(!1),[we,je]=t.useState(!1),[ke,Se]=t.useState(!1),[Ce,_e]=t.useState(null),[Ne,Ee]=t.useState(null),[Pe,Te]=t.useState(0),[Re,Ae]=t.useState(60),[Me,Le]=t.useState({}),[$e,De]=t.useState("");t.useState(!1),t.useState("");const[Ie,ze]=t.useState(!1),[qe,Be]=t.useState("en");t.useEffect(()=>{(async()=>{if(null==s?void 0:s.id)try{const{data:e}=await oe.from("user_preferences").select("preferred_feedback_language, native_language").eq("user_id",s.id).maybeSingle(),r=e,t=(null==r?void 0:r.preferred_feedback_language)||(null==r?void 0:r.native_language);t&&ae.find(e=>e.value===t)&&Be(t)}catch(e){console.warn("Error loading user preferred language:",e)}})()},[null==s?void 0:s.id]);const[Fe,Ue]=t.useState(!1),[He,We]=t.useState(!1),[Oe,Ve]=t.useState(!1),[Ye,Xe]=t.useState(!1),[Ke,Ge]=t.useState(!1),[Qe,Je]=t.useState([{id:"1",type:"bot",content:"Hello! I'm Catie, your expert IELTS Speaking tutor. I'm here to guide you through strategic speaking techniques, structure, and vocabulary enhancement. What specific aspect of your speaking would you like to work on?",timestamp:new Date}]),[Ze,er]=t.useState(""),[rr,tr]=t.useState(!1),[or,nr]=t.useState(!1),[ar,sr]=t.useState(null),lr=t.useRef(null),ir=t.useRef(null),cr=t.useRef(null),dr=t.useRef([]),ur=t.useRef(null),mr=t.useRef(null),hr=(()=>{try{const e="undefined"!=typeof window?window.localStorage.getItem("appAudioVolume"):null,r=(e?parseInt(e,10):100)/100;return Number.isFinite(r)?Math.min(1,Math.max(0,r)):1}catch{return 1}})(),pr=t.useRef(hr);t.useEffect(()=>(o?(fr(),Je([{id:"1",type:"bot",content:"Hello! I'm Catie, your expert IELTS Speaking tutor. I'm here to guide you through strategic speaking techniques, structure, and vocabulary enhancement. What specific aspect of your speaking would you like to work on?",timestamp:new Date}])):gr(),()=>{cr.current&&clearInterval(cr.current)}),[o]),t.useEffect(()=>(Pe>0?cr.current=setTimeout(()=>Te(Pe-1),1e3):0===Pe&&ve&&xr(),()=>{cr.current&&clearTimeout(cr.current)}),[Pe,ve]),t.useEffect(()=>{const e=e=>{var r;const t=null==(r=null==e?void 0:e.detail)?void 0:r.volume;"number"==typeof t&&(pr.current=t,ir.current&&(ir.current.volume=t))};return window.addEventListener("app:volume-change",e),()=>window.removeEventListener("app:volume-change",e)},[]),t.useEffect(()=>{Qe.length>0&&setTimeout(()=>{const e=document.querySelector("[data-conversation-content]");e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},100)},[Qe]),t.useEffect(()=>{Ve(!1)},[f,h]),t.useEffect(()=>{if(ur.current){const e=ur.current;e.style.setProperty("transform","scale(1)","important"),e.style.setProperty("transition","none","important");const r=r=>{e.style.setProperty("transform","scale(1)","important"),e.style.setProperty("box-shadow","0 8px 32px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.1)","important"),e.style.setProperty("transition","none","important")};return e.addEventListener("mouseenter",r),e.addEventListener("mouseleave",r),()=>{e.removeEventListener("mouseenter",r),e.removeEventListener("mouseleave",r)}}},[c,h,f]);const fr=async()=>{if(o){xe(!0);try{console.log(`üîç Loading speaking test data for test ID: ${o}`);const e=o.includes("-")&&36===o.length,[r,t]=await Promise.all([e?oe.from("tests").select("id, test_name").eq("id",o).single():oe.from("tests").select("id, test_name").eq("test_name",o).eq("test_type","IELTS").eq("module","Speaking").maybeSingle(),oe.from("speaking_prompts").select("*").eq("test_id",o).order("part_number",{ascending:!0})]);if(r.error)throw r.error;const a=r.data;if(!a)return l({title:"Test Not Found",description:"This speaking test doesn't exist. Please check the test ID.",variant:"destructive"}),void n(-1);console.log("‚úÖ Test loaded:",a.test_name);let s=t.data||[];if(0===s.length&&a.id!==o){const{data:e}=await oe.from("speaking_prompts").select("*").eq("test_id",a.id).order("part_number",{ascending:!0});s=e||[]}console.log(`üìù Loaded ${s.length} total speaking prompts`);const i=[];let c=null;const u=[];s.forEach(e=>{1===e.part_number?i.push(e):2===e.part_number?c=e:3===e.part_number&&u.push(e)}),d({id:a.id,test_name:a.test_name,part1_prompts:i,part2_prompt:c,part3_prompts:u}),console.log(`‚úÖ Test ready: Part 1 (${i.length}), Part 2 (${c?1:0}), Part 3 (${u.length})`)}catch(e){console.error("‚ùå Error:",e),o&&d({id:o,test_name:"Speaking Test",part1_prompts:[],part2_prompt:null,part3_prompts:[]})}finally{xe(!1)}}},gr=async()=>{xe(!0);try{console.log("üìã Loading available speaking tests...");const{data:e,error:r}=await oe.from("tests").select("id, test_name, module, skill_category, created_at, speaking_prompts!inner(id)").eq("test_type","IELTS").order("created_at",{ascending:!1}).limit(50);if(r)throw console.error("‚ùå Error loading tests:",r),r;const t=(e||[]).filter(e=>{const r=(e.test_name||"").trim();return r&&r.length>=2&&!r.toLowerCase().includes("quick test")&&!["test ?","another test?",""].includes(r.toLowerCase())});console.log(`‚úÖ Found ${t.length} valid speaking tests`),m(t)}catch(e){console.error("‚ùå Error loading tests:",e),l({title:"Error",description:"Failed to load available speaking tests",variant:"destructive"}),m([])}finally{xe(!1)}},br=()=>{try{const e=new(window.AudioContext||window.webkitAudioContext),r=e.createOscillator(),t=e.createOscillator(),o=e.createGain();r.type="sine",r.frequency.value=523,t.type="sine",t.frequency.value=659,r.connect(o),t.connect(o),o.connect(e.destination),o.gain.setValueAtTime(1e-4,e.currentTime),o.gain.exponentialRampToValueAtTime(.05,e.currentTime+.01),r.start(),t.start(),setTimeout(()=>{o.gain.exponentialRampToValueAtTime(1e-5,e.currentTime+.15),setTimeout(()=>{r.stop(),t.stop(),e.close()},200)},120)}catch{}},xr=()=>{if(2===h&&mr.current){const e=Math.floor((Date.now()-mr.current)/1e3),r=60;if(e<r){const t=r-e;return void l({title:"Minimum Recording Time Required",description:`For IELTS Part 2, you should speak for at least 1 minute to receive a good score. Please continue recording for ${t} more second${1!==t?"s":""}.`,variant:"destructive",duration:5e3})}}br(),lr.current&&ve&&(lr.current.stop(),Te(0),mr.current=null)},vr=()=>{if(Ne)try{Ne.pause(),Ne.currentTime=0,console.log("üõë Stopped recording playback")}catch(e){console.error("Error stopping recording playback:",e)}Se(!1),_e(null),Ee(null)},yr=()=>{if(1===h)if(f<((null==c?void 0:c.part1_prompts.length)||0)-1)g(f+1),console.log(`‚û°Ô∏è Moving to Part 1, Question ${f+2}`);else{const e=!!(null==c?void 0:c.part2_prompt),r=!!((null==c?void 0:c.part3_prompts)&&c.part3_prompts.length>0);e||r?e?(p(2),g(0),Ae(60),console.log("‚û°Ô∏è Moving to Part 2 - Long Turn"),wr()):r&&(p(3),g(0),console.log("‚û°Ô∏è Moving to Part 3 - Discussion (no Part 2 for this test)")):(console.log("üèÅ Part 1-only test completed - prompting for feedback language (AI analysis after Part 1)."),ze(!0))}else 2===h?(null==c?void 0:c.part3_prompts)&&c.part3_prompts.length>0?(p(3),g(0),console.log("‚û°Ô∏è Moving to Part 3 - Discussion")):(console.log("üèÅ Part 2 completed - no Part 3 available, prompting for feedback language"),ze(!0)):3===h&&(f<((null==c?void 0:c.part3_prompts.length)||0)-1?(g(f+1),console.log(`‚û°Ô∏è Moving to Part 3, Question ${f+2}`)):(console.log("üèÅ Last question completed - prompting for feedback language"),ze(!0)))},wr=()=>{const e=setInterval(()=>{Ae(r=>r<=1?(clearInterval(e),l({title:"Preparation Time Complete",description:"You may now start recording your response.",duration:5e3}),0):r-1)},1e3)},jr=e=>`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`;if(be)return a.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:"dark"===i.theme.name?i.theme.colors.background:"transparent"},children:a.jsx(j,{size:"lg",message:"Loading speaking tests..."})});if(!o)return a.jsxs("div",{className:"min-h-screen relative",style:{backgroundColor:"dark"===i.theme.name?i.theme.colors.background:"transparent"},children:[a.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"note"===i.theme.name||"minimalist"===i.theme.name||"dark"===i.theme.name?"none":"url('https://raw.githubusercontent.com/AlfieAlfiegithu2/alfie-ai-coach/main/public/1000031207.png')",backgroundColor:i.backgroundImageColor}}),a.jsx("div",{className:"relative z-10",children:a.jsx(k,{title:"Available Speaking Tests",children:a.jsx("div",{className:"min-h-screen py-12",children:a.jsx("div",{className:"container mx-auto px-4",children:a.jsxs("div",{className:"max-w-4xl mx-auto",children:[a.jsx("div",{className:"mb-8 text-center",children:a.jsx("h1",{className:"text-4xl font-bold mb-2",style:{color:i.textPrimary},children:"IELTS speaking tests"})}),u.length>0?a.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:u.map(e=>a.jsx(S,{className:"cursor-pointer h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg flex items-center justify-center",onClick:()=>n(`/ielts-speaking-test/${e.id}`),style:{backgroundColor:"glassmorphism"===i.theme.name?"rgba(255,255,255,0.8)":"dark"===i.theme.name?"rgba(255,255,255,0.1)":"minimalist"===i.theme.name?"#ffffff":i.theme.colors.cardBackground,borderColor:i.border,...i.cardStyle},children:a.jsx(C,{className:"p-3 md:p-4 text-center flex items-center justify-center h-full",children:a.jsx("h3",{className:"font-semibold text-sm",style:{color:i.textPrimary},children:e.test_name})})},e.id))}):a.jsxs("div",{className:"text-center py-12",children:[a.jsx("p",{className:"text-lg mb-4",style:{color:i.textSecondary},children:"No speaking tests available yet"}),a.jsx(_,{onClick:()=>n("/ielts-portal"),variant:"outline",style:{borderColor:i.border,color:i.textPrimary,backgroundColor:"glassmorphism"===i.theme.name||"dark"===i.theme.name?"rgba(255,255,255,0.1)":"minimalist"===i.theme.name?"#ffffff":i.theme.colors.cardBackground},onMouseEnter:e=>e.currentTarget.style.backgroundColor=i.hoverBg,onMouseLeave:e=>e.currentTarget.style.backgroundColor="glassmorphism"===i.theme.name||"dark"===i.theme.name?"rgba(255,255,255,0.1)":"minimalist"===i.theme.name?"#ffffff":i.theme.colors.cardBackground,children:"Back to Portal"})]})]})})})})})]});if(!c)return a.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-lg text-muted-foreground",children:"Test not found"}),a.jsx(_,{onClick:()=>n("/ielts-portal"),className:"mt-4",children:"Back to Portal"})]})});if(0===c.part1_prompts.length&&!c.part2_prompt&&0===c.part3_prompts.length)return a.jsx(k,{title:`IELTS Speaking - ${c.test_name}`,showBackButton:!0,children:a.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[a.jsxs("div",{className:"text-center",children:[a.jsx(N,{variant:"outline",className:"mb-4 px-4 py-1 text-primary border-primary/20",children:"IELTS SPEAKING TEST"}),a.jsx("h1",{className:"text-heading-2 mb-2",children:c.test_name})]}),a.jsx(E,{className:"card-modern",children:a.jsxs(C,{className:"p-8 text-center",children:[a.jsx(P,{className:"w-16 h-16 mx-auto mb-4 text-gray-400 dark:text-gray-500"}),a.jsx("h2",{className:"text-xl font-semibold mb-2",children:"No Speaking Content Available"}),a.jsx("p",{className:"text-muted-foreground mb-6",children:"This test doesn't have speaking content created yet. Please contact your administrator or try another test."}),a.jsxs("div",{className:"flex gap-4 justify-center",children:[a.jsx(_,{onClick:()=>n("/ielts-portal"),variant:"outline",children:"Back to Portal"}),a.jsx(_,{onClick:()=>n("/speaking"),children:"Try General Speaking Practice"})]})]})})]})});const kr=()=>1===h?c.part1_prompts[f]:2===h?c.part2_prompt:3===h?c.part3_prompts[f]:null,Sr=()=>{const e=kr();return e?2===h?e.prompt_text||"":e.transcription||e.title||"":""},Cr=async e=>{const r=e||Ze.trim();if(!r||rr)return;const t={id:Date.now().toString(),type:"user",content:r,timestamp:new Date};Je(e=>[...e,t]),e||er(""),tr(!0);try{const e=Sr(),t=`CONTEXT: The student is practicing IELTS Speaking Part ${h}.\n\nQuestion: "${e}"\n\nPlease provide concise, practical speaking guidance (ideas, vocabulary, structure). Do NOT write a full answer.`,o=Qe.filter(e=>"user"===e.type||"bot"===e.type).map(e=>({role:"user"===e.type?"user":"assistant",content:e.content}));o.push({role:"user",content:r});const{data:n,error:a}=await oe.functions.invoke("openai-chat",{body:{skipCache:!0,messages:[{role:"system",content:t},...o],context:"catbot"}});if(a)throw a;const s={id:(Date.now()+1).toString(),type:"bot",content:n.response,timestamp:new Date};Je(e=>[...e,s])}catch(o){console.error("Error sending chat message:",o),l({title:"Error",description:"Failed to get response from Catie",variant:"destructive"})}finally{tr(!1)}},_r=e=>{Cr(e)},Nr=kr(),Er=Sr(),Pr=1===h?"Part 1":2===h?"Part 2":3===h?"Part 3":"Unknown Part";return a.jsxs("div",{className:"min-h-screen relative",style:{backgroundColor:"dark"===i.theme.name?i.theme.colors.background:"transparent"},children:[a.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"note"===i.theme.name||"minimalist"===i.theme.name||"dark"===i.theme.name?"none":"url('https://raw.githubusercontent.com/AlfieAlfiegithu2/alfie-ai-coach/main/public/1000031207.png')",backgroundColor:i.backgroundImageColor}}),a.jsx("div",{className:"relative z-10 min-h-screen flex flex-col",style:{backgroundColor:"dark"===i.theme.name?i.theme.colors.background:"transparent"},children:a.jsx(k,{title:`IELTS Speaking - ${c.test_name}`,showBackButton:!0,children:a.jsx("div",{className:"flex-1 flex justify-center min-h-[calc(100vh-120px)] py-8 sm:items-center sm:py-8",children:a.jsxs("div",{className:"w-full max-w-4xl mx-auto space-y-4 px-4 flex flex-col",children:[a.jsx("div",{className:"text-center py-2 sm:py-2 sm:mb-0 mb-0",children:a.jsxs("span",{className:"text-lg font-semibold",style:{color:i.textPrimary},children:["Part ",h]})}),a.jsxs(E,{ref:ur,className:"backdrop-blur-sm shadow-lg rounded-2xl flex flex-col relative",style:{backgroundColor:"glassmorphism"===i.theme.name?"rgba(255,255,255,0.9)":"dark"===i.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===i.theme.name?"#ffffff":i.theme.colors.cardBackground,borderColor:i.border,backdropFilter:"glassmorphism"===i.theme.name?"blur(12px)":"dark"===i.theme.name?"blur(8px)":"none",boxShadow:"dark"===i.theme.name?"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)":"note"===i.theme.name?null==(e=i.theme.styles.cardStyle)?void 0:e.boxShadow:"0 8px 32px rgba(15, 23, 42, 0.16), 0 0 0 1px rgba(148, 163, 253, 0.06)",...i.cardStyle},children:[a.jsx(T,{children:a.jsxs(R,{className:"flex items-center justify-between",children:[a.jsx("span",{}),a.jsxs("div",{className:"flex items-center gap-3",children:[(1===h||3===h)&&a.jsx(A,{children:a.jsxs(M,{children:[a.jsx(L,{asChild:!0,children:a.jsx("div",{onClick:()=>Ve(!Oe),className:"relative inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background",style:{backgroundColor:Oe?i.buttonPrimary:"glassmorphism"===i.theme.name?"rgba(255,255,255,0.2)":"dark"===i.theme.name?"rgba(255,255,255,0.1)":"minimalist"===i.theme.name?"#e5e7eb":i.border},"data-state":Oe?"checked":"unchecked",children:a.jsx("div",{className:"pointer-events-none flex h-5 w-5 rounded-full shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0 items-center justify-center",style:{backgroundColor:"glassmorphism"===i.theme.name?"rgba(255,255,255,0.95)":"dark"===i.theme.name?"rgba(255,255,255,0.9)":"minimalist"===i.theme.name?"#ffffff":i.theme.colors.cardBackground},"data-state":Oe?"checked":"unchecked",children:Oe?a.jsx($,{className:"w-3 h-3",style:{color:"white"}}):a.jsx(D,{className:"w-3 h-3",style:{color:i.textSecondary}})})})}),a.jsx(I,{children:a.jsx("p",{children:Oe?"Hide question":"Show question"})})]})}),Pe>0&&a.jsxs(N,{variant:"outline",className:"flex items-center gap-2",style:{borderColor:i.border,backgroundColor:"glassmorphism"===i.theme.name?"rgba(255,255,255,0.1)":"dark"===i.theme.name?"rgba(255,255,255,0.05)":"minimalist"===i.theme.name?"#ffffff":i.theme.colors.cardBackground,color:i.textPrimary},children:[a.jsx(z,{className:"w-4 h-4",style:{color:i.textPrimary}}),jr(Pe)]})]})]})}),a.jsxs(C,{className:"space-y-4 flex flex-col relative",children:[2===h&&Re>0&&a.jsx("div",{className:"text-center",children:a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsx(z,{className:"w-5 h-5",style:{color:i.buttonPrimary}}),a.jsx("p",{className:"text-xl font-bold",style:{color:i.buttonPrimary},children:jr(Re)})]})}),1===h&&c.part1_prompts.length>0&&a.jsx("div",{className:"space-y-6 relative flex flex-col min-h-[200px]",children:a.jsx("div",{className:"min-h-[200px] flex items-center justify-center flex-1",children:Oe&&a.jsx("div",{className:"text-lg font-medium text-center select-none",style:{color:i.textPrimary},children:Sr()})})}),3===h&&c.part3_prompts.length>0&&a.jsx("div",{className:"space-y-6 relative flex flex-col min-h-[200px]",children:a.jsx("div",{className:"min-h-[200px] flex items-center justify-center flex-1",children:Oe&&a.jsx("div",{className:"text-lg font-medium text-center select-none",style:{color:i.textPrimary},children:Sr()})})}),2===h&&Nr&&a.jsxs("div",{className:"p-6 rounded-lg",style:{backgroundColor:"glassmorphism"===i.theme.name?"rgba(255,255,255,0.1)":"dark"===i.theme.name?"rgba(255,255,255,0.05)":"minimalist"===i.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:i.border,borderWidth:"1px",borderStyle:"solid"},children:[a.jsx("h3",{className:"font-semibold mb-3",style:{color:i.textPrimary},children:"Cue Card"}),a.jsx("div",{className:"whitespace-pre-wrap text-sm leading-relaxed",style:{color:i.textSecondary},children:Nr.prompt_text})]}),2===h&&a.jsxs(a.Fragment,{children:[Re>0&&a.jsxs("div",{className:"relative rounded-lg p-4",style:{backgroundColor:"glassmorphism"===i.theme.name?"rgba(255,255,255,0.1)":"dark"===i.theme.name?"rgba(255,255,255,0.05)":"minimalist"===i.theme.name?"#fef3c7":"#FEF9E7",borderColor:i.border,borderWidth:"1px",borderStyle:"solid"},children:[a.jsx(A,{children:a.jsxs(M,{children:[a.jsx(L,{asChild:!0,children:a.jsx(_,{variant:"ghost",size:"icon",onClick:()=>{Ae(e=>e+60)},className:"absolute top-2 right-2 h-8 w-8",style:{color:i.buttonPrimary},children:a.jsx(q,{className:"w-4 h-4"})})}),a.jsx(I,{children:a.jsx("p",{children:"Add 1 minute for notes"})})]})}),a.jsx("textarea",{placeholder:"Write your preparation notes here...",value:$e,onChange:e=>De(e.target.value),className:"w-full h-32 p-3 bg-transparent resize-none focus:outline-none",style:{color:i.textPrimary}}),a.jsx("style",{dangerouslySetInnerHTML:{__html:`\n                      textarea[placeholder="Write your preparation notes here..."]::placeholder {\n                        color: ${i.textSecondary};\n                      }\n                    `}})]}),0===Re&&$e&&a.jsxs("div",{className:"relative rounded-lg p-4",style:{backgroundColor:"glassmorphism"===i.theme.name?"rgba(255,255,255,0.1)":"dark"===i.theme.name?"rgba(255,255,255,0.05)":"minimalist"===i.theme.name?"#fef3c7":"#FEF9E7",borderColor:i.border,borderWidth:"1px",borderStyle:"solid"},children:[!ve&&a.jsx(A,{children:a.jsxs(M,{children:[a.jsx(L,{asChild:!0,children:a.jsx(_,{variant:"ghost",size:"icon",onClick:()=>{Ae(60),wr()},className:"absolute top-2 right-2 h-8 w-8 text-primary",children:a.jsx(q,{className:"w-4 h-4"})})}),a.jsx(I,{children:a.jsx("p",{children:"Add 1 minute for notes"})})]})}),a.jsx("div",{className:"p-3 text-sm whitespace-pre-wrap",children:$e})]})]}),(2===h&&0===Re||2!==h)&&a.jsx("div",{className:"text-center min-h-[80px] flex items-center justify-center relative",children:ve?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"absolute -top-5 left-1/2 -translate-x-1/2 w-[130px] sm:w-[180px]",children:a.jsx(Mr,{active:!0,height:55,barWidth:6,barGap:2,barRadius:3,mode:"static",fadeEdges:!1,barColor:"#2563eb",sensitivity:1.2,fftSize:256,historySize:60,updateRate:30})}),a.jsx(_,{onClick:xr,variant:"outline",size:"icon",className:"rounded-xl h-8 w-8 absolute bottom-0 left-1/2 transform -translate-x-1/2",style:{borderColor:i.border,color:i.buttonPrimary,backgroundColor:"glassmorphism"===i.theme.name?"rgba(255,255,255,0.9)":"dark"===i.theme.name?"rgba(255,255,255,0.15)":"minimalist"===i.theme.name?"#ffffff":i.theme.colors.cardBackground||"#ffffff"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=i.hoverBg||"rgba(0,0,0,0.05)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===i.theme.name?"rgba(255,255,255,0.9)":"dark"===i.theme.name?"rgba(255,255,255,0.15)":"minimalist"===i.theme.name?"#ffffff":i.theme.colors.cardBackground||"#ffffff"},children:a.jsx(B,{className:"w-4 h-4",style:{color:i.buttonPrimary||"#2563eb"}})})]}):a.jsx(A,{children:a.jsxs("div",{className:"flex items-center justify-center gap-3",children:[a.jsxs(M,{children:[a.jsx(L,{asChild:!0,children:a.jsx(_,{onClick:async()=>{try{br(),await new Promise(e=>setTimeout(e,100));const e=await navigator.mediaDevices.getUserMedia({audio:!0});lr.current=new MediaRecorder(e),dr.current=[],lr.current.ondataavailable=e=>{e.data.size>0&&dr.current.push(e.data)},lr.current.onstop=()=>{const r=new Blob(dr.current,{type:"audio/webm"}),t=`part${h}_q${f}`;console.log(`üíæ Saving recording for ${t}, blob size: ${r.size}`),Le(e=>{const o={...e,[t]:r};return console.log("üì± Recordings updated:",Object.keys(o)),o}),ye(!1),e.getTracks().forEach(e=>e.stop())},lr.current.start(),ye(!0),mr.current=Date.now(),(1===h||3===h||2===h)&&Te(120)}catch(e){console.error("Error starting recording:",e),l({title:"Recording Error",description:"Failed to start recording. Please check microphone permissions.",variant:"destructive"})}},variant:"outline",className:"rounded-xl shadow-sm h-12 w-12",size:"icon",style:{backgroundColor:"glassmorphism"===i.theme.name?"rgba(255,255,255,0.8)":"dark"===i.theme.name?"rgba(255,255,255,0.1)":"minimalist"===i.theme.name?"#ffffff":i.theme.colors.cardBackground,borderColor:i.border,color:i.textPrimary},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=i.hoverBg,e.currentTarget.style.color=i.buttonPrimary},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===i.theme.name?"rgba(255,255,255,0.8)":"dark"===i.theme.name?"rgba(255,255,255,0.1)":"minimalist"===i.theme.name?"#ffffff":i.theme.colors.cardBackground,e.currentTarget.style.color=i.textPrimary},children:a.jsx(P,{className:"w-5 h-5"})})}),a.jsx(I,{children:a.jsx("p",{children:"Start recording your answer"})})]}),(null==Nr?void 0:Nr.audio_url)&&a.jsxs(M,{children:[a.jsx(L,{asChild:!0,children:a.jsx(_,{onClick:()=>{const e=kr();(null==e?void 0:e.audio_url)&&(console.log(`üîÅ Repeating audio for Part ${h}`),(async e=>{var r;if(e){Ye||(Xe(!0),Ge(!1));try{je(!0),ir.current&&(ir.current.pause(),ir.current.currentTime=0,ir.current=null);const r=new Audio(e);r.preload="auto",r.volume=pr.current,r.onended=()=>{je(!1),console.log("‚úÖ Audio playback completed"),ir.current=null},r.onerror=e=>{je(!1),console.error("Audio playback error:",e),ir.current=null,l({title:"Audio Error",description:"Failed to play audio prompt. The audio may be inaudible or unavailable.",variant:"destructive"})},r.onloadstart=()=>{console.log("Audio loading started")},r.oncanplay=()=>{console.log("Audio can play")},r.oncanplaythrough=()=>{console.log("Audio can play through")},ir.current=r,console.log(`‚ñ∂Ô∏è Playing audio: ${e}`),r.load(),await new Promise(e=>setTimeout(e,100));const t=r.play();void 0!==t&&(await t,console.log("Audio started playing successfully"))}catch(t){console.error("Error playing audio:",t),je(!1),"NotAllowedError"===t.name||(null==(r=t.message)?void 0:r.includes("user didn't interact"))?(Ye||Ge(!0),console.log("Autoplay blocked - user needs to interact first")):l({title:"Audio Error",description:"Failed to play audio prompt. The audio may be inaudible or unavailable. Please try again.",variant:"destructive"}),ir.current&&(ir.current=null)}}})(e.audio_url))},disabled:we,variant:"outline",size:"icon",className:"h-12 w-12 rounded-xl",style:{borderColor:i.border,color:i.buttonPrimary,backgroundColor:"transparent"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=i.hoverBg},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:we?a.jsx(F,{className:"w-5 h-5"}):a.jsx(U,{className:"w-5 h-5"})})}),a.jsx(I,{children:a.jsx("p",{children:we?"Pause question audio":"Play question audio"})})]}),Me[`part${h}_q${f}`]&&a.jsxs(M,{children:[a.jsx(L,{asChild:!0,children:a.jsx(_,{onClick:()=>{ke&&Ce===`part${h}_q${f}`?vr():(async e=>{const r=Me[e];if(r)try{Ne&&vr();const t=URL.createObjectURL(r),o=new Audio(t);o.volume=pr.current,Ee(o),o.onended=()=>{URL.revokeObjectURL(t),Se(!1),_e(null),Ee(null),console.log(`‚úÖ Recording playback ended: ${e}`)},o.onerror=()=>{URL.revokeObjectURL(t),Se(!1),_e(null),Ee(null),console.error(`‚ùå Recording playback error: ${e}`),l({title:"Playback Error",description:"Failed to play your recording. The audio may be inaudible or corrupted.",variant:"destructive"})},await o.play(),Se(!0),_e(e),console.log(`üéµ Started recording playback: ${e}`)}catch(t){console.error("Error playing recording:",t),Se(!1),_e(null),Ee(null),l({title:"Playback Error",description:"Failed to play your recording",variant:"destructive"})}})(`part${h}_q${f}`)},variant:"outline",size:"icon",className:"h-12 w-12 rounded-xl",style:{borderColor:i.border,color:i.buttonPrimary,backgroundColor:"transparent"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=i.hoverBg},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:ke&&Ce===`part${h}_q${f}`?a.jsx(F,{className:"w-5 h-5"}):a.jsx(H,{className:"w-5 h-5"})})}),a.jsx(I,{children:a.jsx("p",{children:ke&&Ce===`part${h}_q${f}`?"Stop listening to your recording":"Listen to your recorded answer"})})]}),(console.log("üîç DEBUG: Checking evaluate button condition",{currentPart:h,currentQuestion:f,key:`part${h}_q${f}`,hasRecording:!!Me[`part${h}_q${f}`],allRecordingKeys:Object.keys(Me),recordingValue:Me[`part${h}_q${f}`]}),null),Me[`part${h}_q${f}`]&&a.jsxs(a.Fragment,{children:[(console.log("‚úÖ Rendering Evaluate Button",{key:`part${h}_q${f}`,recording:Me[`part${h}_q${f}`]}),null),a.jsxs(M,{children:[a.jsx(L,{asChild:!0,children:a.jsxs(_,{onClick:async()=>{const e=`part${h}_q${f}`,r=Me[e];if(console.log("üéØ EVALUATE: Current part:",h),console.log("üéØ EVALUATE: Current question:",f),console.log("üéØ EVALUATE: Recording key:",e),console.log("üéØ EVALUATE: Recording exists:",!!r),console.log("üéØ EVALUATE: Recording size:",null==r?void 0:r.size),console.log("üéØ EVALUATE: All recording keys:",Object.keys(Me)),r){nr(!0),sr(null);try{const t=new FileReader;t.readAsDataURL(r),t.onloadend=async()=>{const r=t.result.split(",")[1],o=Sr();console.log("üì§ Sending to Edge Function:",{audioLength:r.length,prompt:o,recordingKey:e});const{data:n,error:a}=await oe.functions.invoke("ielts-speaking-evaluator",{body:{audio:r,prompt:o}});if(a)throw a;console.log("‚úÖ Evaluation received:",n),sr(n)}}catch(t){console.error("Evaluation error:",t),l({title:"Evaluation Failed",description:(null==t?void 0:t.message)||"Could not evaluate the recording. Please try again.",variant:"destructive"})}finally{nr(!1)}}else console.error("‚ùå No recording found for",e)},disabled:or,variant:"outline",className:"h-12 px-4 rounded-xl gap-2",style:{borderColor:i.border,color:i.buttonPrimary,backgroundColor:"transparent"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=i.hoverBg},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[or?a.jsx(pe,{className:"w-5 h-5 animate-spin"}):a.jsx(pe,{className:"w-5 h-5"}),a.jsx("span",{className:"font-medium",children:"Evaluate AI"})]})}),a.jsx(I,{children:a.jsx("p",{children:or?"Evaluating your answer...":"Get AI feedback on this answer"})})]})]})]})})}),ar&&a.jsxs("div",{className:"mt-8 p-6 rounded-2xl border-2 animate-in fade-in slide-in-from-top-4 duration-500 max-w-3xl mx-auto text-left shadow-lg",style:{borderColor:i.border,backgroundColor:i.theme.colors.cardBackground||"#ffffff",color:i.textPrimary},children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("div",{className:"relative",children:[a.jsx("img",{src:"/cat.png",alt:"Catie AI",className:"w-12 h-12 rounded-full shadow-md",style:{border:`2px solid ${i.buttonPrimary}`}}),a.jsx("div",{className:"absolute -bottom-1 -right-1 w-5 h-5 rounded-full flex items-center justify-center shadow-sm",style:{backgroundColor:i.buttonPrimary},children:a.jsx(pe,{className:"w-3 h-3 text-white"})})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-bold text-lg",style:{color:i.textPrimary},children:"Catie's Feedback"}),a.jsx("p",{className:"text-xs opacity-60",children:"AI Speaking Coach"})]})]}),a.jsx(_,{variant:"ghost",size:"sm",onClick:()=>sr(null),className:"h-8 w-8 p-0 opacity-60 hover:opacity-100",children:a.jsx(W,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"mb-6 p-4 rounded-xl border-2",style:{backgroundColor:"dark"===i.theme.name?"rgba(255,255,255,0.05)":"glassmorphism"===i.theme.name?"rgba(255,255,255,0.6)":"#f8fafc",borderColor:i.border},children:[a.jsxs("p",{className:"text-xs font-bold uppercase mb-2 flex items-center gap-2",style:{color:i.buttonPrimary},children:[a.jsx(H,{className:"w-3 h-3"}),"What I Heard"]}),a.jsxs("p",{className:"text-sm italic leading-relaxed",style:{color:i.textPrimary},children:['"',ar.transcription,'"']})]}),a.jsx("div",{className:"grid grid-cols-2 gap-4 mb-6",children:Object.entries(ar.metrics||{}).map(([e,r])=>a.jsxs("div",{className:"space-y-2 p-3 rounded-lg",style:{backgroundColor:"dark"===i.theme.name?"rgba(255,255,255,0.05)":"glassmorphism"===i.theme.name?"rgba(255,255,255,0.5)":"#f8fafc"},children:[a.jsxs("div",{className:"flex justify-between text-sm font-semibold",children:[a.jsx("span",{className:"capitalize",style:{color:i.textPrimary},children:e}),a.jsxs("span",{className:"font-bold",style:{color:i.buttonPrimary},children:[r,"%"]})]}),a.jsx(O,{value:r,className:"h-2",style:{backgroundColor:"dark"===i.theme.name?"rgba(255,255,255,0.1)":"#e2e8f0"}})]},e))}),a.jsx(te,{className:"my-6",style:{backgroundColor:i.border}}),a.jsxs("div",{className:"space-y-2 mb-6",children:[a.jsxs("h3",{className:"font-semibold text-base flex items-center gap-2",style:{color:i.textPrimary},children:[a.jsx(V,{className:"w-4 h-4",style:{color:i.buttonPrimary}}),"Feedback"]}),a.jsx("p",{className:"text-sm leading-relaxed",style:{color:i.textSecondary},children:ar.feedback})]}),a.jsxs("div",{className:"p-4 rounded-xl space-y-2 mb-6 border-2",style:{backgroundColor:"dark"===i.theme.name?"rgba(255,255,255,0.05)":"glassmorphism"===i.theme.name?"rgba(255,255,255,0.7)":"#f0f9ff",borderColor:`${i.buttonPrimary}40`},children:[a.jsxs("h3",{className:"font-semibold flex items-center gap-2 text-xs uppercase tracking-wide",style:{color:i.buttonPrimary},children:[a.jsx(pe,{className:"w-3 h-3"}),"Band 8-9 Enhanced Version"]}),a.jsxs("p",{className:"text-base italic font-medium",style:{color:i.textPrimary},children:['"',ar.enhancedSentence,'"']})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"font-semibold text-base",style:{color:i.textPrimary},children:"Detailed Analysis"}),a.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:Object.entries(ar.detailedAnalysis||{}).map(([e,r])=>a.jsxs("div",{className:"border-2 p-3 rounded-xl",style:{borderColor:i.border,backgroundColor:"dark"===i.theme.name?"rgba(255,255,255,0.03)":"glassmorphism"===i.theme.name?"rgba(255,255,255,0.4)":"#ffffff"},children:[a.jsx("span",{className:"text-xs font-bold uppercase mb-1 block",style:{color:i.buttonPrimary},children:e}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:i.textSecondary},children:r})]},e))})]})]}),Ie&&a.jsx("div",{className:"flex justify-center mt-4",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs(Y,{value:qe,onValueChange:Be,children:[a.jsx(X,{className:"w-[90px] h-8 text-sm border-0 bg-transparent shadow-none p-0 focus:ring-0",style:{color:i.textPrimary,"--tw-ring-color":i.buttonPrimary},children:a.jsx(K,{placeholder:"Language"})}),a.jsx(G,{children:ae.map(e=>a.jsx(Q,{value:e.value,children:e.label},e.value))})]}),a.jsx(_,{type:"button",onClick:()=>{try{localStorage.setItem("ielts_speaking_feedback_language",qe||"en")}catch(e){console.warn("Unable to persist feedback language preference",e)}(async()=>{var e,r,t,o,a,s;try{const d=Object.entries(Me);if(0===d.length)return void l({title:"No recordings found",description:"Please record answers before submitting.",variant:"destructive"});console.log("üìù Preparing speaking uploads:",{count:d.length,keys:d.map(([e])=>e)});const u=d.map(async([e,r],t)=>{var o,n,a,s,i,u,m,h,p,f,g,b,x,v,y,w;const j=(null==c?void 0:c.id)||"unknown",k=Date.now(),S=`speaking_${j}_${e}_${k}.webm`,C=new File([r],S,{type:"audio/webm"});try{console.log(`üì§ Uploading speaking recording [${t+1}/${d.length}]:`,{fileName:S,key:e,size:r.size});const l=await ne.uploadSpeaking(C,j,e);if(!l.success)throw console.error(`‚ùå R2 upload reported failure for ${S}:`,l.error),new Error(l.error||"Upload failed");l.url||console.warn(`‚ö†Ô∏è R2 upload returned success but no URL for ${S}. Falling back to deterministic URL.`);const p=l.url||`https://placeholder-r2/${j}/speaking/${encodeURIComponent(e)}/${k}.webm`;console.log(`‚úÖ Speaking recording uploaded successfully: ${p}`);let f="";const g=e.match(/^part(\d+)_q(\d+)$/);if(g){const e=parseInt(g[1],10),r=parseInt(g[2],10);1===e&&(null==(o=null==c?void 0:c.part1_prompts)?void 0:o[r])?f=(null==(n=c.part1_prompts[r])?void 0:n.prompt_text)||(null==(a=c.part1_prompts[r])?void 0:a.transcription)||(null==(s=c.part1_prompts[r])?void 0:s.title)||"":2===e&&(null==c?void 0:c.part2_prompt)?f=c.part2_prompt.prompt_text||c.part2_prompt.transcription||c.part2_prompt.title||"":3===e&&(null==(i=null==c?void 0:c.part3_prompts)?void 0:i[r])&&(f=(null==(u=c.part3_prompts[r])?void 0:u.prompt_text)||(null==(m=c.part3_prompts[r])?void 0:m.transcription)||(null==(h=c.part3_prompts[r])?void 0:h.title)||"")}return{part:e,audio_url:p,question_text:f,upload_error:!1}}catch(_){const r=(null==_?void 0:_.message)||("string"==typeof _?_:"Unknown upload error");console.error(`‚ùå Hard failure uploading ${S}:`,r),l({title:"Upload Warning",description:`We could not upload your recording for ${e}. We will still save your test and run analysis using available audio.`,variant:"destructive"});const t=`https://mock-r2-fallback.local/speaking/${encodeURIComponent(j)}/${encodeURIComponent(e)}/${k}.webm`;let o="";const n=e.match(/^part(\d+)_q(\d+)$/);if(n){const e=parseInt(n[1],10),r=parseInt(n[2],10);1===e&&(null==(p=null==c?void 0:c.part1_prompts)?void 0:p[r])?o=(null==(f=c.part1_prompts[r])?void 0:f.prompt_text)||(null==(g=c.part1_prompts[r])?void 0:g.transcription)||(null==(b=c.part1_prompts[r])?void 0:b.title)||"":2===e&&(null==c?void 0:c.part2_prompt)?o=c.part2_prompt.prompt_text||c.part2_prompt.transcription||c.part2_prompt.title||"":3===e&&(null==(x=null==c?void 0:c.part3_prompts)?void 0:x[r])&&(o=(null==(v=c.part3_prompts[r])?void 0:v.prompt_text)||(null==(y=c.part3_prompts[r])?void 0:y.transcription)||(null==(w=c.part3_prompts[r])?void 0:w.title)||"")}return{part:e,audio_url:t,question_text:o,upload_error:!0,error_message:r}}}),m=await Promise.all(u);if(!m||0===m.length)return console.error("‚ùå No speaking upload results returned"),void l({title:"Upload error",description:"We could not process your recordings. Please try again.",variant:"destructive"});const h=m.filter(e=>!e.upload_error).length,p=m.filter(e=>e.upload_error).length;console.log("üìä Speaking upload summary:",{total:m.length,successfulCount:h,failedCount:p});try{const{data:{user:l}}=await oe.auth.getUser();if(!l)throw new Error("User not authenticated while submitting speaking test");const i=m.map(e=>e.audio_url),{data:u,error:f}=await oe.from("test_results").insert({user_id:l.id,test_type:"speaking",total_questions:m.length,correct_answers:null,score_percentage:0,time_taken:900,audio_urls:i,audio_retention_expires_at:null,test_data:{recordings_count:m.length,parts_completed:[1,2,3],r2_upload_summary:{total:m.length,successful:h,failed:p},retention_policy:"no_auto_expiry_r2_persistent"}}).select().single();if(f||!u)throw f||new Error("Failed to create speaking test result");console.log("‚úÖ Speaking test base records saved. AI scoring will be handled by backend using stored metadata and URLs.");const g=[];for(const n of m){const i=n.part.match(/^part(\d+)/),d=i?parseInt(i[1],10):NaN;if(isNaN(d)||d<1||d>3){console.error(`Invalid part number for recording: ${n.part}`);continue}let m="";if(1===d&&(null==(e=null==c?void 0:c.part1_prompts)?void 0:e.length)){const e=n.part.match(/_q(\d+)/),o=e?parseInt(e[1],10):0;o>=0&&o<c.part1_prompts.length&&(m=(null==(r=c.part1_prompts[o])?void 0:r.prompt_text)||(null==(t=c.part1_prompts[o])?void 0:t.transcription)||"")}else if(2===d&&(null==c?void 0:c.part2_prompt))m=c.part2_prompt.prompt_text||"";else if(3===d&&(null==(o=null==c?void 0:c.part3_prompts)?void 0:o.length)){const e=n.part.match(/_q(\d+)/),r=e?parseInt(e[1],10):0;r>=0&&r<c.part3_prompts.length&&(m=(null==(a=c.part3_prompts[r])?void 0:a.prompt_text)||(null==(s=c.part3_prompts[r])?void 0:s.transcription)||"")}g.push({user_id:l.id,test_result_id:u.id,part_number:d,question_text:m,audio_url:n.audio_url,transcription:"",band_scores:{},detailed_feedback:"",duration_seconds:120})}const{error:b}=await oe.from("speaking_test_results").insert(g);if(b)throw b;console.log("‚úÖ Speaking test base records saved. Running AI scoring..."),console.log("‚ÑπÔ∏è Skipping inline AI scoring for speaking test; base records saved for backend evaluation."),Le({}),n("/ielts-speaking-results",{state:{testData:c,recordings:m,audioBlobs:Object.fromEntries(d),testResultId:u.id}})}catch(i){console.error("Error saving or scoring speaking results:",i),l({title:"Save error",description:"Failed to save or score speaking results. Your recordings may not be fully processed.",variant:"destructive"})}}catch(d){console.error("Error submitting test:",d),l({title:"Submission Error",description:"Failed to submit test. Please try again.",variant:"destructive"})}})()},className:"font-medium",style:{backgroundColor:i.buttonPrimary,color:"#ffffff"},children:"Submit"})]})}),(1===h||3===h)&&!Ie&&a.jsx(A,{children:a.jsxs(a.Fragment,{children:[a.jsxs(M,{children:[a.jsx(L,{asChild:!0,children:a.jsx(_,{variant:"ghost",onClick:()=>{f>0&&(g(f-1),Ve(!1))},disabled:0===f,size:"icon",className:"absolute bottom-0 left-0 h-12 w-12",style:{color:i.textSecondary},onMouseEnter:e=>{e.currentTarget.style.color=i.buttonPrimary,e.currentTarget.style.backgroundColor="transparent"},onMouseLeave:e=>{e.currentTarget.style.color=i.textSecondary,e.currentTarget.style.backgroundColor="transparent"},children:a.jsx(J,{className:"w-5 h-5"})})}),a.jsx(I,{children:a.jsx("p",{children:"Previous question"})})]}),a.jsxs(M,{children:[a.jsx(L,{asChild:!0,children:a.jsx(_,{variant:"ghost",onClick:()=>{Ve(!1),yr()},disabled:void 0===Me[`part${h}_q${f}`],size:"icon",className:"absolute bottom-0 right-0 h-12 w-12",style:{color:i.textSecondary},onMouseEnter:e=>{e.currentTarget.style.color=i.buttonPrimary,e.currentTarget.style.backgroundColor="transparent"},onMouseLeave:e=>{e.currentTarget.style.color=i.textSecondary,e.currentTarget.style.backgroundColor="transparent"},children:a.jsx(Z,{className:"w-5 h-5"})})}),a.jsx(I,{children:a.jsx("p",{children:void 0===Me[`part${h}_q${f}`]?"Please record your answer first":f!==((null==c?void 0:c.part1_prompts.length)||0)-1||1!==h||(null==c?void 0:c.part2_prompt)||(null==c?void 0:c.part3_prompts)&&0!==c.part3_prompts.length?"Next question":"Complete test"})})]})]})}),2===h&&!Ie&&a.jsx(A,{children:a.jsxs(M,{children:[a.jsx(L,{asChild:!0,children:a.jsx(_,{variant:"ghost",onClick:()=>{yr()},disabled:void 0===Me[`part${h}_q${f}`],size:"icon",className:"absolute bottom-0 right-0 h-12 w-12 hover:bg-transparent hover:text-foreground",children:a.jsx(Z,{className:"w-5 h-5"})})}),a.jsx(I,{children:a.jsx("p",{children:void 0===Me[`part${h}_q${f}`]?"Please record your answer first":(null==c?void 0:c.part3_prompts)&&c.part3_prompts.length>0?"Go to Part 3":"Complete test"})})]})})]})]}),a.jsx("div",{className:"fixed bottom-6 left-6 z-40 flex items-center gap-4",children:a.jsx("button",{onClick:()=>n("/ielts-portal"),className:"text-lg cursor-pointer transition-colors",style:{color:i.textSecondary},onMouseEnter:e=>e.currentTarget.style.color=i.buttonPrimary,onMouseLeave:e=>e.currentTarget.style.color=i.textSecondary,children:"Exit Test"})}),Fe&&a.jsxs("div",{className:"fixed bottom-12 right-4 sm:bottom-20 sm:right-[420px] z-50 flex flex-col gap-2 sm:gap-3",children:[a.jsx(A,{children:a.jsxs(M,{children:[a.jsx(L,{asChild:!0,children:a.jsx(_,{variant:"outline",size:"icon",onClick:()=>_r("Help with Speaking Structure"),disabled:rr,className:"h-9 w-9 sm:h-12 sm:w-12 p-0 backdrop-blur-sm shadow-lg",style:{borderColor:i.border||"#e5e7eb",backgroundColor:"glassmorphism"===i.theme.name?"rgba(255,255,255,0.9)":"dark"===i.theme.name?"rgba(255,255,255,0.15)":"minimalist"===i.theme.name?"#ffffff":i.theme.colors.cardBackground||"#ffffff",color:i.buttonPrimary||"#2563eb"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=i.hoverBg||"rgba(0,0,0,0.05)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===i.theme.name?"rgba(255,255,255,0.9)":"dark"===i.theme.name?"rgba(255,255,255,0.15)":"minimalist"===i.theme.name?"#ffffff":i.theme.colors.cardBackground||"#ffffff"},children:a.jsx(ge,{className:"w-4 h-4 sm:w-6 sm:h-6",style:{color:i.buttonPrimary||"#2563eb"}})})}),a.jsx(I,{side:"left",children:a.jsx("p",{children:"Get help with speaking structure"})})]})}),a.jsx(A,{children:a.jsxs(M,{children:[a.jsx(L,{asChild:!0,children:a.jsx(_,{variant:"outline",size:"icon",onClick:()=>_r("Suggest Some Speaking Vocabulary"),disabled:rr,className:"h-9 w-9 sm:h-12 sm:w-12 p-0 backdrop-blur-sm shadow-lg",style:{borderColor:i.border||"#e5e7eb",backgroundColor:"glassmorphism"===i.theme.name?"rgba(255,255,255,0.9)":"dark"===i.theme.name?"rgba(255,255,255,0.15)":"minimalist"===i.theme.name?"#ffffff":i.theme.colors.cardBackground||"#ffffff",color:i.buttonPrimary||"#2563eb"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=i.hoverBg||"rgba(0,0,0,0.05)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===i.theme.name?"rgba(255,255,255,0.9)":"dark"===i.theme.name?"rgba(255,255,255,0.15)":"minimalist"===i.theme.name?"#ffffff":i.theme.colors.cardBackground||"#ffffff"},children:a.jsx(ee,{className:"w-4 h-4 sm:w-6 sm:h-6",style:{color:i.buttonPrimary||"#2563eb"}})})}),a.jsx(I,{side:"left",children:a.jsx("p",{children:"Get vocabulary suggestions"})})]})}),a.jsx(A,{children:a.jsxs(M,{children:[a.jsx(L,{asChild:!0,children:a.jsx(_,{variant:"outline",size:"icon",onClick:()=>_r("Give me 2-3 straightforward band 7+ example answers for this exact IELTS Speaking question. Just show the actual answers, no explanations."),disabled:rr,className:"h-9 w-9 sm:h-12 sm:w-12 p-0 backdrop-blur-sm shadow-lg",style:{borderColor:i.border||"#e5e7eb",backgroundColor:"glassmorphism"===i.theme.name?"rgba(255,255,255,0.9)":"dark"===i.theme.name?"rgba(255,255,255,0.15)":"minimalist"===i.theme.name?"#ffffff":i.theme.colors.cardBackground||"#ffffff",color:i.buttonPrimary||"#2563eb"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=i.hoverBg||"rgba(0,0,0,0.05)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===i.theme.name?"rgba(255,255,255,0.9)":"dark"===i.theme.name?"rgba(255,255,255,0.15)":"minimalist"===i.theme.name?"#ffffff":i.theme.colors.cardBackground||"#ffffff"},children:a.jsx(pe,{className:"w-4 h-4 sm:w-6 sm:h-6",style:{color:i.buttonPrimary||"#2563eb"}})})}),a.jsx(I,{side:"left",children:a.jsx("p",{children:"View band 7+ example answers"})})]})}),a.jsx(A,{children:a.jsxs(M,{children:[a.jsx(L,{asChild:!0,children:a.jsx(_,{variant:"outline",size:"icon",onClick:()=>_r("Help me with grammar for this speaking question"),disabled:rr,className:"h-9 w-9 sm:h-12 sm:w-12 p-0 backdrop-blur-sm shadow-lg",style:{borderColor:i.border||"#e5e7eb",backgroundColor:"glassmorphism"===i.theme.name?"rgba(255,255,255,0.9)":"dark"===i.theme.name?"rgba(255,255,255,0.15)":"minimalist"===i.theme.name?"#ffffff":i.theme.colors.cardBackground||"#ffffff",color:i.buttonPrimary||"#2563eb"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=i.hoverBg||"rgba(0,0,0,0.05)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===i.theme.name?"rgba(255,255,255,0.9)":"dark"===i.theme.name?"rgba(255,255,255,0.15)":"minimalist"===i.theme.name?"#ffffff":i.theme.colors.cardBackground||"#ffffff"},children:a.jsx(fe,{className:"w-4 h-4 sm:w-6 sm:h-6",style:{color:i.buttonPrimary||"#2563eb"}})})}),a.jsx(I,{side:"left",children:a.jsx("p",{children:"Get grammar help"})})]})})]}),a.jsxs("div",{className:"fixed bottom-6 right-3 sm:bottom-6 sm:right-6 z-50",children:[Fe&&a.jsxs(E,{className:"backdrop-blur-md rounded-3xl w-[260px] h-[360px] sm:w-96 sm:h-[500px] shadow-2xl flex flex-col transform-gpu origin-bottom-right transition-all duration-260 ease-in-out "+(He?"opacity-100 scale-100 translate-y-0":"opacity-0 scale-75 translate-y-8"),style:{backgroundColor:"glassmorphism"===i.theme.name?"rgba(255,255,255,0.95)":"dark"===i.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===i.theme.name?"#ffffff":i.theme.colors.cardBackground,borderColor:i.border,backdropFilter:"glassmorphism"===i.theme.name?"blur(12px)":"dark"===i.theme.name?"blur(8px)":"none",...i.cardStyle},children:[a.jsx(T,{className:"pb-1 sm:pb-2 rounded-t-3xl relative",children:a.jsx("div",{className:"absolute top-1.5 right-1.5 sm:top-2 sm:right-2",children:a.jsx(_,{variant:"ghost",size:"icon",onClick:()=>{We(!1),setTimeout(()=>{Ue(!1)},260)},className:"h-7 w-7 sm:h-8 sm:w-8 p-0",style:{color:i.textPrimary},children:"‚úï"})})}),a.jsxs(C,{className:"flex-1 flex flex-col px-2.5 py-2 sm:p-4 overflow-hidden",children:[a.jsx(se,{className:"flex-1 min-h-0",children:a.jsx(le,{className:"flex-1 min-h-0",children:0!==Qe.length||rr?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"rounded-lg p-3 mb-4",style:{backgroundColor:"glassmorphism"===i.theme.name?"rgba(255,255,255,0.1)":"dark"===i.theme.name?"rgba(255,255,255,0.05)":"minimalist"===i.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:i.border,borderWidth:"1px",borderStyle:"solid"},children:[a.jsx("div",{className:"text-xs uppercase tracking-wide mb-1",style:{color:i.textSecondary},children:"Question"}),a.jsx("div",{className:"text-xs sm:text-sm font-medium",style:{color:i.textPrimary},children:Pr}),a.jsx("div",{className:"text-[10px] sm:text-sm whitespace-pre-wrap mt-1",style:{color:i.textSecondary},children:Er||"No question available."})]}),Qe.map(e=>a.jsxs(de,{from:"user"===e.type?"user":"assistant",children:["bot"===e.type&&a.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"52px",height:"52px",flexShrink:0},children:a.jsx("img",{src:"https://raw.githubusercontent.com/AlfieAlfiegithu2/alfie-ai-coach/main/public/1000031289.png",alt:"Catie",style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx(ue,{children:a.jsx("div",{className:"px-3 py-2 rounded-xl text-sm",style:{backgroundColor:"glassmorphism"===i.theme.name?"rgba(255,255,255,0.1)":"dark"===i.theme.name?"rgba(255,255,255,0.05)":"minimalist"===i.theme.name?"#f9fafb":"rgba(255,255,255,0.5)",borderColor:i.border,borderWidth:"1px",borderStyle:"solid",color:i.textPrimary},children:a.jsx(me,{dangerouslySetInnerHTML:{__html:e.content.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/^‚Ä¢ (.*)$/gm,"<li>$1</li>").replace(/(<li>.*<\/li>)/s,"<ul>$1</ul>").replace(/\n/g,"<br>")}})})}),"user"===e.type&&(null==s?void 0:s.avatar_url)&&a.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"52px",height:"52px",flexShrink:0},children:a.jsx("img",{src:s.avatar_url,alt:"Your avatar",style:{width:"100%",height:"100%",objectFit:"cover"}})})]},e.id)),rr&&a.jsxs(de,{from:"assistant",children:[a.jsx(ue,{children:a.jsx("div",{className:"px-3 py-2 rounded-xl text-sm",style:{backgroundColor:"glassmorphism"===i.theme.name?"rgba(255,255,255,0.1)":"dark"===i.theme.name?"rgba(255,255,255,0.05)":"minimalist"===i.theme.name?"#f9fafb":"rgba(255,255,255,0.5)",borderColor:i.border,borderWidth:"1px",borderStyle:"solid"},children:a.jsx(he,{text:"Thinking..."})})}),a.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"52px",height:"52px"},children:a.jsx("img",{src:"https://raw.githubusercontent.com/AlfieAlfiegithu2/alfie-ai-coach/main/public/1000031289.png",alt:"Catie",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})]}):a.jsx(ie,{icon:a.jsx(ce,{className:"size-9 sm:size-12",style:{color:i.textSecondary}}),title:"Start a conversation",description:"Ask for help with your IELTS speaking practice"})})}),a.jsx("div",{className:"flex-shrink-0 mt-2.5 sm:mt-4",children:a.jsxs("div",{className:"flex gap-1.5 sm:gap-2",children:[a.jsx("input",{type:"text",value:Ze,onChange:e=>er(e.target.value),onKeyPress:e=>"Enter"===e.key&&!rr&&Ze.trim()&&Cr(),placeholder:"Ask for speaking help...",className:"flex-1 px-2.5 py-1.5 sm:px-3 sm:py-2 rounded-lg text-[10px] sm:text-sm focus:outline-none focus:ring-0 resize-none",style:{backgroundColor:"glassmorphism"===i.theme.name?"rgba(255,255,255,0.1)":"dark"===i.theme.name?"rgba(255,255,255,0.05)":"minimalist"===i.theme.name?"#ffffff":i.theme.colors.cardBackground,borderColor:i.border,borderWidth:"1px",borderStyle:"solid",color:i.textPrimary},disabled:rr}),a.jsx("style",{dangerouslySetInnerHTML:{__html:`\n                      input[placeholder="Ask for speaking help..."]::placeholder {\n                        color: ${i.textSecondary};\n                      }\n                    `}}),a.jsx(_,{onClick:()=>Cr(),disabled:rr||!Ze.trim(),variant:"ghost",size:"icon",className:"h-7 w-7 sm:h-8 sm:w-8 p-0",style:{color:i.textPrimary},children:rr?a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2",style:{borderColor:i.textPrimary}}):a.jsx(re,{className:"w-4 h-4"})})]})})]})]}),!Fe&&a.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"64px",height:"64px",cursor:"pointer",boxShadow:"0 8px 20px rgba(0,0,0,0.18)",transition:"transform 0.22s ease-out, box-shadow 0.22s ease-out"},onClick:()=>{Ue(!0),requestAnimationFrame(()=>We(!0))},onMouseEnter:e=>{const r=e.currentTarget;r.style.transform="scale(1.06) translateY(-2px)",r.style.boxShadow="0 14px 30px rgba(0,0,0,0.24)"},onMouseLeave:e=>{const r=e.currentTarget;r.style.transform="scale(1.0) translateY(0px)",r.style.boxShadow="0 10px 25px rgba(0,0,0,0.15)"},children:a.jsx("img",{src:"https://raw.githubusercontent.com/AlfieAlfiegithu2/alfie-ai-coach/main/public/1000031289.png",alt:"Catie",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})]})})})})]})};export{Lr as default};
