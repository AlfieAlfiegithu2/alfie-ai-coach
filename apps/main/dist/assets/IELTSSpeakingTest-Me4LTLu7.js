import{a4 as e,bv as r,bw as t,bx as n,by as o,bz as a,bA as s,bB as i,bC as l,bD as c,bE as d,bF as u,bG as m,bH as p,bI as h,r as f,bJ as g,bK as b,bL as y,bM as x,bq as v,bN as w,bO as j,bP as k,bQ as S,bR as N,bS as P,av as C,aB as _,aF as E,j as T,ay as O,aA as A,az as R,b2 as L,aC as M,bu as I,at as D,bk as $,aq as z,u as F,z as B,g as q,al as U,bs as W,Z as H,ap as V,a as Y,B as G,k as X,C as K,M as Q,b as Z,c as J,au as ee,bg as re,bh as te,E as ne,a1 as oe,bi as ae,$ as se,P as ie,bT as le,bt as ce,ai as de,V as ue,ad as me,X as pe,a7 as he,S as fe,o as ge,p as be,q as ye,s as xe,_ as ve,bU as we,d as je,a8 as ke}from"./index-B5Em92Z4.js";import{S as Se}from"./separator-CseZb0_s.js";import{R as Ne,T as Pe,a as Ce,b as _e,C as Ee}from"./CustomAudioPlayer-C3KsVKe1.js";import{g as Te,s as Oe}from"./supabase-DWL4C3fA.js";import{A as Ae}from"./cloudflare-r2-I755hh90.js";import"./dropdown-menu-ffA4vlNa.js";import{F as Re,C as Le,a as Me,b as Ie,O as De,M as $e,c as ze,R as Fe,S as Be}from"./shimmering-text-TTt5s2bU.js";import{C as qe}from"./circle-alert-D7LFqHdW.js";import{F as Ue}from"./file-text-C8N405FJ.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=e("ListTree",[["path",{d:"M21 12h-8",key:"1bmf0i"}],["path",{d:"M21 6H8",key:"1pqkrb"}],["path",{d:"M21 18h-8",key:"1tm79t"}],["path",{d:"M3 6v4c0 1.1.9 2 2 2h3",key:"1ywdgy"}],["path",{d:"M3 10v6c0 1.1.9 2 2 2h3",key:"2wc746"}]]);var He=["points","className","baseLinePoints","connectNulls"];function Ve(){return Ve=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},Ve.apply(this,arguments)}function Ye(e,r){if(null==e)return{};var t,n,o=function(e,r){if(null==e)return{};var t={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(r.indexOf(n)>=0)continue;t[n]=e[n]}return t}(e,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)t=a[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}function Ge(e){return function(e){if(Array.isArray(e))return Xe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,r){if(!e)return;if("string"==typeof e)return Xe(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Xe(e,r)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xe(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Ke=function(e){return e&&e.x===+e.x&&e.y===+e.y},Qe=function(e,r){var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=[[]];return e.forEach(function(e){Ke(e)?r[r.length-1].push(e):r[r.length-1].length>0&&r.push([])}),Ke(e[0])&&r[r.length-1].push(e[0]),r[r.length-1].length<=0&&(r=r.slice(0,-1)),r}(e);r&&(t=[t.reduce(function(e,r){return[].concat(Ge(e),Ge(r))},[])]);var n=t.map(function(e){return e.reduce(function(e,r,t){return"".concat(e).concat(0===t?"M":"L").concat(r.x,",").concat(r.y)},"")}).join("");return 1===t.length?"".concat(n,"Z"):n},Ze=function(e){var o=e.points,a=e.className,s=e.baseLinePoints,i=e.connectNulls,l=Ye(e,He);if(!o||!o.length)return null;var c=r("recharts-polygon",a);if(s&&s.length){var d=l.stroke&&"none"!==l.stroke,u=function(e,r,t){var n=Qe(e,t);return"".concat("Z"===n.slice(-1)?n.slice(0,-1):n,"L").concat(Qe(r.reverse(),t).slice(1))}(o,s,i);return t.createElement("g",{className:c},t.createElement("path",Ve({},n(l,!0),{fill:"Z"===u.slice(-1)?l.fill:"none",stroke:"none",d:u})),d?t.createElement("path",Ve({},n(l,!0),{fill:"none",d:Qe(o,i)})):null,d?t.createElement("path",Ve({},n(l,!0),{fill:"none",d:Qe(s,i)})):null)}var m=Qe(o,i);return t.createElement("path",Ve({},n(l,!0),{fill:"Z"===m.slice(-1)?l.fill:"none",className:c,d:m}))},Je=["cx","cy","innerRadius","outerRadius","gridType","radialLines"];function er(e){return(er="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function rr(e,r){if(null==e)return{};var t,n,o=function(e,r){if(null==e)return{};var t={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(r.indexOf(n)>=0)continue;t[n]=e[n]}return t}(e,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)t=a[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}function tr(){return tr=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},tr.apply(this,arguments)}function nr(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function or(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?nr(Object(t),!0).forEach(function(r){ar(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):nr(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function ar(e,r,t){var n;return n=function(e,r){if("object"!=er(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,r||"default");if("object"!=er(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(r,"string"),(r="symbol"==er(n)?n:n+"")in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var sr=function(e,r,t,n){var a="";return n.forEach(function(n,s){var i=o(r,t,e,n);a+=s?"L ".concat(i.x,",").concat(i.y):"M ".concat(i.x,",").concat(i.y)}),a+="Z"},ir=function(e){var r=e.cx,a=e.cy,s=e.innerRadius,i=e.outerRadius,l=e.polarAngles,c=e.radialLines;if(!l||!l.length||!c)return null;var d=or({stroke:"#ccc"},n(e,!1));return t.createElement("g",{className:"recharts-polar-grid-angle"},l.map(function(e){var n=o(r,a,s,e),l=o(r,a,i,e);return t.createElement("line",tr({},d,{key:"line-".concat(e),x1:n.x,y1:n.y,x2:l.x,y2:l.y}))}))},lr=function(e){var o=e.cx,a=e.cy,s=e.radius,i=e.index,l=or(or({stroke:"#ccc"},n(e,!1)),{},{fill:"none"});return t.createElement("circle",tr({},l,{className:r("recharts-polar-grid-concentric-circle",e.className),key:"circle-".concat(i),cx:o,cy:a,r:s}))},cr=function(e){var o=e.radius,a=e.index,s=or(or({stroke:"#ccc"},n(e,!1)),{},{fill:"none"});return t.createElement("path",tr({},s,{className:r("recharts-polar-grid-concentric-polygon",e.className),key:"path-".concat(a),d:sr(o,e.cx,e.cy,e.polarAngles)}))},dr=function(e){var r=e.polarRadius,n=e.gridType;return r&&r.length?t.createElement("g",{className:"recharts-polar-grid-concentric"},r.map(function(r,o){var a=o;return"circle"===n?t.createElement(lr,tr({key:a},e,{radius:r,index:o})):t.createElement(cr,tr({key:a},e,{radius:r,index:o}))})):null},ur=function(e){var r=e.cx,n=void 0===r?0:r,o=e.cy,a=void 0===o?0:o,s=e.innerRadius,i=void 0===s?0:s,l=e.outerRadius,c=void 0===l?0:l,d=e.gridType,u=void 0===d?"polygon":d,m=e.radialLines,p=void 0===m||m,h=rr(e,Je);return c<=0?null:t.createElement("g",{className:"recharts-polar-grid"},t.createElement(ir,tr({cx:n,cy:a,innerRadius:i,outerRadius:c,gridType:u,radialLines:p},h)),t.createElement(dr,tr({cx:n,cy:a,innerRadius:i,outerRadius:c,gridType:u,radialLines:p},h)))};ur.displayName="PolarGrid";var mr=a,pr=i,hr=s;const fr=Te(function(e,r){return e&&e.length?mr(e,hr(r),pr):void 0});var gr=a,br=s,yr=l;const xr=Te(function(e,r){return e&&e.length?gr(e,br(r),yr):void 0});var vr=["cx","cy","angle","ticks","axisLine"],wr=["ticks","tick","angle","tickFormatter","stroke"];function jr(e){return(jr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function kr(){return kr=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},kr.apply(this,arguments)}function Sr(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function Nr(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?Sr(Object(t),!0).forEach(function(r){Ar(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Sr(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function Pr(e,r){if(null==e)return{};var t,n,o=function(e,r){if(null==e)return{};var t={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(r.indexOf(n)>=0)continue;t[n]=e[n]}return t}(e,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)t=a[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}function Cr(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Rr(n.key),n)}}function _r(e,r,t){return r=Tr(r),function(e,r){if(r&&("object"===jr(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Er()?Reflect.construct(r,t||[],Tr(e).constructor):r.apply(e,t))}function Er(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(r){}return(Er=function(){return!!e})()}function Tr(e){return(Tr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Or(e,r){return(Or=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,r){return e.__proto__=r,e})(e,r)}function Ar(e,r,t){return(r=Rr(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function Rr(e){var r=function(e,r){if("object"!=jr(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,r||"default");if("object"!=jr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"==jr(r)?r:r+""}var Lr=function(){function e(){return function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),_r(this,e,arguments)}return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),r&&Or(e,r)}(e,f.PureComponent),a=e,i=[{key:"renderTickItem",value:function(e,r,n){return t.isValidElement(e)?t.cloneElement(e,r):c(e)?e(r):t.createElement(d,kr({},r,{className:"recharts-polar-radius-axis-tick-value"}),n)}}],(s=[{key:"getTickValueCoord",value:function(e){var r=e.coordinate,t=this.props,n=t.angle,a=t.cx,s=t.cy;return o(a,s,r,n)}},{key:"getTickTextAnchor",value:function(){var e;switch(this.props.orientation){case"left":e="end";break;case"right":e="start";break;default:e="middle"}return e}},{key:"getViewBox",value:function(){var e=this.props,r=e.cx,t=e.cy,n=e.angle,o=e.ticks,a=fr(o,function(e){return e.coordinate||0});return{cx:r,cy:t,startAngle:n,endAngle:n,innerRadius:xr(o,function(e){return e.coordinate||0}).coordinate||0,outerRadius:a.coordinate||0}}},{key:"renderAxisLine",value:function(){var e=this.props,r=e.cx,a=e.cy,s=e.angle,i=e.ticks,l=e.axisLine,c=Pr(e,vr),d=i.reduce(function(e,r){return[Math.min(e[0],r.coordinate),Math.max(e[1],r.coordinate)]},[1/0,-1/0]),u=o(r,a,d[0],s),m=o(r,a,d[1],s),p=Nr(Nr(Nr({},n(c,!1)),{},{fill:"none"},n(l,!1)),{},{x1:u.x,y1:u.y,x2:m.x,y2:m.y});return t.createElement("line",kr({className:"recharts-polar-radius-axis-line"},p))}},{key:"renderTicks",value:function(){var o=this,a=this.props,s=a.ticks,i=a.tick,l=a.angle,c=a.tickFormatter,d=a.stroke,h=Pr(a,wr),f=this.getTickTextAnchor(),g=n(h,!1),b=n(i,!1),y=s.map(function(n,a){var s=o.getTickValueCoord(n),h=Nr(Nr(Nr(Nr({textAnchor:f,transform:"rotate(".concat(90-l,", ").concat(s.x,", ").concat(s.y,")")},g),{},{stroke:"none",fill:d},b),{},{index:a},s),{},{payload:n});return t.createElement(u,kr({className:r("recharts-polar-radius-axis-tick",m(i)),key:"tick-".concat(n.coordinate)},p(o.props,n,a)),e.renderTickItem(i,h,c?c(n.value,a):n.value))});return t.createElement(u,{className:"recharts-polar-radius-axis-ticks"},y)}},{key:"render",value:function(){var e=this.props,n=e.ticks,o=e.axisLine,a=e.tick;return n&&n.length?t.createElement(u,{className:r("recharts-polar-radius-axis",this.props.className)},o&&this.renderAxisLine(),a&&this.renderTicks(),h.renderCallByParent(this.props,this.getViewBox())):null}}])&&Cr(a.prototype,s),i&&Cr(a,i),Object.defineProperty(a,"prototype",{writable:!1}),a;var a,s,i}();function Mr(e){return(Mr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ir(){return Ir=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},Ir.apply(this,arguments)}function Dr(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function $r(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?Dr(Object(t),!0).forEach(function(r){Wr(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Dr(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function zr(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Hr(n.key),n)}}function Fr(e,r,t){return r=qr(r),function(e,r){if(r&&("object"===Mr(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Br()?Reflect.construct(r,t||[],qr(e).constructor):r.apply(e,t))}function Br(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(r){}return(Br=function(){return!!e})()}function qr(e){return(qr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ur(e,r){return(Ur=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,r){return e.__proto__=r,e})(e,r)}function Wr(e,r,t){return(r=Hr(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function Hr(e){var r=function(e,r){if("object"!=Mr(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,r||"default");if("object"!=Mr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"==Mr(r)?r:r+""}Ar(Lr,"displayName","PolarRadiusAxis"),Ar(Lr,"axisType","radiusAxis"),Ar(Lr,"defaultProps",{type:"number",radiusAxisId:0,cx:0,cy:0,angle:0,orientation:"right",stroke:"#ccc",axisLine:!0,tick:!0,tickCount:5,allowDataOverflow:!1,scale:"auto",allowDuplicatedCategory:!0});var Vr=Math.PI/180,Yr=1e-5,Gr=function(){function e(){return function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),Fr(this,e,arguments)}return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),r&&Ur(e,r)}(e,f.PureComponent),a=e,i=[{key:"renderTickItem",value:function(e,r,n){return t.isValidElement(e)?t.cloneElement(e,r):c(e)?e(r):t.createElement(d,Ir({},r,{className:"recharts-polar-angle-axis-tick-value"}),n)}}],(s=[{key:"getTickLineCoord",value:function(e){var r=this.props,t=r.cx,n=r.cy,a=r.radius,s=r.orientation,i=r.tickSize||8,l=o(t,n,a,e.coordinate),c=o(t,n,a+("inner"===s?-1:1)*i,e.coordinate);return{x1:l.x,y1:l.y,x2:c.x,y2:c.y}}},{key:"getTickTextAnchor",value:function(e){var r=this.props.orientation,t=Math.cos(-e.coordinate*Vr);return t>Yr?"outer"===r?"start":"end":t<-Yr?"outer"===r?"end":"start":"middle"}},{key:"renderAxisLine",value:function(){var e=this.props,r=e.cx,a=e.cy,s=e.radius,i=e.axisLine,l=e.axisLineType,c=$r($r({},n(this.props,!1)),{},{fill:"none"},n(i,!1));if("circle"===l)return t.createElement(g,Ir({className:"recharts-polar-angle-axis-line"},c,{cx:r,cy:a,r:s}));var d=this.props.ticks.map(function(e){return o(r,a,s,e.coordinate)});return t.createElement(Ze,Ir({className:"recharts-polar-angle-axis-line"},c,{points:d}))}},{key:"renderTicks",value:function(){var o=this,a=this.props,s=a.ticks,i=a.tick,l=a.tickLine,c=a.tickFormatter,d=a.stroke,h=n(this.props,!1),f=n(i,!1),g=$r($r({},h),{},{fill:"none"},n(l,!1)),b=s.map(function(n,a){var s=o.getTickLineCoord(n),b=$r($r($r({textAnchor:o.getTickTextAnchor(n)},h),{},{stroke:"none",fill:d},f),{},{index:a,payload:n,x:s.x2,y:s.y2});return t.createElement(u,Ir({className:r("recharts-polar-angle-axis-tick",m(i)),key:"tick-".concat(n.coordinate)},p(o.props,n,a)),l&&t.createElement("line",Ir({className:"recharts-polar-angle-axis-tick-line"},g,s)),i&&e.renderTickItem(i,b,c?c(n.value,a):n.value))});return t.createElement(u,{className:"recharts-polar-angle-axis-ticks"},b)}},{key:"render",value:function(){var e=this.props,n=e.ticks,o=e.radius,a=e.axisLine;return o<=0||!n||!n.length?null:t.createElement(u,{className:r("recharts-polar-angle-axis",this.props.className)},a&&this.renderAxisLine(),this.renderTicks())}}])&&zr(a.prototype,s),i&&zr(a,i),Object.defineProperty(a,"prototype",{writable:!1}),a;var a,s,i}();Wr(Gr,"displayName","PolarAngleAxis"),Wr(Gr,"axisType","angleAxis"),Wr(Gr,"defaultProps",{type:"category",angleAxisId:0,scale:"auto",cx:0,cy:0,orientation:"outer",axisLine:!0,tickLine:!0,tickSize:8,tick:!0,hide:!1,allowDuplicatedCategory:!0});const Xr=Te(function(e){return e&&e.length?e[0]:void 0});var Kr=["key"];function Qr(e){return(Qr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Zr(e,r){if(null==e)return{};var t,n,o=function(e,r){if(null==e)return{};var t={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(r.indexOf(n)>=0)continue;t[n]=e[n]}return t}(e,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)t=a[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}function Jr(){return Jr=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},Jr.apply(this,arguments)}function et(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function rt(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?et(Object(t),!0).forEach(function(r){it(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):et(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function tt(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,lt(n.key),n)}}function nt(e,r,t){return r=at(r),function(e,r){if(r&&("object"===Qr(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ot()?Reflect.construct(r,t||[],at(e).constructor):r.apply(e,t))}function ot(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(r){}return(ot=function(){return!!e})()}function at(e){return(at=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function st(e,r){return(st=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,r){return e.__proto__=r,e})(e,r)}function it(e,r,t){return(r=lt(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function lt(e){var r=function(e,r){if("object"!=Qr(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,r||"default");if("object"!=Qr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"==Qr(r)?r:r+""}var ct=function(){function e(){var r;!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return it(r=nt(this,e,[].concat(n)),"state",{isAnimationFinished:!1}),it(r,"handleAnimationEnd",function(){var e=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),c(e)&&e()}),it(r,"handleAnimationStart",function(){var e=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),c(e)&&e()}),it(r,"handleMouseEnter",function(e){var t=r.props.onMouseEnter;t&&t(r.props,e)}),it(r,"handleMouseLeave",function(e){var t=r.props.onMouseLeave;t&&t(r.props,e)}),r}return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),r&&st(e,r)}(e,f.PureComponent),o=e,s=[{key:"getDerivedStateFromProps",value:function(e,r){return e.animationId!==r.prevAnimationId?{prevAnimationId:e.animationId,curPoints:e.points,prevPoints:r.curPoints}:e.points!==r.curPoints?{curPoints:e.points}:null}},{key:"renderDotItem",value:function(e,n){var o;if(t.isValidElement(e))o=t.cloneElement(e,n);else if(c(e))o=e(n);else{var a=n.key,s=Zr(n,Kr);o=t.createElement(g,Jr({},s,{key:a,className:r("recharts-radar-dot","boolean"!=typeof e?e.className:"")}))}return o}}],(a=[{key:"renderDots",value:function(r){var o=this.props,a=o.dot,s=o.dataKey,i=n(this.props,!1),l=n(a,!0),c=r.map(function(r,t){var n=rt(rt(rt({key:"dot-".concat(t),r:3},i),l),{},{dataKey:s,cx:r.x,cy:r.y,index:t,payload:r});return e.renderDotItem(a,n)});return t.createElement(u,{className:"recharts-radar-dots"},c)}},{key:"renderPolygonStatically",value:function(e){var r,o=this.props,a=o.shape,s=o.dot,i=o.isRange,l=o.baseLinePoints,d=o.connectNulls;return r=t.isValidElement(a)?t.cloneElement(a,rt(rt({},this.props),{},{points:e})):c(a)?a(rt(rt({},this.props),{},{points:e})):t.createElement(Ze,Jr({},n(this.props,!0),{onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,points:e,baseLinePoints:i?l:null,connectNulls:d})),t.createElement(u,{className:"recharts-radar-polygon"},r,s?this.renderDots(e):null)}},{key:"renderPolygonWithAnimation",value:function(){var e=this,r=this.props,n=r.points,o=r.isAnimationActive,a=r.animationBegin,s=r.animationDuration,i=r.animationEasing,l=r.animationId,c=this.state.prevPoints;return t.createElement(b,{begin:a,duration:s,isActive:o,easing:i,from:{t:0},to:{t:1},key:"radar-".concat(l),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(r){var t=r.t,o=c&&c.length/n.length,a=n.map(function(e,r){var n=c&&c[Math.floor(r*o)];if(n){var a=y(n.x,e.x),s=y(n.y,e.y);return rt(rt({},e),{},{x:a(t),y:s(t)})}var i=y(e.cx,e.x),l=y(e.cy,e.y);return rt(rt({},e),{},{x:i(t),y:l(t)})});return e.renderPolygonStatically(a)})}},{key:"renderPolygon",value:function(){var e=this.props,r=e.points,t=e.isAnimationActive,n=e.isRange,o=this.state.prevPoints;return!(t&&r&&r.length)||n||o&&x(o,r)?this.renderPolygonStatically(r):this.renderPolygonWithAnimation()}},{key:"render",value:function(){var e=this.props,n=e.hide,o=e.className,a=e.points,s=e.isAnimationActive;if(n||!a||!a.length)return null;var i=this.state.isAnimationFinished,l=r("recharts-radar",o);return t.createElement(u,{className:l},this.renderPolygon(),(!s||i)&&v.renderCallByParent(this.props,a))}}])&&tt(o.prototype,a),s&&tt(o,s),Object.defineProperty(o,"prototype",{writable:!1}),o;var o,a,s}();it(ct,"displayName","Radar"),it(ct,"defaultProps",{angleAxisId:0,radiusAxisId:0,hide:!1,activeDot:!0,dot:!1,legendType:"rect",isAnimationActive:!w.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"}),it(ct,"getComposedData",function(e){var r=e.radiusAxis,t=e.angleAxis,n=e.displayedData,a=e.dataKey,s=e.bandSize,i=t.cx,l=t.cy,c=!1,d=[],u="number"!==t.type&&null!=s?s:0;n.forEach(function(e,n){var s=j(e,t.dataKey,n),m=j(e,a),p=t.scale(s)+u,h=Array.isArray(m)?k(m):m,f=S(h)?void 0:r.scale(h);Array.isArray(m)&&m.length>=2&&(c=!0),d.push(rt(rt({},o(i,l,f,p)),{},{name:s,value:m,cx:i,cy:l,radius:f,angle:p,payload:e}))});var m=[];return c&&d.forEach(function(e){if(Array.isArray(e.value)){var t=Xr(e.value),n=S(t)?void 0:r.scale(t);m.push(rt(rt({},e),{},{radius:n},o(i,l,n,e.angle)))}else m.push(e)}),{points:d,isRange:c,baseLinePoints:m}});var dt=N({chartName:"RadarChart",GraphicalChild:ct,axisComponents:[{axisType:"angleAxis",AxisComp:Gr},{axisType:"radiusAxis",AxisComp:Lr}],formatAxisMap:P,defaultProps:{layout:"centric",startAngle:90,endAngle:-270,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});var ut="ScrollArea",[mt,pt]=C(ut),[ht,ft]=mt(ut),gt=f.forwardRef((e,r)=>{const{__scopeScrollArea:t,type:n="hover",dir:o,scrollHideDelay:a=600,...s}=e,[i,l]=f.useState(null),[c,d]=f.useState(null),[u,m]=f.useState(null),[p,h]=f.useState(null),[g,b]=f.useState(null),[y,x]=f.useState(0),[v,w]=f.useState(0),[j,k]=f.useState(!1),[S,N]=f.useState(!1),P=_(r,e=>l(e)),C=E(o);return T.jsx(ht,{scope:t,type:n,dir:C,scrollHideDelay:a,scrollArea:i,viewport:c,onViewportChange:d,content:u,onContentChange:m,scrollbarX:p,onScrollbarXChange:h,scrollbarXEnabled:j,onScrollbarXEnabledChange:k,scrollbarY:g,onScrollbarYChange:b,scrollbarYEnabled:S,onScrollbarYEnabledChange:N,onCornerWidthChange:x,onCornerHeightChange:w,children:T.jsx(O.div,{dir:C,...s,ref:P,style:{position:"relative","--radix-scroll-area-corner-width":y+"px","--radix-scroll-area-corner-height":v+"px",...e.style}})})});gt.displayName=ut;var bt="ScrollAreaViewport",yt=f.forwardRef((e,r)=>{const{__scopeScrollArea:t,children:n,asChild:o,nonce:a,...s}=e,i=ft(bt,t),l=f.useRef(null),c=_(r,l,i.onViewportChange);return T.jsxs(T.Fragment,{children:[T.jsx("style",{dangerouslySetInnerHTML:{__html:"\n[data-radix-scroll-area-viewport] {\n  scrollbar-width: none;\n  -ms-overflow-style: none;\n  -webkit-overflow-scrolling: touch;\n}\n[data-radix-scroll-area-viewport]::-webkit-scrollbar {\n  display: none;\n}\n:where([data-radix-scroll-area-viewport]) {\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n}\n:where([data-radix-scroll-area-content]) {\n  flex-grow: 1;\n}\n"},nonce:a}),T.jsx(O.div,{"data-radix-scroll-area-viewport":"",...s,asChild:o,ref:c,style:{overflowX:i.scrollbarXEnabled?"scroll":"hidden",overflowY:i.scrollbarYEnabled?"scroll":"hidden",...e.style},children:Ht({asChild:o,children:n},e=>T.jsx("div",{"data-radix-scroll-area-content":"",ref:i.onContentChange,style:{minWidth:i.scrollbarXEnabled?"fit-content":void 0},children:e}))})]})});yt.displayName=bt;var xt="ScrollAreaScrollbar",vt=f.forwardRef((e,r)=>{const{forceMount:t,...n}=e,o=ft(xt,e.__scopeScrollArea),{onScrollbarXEnabledChange:a,onScrollbarYEnabledChange:s}=o,i="horizontal"===e.orientation;return f.useEffect(()=>(i?a(!0):s(!0),()=>{i?a(!1):s(!1)}),[i,a,s]),"hover"===o.type?T.jsx(wt,{...n,ref:r,forceMount:t}):"scroll"===o.type?T.jsx(jt,{...n,ref:r,forceMount:t}):"auto"===o.type?T.jsx(kt,{...n,ref:r,forceMount:t}):"always"===o.type?T.jsx(St,{...n,ref:r}):null});vt.displayName=xt;var wt=f.forwardRef((e,r)=>{const{forceMount:t,...n}=e,o=ft(xt,e.__scopeScrollArea),[a,s]=f.useState(!1);return f.useEffect(()=>{const e=o.scrollArea;let r=0;if(e){const t=()=>{window.clearTimeout(r),s(!0)},n=()=>{r=window.setTimeout(()=>s(!1),o.scrollHideDelay)};return e.addEventListener("pointerenter",t),e.addEventListener("pointerleave",n),()=>{window.clearTimeout(r),e.removeEventListener("pointerenter",t),e.removeEventListener("pointerleave",n)}}},[o.scrollArea,o.scrollHideDelay]),T.jsx(A,{present:t||a,children:T.jsx(kt,{"data-state":a?"visible":"hidden",...n,ref:r})})}),jt=f.forwardRef((e,r)=>{const{forceMount:t,...n}=e,o=ft(xt,e.__scopeScrollArea),a="horizontal"===e.orientation,s=Ut(()=>l("SCROLL_END"),100),[i,l]=(c="hidden",d={hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}},f.useReducer((e,r)=>d[e][r]??e,c));var c,d;return f.useEffect(()=>{if("idle"===i){const e=window.setTimeout(()=>l("HIDE"),o.scrollHideDelay);return()=>window.clearTimeout(e)}},[i,o.scrollHideDelay,l]),f.useEffect(()=>{const e=o.viewport,r=a?"scrollLeft":"scrollTop";if(e){let t=e[r];const n=()=>{const n=e[r];t!==n&&(l("SCROLL"),s()),t=n};return e.addEventListener("scroll",n),()=>e.removeEventListener("scroll",n)}},[o.viewport,a,l,s]),T.jsx(A,{present:t||"hidden"!==i,children:T.jsx(St,{"data-state":"hidden"===i?"hidden":"visible",...n,ref:r,onPointerEnter:R(e.onPointerEnter,()=>l("POINTER_ENTER")),onPointerLeave:R(e.onPointerLeave,()=>l("POINTER_LEAVE"))})})}),kt=f.forwardRef((e,r)=>{const t=ft(xt,e.__scopeScrollArea),{forceMount:n,...o}=e,[a,s]=f.useState(!1),i="horizontal"===e.orientation,l=Ut(()=>{if(t.viewport){const e=t.viewport.offsetWidth<t.viewport.scrollWidth,r=t.viewport.offsetHeight<t.viewport.scrollHeight;s(i?e:r)}},10);return Wt(t.viewport,l),Wt(t.content,l),T.jsx(A,{present:n||a,children:T.jsx(St,{"data-state":a?"visible":"hidden",...o,ref:r})})}),St=f.forwardRef((e,r)=>{const{orientation:t="vertical",...n}=e,o=ft(xt,e.__scopeScrollArea),a=f.useRef(null),s=f.useRef(0),[i,l]=f.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),c=Dt(i.viewport,i.content),d={...n,sizes:i,onSizesChange:l,hasThumb:Boolean(c>0&&c<1),onThumbChange:e=>a.current=e,onThumbPointerUp:()=>s.current=0,onThumbPointerDown:e=>s.current=e};function u(e,r){return function(e,r,t,n="ltr"){const o=$t(t),a=o/2,s=r||a,i=o-s,l=t.scrollbar.paddingStart+s,c=t.scrollbar.size-t.scrollbar.paddingEnd-i,d=t.content-t.viewport,u="ltr"===n?[0,d]:[-1*d,0];return Ft([l,c],u)(e)}(e,s.current,i,r)}return"horizontal"===t?T.jsx(Nt,{...d,ref:r,onThumbPositionChange:()=>{if(o.viewport&&a.current){const e=zt(o.viewport.scrollLeft,i,o.dir);a.current.style.transform=`translate3d(${e}px, 0, 0)`}},onWheelScroll:e=>{o.viewport&&(o.viewport.scrollLeft=e)},onDragScroll:e=>{o.viewport&&(o.viewport.scrollLeft=u(e,o.dir))}}):"vertical"===t?T.jsx(Pt,{...d,ref:r,onThumbPositionChange:()=>{if(o.viewport&&a.current){const e=zt(o.viewport.scrollTop,i);a.current.style.transform=`translate3d(0, ${e}px, 0)`}},onWheelScroll:e=>{o.viewport&&(o.viewport.scrollTop=e)},onDragScroll:e=>{o.viewport&&(o.viewport.scrollTop=u(e))}}):null}),Nt=f.forwardRef((e,r)=>{const{sizes:t,onSizesChange:n,...o}=e,a=ft(xt,e.__scopeScrollArea),[s,i]=f.useState(),l=f.useRef(null),c=_(r,l,a.onScrollbarXChange);return f.useEffect(()=>{l.current&&i(getComputedStyle(l.current))},[l]),T.jsx(Et,{"data-orientation":"horizontal",...o,ref:c,sizes:t,style:{bottom:0,left:"rtl"===a.dir?"var(--radix-scroll-area-corner-width)":0,right:"ltr"===a.dir?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":$t(t)+"px",...e.style},onThumbPointerDown:r=>e.onThumbPointerDown(r.x),onDragScroll:r=>e.onDragScroll(r.x),onWheelScroll:(r,t)=>{if(a.viewport){const n=a.viewport.scrollLeft+r.deltaX;e.onWheelScroll(n),Bt(n,t)&&r.preventDefault()}},onResize:()=>{l.current&&a.viewport&&s&&n({content:a.viewport.scrollWidth,viewport:a.viewport.offsetWidth,scrollbar:{size:l.current.clientWidth,paddingStart:It(s.paddingLeft),paddingEnd:It(s.paddingRight)}})}})}),Pt=f.forwardRef((e,r)=>{const{sizes:t,onSizesChange:n,...o}=e,a=ft(xt,e.__scopeScrollArea),[s,i]=f.useState(),l=f.useRef(null),c=_(r,l,a.onScrollbarYChange);return f.useEffect(()=>{l.current&&i(getComputedStyle(l.current))},[l]),T.jsx(Et,{"data-orientation":"vertical",...o,ref:c,sizes:t,style:{top:0,right:"ltr"===a.dir?0:void 0,left:"rtl"===a.dir?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":$t(t)+"px",...e.style},onThumbPointerDown:r=>e.onThumbPointerDown(r.y),onDragScroll:r=>e.onDragScroll(r.y),onWheelScroll:(r,t)=>{if(a.viewport){const n=a.viewport.scrollTop+r.deltaY;e.onWheelScroll(n),Bt(n,t)&&r.preventDefault()}},onResize:()=>{l.current&&a.viewport&&s&&n({content:a.viewport.scrollHeight,viewport:a.viewport.offsetHeight,scrollbar:{size:l.current.clientHeight,paddingStart:It(s.paddingTop),paddingEnd:It(s.paddingBottom)}})}})}),[Ct,_t]=mt(xt),Et=f.forwardRef((e,r)=>{const{__scopeScrollArea:t,sizes:n,hasThumb:o,onThumbChange:a,onThumbPointerUp:s,onThumbPointerDown:i,onThumbPositionChange:l,onDragScroll:c,onWheelScroll:d,onResize:u,...m}=e,p=ft(xt,t),[h,g]=f.useState(null),b=_(r,e=>g(e)),y=f.useRef(null),x=f.useRef(""),v=p.viewport,w=n.content-n.viewport,j=L(d),k=L(l),S=Ut(u,10);function N(e){if(y.current){const r=e.clientX-y.current.left,t=e.clientY-y.current.top;c({x:r,y:t})}}return f.useEffect(()=>{const e=e=>{const r=e.target;(null==h?void 0:h.contains(r))&&j(e,w)};return document.addEventListener("wheel",e,{passive:!1}),()=>document.removeEventListener("wheel",e,{passive:!1})},[v,h,w,j]),f.useEffect(k,[n,k]),Wt(h,S),Wt(p.content,S),T.jsx(Ct,{scope:t,scrollbar:h,hasThumb:o,onThumbChange:L(a),onThumbPointerUp:L(s),onThumbPositionChange:k,onThumbPointerDown:L(i),children:T.jsx(O.div,{...m,ref:b,style:{position:"absolute",...m.style},onPointerDown:R(e.onPointerDown,e=>{if(0===e.button){e.target.setPointerCapture(e.pointerId),y.current=h.getBoundingClientRect(),x.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",p.viewport&&(p.viewport.style.scrollBehavior="auto"),N(e)}}),onPointerMove:R(e.onPointerMove,N),onPointerUp:R(e.onPointerUp,e=>{const r=e.target;r.hasPointerCapture(e.pointerId)&&r.releasePointerCapture(e.pointerId),document.body.style.webkitUserSelect=x.current,p.viewport&&(p.viewport.style.scrollBehavior=""),y.current=null})})})}),Tt="ScrollAreaThumb",Ot=f.forwardRef((e,r)=>{const{forceMount:t,...n}=e,o=_t(Tt,e.__scopeScrollArea);return T.jsx(A,{present:t||o.hasThumb,children:T.jsx(At,{ref:r,...n})})}),At=f.forwardRef((e,r)=>{const{__scopeScrollArea:t,style:n,...o}=e,a=ft(Tt,t),s=_t(Tt,t),{onThumbPositionChange:i}=s,l=_(r,e=>s.onThumbChange(e)),c=f.useRef(),d=Ut(()=>{c.current&&(c.current(),c.current=void 0)},100);return f.useEffect(()=>{const e=a.viewport;if(e){const r=()=>{if(d(),!c.current){const r=qt(e,i);c.current=r,i()}};return i(),e.addEventListener("scroll",r),()=>e.removeEventListener("scroll",r)}},[a.viewport,d,i]),T.jsx(O.div,{"data-state":s.hasThumb?"visible":"hidden",...o,ref:l,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...n},onPointerDownCapture:R(e.onPointerDownCapture,e=>{const r=e.target.getBoundingClientRect(),t=e.clientX-r.left,n=e.clientY-r.top;s.onThumbPointerDown({x:t,y:n})}),onPointerUp:R(e.onPointerUp,s.onThumbPointerUp)})});Ot.displayName=Tt;var Rt="ScrollAreaCorner",Lt=f.forwardRef((e,r)=>{const t=ft(Rt,e.__scopeScrollArea),n=Boolean(t.scrollbarX&&t.scrollbarY);return"scroll"!==t.type&&n?T.jsx(Mt,{...e,ref:r}):null});Lt.displayName=Rt;var Mt=f.forwardRef((e,r)=>{const{__scopeScrollArea:t,...n}=e,o=ft(Rt,t),[a,s]=f.useState(0),[i,l]=f.useState(0),c=Boolean(a&&i);return Wt(o.scrollbarX,()=>{var e;const r=(null==(e=o.scrollbarX)?void 0:e.offsetHeight)||0;o.onCornerHeightChange(r),l(r)}),Wt(o.scrollbarY,()=>{var e;const r=(null==(e=o.scrollbarY)?void 0:e.offsetWidth)||0;o.onCornerWidthChange(r),s(r)}),c?T.jsx(O.div,{...n,ref:r,style:{width:a,height:i,position:"absolute",right:"ltr"===o.dir?0:void 0,left:"rtl"===o.dir?0:void 0,bottom:0,...e.style}}):null});function It(e){return e?parseInt(e,10):0}function Dt(e,r){const t=e/r;return isNaN(t)?0:t}function $t(e){const r=Dt(e.viewport,e.content),t=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,n=(e.scrollbar.size-t)*r;return Math.max(n,18)}function zt(e,r,t="ltr"){const n=$t(r),o=r.scrollbar.paddingStart+r.scrollbar.paddingEnd,a=r.scrollbar.size-o,s=r.content-r.viewport,i=a-n,l=I(e,"ltr"===t?[0,s]:[-1*s,0]);return Ft([0,s],[0,i])(l)}function Ft(e,r){return t=>{if(e[0]===e[1]||r[0]===r[1])return r[0];const n=(r[1]-r[0])/(e[1]-e[0]);return r[0]+n*(t-e[0])}}function Bt(e,r){return e>0&&e<r}var qt=(e,r=()=>{})=>{let t={left:e.scrollLeft,top:e.scrollTop},n=0;return function o(){const a={left:e.scrollLeft,top:e.scrollTop},s=t.left!==a.left,i=t.top!==a.top;(s||i)&&r(),t=a,n=window.requestAnimationFrame(o)}(),()=>window.cancelAnimationFrame(n)};function Ut(e,r){const t=L(e),n=f.useRef(0);return f.useEffect(()=>()=>window.clearTimeout(n.current),[]),f.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(t,r)},[t,r])}function Wt(e,r){const t=L(r);M(()=>{let r=0;if(e){const n=new ResizeObserver(()=>{cancelAnimationFrame(r),r=window.requestAnimationFrame(t)});return n.observe(e),()=>{window.cancelAnimationFrame(r),n.unobserve(e)}}},[e,t])}function Ht(e,r){const{asChild:t,children:n}=e;if(!t)return"function"==typeof r?r(n):r;const o=f.Children.only(n);return f.cloneElement(o,{children:"function"==typeof r?r(o.props.children):r})}var Vt=gt,Yt=yt,Gt=Lt;f.forwardRef(({className:e,children:r,...t},n)=>T.jsxs(Vt,{ref:n,className:D("relative overflow-hidden",e),...t,children:[T.jsx(Yt,{className:"h-full w-full rounded-[inherit]",children:r}),T.jsx(Xt,{}),T.jsx(Gt,{})]})).displayName=Vt.displayName;const Xt=f.forwardRef(({className:e,orientation:r="vertical",...t},n)=>T.jsx(vt,{ref:n,orientation:r,className:D("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...t,children:T.jsx(Ot,{className:"relative flex-1 rounded-full bg-border"})}));Xt.displayName=vt.displayName;const Kt=({score:e,label:r="Score",subLabel:t,size:n=120,strokeWidth:o=8,color:a="#3b82f6"})=>{const s=(n-o)/2,i=2*s*Math.PI,l=i-e/100*i;return T.jsxs("div",{className:"relative flex flex-col items-center justify-center",style:{width:n,height:n},children:[T.jsxs("svg",{width:n,height:n,className:"transform -rotate-90",children:[T.jsx("circle",{cx:n/2,cy:n/2,r:s,stroke:"currentColor",strokeWidth:o,fill:"transparent",className:"text-slate-100 dark:text-slate-800"}),T.jsx("circle",{cx:n/2,cy:n/2,r:s,stroke:a,strokeWidth:o,fill:"transparent",strokeDasharray:i,strokeDashoffset:l,strokeLinecap:"round",className:"transition-all duration-1000 ease-out"})]}),T.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-center",children:[T.jsxs("span",{className:"text-2xl font-bold",style:{color:a},children:[e,"%"]}),r&&T.jsx("span",{className:"text-xs text-slate-500 font-medium uppercase tracking-wider",children:r}),t&&T.jsx("span",{className:"text-[10px] text-slate-400",children:t})]})]})},Qt=({metrics:e,width:r=300,height:t=250})=>{const n=[{subject:"Pronunciation",A:e.pronunciation,fullMark:100},{subject:"Intonation",A:e.intonation,fullMark:100},{subject:"Stress",A:e.stress,fullMark:100},{subject:"Rhythm",A:e.rhythm,fullMark:100}];return T.jsx("div",{className:"w-full flex justify-center",children:T.jsx("div",{style:{width:"100%",height:t,maxWidth:r},children:T.jsx($,{width:"100%",height:"100%",children:T.jsxs(dt,{cx:"50%",cy:"50%",outerRadius:"70%",data:n,children:[T.jsx(ur,{stroke:"#e2e8f0"}),T.jsx(Gr,{dataKey:"subject",tick:{fill:"#64748b",fontSize:11,fontWeight:600}}),T.jsx(Lr,{angle:30,domain:[0,100],tick:!1,axisLine:!1}),T.jsx(ct,{name:"Metrics",dataKey:"A",stroke:"#3b82f6",strokeWidth:2,fill:"#3b82f6",fillOpacity:.2})]})})})})};f.createContext(null);f.forwardRef(({className:e,...r},t)=>T.jsxs(Ne,{ref:t,className:D("relative flex w-full touch-none select-none items-center",e),...r,children:[T.jsx(Pe,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:T.jsx(Ce,{className:"absolute h-full bg-primary"})}),T.jsx(_e,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})).displayName=Ne.displayName;const Zt=({active:e=!1,processing:r=!1,deviceId:t,barWidth:n=3,barGap:o=1,barRadius:a=1.5,barColor:s,fadeEdges:i=!0,fadeWidth:l=24,height:c=64,sensitivity:d=1,smoothingTimeConstant:u=.8,fftSize:m=256,historySize:p=60,updateRate:h=30,mode:g="static",onError:b,onStreamReady:y,onStreamEnd:x,className:v,...w})=>{const j=f.useRef(null),k=f.useRef(null),S=f.useRef([]),N=f.useRef(null),P=f.useRef(null),C=f.useRef(null),_=f.useRef(0),E=f.useRef(0),O=f.useRef(null),A=f.useRef([]),R=f.useRef(0),L=f.useRef([]),M=f.useRef(!0),I=f.useRef(null),$=f.useRef(0),z="number"==typeof c?`${c}px`:c;return f.useEffect(()=>{const e=j.current,r=k.current;if(!e||!r)return;const t=new ResizeObserver(()=>{const t=r.getBoundingClientRect(),n=window.devicePixelRatio||1;e.width=t.width*n,e.height=t.height*n,e.style.width=`${t.width}px`,e.style.height=`${t.height}px`;const o=e.getContext("2d");o&&o.scale(n,n),I.current=null,$.current=t.width,M.current=!0});return t.observe(r),()=>t.disconnect()},[]),f.useEffect(()=>{if(r&&!e){let e=0;R.current=0;const r=()=>{var t;e+=.03,R.current=Math.min(1,R.current+.02);const a=[],s=Math.floor(((null==(t=k.current)?void 0:t.getBoundingClientRect().width)||200)/(n+o));if("static"===g){const r=Math.floor(s/2);for(let t=0;t<s;t++){const n=(t-r)/r,o=1-.4*Math.abs(n),s=(.2+(.25*Math.sin(1.5*e+3*n)+.2*Math.sin(.8*e-2*n)+.15*Math.cos(2*e+n)))*o;let i=s;if(A.current.length>0&&R.current<1){const e=Math.min(t,A.current.length-1);i=(A.current[e]||0)*(1-R.current)+s*R.current}a.push(Math.max(.05,Math.min(1,i)))}}else for(let r=0;r<s;r++){const t=(r-s/2)/(s/2),n=1-.4*Math.abs(t),o=(.2+(.25*Math.sin(1.5*e+.15*r)+.2*Math.sin(.8*e-.1*r)+.15*Math.cos(2*e+.05*r)))*n;let i=o;if(A.current.length>0&&R.current<1){const e=Math.floor(r/s*A.current.length);i=(A.current[e]||0)*(1-R.current)+o*R.current}a.push(Math.max(.05,Math.min(1,i)))}"static"===g?L.current=a:S.current=a,M.current=!0,O.current=requestAnimationFrame(r)};return r(),()=>{O.current&&cancelAnimationFrame(O.current)}}if(!e&&!r){if("static"===g?L.current.length>0:S.current.length>0){let e=0;const r=()=>{e+=.03,e<1?("static"===g?L.current=L.current.map(r=>r*(1-e)):S.current=S.current.map(r=>r*(1-e)),M.current=!0,requestAnimationFrame(r)):"static"===g?L.current=[]:S.current=[]};r()}}},[r,e,n,o,g]),f.useEffect(()=>{if(!e)return C.current&&(C.current.getTracks().forEach(e=>e.stop()),C.current=null,null==x||x()),P.current&&"closed"!==P.current.state&&(P.current.close(),P.current=null),void(_.current&&(cancelAnimationFrame(_.current),_.current=0));return(async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:t?{deviceId:{exact:t},echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});C.current=e,null==y||y(e);const r=new(window.AudioContext||window.webkitAudioContext),n=r.createAnalyser();n.fftSize=m,n.smoothingTimeConstant=u;r.createMediaStreamSource(e).connect(n),P.current=r,N.current=n,S.current=[]}catch(e){null==b||b(e)}})(),()=>{C.current&&(C.current.getTracks().forEach(e=>e.stop()),C.current=null,null==x||x()),P.current&&"closed"!==P.current.state&&(P.current.close(),P.current=null),_.current&&(cancelAnimationFrame(_.current),_.current=0)}},[e,t,m,u,b,y,x]),f.useEffect(()=>{const t=j.current;if(!t)return;const c=t.getContext("2d");if(!c)return;let u;const m=f=>{const b=t.getBoundingClientRect();if(e&&f-E.current>h&&(E.current=f,N.current)){const e=new Uint8Array(N.current.frequencyBinCount);if(N.current.getByteFrequencyData(e),"static"===g){const r=Math.floor(.05*e.length),t=Math.floor(.4*e.length),a=e.slice(r,t),s=Math.floor(b.width/(n+o)),i=Math.floor(s/2),l=[];for(let e=i-1;e>=0;e--){const r=Math.floor(e/i*a.length),t=Math.min(1,a[r]/255*d);l.push(Math.max(.05,t))}for(let e=0;e<i;e++){const r=Math.floor(e/i*a.length),t=Math.min(1,a[r]/255*d);l.push(Math.max(.05,t))}L.current=l,A.current=l}else{let r=0;const t=Math.floor(.05*e.length),n=Math.floor(.4*e.length),o=e.slice(t,n);for(let e=0;e<o.length;e++)r+=o[e];const a=r/o.length/255*d;S.current.push(Math.min(1,Math.max(.05,a))),A.current=[...S.current],S.current.length>p&&S.current.shift()}M.current=!0}if(!M.current&&!e)return void(u=requestAnimationFrame(m));M.current=e,c.clearRect(0,0,b.width,b.height);const y=s||getComputedStyle(t).color||"#000",x=n+o,v=Math.floor(b.width/x),w=b.height/2;if("static"===g){const t=r||e||L.current.length>0?L.current:[];for(let e=0;e<v&&e<t.length;e++){const r=t[e]||.1,o=e*x,s=Math.max(4,r*b.height*.8),i=w-s/2;c.fillStyle=y,c.globalAlpha=.4+.6*r,a>0?(c.beginPath(),c.roundRect(o,i,n,s,a),c.fill()):c.fillRect(o,i,n,s)}}else for(let e=0;e<v&&e<S.current.length;e++){const r=S.current.length-1-e,t=S.current[r]||.1,o=b.width-(e+1)*x,s=Math.max(4,t*b.height*.8),i=w-s/2;c.fillStyle=y,c.globalAlpha=.4+.6*t,a>0?(c.beginPath(),c.roundRect(o,i,n,s,a),c.fill()):c.fillRect(o,i,n,s)}if(i&&l>0&&b.width>0){if(!I.current||$.current!==b.width){const e=c.createLinearGradient(0,0,b.width,0),r=Math.min(.3,l/b.width);e.addColorStop(0,"rgba(255,255,255,1)"),e.addColorStop(r,"rgba(255,255,255,0)"),e.addColorStop(1-r,"rgba(255,255,255,0)"),e.addColorStop(1,"rgba(255,255,255,1)"),I.current=e,$.current=b.width}c.globalCompositeOperation="destination-out",c.fillStyle=I.current,c.fillRect(0,0,b.width,b.height),c.globalCompositeOperation="source-over"}c.globalAlpha=1,u=requestAnimationFrame(m)};return u=requestAnimationFrame(m),()=>{u&&cancelAnimationFrame(u)}},[e,r,d,h,p,n,o,a,s,i,l,g]),T.jsxs("div",{className:D("relative h-full w-full",v),ref:k,style:{height:z},"aria-label":e?"Live audio waveform":r?"Processing audio":"Audio waveform idle",role:"img",...w,children:[!e&&!r&&T.jsx("div",{className:"border-muted-foreground/20 absolute top-1/2 right-0 left-0 -translate-y-1/2 border-t-2 border-dotted"}),T.jsx("canvas",{className:"block h-full w-full",ref:j,"aria-hidden":"true"})]})},Jt=()=>{var e,r,t,n,o;const a=z(),s=a.testId||a.testName,i=F(),{profile:l}=B(),{toast:c}=q(),d=U(),[u,m]=f.useState(null),[p,h]=f.useState([]),[g,b]=f.useState(1),[y,x]=f.useState(0),[v,w]=f.useState(!0),[j,k]=f.useState(!1),[S,N]=f.useState(!1),[P,C]=f.useState(!1),[_,E]=f.useState(null),[O,A]=f.useState(null),[R,L]=f.useState(0),[M,I]=f.useState(60),[D,$]=f.useState({}),[Ne,Pe]=f.useState("");f.useState(!1),f.useState("");const[Ce,_e]=f.useState(!1),[Te,He]=f.useState("en");f.useEffect(()=>{(async()=>{if(null==l?void 0:l.id)try{const{data:e}=await Oe.from("user_preferences").select("preferred_feedback_language, native_language").eq("user_id",l.id).maybeSingle(),r=e,t=(null==r?void 0:r.preferred_feedback_language)||(null==r?void 0:r.native_language);t&&Re.find(e=>e.value===t)&&He(t)}catch(e){console.warn("Error loading user preferred language:",e)}})()},[null==l?void 0:l.id]);const[Ve,Ye]=f.useState(!1),[Ge,Xe]=f.useState(!1),[Ke,Qe]=f.useState(!1),[Ze,Je]=f.useState(!1),[er,rr]=f.useState(!1),[tr,nr]=f.useState([{id:"1",type:"bot",content:"Hello! I'm Catie, your expert IELTS Speaking tutor. I'm here to guide you through strategic speaking techniques, structure, and vocabulary enhancement. What specific aspect of your speaking would you like to work on?",timestamp:new Date}]),[or,ar]=f.useState(""),[sr,ir]=f.useState(!1),[lr,cr]=f.useState(!1),[dr,ur]=f.useState(null),[mr,pr]=f.useState(!1),hr=f.useRef(null),fr=f.useRef(null),gr=f.useRef(null),br=f.useRef([]),yr=f.useRef(null),xr=f.useRef(null),vr=(()=>{try{const e="undefined"!=typeof window?window.localStorage.getItem("appAudioVolume"):null,r=(e?parseInt(e,10):100)/100;return Number.isFinite(r)?Math.min(1,Math.max(0,r)):1}catch{return 1}})(),wr=f.useRef(vr);f.useEffect(()=>(s?(jr(),nr([{id:"1",type:"bot",content:"Hello! I'm Catie, your expert IELTS Speaking tutor. I'm here to guide you through strategic speaking techniques, structure, and vocabulary enhancement. What specific aspect of your speaking would you like to work on?",timestamp:new Date}])):kr(),()=>{gr.current&&clearInterval(gr.current)}),[s]),f.useEffect(()=>(R>0?gr.current=setTimeout(()=>L(R-1),1e3):0===R&&j&&Nr(),()=>{gr.current&&clearTimeout(gr.current)}),[R,j]),f.useEffect(()=>{const e=e=>{var r;const t=null==(r=null==e?void 0:e.detail)?void 0:r.volume;"number"==typeof t&&(wr.current=t,fr.current&&(fr.current.volume=t))};return window.addEventListener("app:volume-change",e),()=>window.removeEventListener("app:volume-change",e)},[]),f.useEffect(()=>{tr.length>0&&setTimeout(()=>{const e=document.querySelector("[data-conversation-content]");e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},100)},[tr]),f.useEffect(()=>{Qe(!1),pr(!1)},[y,g]),f.useEffect(()=>{var e,r,t,n,o;if(u&&!v){let a=!0;if(1===g){const r=(null==(e=u.part1_prompts)?void 0:e.length)||0;(y>=r||y<0)&&(console.warn(" Invalid Part 1 state detected, resetting..."),a=!1)}else if(2===g){if(!u.part2_prompt)return console.warn(" Part 2 accessed but no Part 2 prompt available, going to Part 3 or completion..."),(null==(r=u.part3_prompts)?void 0:r.length)>0?(b(3),void x(0)):void _e(!0)}else if(3===g){const e=(null==(t=u.part3_prompts)?void 0:t.length)||0;(y>=e||y<0)&&(console.warn(" Invalid Part 3 state detected, resetting..."),a=!1)}a||((null==(n=u.part1_prompts)?void 0:n.length)>0?(b(1),x(0)):u.part2_prompt?(b(2),x(0)):(null==(o=u.part3_prompts)?void 0:o.length)>0?(b(3),x(0)):(console.error(" No valid test parts available"),i("/ielts-portal")))}},[u,g,y,v,i]),f.useEffect(()=>{if(yr.current){const e=yr.current;e.style.setProperty("transform","scale(1)","important"),e.style.setProperty("transition","none","important");const r=r=>{e.style.setProperty("transform","scale(1)","important"),e.style.setProperty("box-shadow","0 8px 32px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.1)","important"),e.style.setProperty("transition","none","important")};return e.addEventListener("mouseenter",r),e.addEventListener("mouseleave",r),()=>{e.removeEventListener("mouseenter",r),e.removeEventListener("mouseleave",r)}}},[u,g,y]);const jr=async()=>{if(s){w(!0);try{console.log(` Loading speaking test data for test ID: ${s}`);const e=s.includes("-")&&36===s.length,[r,t]=await Promise.all([e?Oe.from("tests").select("id, test_name").eq("id",s).single():Oe.from("tests").select("id, test_name").eq("test_name",s).eq("test_type","IELTS").eq("module","Speaking").maybeSingle(),Oe.from("speaking_prompts").select("*").eq("test_id",s).order("part_number",{ascending:!0})]);if(r.error)throw r.error;const n=r.data;if(!n)return c({title:"Test Not Found",description:"This speaking test doesn't exist. Please check the test ID.",variant:"destructive"}),void i(-1);console.log(" Test loaded:",n.test_name);let o=t.data||[];if(0===o.length&&n.id!==s){const{data:e}=await Oe.from("speaking_prompts").select("*").eq("test_id",n.id).order("part_number",{ascending:!0});o=e||[]}console.log(` Loaded ${o.length} total speaking prompts`);const a=[];let l=null;const d=[];o.forEach(e=>{1===e.part_number?a.push(e):2===e.part_number?l=e:3===e.part_number&&d.push(e)}),m({id:n.id,test_name:n.test_name,part1_prompts:a,part2_prompt:l,part3_prompts:d}),console.log(` Test ready: Part 1 (${a.length}), Part 2 (${l?1:0}), Part 3 (${d.length})`)}catch(e){console.error(" Error:",e),s&&m({id:s,test_name:"Speaking Test",part1_prompts:[],part2_prompt:null,part3_prompts:[]})}finally{w(!1)}}},kr=async()=>{w(!0);try{console.log(" Loading available speaking tests...");const{data:e,error:r}=await Oe.from("tests").select("id, test_name, module, skill_category, created_at, speaking_prompts!inner(id)").eq("test_type","IELTS").order("created_at",{ascending:!1}).limit(50);if(r)throw console.error(" Error loading tests:",r),r;const t=(e||[]).filter(e=>{const r=(e.test_name||"").trim();return r&&r.length>=2&&!r.toLowerCase().includes("quick test")&&!["test ?","another test?",""].includes(r.toLowerCase())});console.log(` Found ${t.length} valid speaking tests`),h(t)}catch(e){console.error(" Error loading tests:",e),c({title:"Error",description:"Failed to load available speaking tests",variant:"destructive"}),h([])}finally{w(!1)}},Sr=()=>{try{const e=new(window.AudioContext||window.webkitAudioContext),r=e.createOscillator(),t=e.createOscillator(),n=e.createGain();r.type="sine",r.frequency.value=523,t.type="sine",t.frequency.value=659,r.connect(n),t.connect(n),n.connect(e.destination),n.gain.setValueAtTime(1e-4,e.currentTime),n.gain.exponentialRampToValueAtTime(.05,e.currentTime+.01),r.start(),t.start(),setTimeout(()=>{n.gain.exponentialRampToValueAtTime(1e-5,e.currentTime+.15),setTimeout(()=>{r.stop(),t.stop(),e.close()},200)},120)}catch{}},Nr=()=>{if(2===g&&xr.current){const e=Math.floor((Date.now()-xr.current)/1e3),r=60;if(e<r){const t=r-e;return void c({title:"Minimum Recording Time Required",description:`For IELTS Part 2, you should speak for at least 1 minute to receive a good score. Please continue recording for ${t} more second${1!==t?"s":""}.`,variant:"destructive",duration:5e3})}}Sr(),hr.current&&j&&(hr.current.stop(),L(0),xr.current=null)},Pr=()=>{var e,r,t,n;try{if(console.log(` Navigation attempt: Part ${g}, Question ${y}`,{testDataExists:!!u,part1Prompts:(null==(e=null==u?void 0:u.part1_prompts)?void 0:e.length)||0,part2Prompt:!!(null==u?void 0:u.part2_prompt),part3Prompts:(null==(r=null==u?void 0:u.part3_prompts)?void 0:r.length)||0}),!u)return console.error(" Navigation failed: No test data available"),void c({title:"Navigation Error",description:"Test data not available. Please refresh the page.",variant:"destructive"});if(1===g){const e=(null==(t=u.part1_prompts)?void 0:t.length)||0;if(y<e-1){const e=y+1;x(e),Qe(!1),ur(null),pr(!1),console.log(` Moving to Part 1, Question ${e+1}`)}else{const e=!!u.part2_prompt,r=!!(u.part3_prompts&&u.part3_prompts.length>0);e||r?e?(b(2),x(0),I(60),Qe(!1),ur(null),pr(!1),console.log(" Moving to Part 2 - Long Turn"),Cr()):r&&(b(3),x(0),Qe(!1),ur(null),pr(!1),console.log(" Moving to Part 3 - Discussion (no Part 2 for this test)")):(console.log(" Part 1-only test completed - prompting for feedback language"),_e(!0))}}else if(2===g){u.part3_prompts&&u.part3_prompts.length>0?(b(3),x(0),Qe(!1),ur(null),pr(!1),console.log(" Moving to Part 3 - Discussion")):(console.log(" Part 2 completed - no Part 3 available, prompting for feedback language"),_e(!0))}else if(3===g){const e=(null==(n=u.part3_prompts)?void 0:n.length)||0;if(y<e-1){const e=y+1;x(e),Qe(!1),ur(null),pr(!1),console.log(` Moving to Part 3, Question ${e+1}`)}else console.log(" Last question completed - prompting for feedback language"),_e(!0)}}catch(o){console.error(" Navigation error:",o),c({title:"Navigation Error",description:"Failed to navigate. Please try again.",variant:"destructive"})}},Cr=()=>{const e=setInterval(()=>{I(r=>r<=1?(clearInterval(e),c({title:"Preparation Time Complete",description:"You may now start recording your response.",duration:5e3}),0):r-1)},1e3)},_r=e=>`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`;if(v)return T.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:"dark"===d.theme.name?d.theme.colors.background:"transparent"},children:T.jsx(W,{size:"lg",message:"Loading speaking tests..."})});if(!s)return T.jsxs("div",{className:"min-h-screen relative",style:{backgroundColor:"dark"===d.theme.name?d.theme.colors.background:"transparent"},children:[T.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"note"===d.theme.name||"minimalist"===d.theme.name||"dark"===d.theme.name?"none":"url('/1000031207.png')",backgroundColor:d.backgroundImageColor}}),T.jsx("div",{className:"relative z-10",children:T.jsx(H,{title:"Available Speaking Tests",children:T.jsx("div",{className:"min-h-screen py-12",children:T.jsx("div",{className:"container mx-auto px-4",children:T.jsxs("div",{className:"max-w-4xl mx-auto",children:[T.jsx("div",{className:"mb-8 text-center",children:T.jsx("h1",{className:"text-4xl font-bold mb-2",style:{color:d.textPrimary},children:"IELTS speaking tests"})}),p.length>0?T.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:p.map(e=>T.jsx(V,{className:"cursor-pointer h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg flex items-center justify-center",onClick:()=>i(`/ielts-speaking-test/${e.id}`),style:{backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.8)":"dark"===d.theme.name?"rgba(255,255,255,0.1)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground,borderColor:d.border,...d.cardStyle},children:T.jsx(Y,{className:"p-3 md:p-4 text-center flex items-center justify-center h-full",children:T.jsx("h3",{className:"font-semibold text-sm",style:{color:d.textPrimary},children:e.test_name})})},e.id))}):T.jsxs("div",{className:"text-center py-12",children:[T.jsx("p",{className:"text-lg mb-4",style:{color:d.textSecondary},children:"No speaking tests available yet"}),T.jsx(G,{onClick:()=>i("/ielts-portal"),variant:"outline",style:{borderColor:d.border,color:d.textPrimary,backgroundColor:"glassmorphism"===d.theme.name||"dark"===d.theme.name?"rgba(255,255,255,0.1)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground},onMouseEnter:e=>e.currentTarget.style.backgroundColor=d.hoverBg,onMouseLeave:e=>e.currentTarget.style.backgroundColor="glassmorphism"===d.theme.name||"dark"===d.theme.name?"rgba(255,255,255,0.1)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground,children:"Back to Portal"})]})]})})})})})]});if(!u)return T.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:T.jsxs("div",{className:"text-center",children:[T.jsx("p",{className:"text-lg text-muted-foreground",children:"Test not found"}),T.jsx(G,{onClick:()=>i("/ielts-portal"),className:"mt-4",children:"Back to Portal"})]})});if(0===u.part1_prompts.length&&!u.part2_prompt&&0===u.part3_prompts.length)return T.jsx(H,{title:`IELTS Speaking - ${u.test_name}`,showBackButton:!0,children:T.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[T.jsxs("div",{className:"text-center",children:[T.jsx(X,{variant:"outline",className:"mb-4 px-4 py-1 text-primary border-primary/20",children:"IELTS SPEAKING TEST"}),T.jsx("h1",{className:"text-heading-2 mb-2",children:u.test_name})]}),T.jsx(K,{className:"card-modern",children:T.jsxs(Y,{className:"p-8 text-center",children:[T.jsx(Q,{className:"w-16 h-16 mx-auto mb-4 text-gray-400 dark:text-gray-500"}),T.jsx("h2",{className:"text-xl font-semibold mb-2",children:"No Speaking Content Available"}),T.jsx("p",{className:"text-muted-foreground mb-6",children:"This test doesn't have speaking content created yet. Please contact your administrator or try another test."}),T.jsxs("div",{className:"flex gap-4 justify-center",children:[T.jsx(G,{onClick:()=>i("/ielts-portal"),variant:"outline",children:"Back to Portal"}),T.jsx(G,{onClick:()=>i("/speaking"),children:"Try General Speaking Practice"})]})]})})]})});const Er=()=>1===g?u.part1_prompts[y]:2===g?u.part2_prompt:3===g?u.part3_prompts[y]:null,Tr=()=>{const e=Er();return e?2===g?e.prompt_text||"":e.transcription||e.title||"":""},Or=async e=>{const r=e||or.trim();if(!r||sr)return;const t={id:Date.now().toString(),type:"user",content:r,timestamp:new Date};nr(e=>[...e,t]),e||ar(""),ir(!0);try{const e=Tr(),t=`CONTEXT: The student is practicing IELTS Speaking Part ${g}.\n\nQuestion: "${e}"\n\nPlease provide concise, practical speaking guidance (ideas, vocabulary, structure). Do NOT write a full answer.`,n=tr.filter(e=>"user"===e.type||"bot"===e.type).map(e=>({role:"user"===e.type?"user":"assistant",content:e.content}));n.push({role:"user",content:r});const{data:o,error:a}=await Oe.functions.invoke("openai-chat",{body:{skipCache:!0,messages:[{role:"system",content:t},...n],context:"catbot"}});if(a)throw a;const s={id:(Date.now()+1).toString(),type:"bot",content:o.response,timestamp:new Date};nr(e=>[...e,s])}catch(n){console.error("Error sending chat message:",n),c({title:"Error",description:"Failed to get response from Catie",variant:"destructive"})}finally{ir(!1)}},Ar=e=>{Or(e)},Rr=Er(),Lr=Tr(),Mr=1===g?"Part 1":2===g?"Part 2":3===g?"Part 3":"Unknown Part";return T.jsxs("div",{className:"min-h-screen relative",style:{backgroundColor:"dark"===d.theme.name?d.theme.colors.background:"transparent"},children:[T.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"note"===d.theme.name||"minimalist"===d.theme.name||"dark"===d.theme.name?"none":"url('/1000031207.png')",backgroundColor:d.backgroundImageColor}}),T.jsx("div",{className:"relative z-10 min-h-screen flex flex-col",style:{backgroundColor:"dark"===d.theme.name?d.theme.colors.background:"transparent"},children:T.jsx(H,{title:`IELTS Speaking - ${u.test_name}`,showBackButton:!0,children:T.jsx("div",{className:"flex-1 flex justify-center min-h-[calc(100vh-120px)] py-8 sm:items-center sm:py-8",children:T.jsxs("div",{className:"w-full max-w-4xl mx-auto space-y-4 px-4 flex flex-col",children:[T.jsx("div",{className:"text-center py-2 sm:py-2 sm:mb-0 mb-0",children:T.jsxs("span",{className:"text-lg font-semibold",style:{color:d.textPrimary},children:["Part ",g]})}),T.jsxs(K,{ref:yr,className:"backdrop-blur-sm shadow-lg rounded-2xl flex flex-col relative",style:{backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.9)":"dark"===d.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground,borderColor:d.border,backdropFilter:"glassmorphism"===d.theme.name?"blur(12px)":"dark"===d.theme.name?"blur(8px)":"none",boxShadow:"dark"===d.theme.name?"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)":"note"===d.theme.name?null==(e=d.theme.styles.cardStyle)?void 0:e.boxShadow:"0 8px 32px rgba(15, 23, 42, 0.16), 0 0 0 1px rgba(148, 163, 253, 0.06)",...d.cardStyle},children:[T.jsx(Z,{children:T.jsxs(J,{className:"flex items-center justify-between",children:[T.jsx("span",{}),T.jsxs("div",{className:"flex items-center gap-3",children:[(1===g||3===g)&&T.jsx(ee,{children:T.jsxs(re,{children:[T.jsx(te,{asChild:!0,children:T.jsx("div",{onClick:()=>Qe(!Ke),className:"relative inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background",style:{backgroundColor:Ke?d.buttonPrimary:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.2)":"dark"===d.theme.name?"rgba(255,255,255,0.1)":"minimalist"===d.theme.name?"#e5e7eb":d.border},"data-state":Ke?"checked":"unchecked",children:T.jsx("div",{className:"pointer-events-none flex h-5 w-5 rounded-full shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0 items-center justify-center",style:{backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.95)":"dark"===d.theme.name?"rgba(255,255,255,0.9)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground},"data-state":Ke?"checked":"unchecked",children:Ke?T.jsx(ne,{className:"w-3 h-3",style:{color:"white"}}):T.jsx(oe,{className:"w-3 h-3",style:{color:d.textSecondary}})})})}),T.jsx(ae,{children:T.jsx("p",{children:Ke?"Hide question":"Show question"})})]})}),R>0&&T.jsxs(X,{variant:"outline",className:"flex items-center gap-2",style:{borderColor:d.border,backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.1)":"dark"===d.theme.name?"rgba(255,255,255,0.05)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground,color:d.textPrimary},children:[T.jsx(se,{className:"w-4 h-4",style:{color:d.textPrimary}}),_r(R)]})]})]})}),T.jsxs(Y,{className:"space-y-4 flex flex-col relative",children:[2===g&&M>0&&T.jsx("div",{className:"text-center",children:T.jsxs("div",{className:"flex items-center justify-center gap-2",children:[T.jsx(se,{className:"w-5 h-5",style:{color:d.buttonPrimary}}),T.jsx("p",{className:"text-xl font-bold",style:{color:d.buttonPrimary},children:_r(M)})]})}),1===g&&u.part1_prompts.length>0&&T.jsx("div",{className:"space-y-6 relative flex flex-col min-h-[200px]",children:T.jsx("div",{className:"min-h-[200px] flex items-center justify-center flex-1",children:Ke&&T.jsx("div",{className:"text-lg font-medium text-center select-none",style:{color:d.textPrimary},children:Tr()})})}),3===g&&u.part3_prompts.length>0&&T.jsx("div",{className:"space-y-6 relative flex flex-col min-h-[200px]",children:T.jsx("div",{className:"min-h-[200px] flex items-center justify-center flex-1",children:Ke&&T.jsx("div",{className:"text-lg font-medium text-center select-none",style:{color:d.textPrimary},children:Tr()})})}),2===g&&Rr&&T.jsxs("div",{className:"p-6 rounded-lg",style:{backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.1)":"dark"===d.theme.name?"rgba(255,255,255,0.05)":"minimalist"===d.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:d.border,borderWidth:"1px",borderStyle:"solid"},children:[T.jsx("h3",{className:"font-semibold mb-3",style:{color:d.textPrimary},children:"Cue Card"}),T.jsx("div",{className:"whitespace-pre-wrap text-sm leading-relaxed",style:{color:d.textSecondary},children:Rr.prompt_text})]}),2===g&&T.jsxs(T.Fragment,{children:[M>0&&T.jsxs("div",{className:"relative rounded-lg p-4",style:{backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.1)":"dark"===d.theme.name?"rgba(255,255,255,0.05)":"minimalist"===d.theme.name?"#fef3c7":"#FEF9E7",borderColor:d.border,borderWidth:"1px",borderStyle:"solid"},children:[T.jsx(ee,{children:T.jsxs(re,{children:[T.jsx(te,{asChild:!0,children:T.jsx(G,{variant:"ghost",size:"icon",onClick:()=>{I(e=>e+60)},className:"absolute top-2 right-2 h-8 w-8",style:{color:d.buttonPrimary},children:T.jsx(ie,{className:"w-4 h-4"})})}),T.jsx(ae,{children:T.jsx("p",{children:"Add 1 minute for notes"})})]})}),T.jsx("textarea",{placeholder:"Write your preparation notes here...",value:Ne,onChange:e=>Pe(e.target.value),className:"w-full h-32 p-3 bg-transparent resize-none focus:outline-none",style:{color:d.textPrimary}}),T.jsx("style",{dangerouslySetInnerHTML:{__html:`\n                      textarea[placeholder="Write your preparation notes here..."]::placeholder {\n                        color: ${d.textSecondary};\n                      }\n                    `}})]}),(0===M||j)&&Ne&&T.jsxs("div",{className:"relative rounded-lg p-4",style:{backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.1)":"dark"===d.theme.name?"rgba(255,255,255,0.05)":"minimalist"===d.theme.name?"#fef3c7":"#FEF9E7",borderColor:d.border,borderWidth:"1px",borderStyle:"solid"},children:[!j&&T.jsx(ee,{children:T.jsxs(re,{children:[T.jsx(te,{asChild:!0,children:T.jsx(G,{variant:"ghost",size:"icon",onClick:()=>{I(60),Cr()},className:"absolute top-2 right-2 h-8 w-8 text-primary",children:T.jsx(ie,{className:"w-4 h-4"})})}),T.jsx(ae,{children:T.jsx("p",{children:"Add 1 minute for notes"})})]})}),T.jsx("div",{className:"p-3 text-sm whitespace-pre-wrap",style:{color:d.textPrimary},children:Ne})]})]}),(2===g&&0===M||2!==g)&&T.jsx("div",{className:"text-center min-h-[80px] flex items-center justify-center relative",children:j?T.jsxs(T.Fragment,{children:[T.jsx("div",{className:"absolute -top-5 left-1/2 -translate-x-1/2 w-[130px] sm:w-[180px]",children:T.jsx(Zt,{active:!0,height:55,barWidth:6,barGap:2,barRadius:3,mode:"static",fadeEdges:!1,barColor:"#2563eb",sensitivity:1.2,fftSize:256,historySize:60,updateRate:30})}),T.jsx(G,{onClick:Nr,variant:"outline",size:"icon",className:"rounded-xl h-8 w-8 absolute bottom-0 left-1/2 transform -translate-x-1/2",style:{borderColor:d.border,color:d.buttonPrimary,backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.9)":"dark"===d.theme.name?"rgba(255,255,255,0.15)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground||"#ffffff"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=d.hoverBg||"rgba(0,0,0,0.05)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===d.theme.name?"rgba(255,255,255,0.9)":"dark"===d.theme.name?"rgba(255,255,255,0.15)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground||"#ffffff"},children:T.jsx(le,{className:"w-4 h-4",style:{color:d.buttonPrimary||"#2563eb"}})})]}):T.jsx(ee,{children:T.jsxs("div",{className:"flex items-center justify-center gap-3",children:[T.jsxs(re,{children:[T.jsx(te,{asChild:!0,children:T.jsx(G,{onClick:async()=>{try{Sr(),await new Promise(e=>setTimeout(e,100));const e=await navigator.mediaDevices.getUserMedia({audio:!0});hr.current=new MediaRecorder(e),br.current=[],hr.current.ondataavailable=e=>{e.data.size>0&&br.current.push(e.data)},hr.current.onstop=()=>{const r=new Blob(br.current,{type:"audio/webm"}),t=`part${g}_q${y}`;console.log(` Saving recording for ${t}, blob size: ${r.size}`),$(e=>{const n={...e,[t]:r};return console.log(" Recordings updated:",Object.keys(n)),n}),k(!1),e.getTracks().forEach(e=>e.stop())},hr.current.start(),k(!0),xr.current=Date.now(),(1===g||3===g||2===g)&&L(120)}catch(e){console.error("Error starting recording:",e),c({title:"Recording Error",description:"Failed to start recording. Please check microphone permissions.",variant:"destructive"})}},variant:"outline",className:"rounded-xl shadow-sm h-12 w-12",size:"icon",style:{backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.8)":"dark"===d.theme.name?"rgba(255,255,255,0.1)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground,borderColor:d.border,color:d.textPrimary},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=d.hoverBg,e.currentTarget.style.color=d.buttonPrimary},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===d.theme.name?"rgba(255,255,255,0.8)":"dark"===d.theme.name?"rgba(255,255,255,0.1)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground,e.currentTarget.style.color=d.textPrimary},children:T.jsx(Q,{className:"w-5 h-5"})})}),T.jsx(ae,{children:T.jsx("p",{children:"Start recording your answer"})})]}),(null==Rr?void 0:Rr.audio_url)&&T.jsxs(re,{children:[T.jsx(te,{asChild:!0,children:T.jsx(G,{onClick:()=>{const e=Er();(null==e?void 0:e.audio_url)&&(console.log(` Repeating audio for Part ${g}`),(async e=>{var r;if(e){Ze||(Je(!0),rr(!1));try{N(!0),fr.current&&(fr.current.pause(),fr.current.currentTime=0,fr.current=null);const r=new Audio(e);r.preload="auto",r.volume=wr.current,r.onended=()=>{N(!1),console.log(" Audio playback completed"),fr.current=null},r.onerror=e=>{N(!1),console.error("Audio playback error:",e),fr.current=null,c({title:"Audio Error",description:"Failed to play audio prompt. The audio may be inaudible or unavailable.",variant:"destructive"})},r.onloadstart=()=>{console.log("Audio loading started")},r.oncanplay=()=>{console.log("Audio can play")},r.oncanplaythrough=()=>{console.log("Audio can play through")},fr.current=r,console.log(` Playing audio: ${e}`),r.load(),await new Promise(e=>setTimeout(e,100));const t=r.play();void 0!==t&&(await t,console.log("Audio started playing successfully"))}catch(t){console.error("Error playing audio:",t),N(!1),"NotAllowedError"===t.name||(null==(r=t.message)?void 0:r.includes("user didn't interact"))?(Ze||rr(!0),console.log("Autoplay blocked - user needs to interact first")):c({title:"Audio Error",description:"Failed to play audio prompt. The audio may be inaudible or unavailable. Please try again.",variant:"destructive"}),fr.current&&(fr.current=null)}}})(e.audio_url))},disabled:S,variant:"outline",size:"icon",className:"h-12 w-12 rounded-xl",style:{borderColor:d.border,color:d.buttonPrimary,backgroundColor:"transparent"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=d.hoverBg},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:S?T.jsx(ce,{className:"w-5 h-5"}):T.jsx(de,{className:"w-5 h-5"})})}),T.jsx(ae,{children:T.jsx("p",{children:S?"Pause question audio":"Play question audio"})})]}),D[`part${g}_q${y}`]&&T.jsxs(re,{children:[T.jsx(te,{asChild:!0,children:T.jsx(G,{onClick:()=>{pr(!mr),mr&&P&&(()=>{if(O)try{O.pause(),O.currentTime=0,console.log(" Stopped recording playback")}catch(e){console.error("Error stopping recording playback:",e)}C(!1),E(null),A(null)})()},variant:"outline",size:"icon",className:"h-12 w-12 rounded-xl",style:{borderColor:d.border,color:d.buttonPrimary,backgroundColor:mr?"dark"===d.theme.name?"rgba(59, 130, 246, 0.2)":"#eff6ff":"transparent"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=d.hoverBg},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=mr?"dark"===d.theme.name?"rgba(59, 130, 246, 0.2)":"#eff6ff":"transparent"},children:T.jsx(ue,{className:"w-5 h-5"})})}),T.jsx(ae,{children:T.jsx("p",{children:mr?"Hide audio player":"Listen to your recorded answer"})})]}),(console.log(" DEBUG: Checking evaluate button condition",{currentPart:g,currentQuestion:y,key:`part${g}_q${y}`,hasRecording:!!D[`part${g}_q${y}`],allRecordingKeys:Object.keys(D),recordingValue:D[`part${g}_q${y}`]}),null),D[`part${g}_q${y}`]&&T.jsxs(re,{children:[T.jsx(te,{asChild:!0,children:T.jsx(G,{onClick:async()=>{var e,r;const t=`part${g}_q${y}`,n=D[t];if(console.log(" EVALUATE: Current part:",g),console.log(" EVALUATE: Current question:",y),console.log(" EVALUATE: Recording key:",t),console.log(" EVALUATE: Recording exists:",!!n),console.log(" EVALUATE: Recording size:",null==n?void 0:n.size),console.log(" EVALUATE: All recording keys:",Object.keys(D)),!n)return console.error(" No recording found for",t),void c({title:"No Recording Found",description:"Please record your answer first before evaluating.",variant:"destructive"});cr(!0),ur(null);try{const e=await new Promise((e,r)=>{const t=new FileReader;t.onloadend=()=>{const r=t.result;e(r.split(",")[1])},t.onerror=()=>r(new Error("Failed to read audio file")),t.readAsDataURL(n)}),r=Tr();console.log(" Sending to Edge Function:",{audioLength:e.length,prompt:r,recordingKey:t});const{data:o,error:a}=await Oe.functions.invoke("ielts-speaking-evaluator",{body:{audio:e,prompt:r}});if(a){const e=a.message||"";if(e.includes("FunctionsFetchError")||e.includes("Failed to send a request"))throw new Error("AI evaluation service is currently unavailable. Please try again in a moment.");throw a}console.log(" Evaluation received:",o),ur(o)}catch(o){console.error("Evaluation error:",o);let t="Could not evaluate the recording. Please try again.";(null==(e=null==o?void 0:o.message)?void 0:e.includes("unavailable"))||(null==(r=null==o?void 0:o.message)?void 0:r.includes("FunctionsFetchError"))?t="AI evaluation service is temporarily unavailable. Please try again in a few moments.":(null==o?void 0:o.message)&&(t=o.message),c({title:"Evaluation Failed",description:t,variant:"destructive",duration:6e3})}finally{cr(!1)}},disabled:lr,variant:"outline",size:"icon",className:"h-12 w-12 rounded-xl relative",style:{borderColor:d.border,color:d.buttonPrimary,backgroundColor:lr?"dark"===d.theme.name?"rgba(59, 130, 246, 0.2)":"#eff6ff":"transparent"},onMouseEnter:e=>{lr||(e.currentTarget.style.backgroundColor=d.hoverBg)},onMouseLeave:e=>{lr||(e.currentTarget.style.backgroundColor="transparent")},children:lr?T.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-current border-t-transparent"}):T.jsx(me,{className:"w-5 h-5"})})}),T.jsx(ae,{children:T.jsx("p",{children:lr?"Evaluating your answer...":"Evaluate with AI"})})]})]})})}),mr&&D[`part${g}_q${y}`]&&!dr&&T.jsx("div",{className:"mt-4 p-4 rounded-xl border animate-in fade-in slide-in-from-top-4 duration-300",style:{borderColor:d.border,backgroundColor:"dark"===d.theme.name?"rgba(255,255,255,0.02)":"#ffffff"},children:T.jsxs("div",{className:"space-y-3",children:[T.jsxs("h4",{className:"font-medium flex items-center gap-2 text-sm uppercase tracking-wider opacity-80",style:{color:d.textPrimary},children:[T.jsx(ue,{className:"w-4 h-4"}),"Your Recorded Answer"]}),T.jsx("div",{className:"p-3 rounded-xl border",style:{borderColor:d.border,backgroundColor:"dark"===d.theme.name?"rgba(0,0,0,0.2)":"transparent"},children:T.jsx(Ee,{src:URL.createObjectURL(D[`part${g}_q${y}`]),style:{backgroundColor:"transparent",border:"none",boxShadow:"none"}})}),T.jsx("div",{className:"flex justify-end",children:T.jsx(G,{variant:"ghost",size:"sm",onClick:()=>pr(!1),className:"h-8 px-3 text-xs",style:{color:d.textSecondary},children:"Hide Player"})})]})}),lr&&T.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm animate-in fade-in duration-300",children:T.jsxs("div",{className:"flex flex-col items-center gap-4 p-8 rounded-2xl",style:{backgroundColor:"dark"===d.theme.name?"rgba(30, 41, 59, 0.95)":"rgba(255, 255, 255, 0.95)",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},children:[T.jsx(W,{size:"lg",message:""}),T.jsx("p",{className:"text-lg font-medium",style:{color:d.textPrimary},children:"Catie is evaluating your answer..."}),T.jsx("p",{className:"text-sm",style:{color:d.textSecondary},children:"This may take a few seconds"})]})}),dr&&T.jsxs("div",{className:"mt-8 p-6 rounded-2xl border animate-in fade-in slide-in-from-top-4 duration-500 max-w-3xl mx-auto text-left shadow-lg relative overflow-hidden",style:{borderColor:d.border,backgroundColor:d.theme.colors.cardBackground||"#ffffff",color:d.textPrimary},children:[T.jsxs("div",{className:"flex items-center justify-between mb-6 relative z-10",children:[T.jsxs("div",{className:"flex items-center gap-3",children:[T.jsxs("div",{className:"relative",children:[T.jsx("img",{src:"/1000031289.png",alt:"Catie AI",className:"w-14 h-14 rounded-full shadow-md object-cover ring-2 ring-offset-2",style:{ringColor:d.buttonPrimary}}),T.jsx("div",{className:"absolute -bottom-1 -right-1 w-5 h-5 rounded-full flex items-center justify-center shadow-sm border-2 border-white",style:{backgroundColor:d.buttonPrimary},children:T.jsx(me,{className:"w-2.5 h-2.5 text-white"})})]}),T.jsx("div",{children:T.jsx("h3",{className:"font-bold text-lg",style:{color:d.textPrimary},children:"Catie's Feedback"})})]}),T.jsx(G,{variant:"ghost",size:"sm",onClick:()=>ur(null),className:"h-8 w-8 p-0 opacity-60 hover:opacity-100",children:T.jsx(pe,{className:"w-4 h-4"})})]}),T.jsx("div",{className:"mb-6 space-y-4 relative z-10",children:T.jsxs("div",{className:"rounded-xl p-4 space-y-3 border",style:{backgroundColor:"dark"===d.theme.name?"rgba(255,255,255,0.02)":"#ffffff",borderColor:d.border},children:[T.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2 text-xs uppercase tracking-wider opacity-80",style:{color:d.textPrimary},children:[T.jsx(ue,{className:"w-3.5 h-3.5"}),"Your Response"]}),D[`part${g}_q${y}`]?T.jsx("div",{className:"p-2 rounded-xl border",style:{borderColor:d.border,backgroundColor:"dark"===d.theme.name?"rgba(0,0,0,0.2)":"transparent"},children:T.jsx(Ee,{src:URL.createObjectURL(D[`part${g}_q${y}`]),style:{backgroundColor:"transparent",border:"none",boxShadow:"none"}})}):T.jsxs("div",{className:"text-xs italic p-3 rounded-lg border flex items-center gap-2",style:{borderColor:d.border,color:d.textSecondary},children:[T.jsx(qe,{className:"w-4 h-4"}),"Audio recording not available"]}),T.jsx("div",{className:"mt-4",children:T.jsxs("div",{className:"rounded-xl p-4 border shadow-sm relative group",style:{backgroundColor:"dark"===d.theme.name?"rgba(0,0,0,0.2)":"#ffffff",borderColor:d.border},children:[T.jsx("div",{className:"absolute top-3 right-3 opacity-20 group-hover:opacity-50 transition-opacity",children:T.jsx(Ue,{className:"w-4 h-4"})}),T.jsxs("p",{className:"text-sm leading-relaxed italic",style:{color:d.textPrimary},children:['"',dr.transcription,'"']})]})})]})}),T.jsx("div",{className:"mb-8",children:T.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 items-center",children:[T.jsx("div",{className:"flex flex-col items-center justify-center p-4 rounded-2xl border",style:{backgroundColor:"dark"===d.theme.name?"rgba(255,255,255,0.03)":"minimalist"===d.theme.name?"#ffffff":"rgba(255,255,255,0.5)",borderColor:d.border},children:T.jsx(Kt,{score:Math.round(Object.values(dr.metrics||{}).reduce((e,r)=>e+r,0)/(Object.keys(dr.metrics||{}).length||1)),label:"Overall",subLabel:"Speaking Score",size:160,color:d.buttonPrimary})}),T.jsx("div",{className:"flex flex-col items-center justify-center p-2 rounded-2xl border h-[200px]",style:{backgroundColor:"dark"===d.theme.name?"rgba(255,255,255,0.03)":"minimalist"===d.theme.name?"#ffffff":"rgba(255,255,255,0.5)",borderColor:d.border},children:T.jsx(Qt,{metrics:{pronunciation:(null==(r=dr.metrics)?void 0:r.pronunciation)||0,intonation:(null==(t=dr.metrics)?void 0:t.intonation)||0,stress:(null==(n=dr.metrics)?void 0:n.stress)||0,rhythm:(null==(o=dr.metrics)?void 0:o.rhythm)||0},height:180})})]})}),T.jsx(Se,{className:"my-6",style:{backgroundColor:d.border}}),T.jsxs("div",{className:"space-y-2 mb-6",children:[T.jsxs("h3",{className:"font-semibold text-base flex items-center gap-2",style:{color:d.textPrimary},children:[T.jsx(he,{className:"w-4 h-4",style:{color:d.buttonPrimary}}),"Feedback"]}),T.jsx("p",{className:"text-sm leading-relaxed",style:{color:d.textSecondary},children:dr.feedback})]}),T.jsxs("div",{className:"p-4 rounded-xl space-y-2 mb-6 border-2",style:{backgroundColor:"dark"===d.theme.name?"rgba(255,255,255,0.05)":"glassmorphism"===d.theme.name?"rgba(255,255,255,0.7)":"minimalist"===d.theme.name?"#f0f9ff":"rgba(255,255,255,0.4)",borderColor:`${d.buttonPrimary}40`},children:[T.jsxs("h3",{className:"font-semibold flex items-center gap-2 text-xs uppercase tracking-wide",style:{color:d.buttonPrimary},children:[T.jsx(me,{className:"w-3 h-3"}),"Try saying it like this"]}),T.jsxs("p",{className:"text-base italic font-medium",style:{color:d.textPrimary},children:['"',dr.enhancedSentence,'"']})]}),T.jsx("div",{className:"rounded-xl border p-4 space-y-3 mb-6",style:{backgroundColor:"dark"===d.theme.name?"rgba(255,255,255,0.02)":"#ffffff",borderColor:d.border},children:T.jsx("div",{className:"space-y-4",children:T.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[T.jsxs("div",{className:"p-3 rounded-lg bg-amber-50/50 border border-amber-100",children:[T.jsx("h4",{className:"text-xs font-bold text-amber-700 uppercase tracking-wider mb-1",children:"Structure Tip"}),T.jsx("p",{className:"text-sm text-stone-600",children:1===g?"Expand your answers with 'Because... For example...'. Avoid short Yes/No responses.":2===g?"Ensure you cover all bullet points and tell a coherent story with a clear beginning, middle, and end.":"Develop your arguments fully. Use abstract ideas and general examples rather than personal stories."})]}),T.jsxs("div",{className:"p-3 rounded-lg bg-blue-50/50 border border-blue-100",children:[T.jsx("h4",{className:"text-xs font-bold text-blue-700 uppercase tracking-wider mb-1",children:"Quick Win"}),T.jsx("p",{className:"text-sm text-stone-600",children:'Try adding connectors like "Actually...", "To be honest...", or "I\'d say that..." to sound more natural and fluent.'})]})]})})})]}),Ce&&T.jsx("div",{className:"flex justify-center mt-4",children:T.jsxs("div",{className:"flex items-center gap-3",children:[T.jsxs(fe,{value:Te,onValueChange:He,children:[T.jsx(ge,{className:"w-[90px] h-8 text-sm border-0 bg-transparent shadow-none p-0 focus:ring-0",style:{color:d.textPrimary,"--tw-ring-color":d.buttonPrimary},children:T.jsx(be,{placeholder:"Language"})}),T.jsx(ye,{children:Re.map(e=>T.jsx(xe,{value:e.value,children:e.label},e.value))})]}),T.jsx(G,{type:"button",onClick:()=>{try{localStorage.setItem("ielts_speaking_feedback_language",Te||"en")}catch(e){console.warn("Unable to persist feedback language preference",e)}(async()=>{var e,r,t,n,o,a;try{const l=Object.entries(D);if(0===l.length)return void c({title:"No recordings found",description:"Please record answers before submitting.",variant:"destructive"});console.log(" Preparing speaking uploads:",{count:l.length,keys:l.map(([e])=>e)});const d=l.map(async([e,r],t)=>{var n,o,a,s,i,d,m,p,h,f,g,b,y,x,v,w;const j=(null==u?void 0:u.id)||"unknown",k=Date.now(),S=`speaking_${j}_${e}_${k}.webm`,N=new File([r],S,{type:"audio/webm"});try{console.log(` Uploading speaking recording [${t+1}/${l.length}]:`,{fileName:S,key:e,size:r.size});const c=await Ae.uploadSpeaking(N,j,e);if(!c.success)throw console.error(` R2 upload reported failure for ${S}:`,c.error),new Error(c.error||"Upload failed");c.url||console.warn(` R2 upload returned success but no URL for ${S}. Falling back to deterministic URL.`);const h=c.url||`https://placeholder-r2/${j}/speaking/${encodeURIComponent(e)}/${k}.webm`;console.log(` Speaking recording uploaded successfully: ${h}`);let f="";const g=e.match(/^part(\d+)_q(\d+)$/);if(g){const e=parseInt(g[1],10),r=parseInt(g[2],10);1===e&&(null==(n=null==u?void 0:u.part1_prompts)?void 0:n[r])?f=(null==(o=u.part1_prompts[r])?void 0:o.prompt_text)||(null==(a=u.part1_prompts[r])?void 0:a.transcription)||(null==(s=u.part1_prompts[r])?void 0:s.title)||"":2===e&&(null==u?void 0:u.part2_prompt)?f=u.part2_prompt.prompt_text||u.part2_prompt.transcription||u.part2_prompt.title||"":3===e&&(null==(i=null==u?void 0:u.part3_prompts)?void 0:i[r])&&(f=(null==(d=u.part3_prompts[r])?void 0:d.prompt_text)||(null==(m=u.part3_prompts[r])?void 0:m.transcription)||(null==(p=u.part3_prompts[r])?void 0:p.title)||"")}return{part:e,audio_url:h,question_text:f,upload_error:!1}}catch(P){const r=(null==P?void 0:P.message)||("string"==typeof P?P:"Unknown upload error");console.error(` Hard failure uploading ${S}:`,r),c({title:"Upload Warning",description:`We could not upload your recording for ${e}. We will still save your test and run analysis using available audio.`,variant:"destructive"});const t=`https://mock-r2-fallback.local/speaking/${encodeURIComponent(j)}/${encodeURIComponent(e)}/${k}.webm`;let n="";const o=e.match(/^part(\d+)_q(\d+)$/);if(o){const e=parseInt(o[1],10),r=parseInt(o[2],10);1===e&&(null==(h=null==u?void 0:u.part1_prompts)?void 0:h[r])?n=(null==(f=u.part1_prompts[r])?void 0:f.prompt_text)||(null==(g=u.part1_prompts[r])?void 0:g.transcription)||(null==(b=u.part1_prompts[r])?void 0:b.title)||"":2===e&&(null==u?void 0:u.part2_prompt)?n=u.part2_prompt.prompt_text||u.part2_prompt.transcription||u.part2_prompt.title||"":3===e&&(null==(y=null==u?void 0:u.part3_prompts)?void 0:y[r])&&(n=(null==(x=u.part3_prompts[r])?void 0:x.prompt_text)||(null==(v=u.part3_prompts[r])?void 0:v.transcription)||(null==(w=u.part3_prompts[r])?void 0:w.title)||"")}return{part:e,audio_url:t,question_text:n,upload_error:!0,error_message:r}}}),m=await Promise.all(d);if(!m||0===m.length)return console.error(" No speaking upload results returned"),void c({title:"Upload error",description:"We could not process your recordings. Please try again.",variant:"destructive"});const p=m.filter(e=>!e.upload_error).length,h=m.filter(e=>e.upload_error).length;console.log(" Speaking upload summary:",{total:m.length,successfulCount:p,failedCount:h});try{const{data:{user:s}}=await Oe.auth.getUser();if(!s)throw new Error("User not authenticated while submitting speaking test");const c=m.map(e=>e.audio_url),{data:d,error:f}=await Oe.from("test_results").insert({user_id:s.id,test_type:"speaking",total_questions:m.length,correct_answers:null,score_percentage:0,time_taken:900,audio_urls:c,audio_retention_expires_at:null,test_data:{recordings_count:m.length,parts_completed:[1,2,3],r2_upload_summary:{total:m.length,successful:p,failed:h},retention_policy:"no_auto_expiry_r2_persistent"}}).select().single();if(f||!d)throw f||new Error("Failed to create speaking test result");console.log(" Speaking test base records saved. AI scoring will be handled by backend using stored metadata and URLs.");const g=[];for(const i of m){const l=i.part.match(/^part(\d+)/),c=l?parseInt(l[1],10):NaN;if(isNaN(c)||c<1||c>3){console.error(`Invalid part number for recording: ${i.part}`);continue}let m="";if(1===c&&(null==(e=null==u?void 0:u.part1_prompts)?void 0:e.length)){const e=i.part.match(/_q(\d+)/),n=e?parseInt(e[1],10):0;n>=0&&n<u.part1_prompts.length&&(m=(null==(r=u.part1_prompts[n])?void 0:r.prompt_text)||(null==(t=u.part1_prompts[n])?void 0:t.transcription)||"")}else if(2===c&&(null==u?void 0:u.part2_prompt))m=u.part2_prompt.prompt_text||"";else if(3===c&&(null==(n=null==u?void 0:u.part3_prompts)?void 0:n.length)){const e=i.part.match(/_q(\d+)/),r=e?parseInt(e[1],10):0;r>=0&&r<u.part3_prompts.length&&(m=(null==(o=u.part3_prompts[r])?void 0:o.prompt_text)||(null==(a=u.part3_prompts[r])?void 0:a.transcription)||"")}g.push({user_id:s.id,test_result_id:d.id,part_number:c,question_text:m,audio_url:i.audio_url,transcription:"",band_scores:{},detailed_feedback:"",duration_seconds:120})}const{error:b}=await Oe.from("speaking_test_results").insert(g);if(b)throw b;console.log(" Speaking test base records saved. Running AI scoring..."),console.log(" Skipping inline AI scoring for speaking test; base records saved for backend evaluation."),$({}),i("/ielts-speaking-results",{state:{testData:u,recordings:m,audioBlobs:Object.fromEntries(l),testResultId:d.id}})}catch(s){console.error("Error saving or scoring speaking results:",s),c({title:"Save error",description:"Failed to save or score speaking results. Your recordings may not be fully processed.",variant:"destructive"})}}catch(l){console.error("Error submitting test:",l),c({title:"Submission Error",description:"Failed to submit test. Please try again.",variant:"destructive"})}})()},className:"font-medium",style:{backgroundColor:d.buttonPrimary,color:"#ffffff"},children:"Submit"})]})}),(1===g||3===g)&&!Ce&&T.jsx(ee,{children:T.jsxs(T.Fragment,{children:[T.jsxs(re,{children:[T.jsx(te,{asChild:!0,children:T.jsx(G,{variant:"ghost",onClick:()=>{console.log(" Previous question button clicked"),y>0&&(x(y-1),Qe(!1),ur(null),pr(!1))},disabled:0===y,size:"icon",className:"absolute bottom-0 left-0 h-12 w-12",style:{color:d.textSecondary},onMouseEnter:e=>{e.currentTarget.style.color=d.buttonPrimary,e.currentTarget.style.backgroundColor="transparent"},onMouseLeave:e=>{e.currentTarget.style.color=d.textSecondary,e.currentTarget.style.backgroundColor="transparent"},children:T.jsx(ve,{className:"w-5 h-5"})})}),T.jsx(ae,{children:T.jsx("p",{children:"Previous question"})})]}),T.jsxs(re,{children:[T.jsx(te,{asChild:!0,children:T.jsx(G,{variant:"ghost",onClick:()=>{console.log(" Next question button clicked"),Qe(!1),Pr()},disabled:!D[`part${g}_q${y}`],size:"icon",className:"absolute bottom-0 right-0 h-12 w-12",style:{color:d.textSecondary},onMouseEnter:e=>{e.currentTarget.style.color=d.buttonPrimary,e.currentTarget.style.backgroundColor="transparent"},onMouseLeave:e=>{e.currentTarget.style.color=d.textSecondary,e.currentTarget.style.backgroundColor="transparent"},children:T.jsx(we,{className:"w-5 h-5"})})}),T.jsx(ae,{children:T.jsx("p",{children:D[`part${g}_q${y}`]?y!==((null==u?void 0:u.part1_prompts.length)||0)-1||1!==g||(null==u?void 0:u.part2_prompt)||(null==u?void 0:u.part3_prompts)&&0!==u.part3_prompts.length?"Next question":"Complete test":"Please record your answer first"})})]})]})}),2===g&&!Ce&&T.jsx(ee,{children:T.jsxs(re,{children:[T.jsx(te,{asChild:!0,children:T.jsx(G,{variant:"ghost",onClick:()=>{console.log(" Part 2 navigation button clicked"),Pr()},disabled:!D[`part${g}_q${y}`],size:"icon",className:"absolute bottom-0 right-0 h-12 w-12 hover:bg-transparent hover:text-foreground",style:{color:d.textSecondary},onMouseEnter:e=>{e.currentTarget.style.color=d.buttonPrimary,e.currentTarget.style.backgroundColor="transparent"},onMouseLeave:e=>{e.currentTarget.style.color=d.textSecondary,e.currentTarget.style.backgroundColor="transparent"},children:T.jsx(we,{className:"w-5 h-5"})})}),T.jsx(ae,{children:T.jsx("p",{children:D[`part${g}_q${y}`]?(null==u?void 0:u.part3_prompts)&&u.part3_prompts.length>0?"Go to Part 3":"Complete test":"Please record your answer first"})})]})})]})]}),T.jsx("div",{className:"fixed bottom-6 left-6 z-40 flex items-center gap-4",children:T.jsx("button",{onClick:()=>i("/ielts-portal"),className:"text-lg cursor-pointer transition-colors",style:{color:d.textSecondary},onMouseEnter:e=>e.currentTarget.style.color=d.buttonPrimary,onMouseLeave:e=>e.currentTarget.style.color=d.textSecondary,children:"Exit Test"})}),Ve&&T.jsxs("div",{className:"fixed bottom-12 right-4 sm:bottom-20 sm:right-[420px] z-50 flex flex-col gap-2 sm:gap-3",children:[T.jsx(ee,{children:T.jsxs(re,{children:[T.jsx(te,{asChild:!0,children:T.jsx(G,{variant:"outline",size:"icon",onClick:()=>Ar("Help with Speaking Structure"),disabled:sr,className:"h-9 w-9 sm:h-12 sm:w-12 p-0 backdrop-blur-sm shadow-lg",style:{borderColor:d.border||"#e5e7eb",backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.9)":"dark"===d.theme.name?"rgba(255,255,255,0.15)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground||"#ffffff",color:d.buttonPrimary||"#2563eb"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=d.hoverBg||"rgba(0,0,0,0.05)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===d.theme.name?"rgba(255,255,255,0.9)":"dark"===d.theme.name?"rgba(255,255,255,0.15)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground||"#ffffff"},children:T.jsx(We,{className:"w-4 h-4 sm:w-6 sm:h-6",style:{color:d.buttonPrimary||"#2563eb"}})})}),T.jsx(ae,{side:"left",children:T.jsx("p",{children:"Get help with speaking structure"})})]})}),T.jsx(ee,{children:T.jsxs(re,{children:[T.jsx(te,{asChild:!0,children:T.jsx(G,{variant:"outline",size:"icon",onClick:()=>Ar("Suggest Some Speaking Vocabulary"),disabled:sr,className:"h-9 w-9 sm:h-12 sm:w-12 p-0 backdrop-blur-sm shadow-lg",style:{borderColor:d.border||"#e5e7eb",backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.9)":"dark"===d.theme.name?"rgba(255,255,255,0.15)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground||"#ffffff",color:d.buttonPrimary||"#2563eb"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=d.hoverBg||"rgba(0,0,0,0.05)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===d.theme.name?"rgba(255,255,255,0.9)":"dark"===d.theme.name?"rgba(255,255,255,0.15)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground||"#ffffff"},children:T.jsx(je,{className:"w-4 h-4 sm:w-6 sm:h-6",style:{color:d.buttonPrimary||"#2563eb"}})})}),T.jsx(ae,{side:"left",children:T.jsx("p",{children:"Get vocabulary suggestions"})})]})}),T.jsx(ee,{children:T.jsxs(re,{children:[T.jsx(te,{asChild:!0,children:T.jsx(G,{variant:"outline",size:"icon",onClick:()=>Ar("Give me 2-3 straightforward band 7+ example answers for this exact IELTS Speaking question. Just show the actual answers, no explanations."),disabled:sr,className:"h-9 w-9 sm:h-12 sm:w-12 p-0 backdrop-blur-sm shadow-lg",style:{borderColor:d.border||"#e5e7eb",backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.9)":"dark"===d.theme.name?"rgba(255,255,255,0.15)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground||"#ffffff",color:d.buttonPrimary||"#2563eb"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=d.hoverBg||"rgba(0,0,0,0.05)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===d.theme.name?"rgba(255,255,255,0.9)":"dark"===d.theme.name?"rgba(255,255,255,0.15)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground||"#ffffff"},children:T.jsx(me,{className:"w-4 h-4 sm:w-6 sm:h-6",style:{color:d.buttonPrimary||"#2563eb"}})})}),T.jsx(ae,{side:"left",children:T.jsx("p",{children:"View band 7+ example answers"})})]})}),T.jsx(ee,{children:T.jsxs(re,{children:[T.jsx(te,{asChild:!0,children:T.jsx(G,{variant:"outline",size:"icon",onClick:()=>Ar("Help me with grammar for this speaking question"),disabled:sr,className:"h-9 w-9 sm:h-12 sm:w-12 p-0 backdrop-blur-sm shadow-lg",style:{borderColor:d.border||"#e5e7eb",backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.9)":"dark"===d.theme.name?"rgba(255,255,255,0.15)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground||"#ffffff",color:d.buttonPrimary||"#2563eb"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=d.hoverBg||"rgba(0,0,0,0.05)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===d.theme.name?"rgba(255,255,255,0.9)":"dark"===d.theme.name?"rgba(255,255,255,0.15)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground||"#ffffff"},children:T.jsx(Ue,{className:"w-4 h-4 sm:w-6 sm:h-6",style:{color:d.buttonPrimary||"#2563eb"}})})}),T.jsx(ae,{side:"left",children:T.jsx("p",{children:"Get grammar help"})})]})})]}),T.jsxs("div",{className:"fixed bottom-6 right-3 sm:bottom-6 sm:right-6 z-50",children:[Ve&&T.jsxs(K,{className:"backdrop-blur-md rounded-3xl w-[260px] h-[360px] sm:w-96 sm:h-[500px] shadow-2xl flex flex-col transform-gpu origin-bottom-right transition-all duration-260 ease-in-out "+(Ge?"opacity-100 scale-100 translate-y-0":"opacity-0 scale-75 translate-y-8"),style:{backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.95)":"dark"===d.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground,borderColor:d.border,backdropFilter:"glassmorphism"===d.theme.name?"blur(12px)":"dark"===d.theme.name?"blur(8px)":"none",...d.cardStyle},children:[T.jsx(Z,{className:"pb-1 sm:pb-2 rounded-t-3xl relative",children:T.jsx("div",{className:"absolute top-1.5 right-1.5 sm:top-2 sm:right-2",children:T.jsx(G,{variant:"ghost",size:"icon",onClick:()=>{Xe(!1),setTimeout(()=>{Ye(!1)},260)},className:"h-7 w-7 sm:h-8 sm:w-8 p-0",style:{color:d.textPrimary},children:""})})}),T.jsxs(Y,{className:"flex-1 flex flex-col px-2.5 py-2 sm:p-4 overflow-hidden",children:[T.jsx(Le,{className:"flex-1 min-h-0",children:T.jsx(Me,{className:"flex-1 min-h-0",children:0!==tr.length||sr?T.jsxs(T.Fragment,{children:[T.jsxs("div",{className:"rounded-lg p-3 mb-4",style:{backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.1)":"dark"===d.theme.name?"rgba(255,255,255,0.05)":"minimalist"===d.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:d.border,borderWidth:"1px",borderStyle:"solid"},children:[T.jsx("div",{className:"text-xs uppercase tracking-wide mb-1",style:{color:d.textSecondary},children:"Question"}),T.jsx("div",{className:"text-xs sm:text-sm font-medium",style:{color:d.textPrimary},children:Mr}),T.jsx("div",{className:"text-[10px] sm:text-sm whitespace-pre-wrap mt-1",style:{color:d.textSecondary},children:Lr||"No question available."})]}),tr.map(e=>T.jsxs($e,{from:"user"===e.type?"user":"assistant",children:["bot"===e.type&&T.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"52px",height:"52px",flexShrink:0},children:T.jsx("img",{src:"/1000031289.png",alt:"Catie",style:{width:"100%",height:"100%",objectFit:"cover"}})}),T.jsx(ze,{children:T.jsx("div",{className:"px-3 py-2 rounded-xl text-sm",style:{backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.1)":"dark"===d.theme.name?"rgba(255,255,255,0.05)":"minimalist"===d.theme.name?"#f9fafb":"rgba(255,255,255,0.5)",borderColor:d.border,borderWidth:"1px",borderStyle:"solid",color:d.textPrimary},children:T.jsx(Fe,{dangerouslySetInnerHTML:{__html:e.content.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/^ (.*)$/gm,"<li>$1</li>").replace(/(<li>.*<\/li>)/s,"<ul>$1</ul>").replace(/\n/g,"<br>")}})})}),"user"===e.type&&(null==l?void 0:l.avatar_url)&&T.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"52px",height:"52px",flexShrink:0},children:T.jsx("img",{src:l.avatar_url,alt:"Your avatar",style:{width:"100%",height:"100%",objectFit:"cover"}})})]},e.id)),sr&&T.jsxs($e,{from:"assistant",children:[T.jsx(ze,{children:T.jsx("div",{className:"px-3 py-2 rounded-xl text-sm",style:{backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.1)":"dark"===d.theme.name?"rgba(255,255,255,0.05)":"minimalist"===d.theme.name?"#f9fafb":"rgba(255,255,255,0.5)",borderColor:d.border,borderWidth:"1px",borderStyle:"solid"},children:T.jsx(Be,{text:"Thinking..."})})}),T.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"52px",height:"52px"},children:T.jsx("img",{src:"/1000031289.png",alt:"Catie",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})]}):T.jsx(Ie,{icon:T.jsx(De,{className:"size-9 sm:size-12",style:{color:d.textSecondary}}),title:"Start a conversation",description:"Ask for help with your IELTS speaking practice"})})}),T.jsx("div",{className:"flex-shrink-0 mt-2.5 sm:mt-4",children:T.jsxs("div",{className:"flex gap-1.5 sm:gap-2",children:[T.jsx("input",{type:"text",value:or,onChange:e=>ar(e.target.value),onKeyPress:e=>"Enter"===e.key&&!sr&&or.trim()&&Or(),placeholder:"Ask for speaking help...",className:"flex-1 px-2.5 py-1.5 sm:px-3 sm:py-2 rounded-lg text-[10px] sm:text-sm focus:outline-none focus:ring-0 resize-none",style:{backgroundColor:"glassmorphism"===d.theme.name?"rgba(255,255,255,0.1)":"dark"===d.theme.name?"rgba(255,255,255,0.05)":"minimalist"===d.theme.name?"#ffffff":d.theme.colors.cardBackground,borderColor:d.border,borderWidth:"1px",borderStyle:"solid",color:d.textPrimary},disabled:sr}),T.jsx("style",{dangerouslySetInnerHTML:{__html:`\n                      input[placeholder="Ask for speaking help..."]::placeholder {\n                        color: ${d.textSecondary};\n                      }\n                    `}}),T.jsx(G,{onClick:()=>Or(),disabled:sr||!or.trim(),variant:"ghost",size:"icon",className:"h-7 w-7 sm:h-8 sm:w-8 p-0",style:{color:d.textPrimary},children:sr?T.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2",style:{borderColor:d.textPrimary}}):T.jsx(ke,{className:"w-4 h-4"})})]})})]})]}),!Ve&&T.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"64px",height:"64px",cursor:"pointer",boxShadow:"0 8px 20px rgba(0,0,0,0.18)",transition:"transform 0.22s ease-out, box-shadow 0.22s ease-out"},onClick:()=>{Ye(!0),requestAnimationFrame(()=>Xe(!0))},onMouseEnter:e=>{const r=e.currentTarget;r.style.transform="scale(1.06) translateY(-2px)",r.style.boxShadow="0 14px 30px rgba(0,0,0,0.24)"},onMouseLeave:e=>{const r=e.currentTarget;r.style.transform="scale(1.0) translateY(0px)",r.style.boxShadow="0 10px 25px rgba(0,0,0,0.15)"},children:T.jsx("img",{src:"/1000031289.png",alt:"Catie",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})]})})})})]})};export{Jt as default};
