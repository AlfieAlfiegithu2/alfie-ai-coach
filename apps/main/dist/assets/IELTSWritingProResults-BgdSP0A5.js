import{j as e,r as s,d as a,u as t}from"./vendor-react-rLLBBC7n.js";import{E as r,d as n,C as o,a as l,B as i,s as c,b as d,c as u,e as m,q as p,M as g,S as h,i as v,j as b,k as f,l as x,z as k}from"./index-KxDfHqNJ.js";import{P as _}from"./PenguinClapAnimation-B3JITAnC.js";import{R as y,B as j,X as w,Y as N,b as C,e as S,f as T}from"./vendor-charts-0DeywwxG.js";import{y as E,av as A,aN as $,b8 as I,az as L,ah as M}from"./vendor-ui-BGi_EvHx.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";function B({task1Scores:s,task2Scores:a,className:t=""}){const r=(()=>{const e=s||{},t=a||{},r=void 0!==e.task_achievement||void 0!==e.coherence_and_cohesion,n=void 0!==t.task_response||void 0!==t.coherence_and_cohesion;let o,l,i,c;return o=r&&n?((e.task_achievement||0)+(t.task_response||0))/2:r?e.task_achievement||0:n&&t.task_response||0,l=r&&n?((e.coherence_and_cohesion||0)+(t.coherence_and_cohesion||0))/2:r?e.coherence_and_cohesion||0:n&&t.coherence_and_cohesion||0,i=r&&n?((e.lexical_resource||0)+(t.lexical_resource||0))/2:r?e.lexical_resource||0:n&&t.lexical_resource||0,c=r&&n?((e.grammatical_range_and_accuracy||0)+(t.grammatical_range_and_accuracy||0))/2:r?e.grammatical_range_and_accuracy||0:n&&t.grammatical_range_and_accuracy||0,[{criterion:"TA",score:Math.round(2*o)/2,fullName:"Task Achievement"},{criterion:"CC",score:Math.round(2*l)/2,fullName:"Coherence & Cohesion"},{criterion:"LR",score:Math.round(2*i)/2,fullName:"Lexical Resource"},{criterion:"GRA",score:Math.round(2*c)/2,fullName:"Grammar & Accuracy"}]})();if(!r.some(e=>e.score>0))return e.jsx("div",{className:`flex items-center justify-center rounded-lg ${t}`,children:e.jsxs("div",{className:"text-center p-4",children:[e.jsx("div",{className:"text-text-secondary text-sm",children:"Criteria analysis"}),e.jsx("div",{className:"text-text-muted text-xs mt-1",children:"Not available"})]})});const n=e=>{const s=["hsl(var(--brand-blue))","hsl(var(--brand-green))","hsl(var(--brand-purple))","hsl(var(--brand-orange))"];return s[e%s.length]};return e.jsxs("div",{className:`p-4 ${t}`,children:[e.jsx("div",{className:"text-center mb-4",children:e.jsx("div",{className:"text-sm font-medium text-text-primary mb-1",children:"Criteria Analysis"})}),e.jsx(y,{width:"100%",height:200,children:e.jsxs(j,{data:r,margin:{top:30,right:10,left:10,bottom:10},barCategoryGap:"20%",children:[e.jsx(w,{dataKey:"criterion",axisLine:!1,tickLine:!1,tick:{fontSize:12,fontWeight:500,fill:"hsl(var(--text-primary))"}}),e.jsx(N,{domain:[0,9],axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"hsl(var(--text-muted))"},tickCount:5}),e.jsxs(C,{dataKey:"score",radius:[4,4,0,0],animationBegin:0,animationDuration:1200,animationEasing:"ease-out",children:[r.map((s,a)=>e.jsx(S,{fill:n(a)},`cell-${a}`)),e.jsx(T,{dataKey:"score",position:"top",style:{fill:"hsl(var(--text-primary))",fontSize:"12px",fontWeight:"bold"}})]})]})})]})}const P=({improvementSpans:a,title:t="Useful Vocabulary",currentTheme:d})=>{var u,m,p;const{user:g}=r(),{toast:h}=n(),[v,b]=s.useState(!1),[f,x]=s.useState(new Set),[k,_]=s.useState("en");s.useEffect(()=>{(async()=>{if(g)try{const{data:e}=await c.from("profiles").select("native_language").eq("id",g.id).single();if(null==e?void 0:e.native_language){const s=e.native_language.length>2?e.native_language.substring(0,2).toLowerCase():e.native_language.toLowerCase();console.log("üë§ User language from profile:",e.native_language,"‚Üí normalized:",s),_(s)}const{data:s}=await c.from("user_preferences").select("preferred_feedback_language").eq("user_id",g.id).maybeSingle();if(null==s?void 0:s.preferred_feedback_language){const e=s.preferred_feedback_language.length>2?s.preferred_feedback_language.substring(0,2).toLowerCase():s.preferred_feedback_language.toLowerCase();console.log("üë§ User language from preferences:",s.preferred_feedback_language,"‚Üí normalized:",e),_(e)}}catch(e){console.warn("Error loading user language:",e)}})()},[g]);const y=s.useMemo(()=>{const e=new Set;return a.forEach(s=>{if("improvement"===s.status){s.text.toLowerCase().replace(/[^\w\s'-]/g," ").split(/\s+/).filter(e=>{const s=e.trim();return s.length>=3&&!/^\d+$/.test(s)&&!/^[^a-z]*$/.test(s)&&!["the","and","but","for","are","but","not","you","all","can","had","her","was","one","our","out","day","get","has","him","his","how","its","may","new","now","old","see","two","way","who","boy","did","has","let","put","say","she","too","use"].includes(s.toLowerCase())}).forEach(s=>e.add(s.trim()))}}),Array.from(e).slice(0,10)},[a]),[j,w]=s.useState({}),[N,C]=s.useState({});s.useEffect(()=>{(async()=>{var e,s;if(0===y.length||!k||"en"===k){const e={};return y.forEach(s=>{e[s]=s}),void w(e)}const a={},t=[];if(y.forEach(e=>{const s=`${e}_${k}`;N[s]?a[e]=N[s]:t.push(e)}),0!==t.length){b(!0);try{const o={};console.log("üîç Checking vocab_translations + vocab_cards join for language:",k);const{data:l,error:i}=await c.from("vocab_translations").select("\n            translations,\n            lang,\n            vocab_cards!inner(term)\n          ").eq("lang",k).in("vocab_cards.term",y);i?console.error("‚ùå Error querying joined vocab tables:",i):(console.log("üìñ Found",(null==l?void 0:l.length)||0,"joined translation entries"),null==l||l.forEach(e=>{var s;if((null==(s=e.vocab_cards)?void 0:s.term)&&e.translations&&Array.isArray(e.translations)&&e.translations.length>0){const s=e.vocab_cards.term,a=e.translations[0];o[s.toLowerCase()]=a,console.log(`üìñ vocab_translations join: "${s}" ‚Üí "${a}"`)}})),console.log("üîç Checking vocab_cards for",y.length,"words:",y);const{data:d,error:u}=await c.from("vocab_cards").select("term, translation").in("term",y);if(u?console.error("‚ùå Error querying vocab_cards:",u):(console.log("üìö Found",(null==d?void 0:d.length)||0,"translations in vocab_cards"),console.log("üìö Card data sample:",null==d?void 0:d.slice(0,3))),null==d||d.forEach(e=>{e.term&&e.translation&&(o[e.term.toLowerCase()]||(o[e.term.toLowerCase()]=e.translation,console.log(`üìö vocab_cards: "${e.term}" ‚Üí "${e.translation}"`)))}),i||!l||0===l.length){console.log("üîÑ Fallback: querying vocab_translations separately");const{data:e,error:s}=await c.from("vocab_translations").select("card_id, translations").eq("lang",k);if(!s&&e&&e.length>0){const s=e.map(e=>e.card_id).filter(Boolean),{data:a}=await c.from("vocab_cards").select("id, term").in("id",s).in("term",y),t={};null==a||a.forEach(e=>{t[e.term.toLowerCase()]=e.id}),e.forEach(e=>{const s=Object.keys(t).find(s=>t[s]===e.card_id);s&&e.translations&&Array.isArray(e.translations)&&e.translations.length>0&&(o[s]||(o[s]=e.translations[0],console.log(`üìñ vocab_translations fallback: "${s}" ‚Üí "${e.translations[0]}"`)))})}}const m=t.filter(e=>!o[e.toLowerCase()]);if(m.length>0&&k&&"en"!==k){console.log("üåê Translating",m.length,"words to",k,"- Words:",m);try{console.log("üåê Attempting batch translation...");const{data:a,error:t}=await c.functions.invoke("translation-service",{body:{texts:m,sourceLang:"en",targetLang:k,bypassCache:!1}});console.log("üåê Batch translation response:",{success:null==a?void 0:a.success,error:t,resultsCount:null==(e=null==a?void 0:a.results)?void 0:e.length});let n=!1;if(!t&&(null==a?void 0:a.success)&&(null==a?void 0:a.results)){const e=a.results.filter((e,s)=>{const a=m[s];return e&&e.translation&&e.translation!==a});e.length>0?(console.log("‚úÖ Batch translation successful for",e.length,"words"),n=!0,a.results.forEach((e,s)=>{const a=m[s];if(e&&e.translation){const s=e.translation;o[a.toLowerCase()]=s;const t=`${a}_${k}`;C(e=>({...e,[t]:s})),console.log(`‚úÖ Batch: "${a}" ‚Üí "${s}"`)}else o[a.toLowerCase()]=a,console.log(`‚ö†Ô∏è Batch fallback: "${a}" ‚Üí "${a}"`)})):console.warn("‚ö†Ô∏è Batch translation returned no valid translations")}if(!n){console.log("üîÑ Falling back to individual translations...");for(const e of m){try{console.log(`üåê Translating individual word: "${e}"`);const{data:a,error:t}=await c.functions.invoke("translation-service",{body:{text:e,sourceLang:"en",targetLang:k,bypassCache:!1}});if(!t&&(null==a?void 0:a.success)&&(null==(s=null==a?void 0:a.result)?void 0:s.translation)){const s=a.result.translation;o[e.toLowerCase()]=s;const t=`${e}_${k}`;C(e=>({...e,[t]:s})),console.log(`‚úÖ Individual: "${e}" ‚Üí "${s}"`)}else console.warn(`‚ö†Ô∏è Individual translation failed for "${e}":`,t,a),o[e.toLowerCase()]=e}catch(r){console.error(`‚ùå Individual translation error for "${e}":`,r),o[e.toLowerCase()]=e}await new Promise(e=>setTimeout(e,100))}}}catch(n){console.error("‚ùå Translation service error:",n),m.forEach(e=>{o[e.toLowerCase()]=e})}}else m.length>0&&(console.log("üåê Using English fallback for",m.length,"words"),m.forEach(e=>{o[e.toLowerCase()]=e}));const p={};y.forEach(e=>{const s=o[e.toLowerCase()]||a[e]||e;p[e]=s,console.log(`üéØ Final: "${e}" ‚Üí "${s}"`)}),console.log("üéØ Final translations summary:",{totalWords:y.length,translatedFromDB:Object.keys(o).length,cached:Object.keys(a).length,finalTranslations:p}),w(p)}catch(o){console.error("Error getting translations:",o);const e={};y.forEach(s=>{e[s]=s}),w(e)}finally{b(!1)}}else w({...a})})()},[y,k]);return 0===y.length?null:e.jsx(o,{className:"rounded-3xl shadow-sm",style:{backgroundColor:(null==(u=null==d?void 0:d.colors)?void 0:u.cardBackground)||"#ffffff",borderColor:(null==(m=null==d?void 0:d.colors)?void 0:m.cardBorder)||"#e5e7eb",...null==(p=null==d?void 0:d.styles)?void 0:p.cardStyle},children:e.jsx(l,{className:"p-0",children:v?e.jsx("div",{className:"p-6 text-sm text-muted-foreground",children:"Loading translations‚Ä¶"}):0===y.length?e.jsx("div",{className:"p-6 text-sm text-muted-foreground",children:"No vocabulary found."}):e.jsx("div",{className:"divide-y",children:y.map(s=>{var a,t,r,n;const o=j[s]||s,l=f.has(s);return e.jsxs("div",{className:"p-4 flex items-center justify-between transition-colors cursor-pointer group",style:{backgroundColor:"transparent"},onMouseEnter:e=>{var s;e.currentTarget.style.backgroundColor=(null==(s=null==d?void 0:d.colors)?void 0:s.hoverBackground)||"rgba(0,0,0,0.05)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium transition-colors",style:{color:(null==(a=null==d?void 0:d.colors)?void 0:a.textPrimary)||"#111827"},onMouseEnter:e=>{var s;e.currentTarget.style.color=(null==(s=null==d?void 0:d.colors)?void 0:s.buttonPrimary)||"#3b82f6"},onMouseLeave:e=>{var s;e.currentTarget.style.color=(null==(s=null==d?void 0:d.colors)?void 0:s.textPrimary)||"#111827"},children:s}),e.jsx("div",{className:"text-sm font-medium",style:{color:(null==(t=null==d?void 0:d.colors)?void 0:t.textSecondary)||"#6b7280"},children:o}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1 opacity-0 group-hover:opacity-100 transition-opacity",children:"Click to add to your vocabulary book"})]}),e.jsx(i,{size:"sm",variant:"outline",onClick:()=>(async e=>{var s;if(g){x(s=>new Set(s).add(e));try{const a=j[e]||e,{data:t,error:r}=await c.functions.invoke("add-to-word-book",{body:{word:e,translation:a,part_of_speech:"noun"}});if(r){if(!(null==(s=r.message)?void 0:s.includes("already_exists")))throw r;h({title:"Word already added",description:`"${e}" is already in your vocabulary book.`})}else h({title:"Word added!",description:`"${e}" has been added to your vocabulary book.`})}catch(a){console.error("Error adding word to book:",a),h({title:"Error",description:"Failed to add word to your vocabulary book. Please try again.",variant:"destructive"})}finally{x(s=>{const a=new Set(s);return a.delete(e),a})}}else h({title:"Authentication required",description:"Please sign in to add words to your vocabulary book.",variant:"destructive"})})(s),disabled:l,style:{borderColor:(null==(r=null==d?void 0:d.colors)?void 0:r.border)||"#e5e7eb",color:(null==(n=null==d?void 0:d.colors)?void 0:n.textPrimary)||"#111827"},onMouseEnter:e=>{var s,a;e.currentTarget.style.backgroundColor=(null==(s=null==d?void 0:d.colors)?void 0:s.hoverBackground)||"rgba(0,0,0,0.05)",e.currentTarget.style.borderColor=(null==(a=null==d?void 0:d.colors)?void 0:a.buttonPrimary)||"#3b82f6"},onMouseLeave:e=>{var s;e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.borderColor=(null==(s=null==d?void 0:d.colors)?void 0:s.border)||"#e5e7eb"},children:l?e.jsx(E,{className:"w-3 h-3 animate-spin"}):e.jsx(A,{className:"w-3 h-3"})})]},s)})})})})},D=(e,s)=>"original"===s?"error"===e?"bg-destructive/10 text-destructive border-b-2 border-destructive/50":"text-text-primary":"improvement"===e?"bg-brand-green/10 text-brand-green border-b-2 border-brand-green/50":"text-text-primary",q=new Set(["the","a","an","and","or","but","if","then","so","because","as","of","to","in","on","at","by","for","with","about","into","over","after","before","from","is","are","was","were","be","been","being","it","its","this","that","these","those","their","there","here","also","very","much","more","most","many","few","some","any","than","both","either","neither","not","no","do","does","did","can","could","should","would","may","might","will","shall","i","you","he","she","we","they","one","two","three"]),R=e=>{const s=e.toLowerCase().replace(/[^a-z'-]/g,"");return!!s&&(!q.has(s)&&s.length>=4)},W=(e,s)=>{const a=e=>("improvement"===e.status||"error"===e.status)&&e.text.trim().split(/\s+/).length>=4,t=[];for(const r of e){if(!a(r)){t.push(r);continue}const e=r.text.split(/(\b[^\s]+\b)/g).filter(e=>e.length>0);for(const s of e){/\b[^\s]+\b/.test(s)&&R(s)?t.push({text:s,status:r.status}):t.push({text:s,status:"neutral"})}}return t},O=(e,s)=>{const a=e.split(/[.!?]+/).filter(e=>e.trim().length>0),t=[];let r=e;s&&s.length>0?(s.forEach(e=>{if(e.sentence_quote&&e.improved_version){const s=e.sentence_quote.trim(),n=e.improved_version.trim();r=r.replace(s,n);const o=a.find(e=>e.includes(s));if(o){const a=o.trim()+".",r=o.replace(s,n).trim()+".",l=((e,s)=>{const a=e.split(/\s+/),t=s.split(/\s+/),r=a.length,n=t.length,o=[],l=new Set,i=new Set;for(let g=0;g<r;g++)for(let e=0;e<n;e++)if(!l.has(g)&&!i.has(e)&&a[g]===t[e]){o.push({origIndex:g,impIndex:e,word:a[g]}),l.add(g),i.add(e);break}o.sort((e,s)=>e.origIndex-s.origIndex);const c=[],d=[],u=(e,s,a)=>{if(0===s.length)return;const t=s.replace(/\s+/g," ").trim();t&&e.push({text:t+" ",status:a})};let m=0;for(const g of o){if(g.origIndex>m){const e=a.slice(m,g.origIndex);if(e.length>0){const s=e.join(" ");s.trim()&&u(c,s,"error")}}u(c,g.word,"neutral"),m=g.origIndex+1}if(m<r){const e=a.slice(m);if(e.length>0){const s=e.join(" ");s.trim()&&u(c,s,"error")}}let p=0;for(const g of o){if(g.impIndex>p){const e=t.slice(p,g.impIndex);if(e.length>0){const s=e.join(" ");s.trim()&&u(d,s,"improvement")}}u(d,g.word,"neutral"),p=g.impIndex+1}if(p<n){const e=t.slice(p);if(e.length>0){const s=e.join(" ");s.trim()&&u(d,s,"improvement")}}return 0===c.length&&c.push({text:e,status:"neutral"}),0===d.length&&d.push({text:s,status:"neutral"}),{origSpans:c,impSpans:d}})(a,r);t.push({original:a,improved:r,original_spans:l.origSpans,corrected_spans:l.impSpans,issue:e.issue||"Enhancement suggestion",explanation:e.explanation})}}}),a.forEach((e,s)=>{const a=e.trim();a&&!t.some(e=>e.original.includes(a))&&t.push({original:a+".",improved:a+".",issue:`Sentence ${s+1}`,explanation:"This sentence appears to be well-written or no specific improvements were identified."})})):a.forEach((e,s)=>{const a=e.trim();a&&t.push({original:a+".",improved:a+".",issue:`Sentence ${s+1}`,explanation:"No specific improvements suggested for this sentence."})});const n=(e,a)=>{if(!s||0===s.length)return[{text:e,status:"neutral"}];const t=[];let r=e,n=0;return s.forEach(e=>{if(e.sentence_quote&&e.improved_version){const s=e.sentence_quote.trim(),o=e.improved_version.trim(),l=a?o:s,i=r.indexOf(l);-1!==i&&(i>0&&t.push({text:r.substring(0,i),status:"neutral"}),t.push({text:l,status:a?"improvement":"error"}),r=r.substring(i+l.length),n++)}}),r.length>0&&t.push({text:r,status:"neutral"}),0===n?[{text:e,status:"neutral"}]:t.length>0?t:[{text:e,status:"neutral"}]};return{originalSpans:n(e,!1),improvedSpans:n(r,!0),sentences:t}},F=({originalText:a,improvementSuggestions:t,originalSpans:r,correctedSpans:n,sentenceComparisons:c,title:p,loading:g,currentTheme:h})=>{var v,b,f,x,k,_;const[y,j]=s.useState("whole"),{originalSpans:w,improvedSpans:N,sentences:C}=s.useMemo(()=>{if(r&&n&&r.length>0&&n.length>0){const e=r.map(e=>e.text).join("").replace(/\s+/g," ").trim();n.map(e=>e.text).join("").replace(/\s+/g," ").trim();const s=a.replace(/\s+/g," ").trim(),o=e.length/s.length;return e.trim()!==s||o<.5?(console.warn("‚ö†Ô∏è AI-provided spans incomplete, falling back to full text processing",{spansLength:e.length,originalLength:s.length,coverage:o}),O(a,t)):{originalSpans:r,improvedSpans:n,sentences:c||[]}}return O(a,t)},[a,t,r,n,c]);s.useMemo(()=>W(w),[w]),s.useMemo(()=>W(N),[N]);const S=s.useMemo(()=>(C||[]).map(e=>({...e,original_spans:e.original_spans?W(e.original_spans):e.original_spans,corrected_spans:e.corrected_spans?W(e.corrected_spans):e.corrected_spans})),[C]),T=s.useMemo(()=>{if(c&&c.length>0)return c.map(e=>({...e,original_spans:e.original_spans?W(e.original_spans):e.original_spans,corrected_spans:e.corrected_spans?W(e.corrected_spans):e.corrected_spans}));const e=N.map(e=>e.text).join("").trim(),s=a.split(/[.!?]+/).filter(e=>e.trim().length>0).map(e=>e.trim()+"."),t=e.split(/[.!?]+/).filter(e=>e.trim().length>0).map(e=>e.trim()+"."),r=Math.min(s.length,t.length),n=[];for(let a=0;a<r;a++){const e=s[a],r=t[a],o=diffToSpans(e,r);n.push({original:e,improved:r,original_spans:o.origSpans,corrected_spans:o.impSpans})}return n},[N,a,c]),E=s.useMemo(()=>c&&c.length>0?c.map(e=>({...e,original_spans:e.original_spans?W(e.original_spans):e.original_spans,corrected_spans:e.corrected_spans?W(e.corrected_spans):e.corrected_spans})):S.length>0?S:T,[c,S,T]),A=s.useMemo(()=>(e=>{const s=e.length;if(s<=3)return[e];const a=Math.min(2,Math.max(1,Math.floor(.2*s))),t=Math.min(2,Math.max(1,Math.floor(.2*s)));return[e.slice(0,a),e.slice(a,Math.max(a,s-t)),e.slice(Math.max(a,s-t))].filter(e=>e.length>0)})(E),[E]);return a.trim()?g?e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"animate-pulse h-6 w-48 bg-surface-3 rounded mb-4"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx("div",{className:"h-40 bg-surface-3 rounded border border-border"}),e.jsx("div",{className:"h-40 bg-surface-3 rounded border border-border"})]})]}):e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-heading-4",children:["Writing Analysis - ",p]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{size:"sm",onClick:()=>j("whole"),className:"flex items-center gap-2",style:{backgroundColor:"whole"===y?null==(v=null==h?void 0:h.colors)?void 0:v.buttonPrimary:"transparent",color:"whole"===y?"#ffffff":null==(b=null==h?void 0:h.colors)?void 0:b.buttonPrimary,borderColor:null==(f=null==h?void 0:h.colors)?void 0:f.buttonPrimary},children:[e.jsx($,{className:"w-4 h-4"}),"Whole View"]}),e.jsxs(i,{size:"sm",onClick:()=>j("sentence"),className:"flex items-center gap-2",style:{backgroundColor:"sentence"===y?null==(x=null==h?void 0:h.colors)?void 0:x.buttonPrimary:"transparent",color:"sentence"===y?"#ffffff":null==(k=null==h?void 0:h.colors)?void 0:k.buttonPrimary,borderColor:null==(_=null==h?void 0:h.colors)?void 0:_.buttonPrimary},children:[e.jsx(I,{className:"w-4 h-4"}),"Sentence by Sentence"]})]})]}),"whole"===y?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs(o,{className:"border border-destructive/20 bg-surface-1 rounded-3xl shadow-sm",children:[e.jsx(d,{className:"pb-3",children:e.jsxs(u,{className:"text-base flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 bg-destructive/20 rounded-full"}),"Your Writing",e.jsx(m,{variant:"outline",className:"text-xs text-destructive",children:"Issues highlighted"})]})}),e.jsx(l,{children:e.jsx("div",{className:"text-sm whitespace-pre-wrap break-words space-y-6",children:A.map((s,a)=>e.jsx("div",{className:"space-y-2",children:s.map((s,t)=>e.jsx("p",{className:"leading-relaxed",children:(s.original_spans&&s.original_spans.length?s.original_spans:[{text:s.original||"",status:"neutral"}]).map((s,r)=>e.jsx("span",{className:D(s.status,"original"),children:s.text},`whole-orig-span-${a}-${t}-${r}`))},`whole-orig-${a}-${t}`))},`orig-group-${a}`))})})]}),e.jsxs(o,{className:"border border-brand-green/20 bg-surface-1 rounded-3xl shadow-sm",children:[e.jsx(d,{className:"pb-3",children:e.jsxs(u,{className:"text-base flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 bg-brand-green/20 rounded-full"}),"AI Suggested Improvements",e.jsx(m,{variant:"outline",className:"text-xs text-brand-green",children:"Enhancements highlighted"})]})}),e.jsx(l,{children:e.jsx("div",{className:"text-sm whitespace-pre-wrap break-words space-y-6",children:A.map((s,a)=>e.jsx("div",{className:"space-y-2",children:s.map((s,t)=>e.jsx("p",{className:"leading-relaxed",children:(s.corrected_spans&&s.corrected_spans.length?s.corrected_spans:[{text:s.improved||"",status:"neutral"}]).map((s,r)=>e.jsx("span",{className:D(s.status,"improved"),children:s.text},`whole-imp-span-${a}-${t}-${r}`))},`whole-imp-${a}-${t}`))},`imp-group-${a}`))})})]})]}):e.jsx("div",{className:"space-y-4",children:E.length>0?E.map((s,a)=>e.jsx(o,{className:"border border-border",children:e.jsxs(l,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx("div",{className:"space-y-2",children:e.jsx("div",{className:"p-3 bg-destructive/5 border border-destructive/20 rounded-lg",children:e.jsx("div",{className:"text-sm leading-relaxed whitespace-pre-wrap break-words",children:s.original_spans?s.original_spans.map((s,a)=>e.jsx("span",{className:D(s.status,"original"),children:s.text},`orig-${a}`)):s.original})})}),e.jsx("div",{className:"space-y-2",children:e.jsx("div",{className:"p-3 bg-brand-green/5 border border-brand-green/20 rounded-lg",children:e.jsx("div",{className:"text-sm leading-relaxed whitespace-pre-wrap break-words",children:s.corrected_spans?s.corrected_spans.map((s,a)=>e.jsx("span",{className:D(s.status,"improved"),children:s.text},`corr-${a}`)):s.improved})})})]}),s.explanation&&e.jsxs("div",{className:"p-3 bg-surface-2 border border-border rounded-lg",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-text-tertiary mb-1",children:"Explanation"}),e.jsx("p",{className:"text-sm text-text-secondary",children:"string"==typeof s.explanation?s.explanation:"object"==typeof s.explanation&&s.explanation.explanation?s.explanation.explanation:"Improvement suggestion available."})]})]})},a)):e.jsx(o,{className:"border border-border",children:e.jsxs(l,{className:"py-6 text-center",children:[e.jsx("p",{className:"text-text-secondary",children:"No specific sentence-level improvements available for this task."}),e.jsx("p",{className:"text-sm text-text-tertiary mt-1",children:"Use the whole view to see your complete writing."})]})})}),e.jsx(P,{improvementSpans:s.useMemo(()=>E.flatMap(e=>(e.corrected_spans||[]).filter(e=>"improvement"===e.status)),[E]),title:"Useful Vocabulary from Improvements",currentTheme:h})]}):null},z=e=>"number"!=typeof e||Number.isNaN(e)?NaN:Math.min(9,Math.max(0,Math.round(2*e)/2)),U=(e,s)=>{var a,t,r,n,o;if(!e)return NaN;const l=e.criteria||{},i=[];if("task1"===s?"number"==typeof(null==(a=l.task_achievement)?void 0:a.band)&&i.push(l.task_achievement.band):"number"==typeof(null==(t=l.task_response)?void 0:t.band)&&i.push(l.task_response.band),"number"==typeof(null==(r=l.coherence_and_cohesion)?void 0:r.band)&&i.push(l.coherence_and_cohesion.band),"number"==typeof(null==(n=l.lexical_resource)?void 0:n.band)&&i.push(l.lexical_resource.band),"number"==typeof(null==(o=l.grammatical_range_and_accuracy)?void 0:o.band)&&i.push(l.grammatical_range_and_accuracy.band),0===i.length)return"number"==typeof e.overall_band?z(e.overall_band):NaN;const c=i.reduce((e,s)=>e+s,0)/i.length;return z(c)};function G(){var y,j,w,N,C,S,T,E,A,$,I,P,D,q,R,W,O;const G=a(),Y=t(),{user:K}=r(),{toast:V}=n();p();const[H,X]=s.useState(!1),[J,Q]=s.useState("note"),[Z,ee]=s.useState({}),se=s.useRef(null);s.useEffect(()=>{const e=G.state,s=null==e?void 0:e.submissionId;s&&se.current!==s&&(se.current=null),e&&e.structured?ee(e):(null==e?void 0:e.submissionId)&&K?ae(e.submissionId):ee({})},[G.state,K]);const ae=async e=>{var s,a,t,r,n,o;X(!0);try{console.log("üîç Fetching results from database for submission:",e);const{data:l,error:i}=await c.from("test_results").select("*").eq("id",e).eq("user_id",null==K?void 0:K.id).single();if(i)throw console.error("‚ùå Error fetching test result:",i),i;console.log("‚úÖ Test result fetched:",l);const{data:d,error:u}=await c.from("writing_test_results").select("*").eq("test_result_id",e).eq("user_id",null==K?void 0:K.id).order("task_number");if(u)throw console.error("‚ùå Error fetching writing results:",u),u;if(console.log("‚úÖ Writing results fetched:",d),!d||d.length<2)throw console.warn("‚ö†Ô∏è Incomplete writing results found:",(null==d?void 0:d.length)||0),new Error("Incomplete test results found");const m=d.find(e=>1===e.task_number),p=d.find(e=>2===e.task_number),g=e=>{if(!e||"object"!=typeof e)return 6.5;const s=[];for(const[a,t]of Object.entries(e))if(t&&"object"==typeof t&&"band"in t){const e=t.band;"number"==typeof e&&e>=0&&e<=9&&s.push(e)}return s.length>0?Math.round(s.reduce((e,s)=>e+s,0)/s.length*2)/2:6.5},h=(e,s)=>{const a="Original analysis incomplete - criterion score not provided in assessment",t="task1"===s?{task_achievement:{band:0,justification:a},coherence_and_cohesion:{band:0,justification:a},lexical_resource:{band:0,justification:a},grammatical_range_and_accuracy:{band:0,justification:a}}:{task_response:{band:0,justification:a},coherence_and_cohesion:{band:0,justification:a},lexical_resource:{band:0,justification:a},grammatical_range_and_accuracy:{band:0,justification:a}};if(!e||"object"!=typeof e)return console.warn(`‚ö†Ô∏è Missing or invalid criteria for ${s} - analysis incomplete`),t;const r={};for(const[o,l]of Object.entries(e))l&&"object"==typeof l&&"band"in l&&(r[o]=l);const n="task1"===s?["task_achievement","coherence_and_cohesion","lexical_resource","grammatical_range_and_accuracy"]:["task_response","coherence_and_cohesion","lexical_resource","grammatical_range_and_accuracy"];for(const o of n)r[o]||(r[o]={band:0,justification:a});return r},v=l.test_data,b=(null==v?void 0:v.overall_band)||l.overall_score||.33*g(null==m?void 0:m.band_scores)+.67*g(null==p?void 0:p.band_scores),f={structured:{task1:{criteria:h(null==m?void 0:m.band_scores,"task1"),overall_band:g(null==m?void 0:m.band_scores),feedback_markdown:(null==m?void 0:m.detailed_feedback)||"### Task 1 Assessment\n\nDetailed feedback was not available for this task.",feedback:{strengths:["Response was submitted successfully"],improvements:(null==m?void 0:m.improvement_suggestions)||["Retake test for detailed feedback"]}},task2:{criteria:h(null==p?void 0:p.band_scores,"task2"),overall_band:g(null==p?void 0:p.band_scores),feedback_markdown:(null==p?void 0:p.detailed_feedback)||"### Task 2 Assessment\n\nDetailed feedback was not available for this task.",feedback:{strengths:["Response was submitted successfully"],improvements:(null==p?void 0:p.improvement_suggestions)||["Retake test for detailed feedback"]}},overall:{band:b,calculation:"Database reconstruction: Task 1 + Task 2 weighted average",feedback_markdown:`### Overall IELTS Writing Band Score: ${b}\n\nThis score was reconstructed from saved test data.`},full_report_markdown:`# IELTS Writing Assessment Results\n\n## Overall Band Score: ${b}\n\nThis assessment was reconstructed from your saved test results. For the most accurate and detailed feedback, please take a new test.`},testName:l.test_type||"IELTS Writing Test",task1Answer:(null==m?void 0:m.user_response)||null,task2Answer:(null==p?void 0:p.user_response)||null,task1Skipped:!m,task2Skipped:!p,task1Data:{title:(null==(s=null==v?void 0:v.task1Data)?void 0:s.title)||"Task 1",instructions:(null==m?void 0:m.prompt_text)||(null==(a=null==v?void 0:v.task1Data)?void 0:a.instructions)||"Task 1 Instructions",imageUrl:(null==(t=null==v?void 0:v.task1Data)?void 0:t.imageUrl)||null,imageContext:(null==(r=null==v?void 0:v.task1Data)?void 0:r.imageContext)||null},task2Data:{title:(null==(n=null==v?void 0:v.task2Data)?void 0:n.title)||"Task 2",instructions:(null==p?void 0:p.prompt_text)||(null==(o=null==v?void 0:v.task2Data)?void 0:o.instructions)||"Task 2 Instructions"}};console.log("‚úÖ Reconstructed data:",f),ee(f)}catch(l){console.error("‚ùå Error fetching results:",l),V({title:"Error",description:"Failed to load test results. Please try taking the test again.",variant:"destructive"})}finally{X(!1)}};s.useEffect(()=>{(async()=>{var e,s,a,t,r,n,o,l,i,d,u,m,p,g;if(!Z||!K)return;const h=(null==(e=G.state)?void 0:e.submissionId)||(null==Z?void 0:Z.submissionId);if(se.current===h)return void console.log("‚úÖ Submission already processed, skipping generation");const v=h||`${null==(s=Z.task1Answer)?void 0:s.slice(0,50)}_${null==(a=Z.task2Answer)?void 0:a.slice(0,50)}`;if(se.current===v)return void console.log("‚úÖ Content already processed, skipping generation");const b=Z.structured;if(!b)return;const f=(null==(t=null==b?void 0:b.task1)?void 0:t.sentence_comparisons)&&Array.isArray(b.task1.sentence_comparisons)&&b.task1.sentence_comparisons.length>0&&b.task1.original_spans&&b.task1.corrected_spans,x=(null==(r=null==b?void 0:b.task2)?void 0:r.sentence_comparisons)&&Array.isArray(b.task2.sentence_comparisons)&&b.task2.sentence_comparisons.length>0&&b.task2.original_spans&&b.task2.corrected_spans;if(f&&x)return void(se.current=h||v);if(f&&!Z.task2Answer||x&&!Z.task1Answer)return void(se.current=h||v);const k=!!Z.task1Answer&&!f,_=!!Z.task2Answer&&!x;if(k||_){console.log("üîÑ Generating sentence_comparisons on-demand (ONE TIME ONLY)..."),se.current=h||v;try{X(!0);const e={...b},s=e=>(e||[]).map(e=>e.text).join(""),a=(e=[])=>e.map(e=>({issue:"Rewrite for clarity and accuracy",sentence_quote:s(e.original_spans),improved_version:s(e.corrected_spans),explanation:"This rewrite improves grammar, vocabulary, and cohesion while preserving your original meaning."}));if(k&&Z.task1Answer){const{data:s,error:t}=await c.functions.invoke("writing-feedback",{body:{writing:Z.task1Answer,prompt:(null==(n=Z.task1Data)?void 0:n.title)||(null==(o=Z.task1Data)?void 0:o.instructions),taskType:"Task 1"}});if(!t&&(null==s?void 0:s.structured)){e.task1=e.task1||{criteria:{}},e.task1.feedback=e.task1.feedback||{},e.task1.sentence_comparisons=s.structured.sentence_comparisons||[];const t=a(e.task1.sentence_comparisons);e.task1.feedback.improvements_detailed=s.structured.improvements_detailed||t,e.task1.feedback.improvements=s.structured.improvements||t,e.task1.feedback_markdown=s.structured.feedback_markdown||e.task1.feedback_markdown,h&&await c.from("writing_test_results").update({detailed_feedback:e.task1.feedback_markdown||"",improvement_suggestions:((null==(l=e.task1.feedback)?void 0:l.improvements)||[]).filter(e=>"string"==typeof e)}).eq("test_result_id",h).eq("user_id",K.id).eq("task_number",1)}}if(_&&Z.task2Answer){const{data:s,error:t}=await c.functions.invoke("writing-feedback",{body:{writing:Z.task2Answer,prompt:(null==(i=Z.task2Data)?void 0:i.title)||(null==(d=Z.task2Data)?void 0:d.instructions),taskType:"Task 2"}});if(!t&&(null==s?void 0:s.structured)){e.task2=e.task2||{criteria:{}},e.task2.feedback=e.task2.feedback||{},e.task2.sentence_comparisons=s.structured.sentence_comparisons||[];const t=a(e.task2.sentence_comparisons);e.task2.feedback.improvements_detailed=s.structured.improvements_detailed||t,e.task2.feedback.improvements=s.structured.improvements||t,e.task2.feedback_markdown=s.structured.feedback_markdown||e.task2.feedback_markdown,h&&await c.from("writing_test_results").update({detailed_feedback:e.task2.feedback_markdown||"",improvement_suggestions:((null==(u=e.task2.feedback)?void 0:u.improvements)||[]).filter(e=>"string"==typeof e)}).eq("test_result_id",h).eq("user_id",K.id).eq("task_number",2)}}k&&(null==(m=e.task1)?void 0:m.sentence_comparisons)&&e.task1.sentence_comparisons.length>0||_&&(null==(p=e.task2)?void 0:p.sentence_comparisons)&&e.task2.sentence_comparisons.length>0?(ee(s=>({...s,structured:e})),console.log("‚úÖ sentence_comparisons generated and updated (ONE TIME)")):console.log("‚úÖ No changes needed, skipping state update")}catch(y){console.error("‚ö†Ô∏è On-demand feedback generation failed:",y);const e=(null==(g=G.state)?void 0:g.submissionId)||(null==Z?void 0:Z.submissionId);se.current===e&&(se.current=null)}finally{X(!1)}}else se.current=h||v})()},[null==(y=G.state)?void 0:y.submissionId,null==Z?void 0:Z.submissionId,null==K?void 0:K.id]);const{structured:te,testName:re,task1Data:ne,task2Data:oe,task1Answer:le,task2Answer:ie}=Z;s.useEffect(()=>{document.title=`IELTS Writing Results ‚Äì ${re||"Assessment"}`;const e=document.querySelector('meta[name="description"]');if(e)e.content="Professional IELTS Writing assessment with detailed per-criterion bands and feedback.";else{const e=document.createElement("meta");e.name="description",e.content="Professional IELTS Writing assessment with detailed per-criterion bands and feedback.",document.head.appendChild(e)}},[re]);!(te&&(te.task1||te.task2))&&te&&(console.warn("‚ö†Ô∏è Structured data exists but lacks task data, creating minimal fallback"),te.task1=te.task1||{criteria:{task_achievement:{band:6.5,justification:"Minimal assessment available"},coherence_and_cohesion:{band:6.5,justification:"Minimal assessment available"},lexical_resource:{band:6.5,justification:"Minimal assessment available"},grammatical_range_and_accuracy:{band:6.5,justification:"Minimal assessment available"}},overall_band:6.5,feedback:{strengths:["Response provided"],improvements:["Retake for detailed feedback"]},feedback_markdown:"Assessment data incomplete."},te.task2=te.task2||{criteria:{task_response:{band:6.5,justification:"Minimal assessment available"},coherence_and_cohesion:{band:6.5,justification:"Minimal assessment available"},lexical_resource:{band:6.5,justification:"Minimal assessment available"},grammatical_range_and_accuracy:{band:6.5,justification:"Minimal assessment available"}},overall_band:6.5,feedback:{strengths:["Response provided"],improvements:["Retake for detailed feedback"]},feedback_markdown:"Assessment data incomplete."});if(!(te&&(te.task1||te.task2)))return e.jsx("div",{className:"min-h-screen bg-surface-2 flex items-center justify-center",children:e.jsxs(o,{className:"max-w-md mx-4",children:[e.jsx(d,{className:"text-center",children:e.jsx(u,{className:"text-heading-3 text-destructive",children:"Results Not Available"})}),e.jsxs(l,{className:"text-center space-y-4",children:[e.jsx("p",{style:{color:"#8B6914"},children:"We couldn't find your test results. This usually happens when:"}),e.jsxs("ul",{className:"text-sm text-left space-y-1",style:{color:"#8B6914"},children:[e.jsx("li",{children:"‚Ä¢ You navigated directly to this page"}),e.jsx("li",{children:"‚Ä¢ You refreshed the page"}),e.jsx("li",{children:"‚Ä¢ The test session expired"})]}),e.jsxs("div",{className:"flex flex-col gap-2 pt-4",children:[e.jsx(i,{onClick:()=>Y("/ielts-portal"),className:"w-full",children:"Take New Test"}),e.jsx(i,{variant:"outline",onClick:()=>Y("/dashboard"),className:"w-full",children:"Back to Dashboard"})]})]})]})});const ce=U(null==te?void 0:te.task1,"task1"),de=U(null==te?void 0:te.task2,"task2"),ue=Z.task1Skipped||!Z.task1Answer||!Z.task1Answer.trim(),me=Z.task2Skipped||!Z.task2Answer||!Z.task2Answer.trim(),pe=!ue&&!Number.isNaN(ce),ge=!me&&!Number.isNaN(de),he=(pe?1:0)+(ge?2:0),ve=e=>Number.isNaN(e)||e<0?0:e>9?9:e,be=pe?ve(ce):0,fe=ge?ve(de):0,xe=he>0?z((be+2*fe)/he):pe?z(be):ge?z(fe):0,ke=k[J]||k.note,_e=({title:s,task:a,type:t,computedOverall:r,userAnswer:n,isSkipped:i})=>{var c,p,g,h,v,b,f,x,k,_,y,j,w,N,C,S,T,E,A,$,I;if(i||!n||!n.trim())return e.jsxs(o,{className:"rounded-3xl shadow-lg mb-8",style:{backgroundColor:ke.colors.cardBackground,borderColor:ke.colors.cardBorder,...ke.styles.cardStyle},children:[e.jsx(d,{className:"bg-gradient-to-r from-amber-50 to-amber-100",children:e.jsxs(u,{className:"flex items-center gap-2 text-amber-700",children:[e.jsx("div",{className:"p-2 rounded-xl bg-amber-200",children:"task1"===t?"Task 1":"Task 2"}),s," - Skipped"]})}),e.jsxs(l,{className:"p-6 text-center",children:[e.jsx(m,{variant:"outline",className:"text-amber-600 border-amber-300 bg-amber-50 rounded-full px-4 py-2 mb-2",children:"This task was skipped"}),e.jsx("p",{className:"text-sm mt-2",style:{color:"#8B6914"},children:"No assessment available for this task"})]})]});if(!a)return null;const L=a.criteria||{},M=["task1"===t?{label:"Task Achievement",value:null==(c=L.task_achievement)?void 0:c.band,just:null==(p=L.task_achievement)?void 0:p.justification}:{label:"Task Response",value:null==(g=L.task_response)?void 0:g.band,just:null==(h=L.task_response)?void 0:h.justification},{label:"Coherence & Cohesion",value:null==(v=L.coherence_and_cohesion)?void 0:v.band,just:null==(b=L.coherence_and_cohesion)?void 0:b.justification},{label:"Lexical Resource",value:null==(f=L.lexical_resource)?void 0:f.band,just:null==(x=L.lexical_resource)?void 0:x.justification},{label:"Grammar Range & Accuracy",value:null==(k=L.grammatical_range_and_accuracy)?void 0:k.band,just:null==(_=L.grammatical_range_and_accuracy)?void 0:_.justification}],B="number"!=typeof r||Number.isNaN(r)?"number"==typeof a.overall_band?z(a.overall_band):NaN:z(r);return e.jsxs(o,{className:"rounded-3xl shadow-lg mb-8",style:{backgroundColor:ke.colors.cardBackground,borderColor:ke.colors.cardBorder,...ke.styles.cardStyle},children:[e.jsx(d,{style:{backgroundColor:ke.colors.cardBackground,borderBottom:`1px solid ${ke.colors.border}`},children:e.jsxs(u,{className:"text-heading-3 flex items-center justify-between",style:{color:"#5D4E37"},children:[e.jsx("span",{children:s}),!Number.isNaN(B)&&e.jsxs(m,{variant:"outline",className:"rounded-2xl text-sm",children:["Overall: ",B.toFixed(1)]})]})}),e.jsxs(l,{className:"p-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:M.map(s=>e.jsxs("div",{className:"rounded-2xl p-4 border",style:{backgroundColor:ke.colors.hoverBackground,borderColor:ke.colors.border,color:ke.colors.textPrimary},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm font-medium",style:{color:ke.colors.textPrimary},children:s.label}),e.jsx(m,{variant:"outline",className:"rounded-xl",style:{borderColor:ke.colors.buttonPrimary,color:ke.colors.buttonPrimary},children:"number"==typeof s.value?z(s.value).toFixed(1):"-"})]}),s.just?e.jsx("div",{className:"mt-2 text-sm",style:{color:ke.colors.textSecondary},children:s.just}):null]},s.label))}),((null==(j=null==(y=a.feedback)?void 0:y.strengths)?void 0:j.length)||(null==(N=null==(w=a.feedback)?void 0:w.improvements)?void 0:N.length)||(null==(S=null==(C=a.feedback)?void 0:C.improvements_detailed)?void 0:S.length))&&e.jsx("div",{className:"mt-6 space-y-6",children:(null==(E=null==(T=a.feedback)?void 0:T.strengths)?void 0:E.length)?e.jsxs("div",{children:[e.jsx("h4",{className:"text-heading-4 mb-2",style:{color:"#5D4E37"},children:"Key strengths"}),e.jsx("ul",{className:"list-disc pl-5 space-y-1 text-sm",style:{color:ke.colors.textSecondary},children:a.feedback.strengths.map((s,a)=>e.jsx("li",{children:s},a))})]}):null}),n&&e.jsx(F,{originalText:n,improvementSuggestions:(null==($=null==(A=a.feedback)?void 0:A.improvements)?void 0:$.map(e=>"string"==typeof e?{issue:"General Improvement",sentence_quote:"",improved_version:e,explanation:e}:e&&"object"==typeof e?{issue:e.issue||"Improvement",sentence_quote:e.original||e.sentence_quote||"",improved_version:e.improved||e.improved_version||"",explanation:e.explanation||"Suggested improvement"}:{issue:"Improvement",sentence_quote:"",improved_version:String(e||""),explanation:String(e||"")}))||(null==(I=a.feedback)?void 0:I.improvements_detailed)||[],originalSpans:a.original_spans,correctedSpans:a.corrected_spans,sentenceComparisons:a.sentence_comparisons,title:s,currentTheme:ke})]})]})};return e.jsxs("div",{className:"min-h-screen relative",style:{backgroundColor:"transparent"},children:[e.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"none",backgroundColor:"#F5E6D3"}}),e.jsx(g,{raysOrigin:"top-center",raysColor:"#4F46E5",raysSpeed:.5,lightSpread:2,rayLength:1.5,pulsating:!1,fadeDistance:1.2,saturation:.8,followMouse:!0,mouseInfluence:.05,noiseAmount:.1,distortion:.2}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"border-b sticky top-0 z-10",style:{backgroundColor:ke.colors.cardBackground,borderColor:ke.colors.border},children:e.jsxs("div",{className:"container mx-auto px-6 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(i,{variant:"ghost",onClick:()=>Y("/dashboard"),className:"hover:bg-surface-3 rounded-xl",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]}),e.jsx("div",{children:e.jsx("h1",{className:"text-heading-2",style:{color:"#5D4E37"},children:"IELTS Writing Results"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4",style:{color:"#8B6914"}}),e.jsxs(h,{value:J,onValueChange:Q,children:[e.jsx(v,{className:"w-[140px] h-9",children:e.jsx(b,{placeholder:"Theme"})}),e.jsx(f,{children:[{value:"note",label:"Note",description:"Warm paper-like appearance"}].map(s=>e.jsx(x,{value:s.value,children:s.label},s.value))})]})]})]})}),e.jsxs("div",{className:"container mx-auto px-6 space-section",children:[e.jsxs(o,{className:"rounded-3xl mb-8 overflow-hidden",style:{backgroundColor:ke.colors.cardBackground,borderColor:ke.colors.cardBorder,...ke.styles.cardStyle},children:[e.jsx(d,{className:"text-center py-6",style:{backgroundColor:ke.colors.cardBackground,borderBottom:`1px solid ${ke.colors.border}`},children:e.jsx(u,{className:"text-heading-3",style:{color:"#5D4E37"},children:"Overall Writing Band Score"})}),e.jsx(l,{className:"py-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-center justify-center gap-6 lg:gap-8",children:[e.jsx(_,{size:"md",className:"shrink-0"}),e.jsxs("div",{className:"text-center lg:text-left",children:[e.jsx("p",{className:"text-caption uppercase tracking-wide mb-1",style:{color:"#8B6914"},children:"Overall Band"}),e.jsx("div",{className:"text-6xl font-bold mb-3",style:{background:`linear-gradient(to right, ${ke.colors.buttonPrimary}, ${ke.colors.buttonPrimaryHover})`,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:xe.toFixed(1)}),e.jsx("div",{className:"flex items-center gap-3 justify-center lg:justify-start",children:e.jsx(m,{variant:"outline",className:"text-base px-3 py-1.5 rounded-2xl",style:{color:ke.colors.buttonPrimary,borderColor:ke.colors.buttonPrimary,backgroundColor:ke.colors.hoverBackground},children:"Performance"})})]}),e.jsx(B,{task1Scores:!ue&&(null==te?void 0:te.task1)?{task_achievement:null==(w=null==(j=te.task1.criteria)?void 0:j.task_achievement)?void 0:w.band,coherence_and_cohesion:null==(C=null==(N=te.task1.criteria)?void 0:N.coherence_and_cohesion)?void 0:C.band,lexical_resource:null==(T=null==(S=te.task1.criteria)?void 0:S.lexical_resource)?void 0:T.band,grammatical_range_and_accuracy:null==(A=null==(E=te.task1.criteria)?void 0:E.grammatical_range_and_accuracy)?void 0:A.band}:void 0,task2Scores:!me&&(null==te?void 0:te.task2)?{task_response:null==(I=null==($=te.task2.criteria)?void 0:$.task_response)?void 0:I.band,coherence_and_cohesion:null==(D=null==(P=te.task2.criteria)?void 0:P.coherence_and_cohesion)?void 0:D.band,lexical_resource:null==(R=null==(q=te.task2.criteria)?void 0:q.lexical_resource)?void 0:R.band,grammatical_range_and_accuracy:null==(O=null==(W=te.task2.criteria)?void 0:W.grammatical_range_and_accuracy)?void 0:O.band}:void 0,className:"w-full max-w-sm lg:w-80 shrink-0"})]})})]}),((null==ne?void 0:ne.instructions)||(null==ne?void 0:ne.imageUrl))&&e.jsxs(o,{className:"rounded-3xl shadow-lg mb-8",style:{backgroundColor:ke.colors.cardBackground,borderColor:ke.colors.cardBorder,...ke.styles.cardStyle},children:[e.jsx(d,{children:e.jsx(u,{className:"text-heading-4",style:{color:"#5D4E37"},children:"Task 1 Instruction"})}),e.jsx(l,{children:e.jsxs("div",{className:"space-y-3",children:[(null==ne?void 0:ne.imageUrl)&&e.jsx("div",{className:"rounded-xl overflow-hidden border border-border bg-white p-2 flex items-center justify-center",children:e.jsx("img",{src:ne.imageUrl,alt:"Task 1 visual",className:"max-h-64 object-contain"})}),(null==ne?void 0:ne.instructions)&&e.jsx("div",{className:"text-sm p-4 rounded-lg whitespace-pre-wrap",style:{color:ke.colors.textSecondary,backgroundColor:ke.colors.cardBackground,border:`1px solid ${ke.colors.border}`},children:ne.instructions})]})})]}),e.jsx(_e,{title:"Task 1 Assessment",task:null==te?void 0:te.task1,type:"task1",computedOverall:ce,userAnswer:Z.task1Answer,isSkipped:Z.task1Skipped||!Z.task1Answer||!Z.task1Answer.trim()}),(null==oe?void 0:oe.instructions)&&e.jsxs(o,{className:"rounded-3xl shadow-lg mb-8",style:{backgroundColor:ke.colors.cardBackground,borderColor:ke.colors.cardBorder,...ke.styles.cardStyle},children:[e.jsx(d,{children:e.jsx(u,{className:"text-heading-4",style:{color:"#5D4E37"},children:"Task 2 Instruction"})}),e.jsx(l,{children:e.jsx("div",{className:"text-sm p-4 rounded-lg whitespace-pre-wrap",style:{color:ke.colors.textSecondary,backgroundColor:ke.colors.cardBackground,border:`1px solid ${ke.colors.border}`},children:oe.instructions})})]}),e.jsx(_e,{title:"Task 2 Assessment",task:null==te?void 0:te.task2,type:"task2",computedOverall:de,userAnswer:Z.task2Answer,isSkipped:Z.task2Skipped||!Z.task2Answer||!Z.task2Answer.trim()}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx(i,{onClick:()=>Y("/ielts-portal"),className:"rounded-xl",style:{backgroundColor:ke.colors.buttonPrimary,color:"#ffffff",borderColor:ke.colors.buttonPrimary},children:"Take Another Test"}),e.jsx(i,{onClick:()=>Y("/dashboard"),variant:"outline",className:"rounded-xl",style:{borderColor:ke.colors.buttonPrimary,color:ke.colors.buttonPrimary},children:"Return to Dashboard"})]})]})]})]})}export{G as default};
