import{y as e,j as s,bk as a,bl as t,bm as r,bn as n,bo as o,bp as l,bq as i,A as c,g as d,r as u,C as m,a as p,B as g,a9 as h,P as v,E as b,b as f,c as x,k,a4 as _,u as y,al as j,ag as w,$ as N,an as C,S,o as T,p as E,q as A,s as $,ao as M}from"./index-DjOmKDEq.js";import{P as I}from"./PenguinClapAnimation-CgBFscG2.js";import{s as L}from"./supabase-DUkWVuqu.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=e("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);function P({task1Scores:e,task2Scores:c,className:d=""}){const u=(()=>{const s=e||{},a=c||{},t=void 0!==s.task_achievement||void 0!==s.coherence_and_cohesion,r=void 0!==a.task_response||void 0!==a.coherence_and_cohesion;let n,o,l,i;return n=t&&r?((s.task_achievement||0)+(a.task_response||0))/2:t?s.task_achievement||0:r&&a.task_response||0,o=t&&r?((s.coherence_and_cohesion||0)+(a.coherence_and_cohesion||0))/2:t?s.coherence_and_cohesion||0:r&&a.coherence_and_cohesion||0,l=t&&r?((s.lexical_resource||0)+(a.lexical_resource||0))/2:t?s.lexical_resource||0:r&&a.lexical_resource||0,i=t&&r?((s.grammatical_range_and_accuracy||0)+(a.grammatical_range_and_accuracy||0))/2:t?s.grammatical_range_and_accuracy||0:r&&a.grammatical_range_and_accuracy||0,[{criterion:"TA",score:Math.round(2*n)/2,fullName:"Task Achievement"},{criterion:"CC",score:Math.round(2*o)/2,fullName:"Coherence & Cohesion"},{criterion:"LR",score:Math.round(2*l)/2,fullName:"Lexical Resource"},{criterion:"GRA",score:Math.round(2*i)/2,fullName:"Grammar & Accuracy"}]})();if(!u.some(e=>e.score>0))return s.jsx("div",{className:`flex items-center justify-center rounded-lg ${d}`,children:s.jsxs("div",{className:"text-center p-4",children:[s.jsx("div",{className:"text-text-secondary text-sm",children:"Criteria analysis"}),s.jsx("div",{className:"text-text-muted text-xs mt-1",children:"Not available"})]})});const m=e=>{const s=["hsl(var(--brand-blue))","hsl(var(--brand-green))","hsl(var(--brand-purple))","hsl(var(--brand-orange))"];return s[e%s.length]};return s.jsxs("div",{className:`p-4 ${d}`,children:[s.jsx("div",{className:"text-center mb-4",children:s.jsx("div",{className:"text-sm font-medium text-text-primary mb-1",children:"Criteria Analysis"})}),s.jsx(a,{width:"100%",height:200,children:s.jsxs(t,{data:u,margin:{top:30,right:10,left:10,bottom:10},barCategoryGap:"20%",children:[s.jsx(r,{dataKey:"criterion",axisLine:!1,tickLine:!1,tick:{fontSize:12,fontWeight:500,fill:"hsl(var(--text-primary))"}}),s.jsx(n,{domain:[0,9],axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"hsl(var(--text-muted))"},tickCount:5}),s.jsxs(o,{dataKey:"score",radius:[4,4,0,0],animationBegin:0,animationDuration:1200,animationEasing:"ease-out",children:[u.map((e,a)=>s.jsx(l,{fill:m(a)},`cell-${a}`)),s.jsx(i,{dataKey:"score",position:"top",style:{fill:"hsl(var(--text-primary))",fontSize:"12px",fontWeight:"bold"}})]})]})})]})}const q=({improvementSpans:e,title:a="Useful Vocabulary",currentTheme:t})=>{var r,n,o;const{user:l}=c(),{toast:i}=d(),[b,f]=u.useState(!1),[x,k]=u.useState(new Set),[_,y]=u.useState("en");u.useEffect(()=>{(async()=>{if(l)try{const{data:e}=await L.from("profiles").select("native_language").eq("id",l.id).single();if(null==e?void 0:e.native_language){const s=e.native_language.length>2?e.native_language.substring(0,2).toLowerCase():e.native_language.toLowerCase();console.log("üë§ User language from profile:",e.native_language,"‚Üí normalized:",s),y(s)}const{data:s}=await L.from("user_preferences").select("preferred_feedback_language").eq("user_id",l.id).maybeSingle();if(null==s?void 0:s.preferred_feedback_language){const e=s.preferred_feedback_language.length>2?s.preferred_feedback_language.substring(0,2).toLowerCase():s.preferred_feedback_language.toLowerCase();console.log("üë§ User language from preferences:",s.preferred_feedback_language,"‚Üí normalized:",e),y(e)}}catch(e){console.warn("Error loading user language:",e)}})()},[l]);const j=u.useMemo(()=>{const s=new Set;return e.forEach(e=>{if("improvement"===e.status){e.text.toLowerCase().replace(/[^\w\s'-]/g," ").split(/\s+/).filter(e=>{const s=e.trim();return s.length>=3&&!/^\d+$/.test(s)&&!/^[^a-z]*$/.test(s)&&!["the","and","but","for","are","but","not","you","all","can","had","her","was","one","our","out","day","get","has","him","his","how","its","may","new","now","old","see","two","way","who","boy","did","has","let","put","say","she","too","use"].includes(s.toLowerCase())}).forEach(e=>s.add(e.trim()))}}),Array.from(s).slice(0,10)},[e]),[w,N]=u.useState({}),[C,S]=u.useState({});u.useEffect(()=>{(async()=>{var e,s;if(0===j.length||!_||"en"===_){const e={};return j.forEach(s=>{e[s]=s}),void N(e)}const a={},t=[];if(j.forEach(e=>{const s=`${e}_${_}`;C[s]?a[e]=C[s]:t.push(e)}),0!==t.length){f(!0);try{const o={};console.log("üîç Checking vocab_translations + vocab_cards join for language:",_);const{data:l,error:i}=await L.from("vocab_translations").select("\n            translations,\n            lang,\n            vocab_cards!inner(term)\n          ").eq("lang",_).in("vocab_cards.term",j);i?console.error("‚ùå Error querying joined vocab tables:",i):(console.log("üìñ Found",(null==l?void 0:l.length)||0,"joined translation entries"),null==l||l.forEach(e=>{var s;if((null==(s=e.vocab_cards)?void 0:s.term)&&e.translations&&Array.isArray(e.translations)&&e.translations.length>0){const s=e.vocab_cards.term,a=e.translations[0];o[s.toLowerCase()]=a,console.log(`üìñ vocab_translations join: "${s}" ‚Üí "${a}"`)}})),console.log("üîç Checking vocab_cards for",j.length,"words:",j);const{data:c,error:d}=await L.from("vocab_cards").select("term, translation").in("term",j);if(d?console.error("‚ùå Error querying vocab_cards:",d):(console.log("üìö Found",(null==c?void 0:c.length)||0,"translations in vocab_cards"),console.log("üìö Card data sample:",null==c?void 0:c.slice(0,3))),null==c||c.forEach(e=>{e.term&&e.translation&&(o[e.term.toLowerCase()]||(o[e.term.toLowerCase()]=e.translation,console.log(`üìö vocab_cards: "${e.term}" ‚Üí "${e.translation}"`)))}),i||!l||0===l.length){console.log("üîÑ Fallback: querying vocab_translations separately");const{data:e,error:s}=await L.from("vocab_translations").select("card_id, translations").eq("lang",_);if(!s&&e&&e.length>0){const s=e.map(e=>e.card_id).filter(Boolean),{data:a}=await L.from("vocab_cards").select("id, term").in("id",s).in("term",j),t={};null==a||a.forEach(e=>{t[e.term.toLowerCase()]=e.id}),e.forEach(e=>{const s=Object.keys(t).find(s=>t[s]===e.card_id);s&&e.translations&&Array.isArray(e.translations)&&e.translations.length>0&&(o[s]||(o[s]=e.translations[0],console.log(`üìñ vocab_translations fallback: "${s}" ‚Üí "${e.translations[0]}"`)))})}}const u=t.filter(e=>!o[e.toLowerCase()]);if(u.length>0&&_&&"en"!==_){console.log("üåê Translating",u.length,"words to",_,"- Words:",u);try{console.log("üåê Attempting batch translation...");const{data:a,error:t}=await L.functions.invoke("translation-service",{body:{texts:u,sourceLang:"en",targetLang:_,bypassCache:!1}});console.log("üåê Batch translation response:",{success:null==a?void 0:a.success,error:t,resultsCount:null==(e=null==a?void 0:a.results)?void 0:e.length});let n=!1;if(!t&&(null==a?void 0:a.success)&&(null==a?void 0:a.results)){const e=a.results.filter((e,s)=>{const a=u[s];return e&&e.translation&&e.translation!==a});e.length>0?(console.log("‚úÖ Batch translation successful for",e.length,"words"),n=!0,a.results.forEach((e,s)=>{const a=u[s];if(e&&e.translation){const s=e.translation;o[a.toLowerCase()]=s;const t=`${a}_${_}`;S(e=>({...e,[t]:s})),console.log(`‚úÖ Batch: "${a}" ‚Üí "${s}"`)}else o[a.toLowerCase()]=a,console.log(`‚ö†Ô∏è Batch fallback: "${a}" ‚Üí "${a}"`)})):console.warn("‚ö†Ô∏è Batch translation returned no valid translations")}if(!n){console.log("üîÑ Falling back to individual translations...");for(const e of u){try{console.log(`üåê Translating individual word: "${e}"`);const{data:a,error:t}=await L.functions.invoke("translation-service",{body:{text:e,sourceLang:"en",targetLang:_,bypassCache:!1}});if(!t&&(null==a?void 0:a.success)&&(null==(s=null==a?void 0:a.result)?void 0:s.translation)){const s=a.result.translation;o[e.toLowerCase()]=s;const t=`${e}_${_}`;S(e=>({...e,[t]:s})),console.log(`‚úÖ Individual: "${e}" ‚Üí "${s}"`)}else console.warn(`‚ö†Ô∏è Individual translation failed for "${e}":`,t,a),o[e.toLowerCase()]=e}catch(r){console.error(`‚ùå Individual translation error for "${e}":`,r),o[e.toLowerCase()]=e}await new Promise(e=>setTimeout(e,100))}}}catch(n){console.error("‚ùå Translation service error:",n),u.forEach(e=>{o[e.toLowerCase()]=e})}}else u.length>0&&(console.log("üåê Using English fallback for",u.length,"words"),u.forEach(e=>{o[e.toLowerCase()]=e}));const m={};j.forEach(e=>{const s=o[e.toLowerCase()]||a[e]||e;m[e]=s,console.log(`üéØ Final: "${e}" ‚Üí "${s}"`)}),console.log("üéØ Final translations summary:",{totalWords:j.length,translatedFromDB:Object.keys(o).length,cached:Object.keys(a).length,finalTranslations:m}),N(m)}catch(o){console.error("Error getting translations:",o);const e={};j.forEach(s=>{e[s]=s}),N(e)}finally{f(!1)}}else N({...a})})()},[j,_]);return 0===j.length?null:s.jsx(m,{className:"rounded-3xl shadow-sm",style:{backgroundColor:(null==(r=null==t?void 0:t.colors)?void 0:r.cardBackground)||"#ffffff",borderColor:(null==(n=null==t?void 0:t.colors)?void 0:n.cardBorder)||"#e5e7eb",...null==(o=null==t?void 0:t.styles)?void 0:o.cardStyle},children:s.jsx(p,{className:"p-0",children:b?s.jsx("div",{className:"p-6 text-sm text-muted-foreground",children:"Loading translations‚Ä¶"}):0===j.length?s.jsx("div",{className:"p-6 text-sm text-muted-foreground",children:"No vocabulary found."}):s.jsx("div",{className:"divide-y",children:j.map(e=>{var a,r,n,o;const c=w[e]||e,d=x.has(e);return s.jsxs("div",{className:"p-4 flex items-center justify-between transition-colors cursor-pointer group",style:{backgroundColor:"transparent"},onMouseEnter:e=>{var s;e.currentTarget.style.backgroundColor=(null==(s=null==t?void 0:t.colors)?void 0:s.hoverBackground)||"rgba(0,0,0,0.05)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium transition-colors",style:{color:(null==(a=null==t?void 0:t.colors)?void 0:a.textPrimary)||"#111827"},onMouseEnter:e=>{var s;e.currentTarget.style.color=(null==(s=null==t?void 0:t.colors)?void 0:s.buttonPrimary)||"#3b82f6"},onMouseLeave:e=>{var s;e.currentTarget.style.color=(null==(s=null==t?void 0:t.colors)?void 0:s.textPrimary)||"#111827"},children:e}),s.jsx("div",{className:"text-sm font-medium",style:{color:(null==(r=null==t?void 0:t.colors)?void 0:r.textSecondary)||"#6b7280"},children:c}),s.jsx("div",{className:"text-xs text-muted-foreground mt-1 opacity-0 group-hover:opacity-100 transition-opacity",children:"Click to add to your vocabulary book"})]}),s.jsx(g,{size:"sm",variant:"outline",onClick:()=>(async e=>{var s;if(l){k(s=>new Set(s).add(e));try{const a=w[e]||e,{data:t,error:r}=await L.functions.invoke("add-to-word-book",{body:{word:e,translation:a,part_of_speech:"noun"}});if(r){if(!(null==(s=r.message)?void 0:s.includes("already_exists")))throw r;i({title:"Word already added",description:`"${e}" is already in your vocabulary book.`})}else i({title:"Word added!",description:`"${e}" has been added to your vocabulary book.`})}catch(a){console.error("Error adding word to book:",a),i({title:"Error",description:"Failed to add word to your vocabulary book. Please try again.",variant:"destructive"})}finally{k(s=>{const a=new Set(s);return a.delete(e),a})}}else i({title:"Authentication required",description:"Please sign in to add words to your vocabulary book.",variant:"destructive"})})(e),disabled:d,style:{borderColor:(null==(n=null==t?void 0:t.colors)?void 0:n.border)||"#e5e7eb",color:(null==(o=null==t?void 0:t.colors)?void 0:o.textPrimary)||"#111827"},onMouseEnter:e=>{var s,a;e.currentTarget.style.backgroundColor=(null==(s=null==t?void 0:t.colors)?void 0:s.hoverBackground)||"rgba(0,0,0,0.05)",e.currentTarget.style.borderColor=(null==(a=null==t?void 0:t.colors)?void 0:a.buttonPrimary)||"#3b82f6"},onMouseLeave:e=>{var s;e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.borderColor=(null==(s=null==t?void 0:t.colors)?void 0:s.border)||"#e5e7eb"},children:d?s.jsx(h,{className:"w-3 h-3 animate-spin"}):s.jsx(v,{className:"w-3 h-3"})})]},e)})})})})},D=(e,s)=>"original"===s?"error"===e?"bg-destructive/10 text-destructive border-b-2 border-destructive/50":"text-text-primary":"improvement"===e?"bg-brand-green/10 text-brand-green border-b-2 border-brand-green/50":"text-text-primary",R=new Set(["the","a","an","and","or","but","if","then","so","because","as","of","to","in","on","at","by","for","with","about","into","over","after","before","from","is","are","was","were","be","been","being","it","its","this","that","these","those","their","there","here","also","very","much","more","most","many","few","some","any","than","both","either","neither","not","no","do","does","did","can","could","should","would","may","might","will","shall","i","you","he","she","we","they","one","two","three"]),W=e=>{const s=e.toLowerCase().replace(/[^a-z'-]/g,"");return!!s&&(!R.has(s)&&s.length>=4)},O=(e,s)=>{const a=e=>("improvement"===e.status||"error"===e.status)&&e.text.trim().split(/\s+/).length>=4,t=[];for(const r of e){if(!a(r)){t.push(r);continue}const e=r.text.split(/(\b[^\s]+\b)/g).filter(e=>e.length>0);for(const s of e){/\b[^\s]+\b/.test(s)&&W(s)?t.push({text:s,status:r.status}):t.push({text:s,status:"neutral"})}}return t},z=(e,s)=>{const a=e.split(/[.!?]+/).filter(e=>e.trim().length>0),t=[];let r=e;s&&s.length>0?(s.forEach(e=>{if(e.sentence_quote&&e.improved_version){const s=e.sentence_quote.trim(),n=e.improved_version.trim();r=r.replace(s,n);const o=a.find(e=>e.includes(s));if(o){const a=o.trim()+".",r=o.replace(s,n).trim()+".",l=((e,s)=>{const a=e.split(/\s+/),t=s.split(/\s+/),r=a.length,n=t.length,o=[],l=new Set,i=new Set;for(let g=0;g<r;g++)for(let e=0;e<n;e++)if(!l.has(g)&&!i.has(e)&&a[g]===t[e]){o.push({origIndex:g,impIndex:e,word:a[g]}),l.add(g),i.add(e);break}o.sort((e,s)=>e.origIndex-s.origIndex);const c=[],d=[],u=(e,s,a)=>{if(0===s.length)return;const t=s.replace(/\s+/g," ").trim();t&&e.push({text:t+" ",status:a})};let m=0;for(const g of o){if(g.origIndex>m){const e=a.slice(m,g.origIndex);if(e.length>0){const s=e.join(" ");s.trim()&&u(c,s,"error")}}u(c,g.word,"neutral"),m=g.origIndex+1}if(m<r){const e=a.slice(m);if(e.length>0){const s=e.join(" ");s.trim()&&u(c,s,"error")}}let p=0;for(const g of o){if(g.impIndex>p){const e=t.slice(p,g.impIndex);if(e.length>0){const s=e.join(" ");s.trim()&&u(d,s,"improvement")}}u(d,g.word,"neutral"),p=g.impIndex+1}if(p<n){const e=t.slice(p);if(e.length>0){const s=e.join(" ");s.trim()&&u(d,s,"improvement")}}return 0===c.length&&c.push({text:e,status:"neutral"}),0===d.length&&d.push({text:s,status:"neutral"}),{origSpans:c,impSpans:d}})(a,r);t.push({original:a,improved:r,original_spans:l.origSpans,corrected_spans:l.impSpans,issue:e.issue||"Enhancement suggestion",explanation:e.explanation})}}}),a.forEach((e,s)=>{const a=e.trim();a&&!t.some(e=>e.original.includes(a))&&t.push({original:a+".",improved:a+".",issue:`Sentence ${s+1}`,explanation:"This sentence appears to be well-written or no specific improvements were identified."})})):a.forEach((e,s)=>{const a=e.trim();a&&t.push({original:a+".",improved:a+".",issue:`Sentence ${s+1}`,explanation:"No specific improvements suggested for this sentence."})});const n=(e,a)=>{if(!s||0===s.length)return[{text:e,status:"neutral"}];const t=[];let r=e,n=0;return s.forEach(e=>{if(e.sentence_quote&&e.improved_version){const s=e.sentence_quote.trim(),o=e.improved_version.trim(),l=a?o:s,i=r.indexOf(l);-1!==i&&(i>0&&t.push({text:r.substring(0,i),status:"neutral"}),t.push({text:l,status:a?"improvement":"error"}),r=r.substring(i+l.length),n++)}}),r.length>0&&t.push({text:r,status:"neutral"}),0===n?[{text:e,status:"neutral"}]:t.length>0?t:[{text:e,status:"neutral"}]};return{originalSpans:n(e,!1),improvedSpans:n(r,!0),sentences:t}},F=({originalText:e,improvementSuggestions:a,originalSpans:t,correctedSpans:r,sentenceComparisons:n,title:o,loading:l,currentTheme:i})=>{var c,d,h,v,_,y;const[j,w]=u.useState("whole"),{originalSpans:N,improvedSpans:C,sentences:S}=u.useMemo(()=>{if(t&&r&&t.length>0&&r.length>0){const s=t.map(e=>e.text).join("").replace(/\s+/g," ").trim();r.map(e=>e.text).join("").replace(/\s+/g," ").trim();const o=e.replace(/\s+/g," ").trim(),l=s.length/o.length;return s.trim()!==o||l<.5?(console.warn("‚ö†Ô∏è AI-provided spans incomplete, falling back to full text processing",{spansLength:s.length,originalLength:o.length,coverage:l}),z(e,a)):{originalSpans:t,improvedSpans:r,sentences:n||[]}}return z(e,a)},[e,a,t,r,n]);u.useMemo(()=>O(N),[N]),u.useMemo(()=>O(C),[C]);const T=u.useMemo(()=>(S||[]).map(e=>({...e,original_spans:e.original_spans?O(e.original_spans):e.original_spans,corrected_spans:e.corrected_spans?O(e.corrected_spans):e.corrected_spans})),[S]),E=u.useMemo(()=>{if(n&&n.length>0)return n.map(e=>({...e,original_spans:e.original_spans?O(e.original_spans):e.original_spans,corrected_spans:e.corrected_spans?O(e.corrected_spans):e.corrected_spans}));const s=C.map(e=>e.text).join("").trim(),a=e.split(/[.!?]+/).filter(e=>e.trim().length>0).map(e=>e.trim()+"."),t=s.split(/[.!?]+/).filter(e=>e.trim().length>0).map(e=>e.trim()+"."),r=Math.min(a.length,t.length),o=[];for(let e=0;e<r;e++){const s=a[e],r=t[e],n=diffToSpans(s,r);o.push({original:s,improved:r,original_spans:n.origSpans,corrected_spans:n.impSpans})}return o},[C,e,n]),A=u.useMemo(()=>n&&n.length>0?n.map(e=>({...e,original_spans:e.original_spans?O(e.original_spans):e.original_spans,corrected_spans:e.corrected_spans?O(e.corrected_spans):e.corrected_spans})):T.length>0?T:E,[n,T,E]),$=u.useMemo(()=>(e=>{const s=e.length;if(s<=3)return[e];const a=Math.min(2,Math.max(1,Math.floor(.2*s))),t=Math.min(2,Math.max(1,Math.floor(.2*s)));return[e.slice(0,a),e.slice(a,Math.max(a,s-t)),e.slice(Math.max(a,s-t))].filter(e=>e.length>0)})(A),[A]);return e.trim()?l?s.jsxs("div",{className:"mt-6",children:[s.jsx("div",{className:"animate-pulse h-6 w-48 bg-surface-3 rounded mb-4"}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[s.jsx("div",{className:"h-40 bg-surface-3 rounded border border-border"}),s.jsx("div",{className:"h-40 bg-surface-3 rounded border border-border"})]})]}):s.jsxs("div",{className:"mt-6 space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("h4",{className:"text-heading-4",children:["Writing Analysis - ",o]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(g,{size:"sm",onClick:()=>w("whole"),className:"flex items-center gap-2",style:{backgroundColor:"whole"===j?null==(c=null==i?void 0:i.colors)?void 0:c.buttonPrimary:"transparent",color:"whole"===j?"#ffffff":null==(d=null==i?void 0:i.colors)?void 0:d.buttonPrimary,borderColor:null==(h=null==i?void 0:i.colors)?void 0:h.buttonPrimary},children:[s.jsx(b,{className:"w-4 h-4"}),"Whole View"]}),s.jsxs(g,{size:"sm",onClick:()=>w("sentence"),className:"flex items-center gap-2",style:{backgroundColor:"sentence"===j?null==(v=null==i?void 0:i.colors)?void 0:v.buttonPrimary:"transparent",color:"sentence"===j?"#ffffff":null==(_=null==i?void 0:i.colors)?void 0:_.buttonPrimary,borderColor:null==(y=null==i?void 0:i.colors)?void 0:y.buttonPrimary},children:[s.jsx(B,{className:"w-4 h-4"}),"Sentence by Sentence"]})]})]}),"whole"===j?s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[s.jsxs(m,{className:"border border-destructive/20 bg-surface-1 rounded-3xl shadow-sm",children:[s.jsx(f,{className:"pb-3",children:s.jsxs(x,{className:"text-base flex items-center gap-2",children:[s.jsx("span",{className:"w-3 h-3 bg-destructive/20 rounded-full"}),"Your Writing",s.jsx(k,{variant:"outline",className:"text-xs text-destructive",children:"Issues highlighted"})]})}),s.jsx(p,{children:s.jsx("div",{className:"text-sm whitespace-pre-wrap break-words space-y-6",children:$.map((e,a)=>s.jsx("div",{className:"space-y-2",children:e.map((e,t)=>s.jsx("p",{className:"leading-relaxed",children:(e.original_spans&&e.original_spans.length?e.original_spans:[{text:e.original||"",status:"neutral"}]).map((e,r)=>s.jsx("span",{className:D(e.status,"original"),children:e.text},`whole-orig-span-${a}-${t}-${r}`))},`whole-orig-${a}-${t}`))},`orig-group-${a}`))})})]}),s.jsxs(m,{className:"border border-brand-green/20 bg-surface-1 rounded-3xl shadow-sm",children:[s.jsx(f,{className:"pb-3",children:s.jsxs(x,{className:"text-base flex items-center gap-2",children:[s.jsx("span",{className:"w-3 h-3 bg-brand-green/20 rounded-full"}),"AI Suggested Improvements",s.jsx(k,{variant:"outline",className:"text-xs text-brand-green",children:"Enhancements highlighted"})]})}),s.jsx(p,{children:s.jsx("div",{className:"text-sm whitespace-pre-wrap break-words space-y-6",children:$.map((e,a)=>s.jsx("div",{className:"space-y-2",children:e.map((e,t)=>s.jsx("p",{className:"leading-relaxed",children:(e.corrected_spans&&e.corrected_spans.length?e.corrected_spans:[{text:e.improved||"",status:"neutral"}]).map((e,r)=>s.jsx("span",{className:D(e.status,"improved"),children:e.text},`whole-imp-span-${a}-${t}-${r}`))},`whole-imp-${a}-${t}`))},`imp-group-${a}`))})})]})]}):s.jsx("div",{className:"space-y-4",children:A.length>0?A.map((e,a)=>s.jsx(m,{className:"border border-border",children:s.jsxs(p,{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[s.jsx("div",{className:"space-y-2",children:s.jsx("div",{className:"p-3 bg-destructive/5 border border-destructive/20 rounded-lg",children:s.jsx("div",{className:"text-sm leading-relaxed whitespace-pre-wrap break-words",children:e.original_spans?e.original_spans.map((e,a)=>s.jsx("span",{className:D(e.status,"original"),children:e.text},`orig-${a}`)):e.original})})}),s.jsx("div",{className:"space-y-2",children:s.jsx("div",{className:"p-3 bg-brand-green/5 border border-brand-green/20 rounded-lg",children:s.jsx("div",{className:"text-sm leading-relaxed whitespace-pre-wrap break-words",children:e.corrected_spans?e.corrected_spans.map((e,a)=>s.jsx("span",{className:D(e.status,"improved"),children:e.text},`corr-${a}`)):e.improved})})})]}),e.explanation&&s.jsxs("div",{className:"p-3 bg-surface-2 border border-border rounded-lg",children:[s.jsx("p",{className:"text-xs uppercase tracking-wide text-text-tertiary mb-1",children:"Explanation"}),s.jsx("p",{className:"text-sm text-text-secondary",children:"string"==typeof e.explanation?e.explanation:"object"==typeof e.explanation&&e.explanation.explanation?e.explanation.explanation:"Improvement suggestion available."})]})]})},a)):s.jsx(m,{className:"border border-border",children:s.jsxs(p,{className:"py-6 text-center",children:[s.jsx("p",{className:"text-text-secondary",children:"No specific sentence-level improvements available for this task."}),s.jsx("p",{className:"text-sm text-text-tertiary mt-1",children:"Use the whole view to see your complete writing."})]})})}),s.jsx(q,{improvementSpans:u.useMemo(()=>A.flatMap(e=>(e.corrected_spans||[]).filter(e=>"improvement"===e.status)),[A]),title:"Useful Vocabulary from Improvements",currentTheme:i})]}):null},U=e=>"number"!=typeof e||Number.isNaN(e)?NaN:Math.min(9,Math.max(0,Math.round(2*e)/2)),G=(e,s)=>{var a,t,r,n,o;if(!e)return NaN;const l=e.criteria||{},i=[];if("task1"===s?"number"==typeof(null==(a=l.task_achievement)?void 0:a.band)&&i.push(l.task_achievement.band):"number"==typeof(null==(t=l.task_response)?void 0:t.band)&&i.push(l.task_response.band),"number"==typeof(null==(r=l.coherence_and_cohesion)?void 0:r.band)&&i.push(l.coherence_and_cohesion.band),"number"==typeof(null==(n=l.lexical_resource)?void 0:n.band)&&i.push(l.lexical_resource.band),"number"==typeof(null==(o=l.grammatical_range_and_accuracy)?void 0:o.band)&&i.push(l.grammatical_range_and_accuracy.band),0===i.length)return"number"==typeof e.overall_band?U(e.overall_band):NaN;const c=i.reduce((e,s)=>e+s,0)/i.length;return U(c)};function K(){var e,a,t,r,n,o,l,i,h,v,b,B,q,D,R,W,O;const z=_(),K=y(),{user:V}=c(),{toast:Y}=d();j();const[H,J]=u.useState(!1),[Q,X]=u.useState("note"),[Z,ee]=u.useState({}),se=u.useRef(null);u.useEffect(()=>{const e=z.state,s=null==e?void 0:e.submissionId;s&&se.current!==s&&(se.current=null),e&&e.structured?ee(e):(null==e?void 0:e.submissionId)&&V?ae(e.submissionId):ee({})},[z.state,V]);const ae=async e=>{var s,a,t,r,n,o;J(!0);try{console.log("üîç Fetching results from database for submission:",e);const{data:l,error:i}=await L.from("test_results").select("*").eq("id",e).eq("user_id",null==V?void 0:V.id).single();if(i)throw console.error("‚ùå Error fetching test result:",i),i;console.log("‚úÖ Test result fetched:",l);const{data:c,error:d}=await L.from("writing_test_results").select("*").eq("test_result_id",e).eq("user_id",null==V?void 0:V.id).order("task_number");if(d)throw console.error("‚ùå Error fetching writing results:",d),d;if(console.log("‚úÖ Writing results fetched:",c),!c||c.length<2)throw console.warn("‚ö†Ô∏è Incomplete writing results found:",(null==c?void 0:c.length)||0),new Error("Incomplete test results found");const u=c.find(e=>1===e.task_number),m=c.find(e=>2===e.task_number),p=e=>{if(!e||"object"!=typeof e)return 6.5;const s=[];for(const[a,t]of Object.entries(e))if(t&&"object"==typeof t&&"band"in t){const e=t.band;"number"==typeof e&&e>=0&&e<=9&&s.push(e)}return s.length>0?Math.round(s.reduce((e,s)=>e+s,0)/s.length*2)/2:6.5},g=(e,s)=>{const a="Original analysis incomplete - criterion score not provided in assessment",t="task1"===s?{task_achievement:{band:0,justification:a},coherence_and_cohesion:{band:0,justification:a},lexical_resource:{band:0,justification:a},grammatical_range_and_accuracy:{band:0,justification:a}}:{task_response:{band:0,justification:a},coherence_and_cohesion:{band:0,justification:a},lexical_resource:{band:0,justification:a},grammatical_range_and_accuracy:{band:0,justification:a}};if(!e||"object"!=typeof e)return console.warn(`‚ö†Ô∏è Missing or invalid criteria for ${s} - analysis incomplete`),t;const r={};for(const[o,l]of Object.entries(e))l&&"object"==typeof l&&"band"in l&&(r[o]=l);const n="task1"===s?["task_achievement","coherence_and_cohesion","lexical_resource","grammatical_range_and_accuracy"]:["task_response","coherence_and_cohesion","lexical_resource","grammatical_range_and_accuracy"];for(const o of n)r[o]||(r[o]={band:0,justification:a});return r},h=l.test_data,v=(null==h?void 0:h.overall_band)||l.overall_score||.33*p(null==u?void 0:u.band_scores)+.67*p(null==m?void 0:m.band_scores),b={structured:{task1:{criteria:g(null==u?void 0:u.band_scores,"task1"),overall_band:p(null==u?void 0:u.band_scores),feedback_markdown:(null==u?void 0:u.detailed_feedback)||"### Task 1 Assessment\n\nDetailed feedback was not available for this task.",feedback:{strengths:["Response was submitted successfully"],improvements:(null==u?void 0:u.improvement_suggestions)||["Retake test for detailed feedback"]}},task2:{criteria:g(null==m?void 0:m.band_scores,"task2"),overall_band:p(null==m?void 0:m.band_scores),feedback_markdown:(null==m?void 0:m.detailed_feedback)||"### Task 2 Assessment\n\nDetailed feedback was not available for this task.",feedback:{strengths:["Response was submitted successfully"],improvements:(null==m?void 0:m.improvement_suggestions)||["Retake test for detailed feedback"]}},overall:{band:v,calculation:"Database reconstruction: Task 1 + Task 2 weighted average",feedback_markdown:`### Overall IELTS Writing Band Score: ${v}\n\nThis score was reconstructed from saved test data.`},full_report_markdown:`# IELTS Writing Assessment Results\n\n## Overall Band Score: ${v}\n\nThis assessment was reconstructed from your saved test results. For the most accurate and detailed feedback, please take a new test.`},testName:l.test_type||"IELTS Writing Test",task1Answer:(null==u?void 0:u.user_response)||null,task2Answer:(null==m?void 0:m.user_response)||null,task1Skipped:!u,task2Skipped:!m,task1Data:{title:(null==(s=null==h?void 0:h.task1Data)?void 0:s.title)||"Task 1",instructions:(null==u?void 0:u.prompt_text)||(null==(a=null==h?void 0:h.task1Data)?void 0:a.instructions)||"Task 1 Instructions",imageUrl:(null==(t=null==h?void 0:h.task1Data)?void 0:t.imageUrl)||null,imageContext:(null==(r=null==h?void 0:h.task1Data)?void 0:r.imageContext)||null},task2Data:{title:(null==(n=null==h?void 0:h.task2Data)?void 0:n.title)||"Task 2",instructions:(null==m?void 0:m.prompt_text)||(null==(o=null==h?void 0:h.task2Data)?void 0:o.instructions)||"Task 2 Instructions"}};console.log("‚úÖ Reconstructed data:",b),ee(b)}catch(l){console.error("‚ùå Error fetching results:",l),Y({title:"Error",description:"Failed to load test results. Please try taking the test again.",variant:"destructive"})}finally{J(!1)}};u.useEffect(()=>{(async()=>{var e,s,a,t,r,n,o,l,i,c,d,u,m,p;if(!Z||!V)return;const g=(null==(e=z.state)?void 0:e.submissionId)||(null==Z?void 0:Z.submissionId);if(se.current===g)return void console.log("‚úÖ Submission already processed, skipping generation");const h=g||`${null==(s=Z.task1Answer)?void 0:s.slice(0,50)}_${null==(a=Z.task2Answer)?void 0:a.slice(0,50)}`;if(se.current===h)return void console.log("‚úÖ Content already processed, skipping generation");const v=Z.structured;if(!v)return;const b=(null==(t=null==v?void 0:v.task1)?void 0:t.sentence_comparisons)&&Array.isArray(v.task1.sentence_comparisons)&&v.task1.sentence_comparisons.length>0&&v.task1.original_spans&&v.task1.corrected_spans,f=(null==(r=null==v?void 0:v.task2)?void 0:r.sentence_comparisons)&&Array.isArray(v.task2.sentence_comparisons)&&v.task2.sentence_comparisons.length>0&&v.task2.original_spans&&v.task2.corrected_spans;if(b&&f)return void(se.current=g||h);if(b&&!Z.task2Answer||f&&!Z.task1Answer)return void(se.current=g||h);const x=!!Z.task1Answer&&!b,k=!!Z.task2Answer&&!f;if(x||k){console.log("üîÑ Generating sentence_comparisons on-demand (ONE TIME ONLY)..."),se.current=g||h;try{J(!0);const e={...v},s=e=>(e||[]).map(e=>e.text).join(""),a=(e=[])=>e.map(e=>({issue:"Rewrite for clarity and accuracy",sentence_quote:s(e.original_spans),improved_version:s(e.corrected_spans),explanation:"This rewrite improves grammar, vocabulary, and cohesion while preserving your original meaning."}));if(x&&Z.task1Answer){const{data:s,error:t}=await L.functions.invoke("writing-feedback",{body:{writing:Z.task1Answer,prompt:(null==(n=Z.task1Data)?void 0:n.title)||(null==(o=Z.task1Data)?void 0:o.instructions),taskType:"Task 1"}});if(!t&&(null==s?void 0:s.structured)){e.task1=e.task1||{criteria:{}},e.task1.feedback=e.task1.feedback||{},e.task1.sentence_comparisons=s.structured.sentence_comparisons||[];const t=a(e.task1.sentence_comparisons);e.task1.feedback.improvements_detailed=s.structured.improvements_detailed||t,e.task1.feedback.improvements=s.structured.improvements||t,e.task1.feedback_markdown=s.structured.feedback_markdown||e.task1.feedback_markdown,g&&await L.from("writing_test_results").update({detailed_feedback:e.task1.feedback_markdown||"",improvement_suggestions:((null==(l=e.task1.feedback)?void 0:l.improvements)||[]).filter(e=>"string"==typeof e)}).eq("test_result_id",g).eq("user_id",V.id).eq("task_number",1)}}if(k&&Z.task2Answer){const{data:s,error:t}=await L.functions.invoke("writing-feedback",{body:{writing:Z.task2Answer,prompt:(null==(i=Z.task2Data)?void 0:i.title)||(null==(c=Z.task2Data)?void 0:c.instructions),taskType:"Task 2"}});if(!t&&(null==s?void 0:s.structured)){e.task2=e.task2||{criteria:{}},e.task2.feedback=e.task2.feedback||{},e.task2.sentence_comparisons=s.structured.sentence_comparisons||[];const t=a(e.task2.sentence_comparisons);e.task2.feedback.improvements_detailed=s.structured.improvements_detailed||t,e.task2.feedback.improvements=s.structured.improvements||t,e.task2.feedback_markdown=s.structured.feedback_markdown||e.task2.feedback_markdown,g&&await L.from("writing_test_results").update({detailed_feedback:e.task2.feedback_markdown||"",improvement_suggestions:((null==(d=e.task2.feedback)?void 0:d.improvements)||[]).filter(e=>"string"==typeof e)}).eq("test_result_id",g).eq("user_id",V.id).eq("task_number",2)}}x&&(null==(u=e.task1)?void 0:u.sentence_comparisons)&&e.task1.sentence_comparisons.length>0||k&&(null==(m=e.task2)?void 0:m.sentence_comparisons)&&e.task2.sentence_comparisons.length>0?(ee(s=>({...s,structured:e})),console.log("‚úÖ sentence_comparisons generated and updated (ONE TIME)")):console.log("‚úÖ No changes needed, skipping state update")}catch(_){console.error("‚ö†Ô∏è On-demand feedback generation failed:",_);const e=(null==(p=z.state)?void 0:p.submissionId)||(null==Z?void 0:Z.submissionId);se.current===e&&(se.current=null)}finally{J(!1)}}else se.current=g||h})()},[null==(e=z.state)?void 0:e.submissionId,null==Z?void 0:Z.submissionId,null==V?void 0:V.id]);const{structured:te,testName:re,task1Data:ne,task2Data:oe,task1Answer:le,task2Answer:ie}=Z;u.useEffect(()=>{document.title=`IELTS Writing Results ‚Äì ${re||"Assessment"}`;const e=document.querySelector('meta[name="description"]');if(e)e.content="Professional IELTS Writing assessment with detailed per-criterion bands and feedback.";else{const e=document.createElement("meta");e.name="description",e.content="Professional IELTS Writing assessment with detailed per-criterion bands and feedback.",document.head.appendChild(e)}},[re]);!(te&&(te.task1||te.task2))&&te&&(console.warn("‚ö†Ô∏è Structured data exists but lacks task data, creating minimal fallback"),te.task1=te.task1||{criteria:{task_achievement:{band:6.5,justification:"Minimal assessment available"},coherence_and_cohesion:{band:6.5,justification:"Minimal assessment available"},lexical_resource:{band:6.5,justification:"Minimal assessment available"},grammatical_range_and_accuracy:{band:6.5,justification:"Minimal assessment available"}},overall_band:6.5,feedback:{strengths:["Response provided"],improvements:["Retake for detailed feedback"]},feedback_markdown:"Assessment data incomplete."},te.task2=te.task2||{criteria:{task_response:{band:6.5,justification:"Minimal assessment available"},coherence_and_cohesion:{band:6.5,justification:"Minimal assessment available"},lexical_resource:{band:6.5,justification:"Minimal assessment available"},grammatical_range_and_accuracy:{band:6.5,justification:"Minimal assessment available"}},overall_band:6.5,feedback:{strengths:["Response provided"],improvements:["Retake for detailed feedback"]},feedback_markdown:"Assessment data incomplete."});if(!(te&&(te.task1||te.task2)))return s.jsx("div",{className:"min-h-screen bg-surface-2 flex items-center justify-center",children:s.jsxs(m,{className:"max-w-md mx-4",children:[s.jsx(f,{className:"text-center",children:s.jsx(x,{className:"text-heading-3 text-destructive",children:"Results Not Available"})}),s.jsxs(p,{className:"text-center space-y-4",children:[s.jsx("p",{style:{color:"#8B6914"},children:"We couldn't find your test results. This usually happens when:"}),s.jsxs("ul",{className:"text-sm text-left space-y-1",style:{color:"#8B6914"},children:[s.jsx("li",{children:"‚Ä¢ You navigated directly to this page"}),s.jsx("li",{children:"‚Ä¢ You refreshed the page"}),s.jsx("li",{children:"‚Ä¢ The test session expired"})]}),s.jsxs("div",{className:"flex flex-col gap-2 pt-4",children:[s.jsx(g,{onClick:()=>K("/ielts-portal"),className:"w-full",children:"Take New Test"}),s.jsx(g,{variant:"outline",onClick:()=>K("/dashboard"),className:"w-full",children:"Back to Dashboard"})]})]})]})});const ce=G(null==te?void 0:te.task1,"task1"),de=G(null==te?void 0:te.task2,"task2"),ue=Z.task1Skipped||!Z.task1Answer||!Z.task1Answer.trim(),me=Z.task2Skipped||!Z.task2Answer||!Z.task2Answer.trim(),pe=!ue&&!Number.isNaN(ce),ge=!me&&!Number.isNaN(de),he=(pe?1:0)+(ge?2:0),ve=e=>Number.isNaN(e)||e<0?0:e>9?9:e,be=pe?ve(ce):0,fe=ge?ve(de):0,xe=he>0?U((be+2*fe)/he):pe?U(be):ge?U(fe):0,ke=M[Q]||M.note,_e=({title:e,task:a,type:t,computedOverall:r,userAnswer:n,isSkipped:o})=>{var l,i,c,d,u,g,h,v,b,_,y,j,w,N,C,S,T,E,A,$,M;if(o||!n||!n.trim())return s.jsxs(m,{className:"rounded-3xl shadow-lg mb-8",style:{backgroundColor:ke.colors.cardBackground,borderColor:ke.colors.cardBorder,...ke.styles.cardStyle},children:[s.jsx(f,{className:"bg-gradient-to-r from-amber-50 to-amber-100",children:s.jsxs(x,{className:"flex items-center gap-2 text-amber-700",children:[s.jsx("div",{className:"p-2 rounded-xl bg-amber-200",children:"task1"===t?"Task 1":"Task 2"}),e," - Skipped"]})}),s.jsxs(p,{className:"p-6 text-center",children:[s.jsx(k,{variant:"outline",className:"text-amber-600 border-amber-300 bg-amber-50 rounded-full px-4 py-2 mb-2",children:"This task was skipped"}),s.jsx("p",{className:"text-sm mt-2",style:{color:"#8B6914"},children:"No assessment available for this task"})]})]});if(!a)return null;const I=a.criteria||{},L=["task1"===t?{label:"Task Achievement",value:null==(l=I.task_achievement)?void 0:l.band,just:null==(i=I.task_achievement)?void 0:i.justification}:{label:"Task Response",value:null==(c=I.task_response)?void 0:c.band,just:null==(d=I.task_response)?void 0:d.justification},{label:"Coherence & Cohesion",value:null==(u=I.coherence_and_cohesion)?void 0:u.band,just:null==(g=I.coherence_and_cohesion)?void 0:g.justification},{label:"Lexical Resource",value:null==(h=I.lexical_resource)?void 0:h.band,just:null==(v=I.lexical_resource)?void 0:v.justification},{label:"Grammar Range & Accuracy",value:null==(b=I.grammatical_range_and_accuracy)?void 0:b.band,just:null==(_=I.grammatical_range_and_accuracy)?void 0:_.justification}],B="number"!=typeof r||Number.isNaN(r)?"number"==typeof a.overall_band?U(a.overall_band):NaN:U(r);return s.jsxs(m,{className:"rounded-3xl shadow-lg mb-8",style:{backgroundColor:ke.colors.cardBackground,borderColor:ke.colors.cardBorder,...ke.styles.cardStyle},children:[s.jsx(f,{style:{backgroundColor:ke.colors.cardBackground,borderBottom:`1px solid ${ke.colors.border}`},children:s.jsxs(x,{className:"text-heading-3 flex items-center justify-between",style:{color:"#5D4E37"},children:[s.jsx("span",{children:e}),!Number.isNaN(B)&&s.jsxs(k,{variant:"outline",className:"rounded-2xl text-sm",children:["Overall: ",B.toFixed(1)]})]})}),s.jsxs(p,{className:"p-6",children:[s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:L.map(e=>s.jsxs("div",{className:"rounded-2xl p-4 border",style:{backgroundColor:ke.colors.hoverBackground,borderColor:ke.colors.border,color:ke.colors.textPrimary},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("p",{className:"text-sm font-medium",style:{color:ke.colors.textPrimary},children:e.label}),s.jsx(k,{variant:"outline",className:"rounded-xl",style:{borderColor:ke.colors.buttonPrimary,color:ke.colors.buttonPrimary},children:"number"==typeof e.value?U(e.value).toFixed(1):"-"})]}),e.just?s.jsx("div",{className:"mt-2 text-sm",style:{color:ke.colors.textSecondary},children:e.just}):null]},e.label))}),((null==(j=null==(y=a.feedback)?void 0:y.strengths)?void 0:j.length)||(null==(N=null==(w=a.feedback)?void 0:w.improvements)?void 0:N.length)||(null==(S=null==(C=a.feedback)?void 0:C.improvements_detailed)?void 0:S.length))&&s.jsx("div",{className:"mt-6 space-y-6",children:(null==(E=null==(T=a.feedback)?void 0:T.strengths)?void 0:E.length)?s.jsxs("div",{children:[s.jsx("h4",{className:"text-heading-4 mb-2",style:{color:"#5D4E37"},children:"Key strengths"}),s.jsx("ul",{className:"list-disc pl-5 space-y-1 text-sm",style:{color:ke.colors.textSecondary},children:a.feedback.strengths.map((e,a)=>s.jsx("li",{children:e},a))})]}):null}),n&&s.jsx(F,{originalText:n,improvementSuggestions:(null==($=null==(A=a.feedback)?void 0:A.improvements)?void 0:$.map(e=>"string"==typeof e?{issue:"General Improvement",sentence_quote:"",improved_version:e,explanation:e}:e&&"object"==typeof e?{issue:e.issue||"Improvement",sentence_quote:e.original||e.sentence_quote||"",improved_version:e.improved||e.improved_version||"",explanation:e.explanation||"Suggested improvement"}:{issue:"Improvement",sentence_quote:"",improved_version:String(e||""),explanation:String(e||"")}))||(null==(M=a.feedback)?void 0:M.improvements_detailed)||[],originalSpans:a.original_spans,correctedSpans:a.corrected_spans,sentenceComparisons:a.sentence_comparisons,title:e,currentTheme:ke})]})]})};return s.jsxs("div",{className:"min-h-screen relative",style:{backgroundColor:"transparent"},children:[s.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"none",backgroundColor:"#F5E6D3"}}),s.jsx(w,{raysOrigin:"top-center",raysColor:"#4F46E5",raysSpeed:.5,lightSpread:2,rayLength:1.5,pulsating:!1,fadeDistance:1.2,saturation:.8,followMouse:!0,mouseInfluence:.05,noiseAmount:.1,distortion:.2}),s.jsxs("div",{className:"relative z-10",children:[s.jsx("div",{className:"border-b sticky top-0 z-10",style:{backgroundColor:ke.colors.cardBackground,borderColor:ke.colors.border},children:s.jsxs("div",{className:"container mx-auto px-6 py-4 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs(g,{variant:"ghost",onClick:()=>K("/dashboard"),className:"hover:bg-surface-3 rounded-xl",children:[s.jsx(N,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]}),s.jsx("div",{children:s.jsx("h1",{className:"text-heading-2",style:{color:"#5D4E37"},children:"IELTS Writing Results"})})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(C,{className:"w-4 h-4",style:{color:"#8B6914"}}),s.jsxs(S,{value:Q,onValueChange:X,children:[s.jsx(T,{className:"w-[140px] h-9",children:s.jsx(E,{placeholder:"Theme"})}),s.jsx(A,{children:[{value:"note",label:"Note",description:"Warm paper-like appearance"}].map(e=>s.jsx($,{value:e.value,children:e.label},e.value))})]})]})]})}),s.jsxs("div",{className:"container mx-auto px-6 space-section",children:[s.jsxs(m,{className:"rounded-3xl mb-8 overflow-hidden",style:{backgroundColor:ke.colors.cardBackground,borderColor:ke.colors.cardBorder,...ke.styles.cardStyle},children:[s.jsx(f,{className:"text-center py-6",style:{backgroundColor:ke.colors.cardBackground,borderBottom:`1px solid ${ke.colors.border}`},children:s.jsx(x,{className:"text-heading-3",style:{color:"#5D4E37"},children:"Overall Writing Band Score"})}),s.jsx(p,{className:"py-6",children:s.jsxs("div",{className:"flex flex-col lg:flex-row items-center justify-center gap-6 lg:gap-8",children:[s.jsx(I,{size:"md",className:"shrink-0"}),s.jsxs("div",{className:"text-center lg:text-left",children:[s.jsx("p",{className:"text-caption uppercase tracking-wide mb-1",style:{color:"#8B6914"},children:"Overall Band"}),s.jsx("div",{className:"text-6xl font-bold mb-3",style:{background:`linear-gradient(to right, ${ke.colors.buttonPrimary}, ${ke.colors.buttonPrimaryHover})`,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:xe.toFixed(1)}),s.jsx("div",{className:"flex items-center gap-3 justify-center lg:justify-start",children:s.jsx(k,{variant:"outline",className:"text-base px-3 py-1.5 rounded-2xl",style:{color:ke.colors.buttonPrimary,borderColor:ke.colors.buttonPrimary,backgroundColor:ke.colors.hoverBackground},children:"Performance"})})]}),s.jsx(P,{task1Scores:!ue&&(null==te?void 0:te.task1)?{task_achievement:null==(t=null==(a=te.task1.criteria)?void 0:a.task_achievement)?void 0:t.band,coherence_and_cohesion:null==(n=null==(r=te.task1.criteria)?void 0:r.coherence_and_cohesion)?void 0:n.band,lexical_resource:null==(l=null==(o=te.task1.criteria)?void 0:o.lexical_resource)?void 0:l.band,grammatical_range_and_accuracy:null==(h=null==(i=te.task1.criteria)?void 0:i.grammatical_range_and_accuracy)?void 0:h.band}:void 0,task2Scores:!me&&(null==te?void 0:te.task2)?{task_response:null==(b=null==(v=te.task2.criteria)?void 0:v.task_response)?void 0:b.band,coherence_and_cohesion:null==(q=null==(B=te.task2.criteria)?void 0:B.coherence_and_cohesion)?void 0:q.band,lexical_resource:null==(R=null==(D=te.task2.criteria)?void 0:D.lexical_resource)?void 0:R.band,grammatical_range_and_accuracy:null==(O=null==(W=te.task2.criteria)?void 0:W.grammatical_range_and_accuracy)?void 0:O.band}:void 0,className:"w-full max-w-sm lg:w-80 shrink-0"})]})})]}),((null==ne?void 0:ne.instructions)||(null==ne?void 0:ne.imageUrl))&&s.jsxs(m,{className:"rounded-3xl shadow-lg mb-8",style:{backgroundColor:ke.colors.cardBackground,borderColor:ke.colors.cardBorder,...ke.styles.cardStyle},children:[s.jsx(f,{children:s.jsx(x,{className:"text-heading-4",style:{color:"#5D4E37"},children:"Task 1 Instruction"})}),s.jsx(p,{children:s.jsxs("div",{className:"space-y-3",children:[(null==ne?void 0:ne.imageUrl)&&s.jsx("div",{className:"rounded-xl overflow-hidden border border-border bg-white p-2 flex items-center justify-center",children:s.jsx("img",{src:ne.imageUrl,alt:"Task 1 visual",className:"max-h-64 object-contain"})}),(null==ne?void 0:ne.instructions)&&s.jsx("div",{className:"text-sm p-4 rounded-lg whitespace-pre-wrap",style:{color:ke.colors.textSecondary,backgroundColor:ke.colors.cardBackground,border:`1px solid ${ke.colors.border}`},children:ne.instructions})]})})]}),s.jsx(_e,{title:"Task 1 Assessment",task:null==te?void 0:te.task1,type:"task1",computedOverall:ce,userAnswer:Z.task1Answer,isSkipped:Z.task1Skipped||!Z.task1Answer||!Z.task1Answer.trim()}),(null==oe?void 0:oe.instructions)&&s.jsxs(m,{className:"rounded-3xl shadow-lg mb-8",style:{backgroundColor:ke.colors.cardBackground,borderColor:ke.colors.cardBorder,...ke.styles.cardStyle},children:[s.jsx(f,{children:s.jsx(x,{className:"text-heading-4",style:{color:"#5D4E37"},children:"Task 2 Instruction"})}),s.jsx(p,{children:s.jsx("div",{className:"text-sm p-4 rounded-lg whitespace-pre-wrap",style:{color:ke.colors.textSecondary,backgroundColor:ke.colors.cardBackground,border:`1px solid ${ke.colors.border}`},children:oe.instructions})})]}),s.jsx(_e,{title:"Task 2 Assessment",task:null==te?void 0:te.task2,type:"task2",computedOverall:de,userAnswer:Z.task2Answer,isSkipped:Z.task2Skipped||!Z.task2Answer||!Z.task2Answer.trim()}),s.jsxs("div",{className:"flex justify-center gap-4",children:[s.jsx(g,{onClick:()=>K("/ielts-portal"),className:"rounded-xl",style:{backgroundColor:ke.colors.buttonPrimary,color:"#ffffff",borderColor:ke.colors.buttonPrimary},children:"Take Another Test"}),s.jsx(g,{onClick:()=>K("/dashboard"),variant:"outline",className:"rounded-xl",style:{borderColor:ke.colors.buttonPrimary,color:ke.colors.buttonPrimary},children:"Return to Dashboard"})]})]})]})]})}export{K as default};
