import{y as e,bf as s,bg as a,bh as t,bi as r,bj as n,j as o,bk as l,bl as i,bm as c,A as d,g as u,r as m,C as p,a as h,B as g,b9 as v,P as b,E as f,b as x,c as k,k as _,a3 as y,u as j,af as w,aa as N,_ as C,S,o as T,p as A,q as E,s as $,ah as M}from"./index-R5Se49EE.js";import{P as I}from"./PenguinClapAnimation-Bdef6Abz.js";import{s as L}from"./supabase-Bqkrifq5.js";import{P as B}from"./palette-BJKHHFml.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=e("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);var q=s({chartName:"BarChart",GraphicalChild:a,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:t},{axisType:"yAxis",AxisComp:r}],formatAxisMap:n});function D({task1Scores:e,task2Scores:s,className:n=""}){const d=(()=>{const a=e||{},t=s||{},r=void 0!==a.task_achievement||void 0!==a.coherence_and_cohesion,n=void 0!==t.task_response||void 0!==t.coherence_and_cohesion;let o,l,i,c;return o=r&&n?((a.task_achievement||0)+(t.task_response||0))/2:r?a.task_achievement||0:n&&t.task_response||0,l=r&&n?((a.coherence_and_cohesion||0)+(t.coherence_and_cohesion||0))/2:r?a.coherence_and_cohesion||0:n&&t.coherence_and_cohesion||0,i=r&&n?((a.lexical_resource||0)+(t.lexical_resource||0))/2:r?a.lexical_resource||0:n&&t.lexical_resource||0,c=r&&n?((a.grammatical_range_and_accuracy||0)+(t.grammatical_range_and_accuracy||0))/2:r?a.grammatical_range_and_accuracy||0:n&&t.grammatical_range_and_accuracy||0,[{criterion:"TA",score:Math.round(2*o)/2,fullName:"Task Achievement"},{criterion:"CC",score:Math.round(2*l)/2,fullName:"Coherence & Cohesion"},{criterion:"LR",score:Math.round(2*i)/2,fullName:"Lexical Resource"},{criterion:"GRA",score:Math.round(2*c)/2,fullName:"Grammar & Accuracy"}]})();if(!d.some(e=>e.score>0))return o.jsx("div",{className:`flex items-center justify-center rounded-lg ${n}`,children:o.jsxs("div",{className:"text-center p-4",children:[o.jsx("div",{className:"text-text-secondary text-sm",children:"Criteria analysis"}),o.jsx("div",{className:"text-text-muted text-xs mt-1",children:"Not available"})]})});const u=e=>{const s=["hsl(var(--brand-blue))","hsl(var(--brand-green))","hsl(var(--brand-purple))","hsl(var(--brand-orange))"];return s[e%s.length]};return o.jsxs("div",{className:`p-4 ${n}`,children:[o.jsx("div",{className:"text-center mb-4",children:o.jsx("div",{className:"text-sm font-medium text-text-primary mb-1",children:"Criteria Analysis"})}),o.jsx(l,{width:"100%",height:200,children:o.jsxs(q,{data:d,margin:{top:30,right:10,left:10,bottom:10},barCategoryGap:"20%",children:[o.jsx(t,{dataKey:"criterion",axisLine:!1,tickLine:!1,tick:{fontSize:12,fontWeight:500,fill:"hsl(var(--text-primary))"}}),o.jsx(r,{domain:[0,9],axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"hsl(var(--text-muted))"},tickCount:5}),o.jsxs(a,{dataKey:"score",radius:[4,4,0,0],animationBegin:0,animationDuration:1200,animationEasing:"ease-out",children:[d.map((e,s)=>o.jsx(i,{fill:u(s)},`cell-${s}`)),o.jsx(c,{dataKey:"score",position:"top",style:{fill:"hsl(var(--text-primary))",fontSize:"12px",fontWeight:"bold"}})]})]})})]})}const R=({improvementSpans:e,title:s="Useful Vocabulary",currentTheme:a})=>{var t,r,n;const{user:l}=d(),{toast:i}=u(),[c,f]=m.useState(!1),[x,k]=m.useState(new Set),[_,y]=m.useState("en");m.useEffect(()=>{(async()=>{if(l)try{const{data:e}=await L.from("profiles").select("native_language").eq("id",l.id).single();if(null==e?void 0:e.native_language){const s=e.native_language.length>2?e.native_language.substring(0,2).toLowerCase():e.native_language.toLowerCase();console.log("üë§ User language from profile:",e.native_language,"‚Üí normalized:",s),y(s)}const{data:s}=await L.from("user_preferences").select("preferred_feedback_language").eq("user_id",l.id).maybeSingle();if(null==s?void 0:s.preferred_feedback_language){const e=s.preferred_feedback_language.length>2?s.preferred_feedback_language.substring(0,2).toLowerCase():s.preferred_feedback_language.toLowerCase();console.log("üë§ User language from preferences:",s.preferred_feedback_language,"‚Üí normalized:",e),y(e)}}catch(e){console.warn("Error loading user language:",e)}})()},[l]);const j=m.useMemo(()=>{const s=new Set;return e.forEach(e=>{if("improvement"===e.status){e.text.toLowerCase().replace(/[^\w\s'-]/g," ").split(/\s+/).filter(e=>{const s=e.trim();return s.length>=3&&!/^\d+$/.test(s)&&!/^[^a-z]*$/.test(s)&&!["the","and","but","for","are","but","not","you","all","can","had","her","was","one","our","out","day","get","has","him","his","how","its","may","new","now","old","see","two","way","who","boy","did","has","let","put","say","she","too","use"].includes(s.toLowerCase())}).forEach(e=>s.add(e.trim()))}}),Array.from(s).slice(0,10)},[e]),[w,N]=m.useState({}),[C,S]=m.useState({});m.useEffect(()=>{(async()=>{var e,s;if(0===j.length||!_||"en"===_){const e={};return j.forEach(s=>{e[s]=s}),void N(e)}const a={},t=[];if(j.forEach(e=>{const s=`${e}_${_}`;C[s]?a[e]=C[s]:t.push(e)}),0!==t.length){f(!0);try{const o={};console.log("üîç Checking vocab_translations + vocab_cards join for language:",_);const{data:l,error:i}=await L.from("vocab_translations").select("\n            translations,\n            lang,\n            vocab_cards!inner(term)\n          ").eq("lang",_).in("vocab_cards.term",j);i?console.error("‚ùå Error querying joined vocab tables:",i):(console.log("üìñ Found",(null==l?void 0:l.length)||0,"joined translation entries"),null==l||l.forEach(e=>{var s;if((null==(s=e.vocab_cards)?void 0:s.term)&&e.translations&&Array.isArray(e.translations)&&e.translations.length>0){const s=e.vocab_cards.term,a=e.translations[0];o[s.toLowerCase()]=a,console.log(`üìñ vocab_translations join: "${s}" ‚Üí "${a}"`)}})),console.log("üîç Checking vocab_cards for",j.length,"words:",j);const{data:c,error:d}=await L.from("vocab_cards").select("term, translation").in("term",j);if(d?console.error("‚ùå Error querying vocab_cards:",d):(console.log("üìö Found",(null==c?void 0:c.length)||0,"translations in vocab_cards"),console.log("üìö Card data sample:",null==c?void 0:c.slice(0,3))),null==c||c.forEach(e=>{e.term&&e.translation&&(o[e.term.toLowerCase()]||(o[e.term.toLowerCase()]=e.translation,console.log(`üìö vocab_cards: "${e.term}" ‚Üí "${e.translation}"`)))}),i||!l||0===l.length){console.log("üîÑ Fallback: querying vocab_translations separately");const{data:e,error:s}=await L.from("vocab_translations").select("card_id, translations").eq("lang",_);if(!s&&e&&e.length>0){const s=e.map(e=>e.card_id).filter(Boolean),{data:a}=await L.from("vocab_cards").select("id, term").in("id",s).in("term",j),t={};null==a||a.forEach(e=>{t[e.term.toLowerCase()]=e.id}),e.forEach(e=>{const s=Object.keys(t).find(s=>t[s]===e.card_id);s&&e.translations&&Array.isArray(e.translations)&&e.translations.length>0&&(o[s]||(o[s]=e.translations[0],console.log(`üìñ vocab_translations fallback: "${s}" ‚Üí "${e.translations[0]}"`)))})}}const u=t.filter(e=>!o[e.toLowerCase()]);if(u.length>0&&_&&"en"!==_){console.log("üåê Translating",u.length,"words to",_,"- Words:",u);try{console.log("üåê Attempting batch translation...");const{data:a,error:t}=await L.functions.invoke("translation-service",{body:{texts:u,sourceLang:"en",targetLang:_,bypassCache:!1}});console.log("üåê Batch translation response:",{success:null==a?void 0:a.success,error:t,resultsCount:null==(e=null==a?void 0:a.results)?void 0:e.length});let n=!1;if(!t&&(null==a?void 0:a.success)&&(null==a?void 0:a.results)){const e=a.results.filter((e,s)=>{const a=u[s];return e&&e.translation&&e.translation!==a});e.length>0?(console.log("‚úÖ Batch translation successful for",e.length,"words"),n=!0,a.results.forEach((e,s)=>{const a=u[s];if(e&&e.translation){const s=e.translation;o[a.toLowerCase()]=s;const t=`${a}_${_}`;S(e=>({...e,[t]:s})),console.log(`‚úÖ Batch: "${a}" ‚Üí "${s}"`)}else o[a.toLowerCase()]=a,console.log(`‚ö†Ô∏è Batch fallback: "${a}" ‚Üí "${a}"`)})):console.warn("‚ö†Ô∏è Batch translation returned no valid translations")}if(!n){console.log("üîÑ Falling back to individual translations...");for(const e of u){try{console.log(`üåê Translating individual word: "${e}"`);const{data:a,error:t}=await L.functions.invoke("translation-service",{body:{text:e,sourceLang:"en",targetLang:_,bypassCache:!1}});if(!t&&(null==a?void 0:a.success)&&(null==(s=null==a?void 0:a.result)?void 0:s.translation)){const s=a.result.translation;o[e.toLowerCase()]=s;const t=`${e}_${_}`;S(e=>({...e,[t]:s})),console.log(`‚úÖ Individual: "${e}" ‚Üí "${s}"`)}else console.warn(`‚ö†Ô∏è Individual translation failed for "${e}":`,t,a),o[e.toLowerCase()]=e}catch(r){console.error(`‚ùå Individual translation error for "${e}":`,r),o[e.toLowerCase()]=e}await new Promise(e=>setTimeout(e,100))}}}catch(n){console.error("‚ùå Translation service error:",n),u.forEach(e=>{o[e.toLowerCase()]=e})}}else u.length>0&&(console.log("üåê Using English fallback for",u.length,"words"),u.forEach(e=>{o[e.toLowerCase()]=e}));const m={};j.forEach(e=>{const s=o[e.toLowerCase()]||a[e]||e;m[e]=s,console.log(`üéØ Final: "${e}" ‚Üí "${s}"`)}),console.log("üéØ Final translations summary:",{totalWords:j.length,translatedFromDB:Object.keys(o).length,cached:Object.keys(a).length,finalTranslations:m}),N(m)}catch(o){console.error("Error getting translations:",o);const e={};j.forEach(s=>{e[s]=s}),N(e)}finally{f(!1)}}else N({...a})})()},[j,_]);return 0===j.length?null:o.jsx(p,{className:"rounded-3xl shadow-sm",style:{backgroundColor:(null==(t=null==a?void 0:a.colors)?void 0:t.cardBackground)||"#ffffff",borderColor:(null==(r=null==a?void 0:a.colors)?void 0:r.cardBorder)||"#e5e7eb",...null==(n=null==a?void 0:a.styles)?void 0:n.cardStyle},children:o.jsx(h,{className:"p-0",children:c?o.jsx("div",{className:"p-6 text-sm text-muted-foreground",children:"Loading translations‚Ä¶"}):0===j.length?o.jsx("div",{className:"p-6 text-sm text-muted-foreground",children:"No vocabulary found."}):o.jsx("div",{className:"divide-y",children:j.map(e=>{var s,t,r,n;const c=w[e]||e,d=x.has(e);return o.jsxs("div",{className:"p-4 flex items-center justify-between transition-colors cursor-pointer group",style:{backgroundColor:"transparent"},onMouseEnter:e=>{var s;e.currentTarget.style.backgroundColor=(null==(s=null==a?void 0:a.colors)?void 0:s.hoverBackground)||"rgba(0,0,0,0.05)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"font-medium transition-colors",style:{color:(null==(s=null==a?void 0:a.colors)?void 0:s.textPrimary)||"#111827"},onMouseEnter:e=>{var s;e.currentTarget.style.color=(null==(s=null==a?void 0:a.colors)?void 0:s.buttonPrimary)||"#3b82f6"},onMouseLeave:e=>{var s;e.currentTarget.style.color=(null==(s=null==a?void 0:a.colors)?void 0:s.textPrimary)||"#111827"},children:e}),o.jsx("div",{className:"text-sm font-medium",style:{color:(null==(t=null==a?void 0:a.colors)?void 0:t.textSecondary)||"#6b7280"},children:c}),o.jsx("div",{className:"text-xs text-muted-foreground mt-1 opacity-0 group-hover:opacity-100 transition-opacity",children:"Click to add to your vocabulary book"})]}),o.jsx(g,{size:"sm",variant:"outline",onClick:()=>(async e=>{var s;if(l){k(s=>new Set(s).add(e));try{const a=w[e]||e,{data:t,error:r}=await L.functions.invoke("add-to-word-book",{body:{word:e,translation:a,part_of_speech:"noun"}});if(r){if(!(null==(s=r.message)?void 0:s.includes("already_exists")))throw r;i({title:"Word already added",description:`"${e}" is already in your vocabulary book.`})}else i({title:"Word added!",description:`"${e}" has been added to your vocabulary book.`})}catch(a){console.error("Error adding word to book:",a),i({title:"Error",description:"Failed to add word to your vocabulary book. Please try again.",variant:"destructive"})}finally{k(s=>{const a=new Set(s);return a.delete(e),a})}}else i({title:"Authentication required",description:"Please sign in to add words to your vocabulary book.",variant:"destructive"})})(e),disabled:d,style:{borderColor:(null==(r=null==a?void 0:a.colors)?void 0:r.border)||"#e5e7eb",color:(null==(n=null==a?void 0:a.colors)?void 0:n.textPrimary)||"#111827"},onMouseEnter:e=>{var s,t;e.currentTarget.style.backgroundColor=(null==(s=null==a?void 0:a.colors)?void 0:s.hoverBackground)||"rgba(0,0,0,0.05)",e.currentTarget.style.borderColor=(null==(t=null==a?void 0:a.colors)?void 0:t.buttonPrimary)||"#3b82f6"},onMouseLeave:e=>{var s;e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.borderColor=(null==(s=null==a?void 0:a.colors)?void 0:s.border)||"#e5e7eb"},children:d?o.jsx(v,{className:"w-3 h-3 animate-spin"}):o.jsx(b,{className:"w-3 h-3"})})]},e)})})})})},W=(e,s)=>"original"===s?"error"===e?"bg-destructive/10 text-destructive border-b-2 border-destructive/50":"text-text-primary":"improvement"===e?"bg-brand-green/10 text-brand-green border-b-2 border-brand-green/50":"text-text-primary",O=new Set(["the","a","an","and","or","but","if","then","so","because","as","of","to","in","on","at","by","for","with","about","into","over","after","before","from","is","are","was","were","be","been","being","it","its","this","that","these","those","their","there","here","also","very","much","more","most","many","few","some","any","than","both","either","neither","not","no","do","does","did","can","could","should","would","may","might","will","shall","i","you","he","she","we","they","one","two","three"]),z=e=>{const s=e.toLowerCase().replace(/[^a-z'-]/g,"");return!!s&&(!O.has(s)&&s.length>=4)},F=(e,s)=>{const a=e=>("improvement"===e.status||"error"===e.status)&&e.text.trim().split(/\s+/).length>=4,t=[];for(const r of e){if(!a(r)){t.push(r);continue}const e=r.text.split(/(\b[^\s]+\b)/g).filter(e=>e.length>0);for(const s of e){/\b[^\s]+\b/.test(s)&&z(s)?t.push({text:s,status:r.status}):t.push({text:s,status:"neutral"})}}return t},U=(e,s)=>{const a=e.split(/[.!?]+/).filter(e=>e.trim().length>0),t=[];let r=e;s&&s.length>0?(s.forEach(e=>{if(e.sentence_quote&&e.improved_version){const s=e.sentence_quote.trim(),n=e.improved_version.trim();r=r.replace(s,n);const o=a.find(e=>e.includes(s));if(o){const a=o.trim()+".",r=o.replace(s,n).trim()+".",l=((e,s)=>{const a=e.split(/\s+/),t=s.split(/\s+/),r=a.length,n=t.length,o=[],l=new Set,i=new Set;for(let h=0;h<r;h++)for(let e=0;e<n;e++)if(!l.has(h)&&!i.has(e)&&a[h]===t[e]){o.push({origIndex:h,impIndex:e,word:a[h]}),l.add(h),i.add(e);break}o.sort((e,s)=>e.origIndex-s.origIndex);const c=[],d=[],u=(e,s,a)=>{if(0===s.length)return;const t=s.replace(/\s+/g," ").trim();t&&e.push({text:t+" ",status:a})};let m=0;for(const h of o){if(h.origIndex>m){const e=a.slice(m,h.origIndex);if(e.length>0){const s=e.join(" ");s.trim()&&u(c,s,"error")}}u(c,h.word,"neutral"),m=h.origIndex+1}if(m<r){const e=a.slice(m);if(e.length>0){const s=e.join(" ");s.trim()&&u(c,s,"error")}}let p=0;for(const h of o){if(h.impIndex>p){const e=t.slice(p,h.impIndex);if(e.length>0){const s=e.join(" ");s.trim()&&u(d,s,"improvement")}}u(d,h.word,"neutral"),p=h.impIndex+1}if(p<n){const e=t.slice(p);if(e.length>0){const s=e.join(" ");s.trim()&&u(d,s,"improvement")}}return 0===c.length&&c.push({text:e,status:"neutral"}),0===d.length&&d.push({text:s,status:"neutral"}),{origSpans:c,impSpans:d}})(a,r);t.push({original:a,improved:r,original_spans:l.origSpans,corrected_spans:l.impSpans,issue:e.issue||"Enhancement suggestion",explanation:e.explanation})}}}),a.forEach((e,s)=>{const a=e.trim();a&&!t.some(e=>e.original.includes(a))&&t.push({original:a+".",improved:a+".",issue:`Sentence ${s+1}`,explanation:"This sentence appears to be well-written or no specific improvements were identified."})})):a.forEach((e,s)=>{const a=e.trim();a&&t.push({original:a+".",improved:a+".",issue:`Sentence ${s+1}`,explanation:"No specific improvements suggested for this sentence."})});const n=(e,a)=>{if(!s||0===s.length)return[{text:e,status:"neutral"}];const t=[];let r=e,n=0;return s.forEach(e=>{if(e.sentence_quote&&e.improved_version){const s=e.sentence_quote.trim(),o=e.improved_version.trim(),l=a?o:s,i=r.indexOf(l);-1!==i&&(i>0&&t.push({text:r.substring(0,i),status:"neutral"}),t.push({text:l,status:a?"improvement":"error"}),r=r.substring(i+l.length),n++)}}),r.length>0&&t.push({text:r,status:"neutral"}),0===n?[{text:e,status:"neutral"}]:t.length>0?t:[{text:e,status:"neutral"}]};return{originalSpans:n(e,!1),improvedSpans:n(r,!0),sentences:t}},G=({originalText:e,improvementSuggestions:s,originalSpans:a,correctedSpans:t,sentenceComparisons:r,title:n,loading:l,currentTheme:i})=>{var c,d,u,v,b,y;const[j,w]=m.useState("whole"),{originalSpans:N,improvedSpans:C,sentences:S}=m.useMemo(()=>{if(a&&t&&a.length>0&&t.length>0){const n=a.map(e=>e.text).join("").replace(/\s+/g," ").trim();t.map(e=>e.text).join("").replace(/\s+/g," ").trim();const o=e.replace(/\s+/g," ").trim(),l=n.length/o.length;return n.trim()!==o||l<.5?(console.warn("‚ö†Ô∏è AI-provided spans incomplete, falling back to full text processing",{spansLength:n.length,originalLength:o.length,coverage:l}),U(e,s)):{originalSpans:a,improvedSpans:t,sentences:r||[]}}return U(e,s)},[e,s,a,t,r]);m.useMemo(()=>F(N),[N]),m.useMemo(()=>F(C),[C]);const T=m.useMemo(()=>(S||[]).map(e=>({...e,original_spans:e.original_spans?F(e.original_spans):e.original_spans,corrected_spans:e.corrected_spans?F(e.corrected_spans):e.corrected_spans})),[S]),A=m.useMemo(()=>{if(r&&r.length>0)return r.map(e=>({...e,original_spans:e.original_spans?F(e.original_spans):e.original_spans,corrected_spans:e.corrected_spans?F(e.corrected_spans):e.corrected_spans}));const s=C.map(e=>e.text).join("").trim(),a=e.split(/[.!?]+/).filter(e=>e.trim().length>0).map(e=>e.trim()+"."),t=s.split(/[.!?]+/).filter(e=>e.trim().length>0).map(e=>e.trim()+"."),n=Math.min(a.length,t.length),o=[];for(let e=0;e<n;e++){const s=a[e],r=t[e],n=diffToSpans(s,r);o.push({original:s,improved:r,original_spans:n.origSpans,corrected_spans:n.impSpans})}return o},[C,e,r]),E=m.useMemo(()=>r&&r.length>0?r.map(e=>({...e,original_spans:e.original_spans?F(e.original_spans):e.original_spans,corrected_spans:e.corrected_spans?F(e.corrected_spans):e.corrected_spans})):T.length>0?T:A,[r,T,A]),$=m.useMemo(()=>(e=>{const s=e.length;if(s<=3)return[e];const a=Math.min(2,Math.max(1,Math.floor(.2*s))),t=Math.min(2,Math.max(1,Math.floor(.2*s)));return[e.slice(0,a),e.slice(a,Math.max(a,s-t)),e.slice(Math.max(a,s-t))].filter(e=>e.length>0)})(E),[E]);return e.trim()?l?o.jsxs("div",{className:"mt-6",children:[o.jsx("div",{className:"animate-pulse h-6 w-48 bg-surface-3 rounded mb-4"}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[o.jsx("div",{className:"h-40 bg-surface-3 rounded border border-border"}),o.jsx("div",{className:"h-40 bg-surface-3 rounded border border-border"})]})]}):o.jsxs("div",{className:"mt-6 space-y-4",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("h4",{className:"text-heading-4",children:["Writing Analysis - ",n]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs(g,{size:"sm",onClick:()=>w("whole"),className:"flex items-center gap-2",style:{backgroundColor:"whole"===j?null==(c=null==i?void 0:i.colors)?void 0:c.buttonPrimary:"transparent",color:"whole"===j?"#ffffff":null==(d=null==i?void 0:i.colors)?void 0:d.buttonPrimary,borderColor:null==(u=null==i?void 0:i.colors)?void 0:u.buttonPrimary},children:[o.jsx(f,{className:"w-4 h-4"}),"Whole View"]}),o.jsxs(g,{size:"sm",onClick:()=>w("sentence"),className:"flex items-center gap-2",style:{backgroundColor:"sentence"===j?null==(v=null==i?void 0:i.colors)?void 0:v.buttonPrimary:"transparent",color:"sentence"===j?"#ffffff":null==(b=null==i?void 0:i.colors)?void 0:b.buttonPrimary,borderColor:null==(y=null==i?void 0:i.colors)?void 0:y.buttonPrimary},children:[o.jsx(P,{className:"w-4 h-4"}),"Sentence by Sentence"]})]})]}),"whole"===j?o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[o.jsxs(p,{className:"border border-destructive/20 bg-surface-1 rounded-3xl shadow-sm",children:[o.jsx(x,{className:"pb-3",children:o.jsxs(k,{className:"text-base flex items-center gap-2",children:[o.jsx("span",{className:"w-3 h-3 bg-destructive/20 rounded-full"}),"Your Writing",o.jsx(_,{variant:"outline",className:"text-xs text-destructive",children:"Issues highlighted"})]})}),o.jsx(h,{children:o.jsx("div",{className:"text-sm whitespace-pre-wrap break-words space-y-6",children:$.map((e,s)=>o.jsx("div",{className:"space-y-2",children:e.map((e,a)=>o.jsx("p",{className:"leading-relaxed",children:(e.original_spans&&e.original_spans.length?e.original_spans:[{text:e.original||"",status:"neutral"}]).map((e,t)=>o.jsx("span",{className:W(e.status,"original"),children:e.text},`whole-orig-span-${s}-${a}-${t}`))},`whole-orig-${s}-${a}`))},`orig-group-${s}`))})})]}),o.jsxs(p,{className:"border border-brand-green/20 bg-surface-1 rounded-3xl shadow-sm",children:[o.jsx(x,{className:"pb-3",children:o.jsxs(k,{className:"text-base flex items-center gap-2",children:[o.jsx("span",{className:"w-3 h-3 bg-brand-green/20 rounded-full"}),"AI Suggested Improvements",o.jsx(_,{variant:"outline",className:"text-xs text-brand-green",children:"Enhancements highlighted"})]})}),o.jsx(h,{children:o.jsx("div",{className:"text-sm whitespace-pre-wrap break-words space-y-6",children:$.map((e,s)=>o.jsx("div",{className:"space-y-2",children:e.map((e,a)=>o.jsx("p",{className:"leading-relaxed",children:(e.corrected_spans&&e.corrected_spans.length?e.corrected_spans:[{text:e.improved||"",status:"neutral"}]).map((e,t)=>o.jsx("span",{className:W(e.status,"improved"),children:e.text},`whole-imp-span-${s}-${a}-${t}`))},`whole-imp-${s}-${a}`))},`imp-group-${s}`))})})]})]}):o.jsx("div",{className:"space-y-4",children:E.length>0?E.map((e,s)=>o.jsx(p,{className:"border border-border",children:o.jsxs(h,{className:"space-y-4",children:[o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[o.jsx("div",{className:"space-y-2",children:o.jsx("div",{className:"p-3 bg-destructive/5 border border-destructive/20 rounded-lg",children:o.jsx("div",{className:"text-sm leading-relaxed whitespace-pre-wrap break-words",children:e.original_spans?e.original_spans.map((e,s)=>o.jsx("span",{className:W(e.status,"original"),children:e.text},`orig-${s}`)):e.original})})}),o.jsx("div",{className:"space-y-2",children:o.jsx("div",{className:"p-3 bg-brand-green/5 border border-brand-green/20 rounded-lg",children:o.jsx("div",{className:"text-sm leading-relaxed whitespace-pre-wrap break-words",children:e.corrected_spans?e.corrected_spans.map((e,s)=>o.jsx("span",{className:W(e.status,"improved"),children:e.text},`corr-${s}`)):e.improved})})})]}),e.explanation&&o.jsxs("div",{className:"p-3 bg-surface-2 border border-border rounded-lg",children:[o.jsx("p",{className:"text-xs uppercase tracking-wide text-text-tertiary mb-1",children:"Explanation"}),o.jsx("p",{className:"text-sm text-text-secondary",children:"string"==typeof e.explanation?e.explanation:"object"==typeof e.explanation&&e.explanation.explanation?e.explanation.explanation:"Improvement suggestion available."})]})]})},s)):o.jsx(p,{className:"border border-border",children:o.jsxs(h,{className:"py-6 text-center",children:[o.jsx("p",{className:"text-text-secondary",children:"No specific sentence-level improvements available for this task."}),o.jsx("p",{className:"text-sm text-text-tertiary mt-1",children:"Use the whole view to see your complete writing."})]})})}),o.jsx(R,{improvementSpans:m.useMemo(()=>E.flatMap(e=>(e.corrected_spans||[]).filter(e=>"improvement"===e.status)),[E]),title:"Useful Vocabulary from Improvements",currentTheme:i})]}):null},K=e=>"number"!=typeof e||Number.isNaN(e)?NaN:Math.min(9,Math.max(0,Math.round(2*e)/2)),V=(e,s)=>{var a,t,r,n,o;if(!e)return NaN;const l=e.criteria||{},i=[];if("task1"===s?"number"==typeof(null==(a=l.task_achievement)?void 0:a.band)&&i.push(l.task_achievement.band):"number"==typeof(null==(t=l.task_response)?void 0:t.band)&&i.push(l.task_response.band),"number"==typeof(null==(r=l.coherence_and_cohesion)?void 0:r.band)&&i.push(l.coherence_and_cohesion.band),"number"==typeof(null==(n=l.lexical_resource)?void 0:n.band)&&i.push(l.lexical_resource.band),"number"==typeof(null==(o=l.grammatical_range_and_accuracy)?void 0:o.band)&&i.push(l.grammatical_range_and_accuracy.band),0===i.length)return"number"==typeof e.overall_band?K(e.overall_band):NaN;const c=i.reduce((e,s)=>e+s,0)/i.length;return K(c)};function Y(){var e,s,a,t,r,n,l,i,c,v,b,f,P,q,R,W,O;const z=y(),F=j(),{user:U}=d(),{toast:Y}=u();w();const[H,Z]=m.useState(!1),[J,Q]=m.useState("note"),[X,ee]=m.useState({}),se=m.useRef(null);m.useEffect(()=>{const e=z.state,s=null==e?void 0:e.submissionId;s&&se.current!==s&&(se.current=null),e&&e.structured?ee(e):(null==e?void 0:e.submissionId)&&U?ae(e.submissionId):ee({})},[z.state,U]);const ae=async e=>{var s,a,t,r,n,o;Z(!0);try{console.log("üîç Fetching results from database for submission:",e);const{data:l,error:i}=await L.from("test_results").select("*").eq("id",e).eq("user_id",null==U?void 0:U.id).single();if(i)throw console.error("‚ùå Error fetching test result:",i),i;console.log("‚úÖ Test result fetched:",l);const{data:c,error:d}=await L.from("writing_test_results").select("*").eq("test_result_id",e).eq("user_id",null==U?void 0:U.id).order("task_number");if(d)throw console.error("‚ùå Error fetching writing results:",d),d;if(console.log("‚úÖ Writing results fetched:",c),!c||c.length<2)throw console.warn("‚ö†Ô∏è Incomplete writing results found:",(null==c?void 0:c.length)||0),new Error("Incomplete test results found");const u=c.find(e=>1===e.task_number),m=c.find(e=>2===e.task_number),p=e=>{if(!e||"object"!=typeof e)return 6.5;const s=[];for(const[a,t]of Object.entries(e))if(t&&"object"==typeof t&&"band"in t){const e=t.band;"number"==typeof e&&e>=0&&e<=9&&s.push(e)}return s.length>0?Math.round(s.reduce((e,s)=>e+s,0)/s.length*2)/2:6.5},h=(e,s)=>{const a="Original analysis incomplete - criterion score not provided in assessment",t="task1"===s?{task_achievement:{band:0,justification:a},coherence_and_cohesion:{band:0,justification:a},lexical_resource:{band:0,justification:a},grammatical_range_and_accuracy:{band:0,justification:a}}:{task_response:{band:0,justification:a},coherence_and_cohesion:{band:0,justification:a},lexical_resource:{band:0,justification:a},grammatical_range_and_accuracy:{band:0,justification:a}};if(!e||"object"!=typeof e)return console.warn(`‚ö†Ô∏è Missing or invalid criteria for ${s} - analysis incomplete`),t;const r={};for(const[o,l]of Object.entries(e))l&&"object"==typeof l&&"band"in l&&(r[o]=l);const n="task1"===s?["task_achievement","coherence_and_cohesion","lexical_resource","grammatical_range_and_accuracy"]:["task_response","coherence_and_cohesion","lexical_resource","grammatical_range_and_accuracy"];for(const o of n)r[o]||(r[o]={band:0,justification:a});return r},g=l.test_data,v=(null==g?void 0:g.overall_band)||l.overall_score||.33*p(null==u?void 0:u.band_scores)+.67*p(null==m?void 0:m.band_scores),b={structured:{task1:{criteria:h(null==u?void 0:u.band_scores,"task1"),overall_band:p(null==u?void 0:u.band_scores),feedback_markdown:(null==u?void 0:u.detailed_feedback)||"### Task 1 Assessment\n\nDetailed feedback was not available for this task.",feedback:{strengths:["Response was submitted successfully"],improvements:(null==u?void 0:u.improvement_suggestions)||["Retake test for detailed feedback"]}},task2:{criteria:h(null==m?void 0:m.band_scores,"task2"),overall_band:p(null==m?void 0:m.band_scores),feedback_markdown:(null==m?void 0:m.detailed_feedback)||"### Task 2 Assessment\n\nDetailed feedback was not available for this task.",feedback:{strengths:["Response was submitted successfully"],improvements:(null==m?void 0:m.improvement_suggestions)||["Retake test for detailed feedback"]}},overall:{band:v,calculation:"Database reconstruction: Task 1 + Task 2 weighted average",feedback_markdown:`### Overall IELTS Writing Band Score: ${v}\n\nThis score was reconstructed from saved test data.`},full_report_markdown:`# IELTS Writing Assessment Results\n\n## Overall Band Score: ${v}\n\nThis assessment was reconstructed from your saved test results. For the most accurate and detailed feedback, please take a new test.`},testName:l.test_type||"IELTS Writing Test",task1Answer:(null==u?void 0:u.user_response)||null,task2Answer:(null==m?void 0:m.user_response)||null,task1Skipped:!u,task2Skipped:!m,task1Data:{title:(null==(s=null==g?void 0:g.task1Data)?void 0:s.title)||"Task 1",instructions:(null==u?void 0:u.prompt_text)||(null==(a=null==g?void 0:g.task1Data)?void 0:a.instructions)||"Task 1 Instructions",imageUrl:(null==(t=null==g?void 0:g.task1Data)?void 0:t.imageUrl)||null,imageContext:(null==(r=null==g?void 0:g.task1Data)?void 0:r.imageContext)||null},task2Data:{title:(null==(n=null==g?void 0:g.task2Data)?void 0:n.title)||"Task 2",instructions:(null==m?void 0:m.prompt_text)||(null==(o=null==g?void 0:g.task2Data)?void 0:o.instructions)||"Task 2 Instructions"}};console.log("‚úÖ Reconstructed data:",b),ee(b)}catch(l){console.error("‚ùå Error fetching results:",l),Y({title:"Error",description:"Failed to load test results. Please try taking the test again.",variant:"destructive"})}finally{Z(!1)}};m.useEffect(()=>{(async()=>{var e,s,a,t,r,n,o,l,i,c,d,u,m,p;if(!X||!U)return;const h=(null==(e=z.state)?void 0:e.submissionId)||(null==X?void 0:X.submissionId);if(se.current===h)return void console.log("‚úÖ Submission already processed, skipping generation");const g=h||`${null==(s=X.task1Answer)?void 0:s.slice(0,50)}_${null==(a=X.task2Answer)?void 0:a.slice(0,50)}`;if(se.current===g)return void console.log("‚úÖ Content already processed, skipping generation");const v=X.structured;if(!v)return;const b=(null==(t=null==v?void 0:v.task1)?void 0:t.sentence_comparisons)&&Array.isArray(v.task1.sentence_comparisons)&&v.task1.sentence_comparisons.length>0&&v.task1.original_spans&&v.task1.corrected_spans,f=(null==(r=null==v?void 0:v.task2)?void 0:r.sentence_comparisons)&&Array.isArray(v.task2.sentence_comparisons)&&v.task2.sentence_comparisons.length>0&&v.task2.original_spans&&v.task2.corrected_spans;if(b&&f)return void(se.current=h||g);if(b&&!X.task2Answer||f&&!X.task1Answer)return void(se.current=h||g);const x=!!X.task1Answer&&!b,k=!!X.task2Answer&&!f;if(x||k){console.log("üîÑ Generating sentence_comparisons on-demand (ONE TIME ONLY)..."),se.current=h||g;try{Z(!0);const e={...v},s=e=>(e||[]).map(e=>e.text).join(""),a=(e=[])=>e.map(e=>({issue:"Rewrite for clarity and accuracy",sentence_quote:s(e.original_spans),improved_version:s(e.corrected_spans),explanation:"This rewrite improves grammar, vocabulary, and cohesion while preserving your original meaning."}));if(x&&X.task1Answer){const{data:s,error:t}=await L.functions.invoke("writing-feedback",{body:{writing:X.task1Answer,prompt:(null==(n=X.task1Data)?void 0:n.title)||(null==(o=X.task1Data)?void 0:o.instructions),taskType:"Task 1"}});if(!t&&(null==s?void 0:s.structured)){e.task1=e.task1||{criteria:{}},e.task1.feedback=e.task1.feedback||{},e.task1.sentence_comparisons=s.structured.sentence_comparisons||[];const t=a(e.task1.sentence_comparisons);e.task1.feedback.improvements_detailed=s.structured.improvements_detailed||t,e.task1.feedback.improvements=s.structured.improvements||t,e.task1.feedback_markdown=s.structured.feedback_markdown||e.task1.feedback_markdown,h&&await L.from("writing_test_results").update({detailed_feedback:e.task1.feedback_markdown||"",improvement_suggestions:((null==(l=e.task1.feedback)?void 0:l.improvements)||[]).filter(e=>"string"==typeof e)}).eq("test_result_id",h).eq("user_id",U.id).eq("task_number",1)}}if(k&&X.task2Answer){const{data:s,error:t}=await L.functions.invoke("writing-feedback",{body:{writing:X.task2Answer,prompt:(null==(i=X.task2Data)?void 0:i.title)||(null==(c=X.task2Data)?void 0:c.instructions),taskType:"Task 2"}});if(!t&&(null==s?void 0:s.structured)){e.task2=e.task2||{criteria:{}},e.task2.feedback=e.task2.feedback||{},e.task2.sentence_comparisons=s.structured.sentence_comparisons||[];const t=a(e.task2.sentence_comparisons);e.task2.feedback.improvements_detailed=s.structured.improvements_detailed||t,e.task2.feedback.improvements=s.structured.improvements||t,e.task2.feedback_markdown=s.structured.feedback_markdown||e.task2.feedback_markdown,h&&await L.from("writing_test_results").update({detailed_feedback:e.task2.feedback_markdown||"",improvement_suggestions:((null==(d=e.task2.feedback)?void 0:d.improvements)||[]).filter(e=>"string"==typeof e)}).eq("test_result_id",h).eq("user_id",U.id).eq("task_number",2)}}x&&(null==(u=e.task1)?void 0:u.sentence_comparisons)&&e.task1.sentence_comparisons.length>0||k&&(null==(m=e.task2)?void 0:m.sentence_comparisons)&&e.task2.sentence_comparisons.length>0?(ee(s=>({...s,structured:e})),console.log("‚úÖ sentence_comparisons generated and updated (ONE TIME)")):console.log("‚úÖ No changes needed, skipping state update")}catch(_){console.error("‚ö†Ô∏è On-demand feedback generation failed:",_);const e=(null==(p=z.state)?void 0:p.submissionId)||(null==X?void 0:X.submissionId);se.current===e&&(se.current=null)}finally{Z(!1)}}else se.current=h||g})()},[null==(e=z.state)?void 0:e.submissionId,null==X?void 0:X.submissionId,null==U?void 0:U.id]);const{structured:te,testName:re,task1Data:ne,task2Data:oe,task1Answer:le,task2Answer:ie}=X;m.useEffect(()=>{document.title=`IELTS Writing Results ‚Äì ${re||"Assessment"}`;const e=document.querySelector('meta[name="description"]');if(e)e.content="Professional IELTS Writing assessment with detailed per-criterion bands and feedback.";else{const e=document.createElement("meta");e.name="description",e.content="Professional IELTS Writing assessment with detailed per-criterion bands and feedback.",document.head.appendChild(e)}},[re]);!(te&&(te.task1||te.task2))&&te&&(console.warn("‚ö†Ô∏è Structured data exists but lacks task data, creating minimal fallback"),te.task1=te.task1||{criteria:{task_achievement:{band:6.5,justification:"Minimal assessment available"},coherence_and_cohesion:{band:6.5,justification:"Minimal assessment available"},lexical_resource:{band:6.5,justification:"Minimal assessment available"},grammatical_range_and_accuracy:{band:6.5,justification:"Minimal assessment available"}},overall_band:6.5,feedback:{strengths:["Response provided"],improvements:["Retake for detailed feedback"]},feedback_markdown:"Assessment data incomplete."},te.task2=te.task2||{criteria:{task_response:{band:6.5,justification:"Minimal assessment available"},coherence_and_cohesion:{band:6.5,justification:"Minimal assessment available"},lexical_resource:{band:6.5,justification:"Minimal assessment available"},grammatical_range_and_accuracy:{band:6.5,justification:"Minimal assessment available"}},overall_band:6.5,feedback:{strengths:["Response provided"],improvements:["Retake for detailed feedback"]},feedback_markdown:"Assessment data incomplete."});if(!(te&&(te.task1||te.task2)))return o.jsx("div",{className:"min-h-screen bg-surface-2 flex items-center justify-center",children:o.jsxs(p,{className:"max-w-md mx-4",children:[o.jsx(x,{className:"text-center",children:o.jsx(k,{className:"text-heading-3 text-destructive",children:"Results Not Available"})}),o.jsxs(h,{className:"text-center space-y-4",children:[o.jsx("p",{style:{color:"#8B6914"},children:"We couldn't find your test results. This usually happens when:"}),o.jsxs("ul",{className:"text-sm text-left space-y-1",style:{color:"#8B6914"},children:[o.jsx("li",{children:"‚Ä¢ You navigated directly to this page"}),o.jsx("li",{children:"‚Ä¢ You refreshed the page"}),o.jsx("li",{children:"‚Ä¢ The test session expired"})]}),o.jsxs("div",{className:"flex flex-col gap-2 pt-4",children:[o.jsx(g,{onClick:()=>F("/ielts-portal"),className:"w-full",children:"Take New Test"}),o.jsx(g,{variant:"outline",onClick:()=>F("/dashboard"),className:"w-full",children:"Back to Dashboard"})]})]})]})});const ce=V(null==te?void 0:te.task1,"task1"),de=V(null==te?void 0:te.task2,"task2"),ue=X.task1Skipped||!X.task1Answer||!X.task1Answer.trim(),me=X.task2Skipped||!X.task2Answer||!X.task2Answer.trim(),pe=!ue&&!Number.isNaN(ce),he=!me&&!Number.isNaN(de),ge=(pe?1:0)+(he?2:0),ve=e=>Number.isNaN(e)||e<0?0:e>9?9:e,be=pe?ve(ce):0,fe=he?ve(de):0,xe=ge>0?K((be+2*fe)/ge):pe?K(be):he?K(fe):0,ke=M[J]||M.note,_e=({title:e,task:s,type:a,computedOverall:t,userAnswer:r,isSkipped:n})=>{var l,i,c,d,u,m,g,v,b,f,y,j,w,N,C,S,T,A,E,$,M;if(n||!r||!r.trim())return o.jsxs(p,{className:"rounded-3xl shadow-lg mb-8",style:{backgroundColor:ke.colors.cardBackground,borderColor:ke.colors.cardBorder,...ke.styles.cardStyle},children:[o.jsx(x,{className:"bg-gradient-to-r from-amber-50 to-amber-100",children:o.jsxs(k,{className:"flex items-center gap-2 text-amber-700",children:[o.jsx("div",{className:"p-2 rounded-xl bg-amber-200",children:"task1"===a?"Task 1":"Task 2"}),e," - Skipped"]})}),o.jsxs(h,{className:"p-6 text-center",children:[o.jsx(_,{variant:"outline",className:"text-amber-600 border-amber-300 bg-amber-50 rounded-full px-4 py-2 mb-2",children:"This task was skipped"}),o.jsx("p",{className:"text-sm mt-2",style:{color:"#8B6914"},children:"No assessment available for this task"})]})]});if(!s)return null;const I=s.criteria||{},L=["task1"===a?{label:"Task Achievement",value:null==(l=I.task_achievement)?void 0:l.band,just:null==(i=I.task_achievement)?void 0:i.justification}:{label:"Task Response",value:null==(c=I.task_response)?void 0:c.band,just:null==(d=I.task_response)?void 0:d.justification},{label:"Coherence & Cohesion",value:null==(u=I.coherence_and_cohesion)?void 0:u.band,just:null==(m=I.coherence_and_cohesion)?void 0:m.justification},{label:"Lexical Resource",value:null==(g=I.lexical_resource)?void 0:g.band,just:null==(v=I.lexical_resource)?void 0:v.justification},{label:"Grammar Range & Accuracy",value:null==(b=I.grammatical_range_and_accuracy)?void 0:b.band,just:null==(f=I.grammatical_range_and_accuracy)?void 0:f.justification}],B="number"!=typeof t||Number.isNaN(t)?"number"==typeof s.overall_band?K(s.overall_band):NaN:K(t);return o.jsxs(p,{className:"rounded-3xl shadow-lg mb-8",style:{backgroundColor:ke.colors.cardBackground,borderColor:ke.colors.cardBorder,...ke.styles.cardStyle},children:[o.jsx(x,{style:{backgroundColor:ke.colors.cardBackground,borderBottom:`1px solid ${ke.colors.border}`},children:o.jsxs(k,{className:"text-heading-3 flex items-center justify-between",style:{color:"#5D4E37"},children:[o.jsx("span",{children:e}),!Number.isNaN(B)&&o.jsxs(_,{variant:"outline",className:"rounded-2xl text-sm",children:["Overall: ",B.toFixed(1)]})]})}),o.jsxs(h,{className:"p-6",children:[o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:L.map(e=>o.jsxs("div",{className:"rounded-2xl p-4 border",style:{backgroundColor:ke.colors.hoverBackground,borderColor:ke.colors.border,color:ke.colors.textPrimary},children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("p",{className:"text-sm font-medium",style:{color:ke.colors.textPrimary},children:e.label}),o.jsx(_,{variant:"outline",className:"rounded-xl",style:{borderColor:ke.colors.buttonPrimary,color:ke.colors.buttonPrimary},children:"number"==typeof e.value?K(e.value).toFixed(1):"-"})]}),e.just?o.jsx("div",{className:"mt-2 text-sm",style:{color:ke.colors.textSecondary},children:e.just}):null]},e.label))}),((null==(j=null==(y=s.feedback)?void 0:y.strengths)?void 0:j.length)||(null==(N=null==(w=s.feedback)?void 0:w.improvements)?void 0:N.length)||(null==(S=null==(C=s.feedback)?void 0:C.improvements_detailed)?void 0:S.length))&&o.jsx("div",{className:"mt-6 space-y-6",children:(null==(A=null==(T=s.feedback)?void 0:T.strengths)?void 0:A.length)?o.jsxs("div",{children:[o.jsx("h4",{className:"text-heading-4 mb-2",style:{color:"#5D4E37"},children:"Key strengths"}),o.jsx("ul",{className:"list-disc pl-5 space-y-1 text-sm",style:{color:ke.colors.textSecondary},children:s.feedback.strengths.map((e,s)=>o.jsx("li",{children:e},s))})]}):null}),r&&o.jsx(G,{originalText:r,improvementSuggestions:(null==($=null==(E=s.feedback)?void 0:E.improvements)?void 0:$.map(e=>"string"==typeof e?{issue:"General Improvement",sentence_quote:"",improved_version:e,explanation:e}:e&&"object"==typeof e?{issue:e.issue||"Improvement",sentence_quote:e.original||e.sentence_quote||"",improved_version:e.improved||e.improved_version||"",explanation:e.explanation||"Suggested improvement"}:{issue:"Improvement",sentence_quote:"",improved_version:String(e||""),explanation:String(e||"")}))||(null==(M=s.feedback)?void 0:M.improvements_detailed)||[],originalSpans:s.original_spans,correctedSpans:s.corrected_spans,sentenceComparisons:s.sentence_comparisons,title:e,currentTheme:ke})]})]})};return o.jsxs("div",{className:"min-h-screen relative",style:{backgroundColor:"transparent"},children:[o.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"none",backgroundColor:"#F5E6D3"}}),o.jsx(N,{raysOrigin:"top-center",raysColor:"#4F46E5",raysSpeed:.5,lightSpread:2,rayLength:1.5,pulsating:!1,fadeDistance:1.2,saturation:.8,followMouse:!0,mouseInfluence:.05,noiseAmount:.1,distortion:.2}),o.jsxs("div",{className:"relative z-10",children:[o.jsx("div",{className:"border-b sticky top-0 z-10",style:{backgroundColor:ke.colors.cardBackground,borderColor:ke.colors.border},children:o.jsxs("div",{className:"container mx-auto px-6 py-4 flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs(g,{variant:"ghost",onClick:()=>F("/dashboard"),className:"hover:bg-surface-3 rounded-xl",children:[o.jsx(C,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]}),o.jsx("div",{children:o.jsx("h1",{className:"text-heading-2",style:{color:"#5D4E37"},children:"IELTS Writing Results"})})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(B,{className:"w-4 h-4",style:{color:"#8B6914"}}),o.jsxs(S,{value:J,onValueChange:Q,children:[o.jsx(T,{className:"w-[140px] h-9",children:o.jsx(A,{placeholder:"Theme"})}),o.jsx(E,{children:[{value:"note",label:"Note",description:"Warm paper-like appearance"}].map(e=>o.jsx($,{value:e.value,children:e.label},e.value))})]})]})]})}),o.jsxs("div",{className:"container mx-auto px-6 space-section",children:[o.jsxs(p,{className:"rounded-3xl mb-8 overflow-hidden",style:{backgroundColor:ke.colors.cardBackground,borderColor:ke.colors.cardBorder,...ke.styles.cardStyle},children:[o.jsx(x,{className:"text-center py-6",style:{backgroundColor:ke.colors.cardBackground,borderBottom:`1px solid ${ke.colors.border}`},children:o.jsx(k,{className:"text-heading-3",style:{color:"#5D4E37"},children:"Overall Writing Band Score"})}),o.jsx(h,{className:"py-6",children:o.jsxs("div",{className:"flex flex-col lg:flex-row items-center justify-center gap-6 lg:gap-8",children:[o.jsx(I,{size:"md",className:"shrink-0"}),o.jsxs("div",{className:"text-center lg:text-left",children:[o.jsx("p",{className:"text-caption uppercase tracking-wide mb-1",style:{color:"#8B6914"},children:"Overall Band"}),o.jsx("div",{className:"text-6xl font-bold mb-3",style:{background:`linear-gradient(to right, ${ke.colors.buttonPrimary}, ${ke.colors.buttonPrimaryHover})`,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:xe.toFixed(1)}),o.jsx("div",{className:"flex items-center gap-3 justify-center lg:justify-start",children:o.jsx(_,{variant:"outline",className:"text-base px-3 py-1.5 rounded-2xl",style:{color:ke.colors.buttonPrimary,borderColor:ke.colors.buttonPrimary,backgroundColor:ke.colors.hoverBackground},children:"Performance"})})]}),o.jsx(D,{task1Scores:!ue&&(null==te?void 0:te.task1)?{task_achievement:null==(a=null==(s=te.task1.criteria)?void 0:s.task_achievement)?void 0:a.band,coherence_and_cohesion:null==(r=null==(t=te.task1.criteria)?void 0:t.coherence_and_cohesion)?void 0:r.band,lexical_resource:null==(l=null==(n=te.task1.criteria)?void 0:n.lexical_resource)?void 0:l.band,grammatical_range_and_accuracy:null==(c=null==(i=te.task1.criteria)?void 0:i.grammatical_range_and_accuracy)?void 0:c.band}:void 0,task2Scores:!me&&(null==te?void 0:te.task2)?{task_response:null==(b=null==(v=te.task2.criteria)?void 0:v.task_response)?void 0:b.band,coherence_and_cohesion:null==(P=null==(f=te.task2.criteria)?void 0:f.coherence_and_cohesion)?void 0:P.band,lexical_resource:null==(R=null==(q=te.task2.criteria)?void 0:q.lexical_resource)?void 0:R.band,grammatical_range_and_accuracy:null==(O=null==(W=te.task2.criteria)?void 0:W.grammatical_range_and_accuracy)?void 0:O.band}:void 0,className:"w-full max-w-sm lg:w-80 shrink-0"})]})})]}),((null==ne?void 0:ne.instructions)||(null==ne?void 0:ne.imageUrl))&&o.jsxs(p,{className:"rounded-3xl shadow-lg mb-8",style:{backgroundColor:ke.colors.cardBackground,borderColor:ke.colors.cardBorder,...ke.styles.cardStyle},children:[o.jsx(x,{children:o.jsx(k,{className:"text-heading-4",style:{color:"#5D4E37"},children:"Task 1 Instruction"})}),o.jsx(h,{children:o.jsxs("div",{className:"space-y-3",children:[(null==ne?void 0:ne.imageUrl)&&o.jsx("div",{className:"rounded-xl overflow-hidden border border-border bg-white p-2 flex items-center justify-center",children:o.jsx("img",{src:ne.imageUrl,alt:"Task 1 visual",className:"max-h-64 object-contain"})}),(null==ne?void 0:ne.instructions)&&o.jsx("div",{className:"text-sm p-4 rounded-lg whitespace-pre-wrap",style:{color:ke.colors.textSecondary,backgroundColor:ke.colors.cardBackground,border:`1px solid ${ke.colors.border}`},children:ne.instructions})]})})]}),o.jsx(_e,{title:"Task 1 Assessment",task:null==te?void 0:te.task1,type:"task1",computedOverall:ce,userAnswer:X.task1Answer,isSkipped:X.task1Skipped||!X.task1Answer||!X.task1Answer.trim()}),(null==oe?void 0:oe.instructions)&&o.jsxs(p,{className:"rounded-3xl shadow-lg mb-8",style:{backgroundColor:ke.colors.cardBackground,borderColor:ke.colors.cardBorder,...ke.styles.cardStyle},children:[o.jsx(x,{children:o.jsx(k,{className:"text-heading-4",style:{color:"#5D4E37"},children:"Task 2 Instruction"})}),o.jsx(h,{children:o.jsx("div",{className:"text-sm p-4 rounded-lg whitespace-pre-wrap",style:{color:ke.colors.textSecondary,backgroundColor:ke.colors.cardBackground,border:`1px solid ${ke.colors.border}`},children:oe.instructions})})]}),o.jsx(_e,{title:"Task 2 Assessment",task:null==te?void 0:te.task2,type:"task2",computedOverall:de,userAnswer:X.task2Answer,isSkipped:X.task2Skipped||!X.task2Answer||!X.task2Answer.trim()}),o.jsxs("div",{className:"flex justify-center gap-4",children:[o.jsx(g,{onClick:()=>F("/ielts-portal"),className:"rounded-xl",style:{backgroundColor:ke.colors.buttonPrimary,color:"#ffffff",borderColor:ke.colors.buttonPrimary},children:"Take Another Test"}),o.jsx(g,{onClick:()=>F("/dashboard"),variant:"outline",className:"rounded-xl",style:{borderColor:ke.colors.buttonPrimary,color:ke.colors.buttonPrimary},children:"Return to Dashboard"})]})]})]})]})}export{Y as default};
