import{j as e,c as t,u as r,r as a,b as s}from"./vendor-react-rLLBBC7n.js";import{q as n,d as i,E as l,w as o,s as d,y as m,Y as c,B as h,A as u,a as x,C as g,T as p,O as b,Z as f,_ as v,$ as y,S as k,i as j,j as w,k as N,l as C,L as S,b as _}from"./index-BDl0jLJK.js";import{F as P}from"./languages-qPB6CivY.js";import{C as T,a as I,b as E,O as W,M as A,c as B,R as z,S as D}from"./shimmering-text-bR3LtDD_.js";import{aA as L,y as F,Y as $,E as q,x as H}from"./vendor-ui-BGi_EvHx.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-charts-0DeywwxG.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";const M=({feedback:t,improved:r})=>{const a=n();return t?e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"p-4 rounded-lg border",style:{backgroundColor:"dark"===a.theme.name?"rgba(255,255,255,0.05)":"minimalist"===a.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:a.border},children:[e.jsx("h4",{className:"font-semibold mb-2",style:{color:a.textPrimary},children:"Grammar Feedback:"}),e.jsx("div",{className:"text-sm whitespace-pre-wrap",style:{color:a.textPrimary},children:t})]}),r&&e.jsxs("div",{className:"p-4 rounded-lg border",style:{backgroundColor:"dark"===a.theme.name?"rgba(255,255,255,0.05)":"minimalist"===a.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:a.border},children:[e.jsx("h4",{className:"font-semibold mb-2",style:{color:a.textPrimary},children:"Improved Version:"}),e.jsx("div",{className:"text-sm whitespace-pre-wrap",style:{color:a.textPrimary},children:r})]})]}):null},U=()=>{var U,Y,R,G,X;const{testId:O}=t(),V=r(),{toast:K}=i(),{user:Z,profile:J}=l(),Q=n();o();const[ee,te]=a.useState(null),[re,ae]=a.useState(null),[se,ne]=a.useState(null),[ie,le]=a.useState(1),[oe,de]=a.useState(""),[me,ce]=a.useState(""),[he,ue]=a.useState([]),[xe,ge]=a.useState(!1),[pe,be]=a.useState(!1),[fe,ve]=a.useState([{id:"1",type:"bot",content:"Hi! I'm Catie, your IELTS Writing tutor ðŸ“ I can see your Task 1 instructions above. Ask me anything specific about this task - like how to structure your response, what key features to highlight, or how to get started!",timestamp:new Date}]),[ye,ke]=a.useState([{id:"1",type:"bot",content:"Hi! I'm Catie, your IELTS Writing tutor ðŸ“ I can see your Task 2 essay topic above. Ask me about structuring your argument, developing your ideas for this specific topic, or how to present your opinion effectively!",timestamp:new Date}]),[je,we]=a.useState(""),[Ne,Ce]=a.useState(!1),[Se,_e]=a.useState(!1);a.useState(!1),a.useState(!1);const[Pe,Te]=a.useState(!1),[Ie,Ee]=a.useState(!1),[We,Ae]=a.useState(1),[Be,ze]=a.useState("center"),[De,Le]=a.useState("en"),[Fe,$e]=a.useState("deepseek-v3.2"),[qe]=s(),He=qe.get("training"),[Me,Ue]=a.useState([]),[Ye,Re]=a.useState(0),[Ge,Xe]=a.useState(!1),[Oe,Ve]=a.useState(0),[Ke,Ze]=a.useState(!1);a.useState(!1);const[Je,Qe]=a.useState(null),[et,tt]=a.useState(null),[rt,at]=a.useState(null),[st,nt]=a.useState(null),[it,lt]=a.useState(!1),[ot,dt]=a.useState(!1),mt=a.useRef(null),[ct,ht]=a.useState(""),[ut,xt]=a.useState(""),[gt,pt]=a.useState(!1),[bt,ft]=a.useState(""),[vt,yt]=a.useState(""),[kt,jt]=a.useState(!1);a.useEffect(()=>{if(!O)return;const e=`ielts-writing-draft-${O}-task1`,t=`ielts-writing-draft-${O}-task2`,r=localStorage.getItem(e),a=localStorage.getItem(t);r&&!oe&&de(r),a&&!me&&ce(a)},[O]),a.useEffect(()=>{O&&localStorage.setItem(`ielts-writing-draft-${O}-task1`,oe)},[oe,O]),a.useEffect(()=>{O&&localStorage.setItem(`ielts-writing-draft-${O}-task2`,me)},[me,O]),a.useEffect(()=>{let e;return Ge&&Ye>0&&(e=setInterval(()=>{Re(e=>e<=1?(Xe(!1),0):e-1),Ve(e=>e+1e3)},1e3)),()=>{e&&clearInterval(e)}},[Ge,Ye]),a.useEffect(()=>{if(He&&he.length>0){const e=he.filter(e=>e.test_subtype===He||!e.test_subtype&&"Academic"===He);Ue(e)}else Ue(he)},[He,he]),a.useEffect(()=>{O?wt():Nt()},[O]);const wt=async()=>{be(!0);try{if(!O)throw new Error("Test ID is required");const[e,t]=await Promise.all([d.from("tests").select("id, test_name, test_type, module, skill_category, test_subtype").eq("id",O).maybeSingle(),d.from("questions").select("id, test_id, part_number, question_text, passage_text, image_url, explanation, transcription").eq("test_id",O).in("part_number",[1,2]).order("part_number")]);if(e.error)throw e.error;if(t.error)throw t.error;const r=e.data;if(!r)throw new Error("Test not found");te(r);const a=t.data||[],s=a.find(e=>1===e.part_number),n=a.find(e=>2===e.part_number);if(null==s?void 0:s.image_url){(new Image).src=s.image_url}const i=s?{id:s.id,title:s.question_text||"Task 1 - Data Description",instructions:s.passage_text||"",imageUrl:s.image_url||"",imageContext:s.explanation||"",modelAnswer:s.transcription||""}:{id:"default-task1",title:"Task 1 - Data Description",instructions:"Task 1 question not found. Please contact support.",imageUrl:"",imageContext:"",modelAnswer:""},l=n?{id:n.id,title:n.question_text||"Task 2 - Essay Writing",instructions:n.passage_text||"",modelAnswer:n.transcription||""}:{id:"default-task2",title:"Task 2 - Essay Writing",instructions:"Task 2 question not found. Please contact support.",modelAnswer:""};ae(i),ne(l)}catch(e){const t=(null==e?void 0:e.message)||"Failed to load test data. Please try again.";K({title:"Error",description:t,variant:"destructive"}),te(null),ae(null),ne(null)}finally{be(!1)}},Nt=async()=>{ge(!0);try{const{data:e,error:t}=await d.from("tests").select("id, test_name, test_type, module, skill_category, test_subtype, created_at").eq("test_type","IELTS").or("module.ilike.Writing,skill_category.ilike.Writing,test_name.ilike.%Writing%").order("created_at",{ascending:!1}).limit(50);if(t)throw t;const r=(e||[]).filter(e=>e&&e.id&&(e.test_name||e.module||e.skill_category));ue(r)}catch(e){K({title:"Error",description:"Failed to load available writing tests. Please try again.",variant:"destructive"}),ue([])}finally{ge(!1)}},Ct=()=>1===ie?re:se,St=()=>1===ie?oe:me,_t=e=>{1===ie?de(e):ce(e)},Pt=e=>e.trim().split(/\s+/).filter(e=>e.length>0).length,Tt=()=>Pt(1===ie?oe:me),It=()=>1===ie?150:250,Et=()=>Se||(it||!oe.trim())&&(ot||!me.trim())||!it&&oe.trim()&&Pt(oe)<150||!ot&&me.trim()&&Pt(me)<250||!it&&!oe.trim()||!ot&&!me.trim(),Wt=()=>1===ie?fe:ye,At=e=>{1===ie?ve(e):ke(e)},Bt=async e=>{var t;const r=je.trim();if(!r||Ne)return;const a={id:Date.now().toString(),type:"user",content:r,timestamp:new Date};At(e=>[...e,a]),we(""),Ce(!0);try{const e=Ct();if(!e)throw new Error("No task data available");const t=St(),{data:a,error:s}=await d.functions.invoke("openai-chat",{body:{message:r,context:"catbot",imageContext:e.imageContext,taskType:1===ie?"Task 1 - Data Description (charts, graphs, tables, diagrams)":"Task 2 - Essay Writing (arguments, opinions, examples)",taskInstructions:e.instructions,studentWriting:t,skipCache:!0}});if(s)throw s;const n={id:(Date.now()+1).toString(),type:"bot",content:a.response,timestamp:new Date};At(e=>[...e,n])}catch(s){let e="Connection Issue",r="Failed to get response from Catie. Please try again.";(null==(t=null==s?void 0:s.message)?void 0:t.includes("service temporarily unavailable"))||503===(null==s?void 0:s.statusCode)?(e="Service Update",r="Catie is being updated! Please try again in a moment."):429===(null==s?void 0:s.statusCode)&&(e="High Traffic",r="Lots of students are getting help! Please wait a moment and try again."),K({title:e,description:r,variant:"destructive"})}finally{Ce(!1)}},zt=e=>{le(e)};a.useEffect(()=>{var e;null==(e=mt.current)||e.scrollIntoView({behavior:"smooth"})},[fe,ye,Ne,ie]);const Dt=async()=>{var e,t,r,a,s,n,i,l,o,m,c,h,u,x,g,p,b,f,v,y,k,j,w,N,C,S,_,P,T,I,E,W,A,B;const z=!it&&oe.trim(),D=!ot&&me.trim();if(!z&&!D)return void K({title:"Please complete at least one task",description:"You need to complete at least Task 1 or Task 2 to submit (or skip one)",variant:"destructive"});const L=Pt(oe),F=Pt(me);if(!it){if(!oe.trim())return void K({title:"Task 1 is required",description:"Please complete Task 1 or skip it before submitting.",variant:"destructive"});if(L<150)return void K({title:"Task 1 word count too low",description:`Task 1 requires a minimum of 150 words. You currently have ${L} words.`,variant:"destructive"})}if(!ot){if(!me.trim())return void K({title:"Task 2 is required",description:"Please complete Task 2 or skip it before submitting.",variant:"destructive"});if(F<250)return void K({title:"Task 2 word count too low",description:`Task 2 requires a minimum of 250 words. You currently have ${F} words.`,variant:"destructive"})}_e(!0);try{const[z]=await Promise.all([d.functions.invoke("ielts-writing-examiner",{body:{task1Answer:!it&&oe.trim()?oe.trim():null,task2Answer:!ot&&me.trim()?me.trim():null,task1Data:!it&&oe.trim()?re:null,task2Data:!ot&&me.trim()?se:null,targetLanguage:"en"!==De?De:void 0,model:Fe}})]);if(z.error)throw z.error;const{structured:D,feedback:L,task1WordCount:F,task2WordCount:$}=z.data,q=!it&&oe.trim()?F||Pt(oe):0,H=!ot&&me.trim()?$||Pt(me):0,{data:M,error:U}=await d.from("test_results").insert({user_id:null==Z?void 0:Z.id,test_type:"writing",score_percentage:Math.round(10*((null==(e=null==D?void 0:D.overall)?void 0:e.band)??(((null==(t=null==D?void 0:D.task1)?void 0:t.overall_band)??7)+2*((null==(r=null==D?void 0:D.task2)?void 0:r.overall_band)??7))/3)),time_taken:Math.floor(Oe/1e3),completed_at:(new Date).toISOString(),test_data:{task1Data:re?{id:re.id,title:re.title,instructions:re.instructions,imageUrl:re.imageUrl,imageContext:re.imageContext,modelAnswer:re.modelAnswer}:null,task2Data:se?{id:se.id,title:se.title,instructions:se.instructions,modelAnswer:se.modelAnswer}:null,task1Answer:!it&&oe.trim()?oe.trim():null,task2Answer:!ot&&me.trim()?me.trim():null,overall_band:(null==(a=null==D?void 0:D.overall)?void 0:a.band)||7}}).select().single();if(U)throw U;if(!it&&oe.trim()){const{error:e}=await d.from("writing_test_results").insert({user_id:null==Z?void 0:Z.id,test_result_id:M.id,task_number:1,prompt_text:(null==re?void 0:re.instructions)||(null==re?void 0:re.title)||"",user_response:oe,word_count:q,band_scores:{task_achievement:(null==(i=null==(n=null==(s=null==D?void 0:D.task1)?void 0:s.criteria)?void 0:n.task_achievement)?void 0:i.band)??null,coherence_and_cohesion:(null==(m=null==(o=null==(l=null==D?void 0:D.task1)?void 0:l.criteria)?void 0:o.coherence_and_cohesion)?void 0:m.band)??null,lexical_resource:(null==(u=null==(h=null==(c=null==D?void 0:D.task1)?void 0:c.criteria)?void 0:h.lexical_resource)?void 0:u.band)??null,grammatical_range_and_accuracy:(null==(p=null==(g=null==(x=null==D?void 0:D.task1)?void 0:x.criteria)?void 0:g.grammatical_range_and_accuracy)?void 0:p.band)??null},detailed_feedback:(null==(b=null==D?void 0:D.task1)?void 0:b.feedback_markdown)||"",improvement_suggestions:(null==(v=null==(f=null==D?void 0:D.task1)?void 0:f.feedback)?void 0:v.improvements)||[]});if(e)throw e}if(!ot&&me.trim()){const{error:e}=await d.from("writing_test_results").insert({user_id:null==Z?void 0:Z.id,test_result_id:M.id,task_number:2,prompt_text:(null==se?void 0:se.instructions)||(null==se?void 0:se.title)||"",user_response:me,word_count:H,band_scores:{task_response:(null==(j=null==(k=null==(y=null==D?void 0:D.task2)?void 0:y.criteria)?void 0:k.task_response)?void 0:j.band)??null,coherence_and_cohesion:(null==(C=null==(N=null==(w=null==D?void 0:D.task2)?void 0:w.criteria)?void 0:N.coherence_and_cohesion)?void 0:C.band)??null,lexical_resource:(null==(P=null==(_=null==(S=null==D?void 0:D.task2)?void 0:S.criteria)?void 0:_.lexical_resource)?void 0:P.band)??null,grammatical_range_and_accuracy:(null==(E=null==(I=null==(T=null==D?void 0:D.task2)?void 0:T.criteria)?void 0:I.grammatical_range_and_accuracy)?void 0:E.band)??null},detailed_feedback:(null==(W=null==D?void 0:D.task2)?void 0:W.feedback_markdown)||"",improvement_suggestions:(null==(B=null==(A=null==D?void 0:D.task2)?void 0:A.feedback)?void 0:B.improvements)||[]});if(e)throw e}V("/ielts-writing-results-pro",{state:{testName:null==ee?void 0:ee.test_name,testId:O,submissionId:M.id,task1Answer:!it&&oe.trim()?oe.trim():null,task2Answer:!ot&&me.trim()?me.trim():null,task1Skipped:it,task2Skipped:ot,feedback:L,structured:D,task1Data:re,task2Data:se,task1WordCount:q,task2WordCount:H}})}catch($){K({title:"Error",description:(null==$?void 0:$.message)||"Failed to submit test for evaluation",variant:"destructive"})}finally{_e(!1)}};if(a.useEffect(()=>{Ge||(Re(3600),Xe(!0))},[Ge]),!O){if(xe)return e.jsx(m,{title:"Writing Tests",children:e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsx("div",{className:"text-center",children:e.jsx(c,{message:"Loading available writing tests...",subMessage:"Please wait",size:150})})})});if(Me.length>0||he.length>0){const t=Me.length>0?Me:he;return e.jsxs("div",{className:"min-h-screen relative",children:[e.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"note"===Q.theme.name||"minimalist"===Q.theme.name||"dark"===Q.theme.name?"none":"url('/1000031207.png')",backgroundColor:Q.backgroundImageColor}}),e.jsx("div",{className:"relative z-10",children:e.jsx(m,{title:"Available Writing Tests",transparentBackground:!0,children:e.jsx("div",{className:"min-h-screen py-12",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(h,{variant:"outline",onClick:()=>V("/ielts-portal"),className:"mb-4 transition-all duration-200 hover:shadow-md",style:{backgroundColor:"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.5)":"dark"===Q.theme.name?"rgba(255,255,255,0.1)":Q.cardBackground,color:Q.textPrimary,borderColor:Q.border},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=Q.hoverBg,e.currentTarget.style.color=Q.buttonPrimary,e.currentTarget.style.borderColor=Q.buttonPrimary},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===Q.theme.name?"rgba(255,255,255,0.5)":"dark"===Q.theme.name?"rgba(255,255,255,0.1)":Q.cardBackground,e.currentTarget.style.color=Q.textPrimary,e.currentTarget.style.borderColor=Q.border},children:"â† Back to IELTS Portal"}),e.jsxs("h1",{className:"text-4xl font-bold mb-2 text-center",style:{color:Q.textPrimary},children:["IELTS ",He||"Writing"," Tests"]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:t.map(t=>t&&t.id?e.jsx(u,{className:"cursor-pointer h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg bg-white/80 flex items-center justify-center",onClick:()=>V(`/ielts-writing-test/${t.id}`),children:e.jsx(x,{className:"p-3 md:p-4 text-center flex items-center justify-center h-full",children:e.jsx("h3",{className:"font-semibold text-sm",children:t.test_name||"Untitled Test"})})},t.id):null)})]})})})})})]})}return e.jsx(m,{title:"Writing Tests",children:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background to-primary/5 py-12",children:e.jsxs("div",{className:"container mx-auto px-4 text-center",children:[e.jsx("h1",{className:"text-4xl font-bold text-foreground mb-4",children:"IELTS Writing Tests"}),e.jsx("p",{className:"text-lg text-muted-foreground mb-8",children:"No writing tests available yet"}),e.jsx(h,{onClick:()=>V("/ielts-portal"),variant:"outline",children:"Back to Portal"})]})})})}if(pe)return e.jsx(m,{title:"IELTS Writing Test",showBackButton:!0,children:e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsx("div",{className:"text-center",children:e.jsx(c,{message:"Loading IELTS Writing test...",subMessage:"Please wait while we fetch your test",size:150})})})});if(O&&(!ee||!re||!se))return e.jsx(m,{title:"IELTS Writing Test",showBackButton:!0,children:e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg text-foreground mb-4",children:"Unable to load test"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:ee?re&&se?"Unknown error":"Test data is incomplete":"Test not found"}),e.jsx(h,{onClick:()=>V("/ielts-portal"),variant:"outline",children:"Back to Portal"})]})})});const Lt=Ct();return Lt?e.jsxs("div",{className:"min-h-screen relative",style:{backgroundColor:"dark"===Q.theme.name?Q.theme.colors.background:"transparent"},children:[e.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"note"===Q.theme.name||"minimalist"===Q.theme.name||"dark"===Q.theme.name?"none":"url('/1000031207.png')",backgroundColor:Q.backgroundImageColor}}),e.jsx("div",{className:"relative z-10 flex flex-col pb-24 sm:pb-6",style:{backgroundColor:"dark"===Q.theme.name?Q.theme.colors.background:"transparent",minHeight:"calc(100vh - 80px)"},children:e.jsx(m,{title:"IELTS Writing Test",showBackButton:!0,transparentBackground:!0,children:e.jsx("div",{className:"flex-1 flex justify-center py-6 sm:py-6 pb-4",children:e.jsxs("div",{className:"w-full max-w-6xl mx-auto space-y-4 px-4 sm:px-6 flex flex-col",children:[e.jsx(g,{className:"rounded-3xl mb-4 max-w-fit mx-auto px-4",style:{backgroundColor:"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.9)":"dark"===Q.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===Q.theme.name?"#ffffff":Q.theme.colors.cardBackground,borderColor:Q.border,backdropFilter:"glassmorphism"===Q.theme.name?"blur(12px)":"dark"===Q.theme.name?"blur(8px)":"none",boxShadow:"dark"===Q.theme.name?"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)":"note"===Q.theme.name?null==(U=Q.theme.styles.cardStyle)?void 0:U.boxShadow:"0 8px 32px rgba(15, 23, 42, 0.16), 0 0 0 1px rgba(148, 163, 253, 0.06)",...Q.cardStyle},children:e.jsx(x,{className:"p-2 sm:p-3",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 sm:gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(L,{className:"w-3.5 h-3.5",style:{color:Q.textPrimary}}),e.jsx("span",{className:"text-sm font-medium tabular-nums",style:{color:Q.textPrimary},children:(Ft=Ye,`${Math.floor(Ft/60)}:${(Ft%60).toString().padStart(2,"0")}`)})]}),e.jsx(h,{size:"sm",onClick:()=>zt(1),className:"h-9 sm:h-8 px-4 sm:px-3 text-sm sm:text-sm font-medium min-w-[70px]",style:{backgroundColor:1===ie?Q.buttonPrimary:"transparent",color:1===ie?"#ffffff":Q.textPrimary,border:"none"},children:"Task 1"}),e.jsx(h,{size:"sm",onClick:()=>zt(2),className:"h-9 sm:h-8 px-4 sm:px-3 text-sm sm:text-sm font-medium min-w-[70px]",style:{backgroundColor:2===ie?Q.buttonPrimary:"transparent",color:2===ie?"#ffffff":Q.textPrimary,border:"none"},children:"Task 2"})]})})}),1===ie?(null==Lt?void 0:Lt.imageUrl)?e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 flex-1",style:{minHeight:"400px"},children:[e.jsx("div",{className:"flex-1 lg:flex-[0_0_50%] min-h-0",children:e.jsx(g,{className:"rounded-3xl h-full",style:{backgroundColor:"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.9)":"dark"===Q.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===Q.theme.name?"#ffffff":Q.theme.colors.cardBackground,borderColor:Q.border,backdropFilter:"glassmorphism"===Q.theme.name?"blur(12px)":"dark"===Q.theme.name?"blur(8px)":"none",boxShadow:"dark"===Q.theme.name?"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)":"note"===Q.theme.name?null==(Y=Q.theme.styles.cardStyle)?void 0:Y.boxShadow:"0 8px 32px rgba(15, 23, 42, 0.16), 0 0 0 1px rgba(148, 163, 253, 0.06)",...Q.cardStyle,display:"flex",flexDirection:"column"},children:e.jsxs(x,{className:"p-4 flex-1 flex flex-col",style:{minHeight:0},children:[e.jsx("div",{className:"mb-4",children:(null==Lt?void 0:Lt.instructions)&&e.jsx("div",{children:e.jsx("div",{className:"whitespace-pre-wrap leading-relaxed p-3 rounded-lg text-sm sm:text-base",style:{backgroundColor:"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.1)":"dark"===Q.theme.name?"rgba(255,255,255,0.05)":"minimalist"===Q.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:Q.border,borderWidth:"1px",borderStyle:"solid",color:Q.textPrimary},children:Lt.instructions})})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx("img",{src:Lt.imageUrl,alt:"Task 1 visual data",className:"w-full h-full object-contain cursor-pointer",loading:"eager",decoding:"async",onClick:e=>{const t=e.currentTarget.getBoundingClientRect(),r=(e.clientX-t.left)/t.width*100,a=(e.clientY-t.top)/t.height*100;ze(`${r}% ${a}%`),Ae(1===We?1.5:1)},style:{transform:`scale(${We})`,transformOrigin:Be,transition:"transform 0.2s ease-out"}})})]})})}),e.jsx("div",{className:"flex-1 lg:flex-[0_0_50%] min-h-0",children:e.jsx(g,{className:"rounded-3xl h-full",style:{backgroundColor:"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.9)":"dark"===Q.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===Q.theme.name?"#ffffff":Q.theme.colors.cardBackground,borderColor:Q.border,backdropFilter:"glassmorphism"===Q.theme.name?"blur(12px)":"dark"===Q.theme.name?"blur(8px)":"none",boxShadow:"dark"===Q.theme.name?"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)":"note"===Q.theme.name?null==(R=Q.theme.styles.cardStyle)?void 0:R.boxShadow:"0 8px 32px rgba(15, 23, 42, 0.16), 0 0 0 1px rgba(148, 163, 253, 0.06)",...Q.cardStyle,display:"flex",flexDirection:"column"},children:e.jsxs(x,{className:"flex-1 p-4 flex flex-col",style:{minHeight:0},children:[e.jsx("div",{className:"flex-1 flex flex-col",style:{minHeight:0},children:e.jsx(p,{value:St(),onChange:e=>_t(e.target.value),className:"flex-1 min-h-[300px] w-full text-base leading-relaxed resize-none rounded-2xl focus:outline-none focus:ring-0",placeholder:it?"Task 1 is skipped":"General"===(null==ee?void 0:ee.test_subtype)||"General"===He?"Write your letter here...":"Write your Task 1 response here...",spellCheck:Ke,disabled:it,style:{backgroundColor:it?"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.05)":"dark"===Q.theme.name?"rgba(255,255,255,0.02)":"minimalist"===Q.theme.name?"#f3f4f6":"rgba(255,255,255,0.3)":"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.1)":"dark"===Q.theme.name?"rgba(255,255,255,0.05)":"minimalist"===Q.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:Q.border,color:it?Q.textSecondary:Q.textPrimary,outline:"none",boxShadow:"none",cursor:it?"not-allowed":"text",opacity:it?.6:1}})}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-3 border-t flex-shrink-0",style:{borderColor:Q.border},children:[e.jsxs("div",{className:"text-xs font-medium",style:{color:Q.textSecondary},children:[e.jsx("span",{className:Tt()<It()?"text-red-500":"text-green-600",children:Tt()})," / ",It()]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h,{size:"sm",variant:"ghost",onClick:()=>{lt(!it),it||zt(2)},className:"h-7 px-2 text-xs font-medium hover:bg-transparent",style:{backgroundColor:it?Q.buttonPrimary:"transparent",color:it?"#ffffff":Q.textPrimary,border:"none",boxShadow:"none"},children:it?"Unskip":"Skip"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-xs font-medium",style:{color:Q.textPrimary},children:"Spell Check"}),e.jsx(b,{children:e.jsxs(f,{children:[e.jsx(v,{asChild:!0,children:e.jsx("div",{onClick:()=>Ze(!Ke),className:"relative inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none",style:{backgroundColor:Ke?Q.buttonPrimary:"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.2)":"dark"===Q.theme.name?"rgba(255,255,255,0.1)":"minimalist"===Q.theme.name?"#e5e7eb":Q.border},"data-state":Ke?"checked":"unchecked",children:e.jsx("div",{className:"pointer-events-none flex h-4 w-4 rounded-full shadow-lg ring-0 transition-transform",style:{backgroundColor:"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.95)":"dark"===Q.theme.name?"rgba(255,255,255,0.9)":"minimalist"===Q.theme.name?"#ffffff":Q.theme.colors.cardBackground,transform:Ke?"translateX(16px)":"translateX(0px)"}})})}),e.jsx(y,{children:e.jsx("p",{children:Ke?"Hide spell check":"Show spell check"})})]})})]})]})]})]})})})]}):e.jsx(g,{className:"rounded-3xl max-w-3xl w-full mx-auto",style:{backgroundColor:"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.9)":"dark"===Q.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===Q.theme.name?"#ffffff":Q.theme.colors.cardBackground,borderColor:Q.border,backdropFilter:"glassmorphism"===Q.theme.name?"blur(12px)":"dark"===Q.theme.name?"blur(8px)":"none",boxShadow:"dark"===Q.theme.name?"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)":"note"===Q.theme.name?null==(G=Q.theme.styles.cardStyle)?void 0:G.boxShadow:"0 8px 32px rgba(15, 23, 42, 0.16), 0 0 0 1px rgba(148, 163, 253, 0.06)",...Q.cardStyle,minHeight:("dark"===Q.theme.name?500:"minimalist"===Q.theme.name?550:"note"===Q.theme.name?580:600)+"px"},children:e.jsxs(x,{className:"p-4 flex flex-col flex-1",children:[(null==Lt?void 0:Lt.instructions)&&e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"whitespace-pre-wrap leading-relaxed p-3 rounded-lg text-sm",style:{backgroundColor:"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.1)":"dark"===Q.theme.name?"rgba(255,255,255,0.05)":"minimalist"===Q.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:Q.border,borderWidth:"1px",borderStyle:"solid",color:Q.textPrimary},children:Lt.instructions})}),e.jsx(p,{value:St(),onChange:e=>_t(e.target.value),placeholder:it?"Task 1 is skipped":"General"===(null==ee?void 0:ee.test_subtype)||"General"===He?"Write your letter here...":"Write your Task 1 response here...",className:"flex-1 min-h-[500px] text-base leading-relaxed resize-none rounded-2xl focus:outline-none focus:ring-0",spellCheck:Ke,disabled:it,style:{backgroundColor:it?"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.05)":"dark"===Q.theme.name?"rgba(255,255,255,0.02)":"minimalist"===Q.theme.name?"#f3f4f6":"rgba(255,255,255,0.3)":"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.1)":"dark"===Q.theme.name?"rgba(255,255,255,0.05)":"minimalist"===Q.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:Q.border,color:it?Q.textSecondary:Q.textPrimary,outline:"none",boxShadow:"none",cursor:it?"not-allowed":"text",opacity:it?.6:1,height:"100%"}}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-3 border-t",style:{borderColor:Q.border},children:[e.jsxs("div",{className:"text-xs font-medium",style:{color:Q.textSecondary},children:[e.jsx("span",{className:Tt()<It()?"text-red-500":"text-green-600",children:Tt()})," / ",It()]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h,{size:"sm",variant:"ghost",onClick:()=>{lt(!it),it||zt(2)},className:"h-7 px-2 text-xs font-medium hover:bg-transparent",style:{backgroundColor:it?Q.buttonPrimary:"transparent",color:it?"#ffffff":Q.textPrimary,border:"none",boxShadow:"none"},children:it?"Unskip":"Skip"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-xs font-medium",style:{color:Q.textPrimary},children:"Spell Check"}),e.jsx(b,{children:e.jsxs(f,{children:[e.jsx(v,{asChild:!0,children:e.jsx("div",{onClick:()=>Ze(!Ke),className:"relative inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none",style:{backgroundColor:Ke?Q.buttonPrimary:"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.2)":"dark"===Q.theme.name?"rgba(255,255,255,0.1)":"minimalist"===Q.theme.name?"#e5e7eb":Q.border},"data-state":Ke?"checked":"unchecked",children:e.jsx("div",{className:"pointer-events-none flex h-4 w-4 rounded-full shadow-lg ring-0 transition-transform",style:{backgroundColor:"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.95)":"dark"===Q.theme.name?"rgba(255,255,255,0.9)":"minimalist"===Q.theme.name?"#ffffff":Q.theme.colors.cardBackground,transform:Ke?"translateX(16px)":"translateX(0px)"}})})}),e.jsx(y,{children:e.jsx("p",{children:Ke?"Hide spell check":"Show spell check"})})]})})]}),e.jsx(h,{onClick:Dt,disabled:Et(),variant:"default",className:"h-7 px-3 text-xs",style:{backgroundColor:Q.buttonPrimary,color:"#ffffff"},children:Se?"Submitting...":"Submit Test"})]})]})]})}):e.jsx(g,{className:"rounded-3xl h-full max-w-3xl w-full mx-auto",style:{backgroundColor:"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.9)":"dark"===Q.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===Q.theme.name?"#ffffff":Q.theme.colors.cardBackground,borderColor:Q.border,backdropFilter:"glassmorphism"===Q.theme.name?"blur(12px)":"dark"===Q.theme.name?"blur(8px)":"none",boxShadow:"dark"===Q.theme.name?"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)":"note"===Q.theme.name?null==(X=Q.theme.styles.cardStyle)?void 0:X.boxShadow:"0 8px 32px rgba(15, 23, 42, 0.16), 0 0 0 1px rgba(148, 163, 253, 0.06)",...Q.cardStyle,minHeight:("dark"===Q.theme.name?500:"minimalist"===Q.theme.name?550:"note"===Q.theme.name?580:600)+"px"},children:e.jsxs(x,{className:"p-4 flex flex-col h-full",children:[(null==Lt?void 0:Lt.instructions)&&e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"whitespace-pre-wrap leading-relaxed p-3 rounded-lg text-sm",style:{backgroundColor:"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.1)":"dark"===Q.theme.name?"rgba(255,255,255,0.05)":"minimalist"===Q.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:Q.border,borderWidth:"1px",borderStyle:"solid",color:Q.textPrimary},children:Lt.instructions})}),e.jsx(p,{value:St(),onChange:e=>_t(e.target.value),placeholder:ot?"Task 2 is skipped":"Write your Task 2 essay here...",className:"flex-1 min-h-[500px] text-base leading-relaxed resize-none rounded-2xl focus:outline-none focus:ring-0",spellCheck:Ke,disabled:ot,style:{backgroundColor:ot?"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.05)":"dark"===Q.theme.name?"rgba(255,255,255,0.02)":"minimalist"===Q.theme.name?"#f3f4f6":"rgba(255,255,255,0.3)":"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.1)":"dark"===Q.theme.name?"rgba(255,255,255,0.05)":"minimalist"===Q.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:Q.border,color:ot?Q.textSecondary:Q.textPrimary,outline:"none",boxShadow:"none",cursor:ot?"not-allowed":"text",opacity:ot?.6:1,height:"100%"}}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-3 border-t",style:{borderColor:Q.border},children:[e.jsxs("div",{className:"text-xs font-medium",style:{color:Q.textSecondary},children:[e.jsx("span",{className:Tt()<It()?"text-red-500":"text-green-600",children:Tt()})," / ",It()]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h,{size:"sm",variant:"ghost",onClick:()=>{dt(!ot)},className:"h-7 px-2 text-xs font-medium hover:bg-transparent",style:{backgroundColor:ot?Q.buttonPrimary:"transparent",color:ot?"#ffffff":Q.textPrimary,border:"none",boxShadow:"none"},children:ot?"Unskip":"Skip"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-xs font-medium",style:{color:Q.textPrimary},children:"Spell Check"}),e.jsx(b,{children:e.jsxs(f,{children:[e.jsx(v,{asChild:!0,children:e.jsx("div",{onClick:()=>Ze(!Ke),className:"relative inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none",style:{backgroundColor:Ke?Q.buttonPrimary:"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.2)":"dark"===Q.theme.name?"rgba(255,255,255,0.1)":"minimalist"===Q.theme.name?"#e5e7eb":Q.border},"data-state":Ke?"checked":"unchecked",children:e.jsx("div",{className:"pointer-events-none flex h-4 w-4 rounded-full shadow-lg ring-0 transition-transform",style:{backgroundColor:"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.95)":"dark"===Q.theme.name?"rgba(255,255,255,0.9)":"minimalist"===Q.theme.name?"#ffffff":Q.theme.colors.cardBackground,transform:Ke?"translateX(16px)":"translateX(0px)"}})})}),e.jsx(y,{children:e.jsx("p",{children:Ke?"Hide spell check":"Show spell check"})})]})})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-xs font-medium",style:{color:Q.textPrimary},children:"Language"}),e.jsxs(k,{value:De,onValueChange:Le,children:[e.jsx(j,{className:"w-[130px] h-7 text-xs rounded-lg px-2 border shadow-sm focus:ring-2 focus:ring-offset-0",style:{color:Q.textPrimary,backgroundColor:"dark"===Q.theme.name?"rgba(255,255,255,0.1)":"note"===Q.theme.name?"rgba(255,255,255,0.5)":"#ffffff",borderColor:Q.border,"--tw-ring-color":Q.buttonPrimary},children:e.jsx(w,{children:(()=>{const e=P.find(e=>e.value===De);return e?`${e.flag} ${e.nativeName}`:"Language"})()})}),e.jsx(N,{className:"max-h-80",style:{backgroundColor:"note"===Q.theme.name?"#fffaf1":"dark"===Q.theme.name?"#1e293b":"#ffffff",borderColor:"note"===Q.theme.name?"#e6cda4":Q.border},children:P.map(t=>e.jsx(C,{value:t.value,className:"note"===Q.theme.name?"focus:bg-[#f5e6d3] focus:text-[#5c4a32] data-[state=checked]:bg-[#f5e6d3]":"",style:{color:Q.textPrimary},children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:t.flag}),e.jsx("span",{children:t.nativeName})]})},t.value))})]})]}),e.jsx(h,{onClick:Dt,disabled:Et(),variant:"default",className:"h-7 px-3 text-xs",style:{backgroundColor:Q.buttonPrimary,color:"#ffffff"},children:Se?"Submitting...":"Submit Test"})]})]}),e.jsx("div",{className:"mt-3 pt-2 border-t",style:{borderColor:Q.border},children:e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx(S,{htmlFor:"ai-model-selector",className:"text-sm font-medium whitespace-nowrap",style:{color:Q.textPrimary},children:"AI Model:"}),e.jsxs(k,{value:Fe,onValueChange:$e,children:[e.jsx(j,{id:"ai-model-selector",className:"w-[200px] h-9 text-sm border transition-colors rounded-lg",style:{backgroundColor:"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.9)":"dark"===Q.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===Q.theme.name?"#ffffff":Q.theme.colors.cardBackground,borderColor:Q.border,color:Q.textPrimary,backdropFilter:"glassmorphism"===Q.theme.name?"blur(12px)":"none"},children:e.jsx(w,{placeholder:"Select AI Model"})}),e.jsxs(N,{children:[e.jsx(C,{value:"deepseek-v3.2",children:"DeepSeek V3.2"}),e.jsx(C,{value:"gemini-2.5-flash",children:"Gemini 2.5 Flash"})]})]})]})})]})}),e.jsx("div",{className:"mt-6 max-w-3xl mx-auto w-full","data-improve-section":!0,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("span",{className:"text-sm font-semibold",style:{color:"note"===Q.theme.name?"#8b7355":Q.textSecondary},children:"Grammar Improve"})}),e.jsx(p,{value:ct,onChange:e=>ht(e.target.value),placeholder:"Paste your text here to improve...",className:"min-h-[120px] text-sm leading-relaxed resize-none rounded-xl focus-visible:ring-0 focus:ring-0 focus-visible:outline-none",style:{backgroundColor:"note"===Q.theme.name?"#fffaf1":"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.5)":"dark"===Q.theme.name?"rgba(255,255,255,0.05)":"minimalist"===Q.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:"note"===Q.theme.name?"#e6cda4":Q.border,borderWidth:"1px",borderStyle:"solid",color:Q.textPrimary,boxShadow:"none",outline:"none"}})]}),e.jsx("div",{className:"flex flex-col items-center justify-center pt-6",children:e.jsx(b,{children:e.jsxs(f,{children:[e.jsx(v,{asChild:!0,children:e.jsx("button",{onClick:async()=>{if(!ct||ct.trim().length<10)K({title:"Insufficient content",description:"Please paste at least 10 characters in the 'Before' box.",variant:"destructive"});else{pt(!0);try{const e=Ct();console.log("âœ¨ Requesting improvement for pasted text");const{data:t,error:r}=await d.functions.invoke("grammar-feedback",{body:{writing:ct,taskType:1===ie?"Task 1 - Data Description":"Task 2 - Essay Writing",taskNumber:ie,targetLanguage:"en"!==De?De:void 0,taskInstructions:(null==e?void 0:e.instructions)||"",mode:"improve"}});if(r)throw console.error("âŒ Improvement error:",r),r;if(!t)throw new Error("No response data received from improvement service");if(!t.success||!t.improved){const e=t.error||t.details||"Failed to improve writing";throw console.error("âŒ Improvement failed:",e),new Error(e)}xt(t.improved),K({title:"Improved! âœ¨",description:"Your improved text is ready in the 'After' box."})}catch(e){console.error("âŒ Improvement catch error:",e);let t="Failed to improve writing. Please try again.";(null==e?void 0:e.message)&&(t=e.message),K({title:"Error",description:t,variant:"destructive",duration:5e3})}finally{pt(!1)}}},disabled:gt||!ct.trim(),className:"px-2 py-1 transition-all hover:translate-x-0.5 disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:translate-x-0 focus:outline-none focus:ring-0",style:{backgroundColor:"transparent",color:"note"===Q.theme.name?"#8b7355":Q.textPrimary,border:"none",boxShadow:"none",outline:"none"},children:gt?e.jsx(F,{className:"w-5 h-5 animate-spin"}):e.jsx($,{className:"w-5 h-5"})})}),e.jsx(y,{children:e.jsx("p",{children:"Improve text"})})]})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-semibold invisible",children:"Placeholder"}),ut.trim()&&e.jsxs("button",{onClick:async()=>{try{await navigator.clipboard.writeText(ut),K({title:"Copied",description:"Improved text copied to clipboard."})}catch(e){K({title:"Copy failed",description:"Please copy manually.",variant:"destructive"})}},className:"text-xs flex items-center gap-1 px-2 py-1 rounded-md transition-colors hover:bg-black/5",style:{color:"note"===Q.theme.name?"#8b7355":Q.textSecondary},children:[e.jsx(q,{className:"w-3 h-3"}),"Copy"]})]}),e.jsx(p,{value:ut,readOnly:!0,placeholder:"Improved text will appear here...",className:"min-h-[120px] text-sm leading-relaxed resize-none rounded-xl focus-visible:ring-0 focus:ring-0 focus-visible:outline-none",style:{backgroundColor:"note"===Q.theme.name?"#fffaf1":"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.5)":"dark"===Q.theme.name?"rgba(255,255,255,0.05)":"minimalist"===Q.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:"note"===Q.theme.name?"#e6cda4":Q.border,borderWidth:"1px",borderStyle:"solid",color:Q.textPrimary,boxShadow:"none",outline:"none"}})]})]})}),e.jsx("div",{className:"mt-4 max-w-3xl mx-auto w-full",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("span",{className:"text-sm font-semibold",style:{color:"note"===Q.theme.name?"#8b7355":Q.textSecondary},children:"Answer Improve"})}),e.jsx(p,{value:bt,onChange:e=>ft(e.target.value),placeholder:"Paste your answer here for full enhancement...",className:"min-h-[120px] text-sm leading-relaxed resize-none rounded-xl focus-visible:ring-0 focus:ring-0 focus-visible:outline-none",style:{backgroundColor:"note"===Q.theme.name?"#fffaf1":"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.5)":"dark"===Q.theme.name?"rgba(255,255,255,0.05)":"minimalist"===Q.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:"note"===Q.theme.name?"#e6cda4":Q.border,borderWidth:"1px",borderStyle:"solid",color:Q.textPrimary,boxShadow:"none",outline:"none"}})]}),e.jsx("div",{className:"flex flex-col items-center justify-center pt-6",children:e.jsx(b,{children:e.jsxs(f,{children:[e.jsx(v,{asChild:!0,children:e.jsx("button",{onClick:async()=>{if(!bt||bt.trim().length<10)K({title:"Insufficient content",description:"Please paste at least 10 characters in the box.",variant:"destructive"});else{jt(!0);try{const e=Ct();console.log("âœ¨ Requesting full answer improvement for pasted text");const{data:t,error:r}=await d.functions.invoke("grammar-feedback",{body:{writing:bt,taskType:1===ie?"Task 1 - Data Description":"Task 2 - Essay Writing",taskNumber:ie,targetLanguage:"en"!==De?De:void 0,taskInstructions:(null==e?void 0:e.instructions)||"",mode:"full-improve"}});if(r)throw console.error("âŒ Answer improvement error:",r),r;if(!t)throw new Error("No response data received from improvement service");if(!t.success||!t.improved){const e=t.error||t.details||"Failed to improve answer";throw console.error("âŒ Answer improvement failed:",e),new Error(e)}yt(t.improved),K({title:"Answer Enhanced! âœ¨",description:"Your improved answer is ready."})}catch(e){console.error("âŒ Answer improvement catch error:",e);let t="Failed to improve answer. Please try again.";(null==e?void 0:e.message)&&(t=e.message),K({title:"Error",description:t,variant:"destructive",duration:5e3})}finally{jt(!1)}}},disabled:kt||!bt.trim(),className:"px-2 py-1 transition-all hover:translate-x-0.5 disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:translate-x-0 focus:outline-none focus:ring-0",style:{backgroundColor:"transparent",color:"note"===Q.theme.name?"#8b7355":Q.textPrimary,border:"none",boxShadow:"none",outline:"none"},children:kt?e.jsx(F,{className:"w-5 h-5 animate-spin"}):e.jsx($,{className:"w-5 h-5"})})}),e.jsx(y,{children:e.jsx("p",{children:"Enhance answer (vocab, grammar, structure)"})})]})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-semibold invisible",children:"Placeholder"}),vt.trim()&&e.jsxs("button",{onClick:async()=>{try{await navigator.clipboard.writeText(vt),K({title:"Copied",description:"Enhanced answer copied to clipboard."})}catch(e){K({title:"Copy failed",description:"Please copy manually.",variant:"destructive"})}},className:"text-xs flex items-center gap-1 px-2 py-1 rounded-md transition-colors hover:bg-black/5",style:{color:"note"===Q.theme.name?"#8b7355":Q.textSecondary},children:[e.jsx(q,{className:"w-3 h-3"}),"Copy"]})]}),e.jsx(p,{value:vt,readOnly:!0,placeholder:"Enhanced answer will appear here...",className:"min-h-[120px] text-sm leading-relaxed resize-none rounded-xl focus-visible:ring-0 focus:ring-0 focus-visible:outline-none",style:{backgroundColor:"note"===Q.theme.name?"#fffaf1":"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.5)":"dark"===Q.theme.name?"rgba(255,255,255,0.05)":"minimalist"===Q.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:"note"===Q.theme.name?"#e6cda4":Q.border,borderWidth:"1px",borderStyle:"solid",color:Q.textPrimary,boxShadow:"none",outline:"none"}})]})]})}),e.jsx("div",{className:"mt-6",children:(1===ie&&Je||2===ie&&rt)&&e.jsx(M,{feedback:1===ie?Je:rt,improved:1===ie?et:st})}),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>V("/ielts/writing"),className:"fixed bottom-6 left-6 z-50 rounded-xl",style:{backgroundColor:"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.9)":"dark"===Q.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===Q.theme.name?"#ffffff":Q.theme.colors.cardBackground,borderColor:Q.border,color:Q.textPrimary},children:"Exit"}),e.jsxs("div",{className:"fixed bottom-6 right-3 sm:bottom-6 sm:right-6 z-50",children:[Pe&&e.jsxs(g,{className:"backdrop-blur-md rounded-3xl w-[260px] h-[360px] sm:w-96 sm:h-[500px] shadow-2xl flex flex-col transform-gpu origin-bottom-right transition-all duration-260 ease-in-out "+(Ie?"opacity-100 scale-100 translate-y-0":"opacity-0 scale-75 translate-y-8"),style:{backgroundColor:"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.95)":"dark"===Q.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===Q.theme.name?"#ffffff":Q.theme.colors.cardBackground,borderColor:Q.border,backdropFilter:"glassmorphism"===Q.theme.name?"blur(12px)":"dark"===Q.theme.name?"blur(8px)":"none",...Q.cardStyle},children:[e.jsx(_,{className:"pb-1 sm:pb-2 rounded-t-3xl relative",children:e.jsx("div",{className:"absolute top-1.5 right-1.5 sm:top-2 sm:right-2",children:e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>{Ee(!1),setTimeout(()=>Te(!1),260)},className:"h-7 w-7 sm:h-8 sm:w-8 p-0",style:{color:Q.textPrimary},children:"âœ•"})})}),e.jsxs(x,{className:"flex-1 flex flex-col px-2.5 py-2 sm:p-4 overflow-hidden",children:[e.jsx(T,{className:"flex-1 min-h-0",children:e.jsx(I,{className:"flex-1 min-h-0",children:0!==Wt().length||Ne?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-lg p-3 mb-4",style:{backgroundColor:"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.1)":"dark"===Q.theme.name?"rgba(255,255,255,0.05)":"minimalist"===Q.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:Q.border,borderWidth:"1px",borderStyle:"solid"},children:e.jsx("div",{className:"text-[10px] sm:text-sm whitespace-pre-wrap",style:{color:Q.textSecondary},children:(null==Lt?void 0:Lt.title)||(1===ie?"Letter Writing":"Essay Writing")})}),Wt().map(t=>e.jsxs(A,{from:"user"===t.type?"user":"assistant",children:["bot"===t.type&&e.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"52px",height:"52px",flexShrink:0},children:e.jsx("img",{src:"/1000031289.png",alt:"Catie",style:{width:"100%",height:"100%",objectFit:"cover"}})}),e.jsx(B,{children:e.jsx("div",{className:"px-3 py-2 rounded-xl text-sm",style:{backgroundColor:"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.1)":"dark"===Q.theme.name?"rgba(255,255,255,0.05)":"minimalist"===Q.theme.name?"#f9fafb":"rgba(255,255,255,0.5)",borderColor:Q.border,borderWidth:"1px",borderStyle:"solid",color:Q.textPrimary},children:e.jsx(z,{dangerouslySetInnerHTML:{__html:t.content.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/^â€¢ (.*)$/gm,"<li>$1</li>").replace(/(<li>.*<\/li>)/s,"<ul>$1</ul>").replace(/\n/g,"<br>")}})})}),"user"===t.type&&(null==J?void 0:J.avatar_url)&&e.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"52px",height:"52px",flexShrink:0},children:e.jsx("img",{src:J.avatar_url,alt:"Your avatar",style:{width:"100%",height:"100%",objectFit:"cover"}})})]},t.id)),Ne&&e.jsxs(A,{from:"assistant",children:[e.jsx(B,{children:e.jsx("div",{className:"px-3 py-2 rounded-xl text-sm",style:{backgroundColor:"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.1)":"dark"===Q.theme.name?"rgba(255,255,255,0.05)":"minimalist"===Q.theme.name?"#f9fafb":"rgba(255,255,255,0.5)",borderColor:Q.border,borderWidth:"1px",borderStyle:"solid"},children:e.jsx(D,{text:"Thinking..."})})}),e.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"52px",height:"52px"},children:e.jsx("img",{src:"/1000031289.png",alt:"Catie",style:{width:"100%",height:"100%",objectFit:"cover"}})})]}),e.jsx("div",{ref:mt})]}):e.jsx(E,{icon:e.jsx(W,{className:"size-9 sm:size-12",style:{color:Q.textSecondary}}),title:"Start a conversation",description:"Ask for help with your IELTS writing practice"})})}),e.jsx("div",{className:"flex-shrink-0 mt-2.5 sm:mt-4",children:e.jsxs("div",{className:"flex gap-1.5 sm:gap-2",children:[e.jsx("input",{type:"text",value:je,onChange:e=>we(e.target.value),onKeyPress:e=>"Enter"===e.key&&!Ne&&je.trim()&&Bt(),placeholder:"Ask for writing help...",className:"flex-1 px-2.5 py-1.5 sm:px-3 sm:py-2 rounded-lg text-[10px] sm:text-sm focus:outline-none focus:ring-0 resize-none",style:{backgroundColor:"glassmorphism"===Q.theme.name?"rgba(255,255,255,0.1)":"dark"===Q.theme.name?"rgba(255,255,255,0.05)":"minimalist"===Q.theme.name?"#ffffff":Q.theme.colors.cardBackground,borderColor:Q.border,borderWidth:"1px",borderStyle:"solid",color:Q.textPrimary},disabled:Ne}),e.jsx("style",{dangerouslySetInnerHTML:{__html:`\n                      input[placeholder="Ask for writing help..."]::placeholder {\n                        color: ${Q.textSecondary};\n                      }\n                    `}}),e.jsx(h,{onClick:()=>Bt(),disabled:Ne||!je.trim(),variant:"ghost",size:"icon",className:"h-7 w-7 sm:h-8 sm:w-8 p-0",style:{color:Q.textPrimary},children:Ne?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2",style:{borderColor:Q.textPrimary}}):e.jsx(H,{className:"w-4 h-4"})})]})})]})]}),!Pe&&e.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"64px",height:"64px",cursor:"pointer",boxShadow:"0 8px 20px rgba(0,0,0,0.18)",transition:"transform 0.22s ease-out, box-shadow 0.22s ease-out"},onClick:()=>{Te(!0),requestAnimationFrame(()=>Ee(!0))},onMouseEnter:e=>{const t=e.currentTarget;t.style.transform="scale(1.06) translateY(-2px)",t.style.boxShadow="0 14px 30px rgba(0,0,0,0.24)"},onMouseLeave:e=>{const t=e.currentTarget;t.style.transform="scale(1.0) translateY(0px)",t.style.boxShadow="0 10px 25px rgba(0,0,0,0.15)"},children:e.jsx("img",{src:"/1000031289.png",alt:"Catie",style:{width:"100%",height:"100%",objectFit:"cover"}})})]}),Se&&e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsx("div",{className:"bg-card p-8 rounded-3xl shadow-xl border border-border",children:e.jsx(c,{message:"Analyzing your writing with AI examiner...",subMessage:"Please wait while we evaluate your IELTS writing",size:200})})})]})})})}),Ke&&e.jsx("style",{children:'\n          /* Prominent underline for spell check errors */\n          textarea[spellcheck="true"]::spelling-error {\n            text-decoration: wavy underline rgba(239, 68, 68, 0.8) 2px !important;\n            text-decoration-skip-ink: none !important;\n          }\n\n          textarea[spellcheck="true"]:focus::spelling-error {\n            text-decoration: wavy underline rgba(239, 68, 68, 0.9) 2px !important;\n          }\n        '})]}):e.jsx(m,{title:"IELTS Writing Test",showBackButton:!0,children:e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg text-foreground mb-4",children:"Task data not available"}),e.jsx(h,{onClick:()=>V("/ielts-portal"),variant:"outline",children:"Back to Portal"})]})})});var Ft};export{U as default};
