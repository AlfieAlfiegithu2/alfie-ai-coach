import{a1 as e,j as t,G as r,u as a,h as s,ae as n,a8 as i,r as l,bt as o,aa as d,bu as m,B as c,ad as h,a as u,C as x,W as g,T as b,aJ as p,bv as f,bw as v,bx as y,S as k,p as j,q as w,s as N,t as C,R as S,av as _,by as P,U as T,b as I,a0 as E}from"./index-DFIuaFlP.js";import{s as W}from"./supabase-DWL4C3fA.js";import{F as A}from"./languages-qPB6CivY.js";import{C as B,a as z,b as D,O as L,M as F,c as $,R as q,S as H}from"./shimmering-text-zmKSbIPs.js";const M=({feedback:r,improved:a})=>{const s=e();return r?t.jsxs("div",{className:"mt-4 space-y-4",children:[t.jsxs("div",{className:"p-4 rounded-lg border",style:{backgroundColor:"dark"===s.theme.name?"rgba(255,255,255,0.05)":"minimalist"===s.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:s.border},children:[t.jsx("h4",{className:"font-semibold mb-2",style:{color:s.textPrimary},children:"Grammar Feedback:"}),t.jsx("div",{className:"text-sm whitespace-pre-wrap",style:{color:s.textPrimary},children:r})]}),a&&t.jsxs("div",{className:"p-4 rounded-lg border",style:{backgroundColor:"dark"===s.theme.name?"rgba(255,255,255,0.05)":"minimalist"===s.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:s.border},children:[t.jsx("h4",{className:"font-semibold mb-2",style:{color:s.textPrimary},children:"Improved Version:"}),t.jsx("div",{className:"text-sm whitespace-pre-wrap",style:{color:s.textPrimary},children:a})]})]}):null},U=()=>{var U,R,Y,G,X;const{testId:O}=r(),V=a(),{toast:J}=s(),{user:K,profile:Q}=n(),Z=e();i();const[ee,te]=l.useState(null),[re,ae]=l.useState(null),[se,ne]=l.useState(null),[ie,le]=l.useState(1),[oe,de]=l.useState(""),[me,ce]=l.useState(""),[he,ue]=l.useState([]),[xe,ge]=l.useState(!1),[be,pe]=l.useState(!1),[fe,ve]=l.useState([{id:"1",type:"bot",content:"Hi! I'm Catie, your IELTS Writing tutor ðŸ“ I can see your Task 1 instructions above. Ask me anything specific about this task - like how to structure your response, what key features to highlight, or how to get started!",timestamp:new Date}]),[ye,ke]=l.useState([{id:"1",type:"bot",content:"Hi! I'm Catie, your IELTS Writing tutor ðŸ“ I can see your Task 2 essay topic above. Ask me about structuring your argument, developing your ideas for this specific topic, or how to present your opinion effectively!",timestamp:new Date}]),[je,we]=l.useState(""),[Ne,Ce]=l.useState(!1),[Se,_e]=l.useState(!1);l.useState(!1),l.useState(!1);const[Pe,Te]=l.useState(!1),[Ie,Ee]=l.useState(!1),[We,Ae]=l.useState(1),[Be,ze]=l.useState("center"),[De,Le]=l.useState("en"),[Fe,$e]=l.useState("deepseek-v3.2"),[qe]=o(),He=qe.get("training"),[Me,Ue]=l.useState([]),[Re,Ye]=l.useState(0),[Ge,Xe]=l.useState(!1),[Oe,Ve]=l.useState(0),[Je,Ke]=l.useState(!1);l.useState(!1);const[Qe,Ze]=l.useState(null),[et,tt]=l.useState(null),[rt,at]=l.useState(null),[st,nt]=l.useState(null),[it,lt]=l.useState(!1),[ot,dt]=l.useState(!1),mt=l.useRef(null),[ct,ht]=l.useState(""),[ut,xt]=l.useState(""),[gt,bt]=l.useState(!1),[pt,ft]=l.useState(""),[vt,yt]=l.useState(""),[kt,jt]=l.useState(!1);l.useEffect(()=>{if(!O)return;const e=`ielts-writing-draft-${O}-task1`,t=`ielts-writing-draft-${O}-task2`,r=localStorage.getItem(e),a=localStorage.getItem(t);r&&!oe&&de(r),a&&!me&&ce(a)},[O]),l.useEffect(()=>{O&&localStorage.setItem(`ielts-writing-draft-${O}-task1`,oe)},[oe,O]),l.useEffect(()=>{O&&localStorage.setItem(`ielts-writing-draft-${O}-task2`,me)},[me,O]),l.useEffect(()=>{let e;return Ge&&Re>0&&(e=setInterval(()=>{Ye(e=>e<=1?(Xe(!1),0):e-1),Ve(e=>e+1e3)},1e3)),()=>{e&&clearInterval(e)}},[Ge,Re]),l.useEffect(()=>{if(He&&he.length>0){const e=he.filter(e=>e.test_subtype===He||!e.test_subtype&&"Academic"===He);Ue(e)}else Ue(he)},[He,he]),l.useEffect(()=>{O?wt():Nt()},[O]);const wt=async()=>{pe(!0);try{if(!O)throw new Error("Test ID is required");const[e,t]=await Promise.all([W.from("tests").select("id, test_name, test_type, module, skill_category, test_subtype").eq("id",O).maybeSingle(),W.from("questions").select("id, test_id, part_number, question_text, passage_text, image_url, explanation, transcription").eq("test_id",O).in("part_number",[1,2]).order("part_number")]);if(e.error)throw e.error;if(t.error)throw t.error;const r=e.data;if(!r)throw new Error("Test not found");te(r);const a=t.data||[],s=a.find(e=>1===e.part_number),n=a.find(e=>2===e.part_number);if(null==s?void 0:s.image_url){(new Image).src=s.image_url}const i=s?{id:s.id,title:s.question_text||"Task 1 - Data Description",instructions:s.passage_text||"",imageUrl:s.image_url||"",imageContext:s.explanation||"",modelAnswer:s.transcription||""}:{id:"default-task1",title:"Task 1 - Data Description",instructions:"Task 1 question not found. Please contact support.",imageUrl:"",imageContext:"",modelAnswer:""},l=n?{id:n.id,title:n.question_text||"Task 2 - Essay Writing",instructions:n.passage_text||"",modelAnswer:n.transcription||""}:{id:"default-task2",title:"Task 2 - Essay Writing",instructions:"Task 2 question not found. Please contact support.",modelAnswer:""};ae(i),ne(l)}catch(e){const t=(null==e?void 0:e.message)||"Failed to load test data. Please try again.";J({title:"Error",description:t,variant:"destructive"}),te(null),ae(null),ne(null)}finally{pe(!1)}},Nt=async()=>{ge(!0);try{const{data:e,error:t}=await W.from("tests").select("id, test_name, test_type, module, skill_category, test_subtype, created_at").eq("test_type","IELTS").or("module.ilike.Writing,skill_category.ilike.Writing,test_name.ilike.%Writing%").order("created_at",{ascending:!1}).limit(50);if(t)throw t;const r=(e||[]).filter(e=>e&&e.id&&(e.test_name||e.module||e.skill_category));ue(r)}catch(e){J({title:"Error",description:"Failed to load available writing tests. Please try again.",variant:"destructive"}),ue([])}finally{ge(!1)}},Ct=()=>1===ie?re:se,St=()=>1===ie?oe:me,_t=e=>{1===ie?de(e):ce(e)},Pt=e=>e.trim().split(/\s+/).filter(e=>e.length>0).length,Tt=()=>Pt(1===ie?oe:me),It=()=>1===ie?150:250,Et=()=>Se||(it||!oe.trim())&&(ot||!me.trim())||!it&&oe.trim()&&Pt(oe)<150||!ot&&me.trim()&&Pt(me)<250||!it&&!oe.trim()||!ot&&!me.trim(),Wt=()=>1===ie?fe:ye,At=e=>{1===ie?ve(e):ke(e)},Bt=async e=>{var t;const r=je.trim();if(!r||Ne)return;const a={id:Date.now().toString(),type:"user",content:r,timestamp:new Date};At(e=>[...e,a]),we(""),Ce(!0);try{const e=Ct();if(!e)throw new Error("No task data available");const t=St(),{data:a,error:s}=await W.functions.invoke("openai-chat",{body:{message:r,context:"catbot",imageContext:e.imageContext,taskType:1===ie?"Task 1 - Data Description (charts, graphs, tables, diagrams)":"Task 2 - Essay Writing (arguments, opinions, examples)",taskInstructions:e.instructions,studentWriting:t,skipCache:!0}});if(s)throw s;const n={id:(Date.now()+1).toString(),type:"bot",content:a.response,timestamp:new Date};At(e=>[...e,n])}catch(s){let e="Connection Issue",r="Failed to get response from Catie. Please try again.";(null==(t=null==s?void 0:s.message)?void 0:t.includes("service temporarily unavailable"))||503===(null==s?void 0:s.statusCode)?(e="Service Update",r="Catie is being updated! Please try again in a moment."):429===(null==s?void 0:s.statusCode)&&(e="High Traffic",r="Lots of students are getting help! Please wait a moment and try again."),J({title:e,description:r,variant:"destructive"})}finally{Ce(!1)}},zt=e=>{le(e)};l.useEffect(()=>{var e;null==(e=mt.current)||e.scrollIntoView({behavior:"smooth"})},[fe,ye,Ne,ie]);const Dt=async()=>{var e,t,r,a,s,n,i,l,o,d,m,c,h,u,x,g,b,p,f,v,y,k,j,w,N,C,S,_,P,T,I,E,A,B;const z=!it&&oe.trim(),D=!ot&&me.trim();if(!z&&!D)return void J({title:"Please complete at least one task",description:"You need to complete at least Task 1 or Task 2 to submit (or skip one)",variant:"destructive"});const L=Pt(oe),F=Pt(me);if(!it){if(!oe.trim())return void J({title:"Task 1 is required",description:"Please complete Task 1 or skip it before submitting.",variant:"destructive"});if(L<150)return void J({title:"Task 1 word count too low",description:`Task 1 requires a minimum of 150 words. You currently have ${L} words.`,variant:"destructive"})}if(!ot){if(!me.trim())return void J({title:"Task 2 is required",description:"Please complete Task 2 or skip it before submitting.",variant:"destructive"});if(F<250)return void J({title:"Task 2 word count too low",description:`Task 2 requires a minimum of 250 words. You currently have ${F} words.`,variant:"destructive"})}_e(!0);try{const[z]=await Promise.all([W.functions.invoke("ielts-writing-examiner",{body:{task1Answer:!it&&oe.trim()?oe.trim():null,task2Answer:!ot&&me.trim()?me.trim():null,task1Data:!it&&oe.trim()?re:null,task2Data:!ot&&me.trim()?se:null,targetLanguage:"en"!==De?De:void 0,model:Fe}})]);if(z.error)throw z.error;const{structured:D,feedback:L,task1WordCount:F,task2WordCount:$}=z.data,q=!it&&oe.trim()?F||Pt(oe):0,H=!ot&&me.trim()?$||Pt(me):0,{data:M,error:U}=await W.from("test_results").insert({user_id:null==K?void 0:K.id,test_type:"writing",score_percentage:Math.round(10*((null==(e=null==D?void 0:D.overall)?void 0:e.band)??(((null==(t=null==D?void 0:D.task1)?void 0:t.overall_band)??7)+2*((null==(r=null==D?void 0:D.task2)?void 0:r.overall_band)??7))/3)),time_taken:Math.floor(Oe/1e3),completed_at:(new Date).toISOString(),test_data:{task1Data:re?{id:re.id,title:re.title,instructions:re.instructions,imageUrl:re.imageUrl,imageContext:re.imageContext,modelAnswer:re.modelAnswer}:null,task2Data:se?{id:se.id,title:se.title,instructions:se.instructions,modelAnswer:se.modelAnswer}:null,task1Answer:!it&&oe.trim()?oe.trim():null,task2Answer:!ot&&me.trim()?me.trim():null,overall_band:(null==(a=null==D?void 0:D.overall)?void 0:a.band)||7}}).select().single();if(U)throw U;if(!it&&oe.trim()){const{error:e}=await W.from("writing_test_results").insert({user_id:null==K?void 0:K.id,test_result_id:M.id,task_number:1,prompt_text:(null==re?void 0:re.instructions)||(null==re?void 0:re.title)||"",user_response:oe,word_count:q,band_scores:{task_achievement:(null==(i=null==(n=null==(s=null==D?void 0:D.task1)?void 0:s.criteria)?void 0:n.task_achievement)?void 0:i.band)??null,coherence_and_cohesion:(null==(d=null==(o=null==(l=null==D?void 0:D.task1)?void 0:l.criteria)?void 0:o.coherence_and_cohesion)?void 0:d.band)??null,lexical_resource:(null==(h=null==(c=null==(m=null==D?void 0:D.task1)?void 0:m.criteria)?void 0:c.lexical_resource)?void 0:h.band)??null,grammatical_range_and_accuracy:(null==(g=null==(x=null==(u=null==D?void 0:D.task1)?void 0:u.criteria)?void 0:x.grammatical_range_and_accuracy)?void 0:g.band)??null},detailed_feedback:(null==(b=null==D?void 0:D.task1)?void 0:b.feedback_markdown)||"",improvement_suggestions:(null==(f=null==(p=null==D?void 0:D.task1)?void 0:p.feedback)?void 0:f.improvements)||[]});if(e)throw e}if(!ot&&me.trim()){const{error:e}=await W.from("writing_test_results").insert({user_id:null==K?void 0:K.id,test_result_id:M.id,task_number:2,prompt_text:(null==se?void 0:se.instructions)||(null==se?void 0:se.title)||"",user_response:me,word_count:H,band_scores:{task_response:(null==(k=null==(y=null==(v=null==D?void 0:D.task2)?void 0:v.criteria)?void 0:y.task_response)?void 0:k.band)??null,coherence_and_cohesion:(null==(N=null==(w=null==(j=null==D?void 0:D.task2)?void 0:j.criteria)?void 0:w.coherence_and_cohesion)?void 0:N.band)??null,lexical_resource:(null==(_=null==(S=null==(C=null==D?void 0:D.task2)?void 0:C.criteria)?void 0:S.lexical_resource)?void 0:_.band)??null,grammatical_range_and_accuracy:(null==(I=null==(T=null==(P=null==D?void 0:D.task2)?void 0:P.criteria)?void 0:T.grammatical_range_and_accuracy)?void 0:I.band)??null},detailed_feedback:(null==(E=null==D?void 0:D.task2)?void 0:E.feedback_markdown)||"",improvement_suggestions:(null==(B=null==(A=null==D?void 0:D.task2)?void 0:A.feedback)?void 0:B.improvements)||[]});if(e)throw e}V("/ielts-writing-results-pro",{state:{testName:null==ee?void 0:ee.test_name,testId:O,submissionId:M.id,task1Answer:!it&&oe.trim()?oe.trim():null,task2Answer:!ot&&me.trim()?me.trim():null,task1Skipped:it,task2Skipped:ot,feedback:L,structured:D,task1Data:re,task2Data:se,task1WordCount:q,task2WordCount:H}})}catch($){J({title:"Error",description:(null==$?void 0:$.message)||"Failed to submit test for evaluation",variant:"destructive"})}finally{_e(!1)}};if(l.useEffect(()=>{Ge||(Ye(3600),Xe(!0))},[Ge]),!O){if(xe)return t.jsx(d,{title:"Writing Tests",children:t.jsx("div",{className:"flex items-center justify-center min-h-96",children:t.jsx("div",{className:"text-center",children:t.jsx(m,{message:"Loading available writing tests...",subMessage:"Please wait",size:150})})})});if(Me.length>0||he.length>0){const e=Me.length>0?Me:he;return t.jsxs("div",{className:"min-h-screen relative",children:[t.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"note"===Z.theme.name||"minimalist"===Z.theme.name||"dark"===Z.theme.name?"none":"url('/1000031207.png')",backgroundColor:Z.backgroundImageColor}}),t.jsx("div",{className:"relative z-10",children:t.jsx(d,{title:"Available Writing Tests",transparentBackground:!0,children:t.jsx("div",{className:"min-h-screen py-12",children:t.jsx("div",{className:"container mx-auto px-4",children:t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsxs("div",{className:"mb-8",children:[t.jsx(c,{variant:"outline",onClick:()=>V("/ielts-portal"),className:"mb-4 transition-all duration-200 hover:shadow-md",style:{backgroundColor:"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.5)":"dark"===Z.theme.name?"rgba(255,255,255,0.1)":Z.cardBackground,color:Z.textPrimary,borderColor:Z.border},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=Z.hoverBg,e.currentTarget.style.color=Z.buttonPrimary,e.currentTarget.style.borderColor=Z.buttonPrimary},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===Z.theme.name?"rgba(255,255,255,0.5)":"dark"===Z.theme.name?"rgba(255,255,255,0.1)":Z.cardBackground,e.currentTarget.style.color=Z.textPrimary,e.currentTarget.style.borderColor=Z.border},children:"â† Back to IELTS Portal"}),t.jsxs("h1",{className:"text-4xl font-bold mb-2 text-center",style:{color:Z.textPrimary},children:["IELTS ",He||"Writing"," Tests"]})]}),t.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:e.map(e=>e&&e.id?t.jsx(h,{className:"cursor-pointer h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg bg-white/80 flex items-center justify-center",onClick:()=>V(`/ielts-writing-test/${e.id}`),children:t.jsx(u,{className:"p-3 md:p-4 text-center flex items-center justify-center h-full",children:t.jsx("h3",{className:"font-semibold text-sm",children:e.test_name||"Untitled Test"})})},e.id):null)})]})})})})})]})}return t.jsx(d,{title:"Writing Tests",children:t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background to-primary/5 py-12",children:t.jsxs("div",{className:"container mx-auto px-4 text-center",children:[t.jsx("h1",{className:"text-4xl font-bold text-foreground mb-4",children:"IELTS Writing Tests"}),t.jsx("p",{className:"text-lg text-muted-foreground mb-8",children:"No writing tests available yet"}),t.jsx(c,{onClick:()=>V("/ielts-portal"),variant:"outline",children:"Back to Portal"})]})})})}if(be)return t.jsx(d,{title:"IELTS Writing Test",showBackButton:!0,children:t.jsx("div",{className:"flex items-center justify-center min-h-96",children:t.jsx("div",{className:"text-center",children:t.jsx(m,{message:"Loading IELTS Writing test...",subMessage:"Please wait while we fetch your test",size:150})})})});if(O&&(!ee||!re||!se))return t.jsx(d,{title:"IELTS Writing Test",showBackButton:!0,children:t.jsx("div",{className:"flex items-center justify-center min-h-96",children:t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-lg text-foreground mb-4",children:"Unable to load test"}),t.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:ee?re&&se?"Unknown error":"Test data is incomplete":"Test not found"}),t.jsx(c,{onClick:()=>V("/ielts-portal"),variant:"outline",children:"Back to Portal"})]})})});const Lt=Ct();return Lt?t.jsxs("div",{className:"min-h-screen relative",style:{backgroundColor:"dark"===Z.theme.name?Z.theme.colors.background:"transparent"},children:[t.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"note"===Z.theme.name||"minimalist"===Z.theme.name||"dark"===Z.theme.name?"none":"url('/1000031207.png')",backgroundColor:Z.backgroundImageColor}}),t.jsx("div",{className:"relative z-10 flex flex-col pb-24 sm:pb-6",style:{backgroundColor:"dark"===Z.theme.name?Z.theme.colors.background:"transparent",minHeight:"calc(100vh - 80px)"},children:t.jsx(d,{title:"IELTS Writing Test",showBackButton:!0,transparentBackground:!0,children:t.jsx("div",{className:"flex-1 flex justify-center py-6 sm:py-6 pb-4",children:t.jsxs("div",{className:"w-full max-w-6xl mx-auto space-y-4 px-4 sm:px-6 flex flex-col",children:[t.jsx(x,{className:"rounded-3xl mb-4 max-w-fit mx-auto px-4",style:{backgroundColor:"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.9)":"dark"===Z.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===Z.theme.name?"#ffffff":Z.theme.colors.cardBackground,borderColor:Z.border,backdropFilter:"glassmorphism"===Z.theme.name?"blur(12px)":"dark"===Z.theme.name?"blur(8px)":"none",boxShadow:"dark"===Z.theme.name?"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)":"note"===Z.theme.name?null==(U=Z.theme.styles.cardStyle)?void 0:U.boxShadow:"0 8px 32px rgba(15, 23, 42, 0.16), 0 0 0 1px rgba(148, 163, 253, 0.06)",...Z.cardStyle},children:t.jsx(u,{className:"p-2 sm:p-3",children:t.jsxs("div",{className:"flex items-center justify-center gap-2 sm:gap-3 flex-wrap",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(g,{className:"w-3.5 h-3.5",style:{color:Z.textPrimary}}),t.jsx("span",{className:"text-sm font-medium tabular-nums",style:{color:Z.textPrimary},children:(Ft=Re,`${Math.floor(Ft/60)}:${(Ft%60).toString().padStart(2,"0")}`)})]}),t.jsx(c,{size:"sm",onClick:()=>zt(1),className:"h-9 sm:h-8 px-4 sm:px-3 text-sm sm:text-sm font-medium min-w-[70px]",style:{backgroundColor:1===ie?Z.buttonPrimary:"transparent",color:1===ie?"#ffffff":Z.textPrimary,border:"none"},children:"Task 1"}),t.jsx(c,{size:"sm",onClick:()=>zt(2),className:"h-9 sm:h-8 px-4 sm:px-3 text-sm sm:text-sm font-medium min-w-[70px]",style:{backgroundColor:2===ie?Z.buttonPrimary:"transparent",color:2===ie?"#ffffff":Z.textPrimary,border:"none"},children:"Task 2"})]})})}),1===ie?(null==Lt?void 0:Lt.imageUrl)?t.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 flex-1",style:{minHeight:"400px"},children:[t.jsx("div",{className:"flex-1 lg:flex-[0_0_50%] min-h-0",children:t.jsx(x,{className:"rounded-3xl h-full",style:{backgroundColor:"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.9)":"dark"===Z.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===Z.theme.name?"#ffffff":Z.theme.colors.cardBackground,borderColor:Z.border,backdropFilter:"glassmorphism"===Z.theme.name?"blur(12px)":"dark"===Z.theme.name?"blur(8px)":"none",boxShadow:"dark"===Z.theme.name?"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)":"note"===Z.theme.name?null==(R=Z.theme.styles.cardStyle)?void 0:R.boxShadow:"0 8px 32px rgba(15, 23, 42, 0.16), 0 0 0 1px rgba(148, 163, 253, 0.06)",...Z.cardStyle,display:"flex",flexDirection:"column"},children:t.jsxs(u,{className:"p-4 flex-1 flex flex-col",style:{minHeight:0},children:[t.jsx("div",{className:"mb-4",children:(null==Lt?void 0:Lt.instructions)&&t.jsx("div",{children:t.jsx("div",{className:"whitespace-pre-wrap leading-relaxed p-3 rounded-lg text-sm sm:text-base",style:{backgroundColor:"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.1)":"dark"===Z.theme.name?"rgba(255,255,255,0.05)":"minimalist"===Z.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:Z.border,borderWidth:"1px",borderStyle:"solid",color:Z.textPrimary},children:Lt.instructions})})}),t.jsx("div",{className:"flex-1 overflow-hidden",children:t.jsx("img",{src:Lt.imageUrl,alt:"Task 1 visual data",className:"w-full h-full object-contain cursor-pointer",loading:"eager",decoding:"async",onClick:e=>{const t=e.currentTarget.getBoundingClientRect(),r=(e.clientX-t.left)/t.width*100,a=(e.clientY-t.top)/t.height*100;ze(`${r}% ${a}%`),Ae(1===We?1.5:1)},style:{transform:`scale(${We})`,transformOrigin:Be,transition:"transform 0.2s ease-out"}})})]})})}),t.jsx("div",{className:"flex-1 lg:flex-[0_0_50%] min-h-0",children:t.jsx(x,{className:"rounded-3xl h-full",style:{backgroundColor:"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.9)":"dark"===Z.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===Z.theme.name?"#ffffff":Z.theme.colors.cardBackground,borderColor:Z.border,backdropFilter:"glassmorphism"===Z.theme.name?"blur(12px)":"dark"===Z.theme.name?"blur(8px)":"none",boxShadow:"dark"===Z.theme.name?"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)":"note"===Z.theme.name?null==(Y=Z.theme.styles.cardStyle)?void 0:Y.boxShadow:"0 8px 32px rgba(15, 23, 42, 0.16), 0 0 0 1px rgba(148, 163, 253, 0.06)",...Z.cardStyle,display:"flex",flexDirection:"column"},children:t.jsxs(u,{className:"flex-1 p-4 flex flex-col",style:{minHeight:0},children:[t.jsx("div",{className:"flex-1 flex flex-col",style:{minHeight:0},children:t.jsx(b,{value:St(),onChange:e=>_t(e.target.value),className:"flex-1 min-h-[300px] w-full text-base leading-relaxed resize-none rounded-2xl focus:outline-none focus:ring-0",placeholder:it?"Task 1 is skipped":"General"===(null==ee?void 0:ee.test_subtype)||"General"===He?"Write your letter here...":"Write your Task 1 response here...",spellCheck:Je,disabled:it,style:{backgroundColor:it?"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.05)":"dark"===Z.theme.name?"rgba(255,255,255,0.02)":"minimalist"===Z.theme.name?"#f3f4f6":"rgba(255,255,255,0.3)":"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.1)":"dark"===Z.theme.name?"rgba(255,255,255,0.05)":"minimalist"===Z.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:Z.border,color:it?Z.textSecondary:Z.textPrimary,outline:"none",boxShadow:"none",cursor:it?"not-allowed":"text",opacity:it?.6:1}})}),t.jsxs("div",{className:"flex items-center justify-between mt-4 pt-3 border-t flex-shrink-0",style:{borderColor:Z.border},children:[t.jsxs("div",{className:"text-xs font-medium",style:{color:Z.textSecondary},children:[t.jsx("span",{className:Tt()<It()?"text-red-500":"text-green-600",children:Tt()})," / ",It()]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(c,{size:"sm",variant:"ghost",onClick:()=>{lt(!it),it||zt(2)},className:"h-7 px-2 text-xs font-medium hover:bg-transparent",style:{backgroundColor:it?Z.buttonPrimary:"transparent",color:it?"#ffffff":Z.textPrimary,border:"none",boxShadow:"none"},children:it?"Unskip":"Skip"}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"text-xs font-medium",style:{color:Z.textPrimary},children:"Spell Check"}),t.jsx(p,{children:t.jsxs(f,{children:[t.jsx(v,{asChild:!0,children:t.jsx("div",{onClick:()=>Ke(!Je),className:"relative inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none",style:{backgroundColor:Je?Z.buttonPrimary:"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.2)":"dark"===Z.theme.name?"rgba(255,255,255,0.1)":"minimalist"===Z.theme.name?"#e5e7eb":Z.border},"data-state":Je?"checked":"unchecked",children:t.jsx("div",{className:"pointer-events-none flex h-4 w-4 rounded-full shadow-lg ring-0 transition-transform",style:{backgroundColor:"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.95)":"dark"===Z.theme.name?"rgba(255,255,255,0.9)":"minimalist"===Z.theme.name?"#ffffff":Z.theme.colors.cardBackground,transform:Je?"translateX(16px)":"translateX(0px)"}})})}),t.jsx(y,{children:t.jsx("p",{children:Je?"Hide spell check":"Show spell check"})})]})})]})]})]})]})})})]}):t.jsx(x,{className:"rounded-3xl max-w-3xl w-full mx-auto",style:{backgroundColor:"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.9)":"dark"===Z.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===Z.theme.name?"#ffffff":Z.theme.colors.cardBackground,borderColor:Z.border,backdropFilter:"glassmorphism"===Z.theme.name?"blur(12px)":"dark"===Z.theme.name?"blur(8px)":"none",boxShadow:"dark"===Z.theme.name?"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)":"note"===Z.theme.name?null==(G=Z.theme.styles.cardStyle)?void 0:G.boxShadow:"0 8px 32px rgba(15, 23, 42, 0.16), 0 0 0 1px rgba(148, 163, 253, 0.06)",...Z.cardStyle,minHeight:("dark"===Z.theme.name?500:"minimalist"===Z.theme.name?550:"note"===Z.theme.name?580:600)+"px"},children:t.jsxs(u,{className:"p-4 flex flex-col flex-1",children:[(null==Lt?void 0:Lt.instructions)&&t.jsx("div",{className:"mb-4",children:t.jsx("div",{className:"whitespace-pre-wrap leading-relaxed p-3 rounded-lg text-sm",style:{backgroundColor:"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.1)":"dark"===Z.theme.name?"rgba(255,255,255,0.05)":"minimalist"===Z.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:Z.border,borderWidth:"1px",borderStyle:"solid",color:Z.textPrimary},children:Lt.instructions})}),t.jsx(b,{value:St(),onChange:e=>_t(e.target.value),placeholder:it?"Task 1 is skipped":"General"===(null==ee?void 0:ee.test_subtype)||"General"===He?"Write your letter here...":"Write your Task 1 response here...",className:"flex-1 min-h-[500px] text-base leading-relaxed resize-none rounded-2xl focus:outline-none focus:ring-0",spellCheck:Je,disabled:it,style:{backgroundColor:it?"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.05)":"dark"===Z.theme.name?"rgba(255,255,255,0.02)":"minimalist"===Z.theme.name?"#f3f4f6":"rgba(255,255,255,0.3)":"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.1)":"dark"===Z.theme.name?"rgba(255,255,255,0.05)":"minimalist"===Z.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:Z.border,color:it?Z.textSecondary:Z.textPrimary,outline:"none",boxShadow:"none",cursor:it?"not-allowed":"text",opacity:it?.6:1,height:"100%"}}),t.jsxs("div",{className:"flex items-center justify-between mt-4 pt-3 border-t",style:{borderColor:Z.border},children:[t.jsxs("div",{className:"text-xs font-medium",style:{color:Z.textSecondary},children:[t.jsx("span",{className:Tt()<It()?"text-red-500":"text-green-600",children:Tt()})," / ",It()]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(c,{size:"sm",variant:"ghost",onClick:()=>{lt(!it),it||zt(2)},className:"h-7 px-2 text-xs font-medium hover:bg-transparent",style:{backgroundColor:it?Z.buttonPrimary:"transparent",color:it?"#ffffff":Z.textPrimary,border:"none",boxShadow:"none"},children:it?"Unskip":"Skip"}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"text-xs font-medium",style:{color:Z.textPrimary},children:"Spell Check"}),t.jsx(p,{children:t.jsxs(f,{children:[t.jsx(v,{asChild:!0,children:t.jsx("div",{onClick:()=>Ke(!Je),className:"relative inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none",style:{backgroundColor:Je?Z.buttonPrimary:"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.2)":"dark"===Z.theme.name?"rgba(255,255,255,0.1)":"minimalist"===Z.theme.name?"#e5e7eb":Z.border},"data-state":Je?"checked":"unchecked",children:t.jsx("div",{className:"pointer-events-none flex h-4 w-4 rounded-full shadow-lg ring-0 transition-transform",style:{backgroundColor:"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.95)":"dark"===Z.theme.name?"rgba(255,255,255,0.9)":"minimalist"===Z.theme.name?"#ffffff":Z.theme.colors.cardBackground,transform:Je?"translateX(16px)":"translateX(0px)"}})})}),t.jsx(y,{children:t.jsx("p",{children:Je?"Hide spell check":"Show spell check"})})]})})]}),t.jsx(c,{onClick:Dt,disabled:Et(),variant:"default",className:"h-7 px-3 text-xs",style:{backgroundColor:Z.buttonPrimary,color:"#ffffff"},children:Se?"Submitting...":"Submit Test"})]})]})]})}):t.jsx(x,{className:"rounded-3xl h-full max-w-3xl w-full mx-auto",style:{backgroundColor:"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.9)":"dark"===Z.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===Z.theme.name?"#ffffff":Z.theme.colors.cardBackground,borderColor:Z.border,backdropFilter:"glassmorphism"===Z.theme.name?"blur(12px)":"dark"===Z.theme.name?"blur(8px)":"none",boxShadow:"dark"===Z.theme.name?"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)":"note"===Z.theme.name?null==(X=Z.theme.styles.cardStyle)?void 0:X.boxShadow:"0 8px 32px rgba(15, 23, 42, 0.16), 0 0 0 1px rgba(148, 163, 253, 0.06)",...Z.cardStyle,minHeight:("dark"===Z.theme.name?500:"minimalist"===Z.theme.name?550:"note"===Z.theme.name?580:600)+"px"},children:t.jsxs(u,{className:"p-4 flex flex-col h-full",children:[(null==Lt?void 0:Lt.instructions)&&t.jsx("div",{className:"mb-4",children:t.jsx("div",{className:"whitespace-pre-wrap leading-relaxed p-3 rounded-lg text-sm",style:{backgroundColor:"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.1)":"dark"===Z.theme.name?"rgba(255,255,255,0.05)":"minimalist"===Z.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:Z.border,borderWidth:"1px",borderStyle:"solid",color:Z.textPrimary},children:Lt.instructions})}),t.jsx(b,{value:St(),onChange:e=>_t(e.target.value),placeholder:ot?"Task 2 is skipped":"Write your Task 2 essay here...",className:"flex-1 min-h-[500px] text-base leading-relaxed resize-none rounded-2xl focus:outline-none focus:ring-0",spellCheck:Je,disabled:ot,style:{backgroundColor:ot?"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.05)":"dark"===Z.theme.name?"rgba(255,255,255,0.02)":"minimalist"===Z.theme.name?"#f3f4f6":"rgba(255,255,255,0.3)":"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.1)":"dark"===Z.theme.name?"rgba(255,255,255,0.05)":"minimalist"===Z.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:Z.border,color:ot?Z.textSecondary:Z.textPrimary,outline:"none",boxShadow:"none",cursor:ot?"not-allowed":"text",opacity:ot?.6:1,height:"100%"}}),t.jsxs("div",{className:"flex items-center justify-between mt-4 pt-3 border-t",style:{borderColor:Z.border},children:[t.jsxs("div",{className:"text-xs font-medium",style:{color:Z.textSecondary},children:[t.jsx("span",{className:Tt()<It()?"text-red-500":"text-green-600",children:Tt()})," / ",It()]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(c,{size:"sm",variant:"ghost",onClick:()=>{dt(!ot)},className:"h-7 px-2 text-xs font-medium hover:bg-transparent",style:{backgroundColor:ot?Z.buttonPrimary:"transparent",color:ot?"#ffffff":Z.textPrimary,border:"none",boxShadow:"none"},children:ot?"Unskip":"Skip"}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"text-xs font-medium",style:{color:Z.textPrimary},children:"Spell Check"}),t.jsx(p,{children:t.jsxs(f,{children:[t.jsx(v,{asChild:!0,children:t.jsx("div",{onClick:()=>Ke(!Je),className:"relative inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none",style:{backgroundColor:Je?Z.buttonPrimary:"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.2)":"dark"===Z.theme.name?"rgba(255,255,255,0.1)":"minimalist"===Z.theme.name?"#e5e7eb":Z.border},"data-state":Je?"checked":"unchecked",children:t.jsx("div",{className:"pointer-events-none flex h-4 w-4 rounded-full shadow-lg ring-0 transition-transform",style:{backgroundColor:"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.95)":"dark"===Z.theme.name?"rgba(255,255,255,0.9)":"minimalist"===Z.theme.name?"#ffffff":Z.theme.colors.cardBackground,transform:Je?"translateX(16px)":"translateX(0px)"}})})}),t.jsx(y,{children:t.jsx("p",{children:Je?"Hide spell check":"Show spell check"})})]})})]}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"text-xs font-medium",style:{color:Z.textPrimary},children:"Language"}),t.jsxs(k,{value:De,onValueChange:Le,children:[t.jsx(j,{className:"w-[130px] h-7 text-xs rounded-lg px-2 border shadow-sm focus:ring-2 focus:ring-offset-0",style:{color:Z.textPrimary,backgroundColor:"dark"===Z.theme.name?"rgba(255,255,255,0.1)":"note"===Z.theme.name?"rgba(255,255,255,0.5)":"#ffffff",borderColor:Z.border,"--tw-ring-color":Z.buttonPrimary},children:t.jsx(w,{children:(()=>{const e=A.find(e=>e.value===De);return e?`${e.flag} ${e.nativeName}`:"Language"})()})}),t.jsx(N,{className:"max-h-80",style:{backgroundColor:"note"===Z.theme.name?"#fffaf1":"dark"===Z.theme.name?"#1e293b":"#ffffff",borderColor:"note"===Z.theme.name?"#e6cda4":Z.border},children:A.map(e=>t.jsx(C,{value:e.value,className:"note"===Z.theme.name?"focus:bg-[#f5e6d3] focus:text-[#5c4a32] data-[state=checked]:bg-[#f5e6d3]":"",style:{color:Z.textPrimary},children:t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsx("span",{children:e.flag}),t.jsx("span",{children:e.nativeName})]})},e.value))})]})]}),t.jsx(c,{onClick:Dt,disabled:Et(),variant:"default",className:"h-7 px-3 text-xs",style:{backgroundColor:Z.buttonPrimary,color:"#ffffff"},children:Se?"Submitting...":"Submit Test"})]})]}),t.jsx("div",{className:"mt-3 pt-2 border-t",style:{borderColor:Z.border},children:t.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[t.jsx(S,{htmlFor:"ai-model-selector",className:"text-sm font-medium whitespace-nowrap",style:{color:Z.textPrimary},children:"AI Model:"}),t.jsxs(k,{value:Fe,onValueChange:$e,children:[t.jsx(j,{id:"ai-model-selector",className:"w-[200px] h-9 text-sm border transition-colors rounded-lg",style:{backgroundColor:"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.9)":"dark"===Z.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===Z.theme.name?"#ffffff":Z.theme.colors.cardBackground,borderColor:Z.border,color:Z.textPrimary,backdropFilter:"glassmorphism"===Z.theme.name?"blur(12px)":"none"},children:t.jsx(w,{placeholder:"Select AI Model"})}),t.jsxs(N,{children:[t.jsx(C,{value:"deepseek-v3.2",children:"DeepSeek V3.2"}),t.jsx(C,{value:"gemini-2.5-flash",children:"Gemini 2.5 Flash"})]})]})]})})]})}),t.jsx("div",{className:"mt-6 max-w-3xl mx-auto w-full","data-improve-section":!0,children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"flex items-center justify-between mb-2",children:t.jsx("span",{className:"text-sm font-semibold",style:{color:"note"===Z.theme.name?"#8b7355":Z.textSecondary},children:"Grammar Improve"})}),t.jsx(b,{value:ct,onChange:e=>ht(e.target.value),placeholder:"Paste your text here to improve...",className:"min-h-[120px] text-sm leading-relaxed resize-none rounded-xl focus-visible:ring-0 focus:ring-0 focus-visible:outline-none",style:{backgroundColor:"note"===Z.theme.name?"#fffaf1":"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.5)":"dark"===Z.theme.name?"rgba(255,255,255,0.05)":"minimalist"===Z.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:"note"===Z.theme.name?"#e6cda4":Z.border,borderWidth:"1px",borderStyle:"solid",color:Z.textPrimary,boxShadow:"none",outline:"none"}})]}),t.jsx("div",{className:"flex flex-col items-center justify-center pt-6",children:t.jsx(p,{children:t.jsxs(f,{children:[t.jsx(v,{asChild:!0,children:t.jsx("button",{onClick:async()=>{if(!ct||ct.trim().length<10)J({title:"Insufficient content",description:"Please paste at least 10 characters in the 'Before' box.",variant:"destructive"});else{bt(!0);try{const e=Ct();console.log("âœ¨ Requesting improvement for pasted text");const{data:t,error:r}=await W.functions.invoke("grammar-feedback",{body:{writing:ct,taskType:1===ie?"Task 1 - Data Description":"Task 2 - Essay Writing",taskNumber:ie,targetLanguage:"en"!==De?De:void 0,taskInstructions:(null==e?void 0:e.instructions)||"",mode:"improve"}});if(r)throw console.error("âŒ Improvement error:",r),r;if(!t)throw new Error("No response data received from improvement service");if(!t.success||!t.improved){const e=t.error||t.details||"Failed to improve writing";throw console.error("âŒ Improvement failed:",e),new Error(e)}xt(t.improved),J({title:"Improved! âœ¨",description:"Your improved text is ready in the 'After' box."})}catch(e){console.error("âŒ Improvement catch error:",e);let t="Failed to improve writing. Please try again.";(null==e?void 0:e.message)&&(t=e.message),J({title:"Error",description:t,variant:"destructive",duration:5e3})}finally{bt(!1)}}},disabled:gt||!ct.trim(),className:"px-2 py-1 transition-all hover:translate-x-0.5 disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:translate-x-0 focus:outline-none focus:ring-0",style:{backgroundColor:"transparent",color:"note"===Z.theme.name?"#8b7355":Z.textPrimary,border:"none",boxShadow:"none",outline:"none"},children:gt?t.jsx(_,{className:"w-5 h-5 animate-spin"}):t.jsx(P,{className:"w-5 h-5"})})}),t.jsx(y,{children:t.jsx("p",{children:"Improve text"})})]})})}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-semibold invisible",children:"Placeholder"}),ut.trim()&&t.jsxs("button",{onClick:async()=>{try{await navigator.clipboard.writeText(ut),J({title:"Copied",description:"Improved text copied to clipboard."})}catch(e){J({title:"Copy failed",description:"Please copy manually.",variant:"destructive"})}},className:"text-xs flex items-center gap-1 px-2 py-1 rounded-md transition-colors hover:bg-black/5",style:{color:"note"===Z.theme.name?"#8b7355":Z.textSecondary},children:[t.jsx(T,{className:"w-3 h-3"}),"Copy"]})]}),t.jsx(b,{value:ut,readOnly:!0,placeholder:"Improved text will appear here...",className:"min-h-[120px] text-sm leading-relaxed resize-none rounded-xl focus-visible:ring-0 focus:ring-0 focus-visible:outline-none",style:{backgroundColor:"note"===Z.theme.name?"#fffaf1":"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.5)":"dark"===Z.theme.name?"rgba(255,255,255,0.05)":"minimalist"===Z.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:"note"===Z.theme.name?"#e6cda4":Z.border,borderWidth:"1px",borderStyle:"solid",color:Z.textPrimary,boxShadow:"none",outline:"none"}})]})]})}),t.jsx("div",{className:"mt-4 max-w-3xl mx-auto w-full",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"flex items-center justify-between mb-2",children:t.jsx("span",{className:"text-sm font-semibold",style:{color:"note"===Z.theme.name?"#8b7355":Z.textSecondary},children:"Answer Improve"})}),t.jsx(b,{value:pt,onChange:e=>ft(e.target.value),placeholder:"Paste your answer here for full enhancement...",className:"min-h-[120px] text-sm leading-relaxed resize-none rounded-xl focus-visible:ring-0 focus:ring-0 focus-visible:outline-none",style:{backgroundColor:"note"===Z.theme.name?"#fffaf1":"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.5)":"dark"===Z.theme.name?"rgba(255,255,255,0.05)":"minimalist"===Z.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:"note"===Z.theme.name?"#e6cda4":Z.border,borderWidth:"1px",borderStyle:"solid",color:Z.textPrimary,boxShadow:"none",outline:"none"}})]}),t.jsx("div",{className:"flex flex-col items-center justify-center pt-6",children:t.jsx(p,{children:t.jsxs(f,{children:[t.jsx(v,{asChild:!0,children:t.jsx("button",{onClick:async()=>{if(!pt||pt.trim().length<10)J({title:"Insufficient content",description:"Please paste at least 10 characters in the box.",variant:"destructive"});else{jt(!0);try{const e=Ct();console.log("âœ¨ Requesting full answer improvement for pasted text");const{data:t,error:r}=await W.functions.invoke("grammar-feedback",{body:{writing:pt,taskType:1===ie?"Task 1 - Data Description":"Task 2 - Essay Writing",taskNumber:ie,targetLanguage:"en"!==De?De:void 0,taskInstructions:(null==e?void 0:e.instructions)||"",mode:"full-improve"}});if(r)throw console.error("âŒ Answer improvement error:",r),r;if(!t)throw new Error("No response data received from improvement service");if(!t.success||!t.improved){const e=t.error||t.details||"Failed to improve answer";throw console.error("âŒ Answer improvement failed:",e),new Error(e)}yt(t.improved),J({title:"Answer Enhanced! âœ¨",description:"Your improved answer is ready."})}catch(e){console.error("âŒ Answer improvement catch error:",e);let t="Failed to improve answer. Please try again.";(null==e?void 0:e.message)&&(t=e.message),J({title:"Error",description:t,variant:"destructive",duration:5e3})}finally{jt(!1)}}},disabled:kt||!pt.trim(),className:"px-2 py-1 transition-all hover:translate-x-0.5 disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:translate-x-0 focus:outline-none focus:ring-0",style:{backgroundColor:"transparent",color:"note"===Z.theme.name?"#8b7355":Z.textPrimary,border:"none",boxShadow:"none",outline:"none"},children:kt?t.jsx(_,{className:"w-5 h-5 animate-spin"}):t.jsx(P,{className:"w-5 h-5"})})}),t.jsx(y,{children:t.jsx("p",{children:"Enhance answer (vocab, grammar, structure)"})})]})})}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-semibold invisible",children:"Placeholder"}),vt.trim()&&t.jsxs("button",{onClick:async()=>{try{await navigator.clipboard.writeText(vt),J({title:"Copied",description:"Enhanced answer copied to clipboard."})}catch(e){J({title:"Copy failed",description:"Please copy manually.",variant:"destructive"})}},className:"text-xs flex items-center gap-1 px-2 py-1 rounded-md transition-colors hover:bg-black/5",style:{color:"note"===Z.theme.name?"#8b7355":Z.textSecondary},children:[t.jsx(T,{className:"w-3 h-3"}),"Copy"]})]}),t.jsx(b,{value:vt,readOnly:!0,placeholder:"Enhanced answer will appear here...",className:"min-h-[120px] text-sm leading-relaxed resize-none rounded-xl focus-visible:ring-0 focus:ring-0 focus-visible:outline-none",style:{backgroundColor:"note"===Z.theme.name?"#fffaf1":"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.5)":"dark"===Z.theme.name?"rgba(255,255,255,0.05)":"minimalist"===Z.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:"note"===Z.theme.name?"#e6cda4":Z.border,borderWidth:"1px",borderStyle:"solid",color:Z.textPrimary,boxShadow:"none",outline:"none"}})]})]})}),t.jsx("div",{className:"mt-6",children:(1===ie&&Qe||2===ie&&rt)&&t.jsx(M,{feedback:1===ie?Qe:rt,improved:1===ie?et:st})}),t.jsx(c,{variant:"outline",size:"sm",onClick:()=>V("/ielts/writing"),className:"fixed bottom-6 left-6 z-50 rounded-xl",style:{backgroundColor:"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.9)":"dark"===Z.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===Z.theme.name?"#ffffff":Z.theme.colors.cardBackground,borderColor:Z.border,color:Z.textPrimary},children:"Exit"}),t.jsxs("div",{className:"fixed bottom-6 right-3 sm:bottom-6 sm:right-6 z-50",children:[Pe&&t.jsxs(x,{className:"backdrop-blur-md rounded-3xl w-[260px] h-[360px] sm:w-96 sm:h-[500px] shadow-2xl flex flex-col transform-gpu origin-bottom-right transition-all duration-260 ease-in-out "+(Ie?"opacity-100 scale-100 translate-y-0":"opacity-0 scale-75 translate-y-8"),style:{backgroundColor:"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.95)":"dark"===Z.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===Z.theme.name?"#ffffff":Z.theme.colors.cardBackground,borderColor:Z.border,backdropFilter:"glassmorphism"===Z.theme.name?"blur(12px)":"dark"===Z.theme.name?"blur(8px)":"none",...Z.cardStyle},children:[t.jsx(I,{className:"pb-1 sm:pb-2 rounded-t-3xl relative",children:t.jsx("div",{className:"absolute top-1.5 right-1.5 sm:top-2 sm:right-2",children:t.jsx(c,{variant:"ghost",size:"icon",onClick:()=>{Ee(!1),setTimeout(()=>Te(!1),260)},className:"h-7 w-7 sm:h-8 sm:w-8 p-0",style:{color:Z.textPrimary},children:"âœ•"})})}),t.jsxs(u,{className:"flex-1 flex flex-col px-2.5 py-2 sm:p-4 overflow-hidden",children:[t.jsx(B,{className:"flex-1 min-h-0",children:t.jsx(z,{className:"flex-1 min-h-0",children:0!==Wt().length||Ne?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"rounded-lg p-3 mb-4",style:{backgroundColor:"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.1)":"dark"===Z.theme.name?"rgba(255,255,255,0.05)":"minimalist"===Z.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:Z.border,borderWidth:"1px",borderStyle:"solid"},children:t.jsx("div",{className:"text-[10px] sm:text-sm whitespace-pre-wrap",style:{color:Z.textSecondary},children:(null==Lt?void 0:Lt.title)||(1===ie?"Letter Writing":"Essay Writing")})}),Wt().map(e=>t.jsxs(F,{from:"user"===e.type?"user":"assistant",children:["bot"===e.type&&t.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"52px",height:"52px",flexShrink:0},children:t.jsx("img",{src:"/1000031289.png",alt:"Catie",style:{width:"100%",height:"100%",objectFit:"cover"}})}),t.jsx($,{children:t.jsx("div",{className:"px-3 py-2 rounded-xl text-sm",style:{backgroundColor:"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.1)":"dark"===Z.theme.name?"rgba(255,255,255,0.05)":"minimalist"===Z.theme.name?"#f9fafb":"rgba(255,255,255,0.5)",borderColor:Z.border,borderWidth:"1px",borderStyle:"solid",color:Z.textPrimary},children:t.jsx(q,{dangerouslySetInnerHTML:{__html:e.content.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/^â€¢ (.*)$/gm,"<li>$1</li>").replace(/(<li>.*<\/li>)/s,"<ul>$1</ul>").replace(/\n/g,"<br>")}})})}),"user"===e.type&&(null==Q?void 0:Q.avatar_url)&&t.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"52px",height:"52px",flexShrink:0},children:t.jsx("img",{src:Q.avatar_url,alt:"Your avatar",style:{width:"100%",height:"100%",objectFit:"cover"}})})]},e.id)),Ne&&t.jsxs(F,{from:"assistant",children:[t.jsx($,{children:t.jsx("div",{className:"px-3 py-2 rounded-xl text-sm",style:{backgroundColor:"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.1)":"dark"===Z.theme.name?"rgba(255,255,255,0.05)":"minimalist"===Z.theme.name?"#f9fafb":"rgba(255,255,255,0.5)",borderColor:Z.border,borderWidth:"1px",borderStyle:"solid"},children:t.jsx(H,{text:"Thinking..."})})}),t.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"52px",height:"52px"},children:t.jsx("img",{src:"/1000031289.png",alt:"Catie",style:{width:"100%",height:"100%",objectFit:"cover"}})})]}),t.jsx("div",{ref:mt})]}):t.jsx(D,{icon:t.jsx(L,{className:"size-9 sm:size-12",style:{color:Z.textSecondary}}),title:"Start a conversation",description:"Ask for help with your IELTS writing practice"})})}),t.jsx("div",{className:"flex-shrink-0 mt-2.5 sm:mt-4",children:t.jsxs("div",{className:"flex gap-1.5 sm:gap-2",children:[t.jsx("input",{type:"text",value:je,onChange:e=>we(e.target.value),onKeyPress:e=>"Enter"===e.key&&!Ne&&je.trim()&&Bt(),placeholder:"Ask for writing help...",className:"flex-1 px-2.5 py-1.5 sm:px-3 sm:py-2 rounded-lg text-[10px] sm:text-sm focus:outline-none focus:ring-0 resize-none",style:{backgroundColor:"glassmorphism"===Z.theme.name?"rgba(255,255,255,0.1)":"dark"===Z.theme.name?"rgba(255,255,255,0.05)":"minimalist"===Z.theme.name?"#ffffff":Z.theme.colors.cardBackground,borderColor:Z.border,borderWidth:"1px",borderStyle:"solid",color:Z.textPrimary},disabled:Ne}),t.jsx("style",{dangerouslySetInnerHTML:{__html:`\n                      input[placeholder="Ask for writing help..."]::placeholder {\n                        color: ${Z.textSecondary};\n                      }\n                    `}}),t.jsx(c,{onClick:()=>Bt(),disabled:Ne||!je.trim(),variant:"ghost",size:"icon",className:"h-7 w-7 sm:h-8 sm:w-8 p-0",style:{color:Z.textPrimary},children:Ne?t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2",style:{borderColor:Z.textPrimary}}):t.jsx(E,{className:"w-4 h-4"})})]})})]})]}),!Pe&&t.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"64px",height:"64px",cursor:"pointer",boxShadow:"0 8px 20px rgba(0,0,0,0.18)",transition:"transform 0.22s ease-out, box-shadow 0.22s ease-out"},onClick:()=>{Te(!0),requestAnimationFrame(()=>Ee(!0))},onMouseEnter:e=>{const t=e.currentTarget;t.style.transform="scale(1.06) translateY(-2px)",t.style.boxShadow="0 14px 30px rgba(0,0,0,0.24)"},onMouseLeave:e=>{const t=e.currentTarget;t.style.transform="scale(1.0) translateY(0px)",t.style.boxShadow="0 10px 25px rgba(0,0,0,0.15)"},children:t.jsx("img",{src:"/1000031289.png",alt:"Catie",style:{width:"100%",height:"100%",objectFit:"cover"}})})]}),Se&&t.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 flex items-center justify-center",children:t.jsx("div",{className:"bg-card p-8 rounded-3xl shadow-xl border border-border",children:t.jsx(m,{message:"Analyzing your writing with AI examiner...",subMessage:"Please wait while we evaluate your IELTS writing",size:200})})})]})})})}),Je&&t.jsx("style",{children:'\n          /* Prominent underline for spell check errors */\n          textarea[spellcheck="true"]::spelling-error {\n            text-decoration: wavy underline rgba(239, 68, 68, 0.8) 2px !important;\n            text-decoration-skip-ink: none !important;\n          }\n\n          textarea[spellcheck="true"]:focus::spelling-error {\n            text-decoration: wavy underline rgba(239, 68, 68, 0.9) 2px !important;\n          }\n        '})]}):t.jsx(d,{title:"IELTS Writing Test",showBackButton:!0,children:t.jsx("div",{className:"flex items-center justify-center min-h-96",children:t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-lg text-foreground mb-4",children:"Task data not available"}),t.jsx(c,{onClick:()=>V("/ielts-portal"),variant:"outline",children:"Back to Portal"})]})})});var Ft};export{U as default};
