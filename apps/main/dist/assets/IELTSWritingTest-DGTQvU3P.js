import{a1 as e,j as t,G as r,u as a,h as s,ae as n,a8 as l,r as i,bt as o,aa as d,bu as m,B as c,ad as h,a as u,C as x,W as p,T as b,aJ as g,bv as f,bw as v,bx as y,S as k,p as j,q as w,s as N,t as C,bq as S,R as _,av as P,by as T,U as I,b as E,a0 as W}from"./index-DYtCQA4x.js";import{s as A}from"./supabase-DWL4C3fA.js";import{F as B}from"./languages-CfEi4KMq.js";import{C as z,a as D,b as L,O as F,M as q,c as $,R as H,S as M}from"./shimmering-text-CmB9G1kd.js";const U=({feedback:r,improved:a})=>{const s=e();return r?t.jsxs("div",{className:"mt-4 space-y-4",children:[t.jsxs("div",{className:"p-4 rounded-lg border",style:{backgroundColor:"dark"===s.theme.name?"rgba(255,255,255,0.05)":"minimalist"===s.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:s.border},children:[t.jsx("h4",{className:"font-semibold mb-2",style:{color:s.textPrimary},children:"Grammar Feedback:"}),t.jsx("div",{className:"text-sm whitespace-pre-wrap",style:{color:s.textPrimary},children:r})]}),a&&t.jsxs("div",{className:"p-4 rounded-lg border",style:{backgroundColor:"dark"===s.theme.name?"rgba(255,255,255,0.05)":"minimalist"===s.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:s.border},children:[t.jsx("h4",{className:"font-semibold mb-2",style:{color:s.textPrimary},children:"Improved Version:"}),t.jsx("div",{className:"text-sm whitespace-pre-wrap",style:{color:s.textPrimary},children:a})]})]}):null},Y=()=>{var Y,R,G,O,V;const{testId:X}=r(),J=a(),{toast:K}=s(),{user:Q,profile:Z}=n(),ee=e();l();const[te,re]=i.useState(null),[ae,se]=i.useState(null),[ne,le]=i.useState(null),[ie,oe]=i.useState(1),[de,me]=i.useState(""),[ce,he]=i.useState(""),[ue,xe]=i.useState([]),[pe,be]=i.useState(!1),[ge,fe]=i.useState(!1),[ve,ye]=i.useState([{id:"1",type:"bot",content:"Hi! I'm Catie, your IELTS Writing tutor ðŸ“ I can see your Task 1 instructions above. Ask me anything specific about this task - like how to structure your response, what key features to highlight, or how to get started!",timestamp:new Date}]),[ke,je]=i.useState([{id:"1",type:"bot",content:"Hi! I'm Catie, your IELTS Writing tutor ðŸ“ I can see your Task 2 essay topic above. Ask me about structuring your argument, developing your ideas for this specific topic, or how to present your opinion effectively!",timestamp:new Date}]),[we,Ne]=i.useState(""),[Ce,Se]=i.useState(!1),[_e,Pe]=i.useState(!1);i.useState(!1),i.useState(!1);const[Te,Ie]=i.useState(!1),[Ee,We]=i.useState(!1),[Ae,Be]=i.useState(1),[ze,De]=i.useState("center"),[Le,Fe]=i.useState("en"),[qe,$e]=i.useState("deepseek-v3.2"),[He]=o(),Me=He.get("training"),[Ue,Ye]=i.useState([]),[Re,Ge]=i.useState(0),[Oe,Ve]=i.useState(!1),[Xe,Je]=i.useState(0),[Ke,Qe]=i.useState(!1);i.useState(!1);const[Ze,et]=i.useState(null),[tt,rt]=i.useState(null),[at,st]=i.useState(null),[nt,lt]=i.useState(null),[it,ot]=i.useState(!1),[dt,mt]=i.useState(!1),ct=i.useRef(null),[ht,ut]=i.useState(""),[xt,pt]=i.useState(""),[bt,gt]=i.useState(!1),[ft,vt]=i.useState(""),[yt,kt]=i.useState(""),[jt,wt]=i.useState(!1);i.useEffect(()=>{if(!X)return;const e=`ielts-writing-draft-${X}-task1`,t=`ielts-writing-draft-${X}-task2`,r=localStorage.getItem(e),a=localStorage.getItem(t);r&&!de&&me(r),a&&!ce&&he(a)},[X]),i.useEffect(()=>{X&&localStorage.setItem(`ielts-writing-draft-${X}-task1`,de)},[de,X]),i.useEffect(()=>{X&&localStorage.setItem(`ielts-writing-draft-${X}-task2`,ce)},[ce,X]),i.useEffect(()=>{let e;return Oe&&Re>0&&(e=setInterval(()=>{Ge(e=>e<=1?(Ve(!1),0):e-1),Je(e=>e+1e3)},1e3)),()=>{e&&clearInterval(e)}},[Oe,Re]),i.useEffect(()=>{if(Me&&ue.length>0){const e=ue.filter(e=>e.test_subtype===Me||!e.test_subtype&&"Academic"===Me);Ye(e)}else Ye(ue)},[Me,ue]),i.useEffect(()=>{X?Nt():Ct()},[X]);const Nt=async()=>{fe(!0);try{if(!X)throw new Error("Test ID is required");const[e,t]=await Promise.all([A.from("tests").select("id, test_name, test_type, module, skill_category, test_subtype").eq("id",X).maybeSingle(),A.from("questions").select("id, test_id, part_number, question_text, passage_text, image_url, explanation, transcription").eq("test_id",X).in("part_number",[1,2]).order("part_number")]);if(e.error)throw e.error;if(t.error)throw t.error;const r=e.data;if(!r)throw new Error("Test not found");re(r);const a=t.data||[],s=a.find(e=>1===e.part_number),n=a.find(e=>2===e.part_number);if(null==s?void 0:s.image_url){(new Image).src=s.image_url}const l=s?{id:s.id,title:s.question_text||"Task 1 - Data Description",instructions:s.passage_text||"",imageUrl:s.image_url||"",imageContext:s.explanation||"",modelAnswer:s.transcription||""}:{id:"default-task1",title:"Task 1 - Data Description",instructions:"Task 1 question not found. Please contact support.",imageUrl:"",imageContext:"",modelAnswer:""},i=n?{id:n.id,title:n.question_text||"Task 2 - Essay Writing",instructions:n.passage_text||"",modelAnswer:n.transcription||""}:{id:"default-task2",title:"Task 2 - Essay Writing",instructions:"Task 2 question not found. Please contact support.",modelAnswer:""};se(l),le(i)}catch(e){const t=(null==e?void 0:e.message)||"Failed to load test data. Please try again.";K({title:"Error",description:t,variant:"destructive"}),re(null),se(null),le(null)}finally{fe(!1)}},Ct=async()=>{be(!0);try{const{data:e,error:t}=await A.from("tests").select("id, test_name, test_type, module, skill_category, test_subtype, created_at").eq("test_type","IELTS").or("module.ilike.Writing,skill_category.ilike.Writing,test_name.ilike.%Writing%").order("created_at",{ascending:!1}).limit(50);if(t)throw t;const r=(e||[]).filter(e=>e&&e.id&&(e.test_name||e.module||e.skill_category));xe(r)}catch(e){K({title:"Error",description:"Failed to load available writing tests. Please try again.",variant:"destructive"}),xe([])}finally{be(!1)}},St=()=>1===ie?ae:ne,_t=()=>1===ie?de:ce,Pt=e=>{1===ie?me(e):he(e)},Tt=e=>e.trim().split(/\s+/).filter(e=>e.length>0).length,It=()=>Tt(1===ie?de:ce),Et=()=>1===ie?150:250,Wt=()=>_e||(it||!de.trim())&&(dt||!ce.trim())||!it&&de.trim()&&Tt(de)<150||!dt&&ce.trim()&&Tt(ce)<250||!it&&!de.trim()||!dt&&!ce.trim(),At=()=>1===ie?ve:ke,Bt=e=>{1===ie?ye(e):je(e)},zt=async e=>{var t;const r=we.trim();if(!r||Ce)return;const a={id:Date.now().toString(),type:"user",content:r,timestamp:new Date};Bt(e=>[...e,a]),Ne(""),Se(!0);try{const e=St();if(!e)throw new Error("No task data available");const t=_t(),{data:a,error:s}=await A.functions.invoke("openai-chat",{body:{message:r,context:"catbot",imageContext:e.imageContext,taskType:1===ie?"Task 1 - Data Description (charts, graphs, tables, diagrams)":"Task 2 - Essay Writing (arguments, opinions, examples)",taskInstructions:e.instructions,studentWriting:t,skipCache:!0}});if(s)throw s;const n={id:(Date.now()+1).toString(),type:"bot",content:a.response,timestamp:new Date};Bt(e=>[...e,n])}catch(s){let e="Connection Issue",r="Failed to get response from Catie. Please try again.";(null==(t=null==s?void 0:s.message)?void 0:t.includes("service temporarily unavailable"))||503===(null==s?void 0:s.statusCode)?(e="Service Update",r="Catie is being updated! Please try again in a moment."):429===(null==s?void 0:s.statusCode)&&(e="High Traffic",r="Lots of students are getting help! Please wait a moment and try again."),K({title:e,description:r,variant:"destructive"})}finally{Se(!1)}},Dt=e=>{oe(e)};i.useEffect(()=>{var e;null==(e=ct.current)||e.scrollIntoView({behavior:"smooth"})},[ve,ke,Ce,ie]);const Lt=async()=>{var e,t,r,a,s,n,l,i,o,d,m,c,h,u,x,p,b,g,f,v,y,k,j,w,N,C,S,_,P,T,I,E,W,B;const z=!it&&de.trim(),D=!dt&&ce.trim();if(!z&&!D)return void K({title:"Please complete at least one task",description:"You need to complete at least Task 1 or Task 2 to submit (or skip one)",variant:"destructive"});const L=Tt(de),F=Tt(ce);if(!it){if(!de.trim())return void K({title:"Task 1 is required",description:"Please complete Task 1 or skip it before submitting.",variant:"destructive"});if(L<150)return void K({title:"Task 1 word count too low",description:`Task 1 requires a minimum of 150 words. You currently have ${L} words.`,variant:"destructive"})}if(!dt){if(!ce.trim())return void K({title:"Task 2 is required",description:"Please complete Task 2 or skip it before submitting.",variant:"destructive"});if(F<250)return void K({title:"Task 2 word count too low",description:`Task 2 requires a minimum of 250 words. You currently have ${F} words.`,variant:"destructive"})}Pe(!0);try{const[z]=await Promise.all([A.functions.invoke("ielts-writing-examiner",{body:{task1Answer:!it&&de.trim()?de.trim():null,task2Answer:!dt&&ce.trim()?ce.trim():null,task1Data:!it&&de.trim()?ae:null,task2Data:!dt&&ce.trim()?ne:null,targetLanguage:"en"!==Le?Le:void 0,model:qe}})]);if(z.error)throw z.error;const{structured:D,feedback:L,task1WordCount:F,task2WordCount:q}=z.data,$=!it&&de.trim()?F||Tt(de):0,H=!dt&&ce.trim()?q||Tt(ce):0,{data:M,error:U}=await A.from("test_results").insert({user_id:null==Q?void 0:Q.id,test_type:"writing",score_percentage:Math.round(10*((null==(e=null==D?void 0:D.overall)?void 0:e.band)??(((null==(t=null==D?void 0:D.task1)?void 0:t.overall_band)??7)+2*((null==(r=null==D?void 0:D.task2)?void 0:r.overall_band)??7))/3)),time_taken:Math.floor(Xe/1e3),completed_at:(new Date).toISOString(),test_data:{task1Data:ae?{id:ae.id,title:ae.title,instructions:ae.instructions,imageUrl:ae.imageUrl,imageContext:ae.imageContext,modelAnswer:ae.modelAnswer}:null,task2Data:ne?{id:ne.id,title:ne.title,instructions:ne.instructions,modelAnswer:ne.modelAnswer}:null,task1Answer:!it&&de.trim()?de.trim():null,task2Answer:!dt&&ce.trim()?ce.trim():null,overall_band:(null==(a=null==D?void 0:D.overall)?void 0:a.band)||7}}).select().single();if(U)throw U;if(!it&&de.trim()){const{error:e}=await A.from("writing_test_results").insert({user_id:null==Q?void 0:Q.id,test_result_id:M.id,task_number:1,prompt_text:(null==ae?void 0:ae.instructions)||(null==ae?void 0:ae.title)||"",user_response:de,word_count:$,band_scores:{task_achievement:(null==(l=null==(n=null==(s=null==D?void 0:D.task1)?void 0:s.criteria)?void 0:n.task_achievement)?void 0:l.band)??null,coherence_and_cohesion:(null==(d=null==(o=null==(i=null==D?void 0:D.task1)?void 0:i.criteria)?void 0:o.coherence_and_cohesion)?void 0:d.band)??null,lexical_resource:(null==(h=null==(c=null==(m=null==D?void 0:D.task1)?void 0:m.criteria)?void 0:c.lexical_resource)?void 0:h.band)??null,grammatical_range_and_accuracy:(null==(p=null==(x=null==(u=null==D?void 0:D.task1)?void 0:u.criteria)?void 0:x.grammatical_range_and_accuracy)?void 0:p.band)??null},detailed_feedback:(null==(b=null==D?void 0:D.task1)?void 0:b.feedback_markdown)||"",improvement_suggestions:(null==(f=null==(g=null==D?void 0:D.task1)?void 0:g.feedback)?void 0:f.improvements)||[]});if(e)throw e}if(!dt&&ce.trim()){const{error:e}=await A.from("writing_test_results").insert({user_id:null==Q?void 0:Q.id,test_result_id:M.id,task_number:2,prompt_text:(null==ne?void 0:ne.instructions)||(null==ne?void 0:ne.title)||"",user_response:ce,word_count:H,band_scores:{task_response:(null==(k=null==(y=null==(v=null==D?void 0:D.task2)?void 0:v.criteria)?void 0:y.task_response)?void 0:k.band)??null,coherence_and_cohesion:(null==(N=null==(w=null==(j=null==D?void 0:D.task2)?void 0:j.criteria)?void 0:w.coherence_and_cohesion)?void 0:N.band)??null,lexical_resource:(null==(_=null==(S=null==(C=null==D?void 0:D.task2)?void 0:C.criteria)?void 0:S.lexical_resource)?void 0:_.band)??null,grammatical_range_and_accuracy:(null==(I=null==(T=null==(P=null==D?void 0:D.task2)?void 0:P.criteria)?void 0:T.grammatical_range_and_accuracy)?void 0:I.band)??null},detailed_feedback:(null==(E=null==D?void 0:D.task2)?void 0:E.feedback_markdown)||"",improvement_suggestions:(null==(B=null==(W=null==D?void 0:D.task2)?void 0:W.feedback)?void 0:B.improvements)||[]});if(e)throw e}J("/ielts-writing-results-pro",{state:{testName:null==te?void 0:te.test_name,testId:X,submissionId:M.id,task1Answer:!it&&de.trim()?de.trim():null,task2Answer:!dt&&ce.trim()?ce.trim():null,task1Skipped:it,task2Skipped:dt,feedback:L,structured:D,task1Data:ae,task2Data:ne,task1WordCount:$,task2WordCount:H}})}catch(q){K({title:"Error",description:(null==q?void 0:q.message)||"Failed to submit test for evaluation",variant:"destructive"})}finally{Pe(!1)}};if(i.useEffect(()=>{Oe||(Ge(3600),Ve(!0))},[Oe]),!X){if(pe)return t.jsx(d,{title:"Writing Tests",children:t.jsx("div",{className:"flex items-center justify-center min-h-96",children:t.jsx("div",{className:"text-center",children:t.jsx(m,{message:"Loading available writing tests...",subMessage:"Please wait",size:150})})})});if(Ue.length>0||ue.length>0){const e=Ue.length>0?Ue:ue;return t.jsxs("div",{className:"min-h-screen relative",children:[t.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"note"===ee.theme.name||"minimalist"===ee.theme.name||"dark"===ee.theme.name?"none":"url('/1000031207.png')",backgroundColor:ee.backgroundImageColor}}),t.jsx("div",{className:"relative z-10",children:t.jsx(d,{title:"Available Writing Tests",transparentBackground:!0,children:t.jsx("div",{className:"min-h-screen py-12",children:t.jsx("div",{className:"container mx-auto px-4",children:t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsxs("div",{className:"mb-8",children:[t.jsx(c,{variant:"outline",onClick:()=>J("/ielts-portal"),className:"mb-4 transition-all duration-200 hover:shadow-md",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.5)":"dark"===ee.theme.name?"rgba(255,255,255,0.1)":ee.cardBackground,color:ee.textPrimary,borderColor:ee.border},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=ee.hoverBg,e.currentTarget.style.color=ee.buttonPrimary,e.currentTarget.style.borderColor=ee.buttonPrimary},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===ee.theme.name?"rgba(255,255,255,0.5)":"dark"===ee.theme.name?"rgba(255,255,255,0.1)":ee.cardBackground,e.currentTarget.style.color=ee.textPrimary,e.currentTarget.style.borderColor=ee.border},children:"â† Back to IELTS Portal"}),t.jsxs("h1",{className:"text-4xl font-bold mb-2 text-center",style:{color:ee.textPrimary},children:["IELTS ",Me||"Writing"," Tests"]})]}),t.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:e.map(e=>e&&e.id?t.jsx(h,{className:"cursor-pointer h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg bg-white/80 flex items-center justify-center",onClick:()=>J(`/ielts-writing-test/${e.id}`),children:t.jsx(u,{className:"p-3 md:p-4 text-center flex items-center justify-center h-full",children:t.jsx("h3",{className:"font-semibold text-sm",children:e.test_name||"Untitled Test"})})},e.id):null)})]})})})})})]})}return t.jsx(d,{title:"Writing Tests",children:t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background to-primary/5 py-12",children:t.jsxs("div",{className:"container mx-auto px-4 text-center",children:[t.jsx("h1",{className:"text-4xl font-bold text-foreground mb-4",children:"IELTS Writing Tests"}),t.jsx("p",{className:"text-lg text-muted-foreground mb-8",children:"No writing tests available yet"}),t.jsx(c,{onClick:()=>J("/ielts-portal"),variant:"outline",children:"Back to Portal"})]})})})}if(ge)return t.jsx(d,{title:"IELTS Writing Test",showBackButton:!0,children:t.jsx("div",{className:"flex items-center justify-center min-h-96",children:t.jsx("div",{className:"text-center",children:t.jsx(m,{message:"Loading IELTS Writing test...",subMessage:"Please wait while we fetch your test",size:150})})})});if(X&&(!te||!ae||!ne))return t.jsx(d,{title:"IELTS Writing Test",showBackButton:!0,children:t.jsx("div",{className:"flex items-center justify-center min-h-96",children:t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-lg text-foreground mb-4",children:"Unable to load test"}),t.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:te?ae&&ne?"Unknown error":"Test data is incomplete":"Test not found"}),t.jsx(c,{onClick:()=>J("/ielts-portal"),variant:"outline",children:"Back to Portal"})]})})});const Ft=St();return Ft?t.jsxs("div",{className:"min-h-screen relative",style:{backgroundColor:"dark"===ee.theme.name?ee.theme.colors.background:"transparent"},children:[t.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"note"===ee.theme.name||"minimalist"===ee.theme.name||"dark"===ee.theme.name?"none":"url('/1000031207.png')",backgroundColor:ee.backgroundImageColor}}),t.jsx("div",{className:"relative z-10 flex flex-col pb-24 sm:pb-6",style:{backgroundColor:"dark"===ee.theme.name?ee.theme.colors.background:"transparent",minHeight:"calc(100vh - 80px)"},children:t.jsx(d,{title:"IELTS Writing Test",showBackButton:!0,transparentBackground:!0,children:t.jsx("div",{className:"flex-1 flex justify-center py-6 sm:py-6 pb-4",children:t.jsxs("div",{className:"w-full max-w-6xl mx-auto space-y-4 px-4 sm:px-6 flex flex-col",children:[t.jsx(x,{className:"rounded-3xl mb-4 max-w-fit mx-auto px-4",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.9)":"dark"===ee.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===ee.theme.name?"#ffffff":ee.theme.colors.cardBackground,borderColor:ee.border,backdropFilter:"glassmorphism"===ee.theme.name?"blur(12px)":"dark"===ee.theme.name?"blur(8px)":"none",boxShadow:"dark"===ee.theme.name?"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)":"note"===ee.theme.name?null==(Y=ee.theme.styles.cardStyle)?void 0:Y.boxShadow:"0 8px 32px rgba(15, 23, 42, 0.16), 0 0 0 1px rgba(148, 163, 253, 0.06)",...ee.cardStyle},children:t.jsx(u,{className:"p-2 sm:p-3",children:t.jsxs("div",{className:"flex items-center justify-center gap-2 sm:gap-3 flex-wrap",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(p,{className:"w-3.5 h-3.5",style:{color:ee.textPrimary}}),t.jsx("span",{className:"text-sm font-medium tabular-nums",style:{color:ee.textPrimary},children:(qt=Re,`${Math.floor(qt/60)}:${(qt%60).toString().padStart(2,"0")}`)})]}),t.jsx(c,{size:"sm",onClick:()=>Dt(1),className:"h-9 sm:h-8 px-4 sm:px-3 text-sm sm:text-sm font-medium min-w-[70px]",style:{backgroundColor:1===ie?ee.buttonPrimary:"transparent",color:1===ie?"#ffffff":ee.textPrimary,border:"none"},children:"Task 1"}),t.jsx(c,{size:"sm",onClick:()=>Dt(2),className:"h-9 sm:h-8 px-4 sm:px-3 text-sm sm:text-sm font-medium min-w-[70px]",style:{backgroundColor:2===ie?ee.buttonPrimary:"transparent",color:2===ie?"#ffffff":ee.textPrimary,border:"none"},children:"Task 2"})]})})}),1===ie?(null==Ft?void 0:Ft.imageUrl)?t.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 flex-1",style:{minHeight:"400px"},children:[t.jsx("div",{className:"flex-1 lg:flex-[0_0_50%] min-h-0",children:t.jsx(x,{className:"rounded-3xl h-full",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.9)":"dark"===ee.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===ee.theme.name?"#ffffff":ee.theme.colors.cardBackground,borderColor:ee.border,backdropFilter:"glassmorphism"===ee.theme.name?"blur(12px)":"dark"===ee.theme.name?"blur(8px)":"none",boxShadow:"dark"===ee.theme.name?"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)":"note"===ee.theme.name?null==(R=ee.theme.styles.cardStyle)?void 0:R.boxShadow:"0 8px 32px rgba(15, 23, 42, 0.16), 0 0 0 1px rgba(148, 163, 253, 0.06)",...ee.cardStyle,display:"flex",flexDirection:"column"},children:t.jsxs(u,{className:"p-4 flex-1 flex flex-col",style:{minHeight:0},children:[t.jsx("div",{className:"mb-4",children:(null==Ft?void 0:Ft.instructions)&&t.jsx("div",{children:t.jsx("div",{className:"whitespace-pre-wrap leading-relaxed p-3 rounded-lg text-sm sm:text-base",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.1)":"dark"===ee.theme.name?"rgba(255,255,255,0.05)":"minimalist"===ee.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:ee.border,borderWidth:"1px",borderStyle:"solid",color:ee.textPrimary},children:Ft.instructions})})}),t.jsx("div",{className:"flex-1 overflow-hidden",children:t.jsx("img",{src:Ft.imageUrl,alt:"Task 1 visual data",className:"w-full h-full object-contain cursor-pointer",loading:"eager",decoding:"async",onClick:e=>{const t=e.currentTarget.getBoundingClientRect(),r=(e.clientX-t.left)/t.width*100,a=(e.clientY-t.top)/t.height*100;De(`${r}% ${a}%`),Be(1===Ae?1.5:1)},style:{transform:`scale(${Ae})`,transformOrigin:ze,transition:"transform 0.2s ease-out"}})})]})})}),t.jsx("div",{className:"flex-1 lg:flex-[0_0_50%] min-h-0",children:t.jsx(x,{className:"rounded-3xl h-full",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.9)":"dark"===ee.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===ee.theme.name?"#ffffff":ee.theme.colors.cardBackground,borderColor:ee.border,backdropFilter:"glassmorphism"===ee.theme.name?"blur(12px)":"dark"===ee.theme.name?"blur(8px)":"none",boxShadow:"dark"===ee.theme.name?"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)":"note"===ee.theme.name?null==(G=ee.theme.styles.cardStyle)?void 0:G.boxShadow:"0 8px 32px rgba(15, 23, 42, 0.16), 0 0 0 1px rgba(148, 163, 253, 0.06)",...ee.cardStyle,display:"flex",flexDirection:"column"},children:t.jsxs(u,{className:"flex-1 p-4 flex flex-col",style:{minHeight:0},children:[t.jsx("div",{className:"flex-1 flex flex-col",style:{minHeight:0},children:t.jsx(b,{value:_t(),onChange:e=>Pt(e.target.value),className:"flex-1 min-h-[300px] w-full text-base leading-relaxed resize-none rounded-2xl focus:outline-none focus:ring-0",placeholder:it?"Task 1 is skipped":"General"===(null==te?void 0:te.test_subtype)||"General"===Me?"Write your letter here...":"Write your Task 1 response here...",spellCheck:Ke,disabled:it,style:{backgroundColor:it?"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.05)":"dark"===ee.theme.name?"rgba(255,255,255,0.02)":"minimalist"===ee.theme.name?"#f3f4f6":"rgba(255,255,255,0.3)":"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.1)":"dark"===ee.theme.name?"rgba(255,255,255,0.05)":"minimalist"===ee.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:ee.border,color:it?ee.textSecondary:ee.textPrimary,outline:"none",boxShadow:"none",cursor:it?"not-allowed":"text",opacity:it?.6:1}})}),t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mt-4 pt-3 border-t flex-shrink-0",style:{borderColor:ee.border},children:[t.jsxs("div",{className:"text-sm font-medium",style:{color:ee.textSecondary},children:[t.jsx("span",{className:It()<Et()?"text-red-500":"text-green-600",children:It()})," / ",Et()]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(c,{size:"sm",variant:"ghost",onClick:()=>{ot(!it),it||Dt(2)},className:"h-8 px-3 text-sm font-medium hover:bg-transparent",style:{backgroundColor:it?ee.buttonPrimary:"transparent",color:it?"#ffffff":ee.textPrimary,border:"none",boxShadow:"none"},children:it?"Unskip":"Skip"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-medium",style:{color:ee.textPrimary},children:"Spell"}),t.jsx(g,{children:t.jsxs(f,{children:[t.jsx(v,{asChild:!0,children:t.jsx("div",{onClick:()=>Qe(!Ke),className:"relative inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none",style:{backgroundColor:Ke?ee.buttonPrimary:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.2)":"dark"===ee.theme.name?"rgba(255,255,255,0.1)":"minimalist"===ee.theme.name?"#e5e7eb":ee.border},"data-state":Ke?"checked":"unchecked",children:t.jsx("div",{className:"pointer-events-none flex h-5 w-5 rounded-full shadow-lg ring-0 transition-transform",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.95)":"dark"===ee.theme.name?"rgba(255,255,255,0.9)":"minimalist"===ee.theme.name?"#ffffff":ee.theme.colors.cardBackground,transform:Ke?"translateX(20px)":"translateX(0px)"}})})}),t.jsx(y,{children:t.jsx("p",{children:Ke?"Hide spell check":"Show spell check"})})]})})]}),t.jsxs(k,{value:Le,onValueChange:Fe,children:[t.jsx(j,{className:"w-[90px] h-8 text-sm border-0 bg-transparent shadow-none p-0 focus:ring-0",style:{color:ee.textPrimary,"--tw-ring-color":ee.buttonPrimary},children:t.jsx(w,{placeholder:"Language"})}),t.jsx(N,{children:B.map(e=>t.jsx(C,{value:e.value,children:e.label},e.value))})]})]})]})]})})})]}):t.jsx(x,{className:"rounded-3xl max-w-3xl w-full mx-auto",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.9)":"dark"===ee.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===ee.theme.name?"#ffffff":ee.theme.colors.cardBackground,borderColor:ee.border,backdropFilter:"glassmorphism"===ee.theme.name?"blur(12px)":"dark"===ee.theme.name?"blur(8px)":"none",boxShadow:"dark"===ee.theme.name?"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)":"note"===ee.theme.name?null==(O=ee.theme.styles.cardStyle)?void 0:O.boxShadow:"0 8px 32px rgba(15, 23, 42, 0.16), 0 0 0 1px rgba(148, 163, 253, 0.06)",...ee.cardStyle,minHeight:("dark"===ee.theme.name?500:"minimalist"===ee.theme.name?550:"note"===ee.theme.name?580:600)+"px"},children:t.jsxs(u,{className:"p-4 flex flex-col flex-1",children:[(null==Ft?void 0:Ft.instructions)&&t.jsx("div",{className:"mb-4",children:t.jsx("div",{className:"whitespace-pre-wrap leading-relaxed p-3 rounded-lg text-sm",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.1)":"dark"===ee.theme.name?"rgba(255,255,255,0.05)":"minimalist"===ee.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:ee.border,borderWidth:"1px",borderStyle:"solid",color:ee.textPrimary},children:Ft.instructions})}),t.jsx(b,{value:_t(),onChange:e=>Pt(e.target.value),placeholder:it?"Task 1 is skipped":"General"===(null==te?void 0:te.test_subtype)||"General"===Me?"Write your letter here...":"Write your Task 1 response here...",className:"flex-1 min-h-[500px] text-base leading-relaxed resize-none rounded-2xl focus:outline-none focus:ring-0",spellCheck:Ke,disabled:it,style:{backgroundColor:it?"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.05)":"dark"===ee.theme.name?"rgba(255,255,255,0.02)":"minimalist"===ee.theme.name?"#f3f4f6":"rgba(255,255,255,0.3)":"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.1)":"dark"===ee.theme.name?"rgba(255,255,255,0.05)":"minimalist"===ee.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:ee.border,color:it?ee.textSecondary:ee.textPrimary,outline:"none",boxShadow:"none",cursor:it?"not-allowed":"text",opacity:it?.6:1,height:"100%"}}),t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mt-4 pt-3 border-t",style:{borderColor:ee.border},children:[t.jsxs("div",{className:"text-sm font-medium",style:{color:ee.textSecondary},children:[t.jsx("span",{className:It()<Et()?"text-red-500":"text-green-600",children:It()})," / ",Et()]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(c,{size:"sm",variant:"ghost",onClick:()=>{ot(!it),it||Dt(2)},className:"h-10 sm:h-8 px-4 sm:px-3 text-sm sm:text-sm font-medium hover:bg-transparent min-w-[70px]",style:{backgroundColor:it?ee.buttonPrimary:"transparent",color:it?"#ffffff":ee.textPrimary,border:"none",boxShadow:"none"},children:it?"Unskip":"Skip"}),t.jsx(g,{children:t.jsxs(f,{children:[t.jsx(v,{asChild:!0,children:t.jsx("div",{onClick:()=>Qe(!Ke),className:"relative inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none",style:{backgroundColor:Ke?ee.buttonPrimary:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.2)":"dark"===ee.theme.name?"rgba(255,255,255,0.1)":"minimalist"===ee.theme.name?"#e5e7eb":ee.border},"data-state":Ke?"checked":"unchecked",children:t.jsx("div",{className:"pointer-events-none flex h-5 w-5 rounded-full shadow-lg ring-0 transition-transform items-center justify-center",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.95)":"dark"===ee.theme.name?"rgba(255,255,255,0.9)":"minimalist"===ee.theme.name?"#ffffff":ee.theme.colors.cardBackground,transform:Ke?"translateX(20px)":"translateX(0px)"},children:Ke?t.jsx(Eye,{className:"w-3 h-3",style:{color:ee.buttonPrimary}}):t.jsx(EyeOff,{className:"w-3 h-3",style:{color:ee.textSecondary}})})})}),t.jsx(y,{children:t.jsx("p",{children:Ke?"Hide spell check":"Show spell check"})})]})}),t.jsxs(k,{value:Le,onValueChange:Fe,children:[t.jsx(j,{className:"w-[90px] h-8 text-sm border-0 bg-transparent shadow-none p-0 focus:ring-0",style:{color:ee.textPrimary,"--tw-ring-color":ee.buttonPrimary},children:t.jsx(w,{placeholder:"Language"})}),t.jsx(N,{children:B.map(e=>t.jsx(C,{value:e.value,children:e.label},e.value))})]})]})]}),t.jsx("div",{className:"flex justify-end items-center mt-4 gap-3",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(g,{children:t.jsxs(f,{children:[t.jsx(v,{asChild:!0,children:t.jsx(S,{className:"w-4 h-4",style:{color:ee.textSecondary}})}),t.jsx(y,{side:"top",className:"max-w-xs",children:t.jsx("p",{children:"You can submit with just one task completed. The other task will be marked as skipped."})})]})}),t.jsx(c,{onClick:Lt,disabled:Wt(),variant:"default",className:"min-w-[120px]",style:{backgroundColor:ee.buttonPrimary,color:"#ffffff"},children:_e?"Submitting...":"Submit Test"})]})})]})}):t.jsx(x,{className:"rounded-3xl h-full max-w-3xl w-full mx-auto",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.9)":"dark"===ee.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===ee.theme.name?"#ffffff":ee.theme.colors.cardBackground,borderColor:ee.border,backdropFilter:"glassmorphism"===ee.theme.name?"blur(12px)":"dark"===ee.theme.name?"blur(8px)":"none",boxShadow:"dark"===ee.theme.name?"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)":"note"===ee.theme.name?null==(V=ee.theme.styles.cardStyle)?void 0:V.boxShadow:"0 8px 32px rgba(15, 23, 42, 0.16), 0 0 0 1px rgba(148, 163, 253, 0.06)",...ee.cardStyle,minHeight:("dark"===ee.theme.name?500:"minimalist"===ee.theme.name?550:"note"===ee.theme.name?580:600)+"px"},children:t.jsxs(u,{className:"p-4 flex flex-col h-full",children:[(null==Ft?void 0:Ft.instructions)&&t.jsx("div",{className:"mb-4",children:t.jsx("div",{className:"whitespace-pre-wrap leading-relaxed p-3 rounded-lg text-sm",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.1)":"dark"===ee.theme.name?"rgba(255,255,255,0.05)":"minimalist"===ee.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:ee.border,borderWidth:"1px",borderStyle:"solid",color:ee.textPrimary},children:Ft.instructions})}),t.jsx(b,{value:_t(),onChange:e=>Pt(e.target.value),placeholder:dt?"Task 2 is skipped":"Write your Task 2 essay here...",className:"flex-1 min-h-[500px] text-base leading-relaxed resize-none rounded-2xl focus:outline-none focus:ring-0",spellCheck:Ke,disabled:dt,style:{backgroundColor:dt?"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.05)":"dark"===ee.theme.name?"rgba(255,255,255,0.02)":"minimalist"===ee.theme.name?"#f3f4f6":"rgba(255,255,255,0.3)":"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.1)":"dark"===ee.theme.name?"rgba(255,255,255,0.05)":"minimalist"===ee.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:ee.border,color:dt?ee.textSecondary:ee.textPrimary,outline:"none",boxShadow:"none",cursor:dt?"not-allowed":"text",opacity:dt?.6:1,height:"100%"}}),t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mt-4 pt-3 border-t",style:{borderColor:ee.border},children:[t.jsxs("div",{className:"text-sm font-medium",style:{color:ee.textSecondary},children:[t.jsx("span",{className:It()<Et()?"text-red-500":"text-green-600",children:It()})," / ",Et()]}),t.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3",children:[t.jsx(c,{size:"sm",variant:"ghost",onClick:()=>{mt(!dt)},className:"h-10 sm:h-8 px-4 sm:px-3 text-sm sm:text-sm font-medium hover:bg-transparent min-w-[70px]",style:{backgroundColor:dt?ee.buttonPrimary:"transparent",color:dt?"#ffffff":ee.textPrimary,border:"none",boxShadow:"none"},children:dt?"Unskip":"Skip"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-medium",style:{color:ee.textPrimary},children:"Spell"}),t.jsx(g,{children:t.jsxs(f,{children:[t.jsx(v,{asChild:!0,children:t.jsx("div",{onClick:()=>Qe(!Ke),className:"relative inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none",style:{backgroundColor:Ke?ee.buttonPrimary:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.2)":"dark"===ee.theme.name?"rgba(255,255,255,0.1)":"minimalist"===ee.theme.name?"#e5e7eb":ee.border},"data-state":Ke?"checked":"unchecked",children:t.jsx("div",{className:"pointer-events-none flex h-5 w-5 rounded-full shadow-lg ring-0 transition-transform",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.95)":"dark"===ee.theme.name?"rgba(255,255,255,0.9)":"minimalist"===ee.theme.name?"#ffffff":ee.theme.colors.cardBackground,transform:Ke?"translateX(20px)":"translateX(0px)"}})})}),t.jsx(y,{children:t.jsx("p",{children:Ke?"Hide spell check":"Show spell check"})})]})})]}),t.jsxs(k,{value:Le,onValueChange:Fe,children:[t.jsx(j,{className:"w-[90px] h-8 text-sm border-0 shadow-none p-0 focus:ring-0 rounded-lg "+("glassmorphism"===ee.theme.name?"bg-white/10":"dark"===ee.theme.name?"bg-white/5":"minimalist"===ee.theme.name?"bg-gray-50":"note"===ee.theme.name?"bg-amber-50":"bg-white/5"),style:{color:ee.textPrimary,"--tw-ring-color":ee.buttonPrimary,borderColor:ee.border},children:t.jsx(w,{placeholder:"Language"})}),t.jsx(N,{children:B.map(e=>t.jsx(C,{value:e.value,children:e.label},e.value))})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(g,{children:t.jsxs(f,{children:[t.jsx(v,{asChild:!0,children:t.jsx(S,{className:"w-4 h-4",style:{color:ee.textSecondary}})}),t.jsx(y,{side:"top",className:"max-w-xs",children:t.jsx("p",{children:"You can submit with just one task completed. The other task will be marked as skipped."})})]})}),t.jsx(c,{onClick:Lt,disabled:Wt(),variant:"default",className:"min-w-[120px] h-8",style:{backgroundColor:ee.buttonPrimary,color:"#ffffff"},children:_e?"Submitting...":"Submit Test"})]})]})]}),t.jsx("div",{className:"mt-3 pt-2 border-t",style:{borderColor:ee.border},children:t.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[t.jsx(_,{htmlFor:"ai-model-selector",className:"text-sm font-medium whitespace-nowrap",style:{color:ee.textPrimary},children:"AI Model:"}),t.jsxs(k,{value:qe,onValueChange:$e,children:[t.jsx(j,{id:"ai-model-selector",className:"w-[200px] h-9 text-sm border transition-colors rounded-lg",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.9)":"dark"===ee.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===ee.theme.name?"#ffffff":ee.theme.colors.cardBackground,borderColor:ee.border,color:ee.textPrimary,backdropFilter:"glassmorphism"===ee.theme.name?"blur(12px)":"none"},children:t.jsx(w,{placeholder:"Select AI Model"})}),t.jsxs(N,{children:[t.jsx(C,{value:"deepseek-v3.2",children:"DeepSeek V3.2"}),t.jsx(C,{value:"gemini-2.5-flash",children:"Gemini 2.5 Flash"})]})]})]})})]})}),t.jsx("div",{className:"mt-6 max-w-3xl mx-auto w-full","data-improve-section":!0,children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"flex items-center justify-between mb-2",children:t.jsx("span",{className:"text-sm font-semibold",style:{color:"note"===ee.theme.name?"#8b7355":ee.textSecondary},children:"Grammar Improve"})}),t.jsx(b,{value:ht,onChange:e=>ut(e.target.value),placeholder:"Paste your text here to improve...",className:"min-h-[120px] text-sm leading-relaxed resize-none rounded-xl focus-visible:ring-0 focus:ring-0 focus-visible:outline-none",style:{backgroundColor:"note"===ee.theme.name?"#fffaf1":"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.5)":"dark"===ee.theme.name?"rgba(255,255,255,0.05)":"minimalist"===ee.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:"note"===ee.theme.name?"#e6cda4":ee.border,borderWidth:"1px",borderStyle:"solid",color:ee.textPrimary,boxShadow:"none",outline:"none"}})]}),t.jsx("div",{className:"flex flex-col items-center justify-center pt-6",children:t.jsx(g,{children:t.jsxs(f,{children:[t.jsx(v,{asChild:!0,children:t.jsx("button",{onClick:async()=>{if(!ht||ht.trim().length<10)K({title:"Insufficient content",description:"Please paste at least 10 characters in the 'Before' box.",variant:"destructive"});else{gt(!0);try{const e=St();console.log("âœ¨ Requesting improvement for pasted text");const{data:t,error:r}=await A.functions.invoke("grammar-feedback",{body:{writing:ht,taskType:1===ie?"Task 1 - Data Description":"Task 2 - Essay Writing",taskNumber:ie,targetLanguage:"en"!==Le?Le:void 0,taskInstructions:(null==e?void 0:e.instructions)||"",mode:"improve"}});if(r)throw console.error("âŒ Improvement error:",r),r;if(!t)throw new Error("No response data received from improvement service");if(!t.success||!t.improved){const e=t.error||t.details||"Failed to improve writing";throw console.error("âŒ Improvement failed:",e),new Error(e)}pt(t.improved),K({title:"Improved! âœ¨",description:"Your improved text is ready in the 'After' box."})}catch(e){console.error("âŒ Improvement catch error:",e);let t="Failed to improve writing. Please try again.";(null==e?void 0:e.message)&&(t=e.message),K({title:"Error",description:t,variant:"destructive",duration:5e3})}finally{gt(!1)}}},disabled:bt||!ht.trim(),className:"px-2 py-1 transition-all hover:translate-x-0.5 disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:translate-x-0 focus:outline-none focus:ring-0",style:{backgroundColor:"transparent",color:"note"===ee.theme.name?"#8b7355":ee.textPrimary,border:"none",boxShadow:"none",outline:"none"},children:bt?t.jsx(P,{className:"w-5 h-5 animate-spin"}):t.jsx(T,{className:"w-5 h-5"})})}),t.jsx(y,{children:t.jsx("p",{children:"Improve text"})})]})})}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-semibold invisible",children:"Placeholder"}),xt.trim()&&t.jsxs("button",{onClick:async()=>{try{await navigator.clipboard.writeText(xt),K({title:"Copied",description:"Improved text copied to clipboard."})}catch(e){K({title:"Copy failed",description:"Please copy manually.",variant:"destructive"})}},className:"text-xs flex items-center gap-1 px-2 py-1 rounded-md transition-colors hover:bg-black/5",style:{color:"note"===ee.theme.name?"#8b7355":ee.textSecondary},children:[t.jsx(I,{className:"w-3 h-3"}),"Copy"]})]}),t.jsx(b,{value:xt,readOnly:!0,placeholder:"Improved text will appear here...",className:"min-h-[120px] text-sm leading-relaxed resize-none rounded-xl focus-visible:ring-0 focus:ring-0 focus-visible:outline-none",style:{backgroundColor:"note"===ee.theme.name?"#fffaf1":"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.5)":"dark"===ee.theme.name?"rgba(255,255,255,0.05)":"minimalist"===ee.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:"note"===ee.theme.name?"#e6cda4":ee.border,borderWidth:"1px",borderStyle:"solid",color:ee.textPrimary,boxShadow:"none",outline:"none"}})]})]})}),t.jsx("div",{className:"mt-4 max-w-3xl mx-auto w-full",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"flex items-center justify-between mb-2",children:t.jsx("span",{className:"text-sm font-semibold",style:{color:"note"===ee.theme.name?"#8b7355":ee.textSecondary},children:"Answer Improve"})}),t.jsx(b,{value:ft,onChange:e=>vt(e.target.value),placeholder:"Paste your answer here for full enhancement...",className:"min-h-[120px] text-sm leading-relaxed resize-none rounded-xl focus-visible:ring-0 focus:ring-0 focus-visible:outline-none",style:{backgroundColor:"note"===ee.theme.name?"#fffaf1":"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.5)":"dark"===ee.theme.name?"rgba(255,255,255,0.05)":"minimalist"===ee.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:"note"===ee.theme.name?"#e6cda4":ee.border,borderWidth:"1px",borderStyle:"solid",color:ee.textPrimary,boxShadow:"none",outline:"none"}})]}),t.jsx("div",{className:"flex flex-col items-center justify-center pt-6",children:t.jsx(g,{children:t.jsxs(f,{children:[t.jsx(v,{asChild:!0,children:t.jsx("button",{onClick:async()=>{if(!ft||ft.trim().length<10)K({title:"Insufficient content",description:"Please paste at least 10 characters in the box.",variant:"destructive"});else{wt(!0);try{const e=St();console.log("âœ¨ Requesting full answer improvement for pasted text");const{data:t,error:r}=await A.functions.invoke("grammar-feedback",{body:{writing:ft,taskType:1===ie?"Task 1 - Data Description":"Task 2 - Essay Writing",taskNumber:ie,targetLanguage:"en"!==Le?Le:void 0,taskInstructions:(null==e?void 0:e.instructions)||"",mode:"full-improve"}});if(r)throw console.error("âŒ Answer improvement error:",r),r;if(!t)throw new Error("No response data received from improvement service");if(!t.success||!t.improved){const e=t.error||t.details||"Failed to improve answer";throw console.error("âŒ Answer improvement failed:",e),new Error(e)}kt(t.improved),K({title:"Answer Enhanced! âœ¨",description:"Your improved answer is ready."})}catch(e){console.error("âŒ Answer improvement catch error:",e);let t="Failed to improve answer. Please try again.";(null==e?void 0:e.message)&&(t=e.message),K({title:"Error",description:t,variant:"destructive",duration:5e3})}finally{wt(!1)}}},disabled:jt||!ft.trim(),className:"px-2 py-1 transition-all hover:translate-x-0.5 disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:translate-x-0 focus:outline-none focus:ring-0",style:{backgroundColor:"transparent",color:"note"===ee.theme.name?"#8b7355":ee.textPrimary,border:"none",boxShadow:"none",outline:"none"},children:jt?t.jsx(P,{className:"w-5 h-5 animate-spin"}):t.jsx(T,{className:"w-5 h-5"})})}),t.jsx(y,{children:t.jsx("p",{children:"Enhance answer (vocab, grammar, structure)"})})]})})}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-semibold invisible",children:"Placeholder"}),yt.trim()&&t.jsxs("button",{onClick:async()=>{try{await navigator.clipboard.writeText(yt),K({title:"Copied",description:"Enhanced answer copied to clipboard."})}catch(e){K({title:"Copy failed",description:"Please copy manually.",variant:"destructive"})}},className:"text-xs flex items-center gap-1 px-2 py-1 rounded-md transition-colors hover:bg-black/5",style:{color:"note"===ee.theme.name?"#8b7355":ee.textSecondary},children:[t.jsx(I,{className:"w-3 h-3"}),"Copy"]})]}),t.jsx(b,{value:yt,readOnly:!0,placeholder:"Enhanced answer will appear here...",className:"min-h-[120px] text-sm leading-relaxed resize-none rounded-xl focus-visible:ring-0 focus:ring-0 focus-visible:outline-none",style:{backgroundColor:"note"===ee.theme.name?"#fffaf1":"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.5)":"dark"===ee.theme.name?"rgba(255,255,255,0.05)":"minimalist"===ee.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:"note"===ee.theme.name?"#e6cda4":ee.border,borderWidth:"1px",borderStyle:"solid",color:ee.textPrimary,boxShadow:"none",outline:"none"}})]})]})}),t.jsx("div",{className:"mt-6",children:(1===ie&&Ze||2===ie&&at)&&t.jsx(U,{feedback:1===ie?Ze:at,improved:1===ie?tt:nt})}),t.jsx(c,{variant:"outline",size:"sm",onClick:()=>J("/ielts/writing"),className:"fixed bottom-6 left-6 z-50 rounded-xl",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.9)":"dark"===ee.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===ee.theme.name?"#ffffff":ee.theme.colors.cardBackground,borderColor:ee.border,color:ee.textPrimary},children:"Exit"}),t.jsxs("div",{className:"fixed bottom-6 right-3 sm:bottom-6 sm:right-6 z-50",children:[Te&&t.jsxs(x,{className:"backdrop-blur-md rounded-3xl w-[260px] h-[360px] sm:w-96 sm:h-[500px] shadow-2xl flex flex-col transform-gpu origin-bottom-right transition-all duration-260 ease-in-out "+(Ee?"opacity-100 scale-100 translate-y-0":"opacity-0 scale-75 translate-y-8"),style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.95)":"dark"===ee.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===ee.theme.name?"#ffffff":ee.theme.colors.cardBackground,borderColor:ee.border,backdropFilter:"glassmorphism"===ee.theme.name?"blur(12px)":"dark"===ee.theme.name?"blur(8px)":"none",...ee.cardStyle},children:[t.jsx(E,{className:"pb-1 sm:pb-2 rounded-t-3xl relative",children:t.jsx("div",{className:"absolute top-1.5 right-1.5 sm:top-2 sm:right-2",children:t.jsx(c,{variant:"ghost",size:"icon",onClick:()=>{We(!1),setTimeout(()=>Ie(!1),260)},className:"h-7 w-7 sm:h-8 sm:w-8 p-0",style:{color:ee.textPrimary},children:"âœ•"})})}),t.jsxs(u,{className:"flex-1 flex flex-col px-2.5 py-2 sm:p-4 overflow-hidden",children:[t.jsx(z,{className:"flex-1 min-h-0",children:t.jsx(D,{className:"flex-1 min-h-0",children:0!==At().length||Ce?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"rounded-lg p-3 mb-4",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.1)":"dark"===ee.theme.name?"rgba(255,255,255,0.05)":"minimalist"===ee.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:ee.border,borderWidth:"1px",borderStyle:"solid"},children:t.jsx("div",{className:"text-[10px] sm:text-sm whitespace-pre-wrap",style:{color:ee.textSecondary},children:(null==Ft?void 0:Ft.title)||(1===ie?"Letter Writing":"Essay Writing")})}),At().map(e=>t.jsxs(q,{from:"user"===e.type?"user":"assistant",children:["bot"===e.type&&t.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"52px",height:"52px",flexShrink:0},children:t.jsx("img",{src:"/1000031289.png",alt:"Catie",style:{width:"100%",height:"100%",objectFit:"cover"}})}),t.jsx($,{children:t.jsx("div",{className:"px-3 py-2 rounded-xl text-sm",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.1)":"dark"===ee.theme.name?"rgba(255,255,255,0.05)":"minimalist"===ee.theme.name?"#f9fafb":"rgba(255,255,255,0.5)",borderColor:ee.border,borderWidth:"1px",borderStyle:"solid",color:ee.textPrimary},children:t.jsx(H,{dangerouslySetInnerHTML:{__html:e.content.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/^â€¢ (.*)$/gm,"<li>$1</li>").replace(/(<li>.*<\/li>)/s,"<ul>$1</ul>").replace(/\n/g,"<br>")}})})}),"user"===e.type&&(null==Z?void 0:Z.avatar_url)&&t.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"52px",height:"52px",flexShrink:0},children:t.jsx("img",{src:Z.avatar_url,alt:"Your avatar",style:{width:"100%",height:"100%",objectFit:"cover"}})})]},e.id)),Ce&&t.jsxs(q,{from:"assistant",children:[t.jsx($,{children:t.jsx("div",{className:"px-3 py-2 rounded-xl text-sm",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.1)":"dark"===ee.theme.name?"rgba(255,255,255,0.05)":"minimalist"===ee.theme.name?"#f9fafb":"rgba(255,255,255,0.5)",borderColor:ee.border,borderWidth:"1px",borderStyle:"solid"},children:t.jsx(M,{text:"Thinking..."})})}),t.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"52px",height:"52px"},children:t.jsx("img",{src:"/1000031289.png",alt:"Catie",style:{width:"100%",height:"100%",objectFit:"cover"}})})]}),t.jsx("div",{ref:ct})]}):t.jsx(L,{icon:t.jsx(F,{className:"size-9 sm:size-12",style:{color:ee.textSecondary}}),title:"Start a conversation",description:"Ask for help with your IELTS writing practice"})})}),t.jsx("div",{className:"flex-shrink-0 mt-2.5 sm:mt-4",children:t.jsxs("div",{className:"flex gap-1.5 sm:gap-2",children:[t.jsx("input",{type:"text",value:we,onChange:e=>Ne(e.target.value),onKeyPress:e=>"Enter"===e.key&&!Ce&&we.trim()&&zt(),placeholder:"Ask for writing help...",className:"flex-1 px-2.5 py-1.5 sm:px-3 sm:py-2 rounded-lg text-[10px] sm:text-sm focus:outline-none focus:ring-0 resize-none",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.1)":"dark"===ee.theme.name?"rgba(255,255,255,0.05)":"minimalist"===ee.theme.name?"#ffffff":ee.theme.colors.cardBackground,borderColor:ee.border,borderWidth:"1px",borderStyle:"solid",color:ee.textPrimary},disabled:Ce}),t.jsx("style",{dangerouslySetInnerHTML:{__html:`\n                      input[placeholder="Ask for writing help..."]::placeholder {\n                        color: ${ee.textSecondary};\n                      }\n                    `}}),t.jsx(c,{onClick:()=>zt(),disabled:Ce||!we.trim(),variant:"ghost",size:"icon",className:"h-7 w-7 sm:h-8 sm:w-8 p-0",style:{color:ee.textPrimary},children:Ce?t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2",style:{borderColor:ee.textPrimary}}):t.jsx(W,{className:"w-4 h-4"})})]})})]})]}),!Te&&t.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"64px",height:"64px",cursor:"pointer",boxShadow:"0 8px 20px rgba(0,0,0,0.18)",transition:"transform 0.22s ease-out, box-shadow 0.22s ease-out"},onClick:()=>{Ie(!0),requestAnimationFrame(()=>We(!0))},onMouseEnter:e=>{const t=e.currentTarget;t.style.transform="scale(1.06) translateY(-2px)",t.style.boxShadow="0 14px 30px rgba(0,0,0,0.24)"},onMouseLeave:e=>{const t=e.currentTarget;t.style.transform="scale(1.0) translateY(0px)",t.style.boxShadow="0 10px 25px rgba(0,0,0,0.15)"},children:t.jsx("img",{src:"/1000031289.png",alt:"Catie",style:{width:"100%",height:"100%",objectFit:"cover"}})})]}),_e&&t.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 flex items-center justify-center",children:t.jsx("div",{className:"bg-card p-8 rounded-3xl shadow-xl border border-border",children:t.jsx(m,{message:"Analyzing your writing with AI examiner...",subMessage:"Please wait while we evaluate your IELTS writing",size:200})})})]})})})}),Ke&&t.jsx("style",{children:'\n          /* Prominent underline for spell check errors */\n          textarea[spellcheck="true"]::spelling-error {\n            text-decoration: wavy underline rgba(239, 68, 68, 0.8) 2px !important;\n            text-decoration-skip-ink: none !important;\n          }\n\n          textarea[spellcheck="true"]:focus::spelling-error {\n            text-decoration: wavy underline rgba(239, 68, 68, 0.9) 2px !important;\n          }\n        '})]}):t.jsx(d,{title:"IELTS Writing Test",showBackButton:!0,children:t.jsx("div",{className:"flex items-center justify-center min-h-96",children:t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-lg text-foreground mb-4",children:"Task data not available"}),t.jsx(c,{onClick:()=>J("/ielts-portal"),variant:"outline",children:"Back to Portal"})]})})});var qt};export{Y as default};
