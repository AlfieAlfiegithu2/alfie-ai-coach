import{a1 as e,j as t,G as r,u as a,h as s,ae as n,a8 as l,r as i,bt as o,aa as d,bu as m,B as c,ad as h,a as u,C as x,W as f,T as g,aJ as b,bv as p,bw as v,bx as y,S as k,p as j,q as w,s as N,t as C,E as S,N as _,R as P,av as T,by as I,U as E,b as W,a0 as A}from"./index-snkdXCMk.js";import{s as B}from"./supabase-DWL4C3fA.js";import{F as L}from"./languages-DxndpTaK.js";import{C as F,a as z,b as D,O as $,M as q,c as H,R as M,S as U}from"./shimmering-text-5kZSl9I1.js";const R=({feedback:r,improved:a})=>{const s=e();return r?t.jsxs("div",{className:"mt-4 space-y-4",children:[t.jsxs("div",{className:"p-4 rounded-lg border",style:{backgroundColor:"dark"===s.theme.name?"rgba(255,255,255,0.05)":"minimalist"===s.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:s.border},children:[t.jsx("h4",{className:"font-semibold mb-2",style:{color:s.textPrimary},children:"Grammar Feedback:"}),t.jsx("div",{className:"text-sm whitespace-pre-wrap",style:{color:s.textPrimary},children:r})]}),a&&t.jsxs("div",{className:"p-4 rounded-lg border",style:{backgroundColor:"dark"===s.theme.name?"rgba(255,255,255,0.05)":"minimalist"===s.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:s.border},children:[t.jsx("h4",{className:"font-semibold mb-2",style:{color:s.textPrimary},children:"Improved Version:"}),t.jsx("div",{className:"text-sm whitespace-pre-wrap",style:{color:s.textPrimary},children:a})]})]}):null},Y=()=>{var Y,G,V,X,O;const{testId:J}=r(),K=a(),{toast:Q}=s(),{user:Z,profile:ee}=n(),te=e();l();const[re,ae]=i.useState(null),[se,ne]=i.useState(null),[le,ie]=i.useState(null),[oe,de]=i.useState(1),[me,ce]=i.useState(""),[he,ue]=i.useState(""),[xe,fe]=i.useState([]),[ge,be]=i.useState(!1),[pe,ve]=i.useState(!1),[ye,ke]=i.useState([{id:"1",type:"bot",content:"Hi! I'm Catie, your IELTS Writing tutor ðŸ“ I can see your Task 1 instructions above. Ask me anything specific about this task - like how to structure your response, what key features to highlight, or how to get started!",timestamp:new Date}]),[je,we]=i.useState([{id:"1",type:"bot",content:"Hi! I'm Catie, your IELTS Writing tutor ðŸ“ I can see your Task 2 essay topic above. Ask me about structuring your argument, developing your ideas for this specific topic, or how to present your opinion effectively!",timestamp:new Date}]),[Ne,Ce]=i.useState(""),[Se,_e]=i.useState(!1),[Pe,Te]=i.useState(!1);i.useState(!1),i.useState(!1);const[Ie,Ee]=i.useState(!1),[We,Ae]=i.useState(!1),[Be,Le]=i.useState(1),[Fe,ze]=i.useState("center"),[De,$e]=i.useState("en"),[qe,He]=i.useState("deepseek-v3.2"),[Me]=o(),Ue=Me.get("training"),[Re,Ye]=i.useState([]),[Ge,Ve]=i.useState(0),[Xe,Oe]=i.useState(!1),[Je,Ke]=i.useState(0),[Qe,Ze]=i.useState(!1);i.useState(!1);const[et,tt]=i.useState(null),[rt,at]=i.useState(null),[st,nt]=i.useState(null),[lt,it]=i.useState(null),[ot,dt]=i.useState(!1),[mt,ct]=i.useState(!1),ht=i.useRef(null),[ut,xt]=i.useState(""),[ft,gt]=i.useState(""),[bt,pt]=i.useState(!1),[vt,yt]=i.useState(""),[kt,jt]=i.useState(""),[wt,Nt]=i.useState(!1);i.useEffect(()=>{if(!J)return;const e=`ielts-writing-draft-${J}-task1`,t=`ielts-writing-draft-${J}-task2`,r=localStorage.getItem(e),a=localStorage.getItem(t);r&&!me&&ce(r),a&&!he&&ue(a)},[J]),i.useEffect(()=>{J&&localStorage.setItem(`ielts-writing-draft-${J}-task1`,me)},[me,J]),i.useEffect(()=>{J&&localStorage.setItem(`ielts-writing-draft-${J}-task2`,he)},[he,J]),i.useEffect(()=>{let e;return Xe&&Ge>0&&(e=setInterval(()=>{Ve(e=>e<=1?(Oe(!1),0):e-1),Ke(e=>e+1e3)},1e3)),()=>{e&&clearInterval(e)}},[Xe,Ge]),i.useEffect(()=>{if(Ue&&xe.length>0){const e=xe.filter(e=>e.test_subtype===Ue||!e.test_subtype&&"Academic"===Ue);Ye(e)}else Ye(xe)},[Ue,xe]),i.useEffect(()=>{J?Ct():St()},[J]);const Ct=async()=>{ve(!0);try{if(!J)throw new Error("Test ID is required");const[e,t]=await Promise.all([B.from("tests").select("id, test_name, test_type, module, skill_category, test_subtype").eq("id",J).maybeSingle(),B.from("questions").select("id, test_id, part_number, question_text, passage_text, image_url, explanation, transcription").eq("test_id",J).in("part_number",[1,2]).order("part_number")]);if(e.error)throw e.error;if(t.error)throw t.error;const r=e.data;if(!r)throw new Error("Test not found");ae(r);const a=t.data||[],s=a.find(e=>1===e.part_number),n=a.find(e=>2===e.part_number);if(null==s?void 0:s.image_url){(new Image).src=s.image_url}const l=s?{id:s.id,title:s.question_text||"Task 1 - Data Description",instructions:s.passage_text||"",imageUrl:s.image_url||"",imageContext:s.explanation||"",modelAnswer:s.transcription||""}:{id:"default-task1",title:"Task 1 - Data Description",instructions:"Task 1 question not found. Please contact support.",imageUrl:"",imageContext:"",modelAnswer:""},i=n?{id:n.id,title:n.question_text||"Task 2 - Essay Writing",instructions:n.passage_text||"",modelAnswer:n.transcription||""}:{id:"default-task2",title:"Task 2 - Essay Writing",instructions:"Task 2 question not found. Please contact support.",modelAnswer:""};ne(l),ie(i)}catch(e){const t=(null==e?void 0:e.message)||"Failed to load test data. Please try again.";Q({title:"Error",description:t,variant:"destructive"}),ae(null),ne(null),ie(null)}finally{ve(!1)}},St=async()=>{be(!0);try{const{data:e,error:t}=await B.from("tests").select("id, test_name, test_type, module, skill_category, test_subtype, created_at").eq("test_type","IELTS").or("module.ilike.Writing,skill_category.ilike.Writing,test_name.ilike.%Writing%").order("created_at",{ascending:!1}).limit(50);if(t)throw t;const r=(e||[]).filter(e=>e&&e.id&&(e.test_name||e.module||e.skill_category));fe(r)}catch(e){Q({title:"Error",description:"Failed to load available writing tests. Please try again.",variant:"destructive"}),fe([])}finally{be(!1)}},_t=()=>1===oe?se:le,Pt=()=>1===oe?me:he,Tt=e=>{1===oe?ce(e):ue(e)},It=e=>e.trim().split(/\s+/).filter(e=>e.length>0).length,Et=()=>It(1===oe?me:he),Wt=()=>1===oe?150:250,At=()=>Pe||(ot||!me.trim())&&(mt||!he.trim())||!ot&&me.trim()&&It(me)<150||!mt&&he.trim()&&It(he)<250||!ot&&!me.trim()||!mt&&!he.trim(),Bt=()=>1===oe?ye:je,Lt=e=>{1===oe?ke(e):we(e)},Ft=async e=>{var t;const r=Ne.trim();if(!r||Se)return;const a={id:Date.now().toString(),type:"user",content:r,timestamp:new Date};Lt(e=>[...e,a]),Ce(""),_e(!0);try{const e=_t();if(!e)throw new Error("No task data available");const t=Pt(),{data:a,error:s}=await B.functions.invoke("openai-chat",{body:{message:r,context:"catbot",imageContext:e.imageContext,taskType:1===oe?"Task 1 - Data Description (charts, graphs, tables, diagrams)":"Task 2 - Essay Writing (arguments, opinions, examples)",taskInstructions:e.instructions,studentWriting:t,skipCache:!0}});if(s)throw s;const n={id:(Date.now()+1).toString(),type:"bot",content:a.response,timestamp:new Date};Lt(e=>[...e,n])}catch(s){let e="Connection Issue",r="Failed to get response from Catie. Please try again.";(null==(t=null==s?void 0:s.message)?void 0:t.includes("service temporarily unavailable"))||503===(null==s?void 0:s.statusCode)?(e="Service Update",r="Catie is being updated! Please try again in a moment."):429===(null==s?void 0:s.statusCode)&&(e="High Traffic",r="Lots of students are getting help! Please wait a moment and try again."),Q({title:e,description:r,variant:"destructive"})}finally{_e(!1)}},zt=e=>{de(e)};i.useEffect(()=>{var e;null==(e=ht.current)||e.scrollIntoView({behavior:"smooth"})},[ye,je,Se,oe]);const Dt=async()=>{var e,t,r,a,s,n,l,i,o,d,m,c,h,u,x,f,g,b,p,v,y,k,j,w,N,C,S,_,P,T,I,E,W,A;const L=!ot&&me.trim(),F=!mt&&he.trim();if(!L&&!F)return void Q({title:"Please complete at least one task",description:"You need to complete at least Task 1 or Task 2 to submit (or skip one)",variant:"destructive"});const z=It(me),D=It(he);if(!ot){if(!me.trim())return void Q({title:"Task 1 is required",description:"Please complete Task 1 or skip it before submitting.",variant:"destructive"});if(z<150)return void Q({title:"Task 1 word count too low",description:`Task 1 requires a minimum of 150 words. You currently have ${z} words.`,variant:"destructive"})}if(!mt){if(!he.trim())return void Q({title:"Task 2 is required",description:"Please complete Task 2 or skip it before submitting.",variant:"destructive"});if(D<250)return void Q({title:"Task 2 word count too low",description:`Task 2 requires a minimum of 250 words. You currently have ${D} words.`,variant:"destructive"})}Te(!0);try{const[L]=await Promise.all([B.functions.invoke("ielts-writing-examiner",{body:{task1Answer:!ot&&me.trim()?me.trim():null,task2Answer:!mt&&he.trim()?he.trim():null,task1Data:!ot&&me.trim()?se:null,task2Data:!mt&&he.trim()?le:null,targetLanguage:"en"!==De?De:void 0,model:qe}})]);if(L.error)throw L.error;const{structured:F,feedback:z,task1WordCount:D,task2WordCount:$}=L.data,q=!ot&&me.trim()?D||It(me):0,H=!mt&&he.trim()?$||It(he):0,{data:M,error:U}=await B.from("test_results").insert({user_id:null==Z?void 0:Z.id,test_type:"writing",score_percentage:Math.round(10*((null==(e=null==F?void 0:F.overall)?void 0:e.band)??(((null==(t=null==F?void 0:F.task1)?void 0:t.overall_band)??7)+2*((null==(r=null==F?void 0:F.task2)?void 0:r.overall_band)??7))/3)),time_taken:Math.floor(Je/1e3),completed_at:(new Date).toISOString(),test_data:{task1Data:se?{id:se.id,title:se.title,instructions:se.instructions,imageUrl:se.imageUrl,imageContext:se.imageContext,modelAnswer:se.modelAnswer}:null,task2Data:le?{id:le.id,title:le.title,instructions:le.instructions,modelAnswer:le.modelAnswer}:null,task1Answer:!ot&&me.trim()?me.trim():null,task2Answer:!mt&&he.trim()?he.trim():null,overall_band:(null==(a=null==F?void 0:F.overall)?void 0:a.band)||7}}).select().single();if(U)throw U;if(!ot&&me.trim()){const{error:e}=await B.from("writing_test_results").insert({user_id:null==Z?void 0:Z.id,test_result_id:M.id,task_number:1,prompt_text:(null==se?void 0:se.instructions)||(null==se?void 0:se.title)||"",user_response:me,word_count:q,band_scores:{task_achievement:(null==(l=null==(n=null==(s=null==F?void 0:F.task1)?void 0:s.criteria)?void 0:n.task_achievement)?void 0:l.band)??null,coherence_and_cohesion:(null==(d=null==(o=null==(i=null==F?void 0:F.task1)?void 0:i.criteria)?void 0:o.coherence_and_cohesion)?void 0:d.band)??null,lexical_resource:(null==(h=null==(c=null==(m=null==F?void 0:F.task1)?void 0:m.criteria)?void 0:c.lexical_resource)?void 0:h.band)??null,grammatical_range_and_accuracy:(null==(f=null==(x=null==(u=null==F?void 0:F.task1)?void 0:u.criteria)?void 0:x.grammatical_range_and_accuracy)?void 0:f.band)??null},detailed_feedback:(null==(g=null==F?void 0:F.task1)?void 0:g.feedback_markdown)||"",improvement_suggestions:(null==(p=null==(b=null==F?void 0:F.task1)?void 0:b.feedback)?void 0:p.improvements)||[]});if(e)throw e}if(!mt&&he.trim()){const{error:e}=await B.from("writing_test_results").insert({user_id:null==Z?void 0:Z.id,test_result_id:M.id,task_number:2,prompt_text:(null==le?void 0:le.instructions)||(null==le?void 0:le.title)||"",user_response:he,word_count:H,band_scores:{task_response:(null==(k=null==(y=null==(v=null==F?void 0:F.task2)?void 0:v.criteria)?void 0:y.task_response)?void 0:k.band)??null,coherence_and_cohesion:(null==(N=null==(w=null==(j=null==F?void 0:F.task2)?void 0:j.criteria)?void 0:w.coherence_and_cohesion)?void 0:N.band)??null,lexical_resource:(null==(_=null==(S=null==(C=null==F?void 0:F.task2)?void 0:C.criteria)?void 0:S.lexical_resource)?void 0:_.band)??null,grammatical_range_and_accuracy:(null==(I=null==(T=null==(P=null==F?void 0:F.task2)?void 0:P.criteria)?void 0:T.grammatical_range_and_accuracy)?void 0:I.band)??null},detailed_feedback:(null==(E=null==F?void 0:F.task2)?void 0:E.feedback_markdown)||"",improvement_suggestions:(null==(A=null==(W=null==F?void 0:F.task2)?void 0:W.feedback)?void 0:A.improvements)||[]});if(e)throw e}K("/ielts-writing-results-pro",{state:{testName:null==re?void 0:re.test_name,testId:J,submissionId:M.id,task1Answer:!ot&&me.trim()?me.trim():null,task2Answer:!mt&&he.trim()?he.trim():null,task1Skipped:ot,task2Skipped:mt,feedback:z,structured:F,task1Data:se,task2Data:le,task1WordCount:q,task2WordCount:H}})}catch($){Q({title:"Error",description:(null==$?void 0:$.message)||"Failed to submit test for evaluation",variant:"destructive"})}finally{Te(!1)}};if(i.useEffect(()=>{Xe||(Ve(3600),Oe(!0))},[Xe]),!J){if(ge)return t.jsx(d,{title:"Writing Tests",children:t.jsx("div",{className:"flex items-center justify-center min-h-96",children:t.jsx("div",{className:"text-center",children:t.jsx(m,{message:"Loading available writing tests...",subMessage:"Please wait",size:150})})})});if(Re.length>0||xe.length>0){const e=Re.length>0?Re:xe;return t.jsxs("div",{className:"min-h-screen relative",children:[t.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"note"===te.theme.name||"minimalist"===te.theme.name||"dark"===te.theme.name?"none":"url('/1000031207.png')",backgroundColor:te.backgroundImageColor}}),t.jsx("div",{className:"relative z-10",children:t.jsx(d,{title:"Available Writing Tests",transparentBackground:!0,children:t.jsx("div",{className:"min-h-screen py-12",children:t.jsx("div",{className:"container mx-auto px-4",children:t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsxs("div",{className:"mb-8",children:[t.jsx(c,{variant:"outline",onClick:()=>K("/ielts-portal"),className:"mb-4 transition-all duration-200 hover:shadow-md",style:{backgroundColor:"glassmorphism"===te.theme.name?"rgba(255,255,255,0.5)":"dark"===te.theme.name?"rgba(255,255,255,0.1)":te.cardBackground,color:te.textPrimary,borderColor:te.border},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=te.hoverBg,e.currentTarget.style.color=te.buttonPrimary,e.currentTarget.style.borderColor=te.buttonPrimary},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="glassmorphism"===te.theme.name?"rgba(255,255,255,0.5)":"dark"===te.theme.name?"rgba(255,255,255,0.1)":te.cardBackground,e.currentTarget.style.color=te.textPrimary,e.currentTarget.style.borderColor=te.border},children:"â† Back to IELTS Portal"}),t.jsxs("h1",{className:"text-4xl font-bold mb-2 text-center",style:{color:te.textPrimary},children:["IELTS ",Ue||"Writing"," Tests"]})]}),t.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:e.map(e=>e&&e.id?t.jsx(h,{className:"cursor-pointer h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg bg-white/80 flex items-center justify-center",onClick:()=>K(`/ielts-writing-test/${e.id}`),children:t.jsx(u,{className:"p-3 md:p-4 text-center flex items-center justify-center h-full",children:t.jsx("h3",{className:"font-semibold text-sm",children:e.test_name||"Untitled Test"})})},e.id):null)})]})})})})})]})}return t.jsx(d,{title:"Writing Tests",children:t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background to-primary/5 py-12",children:t.jsxs("div",{className:"container mx-auto px-4 text-center",children:[t.jsx("h1",{className:"text-4xl font-bold text-foreground mb-4",children:"IELTS Writing Tests"}),t.jsx("p",{className:"text-lg text-muted-foreground mb-8",children:"No writing tests available yet"}),t.jsx(c,{onClick:()=>K("/ielts-portal"),variant:"outline",children:"Back to Portal"})]})})})}if(pe)return t.jsx(d,{title:"IELTS Writing Test",showBackButton:!0,children:t.jsx("div",{className:"flex items-center justify-center min-h-96",children:t.jsx("div",{className:"text-center",children:t.jsx(m,{message:"Loading IELTS Writing test...",subMessage:"Please wait while we fetch your test",size:150})})})});if(J&&(!re||!se||!le))return t.jsx(d,{title:"IELTS Writing Test",showBackButton:!0,children:t.jsx("div",{className:"flex items-center justify-center min-h-96",children:t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-lg text-foreground mb-4",children:"Unable to load test"}),t.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:re?se&&le?"Unknown error":"Test data is incomplete":"Test not found"}),t.jsx(c,{onClick:()=>K("/ielts-portal"),variant:"outline",children:"Back to Portal"})]})})});const $t=_t();return $t?t.jsxs("div",{className:"min-h-screen relative",style:{backgroundColor:"dark"===te.theme.name?te.theme.colors.background:"transparent"},children:[t.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"note"===te.theme.name||"minimalist"===te.theme.name||"dark"===te.theme.name?"none":"url('/1000031207.png')",backgroundColor:te.backgroundImageColor}}),t.jsx("div",{className:"relative z-10 flex flex-col pb-24 sm:pb-6",style:{backgroundColor:"dark"===te.theme.name?te.theme.colors.background:"transparent",minHeight:"calc(100vh - 80px)"},children:t.jsx(d,{title:"IELTS Writing Test",showBackButton:!0,transparentBackground:!0,children:t.jsx("div",{className:"flex-1 flex justify-center py-6 sm:py-6 pb-4",children:t.jsxs("div",{className:"w-full max-w-6xl mx-auto space-y-4 px-4 sm:px-6 flex flex-col",children:[t.jsx(x,{className:"rounded-3xl mb-4 max-w-fit mx-auto px-4",style:{backgroundColor:"glassmorphism"===te.theme.name?"rgba(255,255,255,0.9)":"dark"===te.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===te.theme.name?"#ffffff":te.theme.colors.cardBackground,borderColor:te.border,backdropFilter:"glassmorphism"===te.theme.name?"blur(12px)":"dark"===te.theme.name?"blur(8px)":"none",boxShadow:"dark"===te.theme.name?"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)":"note"===te.theme.name?null==(Y=te.theme.styles.cardStyle)?void 0:Y.boxShadow:"0 8px 32px rgba(15, 23, 42, 0.16), 0 0 0 1px rgba(148, 163, 253, 0.06)",...te.cardStyle},children:t.jsx(u,{className:"p-2 sm:p-3",children:t.jsxs("div",{className:"flex items-center justify-center gap-2 sm:gap-3 flex-wrap",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(f,{className:"w-3.5 h-3.5",style:{color:te.textPrimary}}),t.jsx("span",{className:"text-sm font-medium tabular-nums",style:{color:te.textPrimary},children:(qt=Ge,`${Math.floor(qt/60)}:${(qt%60).toString().padStart(2,"0")}`)})]}),t.jsx(c,{size:"sm",onClick:()=>zt(1),className:"h-9 sm:h-8 px-4 sm:px-3 text-sm sm:text-sm font-medium min-w-[70px]",style:{backgroundColor:1===oe?te.buttonPrimary:"transparent",color:1===oe?"#ffffff":te.textPrimary,border:"none"},children:"Task 1"}),t.jsx(c,{size:"sm",onClick:()=>zt(2),className:"h-9 sm:h-8 px-4 sm:px-3 text-sm sm:text-sm font-medium min-w-[70px]",style:{backgroundColor:2===oe?te.buttonPrimary:"transparent",color:2===oe?"#ffffff":te.textPrimary,border:"none"},children:"Task 2"})]})})}),1===oe?(null==$t?void 0:$t.imageUrl)?t.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 flex-1",style:{minHeight:"400px"},children:[t.jsx("div",{className:"flex-1 lg:flex-[0_0_50%] min-h-0",children:t.jsx(x,{className:"rounded-3xl h-full",style:{backgroundColor:"glassmorphism"===te.theme.name?"rgba(255,255,255,0.9)":"dark"===te.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===te.theme.name?"#ffffff":te.theme.colors.cardBackground,borderColor:te.border,backdropFilter:"glassmorphism"===te.theme.name?"blur(12px)":"dark"===te.theme.name?"blur(8px)":"none",boxShadow:"dark"===te.theme.name?"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)":"note"===te.theme.name?null==(G=te.theme.styles.cardStyle)?void 0:G.boxShadow:"0 8px 32px rgba(15, 23, 42, 0.16), 0 0 0 1px rgba(148, 163, 253, 0.06)",...te.cardStyle,display:"flex",flexDirection:"column"},children:t.jsxs(u,{className:"p-4 flex-1 flex flex-col",style:{minHeight:0},children:[t.jsx("div",{className:"mb-4",children:(null==$t?void 0:$t.instructions)&&t.jsx("div",{children:t.jsx("div",{className:"whitespace-pre-wrap leading-relaxed p-3 rounded-lg text-sm sm:text-base",style:{backgroundColor:"glassmorphism"===te.theme.name?"rgba(255,255,255,0.1)":"dark"===te.theme.name?"rgba(255,255,255,0.05)":"minimalist"===te.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:te.border,borderWidth:"1px",borderStyle:"solid",color:te.textPrimary},children:$t.instructions})})}),t.jsx("div",{className:"flex-1 overflow-hidden",children:t.jsx("img",{src:$t.imageUrl,alt:"Task 1 visual data",className:"w-full h-full object-contain cursor-pointer",loading:"eager",decoding:"async",onClick:e=>{const t=e.currentTarget.getBoundingClientRect(),r=(e.clientX-t.left)/t.width*100,a=(e.clientY-t.top)/t.height*100;ze(`${r}% ${a}%`),Le(1===Be?1.5:1)},style:{transform:`scale(${Be})`,transformOrigin:Fe,transition:"transform 0.2s ease-out"}})})]})})}),t.jsx("div",{className:"flex-1 lg:flex-[0_0_50%] min-h-0",children:t.jsx(x,{className:"rounded-3xl h-full",style:{backgroundColor:"glassmorphism"===te.theme.name?"rgba(255,255,255,0.9)":"dark"===te.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===te.theme.name?"#ffffff":te.theme.colors.cardBackground,borderColor:te.border,backdropFilter:"glassmorphism"===te.theme.name?"blur(12px)":"dark"===te.theme.name?"blur(8px)":"none",boxShadow:"dark"===te.theme.name?"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)":"note"===te.theme.name?null==(V=te.theme.styles.cardStyle)?void 0:V.boxShadow:"0 8px 32px rgba(15, 23, 42, 0.16), 0 0 0 1px rgba(148, 163, 253, 0.06)",...te.cardStyle,display:"flex",flexDirection:"column"},children:t.jsxs(u,{className:"flex-1 p-4 flex flex-col",style:{minHeight:0},children:[t.jsx("div",{className:"flex-1 flex flex-col",style:{minHeight:0},children:t.jsx(g,{value:Pt(),onChange:e=>Tt(e.target.value),className:"flex-1 min-h-[300px] w-full text-base leading-relaxed resize-none rounded-2xl focus:outline-none focus:ring-0",placeholder:ot?"Task 1 is skipped":"General"===(null==re?void 0:re.test_subtype)||"General"===Ue?"Write your letter here...":"Write your Task 1 response here...",spellCheck:Qe,disabled:ot,style:{backgroundColor:ot?"glassmorphism"===te.theme.name?"rgba(255,255,255,0.05)":"dark"===te.theme.name?"rgba(255,255,255,0.02)":"minimalist"===te.theme.name?"#f3f4f6":"rgba(255,255,255,0.3)":"glassmorphism"===te.theme.name?"rgba(255,255,255,0.1)":"dark"===te.theme.name?"rgba(255,255,255,0.05)":"minimalist"===te.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:te.border,color:ot?te.textSecondary:te.textPrimary,outline:"none",boxShadow:"none",cursor:ot?"not-allowed":"text",opacity:ot?.6:1}})}),t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mt-4 pt-3 border-t flex-shrink-0",style:{borderColor:te.border},children:[t.jsxs("div",{className:"text-sm font-medium",style:{color:te.textSecondary},children:[t.jsx("span",{className:Et()<Wt()?"text-red-500":"text-green-600",children:Et()})," / ",Wt()]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(c,{size:"sm",variant:"ghost",onClick:()=>{dt(!ot),ot||zt(2)},className:"h-8 px-3 text-sm font-medium hover:bg-transparent",style:{backgroundColor:ot?te.buttonPrimary:"transparent",color:ot?"#ffffff":te.textPrimary,border:"none",boxShadow:"none"},children:ot?"Unskip":"Skip"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-medium",style:{color:te.textPrimary},children:"Spell"}),t.jsx(b,{children:t.jsxs(p,{children:[t.jsx(v,{asChild:!0,children:t.jsx("div",{onClick:()=>Ze(!Qe),className:"relative inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none",style:{backgroundColor:Qe?te.buttonPrimary:"glassmorphism"===te.theme.name?"rgba(255,255,255,0.2)":"dark"===te.theme.name?"rgba(255,255,255,0.1)":"minimalist"===te.theme.name?"#e5e7eb":te.border},"data-state":Qe?"checked":"unchecked",children:t.jsx("div",{className:"pointer-events-none flex h-5 w-5 rounded-full shadow-lg ring-0 transition-transform",style:{backgroundColor:"glassmorphism"===te.theme.name?"rgba(255,255,255,0.95)":"dark"===te.theme.name?"rgba(255,255,255,0.9)":"minimalist"===te.theme.name?"#ffffff":te.theme.colors.cardBackground,transform:Qe?"translateX(20px)":"translateX(0px)"}})})}),t.jsx(y,{children:t.jsx("p",{children:Qe?"Hide spell check":"Show spell check"})})]})})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-medium",style:{color:te.textPrimary},children:"Feedback Language"}),t.jsxs(k,{value:De,onValueChange:$e,children:[t.jsx(j,{className:"w-[160px] h-9 text-sm rounded-lg px-3 border shadow-sm focus:ring-2 focus:ring-offset-0",style:{color:te.textPrimary,backgroundColor:"dark"===te.theme.name?"rgba(255,255,255,0.1)":"note"===te.theme.name?"rgba(255,255,255,0.5)":"#ffffff",borderColor:te.border,"--tw-ring-color":te.buttonPrimary},children:t.jsx(w,{children:(()=>{const e=L.find(e=>e.value===De);return e?`${e.flag} ${e.nativeName}`:"Language"})()})}),t.jsx(N,{className:"max-h-80",style:{backgroundColor:"note"===te.theme.name?"#fffaf1":"dark"===te.theme.name?"#1e293b":"#ffffff",borderColor:"note"===te.theme.name?"#e6cda4":te.border},children:L.map(e=>t.jsx(C,{value:e.value,className:"note"===te.theme.name?"focus:bg-[#f5e6d3] focus:text-[#5c4a32] data-[state=checked]:bg-[#f5e6d3]":"",style:{color:te.textPrimary},children:t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsx("span",{children:e.flag}),t.jsx("span",{children:e.nativeName})]})},e.value))})]})]})]})]})]})})})]}):t.jsx(x,{className:"rounded-3xl max-w-3xl w-full mx-auto",style:{backgroundColor:"glassmorphism"===te.theme.name?"rgba(255,255,255,0.9)":"dark"===te.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===te.theme.name?"#ffffff":te.theme.colors.cardBackground,borderColor:te.border,backdropFilter:"glassmorphism"===te.theme.name?"blur(12px)":"dark"===te.theme.name?"blur(8px)":"none",boxShadow:"dark"===te.theme.name?"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)":"note"===te.theme.name?null==(X=te.theme.styles.cardStyle)?void 0:X.boxShadow:"0 8px 32px rgba(15, 23, 42, 0.16), 0 0 0 1px rgba(148, 163, 253, 0.06)",...te.cardStyle,minHeight:("dark"===te.theme.name?500:"minimalist"===te.theme.name?550:"note"===te.theme.name?580:600)+"px"},children:t.jsxs(u,{className:"p-4 flex flex-col flex-1",children:[(null==$t?void 0:$t.instructions)&&t.jsx("div",{className:"mb-4",children:t.jsx("div",{className:"whitespace-pre-wrap leading-relaxed p-3 rounded-lg text-sm",style:{backgroundColor:"glassmorphism"===te.theme.name?"rgba(255,255,255,0.1)":"dark"===te.theme.name?"rgba(255,255,255,0.05)":"minimalist"===te.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:te.border,borderWidth:"1px",borderStyle:"solid",color:te.textPrimary},children:$t.instructions})}),t.jsx(g,{value:Pt(),onChange:e=>Tt(e.target.value),placeholder:ot?"Task 1 is skipped":"General"===(null==re?void 0:re.test_subtype)||"General"===Ue?"Write your letter here...":"Write your Task 1 response here...",className:"flex-1 min-h-[500px] text-base leading-relaxed resize-none rounded-2xl focus:outline-none focus:ring-0",spellCheck:Qe,disabled:ot,style:{backgroundColor:ot?"glassmorphism"===te.theme.name?"rgba(255,255,255,0.05)":"dark"===te.theme.name?"rgba(255,255,255,0.02)":"minimalist"===te.theme.name?"#f3f4f6":"rgba(255,255,255,0.3)":"glassmorphism"===te.theme.name?"rgba(255,255,255,0.1)":"dark"===te.theme.name?"rgba(255,255,255,0.05)":"minimalist"===te.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:te.border,color:ot?te.textSecondary:te.textPrimary,outline:"none",boxShadow:"none",cursor:ot?"not-allowed":"text",opacity:ot?.6:1,height:"100%"}}),t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mt-4 pt-3 border-t",style:{borderColor:te.border},children:[t.jsxs("div",{className:"text-sm font-medium",style:{color:te.textSecondary},children:[t.jsx("span",{className:Et()<Wt()?"text-red-500":"text-green-600",children:Et()})," / ",Wt()]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(c,{size:"sm",variant:"ghost",onClick:()=>{dt(!ot),ot||zt(2)},className:"h-10 sm:h-8 px-4 sm:px-3 text-sm sm:text-sm font-medium hover:bg-transparent min-w-[70px]",style:{backgroundColor:ot?te.buttonPrimary:"transparent",color:ot?"#ffffff":te.textPrimary,border:"none",boxShadow:"none"},children:ot?"Unskip":"Skip"}),t.jsx(b,{children:t.jsxs(p,{children:[t.jsx(v,{asChild:!0,children:t.jsx("div",{onClick:()=>Ze(!Qe),className:"relative inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none",style:{backgroundColor:Qe?te.buttonPrimary:"glassmorphism"===te.theme.name?"rgba(255,255,255,0.2)":"dark"===te.theme.name?"rgba(255,255,255,0.1)":"minimalist"===te.theme.name?"#e5e7eb":te.border},"data-state":Qe?"checked":"unchecked",children:t.jsx("div",{className:"pointer-events-none flex h-5 w-5 rounded-full shadow-lg ring-0 transition-transform items-center justify-center",style:{backgroundColor:"glassmorphism"===te.theme.name?"rgba(255,255,255,0.95)":"dark"===te.theme.name?"rgba(255,255,255,0.9)":"minimalist"===te.theme.name?"#ffffff":te.theme.colors.cardBackground,transform:Qe?"translateX(20px)":"translateX(0px)"},children:Qe?t.jsx(S,{className:"w-3 h-3",style:{color:te.buttonPrimary}}):t.jsx(_,{className:"w-3 h-3",style:{color:te.textSecondary}})})})}),t.jsx(y,{children:t.jsx("p",{children:Qe?"Hide spell check":"Show spell check"})})]})}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-medium",style:{color:te.textPrimary},children:"Feedback Language"}),t.jsxs(k,{value:De,onValueChange:$e,children:[t.jsx(j,{className:"w-[160px] h-9 text-sm rounded-lg px-3 border shadow-sm focus:ring-2 focus:ring-offset-0",style:{color:te.textPrimary,backgroundColor:"dark"===te.theme.name?"rgba(255,255,255,0.1)":"note"===te.theme.name?"rgba(255,255,255,0.5)":"#ffffff",borderColor:te.border,"--tw-ring-color":te.buttonPrimary},children:t.jsx(w,{children:(()=>{const e=L.find(e=>e.value===De);return e?`${e.flag} ${e.nativeName}`:"Language"})()})}),t.jsx(N,{className:"max-h-80",style:{backgroundColor:"note"===te.theme.name?"#fffaf1":"dark"===te.theme.name?"#1e293b":"#ffffff",borderColor:"note"===te.theme.name?"#e6cda4":te.border},children:L.map(e=>t.jsx(C,{value:e.value,className:"note"===te.theme.name?"focus:bg-[#f5e6d3] focus:text-[#5c4a32] data-[state=checked]:bg-[#f5e6d3]":"",style:{color:te.textPrimary},children:t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsx("span",{children:e.flag}),t.jsx("span",{children:e.nativeName})]})},e.value))})]})]})]})]}),t.jsx("div",{className:"flex justify-end items-center mt-4 gap-3",children:t.jsx(c,{onClick:Dt,disabled:At(),variant:"default",className:"min-w-[120px]",style:{backgroundColor:te.buttonPrimary,color:"#ffffff"},children:Pe?"Submitting...":"Submit Test"})})]})}):t.jsx(x,{className:"rounded-3xl h-full max-w-3xl w-full mx-auto",style:{backgroundColor:"glassmorphism"===te.theme.name?"rgba(255,255,255,0.9)":"dark"===te.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===te.theme.name?"#ffffff":te.theme.colors.cardBackground,borderColor:te.border,backdropFilter:"glassmorphism"===te.theme.name?"blur(12px)":"dark"===te.theme.name?"blur(8px)":"none",boxShadow:"dark"===te.theme.name?"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)":"note"===te.theme.name?null==(O=te.theme.styles.cardStyle)?void 0:O.boxShadow:"0 8px 32px rgba(15, 23, 42, 0.16), 0 0 0 1px rgba(148, 163, 253, 0.06)",...te.cardStyle,minHeight:("dark"===te.theme.name?500:"minimalist"===te.theme.name?550:"note"===te.theme.name?580:600)+"px"},children:t.jsxs(u,{className:"p-4 flex flex-col h-full",children:[(null==$t?void 0:$t.instructions)&&t.jsx("div",{className:"mb-4",children:t.jsx("div",{className:"whitespace-pre-wrap leading-relaxed p-3 rounded-lg text-sm",style:{backgroundColor:"glassmorphism"===te.theme.name?"rgba(255,255,255,0.1)":"dark"===te.theme.name?"rgba(255,255,255,0.05)":"minimalist"===te.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:te.border,borderWidth:"1px",borderStyle:"solid",color:te.textPrimary},children:$t.instructions})}),t.jsx(g,{value:Pt(),onChange:e=>Tt(e.target.value),placeholder:mt?"Task 2 is skipped":"Write your Task 2 essay here...",className:"flex-1 min-h-[500px] text-base leading-relaxed resize-none rounded-2xl focus:outline-none focus:ring-0",spellCheck:Qe,disabled:mt,style:{backgroundColor:mt?"glassmorphism"===te.theme.name?"rgba(255,255,255,0.05)":"dark"===te.theme.name?"rgba(255,255,255,0.02)":"minimalist"===te.theme.name?"#f3f4f6":"rgba(255,255,255,0.3)":"glassmorphism"===te.theme.name?"rgba(255,255,255,0.1)":"dark"===te.theme.name?"rgba(255,255,255,0.05)":"minimalist"===te.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:te.border,color:mt?te.textSecondary:te.textPrimary,outline:"none",boxShadow:"none",cursor:mt?"not-allowed":"text",opacity:mt?.6:1,height:"100%"}}),t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mt-4 pt-3 border-t",style:{borderColor:te.border},children:[t.jsxs("div",{className:"text-sm font-medium",style:{color:te.textSecondary},children:[t.jsx("span",{className:Et()<Wt()?"text-red-500":"text-green-600",children:Et()})," / ",Wt()]}),t.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3",children:[t.jsx(c,{size:"sm",variant:"ghost",onClick:()=>{ct(!mt)},className:"h-10 sm:h-8 px-4 sm:px-3 text-sm sm:text-sm font-medium hover:bg-transparent min-w-[70px]",style:{backgroundColor:mt?te.buttonPrimary:"transparent",color:mt?"#ffffff":te.textPrimary,border:"none",boxShadow:"none"},children:mt?"Unskip":"Skip"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-medium",style:{color:te.textPrimary},children:"Spell"}),t.jsx(b,{children:t.jsxs(p,{children:[t.jsx(v,{asChild:!0,children:t.jsx("div",{onClick:()=>Ze(!Qe),className:"relative inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none",style:{backgroundColor:Qe?te.buttonPrimary:"glassmorphism"===te.theme.name?"rgba(255,255,255,0.2)":"dark"===te.theme.name?"rgba(255,255,255,0.1)":"minimalist"===te.theme.name?"#e5e7eb":te.border},"data-state":Qe?"checked":"unchecked",children:t.jsx("div",{className:"pointer-events-none flex h-5 w-5 rounded-full shadow-lg ring-0 transition-transform",style:{backgroundColor:"glassmorphism"===te.theme.name?"rgba(255,255,255,0.95)":"dark"===te.theme.name?"rgba(255,255,255,0.9)":"minimalist"===te.theme.name?"#ffffff":te.theme.colors.cardBackground,transform:Qe?"translateX(20px)":"translateX(0px)"}})})}),t.jsx(y,{children:t.jsx("p",{children:Qe?"Hide spell check":"Show spell check"})})]})})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-medium",style:{color:te.textPrimary},children:"Feedback Language"}),t.jsxs(k,{value:De,onValueChange:$e,children:[t.jsx(j,{className:"w-[160px] h-9 text-sm rounded-lg px-3 border shadow-sm focus:ring-2 focus:ring-offset-0",style:{color:te.textPrimary,backgroundColor:"dark"===te.theme.name?"rgba(255,255,255,0.1)":"note"===te.theme.name?"rgba(255,255,255,0.5)":"#ffffff",borderColor:te.border,"--tw-ring-color":te.buttonPrimary},children:t.jsx(w,{children:(()=>{const e=L.find(e=>e.value===De);return e?`${e.flag} ${e.nativeName}`:"Language"})()})}),t.jsx(N,{className:"max-h-80",style:{backgroundColor:"note"===te.theme.name?"#fffaf1":"dark"===te.theme.name?"#1e293b":"#ffffff",borderColor:"note"===te.theme.name?"#e6cda4":te.border},children:L.map(e=>t.jsx(C,{value:e.value,className:"note"===te.theme.name?"focus:bg-[#f5e6d3] focus:text-[#5c4a32] data-[state=checked]:bg-[#f5e6d3]":"",style:{color:te.textPrimary},children:t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsx("span",{children:e.flag}),t.jsx("span",{children:e.nativeName})]})},e.value))})]})]}),t.jsx(c,{onClick:Dt,disabled:At(),variant:"default",className:"min-w-[120px] h-8",style:{backgroundColor:te.buttonPrimary,color:"#ffffff"},children:Pe?"Submitting...":"Submit Test"})]})]}),t.jsx("div",{className:"mt-3 pt-2 border-t",style:{borderColor:te.border},children:t.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[t.jsx(P,{htmlFor:"ai-model-selector",className:"text-sm font-medium whitespace-nowrap",style:{color:te.textPrimary},children:"AI Model:"}),t.jsxs(k,{value:qe,onValueChange:He,children:[t.jsx(j,{id:"ai-model-selector",className:"w-[200px] h-9 text-sm border transition-colors rounded-lg",style:{backgroundColor:"glassmorphism"===te.theme.name?"rgba(255,255,255,0.9)":"dark"===te.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===te.theme.name?"#ffffff":te.theme.colors.cardBackground,borderColor:te.border,color:te.textPrimary,backdropFilter:"glassmorphism"===te.theme.name?"blur(12px)":"none"},children:t.jsx(w,{placeholder:"Select AI Model"})}),t.jsxs(N,{children:[t.jsx(C,{value:"deepseek-v3.2",children:"DeepSeek V3.2"}),t.jsx(C,{value:"gemini-2.5-flash",children:"Gemini 2.5 Flash"})]})]})]})})]})}),t.jsx("div",{className:"mt-6 max-w-3xl mx-auto w-full","data-improve-section":!0,children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"flex items-center justify-between mb-2",children:t.jsx("span",{className:"text-sm font-semibold",style:{color:"note"===te.theme.name?"#8b7355":te.textSecondary},children:"Grammar Improve"})}),t.jsx(g,{value:ut,onChange:e=>xt(e.target.value),placeholder:"Paste your text here to improve...",className:"min-h-[120px] text-sm leading-relaxed resize-none rounded-xl focus-visible:ring-0 focus:ring-0 focus-visible:outline-none",style:{backgroundColor:"note"===te.theme.name?"#fffaf1":"glassmorphism"===te.theme.name?"rgba(255,255,255,0.5)":"dark"===te.theme.name?"rgba(255,255,255,0.05)":"minimalist"===te.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:"note"===te.theme.name?"#e6cda4":te.border,borderWidth:"1px",borderStyle:"solid",color:te.textPrimary,boxShadow:"none",outline:"none"}})]}),t.jsx("div",{className:"flex flex-col items-center justify-center pt-6",children:t.jsx(b,{children:t.jsxs(p,{children:[t.jsx(v,{asChild:!0,children:t.jsx("button",{onClick:async()=>{if(!ut||ut.trim().length<10)Q({title:"Insufficient content",description:"Please paste at least 10 characters in the 'Before' box.",variant:"destructive"});else{pt(!0);try{const e=_t();console.log("âœ¨ Requesting improvement for pasted text");const{data:t,error:r}=await B.functions.invoke("grammar-feedback",{body:{writing:ut,taskType:1===oe?"Task 1 - Data Description":"Task 2 - Essay Writing",taskNumber:oe,targetLanguage:"en"!==De?De:void 0,taskInstructions:(null==e?void 0:e.instructions)||"",mode:"improve"}});if(r)throw console.error("âŒ Improvement error:",r),r;if(!t)throw new Error("No response data received from improvement service");if(!t.success||!t.improved){const e=t.error||t.details||"Failed to improve writing";throw console.error("âŒ Improvement failed:",e),new Error(e)}gt(t.improved),Q({title:"Improved! âœ¨",description:"Your improved text is ready in the 'After' box."})}catch(e){console.error("âŒ Improvement catch error:",e);let t="Failed to improve writing. Please try again.";(null==e?void 0:e.message)&&(t=e.message),Q({title:"Error",description:t,variant:"destructive",duration:5e3})}finally{pt(!1)}}},disabled:bt||!ut.trim(),className:"px-2 py-1 transition-all hover:translate-x-0.5 disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:translate-x-0 focus:outline-none focus:ring-0",style:{backgroundColor:"transparent",color:"note"===te.theme.name?"#8b7355":te.textPrimary,border:"none",boxShadow:"none",outline:"none"},children:bt?t.jsx(T,{className:"w-5 h-5 animate-spin"}):t.jsx(I,{className:"w-5 h-5"})})}),t.jsx(y,{children:t.jsx("p",{children:"Improve text"})})]})})}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-semibold invisible",children:"Placeholder"}),ft.trim()&&t.jsxs("button",{onClick:async()=>{try{await navigator.clipboard.writeText(ft),Q({title:"Copied",description:"Improved text copied to clipboard."})}catch(e){Q({title:"Copy failed",description:"Please copy manually.",variant:"destructive"})}},className:"text-xs flex items-center gap-1 px-2 py-1 rounded-md transition-colors hover:bg-black/5",style:{color:"note"===te.theme.name?"#8b7355":te.textSecondary},children:[t.jsx(E,{className:"w-3 h-3"}),"Copy"]})]}),t.jsx(g,{value:ft,readOnly:!0,placeholder:"Improved text will appear here...",className:"min-h-[120px] text-sm leading-relaxed resize-none rounded-xl focus-visible:ring-0 focus:ring-0 focus-visible:outline-none",style:{backgroundColor:"note"===te.theme.name?"#fffaf1":"glassmorphism"===te.theme.name?"rgba(255,255,255,0.5)":"dark"===te.theme.name?"rgba(255,255,255,0.05)":"minimalist"===te.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:"note"===te.theme.name?"#e6cda4":te.border,borderWidth:"1px",borderStyle:"solid",color:te.textPrimary,boxShadow:"none",outline:"none"}})]})]})}),t.jsx("div",{className:"mt-4 max-w-3xl mx-auto w-full",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"flex items-center justify-between mb-2",children:t.jsx("span",{className:"text-sm font-semibold",style:{color:"note"===te.theme.name?"#8b7355":te.textSecondary},children:"Answer Improve"})}),t.jsx(g,{value:vt,onChange:e=>yt(e.target.value),placeholder:"Paste your answer here for full enhancement...",className:"min-h-[120px] text-sm leading-relaxed resize-none rounded-xl focus-visible:ring-0 focus:ring-0 focus-visible:outline-none",style:{backgroundColor:"note"===te.theme.name?"#fffaf1":"glassmorphism"===te.theme.name?"rgba(255,255,255,0.5)":"dark"===te.theme.name?"rgba(255,255,255,0.05)":"minimalist"===te.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:"note"===te.theme.name?"#e6cda4":te.border,borderWidth:"1px",borderStyle:"solid",color:te.textPrimary,boxShadow:"none",outline:"none"}})]}),t.jsx("div",{className:"flex flex-col items-center justify-center pt-6",children:t.jsx(b,{children:t.jsxs(p,{children:[t.jsx(v,{asChild:!0,children:t.jsx("button",{onClick:async()=>{if(!vt||vt.trim().length<10)Q({title:"Insufficient content",description:"Please paste at least 10 characters in the box.",variant:"destructive"});else{Nt(!0);try{const e=_t();console.log("âœ¨ Requesting full answer improvement for pasted text");const{data:t,error:r}=await B.functions.invoke("grammar-feedback",{body:{writing:vt,taskType:1===oe?"Task 1 - Data Description":"Task 2 - Essay Writing",taskNumber:oe,targetLanguage:"en"!==De?De:void 0,taskInstructions:(null==e?void 0:e.instructions)||"",mode:"full-improve"}});if(r)throw console.error("âŒ Answer improvement error:",r),r;if(!t)throw new Error("No response data received from improvement service");if(!t.success||!t.improved){const e=t.error||t.details||"Failed to improve answer";throw console.error("âŒ Answer improvement failed:",e),new Error(e)}jt(t.improved),Q({title:"Answer Enhanced! âœ¨",description:"Your improved answer is ready."})}catch(e){console.error("âŒ Answer improvement catch error:",e);let t="Failed to improve answer. Please try again.";(null==e?void 0:e.message)&&(t=e.message),Q({title:"Error",description:t,variant:"destructive",duration:5e3})}finally{Nt(!1)}}},disabled:wt||!vt.trim(),className:"px-2 py-1 transition-all hover:translate-x-0.5 disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:translate-x-0 focus:outline-none focus:ring-0",style:{backgroundColor:"transparent",color:"note"===te.theme.name?"#8b7355":te.textPrimary,border:"none",boxShadow:"none",outline:"none"},children:wt?t.jsx(T,{className:"w-5 h-5 animate-spin"}):t.jsx(I,{className:"w-5 h-5"})})}),t.jsx(y,{children:t.jsx("p",{children:"Enhance answer (vocab, grammar, structure)"})})]})})}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-semibold invisible",children:"Placeholder"}),kt.trim()&&t.jsxs("button",{onClick:async()=>{try{await navigator.clipboard.writeText(kt),Q({title:"Copied",description:"Enhanced answer copied to clipboard."})}catch(e){Q({title:"Copy failed",description:"Please copy manually.",variant:"destructive"})}},className:"text-xs flex items-center gap-1 px-2 py-1 rounded-md transition-colors hover:bg-black/5",style:{color:"note"===te.theme.name?"#8b7355":te.textSecondary},children:[t.jsx(E,{className:"w-3 h-3"}),"Copy"]})]}),t.jsx(g,{value:kt,readOnly:!0,placeholder:"Enhanced answer will appear here...",className:"min-h-[120px] text-sm leading-relaxed resize-none rounded-xl focus-visible:ring-0 focus:ring-0 focus-visible:outline-none",style:{backgroundColor:"note"===te.theme.name?"#fffaf1":"glassmorphism"===te.theme.name?"rgba(255,255,255,0.5)":"dark"===te.theme.name?"rgba(255,255,255,0.05)":"minimalist"===te.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:"note"===te.theme.name?"#e6cda4":te.border,borderWidth:"1px",borderStyle:"solid",color:te.textPrimary,boxShadow:"none",outline:"none"}})]})]})}),t.jsx("div",{className:"mt-6",children:(1===oe&&et||2===oe&&st)&&t.jsx(R,{feedback:1===oe?et:st,improved:1===oe?rt:lt})}),t.jsx(c,{variant:"outline",size:"sm",onClick:()=>K("/ielts/writing"),className:"fixed bottom-6 left-6 z-50 rounded-xl",style:{backgroundColor:"glassmorphism"===te.theme.name?"rgba(255,255,255,0.9)":"dark"===te.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===te.theme.name?"#ffffff":te.theme.colors.cardBackground,borderColor:te.border,color:te.textPrimary},children:"Exit"}),t.jsxs("div",{className:"fixed bottom-6 right-3 sm:bottom-6 sm:right-6 z-50",children:[Ie&&t.jsxs(x,{className:"backdrop-blur-md rounded-3xl w-[260px] h-[360px] sm:w-96 sm:h-[500px] shadow-2xl flex flex-col transform-gpu origin-bottom-right transition-all duration-260 ease-in-out "+(We?"opacity-100 scale-100 translate-y-0":"opacity-0 scale-75 translate-y-8"),style:{backgroundColor:"glassmorphism"===te.theme.name?"rgba(255,255,255,0.95)":"dark"===te.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===te.theme.name?"#ffffff":te.theme.colors.cardBackground,borderColor:te.border,backdropFilter:"glassmorphism"===te.theme.name?"blur(12px)":"dark"===te.theme.name?"blur(8px)":"none",...te.cardStyle},children:[t.jsx(W,{className:"pb-1 sm:pb-2 rounded-t-3xl relative",children:t.jsx("div",{className:"absolute top-1.5 right-1.5 sm:top-2 sm:right-2",children:t.jsx(c,{variant:"ghost",size:"icon",onClick:()=>{Ae(!1),setTimeout(()=>Ee(!1),260)},className:"h-7 w-7 sm:h-8 sm:w-8 p-0",style:{color:te.textPrimary},children:"âœ•"})})}),t.jsxs(u,{className:"flex-1 flex flex-col px-2.5 py-2 sm:p-4 overflow-hidden",children:[t.jsx(F,{className:"flex-1 min-h-0",children:t.jsx(z,{className:"flex-1 min-h-0",children:0!==Bt().length||Se?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"rounded-lg p-3 mb-4",style:{backgroundColor:"glassmorphism"===te.theme.name?"rgba(255,255,255,0.1)":"dark"===te.theme.name?"rgba(255,255,255,0.05)":"minimalist"===te.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:te.border,borderWidth:"1px",borderStyle:"solid"},children:t.jsx("div",{className:"text-[10px] sm:text-sm whitespace-pre-wrap",style:{color:te.textSecondary},children:(null==$t?void 0:$t.title)||(1===oe?"Letter Writing":"Essay Writing")})}),Bt().map(e=>t.jsxs(q,{from:"user"===e.type?"user":"assistant",children:["bot"===e.type&&t.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"52px",height:"52px",flexShrink:0},children:t.jsx("img",{src:"/1000031289.png",alt:"Catie",style:{width:"100%",height:"100%",objectFit:"cover"}})}),t.jsx(H,{children:t.jsx("div",{className:"px-3 py-2 rounded-xl text-sm",style:{backgroundColor:"glassmorphism"===te.theme.name?"rgba(255,255,255,0.1)":"dark"===te.theme.name?"rgba(255,255,255,0.05)":"minimalist"===te.theme.name?"#f9fafb":"rgba(255,255,255,0.5)",borderColor:te.border,borderWidth:"1px",borderStyle:"solid",color:te.textPrimary},children:t.jsx(M,{dangerouslySetInnerHTML:{__html:e.content.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/^â€¢ (.*)$/gm,"<li>$1</li>").replace(/(<li>.*<\/li>)/s,"<ul>$1</ul>").replace(/\n/g,"<br>")}})})}),"user"===e.type&&(null==ee?void 0:ee.avatar_url)&&t.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"52px",height:"52px",flexShrink:0},children:t.jsx("img",{src:ee.avatar_url,alt:"Your avatar",style:{width:"100%",height:"100%",objectFit:"cover"}})})]},e.id)),Se&&t.jsxs(q,{from:"assistant",children:[t.jsx(H,{children:t.jsx("div",{className:"px-3 py-2 rounded-xl text-sm",style:{backgroundColor:"glassmorphism"===te.theme.name?"rgba(255,255,255,0.1)":"dark"===te.theme.name?"rgba(255,255,255,0.05)":"minimalist"===te.theme.name?"#f9fafb":"rgba(255,255,255,0.5)",borderColor:te.border,borderWidth:"1px",borderStyle:"solid"},children:t.jsx(U,{text:"Thinking..."})})}),t.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"52px",height:"52px"},children:t.jsx("img",{src:"/1000031289.png",alt:"Catie",style:{width:"100%",height:"100%",objectFit:"cover"}})})]}),t.jsx("div",{ref:ht})]}):t.jsx(D,{icon:t.jsx($,{className:"size-9 sm:size-12",style:{color:te.textSecondary}}),title:"Start a conversation",description:"Ask for help with your IELTS writing practice"})})}),t.jsx("div",{className:"flex-shrink-0 mt-2.5 sm:mt-4",children:t.jsxs("div",{className:"flex gap-1.5 sm:gap-2",children:[t.jsx("input",{type:"text",value:Ne,onChange:e=>Ce(e.target.value),onKeyPress:e=>"Enter"===e.key&&!Se&&Ne.trim()&&Ft(),placeholder:"Ask for writing help...",className:"flex-1 px-2.5 py-1.5 sm:px-3 sm:py-2 rounded-lg text-[10px] sm:text-sm focus:outline-none focus:ring-0 resize-none",style:{backgroundColor:"glassmorphism"===te.theme.name?"rgba(255,255,255,0.1)":"dark"===te.theme.name?"rgba(255,255,255,0.05)":"minimalist"===te.theme.name?"#ffffff":te.theme.colors.cardBackground,borderColor:te.border,borderWidth:"1px",borderStyle:"solid",color:te.textPrimary},disabled:Se}),t.jsx("style",{dangerouslySetInnerHTML:{__html:`\n                      input[placeholder="Ask for writing help..."]::placeholder {\n                        color: ${te.textSecondary};\n                      }\n                    `}}),t.jsx(c,{onClick:()=>Ft(),disabled:Se||!Ne.trim(),variant:"ghost",size:"icon",className:"h-7 w-7 sm:h-8 sm:w-8 p-0",style:{color:te.textPrimary},children:Se?t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2",style:{borderColor:te.textPrimary}}):t.jsx(A,{className:"w-4 h-4"})})]})})]})]}),!Ie&&t.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"64px",height:"64px",cursor:"pointer",boxShadow:"0 8px 20px rgba(0,0,0,0.18)",transition:"transform 0.22s ease-out, box-shadow 0.22s ease-out"},onClick:()=>{Ee(!0),requestAnimationFrame(()=>Ae(!0))},onMouseEnter:e=>{const t=e.currentTarget;t.style.transform="scale(1.06) translateY(-2px)",t.style.boxShadow="0 14px 30px rgba(0,0,0,0.24)"},onMouseLeave:e=>{const t=e.currentTarget;t.style.transform="scale(1.0) translateY(0px)",t.style.boxShadow="0 10px 25px rgba(0,0,0,0.15)"},children:t.jsx("img",{src:"/1000031289.png",alt:"Catie",style:{width:"100%",height:"100%",objectFit:"cover"}})})]}),Pe&&t.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 flex items-center justify-center",children:t.jsx("div",{className:"bg-card p-8 rounded-3xl shadow-xl border border-border",children:t.jsx(m,{message:"Analyzing your writing with AI examiner...",subMessage:"Please wait while we evaluate your IELTS writing",size:200})})})]})})})}),Qe&&t.jsx("style",{children:'\n          /* Prominent underline for spell check errors */\n          textarea[spellcheck="true"]::spelling-error {\n            text-decoration: wavy underline rgba(239, 68, 68, 0.8) 2px !important;\n            text-decoration-skip-ink: none !important;\n          }\n\n          textarea[spellcheck="true"]:focus::spelling-error {\n            text-decoration: wavy underline rgba(239, 68, 68, 0.9) 2px !important;\n          }\n        '})]}):t.jsx(d,{title:"IELTS Writing Test",showBackButton:!0,children:t.jsx("div",{className:"flex items-center justify-center min-h-96",children:t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-lg text-foreground mb-4",children:"Task data not available"}),t.jsx(c,{onClick:()=>K("/ielts-portal"),variant:"outline",children:"Back to Portal"})]})})});var qt};export{Y as default};
