import{al as e,j as t,ar as r,u as a,g as s,A as i,ak as l,r as n,be as o,_ as d,bf as m,B as c,ap as u,a as h,C as x,a0 as b,T as g,a9 as p,ab as f,S as y,o as v,p as k,q as w,s as j,au as N,bg as C,bh as S,as as _,bi as T,ae as P,b as A,a8 as W}from"./index-C-1CDflk.js";import{S as E}from"./switch-CpvosfxQ.js";import{s as I}from"./supabase-DUkWVuqu.js";import{F as D,C as z,a as B,b as L,O as F,M as $,c as q,R as H,S as G}from"./shimmering-text-BbmOGCtP.js";const M=({feedback:r,improved:a})=>{const s=e();return r?t.jsxs("div",{className:"mt-4 space-y-4",children:[t.jsxs("div",{className:"p-4 rounded-lg border",style:{backgroundColor:"dark"===s.theme.name?"rgba(255,255,255,0.05)":"minimalist"===s.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:s.border},children:[t.jsx("h4",{className:"font-semibold mb-2",style:{color:s.textPrimary},children:"Grammar Feedback:"}),t.jsx("div",{className:"text-sm whitespace-pre-wrap",style:{color:s.textPrimary},children:r})]}),a&&t.jsxs("div",{className:"p-4 rounded-lg border",style:{backgroundColor:"dark"===s.theme.name?"rgba(255,255,255,0.05)":"minimalist"===s.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:s.border},children:[t.jsx("h4",{className:"font-semibold mb-2",style:{color:s.textPrimary},children:"Improved Version:"}),t.jsx("div",{className:"text-sm whitespace-pre-wrap",style:{color:s.textPrimary},children:a})]})]}):null},R=()=>{var R,U,O,Y,K;const{testId:V}=r(),X=a(),{toast:Q}=s(),{user:J,profile:Z}=i(),ee=e();l();const[te,re]=n.useState(null),[ae,se]=n.useState(null),[ie,le]=n.useState(null),[ne,oe]=n.useState(1),[de,me]=n.useState(""),[ce,ue]=n.useState(""),[he,xe]=n.useState("intro"),[be,ge]=n.useState(""),[pe,fe]=n.useState(""),[ye,ve]=n.useState(""),[ke,we]=n.useState("intro"),[je,Ne]=n.useState(""),[Ce,Se]=n.useState(""),[_e,Te]=n.useState(""),[Pe,Ae]=n.useState(""),[We,Ee]=n.useState([]),[Ie,De]=n.useState(!1),[ze,Be]=n.useState(!1),[Le,Fe]=n.useState([{id:"1",type:"bot",content:"Hello! I'm Catie, your expert IELTS Writing tutor. I'm here to help you with General Training Task 1 - Letter Writing. I'll guide you through writing formal, semi-formal, or informal letters with proper structure and tone. What would you like help with?",timestamp:new Date}]),[$e,qe]=n.useState([{id:"1",type:"bot",content:"Hello! I'm Catie, your expert IELTS Writing tutor. I'm here to help you with Task 2 - Essay Writing. I'll guide you through structuring arguments, developing ideas, and presenting your opinion clearly. What would you like help with?",timestamp:new Date}]),[He,Ge]=n.useState(""),[Me,Re]=n.useState(!1),[Ue,Oe]=n.useState(!1);n.useState(!1),n.useState(!1);const[Ye,Ke]=n.useState(!1),[Ve,Xe]=n.useState(!1),[Qe,Je]=n.useState(1),[Ze,et]=n.useState("center"),[tt,rt]=n.useState("en"),[at,st]=n.useState("gemini-2.5-flash"),[it]=o(),lt=it.get("training"),[nt,ot]=n.useState([]),[dt,mt]=n.useState(0),[ct,ut]=n.useState(!1),[ht,xt]=n.useState(0),[bt,gt]=n.useState(!1),[pt,ft]=n.useState(!1),[yt,vt]=n.useState(null),[kt,wt]=n.useState(null),[jt,Nt]=n.useState(null),[Ct,St]=n.useState(null),[_t,Tt]=n.useState(!1),[Pt,At]=n.useState(!1);n.useEffect(()=>{if(1===ne&&"viewAll"!==he){const e=[be.trim(),pe.trim(),ye.trim()].filter(e=>e).join("\n\n");e&&e!==de&&me(e)}},[be,pe,ye,ne,he]),n.useEffect(()=>{if(2===ne&&"viewAll"!==ke){const e=[je.trim(),Ce.trim(),_e.trim(),Pe.trim()].filter(e=>e).join("\n\n");e&&e!==ce&&ue(e)}},[je,Ce,_e,Pe,ne,ke]),n.useEffect(()=>{var e,t,r;if(1===ne&&"viewAll"===he&&de){const a=de.split("\n\n");ge((null==(e=a[0])?void 0:e.trim())||""),fe((null==(t=a[1])?void 0:t.trim())||""),ve((null==(r=a[2])?void 0:r.trim())||"")}},[de,ne,he]),n.useEffect(()=>{var e,t,r,a;if(2===ne&&"viewAll"===ke&&ce){const s=ce.split("\n\n");Ne((null==(e=s[0])?void 0:e.trim())||""),Se((null==(t=s[1])?void 0:t.trim())||""),Te((null==(r=s[2])?void 0:r.trim())||""),Ae((null==(a=s[3])?void 0:a.trim())||"")}},[ce,ne,ke]),n.useEffect(()=>{if(!V)return;const e=`ielts-writing-draft-${V}-task1`,t=`ielts-writing-draft-${V}-task2`,r=localStorage.getItem(e),a=localStorage.getItem(t);r&&!de&&me(r),a&&!ce&&ue(a)},[V]),n.useEffect(()=>{V&&localStorage.setItem(`ielts-writing-draft-${V}-task1`,de)},[de,V]),n.useEffect(()=>{V&&localStorage.setItem(`ielts-writing-draft-${V}-task2`,ce)},[ce,V]),n.useEffect(()=>{let e;return ct&&dt>0&&(e=setInterval(()=>{mt(e=>e<=1?(ut(!1),0):e-1),xt(e=>e+1e3)},1e3)),()=>{e&&clearInterval(e)}},[ct,dt]),n.useEffect(()=>{if(lt&&We.length>0){const e=We.filter(e=>e.test_subtype===lt||!e.test_subtype&&"Academic"===lt);ot(e)}else ot(We)},[lt,We]),n.useEffect(()=>{V?Wt():Et()},[V]);const Wt=async()=>{Be(!0);try{if(!V)throw new Error("Test ID is required");const[e,t]=await Promise.all([I.from("tests").select("id, test_name, test_type, module, skill_category, test_subtype").eq("id",V).maybeSingle(),I.from("questions").select("id, test_id, part_number, question_text, passage_text, image_url, explanation, transcription").eq("test_id",V).in("part_number",[1,2]).order("part_number")]);if(e.error)throw e.error;if(t.error)throw t.error;const r=e.data;if(!r)throw new Error("Test not found");re(r);const a=t.data||[],s=a.find(e=>1===e.part_number),i=a.find(e=>2===e.part_number);if(null==s?void 0:s.image_url){(new Image).src=s.image_url}const l=s?{id:s.id,title:s.question_text||"Task 1 - Data Description",instructions:s.passage_text||"",imageUrl:s.image_url||"",imageContext:s.explanation||"",modelAnswer:s.transcription||""}:{id:"default-task1",title:"Task 1 - Data Description",instructions:"Task 1 question not found. Please contact support.",imageUrl:"",imageContext:"",modelAnswer:""},n=i?{id:i.id,title:i.question_text||"Task 2 - Essay Writing",instructions:i.passage_text||"",modelAnswer:i.transcription||""}:{id:"default-task2",title:"Task 2 - Essay Writing",instructions:"Task 2 question not found. Please contact support.",modelAnswer:""};se(l),le(n)}catch(e){const t=(null==e?void 0:e.message)||"Failed to load test data. Please try again.";Q({title:"Error",description:t,variant:"destructive"}),re(null),se(null),le(null)}finally{Be(!1)}},Et=async()=>{De(!0);try{const{data:e,error:t}=await I.from("tests").select("id, test_name, test_type, module, skill_category, test_subtype, created_at").eq("test_type","IELTS").or("module.ilike.Writing,skill_category.ilike.Writing,test_name.ilike.%Writing%").order("created_at",{ascending:!1}).limit(50);if(t)throw t;const r=(e||[]).filter(e=>e&&e.id&&(e.test_name||e.module||e.skill_category));Ee(r)}catch(e){Q({title:"Error",description:"Failed to load available writing tests. Please try again.",variant:"destructive"}),Ee([])}finally{De(!1)}},It=()=>1===ne?ae:ie,Dt=()=>{if(1===ne){if(("Academic"===(null==te?void 0:te.test_subtype)||"Academic"===lt)&&!_t)switch(he){case"intro":return be;case"body1":return pe;case"body2":return ye;default:return de}return de}if(("Academic"===(null==te?void 0:te.test_subtype)||"Academic"===lt)&&!Pt)switch(ke){case"intro":return je;case"body1":return Ce;case"body2":return _e;case"conclusion":return Pe;default:return ce}return ce},zt=e=>{const t=e.target.value;1===ne?me(t):ue(t)},Bt=e=>{if(1===ne)if("Academic"!==(null==te?void 0:te.test_subtype)&&"Academic"!==lt||_t)me(e);else switch(he){case"intro":ge(e);break;case"body1":fe(e);break;case"body2":ve(e);break;case"viewAll":break;default:me(e)}else if("Academic"!==(null==te?void 0:te.test_subtype)&&"Academic"!==lt||Pt)ue(e);else switch(ke){case"intro":Ne(e);break;case"body1":Se(e);break;case"body2":Te(e);break;case"conclusion":Ae(e);break;case"viewAll":break;default:ue(e)}},Lt=e=>e.trim().split(/\s+/).filter(e=>e.length>0).length,Ft=()=>1===ne?"Academic"!==(null==te?void 0:te.test_subtype)&&"Academic"!==lt||_t?Lt(de):Lt(be)+Lt(pe)+Lt(ye):"Academic"!==(null==te?void 0:te.test_subtype)&&"Academic"!==lt||Pt?Lt(ce):Lt(je)+Lt(Ce)+Lt(_e)+Lt(Pe),$t=()=>1===ne?150:250,qt=()=>Ue||(_t||!de.trim())&&(Pt||!ce.trim())||!_t&&de.trim()&&Lt(de)<150||!Pt&&ce.trim()&&Lt(ce)<250||!_t&&!de.trim()||!Pt&&!ce.trim(),Ht=async(e=0)=>{var t,r,a,s,i,l,n;const o=Dt();if(!o||o.trim().length<10)Q({title:"Insufficient content",description:"Please write at least 10 characters before requesting grammar feedback.",variant:"destructive"});else{ft(!0);try{It();console.log("üìù Requesting grammar feedback for Task",ne,e>0?`(retry ${e})`:"");const i=I.functions.invoke("grammar-feedback",{body:{writing:o,taskType:1===ne?"Task 1 - Data Description":"Task 2 - Essay Writing",taskNumber:ne,targetLanguage:"en"!==tt?tt:void 0}}),l=new Promise((e,t)=>{setTimeout(()=>{t(new Error("Request timeout - the grammar check is taking too long. Please try again."))},3e4)}),n=await Promise.race([i,l]),{data:d,error:m}=n;if(console.log("üì• Grammar feedback response:",{data:d,error:m}),m){console.error("‚ùå Grammar feedback error:",m);if(((null==(t=null==m?void 0:m.message)?void 0:t.includes("ERR_CONNECTION_CLOSED"))||(null==(r=null==m?void 0:m.message)?void 0:r.includes("Failed to send a request"))||(null==(a=null==m?void 0:m.message)?void 0:a.includes("network"))||(null==(s=null==m?void 0:m.message)?void 0:s.includes("timeout"))||"FunctionsFetchError"===(null==m?void 0:m.name))&&e<2)return console.log(`üîÑ Retrying grammar feedback request (attempt ${e+1}/3)...`),await new Promise(t=>setTimeout(t,1e3*(e+1))),Ht(e+1);throw m}if(!d)throw new Error("No response data received from grammar feedback service");if(!d.success||!d.feedback){const e=d.error||d.details||"Failed to get grammar feedback";throw console.error("‚ùå Grammar feedback failed:",e),new Error(e)}{1===ne?(vt(d.feedback),wt(d.improved||null)):(Nt(d.feedback),St(d.improved||null));const e=Q({title:"Grammar feedback ready",description:"Grammar analysis completed. Check the feedback below."});setTimeout(()=>{e.dismiss()},1e3)}}catch(d){console.error("‚ùå Grammar feedback catch error:",d);let e="Failed to get grammar feedback. Please try again.";(null==(i=null==d?void 0:d.message)?void 0:i.includes("timeout"))?e="The grammar check is taking too long. Please try again in a moment.":(null==(l=null==d?void 0:d.message)?void 0:l.includes("ERR_CONNECTION_CLOSED"))||(null==(n=null==d?void 0:d.message)?void 0:n.includes("Failed to send a request"))?e="Connection error. Please check your internet connection and try again.":(null==d?void 0:d.message)?e=d.message:(null==d?void 0:d.error)&&(e=d.error),Q({title:"Error",description:e,variant:"destructive",duration:5e3})}finally{ft(!1)}}},Gt=()=>1===ne?Le:$e,Mt=e=>{1===ne?Fe(e):qe(e)},Rt=async e=>{var t;const r=He.trim();if(!r||Me)return;const a={id:Date.now().toString(),type:"user",content:r,timestamp:new Date};Mt(e=>[...e,a]),Ge(""),Re(!0);try{const e=It();if(!e)throw new Error("No task data available");let t=`CONTEXT: The student is working on IELTS Writing Task ${ne}.\n\n**Task ${ne} Details:**\n- Prompt: "${e.title}"\n- Instructions: "${e.instructions.substring(0,300)}${e.instructions.length>300?"...":""}"`;t+=1===ne?"\n- Task Type: Data Description (charts, graphs, tables, diagrams)":"\n- Task Type: Essay Writing (present arguments, opinions with examples)",t+=`\n\n**Student's Question:** "${r}"\n\nPlease provide context-aware guidance. If they ask "How do I start?", guide them with leading questions about the specific task. Never write content for them - help them think it through.`;const{data:a,error:s}=await I.functions.invoke("openai-chat",{body:{message:t,context:"catbot",imageContext:e.imageContext,taskType:1===ne?"Task 1 - Data Description (charts, graphs, tables, diagrams)":"Task 2 - Essay Writing (arguments, opinions, examples)",taskInstructions:e.instructions}});if(s)throw s;const i={id:(Date.now()+1).toString(),type:"bot",content:a.response,timestamp:new Date};Mt(e=>[...e,i])}catch(s){let e="Connection Issue",r="Failed to get response from Catie. Please try again.";(null==(t=null==s?void 0:s.message)?void 0:t.includes("service temporarily unavailable"))||503===(null==s?void 0:s.statusCode)?(e="Service Update",r="Catie is being updated! Please try again in a moment."):429===(null==s?void 0:s.statusCode)&&(e="High Traffic",r="Lots of students are getting help! Please wait a moment and try again."),Q({title:e,description:r,variant:"destructive"})}finally{Re(!1)}},Ut=e=>{oe(e)},Ot=async()=>{var e,t,r,a,s,i,l,n,o,d,m,c,u,h,x,b,g,p,f,y,v,k,w,j,N,C,S,_,T,P,A,W,E,D;const z=!_t&&de.trim(),B=!Pt&&ce.trim();if(!z&&!B)return void Q({title:"Please complete at least one task",description:"You need to complete at least Task 1 or Task 2 to submit (or skip one)",variant:"destructive"});const L=Lt(de),F=Lt(ce);if(!_t){if(!de.trim())return void Q({title:"Task 1 is required",description:"Please complete Task 1 or skip it before submitting.",variant:"destructive"});if(L<150)return void Q({title:"Task 1 word count too low",description:`Task 1 requires a minimum of 150 words. You currently have ${L} words.`,variant:"destructive"})}if(!Pt){if(!ce.trim())return void Q({title:"Task 2 is required",description:"Please complete Task 2 or skip it before submitting.",variant:"destructive"});if(F<250)return void Q({title:"Task 2 word count too low",description:`Task 2 requires a minimum of 250 words. You currently have ${F} words.`,variant:"destructive"})}Oe(!0);try{const[z]=await Promise.all([I.functions.invoke("ielts-writing-examiner",{body:{task1Answer:!_t&&de.trim()?de.trim():null,task2Answer:!Pt&&ce.trim()?ce.trim():null,task1Data:!_t&&de.trim()?ae:null,task2Data:!Pt&&ce.trim()?ie:null,targetLanguage:"en"!==tt?tt:void 0,model:at}})]);if(z.error)throw z.error;const{structured:B,feedback:L,task1WordCount:F,task2WordCount:$}=z.data,q=!_t&&de.trim()?F||Lt(de):0,H=!Pt&&ce.trim()?$||Lt(ce):0,{data:G,error:M}=await I.from("test_results").insert({user_id:null==J?void 0:J.id,test_type:"writing",score_percentage:Math.round(10*((null==(e=null==B?void 0:B.overall)?void 0:e.band)??(((null==(t=null==B?void 0:B.task1)?void 0:t.overall_band)??7)+2*((null==(r=null==B?void 0:B.task2)?void 0:r.overall_band)??7))/3)),time_taken:Math.floor(ht/1e3),completed_at:(new Date).toISOString(),test_data:{task1Data:ae?{id:ae.id,title:ae.title,instructions:ae.instructions,imageUrl:ae.imageUrl,imageContext:ae.imageContext,modelAnswer:ae.modelAnswer}:null,task2Data:ie?{id:ie.id,title:ie.title,instructions:ie.instructions,modelAnswer:ie.modelAnswer}:null,task1Answer:!_t&&de.trim()?de.trim():null,task2Answer:!Pt&&ce.trim()?ce.trim():null,overall_band:(null==(a=null==B?void 0:B.overall)?void 0:a.band)||7}}).select().single();if(M)throw M;if(!_t&&de.trim()){const{error:e}=await I.from("writing_test_results").insert({user_id:null==J?void 0:J.id,test_result_id:G.id,task_number:1,prompt_text:(null==ae?void 0:ae.instructions)||(null==ae?void 0:ae.title)||"",user_response:de,word_count:q,band_scores:{task_achievement:(null==(l=null==(i=null==(s=null==B?void 0:B.task1)?void 0:s.criteria)?void 0:i.task_achievement)?void 0:l.band)??null,coherence_and_cohesion:(null==(d=null==(o=null==(n=null==B?void 0:B.task1)?void 0:n.criteria)?void 0:o.coherence_and_cohesion)?void 0:d.band)??null,lexical_resource:(null==(u=null==(c=null==(m=null==B?void 0:B.task1)?void 0:m.criteria)?void 0:c.lexical_resource)?void 0:u.band)??null,grammatical_range_and_accuracy:(null==(b=null==(x=null==(h=null==B?void 0:B.task1)?void 0:h.criteria)?void 0:x.grammatical_range_and_accuracy)?void 0:b.band)??null},detailed_feedback:(null==(g=null==B?void 0:B.task1)?void 0:g.feedback_markdown)||"",improvement_suggestions:(null==(f=null==(p=null==B?void 0:B.task1)?void 0:p.feedback)?void 0:f.improvements)||[]});if(e)throw e}if(!Pt&&ce.trim()){const{error:e}=await I.from("writing_test_results").insert({user_id:null==J?void 0:J.id,test_result_id:G.id,task_number:2,prompt_text:(null==ie?void 0:ie.instructions)||(null==ie?void 0:ie.title)||"",user_response:ce,word_count:H,band_scores:{task_response:(null==(k=null==(v=null==(y=null==B?void 0:B.task2)?void 0:y.criteria)?void 0:v.task_response)?void 0:k.band)??null,coherence_and_cohesion:(null==(N=null==(j=null==(w=null==B?void 0:B.task2)?void 0:w.criteria)?void 0:j.coherence_and_cohesion)?void 0:N.band)??null,lexical_resource:(null==(_=null==(S=null==(C=null==B?void 0:B.task2)?void 0:C.criteria)?void 0:S.lexical_resource)?void 0:_.band)??null,grammatical_range_and_accuracy:(null==(A=null==(P=null==(T=null==B?void 0:B.task2)?void 0:T.criteria)?void 0:P.grammatical_range_and_accuracy)?void 0:A.band)??null},detailed_feedback:(null==(W=null==B?void 0:B.task2)?void 0:W.feedback_markdown)||"",improvement_suggestions:(null==(D=null==(E=null==B?void 0:B.task2)?void 0:E.feedback)?void 0:D.improvements)||[]});if(e)throw e}X("/ielts-writing-results-pro",{state:{testName:null==te?void 0:te.test_name,testId:V,submissionId:G.id,task1Answer:!_t&&de.trim()?de.trim():null,task2Answer:!Pt&&ce.trim()?ce.trim():null,task1Skipped:_t,task2Skipped:Pt,feedback:L,structured:B,task1Data:ae,task2Data:ie,task1WordCount:q,task2WordCount:H}})}catch($){Q({title:"Error",description:(null==$?void 0:$.message)||"Failed to submit test for evaluation",variant:"destructive"})}finally{Oe(!1)}};if(n.useEffect(()=>{ct||(mt(3600),ut(!0))},[ct]),!V){if(Ie)return t.jsx(d,{title:"Writing Tests",children:t.jsx("div",{className:"flex items-center justify-center min-h-96",children:t.jsx("div",{className:"text-center",children:t.jsx(m,{message:"Loading available writing tests...",subMessage:"Please wait",size:150})})})});if(nt.length>0||We.length>0){const e=nt.length>0?nt:We;return t.jsxs("div",{className:"min-h-screen relative",children:[t.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"note"===ee.theme.name||"minimalist"===ee.theme.name||"dark"===ee.theme.name?"none":"url('/1000031207.png')",backgroundColor:ee.backgroundImageColor}}),t.jsx("div",{className:"relative z-10",children:t.jsx(d,{title:"Available Writing Tests",transparentBackground:!0,children:t.jsx("div",{className:"min-h-screen py-12",children:t.jsx("div",{className:"container mx-auto px-4",children:t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsxs("div",{className:"mb-8",children:[t.jsx(c,{variant:"outline",onClick:()=>X("/ielts-portal"),className:"mb-4",children:"‚Üê Back to IELTS Portal"}),t.jsxs("h1",{className:"text-4xl font-bold text-foreground mb-2 text-center",children:["IELTS ",lt||"Writing"," Tests"]})]}),t.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:e.map(e=>e&&e.id?t.jsx(u,{className:"cursor-pointer h-[140px] hover:scale-105 transition-all duration-300 hover:shadow-lg bg-white/80 flex items-center justify-center",onClick:()=>X(`/ielts-writing-test/${e.id}`),children:t.jsx(h,{className:"p-3 md:p-4 text-center flex items-center justify-center h-full",children:t.jsx("h3",{className:"font-semibold text-sm",children:e.test_name||"Untitled Test"})})},e.id):null)})]})})})})})]})}return t.jsx(d,{title:"Writing Tests",children:t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background to-primary/5 py-12",children:t.jsxs("div",{className:"container mx-auto px-4 text-center",children:[t.jsx("h1",{className:"text-4xl font-bold text-foreground mb-4",children:"IELTS Writing Tests"}),t.jsx("p",{className:"text-lg text-muted-foreground mb-8",children:"No writing tests available yet"}),t.jsx(c,{onClick:()=>X("/ielts-portal"),variant:"outline",children:"Back to Portal"})]})})})}if(ze)return t.jsx(d,{title:"IELTS Writing Test",showBackButton:!0,children:t.jsx("div",{className:"flex items-center justify-center min-h-96",children:t.jsx("div",{className:"text-center",children:t.jsx(m,{message:"Loading IELTS Writing test...",subMessage:"Please wait while we fetch your test",size:150})})})});if(V&&(!te||!ae||!ie))return t.jsx(d,{title:"IELTS Writing Test",showBackButton:!0,children:t.jsx("div",{className:"flex items-center justify-center min-h-96",children:t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-lg text-foreground mb-4",children:"Unable to load test"}),t.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:te?ae&&ie?"Unknown error":"Test data is incomplete":"Test not found"}),t.jsx(c,{onClick:()=>X("/ielts-portal"),variant:"outline",children:"Back to Portal"})]})})});const Yt=It();return Dt(),Yt?t.jsxs("div",{className:"min-h-screen relative",style:{backgroundColor:"dark"===ee.theme.name?ee.theme.colors.background:"transparent"},children:[t.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"note"===ee.theme.name||"minimalist"===ee.theme.name||"dark"===ee.theme.name?"none":"url('/1000031207.png')",backgroundColor:ee.backgroundImageColor}}),t.jsx("div",{className:"relative z-10 flex flex-col pb-24 sm:pb-6",style:{backgroundColor:"dark"===ee.theme.name?ee.theme.colors.background:"transparent",minHeight:"calc(100vh - 80px)"},children:t.jsx(d,{title:"IELTS Writing Test",showBackButton:!0,transparentBackground:!0,children:t.jsx("div",{className:"flex-1 flex justify-center py-6 sm:py-6 pb-4",children:t.jsxs("div",{className:"w-full max-w-[1800px] mx-auto space-y-4 px-4 sm:px-6 flex flex-col",children:[t.jsx(x,{className:"rounded-3xl mb-4 max-w-fit mx-auto px-4",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.9)":"dark"===ee.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===ee.theme.name?"#ffffff":ee.theme.colors.cardBackground,borderColor:ee.border,backdropFilter:"glassmorphism"===ee.theme.name?"blur(12px)":"dark"===ee.theme.name?"blur(8px)":"none",boxShadow:"dark"===ee.theme.name?"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)":"note"===ee.theme.name?null==(R=ee.theme.styles.cardStyle)?void 0:R.boxShadow:"0 8px 32px rgba(15, 23, 42, 0.16), 0 0 0 1px rgba(148, 163, 253, 0.06)",...ee.cardStyle},children:t.jsxs(h,{className:"p-2 sm:p-3",children:[t.jsxs("div",{className:"flex items-center justify-center gap-2 sm:gap-3 flex-wrap",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(b,{className:"w-3.5 h-3.5",style:{color:ee.textPrimary}}),t.jsx("span",{className:"text-sm font-medium tabular-nums",style:{color:ee.textPrimary},children:(Kt=dt,`${Math.floor(Kt/60)}:${(Kt%60).toString().padStart(2,"0")}`)})]}),t.jsx(c,{size:"sm",onClick:()=>Ut(1),className:"h-9 sm:h-8 px-4 sm:px-3 text-sm sm:text-sm font-medium min-w-[70px]",style:{backgroundColor:1===ne?ee.buttonPrimary:"transparent",color:1===ne?"#ffffff":ee.textPrimary,border:"none"},children:"Task 1"}),t.jsx(c,{size:"sm",onClick:()=>Ut(2),className:"h-9 sm:h-8 px-4 sm:px-3 text-sm sm:text-sm font-medium min-w-[70px]",style:{backgroundColor:2===ne?ee.buttonPrimary:"transparent",color:2===ne?"#ffffff":ee.textPrimary,border:"none"},children:"Task 2"})]}),(1===ne&&("Academic"===(null==te?void 0:te.test_subtype)||"Academic"===lt)||2===ne&&("Academic"===(null==te?void 0:te.test_subtype)||"Academic"===lt))&&t.jsxs("div",{className:"flex items-center justify-center gap-1.5 sm:gap-2 mt-2 pt-2 border-t flex-wrap",style:{borderColor:ee.border},children:[t.jsx(c,{size:"sm",onClick:()=>{1===ne?xe("intro"):we("intro")},className:"h-8 sm:h-7 px-3 sm:px-2 text-xs sm:text-xs font-medium min-w-[60px]",style:{backgroundColor:"intro"===(1===ne?he:ke)?ee.buttonPrimary:"transparent",color:"intro"===(1===ne?he:ke)?"#ffffff":ee.textPrimary,border:"none"},children:"Intro"}),t.jsx(c,{size:"sm",onClick:()=>{1===ne?xe("body1"):we("body1")},className:"h-8 sm:h-7 px-3 sm:px-2 text-xs sm:text-xs font-medium min-w-[65px]",style:{backgroundColor:"body1"===(1===ne?he:ke)?ee.buttonPrimary:"transparent",color:"body1"===(1===ne?he:ke)?"#ffffff":ee.textPrimary,border:"none"},children:"Body 1"}),t.jsx(c,{size:"sm",onClick:()=>{1===ne?xe("body2"):we("body2")},className:"h-8 sm:h-7 px-3 sm:px-2 text-xs sm:text-xs font-medium min-w-[65px]",style:{backgroundColor:"body2"===(1===ne?he:ke)?ee.buttonPrimary:"transparent",color:"body2"===(1===ne?he:ke)?"#ffffff":ee.textPrimary,border:"none"},children:"Body 2"}),2===ne&&t.jsx(c,{size:"sm",onClick:()=>{we("conclusion")},className:"h-8 sm:h-7 px-3 sm:px-2 text-xs sm:text-xs font-medium min-w-[75px]",style:{backgroundColor:"conclusion"===ke?ee.buttonPrimary:"transparent",color:"conclusion"===ke?"#ffffff":ee.textPrimary,border:"none"},children:"Conclusion"}),t.jsx(c,{size:"sm",onClick:()=>{1===ne?xe("viewAll"):we("viewAll")},className:"h-8 sm:h-7 px-3 sm:px-2 text-xs sm:text-xs font-medium min-w-[70px]",style:{backgroundColor:"viewAll"===(1===ne?he:ke)?ee.buttonPrimary:"transparent",color:"viewAll"===(1===ne?he:ke)?"#ffffff":ee.textPrimary,border:"none"},children:"View All"})]})]})}),1===ne?(null==Yt?void 0:Yt.imageUrl)?t.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 flex-1",style:{minHeight:"400px"},children:[t.jsx("div",{className:"flex-1 lg:flex-[0_0_50%] min-h-0",children:t.jsx(x,{className:"rounded-3xl h-full",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.9)":"dark"===ee.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===ee.theme.name?"#ffffff":ee.theme.colors.cardBackground,borderColor:ee.border,backdropFilter:"glassmorphism"===ee.theme.name?"blur(12px)":"dark"===ee.theme.name?"blur(8px)":"none",boxShadow:"dark"===ee.theme.name?"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)":"note"===ee.theme.name?null==(U=ee.theme.styles.cardStyle)?void 0:U.boxShadow:"0 8px 32px rgba(15, 23, 42, 0.16), 0 0 0 1px rgba(148, 163, 253, 0.06)",...ee.cardStyle,display:"flex",flexDirection:"column"},children:t.jsxs(h,{className:"p-4 flex-1 flex flex-col",style:{minHeight:0},children:[t.jsx("div",{className:"mb-4",children:(null==Yt?void 0:Yt.instructions)&&t.jsx("div",{children:t.jsx("div",{className:"whitespace-pre-wrap leading-relaxed p-3 rounded-lg text-sm sm:text-base",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.1)":"dark"===ee.theme.name?"rgba(255,255,255,0.05)":"minimalist"===ee.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:ee.border,borderWidth:"1px",borderStyle:"solid",color:ee.textPrimary},children:Yt.instructions})})}),t.jsx("div",{className:"flex-1 overflow-hidden",children:t.jsx("img",{src:Yt.imageUrl,alt:"Task 1 visual data",className:"w-full h-full object-contain cursor-pointer",loading:"eager",decoding:"async",onClick:e=>{const t=e.currentTarget.getBoundingClientRect(),r=(e.clientX-t.left)/t.width*100,a=(e.clientY-t.top)/t.height*100;et(`${r}% ${a}%`),Je(1===Qe?1.5:1)},style:{transform:`scale(${Qe})`,transformOrigin:Ze,transition:"transform 0.2s ease-out"}})})]})})}),t.jsx("div",{className:"flex-1 lg:flex-[0_0_50%] min-h-0",children:t.jsx(x,{className:"rounded-3xl h-full",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.9)":"dark"===ee.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===ee.theme.name?"#ffffff":ee.theme.colors.cardBackground,borderColor:ee.border,backdropFilter:"glassmorphism"===ee.theme.name?"blur(12px)":"dark"===ee.theme.name?"blur(8px)":"none",boxShadow:"dark"===ee.theme.name?"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)":"note"===ee.theme.name?null==(O=ee.theme.styles.cardStyle)?void 0:O.boxShadow:"0 8px 32px rgba(15, 23, 42, 0.16), 0 0 0 1px rgba(148, 163, 253, 0.06)",...ee.cardStyle,display:"flex",flexDirection:"column"},children:t.jsxs(h,{className:"flex-1 p-4 flex flex-col",style:{minHeight:0},children:[1!==ne||"Academic"!==(null==te?void 0:te.test_subtype)&&"Academic"!==lt||"viewAll"!==he||_t?t.jsx("div",{className:"flex-1 flex flex-col",style:{minHeight:0},children:t.jsx(g,{value:Dt(),onChange:e=>Bt(e.target.value),onKeyDown:e=>{"Tab"!==e.key||"Academic"!==(null==te?void 0:te.test_subtype)&&"Academic"!==lt||(e.preventDefault(),"intro"===he?xe("body1"):"body1"===he?xe("body2"):"body2"===he&&xe("viewAll"))},className:"h-[calc(100vh-280px)] min-h-[500px] w-full text-base leading-relaxed resize-none rounded-2xl focus:outline-none focus:ring-0",placeholder:_t?"Task 1 is skipped":"General"===(null==te?void 0:te.test_subtype)||"General"===lt?"Write your letter here...":1!==ne||"Academic"!==(null==te?void 0:te.test_subtype)&&"Academic"!==lt?"Write your description here...":"intro"===he?"Write your introduction here...":"body1"===he?"Write your first body paragraph here...":"body2"===he?"Write your second body paragraph here...":"viewAll"===he?"Write your complete Task 1 essay here...":"Write your description here...",spellCheck:bt,disabled:_t,style:{backgroundColor:_t?"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.05)":"dark"===ee.theme.name?"rgba(255,255,255,0.02)":"minimalist"===ee.theme.name?"#f3f4f6":"rgba(255,255,255,0.3)":"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.1)":"dark"===ee.theme.name?"rgba(255,255,255,0.05)":"minimalist"===ee.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:ee.border,color:_t?ee.textSecondary:ee.textPrimary,outline:"none",boxShadow:"none",cursor:_t?"not-allowed":"text",opacity:_t?.6:1}})}):t.jsx("div",{className:"flex-1 flex flex-col",style:{minHeight:0},children:t.jsx(g,{value:Dt(),onChange:zt,placeholder:"Write your complete Task 1 essay here...",className:"h-[calc(100vh-280px)] min-h-[500px] w-full text-base leading-relaxed resize-none rounded-2xl focus:outline-none focus:ring-0",spellCheck:bt,style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.1)":"dark"===ee.theme.name?"rgba(255,255,255,0.05)":"minimalist"===ee.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:ee.border,color:ee.textPrimary,outline:"none",boxShadow:"none"}})}),t.jsxs("div",{className:"flex items-center justify-between gap-3 mt-4 pt-3 border-t flex-shrink-0",style:{borderColor:ee.border},children:[t.jsxs("div",{className:"text-sm font-medium",style:{color:ee.textSecondary},children:[t.jsx("span",{className:Ft()<$t()?"text-red-500":"text-green-600",children:Ft()})," / ",$t()]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(c,{size:"sm",variant:"ghost",onClick:()=>{Tt(!_t),_t||Ut(2)},className:"h-8 px-3 text-sm font-medium hover:bg-transparent",style:{backgroundColor:_t?ee.buttonPrimary:"transparent",color:_t?"#ffffff":ee.textPrimary,border:"none",boxShadow:"none"},children:_t?"Unskip":"Skip"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-medium",style:{color:ee.textPrimary},children:"Spell"}),t.jsx(E,{checked:bt,onCheckedChange:gt,style:{backgroundColor:bt?ee.buttonPrimary:"dark"===ee.theme.name?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"},className:"data-[state=checked]:bg-primary"})]}),t.jsx(c,{size:"sm",variant:"ghost",onClick:()=>Ht(0),disabled:pt||!Dt().trim()||_t,className:"h-8 w-8 p-0 hover:bg-transparent",style:{color:ee.textPrimary},children:pt?t.jsx(p,{className:"w-4 h-4 animate-spin"}):t.jsx(f,{className:"w-4 h-4"})}),t.jsxs(y,{value:tt,onValueChange:rt,children:[t.jsx(v,{className:"w-[90px] h-8 text-sm border-0 bg-transparent shadow-none p-0 focus:ring-0",style:{color:ee.textPrimary,"--tw-ring-color":ee.buttonPrimary},children:t.jsx(k,{placeholder:"Language"})}),t.jsx(w,{children:D.map(e=>t.jsx(j,{value:e.value,children:e.label},e.value))})]})]})]})]})})})]}):t.jsx(x,{className:"rounded-3xl max-w-5xl mx-auto",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.9)":"dark"===ee.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===ee.theme.name?"#ffffff":ee.theme.colors.cardBackground,borderColor:ee.border,backdropFilter:"glassmorphism"===ee.theme.name?"blur(12px)":"dark"===ee.theme.name?"blur(8px)":"none",boxShadow:"dark"===ee.theme.name?"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)":"note"===ee.theme.name?null==(Y=ee.theme.styles.cardStyle)?void 0:Y.boxShadow:"0 8px 32px rgba(15, 23, 42, 0.16), 0 0 0 1px rgba(148, 163, 253, 0.06)",...ee.cardStyle,minHeight:("dark"===ee.theme.name?500:"minimalist"===ee.theme.name?550:"note"===ee.theme.name?580:600)+"px"},children:t.jsxs(h,{className:"p-4 flex flex-col flex-1",children:[(null==Yt?void 0:Yt.instructions)&&t.jsx("div",{className:"mb-4",children:t.jsx("div",{className:"whitespace-pre-wrap leading-relaxed p-3 rounded-lg text-sm",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.1)":"dark"===ee.theme.name?"rgba(255,255,255,0.05)":"minimalist"===ee.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:ee.border,borderWidth:"1px",borderStyle:"solid",color:ee.textPrimary},children:Yt.instructions})}),1!==ne||"Academic"!==(null==te?void 0:te.test_subtype)&&"Academic"!==lt||"viewAll"!==he||_t?t.jsx(g,{value:Dt(),onChange:e=>Bt(e.target.value),onKeyDown:e=>{"Tab"!==e.key||"Academic"!==(null==te?void 0:te.test_subtype)&&"Academic"!==lt||(e.preventDefault(),1===ne?"intro"===he?xe("body1"):"body1"===he?xe("body2"):"body2"===he&&xe("viewAll"):2===ne&&("intro"===ke?we("body1"):"body1"===ke?we("body2"):"body2"===ke?we("conclusion"):"conclusion"===ke&&we("viewAll")))},placeholder:_t?"Task 1 is skipped":"General"===(null==te?void 0:te.test_subtype)||"General"===lt?"Write your letter here...":1!==ne||"Academic"!==(null==te?void 0:te.test_subtype)&&"Academic"!==lt?"Write your description here...":"intro"===he?"Write your introduction here...":"body1"===he?"Write your first body paragraph here...":"body2"===he?"Write your second body paragraph here...":"viewAll"===he?"Write your complete Task 1 essay here...":"Write your description here...",className:"h-[calc(100vh-280px)] min-h-[500px] text-base leading-relaxed resize-none rounded-2xl focus:outline-none focus:ring-0",spellCheck:bt,disabled:_t,style:{backgroundColor:_t?"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.05)":"dark"===ee.theme.name?"rgba(255,255,255,0.02)":"minimalist"===ee.theme.name?"#f3f4f6":"rgba(255,255,255,0.3)":"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.1)":"dark"===ee.theme.name?"rgba(255,255,255,0.05)":"minimalist"===ee.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:ee.border,color:_t?ee.textSecondary:ee.textPrimary,outline:"none",boxShadow:"none",cursor:_t?"not-allowed":"text",opacity:_t?.6:1}}):t.jsxs("div",{className:"h-full overflow-y-auto text-base leading-relaxed whitespace-pre-wrap p-4",style:{color:ee.textPrimary},children:[be&&t.jsxs("div",{className:"mb-6",children:[t.jsx("strong",{children:"Introduction:"}),t.jsx("div",{className:"mt-2",children:be})]}),pe&&t.jsxs("div",{className:"mb-6",children:[t.jsx("strong",{children:"Body Paragraph 1:"}),t.jsx("div",{className:"mt-2",children:pe})]}),ye&&t.jsxs("div",{className:"mb-6",children:[t.jsx("strong",{children:"Body Paragraph 2:"}),t.jsx("div",{className:"mt-2",children:ye})]}),!be&&!pe&&!ye&&t.jsx("div",{style:{color:ee.textSecondary},children:"No content yet..."})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 mt-4 pt-3 border-t",style:{borderColor:ee.border},children:[t.jsxs("div",{className:"text-sm font-medium",style:{color:ee.textSecondary},children:[t.jsx("span",{className:Ft()<$t()?"text-red-500":"text-green-600",children:Ft()})," / ",$t()]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(c,{size:"sm",variant:"ghost",onClick:()=>{Tt(!_t),_t||Ut(2)},className:"h-10 sm:h-8 px-4 sm:px-3 text-sm sm:text-sm font-medium hover:bg-transparent min-w-[70px]",style:{backgroundColor:_t?ee.buttonPrimary:"transparent",color:_t?"#ffffff":ee.textPrimary,border:"none",boxShadow:"none"},children:_t?"Unskip":"Skip"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-medium",style:{color:ee.textPrimary},children:"Spell"}),t.jsx(E,{checked:bt,onCheckedChange:gt,style:{backgroundColor:bt?ee.buttonPrimary:"dark"===ee.theme.name?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"},className:"data-[state=checked]:bg-primary"})]}),t.jsx(c,{size:"sm",variant:"ghost",onClick:()=>Ht(0),disabled:pt||!Dt().trim()||_t,className:"h-8 w-8 p-0 hover:bg-transparent",style:{color:ee.textPrimary},children:pt?t.jsx(p,{className:"w-4 h-4 animate-spin"}):t.jsx(f,{className:"w-4 h-4"})}),t.jsxs(y,{value:tt,onValueChange:rt,children:[t.jsx(v,{className:"w-[90px] h-8 text-sm border-0 bg-transparent shadow-none p-0 focus:ring-0",style:{color:ee.textPrimary,"--tw-ring-color":ee.buttonPrimary},children:t.jsx(k,{placeholder:"Language"})}),t.jsx(w,{children:D.map(e=>t.jsx(j,{value:e.value,children:e.label},e.value))})]})]})]}),t.jsx("div",{className:"flex justify-end items-center mt-4 gap-3",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(N,{children:t.jsxs(C,{children:[t.jsx(S,{asChild:!0,children:t.jsx(_,{className:"w-4 h-4",style:{color:ee.textSecondary}})}),t.jsx(T,{side:"top",className:"max-w-xs",children:t.jsx("p",{children:"You can submit with just one task completed. The other task will be marked as skipped."})})]})}),t.jsx(c,{onClick:Ot,disabled:qt(),variant:"default",className:"min-w-[120px]",style:{backgroundColor:ee.buttonPrimary,color:"#ffffff"},children:Ue?"Submitting...":"Submit Test"})]})})]})}):t.jsx(x,{className:"rounded-3xl h-full max-w-5xl mx-auto",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.9)":"dark"===ee.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===ee.theme.name?"#ffffff":ee.theme.colors.cardBackground,borderColor:ee.border,backdropFilter:"glassmorphism"===ee.theme.name?"blur(12px)":"dark"===ee.theme.name?"blur(8px)":"none",boxShadow:"dark"===ee.theme.name?"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1)":"note"===ee.theme.name?null==(K=ee.theme.styles.cardStyle)?void 0:K.boxShadow:"0 8px 32px rgba(15, 23, 42, 0.16), 0 0 0 1px rgba(148, 163, 253, 0.06)",...ee.cardStyle,minHeight:("dark"===ee.theme.name?500:"minimalist"===ee.theme.name?550:"note"===ee.theme.name?580:600)+"px"},children:t.jsxs(h,{className:"p-4 flex flex-col h-full",children:[(null==Yt?void 0:Yt.instructions)&&t.jsx("div",{className:"mb-4",children:t.jsx("div",{className:"whitespace-pre-wrap leading-relaxed p-3 rounded-lg text-sm",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.1)":"dark"===ee.theme.name?"rgba(255,255,255,0.05)":"minimalist"===ee.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:ee.border,borderWidth:"1px",borderStyle:"solid",color:ee.textPrimary},children:Yt.instructions})}),2!==ne||"Academic"!==(null==te?void 0:te.test_subtype)&&"Academic"!==lt||"viewAll"!==ke||Pt?t.jsx(g,{value:Dt(),onChange:e=>Bt(e.target.value),onKeyDown:e=>{"Tab"!==e.key||"Academic"!==(null==te?void 0:te.test_subtype)&&"Academic"!==lt||(e.preventDefault(),"intro"===ke?we("body1"):"body1"===ke?we("body2"):"body2"===ke?we("conclusion"):"conclusion"===ke&&we("viewAll"))},placeholder:Pt?"Task 2 is skipped":2!==ne||"Academic"!==(null==te?void 0:te.test_subtype)&&"Academic"!==lt?"Write your essay here...":"intro"===ke?"Write your introduction here...":"body1"===ke?"Write your first body paragraph here...":"body2"===ke?"Write your second body paragraph here...":"conclusion"===ke?"Write your conclusion here...":"viewAll"===ke?"Write your complete Task 2 essay here...":"Write your essay here...",className:"h-[calc(100vh-280px)] min-h-[500px] text-base leading-relaxed resize-none rounded-2xl focus:outline-none focus:ring-0",spellCheck:bt,disabled:Pt,style:{backgroundColor:Pt?"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.05)":"dark"===ee.theme.name?"rgba(255,255,255,0.02)":"minimalist"===ee.theme.name?"#f3f4f6":"rgba(255,255,255,0.3)":"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.1)":"dark"===ee.theme.name?"rgba(255,255,255,0.05)":"minimalist"===ee.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:ee.border,color:Pt?ee.textSecondary:ee.textPrimary,outline:"none",boxShadow:"none",cursor:Pt?"not-allowed":"text",opacity:Pt?.6:1}}):t.jsx("div",{className:"flex-1 flex flex-col",style:{minHeight:0},children:t.jsx(g,{value:Dt(),onChange:zt,placeholder:"Write your complete Task 2 essay here...",className:"h-[calc(100vh-280px)] min-h-[500px] w-full text-base leading-relaxed resize-none rounded-2xl focus:outline-none focus:ring-0",spellCheck:bt,style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.1)":"dark"===ee.theme.name?"rgba(255,255,255,0.05)":"minimalist"===ee.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:ee.border,color:ee.textPrimary,outline:"none",boxShadow:"none"}})}),t.jsxs("div",{className:"flex items-center justify-between gap-3 mt-4 pt-3 border-t",style:{borderColor:ee.border},children:[t.jsxs("div",{className:"text-sm font-medium",style:{color:ee.textSecondary},children:[t.jsx("span",{className:Ft()<$t()?"text-red-500":"text-green-600",children:Ft()})," / ",$t()]}),t.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3",children:[t.jsx(c,{size:"sm",variant:"ghost",onClick:()=>{At(!Pt)},className:"h-10 sm:h-8 px-4 sm:px-3 text-sm sm:text-sm font-medium hover:bg-transparent min-w-[70px]",style:{backgroundColor:Pt?ee.buttonPrimary:"transparent",color:Pt?"#ffffff":ee.textPrimary,border:"none",boxShadow:"none"},children:Pt?"Unskip":"Skip"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-medium",style:{color:ee.textPrimary},children:"Spell"}),t.jsx(E,{checked:bt,onCheckedChange:gt,style:{backgroundColor:bt?ee.buttonPrimary:"dark"===ee.theme.name?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"},className:"data-[state=checked]:bg-primary"})]}),t.jsx(c,{size:"sm",variant:"ghost",onClick:()=>Ht(0),disabled:pt||!Dt().trim()||Pt,className:"h-8 w-8 p-0 hover:bg-transparent",style:{color:ee.textPrimary},children:pt?t.jsx(p,{className:"w-4 h-4 animate-spin"}):t.jsx(f,{className:"w-4 h-4"})}),t.jsxs(y,{value:tt,onValueChange:rt,children:[t.jsx(v,{className:"w-[90px] h-8 text-sm border-0 shadow-none p-0 focus:ring-0 rounded-lg "+("glassmorphism"===ee.theme.name?"bg-white/10":"dark"===ee.theme.name?"bg-white/5":"minimalist"===ee.theme.name?"bg-gray-50":"note"===ee.theme.name?"bg-amber-50":"bg-white/5"),style:{color:ee.textPrimary,"--tw-ring-color":ee.buttonPrimary,borderColor:ee.border},children:t.jsx(k,{placeholder:"Language"})}),t.jsx(w,{children:D.map(e=>t.jsx(j,{value:e.value,children:e.label},e.value))})]}),t.jsx(P,{htmlFor:"ai-model-selector",className:"text-sm font-medium whitespace-nowrap",style:{color:ee.textPrimary},children:"AI Model:"}),t.jsxs(y,{value:at,onValueChange:st,children:[t.jsx(v,{id:"ai-model-selector",className:"w-[180px] h-8 text-sm border transition-colors rounded-lg",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.9)":"dark"===ee.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===ee.theme.name?"#ffffff":ee.theme.colors.cardBackground,borderColor:ee.border,color:ee.textPrimary,backdropFilter:"glassmorphism"===ee.theme.name?"blur(12px)":"none"},children:t.jsx(k,{placeholder:"Select AI Model"})}),t.jsxs(w,{children:[t.jsx(j,{value:"gemini-2.5-flash",children:"Gemini 2.5 Flash"}),t.jsx(j,{value:"kimi-k2-thinking",children:"Kimi K2 Thinking"}),t.jsx(j,{value:"gpt-5.1",children:"ChatGPT 5.1"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(N,{children:t.jsxs(C,{children:[t.jsx(S,{asChild:!0,children:t.jsx(_,{className:"w-4 h-4",style:{color:ee.textSecondary}})}),t.jsx(T,{side:"top",className:"max-w-xs",children:t.jsx("p",{children:"You can submit with just one task completed. The other task will be marked as skipped."})})]})}),t.jsx(c,{onClick:Ot,disabled:qt(),variant:"default",className:"min-w-[120px] h-8",style:{backgroundColor:ee.buttonPrimary,color:"#ffffff"},children:Ue?"Submitting...":"Submit Test"})]})]})]})]})}),t.jsx("div",{className:"mt-6",children:(1===ne&&yt||2===ne&&jt)&&t.jsx(M,{feedback:1===ne?yt:jt,improved:1===ne?kt:Ct})}),t.jsx(c,{variant:"outline",size:"sm",onClick:()=>X("/ielts/writing"),className:"fixed bottom-6 left-6 z-50 rounded-xl",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.9)":"dark"===ee.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===ee.theme.name?"#ffffff":ee.theme.colors.cardBackground,borderColor:ee.border,color:ee.textPrimary},children:"Exit"}),t.jsxs("div",{className:"fixed bottom-6 right-3 sm:bottom-6 sm:right-6 z-50",children:[Ye&&t.jsxs(x,{className:"backdrop-blur-md rounded-3xl w-[260px] h-[360px] sm:w-96 sm:h-[500px] shadow-2xl flex flex-col transform-gpu origin-bottom-right transition-all duration-260 ease-in-out "+(Ve?"opacity-100 scale-100 translate-y-0":"opacity-0 scale-75 translate-y-8"),style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.95)":"dark"===ee.theme.name?"rgba(30, 41, 59, 0.95)":"minimalist"===ee.theme.name?"#ffffff":ee.theme.colors.cardBackground,borderColor:ee.border,backdropFilter:"glassmorphism"===ee.theme.name?"blur(12px)":"dark"===ee.theme.name?"blur(8px)":"none",...ee.cardStyle},children:[t.jsx(A,{className:"pb-1 sm:pb-2 rounded-t-3xl relative",children:t.jsx("div",{className:"absolute top-1.5 right-1.5 sm:top-2 sm:right-2",children:t.jsx(c,{variant:"ghost",size:"icon",onClick:()=>{Xe(!1),setTimeout(()=>Ke(!1),260)},className:"h-7 w-7 sm:h-8 sm:w-8 p-0",style:{color:ee.textPrimary},children:"‚úï"})})}),t.jsxs(h,{className:"flex-1 flex flex-col px-2.5 py-2 sm:p-4 overflow-hidden",children:[t.jsx(z,{className:"flex-1 min-h-0",children:t.jsx(B,{className:"flex-1 min-h-0",children:0!==Gt().length||Me?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"rounded-lg p-3 mb-4",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.1)":"dark"===ee.theme.name?"rgba(255,255,255,0.05)":"minimalist"===ee.theme.name?"#f9fafb":"rgba(255,255,255,0.6)",borderColor:ee.border,borderWidth:"1px",borderStyle:"solid"},children:t.jsx("div",{className:"text-[10px] sm:text-sm whitespace-pre-wrap",style:{color:ee.textSecondary},children:(null==Yt?void 0:Yt.title)||(1===ne?"Letter Writing":"Essay Writing")})}),Gt().map(e=>t.jsxs($,{from:"user"===e.type?"user":"assistant",children:["bot"===e.type&&t.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"52px",height:"52px",flexShrink:0},children:t.jsx("img",{src:"https://raw.githubusercontent.com/AlfieAlfiegithu2/alfie-ai-coach/main/public/1000031289.png",alt:"Catie",style:{width:"100%",height:"100%",objectFit:"cover"}})}),t.jsx(q,{children:t.jsx("div",{className:"px-3 py-2 rounded-xl text-sm",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.1)":"dark"===ee.theme.name?"rgba(255,255,255,0.05)":"minimalist"===ee.theme.name?"#f9fafb":"rgba(255,255,255,0.5)",borderColor:ee.border,borderWidth:"1px",borderStyle:"solid",color:ee.textPrimary},children:t.jsx(H,{dangerouslySetInnerHTML:{__html:e.content.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/^‚Ä¢ (.*)$/gm,"<li>$1</li>").replace(/(<li>.*<\/li>)/s,"<ul>$1</ul>").replace(/\n/g,"<br>")}})})}),"user"===e.type&&(null==Z?void 0:Z.avatar_url)&&t.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"52px",height:"52px",flexShrink:0},children:t.jsx("img",{src:Z.avatar_url,alt:"Your avatar",style:{width:"100%",height:"100%",objectFit:"cover"}})})]},e.id)),Me&&t.jsxs($,{from:"assistant",children:[t.jsx(q,{children:t.jsx("div",{className:"px-3 py-2 rounded-xl text-sm",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.1)":"dark"===ee.theme.name?"rgba(255,255,255,0.05)":"minimalist"===ee.theme.name?"#f9fafb":"rgba(255,255,255,0.5)",borderColor:ee.border,borderWidth:"1px",borderStyle:"solid"},children:t.jsx(G,{text:"Thinking..."})})}),t.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"52px",height:"52px"},children:t.jsx("img",{src:"https://raw.githubusercontent.com/AlfieAlfiegithu2/alfie-ai-coach/main/public/1000031289.png",alt:"Catie",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})]}):t.jsx(L,{icon:t.jsx(F,{className:"size-9 sm:size-12",style:{color:ee.textSecondary}}),title:"Start a conversation",description:"Ask for help with your IELTS writing practice"})})}),t.jsx("div",{className:"flex-shrink-0 mt-2.5 sm:mt-4",children:t.jsxs("div",{className:"flex gap-1.5 sm:gap-2",children:[t.jsx("input",{type:"text",value:He,onChange:e=>Ge(e.target.value),onKeyPress:e=>"Enter"===e.key&&!Me&&He.trim()&&Rt(),placeholder:"Ask for writing help...",className:"flex-1 px-2.5 py-1.5 sm:px-3 sm:py-2 rounded-lg text-[10px] sm:text-sm focus:outline-none focus:ring-0 resize-none",style:{backgroundColor:"glassmorphism"===ee.theme.name?"rgba(255,255,255,0.1)":"dark"===ee.theme.name?"rgba(255,255,255,0.05)":"minimalist"===ee.theme.name?"#ffffff":ee.theme.colors.cardBackground,borderColor:ee.border,borderWidth:"1px",borderStyle:"solid",color:ee.textPrimary},disabled:Me}),t.jsx("style",{dangerouslySetInnerHTML:{__html:`\n                      input[placeholder="Ask for writing help..."]::placeholder {\n                        color: ${ee.textSecondary};\n                      }\n                    `}}),t.jsx(c,{onClick:()=>Rt(),disabled:Me||!He.trim(),variant:"ghost",size:"icon",className:"h-7 w-7 sm:h-8 sm:w-8 p-0",style:{color:ee.textPrimary},children:Me?t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2",style:{borderColor:ee.textPrimary}}):t.jsx(W,{className:"w-4 h-4"})})]})})]})]}),!Ye&&t.jsx("div",{style:{borderRadius:"50%",overflow:"hidden",width:"64px",height:"64px",cursor:"pointer",boxShadow:"0 8px 20px rgba(0,0,0,0.18)",transition:"transform 0.22s ease-out, box-shadow 0.22s ease-out"},onClick:()=>{Ke(!0),requestAnimationFrame(()=>Xe(!0))},onMouseEnter:e=>{const t=e.currentTarget;t.style.transform="scale(1.06) translateY(-2px)",t.style.boxShadow="0 14px 30px rgba(0,0,0,0.24)"},onMouseLeave:e=>{const t=e.currentTarget;t.style.transform="scale(1.0) translateY(0px)",t.style.boxShadow="0 10px 25px rgba(0,0,0,0.15)"},children:t.jsx("img",{src:"https://raw.githubusercontent.com/AlfieAlfiegithu2/alfie-ai-coach/main/public/1000031289.png",alt:"Catie",style:{width:"100%",height:"100%",objectFit:"cover"}})})]}),Ue&&t.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 flex items-center justify-center",children:t.jsx("div",{className:"bg-card p-8 rounded-3xl shadow-xl border border-border",children:t.jsx(m,{message:"Analyzing your writing with AI examiner...",subMessage:"Please wait while we evaluate your IELTS writing",size:200})})})]})})})}),bt&&t.jsx("style",{children:'\n          /* Prominent underline for spell check errors */\n          textarea[spellcheck="true"]::spelling-error {\n            text-decoration: wavy underline rgba(239, 68, 68, 0.8) 2px !important;\n            text-decoration-skip-ink: none !important;\n          }\n\n          textarea[spellcheck="true"]:focus::spelling-error {\n            text-decoration: wavy underline rgba(239, 68, 68, 0.9) 2px !important;\n          }\n        '})]}):t.jsx(d,{title:"IELTS Writing Test",showBackButton:!0,children:t.jsx("div",{className:"flex items-center justify-center min-h-96",children:t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-lg text-foreground mb-4",children:"Task data not available"}),t.jsx(c,{onClick:()=>X("/ielts-portal"),variant:"outline",children:"Back to Portal"})]})})});var Kt};export{R as default};
