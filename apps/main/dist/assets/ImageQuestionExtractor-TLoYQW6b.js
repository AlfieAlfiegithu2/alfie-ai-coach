import{c as e,r as s,J as a,j as t,C as r,b as n,d as l,N as i,a as o,B as c,U as d,x as u,S as m,p as x,q as p,s as g,t as h,E as j,l as b,T as v,I as f,X as N}from"./index-C3QnlETR.js";import{s as y}from"./supabase-DWL4C3fA.js";import{I as w}from"./image-C9kmWnbp.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=e("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),q=({testId:e,testType:q,onQuestionsExtracted:T,initialImageFile:C,onImageSelected:S})=>{const[I,Q]=s.useState(null),[E,_]=s.useState(""),[A,P]=s.useState("questions"),[D,z]=s.useState("Multiple Choice"),[F,L]=s.useState(!1),[G,M]=s.useState([]),[R,O]=s.useState(null),[B,U]=s.useState(null),[$,J]=s.useState(!1);s.useEffect(()=>{C&&V(C)},[C]);const V=e=>{if(!e.type.startsWith("image/"))return void a.error("Please upload an image file (JPG, PNG, WebP)");if(e.size>10485760)return void a.error("Image size should be less than 10MB");Q(e),S&&S(e);const s=new FileReader;s.onloadend=()=>{_(s.result)},s.readAsDataURL(e),a.success("Image uploaded successfully!")},W=()=>{O(null),U(null)},K=()=>{if(null!==R&&B){const e=[...G];e[R]=B,M(e),O(null),U(null),a.success("Question updated")}};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs(r,{className:"border-2 border-purple-200 dark:border-purple-800",children:[t.jsxs(n,{className:"bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-950 dark:to-blue-950",children:[t.jsxs(l,{className:"flex items-center gap-2",children:[t.jsx(i,{className:"w-5 h-5 text-purple-600"}),"AI Question Extraction (Gemini Vision)"]}),t.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Upload an image of IELTS questions and let Gemini AI extract them automatically"})]}),t.jsxs(o,{className:"pt-6 space-y-6",children:[t.jsx("div",{className:"border-2 border-dashed rounded-lg p-8 transition-all duration-200 "+($?"border-purple-500 bg-purple-50 dark:bg-purple-900/20 scale-[1.02]":"border-border hover:border-purple-400"),onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),J(!0)},onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget===e.target&&J(!1)},onDrop:e=>{e.preventDefault(),e.stopPropagation(),J(!1);const s=e.dataTransfer.files;if(s&&s.length>0){const e=s[0];V(e)}},children:E?t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"relative max-h-96 overflow-hidden rounded-lg border",children:t.jsx("img",{src:E,alt:"Questions Preview",className:"w-full object-contain"})}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[t.jsx(u,{className:"w-4 h-4 text-green-500"}),null==I?void 0:I.name," (",(I.size/1024).toFixed(0)," KB)"]}),t.jsx(c,{variant:"ghost",size:"sm",onClick:()=>{Q(null),_(""),M([])},children:"Change Image"})]})]}):t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"transition-transform duration-200 "+($?"scale-110":""),children:t.jsx(w,{className:"w-16 h-16 mx-auto mb-4 "+($?"text-purple-600":"text-purple-400")})}),t.jsx("h4",{className:"font-medium mb-2",children:$?"ðŸ“Ž Drop image here!":"Upload Question Image"}),t.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:$?"Release to upload":"Drag & drop or click to browse â€¢ JPG, PNG, WebP (max 10MB)"}),!$&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"file",accept:"image/*",onChange:e=>{var s;const a=null==(s=e.target.files)?void 0:s[0];a&&V(a)},className:"hidden",id:"question-image-upload"}),t.jsxs(c,{onClick:()=>{var e;return null==(e=document.getElementById("question-image-upload"))?void 0:e.click()},variant:"outline",className:"border-purple-300 hover:bg-purple-50",children:[t.jsx(d,{className:"w-4 h-4 mr-2"}),"Choose Image"]}),t.jsx("p",{className:"text-xs text-muted-foreground mt-3",children:"ðŸ’¡ Tip: Clear, high-resolution images work best"})]})]})}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm font-medium",children:"Extraction Type"}),t.jsxs(m,{value:A,onValueChange:P,children:[t.jsx(x,{children:t.jsx(p,{placeholder:"Select extraction type"})}),t.jsxs(g,{children:[t.jsx(h,{value:"questions",children:"ðŸ“ Questions (Full questions with options)"}),t.jsx(h,{value:"answers",children:"âœ“ Answers Only (Answer keys for 1-40)"})]})]}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"ðŸ’¡ Choose whether to extract full questions or just the answer keys"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("label",{className:"text-sm font-medium",children:["Question Type ",t.jsx("span",{className:"text-muted-foreground font-normal",children:"(Optional - AI will detect)"})]}),t.jsxs(m,{value:D,onValueChange:z,children:[t.jsx(x,{children:t.jsx(p,{placeholder:"AI will auto-detect type"})}),t.jsxs(g,{children:[t.jsx(h,{value:"auto",children:"ðŸ¤– Auto-Detect (Recommended)"}),t.jsx(h,{value:"Listening Question Type 1 â€“ Multiple choice",children:"Type 1 â€“ Multiple choice"}),t.jsx(h,{value:"Listening Question Type 2 â€“ Matching",children:"Type 2 â€“ Matching"}),t.jsx(h,{value:"Listening Question Type 3 â€“ Plan/map/diagram labelling",children:"Type 3 â€“ Plan/map/diagram labelling"}),t.jsx(h,{value:"Listening Question Type 4 â€“ Form/note/table/flow chart/summary completion",children:"Type 4 â€“ Form/note/table/flow chart/summary completion"}),t.jsx(h,{value:"Listening Question Type 5 â€“ Sentence completion",children:"Type 5 â€“ Sentence completion"}),t.jsx(h,{value:"Listening Question Type 6 â€“ Short-answer questions",children:"Type 6 â€“ Short-answer questions"})]})]}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"ðŸ’¡ AI analyzes the image to identify question types"})]})]}),t.jsx(c,{onClick:async()=>{if(I){L(!0);try{const s=E.split(",")[1],t="1-40",r=D&&"auto"!==D?D:"";console.log("ðŸ“¤ Sending to Gemini:",{extractionType:A,questionRange:t,questionType:r||"AUTO-DETECT",imageSize:s.length});const{data:n,error:l}=await y.functions.invoke("gemini-question-extractor",{body:{imageBase64:s,questionRange:t,questionType:r,extractionType:A,testType:q,testId:e}});if(l)throw console.error("âŒ Extraction error:",l),l;if(!n.success)throw new Error(n.error||"Extraction failed");console.log("âœ… Extracted questions:",n),M(n.questions);const i=n.autoDetected?`\nDetected: ${n.range} (${n.questionType})`:`Range: ${n.range}`;a.success(`âœ¨ Successfully extracted ${n.count} questions!`,{description:i})}catch(s){console.error("âŒ Extraction failed:",s),a.error("Failed to extract questions",{description:s.message||"Please try again or check the image quality"})}finally{L(!1)}}else a.error("Please upload an image")},disabled:!I||F,className:"w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700",size:"lg",children:F?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Gemini AI is analyzing the image..."]}):t.jsxs(t.Fragment,{children:[t.jsx(i,{className:"w-5 h-5 mr-2"}),"Extract Questions with AI"]})})]})]}),G.length>0&&t.jsxs(r,{children:[t.jsx(n,{children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs(l,{className:"flex items-center gap-2",children:[t.jsx(j,{className:"w-5 h-5"}),"Extracted Questions (",G.length,")"]}),t.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Review and edit if needed, then save to database"})]}),t.jsx(b,{variant:"secondary",className:"text-sm",children:"questions"===A?"Questions 1-40":"Answers 1-40"})]})}),t.jsxs(o,{children:[t.jsx("div",{className:"max-h-[600px] overflow-y-auto space-y-4",children:G.map((e,s)=>t.jsx("div",{className:"border rounded-lg overflow-hidden",children:R===s?t.jsxs("div",{className:"p-4 space-y-3 bg-muted/30",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"text-xs font-medium",children:["Question ",e.question_number]}),t.jsx(v,{value:(null==B?void 0:B.question_text)||"",onChange:e=>U(s=>s?{...s,question_text:e.target.value}:null),rows:3,className:"mt-1"})]}),(null==B?void 0:B.options)&&t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Options (one per line)"}),t.jsx(v,{value:B.options.join("\n"),onChange:e=>U(s=>s?{...s,options:e.target.value.split("\n")}:null),rows:4,className:"mt-1"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Correct Answer"}),t.jsx(f,{value:(null==B?void 0:B.correct_answer)||"",onChange:e=>U(s=>s?{...s,correct_answer:e.target.value}:null),className:"mt-1"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(c,{size:"sm",onClick:K,children:[t.jsx(u,{className:"w-4 h-4 mr-1"}),"Save"]}),t.jsxs(c,{size:"sm",variant:"outline",onClick:W,children:[t.jsx(N,{className:"w-4 h-4 mr-1"}),"Cancel"]})]})]}):t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 border-b",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(b,{variant:"outline",className:"font-mono",children:["Q",e.question_number]}),t.jsx(b,{variant:"secondary",className:"Multiple Choice"===e.question_type?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300":"Fill in the blank"===e.question_type?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":"True/False/Not Given"===e.question_type?"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300":"bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300",children:e.question_type})]}),t.jsxs("div",{className:"flex gap-1",children:[t.jsx(c,{size:"sm",variant:"ghost",onClick:()=>(e=>{O(e),U({...G[e]})})(s),children:t.jsx(k,{className:"w-3 h-3"})}),t.jsx(c,{size:"sm",variant:"ghost",onClick:()=>(e=>{const s=G.filter((s,a)=>a!==e);M(s),a.success("Question removed")})(s),className:"text-red-500 hover:text-red-700",children:t.jsx(N,{className:"w-3 h-3"})})]})]}),t.jsxs("div",{className:"p-4 bg-white dark:bg-gray-900",children:[t.jsxs("div",{className:"mb-3",children:[t.jsxs("p",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1",children:["Question ",e.question_number]}),t.jsx("p",{className:"text-base leading-relaxed",children:e.question_text})]}),e.options&&e.options.length>0&&t.jsx("div",{className:"space-y-2 pl-2",children:e.options.map((a,r)=>t.jsxs("label",{className:"flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-colors "+(a===e.correct_answer?"bg-green-50 dark:bg-green-900/20 border-green-300 dark:border-green-700":"bg-gray-50 dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[t.jsx("input",{type:"radio",name:`question-${s}`,checked:a===e.correct_answer,readOnly:!0,className:"w-4 h-4"}),t.jsx("span",{className:a===e.correct_answer?"font-medium text-green-700 dark:text-green-300":"",children:a}),a===e.correct_answer&&t.jsx(b,{variant:"default",className:"ml-auto text-xs",children:"âœ“ Correct"})]},r))}),!e.options&&e.correct_answer&&t.jsx("div",{className:"space-y-2",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("label",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Answer:"}),t.jsx(f,{value:e.correct_answer,readOnly:!0,className:"max-w-xs bg-green-50 dark:bg-green-900/20 border-green-300 dark:border-green-700 font-medium"}),t.jsx(b,{variant:"default",className:"text-xs",children:"âœ“ Correct Answer"})]})}),e.explanation&&t.jsxs("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[t.jsx("p",{className:"text-xs font-semibold text-blue-700 dark:text-blue-300 mb-1",children:"Explanation:"}),t.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:e.explanation})]})]})]})},s))}),t.jsxs("div",{className:"mt-6 flex gap-3",children:[t.jsxs(c,{onClick:()=>T(G),className:"flex-1 bg-green-600 hover:bg-green-700",size:"lg",children:[t.jsx(u,{className:"w-5 h-5 mr-2"}),"Save ",G.length," Questions to Database"]}),t.jsx(c,{variant:"outline",onClick:()=>M([]),children:"Clear All"})]})]})]})]})};export{q as I};
