import{u as e,r as s,j as r}from"./vendor-react-rLLBBC7n.js";import{E as t,d as a,q as n,x as i,U as o,y as l,C as c,b as d,c as u,o as m,a as x,L as g,R as h,p,B as j,P as v,e as f,s as y}from"./index-BDl0jLJK.js";import{aG as b,aa as w,aO as N,K as k,w as S,ch as q,aj as _,bc as Q,aw as E,ak as C,ci as F,bj as I,as as P,F as A,b4 as B,aQ as R}from"./vendor-ui-BGi_EvHx.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-charts-0DeywwxG.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";const $=[{id:"Elias",name:"Elias - Professional",gender:"Male"},{id:"Jennifer",name:"Jennifer - Friendly",gender:"Female"},{id:"Ryan",name:"Ryan - Formal",gender:"Male"},{id:"Katerina",name:"Katerina - Warm",gender:"Female"}],T=()=>{var T,U,L,M;const G=e(),{user:z}=t(),{toast:O}=a(),D=n(),J=s.useRef(null),K=s.useRef(null),[V,Y]=s.useState(!0),[W,H]=s.useState(""),[X,Z]=s.useState(""),[ee,se]=s.useState(null),[re,te]=s.useState("quality_only"),[ae,ne]=s.useState("Jennifer"),[ie,oe]=s.useState("idle"),[le,ce]=s.useState(""),[de,ue]=s.useState(""),[me,xe]=s.useState(!1),[ge,he]=s.useState([]),pe=e=>{const s=(new Date).toLocaleTimeString();console.log(`[${s}] ${e}`),he(r=>[...r.slice(-10),`[${s}] ${e}`])};s.useEffect(()=>{(async()=>{if(z)try{const{data:e}=await y.from("business_profiles").select("occupation, industry").eq("user_id",z.id).maybeSingle();e&&(H(e.occupation||""),Z(e.industry||""))}catch(e){console.error("Error loading profile:",e)}finally{Y(!1)}else Y(!1)})()},[z]),s.useEffect(()=>{const e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e)return void pe("Speech recognition not supported");const s=new e;return s.continuous=!0,s.interimResults=!0,s.language="en-US",s.onstart=()=>{pe("Speech recognition started"),oe("listening")},s.onresult=e=>{let s="",r="";for(let t=e.resultIndex;t<e.results.length;t++){const a=e.results[t][0].transcript;e.results[t].isFinal?r+=a:s=a}r?(ce(e=>e+" "+r),ue("")):ue(s)},s.onerror=e=>{pe(`Speech error: ${e.error}`),"no-speech"!==e.error&&"aborted"!==e.error&&O({title:"Microphone Error",description:"Please check your microphone settings",variant:"destructive"})},s.onend=()=>{if(pe("Speech recognition ended"),"listening"===ie)try{s.start()}catch(e){}},K.current=s,()=>{try{s.abort()}catch(e){}}},[O]);const je=async e=>{oe("speaking"),xe(!0),pe(`Playing question: ${e.substring(0,50)}...`);try{const{data:s,error:r}=await y.functions.invoke("openrouter-qwen-tts",{body:{text:e,voice:ae,language_type:"English"}});if(r)throw r;if(!s.audioContent)throw new Error("No audio content received");{let e=s.audioContent.trim().replace(/\s/g,"");for(e=e.replace(/-/g,"+").replace(/_/g,"/");e.length%4;)e+="=";const r=atob(e),t=new Uint8Array(r.length);for(let s=0;s<r.length;s++)t[s]=r.charCodeAt(s);const a=new Blob([t],{type:"audio/mp3"});if(J.current){const e=URL.createObjectURL(a);J.current.src=e,J.current.onended=()=>{URL.revokeObjectURL(e),xe(!1),pe("Question audio ended, starting listening"),ve()},J.current.onerror=()=>{pe("Audio playback error"),xe(!1),ve()},await J.current.play()}}}catch(s){console.error("TTS error:",s),pe(`TTS error: ${s}`),xe(!1),ve()}},ve=()=>{if(ce(""),ue(""),oe("listening"),K.current)try{K.current.start(),pe("Started listening for answer")}catch(e){pe("Recognition already started")}},fe=async e=>{pe("Generating final summary...");try{const{data:s,error:r}=await y.functions.invoke("interview-evaluator",{body:{action:"generate_summary",questions:e,occupation:W,gradingMode:re}});if(r)throw r;s.success&&ee&&(se({...ee,status:"completed",overallQualityScore:s.overallQualityScore,overallEnglishScore:s.overallEnglishScore,summaryFeedback:s.summaryFeedback,strengths:s.strengths,areasToImprove:s.areasToImprove}),z&&await y.from("interview_sessions").insert({user_id:z.id,occupation:W,industry:X,grading_mode:re,questions:e,overall_quality_score:s.overallQualityScore,overall_english_score:s.overallEnglishScore,summary_feedback:s.summaryFeedback,strengths:s.strengths,areas_to_improve:s.areasToImprove,status:"completed",completed_at:(new Date).toISOString()}),oe("idle"),pe("Interview completed!"))}catch(s){console.error("Error generating summary:",s),oe("idle")}},ye=e=>e>=8?"text-green-600":e>=6?"text-yellow-600":"text-red-600";return V?r.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:D.theme.colors.background},children:r.jsx(i,{})}):r.jsxs("div",{className:"min-h-screen",style:{backgroundColor:D.theme.colors.background},children:[r.jsx(o,{title:"Interview Practice - Business English",description:"Practice job interviews with AI voice interviewer. Get feedback on answer quality and English proficiency.",keywords:"interview practice, job interview, mock interview, interview preparation"}),r.jsx(l,{title:"Interview Practice",showBackButton:!0,backPath:"/business-portal",children:r.jsxs("div",{className:"max-w-4xl mx-auto px-4 space-y-6",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[r.jsx("button",{onClick:()=>G("/hero"),className:"text-muted-foreground hover:text-primary",children:r.jsx(b,{className:"h-4 w-4"})}),r.jsx(w,{className:"h-4 w-4 text-muted-foreground"}),r.jsx("button",{onClick:()=>G("/business-portal"),className:"text-muted-foreground hover:text-primary",children:"Business English"}),r.jsx(w,{className:"h-4 w-4 text-muted-foreground"}),r.jsx("span",{style:{color:D.textPrimary},children:"Interview Practice"})]}),!ee&&r.jsxs(c,{style:{backgroundColor:D.theme.colors.cardBackground},children:[r.jsxs(d,{children:[r.jsxs(u,{className:"flex items-center gap-2",children:[r.jsx(N,{className:"h-6 w-6 text-orange-500"}),"AI Interview Practice"]}),r.jsx(m,{children:"Practice with a voice-powered AI interviewer. Get instant feedback on your answers."})]}),r.jsxs(x,{className:"space-y-6",children:[r.jsxs("div",{className:"p-4 bg-orange-50 dark:bg-orange-950 rounded-lg",children:[r.jsx("p",{className:"text-sm text-muted-foreground",children:"Practicing for:"}),r.jsxs("p",{className:"text-lg font-semibold capitalize",style:{color:D.textPrimary},children:[W.replace(/_/g," ")," ",X&&`â€¢ ${X}`]})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsx(g,{className:"text-base font-medium",children:"Grading Mode"}),r.jsxs(h,{value:re,onValueChange:e=>te(e),children:[r.jsxs("div",{className:"flex items-start gap-3 p-4 border rounded-lg hover:bg-muted/50 cursor-pointer",children:[r.jsx(p,{value:"quality_only",id:"quality_only"}),r.jsxs("div",{className:"flex-1",children:[r.jsxs(g,{htmlFor:"quality_only",className:"text-sm font-medium cursor-pointer flex items-center gap-2",children:[r.jsx(k,{className:"h-4 w-4 text-blue-500"}),"Answer Quality Only"]}),r.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Focuses on content relevance, structure, depth, and examples"})]})]}),r.jsxs("div",{className:"flex items-start gap-3 p-4 border rounded-lg hover:bg-muted/50 cursor-pointer",children:[r.jsx(p,{value:"quality_and_english",id:"quality_and_english"}),r.jsxs("div",{className:"flex-1",children:[r.jsxs(g,{htmlFor:"quality_and_english",className:"text-sm font-medium cursor-pointer flex items-center gap-2",children:[r.jsx(S,{className:"h-4 w-4 text-purple-500"}),"Quality + English Proficiency"]}),r.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Also evaluates grammar, vocabulary, fluency, and pronunciation"})]})]})]})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsx(g,{className:"text-base font-medium",children:"Interviewer Voice"}),r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:$.map(e=>r.jsxs("button",{onClick:()=>ne(e.id),className:"p-3 rounded-lg border-2 transition-all text-left "+(ae===e.id?"border-orange-500 bg-orange-50 dark:bg-orange-950":"border-border hover:border-orange-300"),children:[r.jsx("p",{className:"text-sm font-medium",children:e.name}),r.jsx("p",{className:"text-xs text-muted-foreground",children:e.gender})]},e.id))})]}),r.jsxs(j,{onClick:async()=>{if(!W)return O({title:"Profile required",description:"Please set up your business profile first",variant:"destructive"}),void G("/business-portal");oe("thinking"),pe("Starting interview...");try{const{data:e,error:s}=await y.functions.invoke("interview-evaluator",{body:{action:"generate_questions",occupation:W,industry:X,count:10}});if(s)throw s;if(!e.success||!e.questions)throw new Error(e.error||"Failed to generate questions");{const s={id:crypto.randomUUID(),occupation:W,gradingMode:re,questions:e.questions.map((e,s)=>({id:crypto.randomUUID(),question:e,category:s<4?"behavioral":s<7?"situational":"technical"})),currentQuestion:0,status:"in_progress"};se(s),await je(s.questions[0].question)}}catch(e){console.error("Error starting interview:",e),O({title:"Error",description:"Failed to start interview. Please try again.",variant:"destructive"}),oe("idle")}},disabled:!W,className:"w-full bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600",size:"lg",children:[r.jsx(q,{className:"h-5 w-5 mr-2"}),"Start Interview"]}),r.jsx("div",{className:"text-sm text-muted-foreground text-center",children:r.jsx("p",{children:"10 questions â€¢ ~15-20 minutes â€¢ Voice-to-voice conversation"})})]})]}),ee&&"in_progress"===ee.status&&r.jsxs(r.Fragment,{children:[r.jsx(c,{style:{backgroundColor:D.theme.colors.cardBackground},children:r.jsxs(x,{className:"pt-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsxs("span",{className:"text-sm font-medium",children:["Question ",ee.currentQuestion+1," of 10"]}),r.jsx("span",{className:"text-sm text-muted-foreground",children:"speaking"===ie?"ðŸ”Š Listening...":"listening"===ie?"ðŸŽ¤ Your turn...":"grading"===ie?"â³ Grading...":""})]}),r.jsx(v,{value:10*(ee.currentQuestion+1),className:"h-2"})]})}),r.jsxs(c,{style:{backgroundColor:D.theme.colors.cardBackground},children:[r.jsxs(d,{children:[r.jsx(f,{variant:"outline",className:"w-fit capitalize",children:null==(T=ee.questions[ee.currentQuestion])?void 0:T.category}),r.jsx(u,{className:"text-xl mt-2",children:null==(U=ee.questions[ee.currentQuestion])?void 0:U.question})]}),r.jsxs(x,{className:"space-y-4",children:[("listening"===ie||le||de)&&r.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-900 rounded-lg min-h-[100px]",children:[r.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Your Answer:"}),r.jsxs("p",{className:"text-base",children:[le,de&&r.jsxs("span",{className:"text-muted-foreground italic",children:[" ",de]})]})]}),r.jsxs("div",{className:"flex gap-3",children:["listening"===ie&&r.jsxs(r.Fragment,{children:[r.jsxs(j,{onClick:async()=>{if(K.current)try{K.current.stop()}catch(s){}const e=(le+" "+de).trim();if(e){if(ee){oe("grading"),pe(`Submitting answer: ${e.substring(0,50)}...`);try{const{data:s,error:r}=await y.functions.invoke("interview-evaluator",{body:{action:"grade_answer",question:ee.questions[ee.currentQuestion].question,answer:e,occupation:W,gradingMode:re}});if(r)throw r;if(!s.success)throw new Error(s.error||"Failed to grade answer");{const r=[...ee.questions];r[ee.currentQuestion]={...r[ee.currentQuestion],answer:e,qualityScore:s.qualityScore,englishScore:s.englishScore,feedback:s.feedback};const t=ee.currentQuestion+1,a=t>=ee.questions.length;se({...ee,questions:r,currentQuestion:t,status:a?"completed":"in_progress"}),a?await fe(r):(ce(""),ue(""),await je(r[t].question))}}catch(r){console.error("Error grading answer:",r),O({title:"Error",description:"Failed to grade answer. Please try again.",variant:"destructive"}),oe("listening")}}}else O({title:"No answer detected",description:"Please speak your answer before submitting",variant:"destructive"})},className:"flex-1",children:[r.jsx(_,{className:"h-4 w-4 mr-2"}),"Submit Answer"]}),r.jsxs(j,{variant:"outline",onClick:async()=>{if(!ee)return;if(K.current)try{K.current.stop()}catch(s){}const e=ee.currentQuestion+1;e>=ee.questions.length?(se({...ee,currentQuestion:e,status:"completed"}),await fe(ee.questions)):(se({...ee,currentQuestion:e}),ce(""),ue(""),await je(ee.questions[e].question))},children:[r.jsx(Q,{className:"h-4 w-4 mr-2"}),"Skip"]})]}),"speaking"===ie&&r.jsxs(j,{variant:"outline",disabled:!0,className:"flex-1",children:[r.jsx(E,{className:"h-4 w-4 mr-2 animate-pulse"}),"AI Speaking..."]}),"grading"===ie&&r.jsxs(j,{variant:"outline",disabled:!0,className:"flex-1",children:[r.jsx(C,{className:"h-4 w-4 mr-2 animate-spin"}),"Analyzing Answer..."]}),r.jsx(j,{variant:"destructive",onClick:()=>{if(K.current)try{K.current.abort()}catch(e){}J.current&&(J.current.pause(),J.current.currentTime=0),se(null),oe("idle"),ce(""),ue("")},children:r.jsx(F,{className:"h-4 w-4"})})]})]})]}),ee.currentQuestion>0&&r.jsxs(c,{style:{backgroundColor:D.theme.colors.cardBackground},children:[r.jsx(d,{className:"pb-2",children:r.jsx(u,{className:"text-sm",children:"Previous Answers"})}),r.jsx(x,{children:r.jsx("div",{className:"space-y-2",children:ee.questions.slice(0,ee.currentQuestion).map((e,s)=>r.jsxs("div",{className:"flex items-center justify-between text-sm",children:[r.jsxs("span",{className:"text-muted-foreground",children:["Q",s+1]}),void 0!==e.qualityScore&&r.jsxs("span",{className:`font-medium ${ye(e.qualityScore)}`,children:[e.qualityScore,"/10"]})]},e.id))})})]})]}),ee&&"completed"===ee.status&&r.jsxs(r.Fragment,{children:[r.jsx(c,{style:{backgroundColor:D.theme.colors.cardBackground},children:r.jsx(x,{className:"pt-6",children:r.jsxs("div",{className:"text-center",children:[r.jsx(I,{className:"h-16 w-16 mx-auto text-yellow-500 mb-4"}),r.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Interview Complete!"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-6",children:[r.jsxs("div",{className:"p-6 bg-blue-50 dark:bg-blue-950 rounded-lg",children:[r.jsx(k,{className:"h-8 w-8 mx-auto text-blue-500 mb-2"}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"Answer Quality"}),r.jsxs("p",{className:`text-4xl font-bold ${ye(ee.overallQualityScore||0)}`,children:[null==(L=ee.overallQualityScore)?void 0:L.toFixed(1),"/10"]})]}),"quality_and_english"===re&&r.jsxs("div",{className:"p-6 bg-purple-50 dark:bg-purple-950 rounded-lg",children:[r.jsx(S,{className:"h-8 w-8 mx-auto text-purple-500 mb-2"}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"English Proficiency"}),r.jsxs("p",{className:`text-4xl font-bold ${ye(ee.overallEnglishScore||0)}`,children:[null==(M=ee.overallEnglishScore)?void 0:M.toFixed(1),"/10"]})]})]})]})})}),ee.summaryFeedback&&r.jsxs(c,{style:{backgroundColor:D.theme.colors.cardBackground},children:[r.jsx(d,{children:r.jsxs(u,{className:"flex items-center gap-2",children:[r.jsx(P,{className:"h-5 w-5 text-blue-500"}),"Interview Feedback"]})}),r.jsx(x,{children:r.jsx("p",{className:"text-muted-foreground",children:ee.summaryFeedback})})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[ee.strengths&&ee.strengths.length>0&&r.jsxs(c,{style:{backgroundColor:D.theme.colors.cardBackground},children:[r.jsx(d,{className:"pb-2",children:r.jsxs(u,{className:"text-sm flex items-center gap-2 text-green-600",children:[r.jsx(_,{className:"h-4 w-4"}),"Strengths"]})}),r.jsx(x,{children:r.jsx("ul",{className:"text-sm space-y-2",children:ee.strengths.map((e,s)=>r.jsxs("li",{className:"flex items-start gap-2",children:[r.jsx(A,{className:"h-4 w-4 text-yellow-500 flex-shrink-0 mt-0.5"}),e]},s))})})]}),ee.areasToImprove&&ee.areasToImprove.length>0&&r.jsxs(c,{style:{backgroundColor:D.theme.colors.cardBackground},children:[r.jsx(d,{className:"pb-2",children:r.jsxs(u,{className:"text-sm flex items-center gap-2 text-orange-600",children:[r.jsx(B,{className:"h-4 w-4"}),"Areas to Improve"]})}),r.jsx(x,{children:r.jsx("ul",{className:"text-sm space-y-2",children:ee.areasToImprove.map((e,s)=>r.jsxs("li",{className:"flex items-start gap-2",children:[r.jsx(w,{className:"h-4 w-4 text-orange-500 flex-shrink-0 mt-0.5"}),e]},s))})})]})]}),r.jsxs(c,{style:{backgroundColor:D.theme.colors.cardBackground},children:[r.jsx(d,{children:r.jsxs(u,{className:"flex items-center gap-2",children:[r.jsx(R,{className:"h-5 w-5 text-purple-500"}),"Question Results"]})}),r.jsx(x,{children:r.jsx("div",{className:"space-y-4",children:ee.questions.map((e,s)=>r.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[r.jsxs("div",{className:"flex items-start justify-between mb-2",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx(f,{variant:"outline",className:"capitalize text-xs mb-1",children:e.category}),r.jsxs("p",{className:"font-medium text-sm",children:["Q",s+1,": ",e.question]})]}),void 0!==e.qualityScore&&r.jsxs("div",{className:"text-right ml-4",children:[r.jsxs("span",{className:`text-lg font-bold ${ye(e.qualityScore)}`,children:[e.qualityScore,"/10"]}),"quality_and_english"===re&&void 0!==e.englishScore&&r.jsxs("p",{className:"text-xs text-muted-foreground",children:["English: ",e.englishScore,"/10"]})]})]}),e.answer&&r.jsxs("p",{className:"text-sm text-muted-foreground mt-2 line-clamp-2",children:[r.jsx("strong",{children:"Your answer:"})," ",e.answer]}),e.feedback&&r.jsxs("p",{className:"text-sm text-blue-600 dark:text-blue-400 mt-2",children:[r.jsx("strong",{children:"Feedback:"})," ",e.feedback]})]},e.id))})})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx(j,{variant:"outline",onClick:()=>{se(null),oe("idle")},className:"flex-1",children:"Practice Again"}),r.jsx(j,{onClick:()=>G("/business-portal"),className:"flex-1 bg-gradient-to-r from-orange-500 to-red-500",children:"Back to Portal"})]})]}),r.jsx("audio",{ref:J})]})})]})};export{T as default};
