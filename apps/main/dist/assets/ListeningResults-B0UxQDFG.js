import{u as e,ae as s,r as t,aq as a,j as r,a9 as c,B as n,ar as i,H as l,C as d,b as o,d as m,a as x,ao as h,an as j,L as u,l as g,a6 as f,Z as p}from"./index-snkdXCMk.js";import{s as N}from"./supabase-DWL4C3fA.js";import{H as b}from"./Header-D3hbHF-O.js";import{T as v}from"./trophy-Dx8G_uyw.js";import{C as y}from"./chart-column-WHWajc_N.js";import"./dropdown-menu-BmbrmtjI.js";import"./shield-CL12W_fY.js";const S=()=>{const S=e(),{user:w}=s(),[_,k]=t.useState([]),[T,B]=t.useState(!0),[L,A]=t.useState({totalTests:0,averageScore:0,averageBandScore:0,totalSections:0,bestSection:"",worstSection:""});t.useEffect(()=>{w&&C()},[w]);const C=async()=>{try{const{data:e,error:s}=await N.from("listening_test_results").select("*").eq("user_id",null==w?void 0:w.id).order("created_at",{ascending:!1});if(s)return void console.error("Error fetching listening results:",s);if(k(e||[]),e&&e.length>0){const s=e.length,t=e.reduce((e,s)=>e+(s.section_score||0),0),r=e.reduce((e,s)=>e+(s.section_total||10),0),c=r>0?Math.round(t/r*40):0,n=a(c,"listening"),i={};e.forEach(e=>{const s=`Section ${e.section_number}`;i[s]||(i[s]={correct:0,total:0}),i[s].correct+=e.section_score||0,i[s].total+=e.section_total||10});const l=Object.entries(i).map(([e,s])=>({section:e,percentage:s.total>0?s.correct/s.total*100:0})).sort((e,s)=>s.percentage-e.percentage),d=l.length>0?l[0].section:"",o=l.length>0?l[l.length-1].section:"";A({totalTests:Math.ceil(s/4),averageScore:c,averageBandScore:n,totalSections:s,bestSection:d,worstSection:o})}}catch(e){console.error("Error loading listening results:",e)}finally{B(!1)}};return T?r.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:r.jsx(c,{})}):r.jsxs("div",{className:"min-h-screen bg-background",children:[r.jsx(b,{}),r.jsx("div",{className:"border-b border-border/40 bg-background/95 backdrop-blur",children:r.jsx("div",{className:"container mx-auto px-6 py-4",children:r.jsx("div",{className:"flex items-center justify-between",children:r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsxs(n,{variant:"ghost",onClick:()=>S("/dashboard"),children:[r.jsx(i,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]}),r.jsxs("div",{children:[r.jsxs("h1",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:[r.jsx(l,{className:"w-6 h-6 text-green-600"}),"Listening Test Results"]}),r.jsx("p",{className:"text-muted-foreground",children:"Detailed analysis of your listening performance"})]})]})})})}),r.jsxs("div",{className:"container mx-auto px-6 py-8",children:[r.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-4 mb-8",children:[r.jsxs(d,{children:[r.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(m,{className:"text-sm font-medium",children:"Total Tests"}),r.jsx(v,{className:"h-4 w-4 text-muted-foreground"})]}),r.jsxs(x,{children:[r.jsx("div",{className:"text-2xl font-bold",children:L.totalTests}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"Listening tests completed"})]})]}),r.jsxs(d,{children:[r.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(m,{className:"text-sm font-medium",children:"Average Band Score"}),r.jsx(h,{className:"h-4 w-4 text-muted-foreground"})]}),r.jsxs(x,{children:[r.jsx("div",{className:"text-2xl font-bold",children:L.averageBandScore}),r.jsxs("p",{className:"text-xs text-muted-foreground",children:[L.averageScore,"/40 questions correct"]})]})]}),r.jsxs(d,{children:[r.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(m,{className:"text-sm font-medium",children:"Sections Completed"}),r.jsx(y,{className:"h-4 w-4 text-muted-foreground"})]}),r.jsxs(x,{children:[r.jsx("div",{className:"text-2xl font-bold",children:L.totalSections}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"Individual sections"})]})]}),r.jsxs(d,{children:[r.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(m,{className:"text-sm font-medium",children:"Performance"}),r.jsx(j,{className:"h-4 w-4 text-muted-foreground"})]}),r.jsxs(x,{children:[r.jsxs("div",{className:"text-2xl font-bold",children:[Math.round(L.averageScore/40*100),"%"]}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"Average accuracy"})]})]})]}),L.bestSection&&r.jsxs("div",{className:"grid gap-6 md:grid-cols-2 mb-8",children:[r.jsxs(d,{children:[r.jsx(o,{children:r.jsxs(m,{className:"text-lg flex items-center gap-2",children:[r.jsx(u,{className:"w-5 h-5 text-green-600"}),"Best Performing Section"]})}),r.jsx(x,{children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(g,{variant:"secondary",className:"bg-green-50 text-green-700",children:L.bestSection}),r.jsx("span",{className:"text-sm text-muted-foreground",children:"Keep up the great work!"})]})})]}),r.jsxs(d,{children:[r.jsx(o,{children:r.jsxs(m,{className:"text-lg flex items-center gap-2",children:[r.jsx(f,{className:"w-5 h-5 text-red-600"}),"Area for Improvement"]})}),r.jsx(x,{children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(g,{variant:"secondary",className:"bg-red-50 text-red-700",children:L.worstSection}),r.jsx("span",{className:"text-sm text-muted-foreground",children:"Focus more practice here"})]})})]})]}),r.jsxs(d,{children:[r.jsx(o,{children:r.jsx(m,{className:"text-lg",children:"Recent Listening Tests"})}),r.jsx(x,{children:_.length>0?r.jsx("div",{className:"space-y-4",children:_.map(e=>r.jsxs("div",{className:"border rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsxs("h3",{className:"font-medium flex items-center gap-2",children:[r.jsx(l,{className:"w-4 h-4"}),e.section_title||`Section ${e.section_number}`]}),r.jsxs("div",{className:"flex items-center gap-2",children:[e.audio_url&&r.jsxs(n,{variant:"outline",size:"sm",children:[r.jsx(p,{className:"w-3 h-3 mr-1"}),"Listen"]}),r.jsxs(g,{variant:"outline",children:["Band ",a(Math.round(e.section_score/e.section_total*40),"listening")]})]})]}),r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[r.jsxs("div",{children:[r.jsx("span",{className:"text-muted-foreground",children:"Score:"}),r.jsxs("span",{className:"ml-2 font-medium",children:[e.section_score,"/",e.section_total]})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-muted-foreground",children:"Accuracy:"}),r.jsxs("span",{className:"ml-2 font-medium",children:[Math.round(e.section_score/e.section_total*100),"%"]})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-muted-foreground",children:"Date:"}),r.jsx("span",{className:"ml-2 font-medium",children:new Date(e.created_at).toLocaleDateString()})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-muted-foreground",children:"Section:"}),r.jsx("span",{className:"ml-2 font-medium",children:e.section_number})]})]}),e.detailed_feedback&&r.jsx("div",{className:"mt-3 p-3 bg-muted/50 rounded",children:r.jsx("p",{className:"text-sm text-muted-foreground",children:e.detailed_feedback})})]},e.id))}):r.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[r.jsx(l,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),r.jsx("p",{children:"No listening test results yet"}),r.jsx("p",{className:"text-sm",children:"Start practicing to see your progress here"}),r.jsx(n,{onClick:()=>S("/ielts-portal"),className:"mt-4",children:"Take a Listening Test"})]})})]})]})]})};export{S as default};
