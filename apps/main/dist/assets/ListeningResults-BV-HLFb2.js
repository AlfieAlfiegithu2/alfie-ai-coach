import{u as e,r as s,j as t}from"./vendor-react-rLLBBC7n.js";import{E as r,s as a,H as n,x as c,B as i,C as l,b as d,c as o,a as m,e as x}from"./index-BDl0jLJK.js";import{H as h}from"./Header-B_feYwRL.js";import{az as j,aJ as u,be as g,K as f,aQ as p,H as N,at as v,aI as b,aL as S}from"./vendor-ui-BGi_EvHx.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-charts-0DeywwxG.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";import"./dropdown-menu-DF6eZyHV.js";const w=()=>{const w=e(),{user:y}=r(),[_,k]=s.useState([]),[T,B]=s.useState(!0),[L,D]=s.useState({totalTests:0,averageScore:0,averageBandScore:0,totalSections:0,bestSection:"",worstSection:""});s.useEffect(()=>{y&&E()},[y]);const E=async()=>{try{const{data:e,error:s}=await a.from("listening_test_results").select("*").eq("user_id",null==y?void 0:y.id).order("created_at",{ascending:!1});if(s)return void console.error("Error fetching listening results:",s);if(k(e||[]),e&&e.length>0){const s=e.length,t=e.reduce((e,s)=>e+(s.section_score||0),0),r=e.reduce((e,s)=>e+(s.section_total||10),0),a=r>0?Math.round(t/r*40):0,c=n(a,"listening"),i={};e.forEach(e=>{const s=`Section ${e.section_number}`;i[s]||(i[s]={correct:0,total:0}),i[s].correct+=e.section_score||0,i[s].total+=e.section_total||10});const l=Object.entries(i).map(([e,s])=>({section:e,percentage:s.total>0?s.correct/s.total*100:0})).sort((e,s)=>s.percentage-e.percentage),d=l.length>0?l[0].section:"",o=l.length>0?l[l.length-1].section:"";D({totalTests:Math.ceil(s/4),averageScore:a,averageBandScore:c,totalSections:s,bestSection:d,worstSection:o})}}catch(e){console.error("Error loading listening results:",e)}finally{B(!1)}};return T?t.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:t.jsx(c,{})}):t.jsxs("div",{className:"min-h-screen bg-background",children:[t.jsx(h,{}),t.jsx("div",{className:"border-b border-border/40 bg-background/95 backdrop-blur",children:t.jsx("div",{className:"container mx-auto px-6 py-4",children:t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs(i,{variant:"ghost",onClick:()=>w("/dashboard"),children:[t.jsx(j,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]}),t.jsxs("div",{children:[t.jsxs("h1",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:[t.jsx(u,{className:"w-6 h-6 text-green-600"}),"Listening Test Results"]}),t.jsx("p",{className:"text-muted-foreground",children:"Detailed analysis of your listening performance"})]})]})})})}),t.jsxs("div",{className:"container mx-auto px-6 py-8",children:[t.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-4 mb-8",children:[t.jsxs(l,{children:[t.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(o,{className:"text-sm font-medium",children:"Total Tests"}),t.jsx(g,{className:"h-4 w-4 text-muted-foreground"})]}),t.jsxs(m,{children:[t.jsx("div",{className:"text-2xl font-bold",children:L.totalTests}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Listening tests completed"})]})]}),t.jsxs(l,{children:[t.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(o,{className:"text-sm font-medium",children:"Average Band Score"}),t.jsx(f,{className:"h-4 w-4 text-muted-foreground"})]}),t.jsxs(m,{children:[t.jsx("div",{className:"text-2xl font-bold",children:L.averageBandScore}),t.jsxs("p",{className:"text-xs text-muted-foreground",children:[L.averageScore,"/40 questions correct"]})]})]}),t.jsxs(l,{children:[t.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(o,{className:"text-sm font-medium",children:"Sections Completed"}),t.jsx(p,{className:"h-4 w-4 text-muted-foreground"})]}),t.jsxs(m,{children:[t.jsx("div",{className:"text-2xl font-bold",children:L.totalSections}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Individual sections"})]})]}),t.jsxs(l,{children:[t.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(o,{className:"text-sm font-medium",children:"Performance"}),t.jsx(N,{className:"h-4 w-4 text-muted-foreground"})]}),t.jsxs(m,{children:[t.jsxs("div",{className:"text-2xl font-bold",children:[Math.round(L.averageScore/40*100),"%"]}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Average accuracy"})]})]})]}),L.bestSection&&t.jsxs("div",{className:"grid gap-6 md:grid-cols-2 mb-8",children:[t.jsxs(l,{children:[t.jsx(d,{children:t.jsxs(o,{className:"text-lg flex items-center gap-2",children:[t.jsx(v,{className:"w-5 h-5 text-green-600"}),"Best Performing Section"]})}),t.jsx(m,{children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(x,{variant:"secondary",className:"bg-green-50 text-green-700",children:L.bestSection}),t.jsx("span",{className:"text-sm text-muted-foreground",children:"Keep up the great work!"})]})})]}),t.jsxs(l,{children:[t.jsx(d,{children:t.jsxs(o,{className:"text-lg flex items-center gap-2",children:[t.jsx(b,{className:"w-5 h-5 text-red-600"}),"Area for Improvement"]})}),t.jsx(m,{children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(x,{variant:"secondary",className:"bg-red-50 text-red-700",children:L.worstSection}),t.jsx("span",{className:"text-sm text-muted-foreground",children:"Focus more practice here"})]})})]})]}),t.jsxs(l,{children:[t.jsx(d,{children:t.jsx(o,{className:"text-lg",children:"Recent Listening Tests"})}),t.jsx(m,{children:_.length>0?t.jsx("div",{className:"space-y-4",children:_.map(e=>t.jsxs("div",{className:"border rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("h3",{className:"font-medium flex items-center gap-2",children:[t.jsx(u,{className:"w-4 h-4"}),e.section_title||`Section ${e.section_number}`]}),t.jsxs("div",{className:"flex items-center gap-2",children:[e.audio_url&&t.jsxs(i,{variant:"outline",size:"sm",children:[t.jsx(S,{className:"w-3 h-3 mr-1"}),"Listen"]}),t.jsxs(x,{variant:"outline",children:["Band ",n(Math.round(e.section_score/e.section_total*40),"listening")]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-muted-foreground",children:"Score:"}),t.jsxs("span",{className:"ml-2 font-medium",children:[e.section_score,"/",e.section_total]})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-muted-foreground",children:"Accuracy:"}),t.jsxs("span",{className:"ml-2 font-medium",children:[Math.round(e.section_score/e.section_total*100),"%"]})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-muted-foreground",children:"Date:"}),t.jsx("span",{className:"ml-2 font-medium",children:new Date(e.created_at).toLocaleDateString()})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-muted-foreground",children:"Section:"}),t.jsx("span",{className:"ml-2 font-medium",children:e.section_number})]})]}),e.detailed_feedback&&t.jsx("div",{className:"mt-3 p-3 bg-muted/50 rounded",children:t.jsx("p",{className:"text-sm text-muted-foreground",children:e.detailed_feedback})})]},e.id))}):t.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[t.jsx(u,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),t.jsx("p",{children:"No listening test results yet"}),t.jsx("p",{className:"text-sm",children:"Start practicing to see your progress here"}),t.jsx(i,{onClick:()=>w("/ielts-portal"),className:"mt-4",children:"Take a Listening Test"})]})})]})]})]})};export{w as default};
