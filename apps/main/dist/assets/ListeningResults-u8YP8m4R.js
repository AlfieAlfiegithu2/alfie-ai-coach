import{u as e,A as s,r as t,Z as r,j as a,am as c,B as n,$ as i,H as l,C as d,b as o,c as m,a as x,R as h,Q as j,bd as u,k as g,br as f,ai as p}from"./index-COvyJ41k.js";import{s as N}from"./supabase-DUkWVuqu.js";import{H as b}from"./Header-CF6h1gsw.js";import{T as v}from"./trophy-rs_Mdq9K.js";import{C as S}from"./chart-column-v1PqZ2yZ.js";import"./dropdown-menu-73Wuvq1G.js";import"./shield-D6_j-fxd.js";const w=()=>{const w=e(),{user:y}=s(),[_,k]=t.useState([]),[T,B]=t.useState(!0),[L,A]=t.useState({totalTests:0,averageScore:0,averageBandScore:0,totalSections:0,bestSection:"",worstSection:""});t.useEffect(()=>{y&&C()},[y]);const C=async()=>{try{const{data:e,error:s}=await N.from("listening_test_results").select("*").eq("user_id",null==y?void 0:y.id).order("created_at",{ascending:!1});if(s)return void console.error("Error fetching listening results:",s);if(k(e||[]),e&&e.length>0){const s=e.length,t=e.reduce((e,s)=>e+(s.section_score||0),0),a=e.reduce((e,s)=>e+(s.section_total||10),0),c=a>0?Math.round(t/a*40):0,n=r(c,"listening"),i={};e.forEach(e=>{const s=`Section ${e.section_number}`;i[s]||(i[s]={correct:0,total:0}),i[s].correct+=e.section_score||0,i[s].total+=e.section_total||10});const l=Object.entries(i).map(([e,s])=>({section:e,percentage:s.total>0?s.correct/s.total*100:0})).sort((e,s)=>s.percentage-e.percentage),d=l.length>0?l[0].section:"",o=l.length>0?l[l.length-1].section:"";A({totalTests:Math.ceil(s/4),averageScore:c,averageBandScore:n,totalSections:s,bestSection:d,worstSection:o})}}catch(e){console.error("Error loading listening results:",e)}finally{B(!1)}};return T?a.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:a.jsx(c,{})}):a.jsxs("div",{className:"min-h-screen bg-background",children:[a.jsx(b,{}),a.jsx("div",{className:"border-b border-border/40 bg-background/95 backdrop-blur",children:a.jsx("div",{className:"container mx-auto px-6 py-4",children:a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsxs(n,{variant:"ghost",onClick:()=>w("/dashboard"),children:[a.jsx(i,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]}),a.jsxs("div",{children:[a.jsxs("h1",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:[a.jsx(l,{className:"w-6 h-6 text-green-600"}),"Listening Test Results"]}),a.jsx("p",{className:"text-muted-foreground",children:"Detailed analysis of your listening performance"})]})]})})})}),a.jsxs("div",{className:"container mx-auto px-6 py-8",children:[a.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-4 mb-8",children:[a.jsxs(d,{children:[a.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(m,{className:"text-sm font-medium",children:"Total Tests"}),a.jsx(v,{className:"h-4 w-4 text-muted-foreground"})]}),a.jsxs(x,{children:[a.jsx("div",{className:"text-2xl font-bold",children:L.totalTests}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Listening tests completed"})]})]}),a.jsxs(d,{children:[a.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(m,{className:"text-sm font-medium",children:"Average Band Score"}),a.jsx(h,{className:"h-4 w-4 text-muted-foreground"})]}),a.jsxs(x,{children:[a.jsx("div",{className:"text-2xl font-bold",children:L.averageBandScore}),a.jsxs("p",{className:"text-xs text-muted-foreground",children:[L.averageScore,"/40 questions correct"]})]})]}),a.jsxs(d,{children:[a.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(m,{className:"text-sm font-medium",children:"Sections Completed"}),a.jsx(S,{className:"h-4 w-4 text-muted-foreground"})]}),a.jsxs(x,{children:[a.jsx("div",{className:"text-2xl font-bold",children:L.totalSections}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Individual sections"})]})]}),a.jsxs(d,{children:[a.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(m,{className:"text-sm font-medium",children:"Performance"}),a.jsx(j,{className:"h-4 w-4 text-muted-foreground"})]}),a.jsxs(x,{children:[a.jsxs("div",{className:"text-2xl font-bold",children:[Math.round(L.averageScore/40*100),"%"]}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Average accuracy"})]})]})]}),L.bestSection&&a.jsxs("div",{className:"grid gap-6 md:grid-cols-2 mb-8",children:[a.jsxs(d,{children:[a.jsx(o,{children:a.jsxs(m,{className:"text-lg flex items-center gap-2",children:[a.jsx(u,{className:"w-5 h-5 text-green-600"}),"Best Performing Section"]})}),a.jsx(x,{children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(g,{variant:"secondary",className:"bg-green-50 text-green-700",children:L.bestSection}),a.jsx("span",{className:"text-sm text-muted-foreground",children:"Keep up the great work!"})]})})]}),a.jsxs(d,{children:[a.jsx(o,{children:a.jsxs(m,{className:"text-lg flex items-center gap-2",children:[a.jsx(f,{className:"w-5 h-5 text-red-600"}),"Area for Improvement"]})}),a.jsx(x,{children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(g,{variant:"secondary",className:"bg-red-50 text-red-700",children:L.worstSection}),a.jsx("span",{className:"text-sm text-muted-foreground",children:"Focus more practice here"})]})})]})]}),a.jsxs(d,{children:[a.jsx(o,{children:a.jsx(m,{className:"text-lg",children:"Recent Listening Tests"})}),a.jsx(x,{children:_.length>0?a.jsx("div",{className:"space-y-4",children:_.map(e=>a.jsxs("div",{className:"border rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("h3",{className:"font-medium flex items-center gap-2",children:[a.jsx(l,{className:"w-4 h-4"}),e.section_title||`Section ${e.section_number}`]}),a.jsxs("div",{className:"flex items-center gap-2",children:[e.audio_url&&a.jsxs(n,{variant:"outline",size:"sm",children:[a.jsx(p,{className:"w-3 h-3 mr-1"}),"Listen"]}),a.jsxs(g,{variant:"outline",children:["Band ",r(Math.round(e.section_score/e.section_total*40),"listening")]})]})]}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-muted-foreground",children:"Score:"}),a.jsxs("span",{className:"ml-2 font-medium",children:[e.section_score,"/",e.section_total]})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-muted-foreground",children:"Accuracy:"}),a.jsxs("span",{className:"ml-2 font-medium",children:[Math.round(e.section_score/e.section_total*100),"%"]})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-muted-foreground",children:"Date:"}),a.jsx("span",{className:"ml-2 font-medium",children:new Date(e.created_at).toLocaleDateString()})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-muted-foreground",children:"Section:"}),a.jsx("span",{className:"ml-2 font-medium",children:e.section_number})]})]}),e.detailed_feedback&&a.jsx("div",{className:"mt-3 p-3 bg-muted/50 rounded",children:a.jsx("p",{className:"text-sm text-muted-foreground",children:e.detailed_feedback})})]},e.id))}):a.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[a.jsx(l,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),a.jsx("p",{children:"No listening test results yet"}),a.jsx("p",{className:"text-sm",children:"Start practicing to see your progress here"}),a.jsx(n,{onClick:()=>w("/ielts-portal"),className:"mt-4",children:"Take a Listening Test"})]})})]})]})]})};export{w as default};
