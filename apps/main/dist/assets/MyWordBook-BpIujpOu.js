import{r as e,ak as r,j as o,u as a,A as t,g as s,al as n,C as l,a as i,U as c,B as d,_ as m,d as u}from"./index-D2Tta13M.js";import{s as g}from"./supabase-DUkWVuqu.js";import{C as b}from"./checkbox-BlFP92Mb.js";const h=e.memo(({word:a,onRemove:t,isEditMode:s=!1,isSelected:n=!1,onToggleSelect:l})=>{var i;const[c,d]=e.useState(!1),[m,u]=e.useState(0),h=e.useRef(null),f=r(),x=["US","UK","AUS","IND"],y=async()=>{if(c)return window.speechSynthesis.cancel(),h.current&&(h.current.pause(),h.current.currentTime=0),void d(!1);const e=x[m];u(e=>(e+1)%x.length),d(!0);try{console.log(`ðŸŽµ Playing ${e} accent for:`,a.word);const{data:r,error:o}=await g.functions.invoke("audio-cache",{body:{text:a.word,accent:e,question_id:`word-${a.word}-${e}-${Date.now()}`}});if(o)throw o;if((null==r?void 0:r.success)&&(null==r?void 0:r.audio_url)){console.log("âœ… ElevenLabs Success! Playing high-quality audio:",r.audio_url);const e=new Audio(r.audio_url);return h.current=e,e.addEventListener("error",e=>{console.error("Audio playback error:",e),p()}),e.addEventListener("ended",()=>{d(!1)}),await e.play(),void console.log("ðŸŽµ High-quality audio playing successfully")}}catch(r){console.log("ElevenLabs failed, using browser TTS fallback:",r.message)}p()},p=()=>{console.log("ðŸ”„ Using browser TTS fallback");const e=new SpeechSynthesisUtterance(a.word);e.rate=.8,e.volume=1;const r=window.speechSynthesis.getVoices();let o=r.find(e=>e.name.includes("Google")&&e.lang.startsWith("en"))||r.find(e=>e.lang.startsWith("en"));o&&(e.voice=o),e.onend=()=>d(!1),e.onerror=()=>d(!1),window.speechSynthesis.speak(e)};return o.jsxs("div",{className:"relative",children:[s&&o.jsx("div",{className:"absolute -top-2 -left-2 z-20",children:o.jsx(b,{checked:n,onCheckedChange:()=>null==l?void 0:l(a.id),className:"w-6 h-6 rounded-full shadow-sm transition-all",style:{backgroundColor:"glassmorphism"===f.theme.name||"dark"===f.theme.name?"rgba(255,255,255,0.9)":"minimalist"===f.theme.name?"#ffffff":"rgba(255,255,255,0.9)",borderColor:f.border,borderWidth:"2px"}})}),o.jsx("div",{className:"word-card word-card-hover-reveal "+(s?"cursor-pointer":"cursor-pointer hover:shadow-lg transition-shadow"),onClick:e=>{if(s)return e.preventDefault(),void(null==l||l(a.id));y()},style:{fontFamily:"Bricolage Grotesque, sans-serif",background:"glassmorphism"===f.theme.name||"dark"===f.theme.name?"rgba(255,255,255,0.1)":"minimalist"===f.theme.name?"#ffffff":f.theme.colors.cardBackground,borderColor:f.border,color:f.textPrimary,backdropFilter:"glassmorphism"===f.theme.name||"dark"===f.theme.name?"blur(16px)":"none",boxShadow:"note"===f.theme.name?null==(i=f.theme.styles.cardStyle)?void 0:i.boxShadow:"none"},children:o.jsxs("div",{className:"text-center relative h-full flex flex-col items-center justify-center",children:[o.jsxs("div",{className:"word-card-content word-card-word absolute inset-0 flex flex-col items-center justify-center transition-all duration-300 ease-in-out",children:[o.jsx("div",{className:"font-bold text-lg mb-1",style:{color:f.textPrimary},children:a.word}),a.context&&o.jsx("div",{className:"text-xs px-2 py-1 rounded-full inline-block",style:{opacity:.7,backgroundColor:"glassmorphism"===f.theme.name||"dark"===f.theme.name?"rgba(255,255,255,0.2)":"minimalist"===f.theme.name?"#f3f4f6":"rgba(255,255,255,0.6)",color:f.textSecondary},children:a.context})]}),o.jsx("div",{className:"word-card-content word-card-translation absolute inset-0 flex items-center justify-center transition-all duration-300 ease-in-out opacity-0 pointer-events-none",children:o.jsx("div",{className:"font-bold text-lg text-center",style:{color:f.textPrimary},children:a.translations&&a.translations.length>0?a.translations.join(", "):"No translation available"})})]})})]})}),f=()=>{const b=a(),{user:f,profile:x,refreshProfile:y,loading:p}=t(),{toast:v}=s(),k=r(),[w,j]=e.useState([]),[N,C]=e.useState(!0),[S,P]=e.useState(!1);e.useState(new Set),e.useEffect(()=>{const e=new Image;e.onload=()=>P(!0),e.src="/lovable-uploads/5d9b151b-eb54-41c3-a578-e70139faa878.png",f&&T()},[f]);const T=async()=>{try{C(!0),console.log("ðŸ“– Fetching word book from user_vocabulary table...");const{data:e,error:r}=await g.from("user_vocabulary").select("id, word, part_of_speech, translations, created_at").order("created_at",{ascending:!1});if(console.log("ðŸ“Š Word book response:",{data:e,error:r,count:null==e?void 0:e.length}),r)throw console.error("Database error:",r),new Error(`Database error: ${r.message}`);const o=(null==e?void 0:e.map(e=>({id:e.id,word:e.word,translations:e.translations||["No translation available"],context:"",savedAt:e.created_at,languageCode:"en"})))||[];console.log("âœ… Successfully loaded",o.length,"words"),j(o)}catch(e){console.error("âŒ Error fetching word book:",e),v({title:"Failed to Load Word Book",description:`Could not load your word book: ${e.message}`,variant:"destructive",duration:4e3}),j([])}finally{C(!1)}},E=async e=>{try{console.log("ðŸ—‘ï¸ Removing word:",e);const{error:r}=await g.from("user_vocabulary").delete().eq("id",e);if(r)throw console.error("Database error removing word:",r),new Error(`Database error: ${r.message}`);j(r=>r.filter(r=>r.id!==e)),v({title:"âœ… Word Removed",description:"The word has been removed from your Word Book.",duration:3e3}),console.log("âœ… Successfully removed word")}catch(r){console.error("âŒ Error removing word:",r),v({title:"Failed to Remove Word",description:r.message||"Could not remove word. Please try again.",variant:"destructive",duration:4e3})}};return p?o.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:k.backgroundImageColor},children:o.jsx(n,{})}):p||f?N||!S?o.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:k.backgroundImageColor},children:o.jsx(n,{})}):o.jsxs("div",{className:"min-h-screen relative",style:{backgroundColor:"dark"===k.theme.name?k.theme.colors.background:"transparent"},children:[o.jsx("div",{className:"absolute inset-0 bg-contain bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"note"===k.theme.name||"minimalist"===k.theme.name||"dark"===k.theme.name?"none":"url('/lovable-uploads/5d9b151b-eb54-41c3-a578-e70139faa878.png')",backgroundColor:k.backgroundImageColor}}),o.jsxs("div",{className:"relative z-10 min-h-full lg:py-10 lg:px-6 pt-6 pr-4 pb-6 pl-4",children:[o.jsxs("header",{className:"flex sm:px-6 lg:px-12 lg:py-5 pt-4 pr-4 pb-4 pl-4 items-center border-b relative",style:{borderColor:k.border+"60"},children:[o.jsx("div",{className:"absolute left-4 sm:left-6 lg:left-12",children:o.jsx(d,{variant:"ghost",size:"sm",onClick:()=>b("/dashboard"),className:"flex items-center p-2",style:{fontFamily:"Inter, sans-serif",color:k.textSecondary},onMouseEnter:e=>e.currentTarget.style.color=k.buttonPrimary,onMouseLeave:e=>e.currentTarget.style.color=k.textSecondary,children:o.jsx(m,{className:"w-4 h-4"})})}),o.jsx("div",{className:"flex-1 flex justify-center items-center",children:o.jsx("h1",{className:"text-xl lg:text-2xl tracking-tight font-semibold text-center",style:{fontFamily:"Bricolage Grotesque, sans-serif",color:k.textPrimary},children:"My Word Book"})}),o.jsx("div",{className:"w-10 sm:w-12 lg:w-16"})]}),o.jsx("main",{className:"relative sm:px-6 lg:px-12 pr-4 pb-12 pl-4 pt-10 lg:pt-12",children:0===w.length?o.jsxs("div",{className:"text-center py-16",children:[o.jsx(u,{className:"w-20 h-20 mx-auto mb-6",style:{color:k.textSecondary+"80"}}),o.jsx("h3",{className:"text-2xl font-semibold mb-4",style:{fontFamily:"Bricolage Grotesque, sans-serif",color:k.textPrimary},children:"Your Word Book is empty"}),o.jsx("p",{className:"mb-8 max-w-md mx-auto",style:{fontFamily:"Inter, sans-serif",color:k.textSecondary},children:'Start building your vocabulary by selecting words during reading tests and clicking "Add to Word Book" in the translation popup.'}),o.jsx(d,{onClick:()=>b("/ielts-portal"),className:"px-6 py-3 rounded-xl backdrop-blur-sm border text-white",style:{backgroundColor:k.buttonPrimary,borderColor:k.border,fontFamily:"Inter, sans-serif"},onMouseEnter:e=>e.currentTarget.style.backgroundColor=k.buttonPrimaryHover,onMouseLeave:e=>e.currentTarget.style.backgroundColor=k.buttonPrimary,children:"Start Learning"})]}):o.jsx(o.Fragment,{children:o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 word-card-grid",children:w.map(e=>o.jsx(h,{word:e,onRemove:E,isEditMode:!1,isSelected:!1,onToggleSelect:void 0},e.id))})})})]})]}):o.jsxs("div",{className:"min-h-screen relative",style:{backgroundColor:"dark"===k.theme.name?k.theme.colors.background:"transparent"},children:[o.jsx("div",{className:"absolute inset-0 bg-contain bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"note"===k.theme.name||"minimalist"===k.theme.name||"dark"===k.theme.name?"none":"url('/lovable-uploads/5d9b151b-eb54-41c3-a578-e70139faa878.png')",backgroundColor:k.backgroundImageColor}}),o.jsx("div",{className:"relative z-10 min-h-full flex items-center justify-center",children:o.jsx(l,{className:"p-8 text-center backdrop-blur-xl shadow-xl border rounded-xl",style:{backgroundColor:k.backgroundOverlay,borderColor:k.border},children:o.jsxs(i,{children:[o.jsxs("div",{className:"mb-4",children:[o.jsx(c,{className:"w-16 h-16 mx-auto mb-4",style:{color:k.textSecondary}}),o.jsx("h2",{className:"text-xl font-semibold mb-2",style:{fontFamily:"Bricolage Grotesque, sans-serif",color:k.textPrimary},children:"Sign in Required"}),o.jsx("p",{className:"mb-6",style:{fontFamily:"Inter, sans-serif",color:k.textSecondary},children:"Please sign in to access your Word Book and save your progress."})]}),o.jsxs("div",{className:"flex gap-3 justify-center",children:[o.jsx(d,{onClick:()=>b("/auth"),className:"px-6 py-2 text-white",style:{backgroundColor:k.buttonPrimary,fontFamily:"Inter, sans-serif"},onMouseEnter:e=>e.currentTarget.style.backgroundColor=k.buttonPrimaryHover,onMouseLeave:e=>e.currentTarget.style.backgroundColor=k.buttonPrimary,children:"Sign In"}),o.jsx(d,{onClick:()=>b("/dashboard"),variant:"outline",className:"px-6 py-2",style:{backgroundColor:"glassmorphism"===k.theme.name||"dark"===k.theme.name?"rgba(255,255,255,0.1)":"minimalist"===k.theme.name?"#ffffff":"rgba(255,255,255,0.5)",borderColor:k.border,color:k.textPrimary,fontFamily:"Inter, sans-serif"},onMouseEnter:e=>e.currentTarget.style.backgroundColor=k.hoverBg,onMouseLeave:e=>e.currentTarget.style.backgroundColor="glassmorphism"===k.theme.name||"dark"===k.theme.name?"rgba(255,255,255,0.1)":"minimalist"===k.theme.name?"#ffffff":"rgba(255,255,255,0.5)",children:"Go to Dashboard"})]})]})})})]})};export{f as default};
