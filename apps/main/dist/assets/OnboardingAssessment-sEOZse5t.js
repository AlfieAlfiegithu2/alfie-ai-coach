import{r as e,u as a,h as i,am as t,j as l,c7 as n}from"./index-BQgnpnc4.js";import{T as s}from"./taskBank-C_v_y-ZR.js";import{s as r}from"./supabase-DWL4C3fA.js";const o=[{id:"goal",type:"multi",prompt:"What is your main goal?",choices:[{id:"general",label:"General English"},{id:"ielts",label:"IELTS"},{id:"toeic",label:"TOEIC"},{id:"work",label:"Work/Business"},{id:"travel",label:"Travel"}]},{id:"study_days",type:"multi",prompt:"Which days will you study each week?",multiSelect:!0,choices:[{id:"0",label:"Sun"},{id:"1",label:"Mon"},{id:"2",label:"Tue"},{id:"3",label:"Wed"},{id:"4",label:"Thu"},{id:"5",label:"Fri"},{id:"6",label:"Sat"}]},{id:"first_language",type:"multi",prompt:"What is your first language?",choices:[{id:"ko",label:"Korean"},{id:"ja",label:"Japanese"},{id:"zh",label:"Chinese"},{id:"vi",label:"Vietnamese"},{id:"es",label:"Spanish"},{id:"pt",label:"Portuguese"},{id:"ru",label:"Russian"},{id:"ar",label:"Arabic"},{id:"hi",label:"Hindi"},{id:"fr",label:"French"},{id:"de",label:"German"},{id:"other",label:"Other"}]},{id:"plan_native_language",type:"multi",prompt:"Do you want your plan generated in your first language?",choices:[{id:"yes",label:"Yes"},{id:"no",label:"No"}]},{id:"writing_q1",type:"multi",prompt:"Writing Task 2: Choose the strongest thesis statement for the topic: “Some people think studying art in school is a waste of time.”",choices:[{id:"a",label:"Art is important and should be studied by everyone.",value:0},{id:"b",label:"Although some believe art is unnecessary, it develops creativity and cultural awareness and thus deserves a central place in school curricula.",value:1},{id:"c",label:"Art is fun for some students.",value:0}]},{id:"writing_q2",type:"multi",prompt:"Writing Task 1: Which sentence best describes a chart where exports fell from 60 to 40 while imports rose from 30 to 50?",choices:[{id:"a",label:"Both exports and imports increased steadily.",value:0},{id:"b",label:"Exports declined markedly as imports climbed, reversing the initial gap.",value:1},{id:"c",label:"Imports and exports stayed the same.",value:0}]},{id:"writing_q3",type:"multi",prompt:"Coherence: Choose the most logical order of sentences (1) In addition, libraries host quiet study spaces. (2) Libraries remain vital for communities. (3) They provide free access to information. (4) As a result, people of all ages benefit.",choices:[{id:"a",label:"2 → 3 → 1 → 4",value:1},{id:"b",label:"3 → 2 → 1 → 4",value:0},{id:"c",label:"2 → 1 → 3 → 4",value:0}]},{id:"writing_q4",type:"multi",prompt:"Register: Select the more formal alternative: “kids should get free tickets.”",choices:[{id:"a",label:"children ought to receive complimentary tickets",value:1},{id:"b",label:"kids must get free tickets ASAP",value:0},{id:"c",label:"give kids free tickets",value:0}]},{id:"target_deadline",type:"date",prompt:"When is your target exam date or deadline?"},{id:"target_score",type:"multi",prompt:"What is your target IELTS band score?",choices:[{id:"5.0",label:"5.0 or below"},{id:"5.5",label:"5.5"},{id:"6.0",label:"6.0"},{id:"6.5",label:"6.5"},{id:"7.0",label:"7.0"},{id:"7.5",label:"7.5"},{id:"8.0",label:"8.0+"}]},{id:"reading_q1",type:"multi",prompt:"Choose the best completion: The meeting has been ______ to next Monday.",choices:[{id:"a",label:"advanced",value:0},{id:"b",label:"postponed",value:1},{id:"c",label:"expanded",value:0},{id:"d",label:"prepared",value:0}]},{id:"reading_p1_q1",type:"multi",passage:"Many cities have introduced bicycle‑sharing schemes to reduce congestion.\nUsers can rent a bike from docking stations across the city and return it to any station.\nRecent reports suggest a rise in cycling safety awareness but a small increase in minor incidents.",prompt:"Statement: Users must return the bike to the same station they rented it from.",choices:[{id:"true",label:"True",value:0},{id:"false",label:"False",value:1},{id:"ng",label:"Not Given",value:0}]},{id:"reading_p1_q2",type:"multi",passage:"Many cities have introduced bicycle‑sharing schemes to reduce congestion.\nUsers can rent a bike from docking stations across the city and return it to any station.\nRecent reports suggest a rise in cycling safety awareness but a small increase in minor incidents.",prompt:"Statement: Authorities created the schemes to ease traffic.",choices:[{id:"true",label:"True",value:1},{id:"false",label:"False",value:0},{id:"ng",label:"Not Given",value:0}]},{id:"reading_p1_q3",type:"multi",passage:"Many cities have introduced bicycle‑sharing schemes to reduce congestion.\nUsers can rent a bike from docking stations across the city and return it to any station.\nRecent reports suggest a rise in cycling safety awareness but a small increase in minor incidents.",prompt:"Statement: There has been a major drop in accidents.",choices:[{id:"true",label:"True",value:0},{id:"false",label:"False",value:1},{id:"ng",label:"Not Given",value:0}]},{id:"reading_p2_q1",type:"multi",passage:"Researchers examined the effect of short daily walks on concentration.\nParticipants who walked for ten minutes reported improved focus during tasks.\nHowever, the study did not compare the effects with other exercises.",prompt:"Statement: The study found walking improved focus.",choices:[{id:"true",label:"True",value:1},{id:"false",label:"False",value:0},{id:"ng",label:"Not Given",value:0}]},{id:"listening_clip1_q1",type:"multi",audio:"/assets/listening/clip1.mp3",transcript:"Please send me a short summary by lunchtime today.",prompt:"Clip 1: What does the speaker ask you to do?",choices:[{id:"a",label:"send the summary by lunchtime",value:1},{id:"b",label:"book a meeting for tomorrow",value:0},{id:"c",label:"prepare slides for a presentation",value:0},{id:"d",label:"call the client immediately",value:0}]},{id:"grammar_q1",type:"multi",prompt:"Choose the correct sentence.",choices:[{id:"a",label:"The manager have approved the budget.",value:0},{id:"b",label:"The manager has approved the budget.",value:1},{id:"c",label:"The manager approving the budget.",value:0}]},{id:"vocab_q1",type:"multi",prompt:'Which word means "improve"?',choices:[{id:"decline",label:"Decline",value:0},{id:"enhance",label:"Enhance",value:1},{id:"ignore",label:"Ignore",value:0}]},{id:"reading_q2",type:"multi",prompt:"Choose the best completion: Our sales have ______ steadily this quarter.",choices:[{id:"a",label:"risen",value:1},{id:"b",label:"fall",value:0},{id:"c",label:"decrease",value:0},{id:"d",label:"was rising",value:0}]},{id:"reading_q3",type:"multi",prompt:"Choose the best completion: The instructions were not ______ enough.",choices:[{id:"a",label:"clarify",value:0},{id:"b",label:"clear",value:1},{id:"c",label:"clearly",value:0},{id:"d",label:"clarity",value:0}]},{id:"reading_q4",type:"multi",prompt:"Choose the best completion: We will notify you ______ email.",choices:[{id:"a",label:"by",value:1},{id:"b",label:"on",value:0},{id:"c",label:"in",value:0},{id:"d",label:"at",value:0}]},{id:"reading_q5",type:"multi",prompt:"Choose the best completion: The project was completed ______ budget.",choices:[{id:"a",label:"under",value:1},{id:"b",label:"below of",value:0},{id:"c",label:"less",value:0},{id:"d",label:"lower",value:0}]},{id:"listening_clip2_q1",type:"multi",audio:"/assets/listening/clip2.mp3",transcript:"To register for the exam, fill in the online form, upload your ID, and pay the fee.",prompt:"Clip 2: What is the main topic?",choices:[{id:"a",label:"library opening hours",value:0},{id:"b",label:"exam registration steps",value:1},{id:"c",label:"bus timetable changes",value:0},{id:"d",label:"assignment grading policy",value:0}]},{id:"listening_clip3_q1",type:"multi",audio:"/assets/listening/clip3.mp3",transcript:"I will send a follow up email with the details after our call.",prompt:"Clip 3: What will happen next?",choices:[{id:"a",label:"the meeting is cancelled",value:0},{id:"b",label:"the speaker will send a follow‑up email",value:1},{id:"c",label:"the deadline is moved earlier",value:0},{id:"d",label:"the speaker will call the manager now",value:0}]},{id:"grammar_q2",type:"multi",prompt:"Choose the correct sentence.",choices:[{id:"a",label:"There is many reasons to apply.",value:0},{id:"b",label:"There are many reasons to apply.",value:1},{id:"c",label:"There be many reasons to apply.",value:0}]},{id:"grammar_q3",type:"multi",prompt:"Choose the correct completion: The report ______ by Friday.",choices:[{id:"a",label:"must submit",value:0},{id:"b",label:"must be submitted",value:1},{id:"c",label:"must to submit",value:0}]},{id:"grammar_q4",type:"multi",prompt:"Choose the correct completion: I look forward to ______ you.",choices:[{id:"a",label:"meet",value:0},{id:"b",label:"meeting",value:1},{id:"c",label:"to meet",value:0}]},{id:"grammar_q5",type:"multi",prompt:"Choose the correct sentence.",choices:[{id:"a",label:"Each employees receive benefits.",value:0},{id:"b",label:"Each employee receives benefits.",value:1},{id:"c",label:"Each employee receive benefits.",value:0}]},{id:"vocab_q2",type:"multi",prompt:'Which word is closest in meaning to "delayed"?',choices:[{id:"a",label:"postponed",value:1},{id:"b",label:"hired",value:0},{id:"c",label:"arranged",value:0},{id:"d",label:"moved",value:0}]},{id:"vocab_q3",type:"multi",prompt:'Which word is the best opposite of "decline"?',choices:[{id:"a",label:"increase",value:1},{id:"b",label:"reduce",value:0},{id:"c",label:"fall",value:0},{id:"d",label:"lower",value:0}]},{id:"vocab_q4",type:"multi",prompt:'Which word means "require"?',choices:[{id:"a",label:"need",value:1},{id:"b",label:"prefer",value:0},{id:"c",label:"consider",value:0},{id:"d",label:"avoid",value:0}]},{id:"vocab_q5",type:"multi",prompt:"Which word best completes: We will ______ the proposal next week.",choices:[{id:"a",label:"review",value:1},{id:"b",label:"sale",value:0},{id:"c",label:"arrive",value:0},{id:"d",label:"price",value:0}]}];function d(e){return{title:e.label,minutes:e.minutes}}function c(e,a,i,t=["vocab","listening","reading","grammar","writing","speaking"]){const l=(n=2654435761^a+1,function(){let e=n+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296});var n;const r=["A1","A2","B1","B2","C1"],o=r.indexOf(e),c=a>=14?1:0,u=new Set(r.filter((e,a)=>a<=Math.min(r.length-1,o+c))),g={vocab:s.filter(e=>"vocab"===e.skill&&u.has(e.level)).map(d),listening:s.filter(e=>"listening"===e.skill&&u.has(e.level)).map(d),reading:s.filter(e=>"reading"===e.skill&&u.has(e.level)).map(d),grammar:s.filter(e=>"grammar"===e.skill&&u.has(e.level)).map(d),writing:s.filter(e=>"writing"===e.skill&&u.has(e.level)).map(d),speaking:s.filter(e=>"speaking"===e.skill&&u.has(e.level)).map(d)},m=["vocab","listening","reading","grammar","writing","speaking"],p=new Set,h=[...t.filter(e=>m.includes(e)&&!p.has(e)&&(p.add(e),!0)),...m.filter(e=>!p.has(e))],b=[],y=new Set;let v=0,f=Math.floor(l()*h.length);for(;v<i-5&&b.length<5;){const e=h[f%h.length];f+=1;const a=g[e]||[];if(0===a.length)continue;const t=a[Math.floor(l()*a.length)];y.has(t.title)||(v+t.minutes>Math.max(45,i)||(b.push(t),y.add(t.title),v+=t.minutes))}for(;b.length<3;)b.push({title:"Review: flashcards & error log",minutes:10});return b}function u(e,a,i={}){const t=(l=e.overallPct??50)<25?3.5:l<40?4.5:l<56?5.5:l<70?6.5:l<86?7.5:8;var l;const n="ielts"===(null==a?void 0:a.toLowerCase())?i.targetScore??7:i.targetScore??t+1;let s=12;if(i.targetDeadline){const e=new Date(i.targetDeadline),a=new Date,t=Math.max(1,Math.ceil((e.getTime()-a.getTime())/6048e5));isFinite(t)&&t>0&&(s=t)}let r=function(e,a,i){const t=Math.max(0,Math.ceil(2*(a-e)));if(0===t)return 30;const l=1680*t/Math.max(1,i),n=Math.ceil(l/7);return Math.min(180,Math.max(30,n))}(t,n,s);s=Math.min(26,s);const o=Math.max(1,Math.round(s/4)),d=(()=>{try{const e=JSON.parse(i.studyDaysJson||"[]");return Array.isArray(e)?e.map(e=>Number(e)).filter(e=>Number.isFinite(e)):[]}catch{return[]}})(),u=e.subs||{reading:50,listening:50,grammar:50,vocab:50,writing:50},g=Object.entries(u).sort((e,a)=>e[1]-a[1]).map(([e])=>"reading"===e||"listening"===e||"grammar"===e||"vocab"===e||"writing"===e?e:"speaking"),m=g.map(e=>(e=>({vocab:"vocab",listening:"listening",reading:"reading",grammar:"grammar",writing:"writing"}[e]??"speaking"))(e)),p=Array.from({length:s}).map((a,i)=>({week:i+1,days:Array.from({length:7}).map((a,t)=>({day:t+1,tasks:0===d.length||d.includes(t)?c(e.band,7*i+t,r,m):[]}))})),h=function(e){if(!e)return{highlights:[],quickWins:[]};return{Chinese:{highlights:["Focus on articles (a/an/the) and plural forms","Practice linking words in speaking"],quickWins:["Master 20 common article patterns","Record yourself using linking words (however, therefore, etc.)"]},Arabic:{highlights:["Focus on word order and tense consistency","Practice vowel sounds in pronunciation"],quickWins:["Drill subject-verb-object patterns daily","Shadow native speakers for vowel clarity"]},Spanish:{highlights:["Focus on false friends and phrasal verbs","Practice writing without literal translation"],quickWins:["Learn 10 phrasal verbs weekly","Write summaries using English thought patterns"]},French:{highlights:["Focus on false cognates and prepositions","Practice formal vs. informal register"],quickWins:["Master 15 key preposition differences","Study IELTS register requirements"]},Japanese:{highlights:["Focus on articles and subject-verb agreement","Practice direct communication style"],quickWins:["Drill article usage in context","Practice stating opinions directly"]},Korean:{highlights:["Focus on articles and relative clauses","Practice paragraph structure"],quickWins:["Master basic article rules","Outline before writing to improve coherence"]},Russian:{highlights:["Focus on articles and continuous tenses","Practice natural word stress"],quickWins:["Learn article patterns in common contexts","Shadow audio for natural rhythm"]},Portuguese:{highlights:["Focus on false friends and phrasal verbs","Practice question formation"],quickWins:["Study 10 misleading cognates weekly","Drill question word order"]},Hindi:{highlights:["Focus on articles and prepositions","Practice writing complex sentences"],quickWins:["Master article usage rules","Study compound-complex sentence patterns"]},Vietnamese:{highlights:["Focus on verb tenses and word order","Practice consonant clusters"],quickWins:["Drill past/present/future markers","Practice consonant combinations daily"]}}[e]||{highlights:[`Tailored for ${e} speakers`],quickWins:["Focus on areas where your language differs from English"]}}(i.firstLanguage),b=(Object.entries(e.subs).sort((e,a)=>e[1]-a[1])[0]||[])[0]??"mixed",y=d.length>0?`${d.length} days/week`:"daily",v=i.targetDeadline?` by ${new Date(i.targetDeadline).toLocaleDateString()}`:"",f=(i.firstLanguage||"").toLowerCase(),w="yes"===i.planNativeLanguage&&f&&"en"!==f&&"english"!==f;let k=[`Starting level: ${e.band} (≈ IELTS ${t.toFixed(1)})`,`Target: IELTS ${n.toFixed(1)}${v}`,`Study plan: ${r} min/day, ${y}`,`Priority focus: ${b} (${e.subs[b]}%)`,...h.highlights],x=[`Practice ${b} for 15 min daily with immediate feedback`,"Record yourself speaking for 1 min daily, compare to model answers","Learn 10 collocations per day from your weak areas",...h.quickWins];if(w){const a={ko:{hl:[`현재 수준: ${e.band} (IELTS 약 ${t.toFixed(1)})`,`목표: IELTS ${n.toFixed(1)}${v?"까지":""}`,`학습 계획: 하루 ${r}분, ${y}`,`우선 집중 영역: ${b} (${e.subs[b]}%)`],qw:[`매일 ${b} 15분 집중 연습 (즉시 피드백)`,"하루 1분 스피킹 녹음 → 모델 답안과 비교","약점 분야에서 콜로케이션 10개 학습"],map:[[/^Vocabulary:/,"어휘:"],[/^Listening:/,"리스닝:"],[/^Reading:/,"리딩:"],[/^Grammar:/,"문법:"],[/^Writing:/,"라이팅:"],[/^Speaking:/,"스피킹:"]]},ja:{hl:[`現在レベル: ${e.band} (IELTS 約 ${t.toFixed(1)})`,`目標: IELTS ${n.toFixed(1)}${v?"まで":""}`,`学習計画: 1日 ${r}分, ${y}`,`優先フォーカス: ${b} (${e.subs[b]}%)`],qw:[`毎日 ${b} を15分練習（即時フィードバック）`,"1分スピーキングを録音してモデル解答と比較","弱点分野のコロケーションを毎日10個"],map:[[/^Vocabulary:/,"語彙:"],[/^Listening:/,"リスニング:"],[/^Reading:/,"リーディング:"],[/^Grammar:/,"文法:"],[/^Writing:/,"ライティング:"],[/^Speaking:/,"スピーキング:"]]},zh:{hl:[`当前水平: ${e.band} (雅思约 ${t.toFixed(1)})`,`目标: 雅思 ${n.toFixed(1)}${v?"之前":""}`,`学习计划: 每天 ${r} 分钟, ${y}`,`优先重点: ${b} (${e.subs[b]}%)`],qw:[`每天专注练习 ${b} 15 分钟（即时反馈）`,"每天录1分钟口语并与范文比较","弱项领域每天学习10个搭配"],map:[[/^Vocabulary:/,"词汇:"],[/^Listening:/,"听力:"],[/^Reading:/,"阅读:"],[/^Grammar:/,"语法:"],[/^Writing:/,"写作:"],[/^Speaking:/,"口语:"]]},es:{hl:[`Nivel actual: ${e.band} (≈ IELTS ${t.toFixed(1)})`,`Meta: IELTS ${n.toFixed(1)}${v?" antes de la fecha":""}`,`Plan: ${r} min/día, ${y}`,`Enfoque prioritario: ${b} (${e.subs[b]}%)`],qw:[`Practica ${b} 15 min/día con feedback inmediato`,"Graba 1 min de speaking y compáralo con un modelo","Aprende 10 colocaciones diarias de tus áreas débiles"],map:[[/^Vocabulary:/,"Vocabulario:"],[/^Listening:/,"Listening:"],[/^Reading:/,"Reading:"],[/^Grammar:/,"Gramática:"],[/^Writing:/,"Writing:"],[/^Speaking:/,"Speaking:"]]},pt:{hl:[`Nível atual: ${e.band}`,`Meta: IELTS ${n.toFixed(1)}`,`Plano: ${r} min/dia, ${y}`,`Foco prioritário: ${b} (${e.subs[b]}%)`],qw:[`Pratique ${b} 15 min/dia com feedback imediato`,"Grave 1 min de fala e compare com modelo","Aprenda 10 colocações por dia"],map:[[/^Vocabulary:/,"Vocabulário:"],[/^Listening:/,"Listening:"],[/^Reading:/,"Reading:"],[/^Grammar:/,"Gramática:"],[/^Writing:/,"Writing:"],[/^Speaking:/,"Speaking:"]]},fr:{hl:[`Niveau actuel: ${e.band}`,`Objectif: IELTS ${n.toFixed(1)}`,`Plan: ${r} min/jour, ${y}`,`Priorité: ${b} (${e.subs[b]}%)`],qw:[`Pratique ${b} 15 min/jour avec feedback`,"Enregistre 1 min d’expression orale et compare au modèle","Apprends 10 collocations par jour"],map:[[/^Vocabulary:/,"Vocabulaire:"],[/^Listening:/,"Listening:"],[/^Reading:/,"Reading:"],[/^Grammar:/,"Grammaire:"],[/^Writing:/,"Writing:"],[/^Speaking:/,"Speaking:"]]},de:{hl:[`Aktuelles Niveau: ${e.band}`,`Ziel: IELTS ${n.toFixed(1)}`,`Plan: ${r} Min/Tag, ${y}`,`Prioritätsfokus: ${b} (${e.subs[b]}%)`],qw:[`Täglich ${b} 15 Min üben (sofortiges Feedback)`,"Täglich 1 Min Sprechen aufnehmen und mit Modelllösung vergleichen","Lerne 10 Kollokationen pro Tag"],map:[[/^Vocabulary:/,"Wortschatz:"],[/^Listening:/,"Listening:"],[/^Reading:/,"Reading:"],[/^Grammar:/,"Grammatik:"],[/^Writing:/,"Writing:"],[/^Speaking:/,"Speaking:"]]},ru:{hl:[`Текущий уровень: ${e.band}`,`Цель: IELTS ${n.toFixed(1)}`,`План: ${r} мин/день, ${y}`,`Приоритет: ${b} (${e.subs[b]}%)`],qw:[`Ежедневно тренируйте ${b} 15 минут`,"Записывайте 1 минуту речи и сравнивайте с образцом","Учите 10 коллокаций в день"],map:[[/^Vocabulary:/,"Лексика:"],[/^Listening:/,"Аудирование:"],[/^Reading:/,"Чтение:"],[/^Grammar:/,"Грамматика:"],[/^Writing:/,"Письмо:"],[/^Speaking:/,"Говорение:"]]},hi:{hl:[`वर्तमान स्तर: ${e.band}`,`लक्ष्य: IELTS ${n.toFixed(1)}`,`योजना: प्रतिदिन ${r} मिनट, ${y}`,`प्राथमिक फोकस: ${b} (${e.subs[b]}%)`],qw:[`प्रतिदिन ${b} 15 मिनट अभ्यास (तुरंत फीडबैक)`,"1 मिनट स्पीकिंग रिकॉर्ड करें और मॉडल से तुलना करें","कमज़ोर क्षेत्रों की 10 कोलोकेशन्स सीखें"],map:[[/^Vocabulary:/,"शब्दावली:"],[/^Listening:/,"Listening:"],[/^Reading:/,"Reading:"],[/^Grammar:/,"व्याकरण:"],[/^Writing:/,"Writing:"],[/^Speaking:/,"Speaking:"]]},vi:{hl:[`Trình độ hiện tại: ${e.band}`,`Mục tiêu: IELTS ${n.toFixed(1)}`,`Kế hoạch: ${r} phút/ngày, ${y}`,`Trọng tâm ưu tiên: ${b} (${e.subs[b]}%)`],qw:[`Luyện ${b} 15 phút mỗi ngày (phản hồi ngay)`,"Thu âm 1 phút nói và so sánh với mẫu","Học 10 collocation mỗi ngày"],map:[[/^Vocabulary:/,"Từ vựng:"],[/^Listening:/,"Listening:"],[/^Reading:/,"Reading:"],[/^Grammar:/,"Ngữ pháp:"],[/^Writing:/,"Writing:"],[/^Speaking:/,"Speaking:"]]}}[f];if(a){k=[...a.hl,...h.highlights],x=[...a.qw,...h.quickWins];const e=e=>{let i=e;for(const[t,l]of a.map)if(t.test(i)){i=i.replace(t,l);break}if("ko"===f){const e=[[/\bTrue\/False\/Not Given\b/gi,"참/거짓/주어지지 않음"],[/\breference and inference\b/gi,"지시어/추론"],[/\bmatch headings to paragraphs\b/gi,"단락과 제목 매칭"],[/\bmap\/plan completion\b/gi,"지도/도면 완성"],[/\bparaphrase and gist \(short talk\)\b/gi,"패러프레이즈/요지 파악(짧은 담화)"],[/\bSection 1 details \(forms, dates, numbers\)\b/gi,"섹션 1 세부 정보(양식·날짜·숫자)"],[/\bquestions\b/gi,"문항"],[/\b12 academic words \+ 6 collocations\b/gi,"학술 어휘 12개 + 연어 6개"],[/\b10 collocations \(make 5 example sentences\)\b/gi,"연어 10개(예문 5개 작성)"],[/\breview deck \+ 8 new words\b/gi,"복습 카드 + 신규 단어 8개"],[/\barticles & prepositions \(12 items\)\b/gi,"관사·전치사(12문항)"],[/\btense control & SVA \(12 items\)\b/gi,"시제·주어-동사 일치(12문항)"],[/\bcomplex sentences & linkers \(10 items\)\b/gi,"복문·연결어(10문항)"],[/\bTask 1 outline \(data selection \+ comparisons\)\b/gi,"Task 1 개요(데이터 선택+비교)"],[/\bTask 2 paragraph \(claim \+ reason \+ example\)\b/gi,"Task 2 단락(주장+이유+예시)"],[/\b120‑word summary \+ cohesion markers\b/gi,"120단어 요약 + 응집 장치"],[/\bmimic & shadow 3 sentences \(pronunciation\)\b/gi,"따라 말하기 3문장(발음)"]];for(const[a,t]of e)i=i.replace(a,t);i=i.replace(/\s–\s(\d+)\s*문항/gi," – $1문항")}return`${i} (${e})`};p.forEach(a=>a.days.forEach(a=>{a.tasks=a.tasks.map(a=>({...a,title:e(a.title)}))}))}}const _="yes"===i.planNativeLanguage&&i.firstLanguage?`Note: Double-click any word during practice for ${i.firstLanguage} translation`:void 0;return{durationWeeks:s,weekly:p,highlights:_?[_,...k]:k,quickWins:x,meta:{currentLevel:e.band,currentApproxIELTS:t,targetIELTS:n,dailyMinutes:r,estimatedMonths:o,rationale:`Personalized for ${i.firstLanguage||"English learner"} studying ${y}, targeting ${(n-t).toFixed(1)} band improvement`,targetDeadline:i.targetDeadline??null,startDateISO:(new Date).toISOString(),firstLanguage:i.firstLanguage,planNativeLanguage:i.planNativeLanguage,studyDays:d}}}const g=()=>{var s,d;const[c,g]=e.useState({}),[m,p]=e.useState(!1),[h,b]=e.useState(0),y=a(),{toast:v}=i(),{t:f}=t(),w=e.useMemo(()=>{const e=c.goal;return!e||"ielts"===e},[c]),k=o,x=e.useMemo(()=>{const e=["goal","study_days","first_language","plan_native_language","target_deadline","target_score"],a=e.map(e=>k.find(a=>a.id===e)).filter(Boolean),i=k.filter(a=>!e.includes(a.id));return[...a,...w?i.filter(e=>!e.difficulty||"A1"===e.difficulty||"A2"===e.difficulty):i]},[k,w]),_=e.useMemo(()=>x.findIndex(e=>"target_score"===e.id),[x]),$=(e,a)=>g(i=>({...i,[e]:a})),S=e=>{try{return JSON.parse(e||"[]")}catch{return[]}},T=()=>b(e=>Math.min(e+1,x.length-1)),q=async e=>{e.preventDefault(),p(!0);try{const e=c.goal||"ielts",i=function(e,a){let i=0,t=0,l=0,n=0,s=0,r=0,o=0,d=0,c=0,u=0;for(const w of e){if(!w.choices)continue;const e=w.id.includes("reading"),g=w.id.includes("listening"),m=w.id.includes("grammar"),p=w.id.includes("writing"),h=w.id.includes("vocab");if(!w.choices.some(e=>1===e.value))continue;const b=a[w.id],y=w.choices.find(e=>e.id===b),v=1===((null==y?void 0:y.value)??0);e?(r+=1,v&&(i+=1)):g?(o+=1,v&&(t+=1)):m?(d+=1,v&&(l+=1)):h?(c+=1,v&&(n+=1)):p&&(u+=1,v&&(s+=1))}const g=(e,a)=>a>0?Math.round(e/a*100):0,m=g(i,r),p=g(t,o),h=g(l,d),b=g(n,c),y=g(s,u),v=Math.round(.3*m+.3*p+.15*h+.15*b+.1*y);let f;return f=v<25?"A1":v<40?"A2":v<60?"B1":v<75?"B2":"C1",{band:f,subs:{reading:m,listening:p,grammar:h,vocab:b,writing:y},overallPct:v}}(x,c),t=i.band,l=c.target_deadline||null,n=parseFloat(c.target_score||"7.0"),s=c.study_days,o=c.first_language,d=function(e,a,i={}){return u(e,a,i)}(i,e,{targetScore:n,targetDeadline:l,studyDaysJson:s,firstLanguage:o,planNativeLanguage:c.plan_native_language});try{const{data:{user:a}}=await r.auth.getUser();if(!a)throw new Error("Not signed in");const{error:l}=await r.from("user_assessments").insert({user_id:a.id,goal:e,self_level:t,answers:c,score:i});if(l)throw l;const{data:n,error:s}=await r.from("study_plans").insert({user_id:a.id,band:i.band,goal:e,plan:d,source:"template"}).select("*").single();if(s)throw s;await r.from("profiles").update({current_plan_id:n.id}).eq("id",a.id);try{localStorage.setItem("latest_plan",JSON.stringify({plan:d,ts:Date.now()}))}catch{}try{localStorage.setItem("latest_plan",JSON.stringify({plan:d}))}catch{}v({title:"Plan ready",description:"Your personalized plan was generated."}),y("/plan",{state:{plan:d}})}catch(a){try{localStorage.setItem("latest_plan",JSON.stringify({plan:d}))}catch{}v({title:"Plan ready",description:"Opening your plan (offline mode)."}),y("/plan",{state:{plan:d}})}}catch(i){console.error(i),v({title:"Could not generate plan",description:"Please try again.",variant:"destructive"})}finally{p(!1)}},L=x[h],N=L.langKey?f(L.langKey):L.prompt,W=async e=>{$(L.id,e),"plan_native_language"!==L.id&&setTimeout(async()=>{h===x.length-1?await q({preventDefault:()=>{}}):T()},0)};return l.jsxs("div",{className:"max-w-xl mx-auto p-6",children:[l.jsx("h1",{className:"text-2xl font-semibold mb-6",children:"Quick Study Plan Assessment"}),l.jsxs("div",{className:"space-y-4",children:[L.passage&&l.jsx("div",{className:"rounded-lg border border-slate-200 bg-white/70 p-4 text-slate-800 whitespace-pre-line",children:L.passage}),l.jsx("div",{className:"text-lg font-medium",children:N}),l.jsxs("div",{className:"grid gap-3",children:["multi"===L.type&&!L.multiSelect&&(null==(s=L.choices)?void 0:s.map(e=>l.jsx("button",{onClick:()=>W(e.id),className:"text-left px-4 py-3 rounded-md border "+(c[L.id]===e.id?"border-blue-500 bg-blue-50":"border-slate-200 hover:bg-slate-50"),children:e.langKey?f(e.langKey):e.label},e.id))),"multi"===L.type&&L.multiSelect&&l.jsx("div",{className:"flex flex-wrap gap-3",children:null==(d=L.choices)?void 0:d.map(e=>{const a=S(c[L.id]).includes(e.id);return l.jsx("button",{onClick:()=>((e,a)=>{try{const i=S(c[e]),t=i.includes(a)?i.filter(e=>e!==a):[...i,a];$(e,JSON.stringify(t))}catch{$(e,JSON.stringify([a]))}})(L.id,e.id),className:"px-5 py-3 rounded-full border "+(a?"border-blue-500 bg-blue-50":"border-slate-200 hover:bg-slate-50"),children:e.langKey?f(e.langKey):e.label},e.id)})}),"plan_native_language"===L.id&&l.jsx("div",{className:"rounded-xl border border-slate-200 bg-white/70 p-4 text-slate-700",children:"We’ll now run a short skills check to tailor your plan precisely. It takes about 10–12 minutes."}),L.audio&&l.jsxs("div",{className:"space-y-2",children:[l.jsxs("audio",{controls:!0,className:"w-full",children:[l.jsx("source",{src:L.audio,type:"audio/mpeg"}),"Your browser does not support the audio element."]}),L.transcript&&l.jsxs("details",{className:"text-sm text-slate-600",children:[l.jsx("summary",{className:"cursor-pointer hover:text-slate-800",children:"Show transcript"}),l.jsx("p",{className:"mt-2 pl-4 border-l-2 border-slate-300",children:L.transcript})]})]}),"date"===L.type&&l.jsx("div",{className:"rounded-2xl border border-slate-200 bg-white/70 p-2 w-full",children:l.jsx(n,{className:"w-full",mode:"single",selected:c[L.id]?new Date(c[L.id]+"T12:00:00"):void 0,onSelect:e=>{if(!e)return;const a=new Date(e.getFullYear(),e.getMonth(),e.getDate()),i=new Date(a.getTime()-6e4*a.getTimezoneOffset()).toISOString().slice(0,10);$(L.id,i)},showOutsideDays:!0,classNames:{month:"w-full",table:"w-full border-collapse",row:"flex w-full mt-2 justify-between",head_cell:"w-12 text-center text-slate-500",cell:"h-12 w-12 text-center text-sm p-0 relative",day:"h-12 w-12 p-0 font-medium rounded-full hover:bg-black/5",day_selected:"bg-black text-white hover:bg-black rounded-full",day_today:"ring-2 ring-black/20 rounded-full"},style:{"--rdp-cell-size":"calc((100% - 2rem) / 7)"}})})]})]}),l.jsxs("div",{className:"flex justify-between items-center mt-6",children:[h>0?l.jsx("button",{onClick:()=>b(e=>Math.max(0,e-1)),className:"px-4 py-2 rounded-md border border-slate-300 hover:bg-slate-50",children:"Back"}):l.jsx("span",{}),h===x.length-1?l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("button",{onClick:e=>q(e),disabled:m,className:"px-4 py-2 rounded-md bg-black text-white disabled:opacity-50",children:m?"Generating…":"Get My Study Plan"}),l.jsx("button",{onClick:()=>y("/dashboard"),className:"px-4 py-2 rounded-md border border-slate-300 hover:bg-slate-50 text-slate-800",children:"Go to Dashboard"})]}):"date"===L.type?l.jsx("button",{onClick:()=>W(c[L.id]),disabled:!c[L.id],className:"px-4 py-2 rounded-md bg-black text-white disabled:opacity-50",children:"Continue"}):"study_days"===L.id||"first_language"===L.id||"plan_native_language"===L.id?l.jsx("button",{onClick:()=>{if(L.multiSelect){if(!c[L.id])return}else if(!c[L.id])return;T()},disabled:!c[L.id],className:"px-4 py-2 rounded-md bg-black text-white disabled:opacity-50",children:"Next"}):null]}),h>=0&&h>=(_>=0?_+1:0)&&l.jsxs("div",{className:"mt-4",children:[l.jsx("div",{className:"h-2 w-full bg-slate-200 rounded-full overflow-hidden",children:l.jsx("div",{className:"h-full bg-black rounded-full",style:{width:`${Math.round((h+1)/x.length*100)}%`}})}),l.jsxs("div",{className:"mt-2 text-xs text-slate-500 flex justify-end",children:[Math.round((h+1)/x.length*100),"% complete"]})]})]})};export{g as default};
