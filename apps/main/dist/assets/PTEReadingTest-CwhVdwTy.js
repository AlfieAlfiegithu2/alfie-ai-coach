import{u as e,c as s,r,j as a}from"./vendor-react-rLLBBC7n.js";import{E as t,s as i,J as n,x as l,y as o,B as c,e as d,P as p,C as m,a as h,b as x,c as u,R as g,p as j,L as v,S as b,i as w,j as f,k as N,l as y}from"./index-KxDfHqNJ.js";import{C as k}from"./checkbox-BqZ742qD.js";import{aA as D,bd as S,x as C,at as _,aI as A,bc as M}from"./vendor-ui-BGi_EvHx.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-charts-0DeywwxG.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";const R={fill_blanks_dropdown:{name:"Fill in the Blanks (Dropdown)",isDropdown:!0,isDragDrop:!1,isReorder:!1,isMultipleAnswer:!1,isSingleAnswer:!1,instructions:"In the text below some words are missing. From each drop-down list, choose the option that best completes the text."},mcq_multiple_answers:{name:"Multiple Choice, Multiple Answers",isDropdown:!1,isDragDrop:!1,isReorder:!1,isMultipleAnswer:!0,isSingleAnswer:!1,instructions:"Read the text and answer the question by selecting all the correct responses. More than one response is correct."},reorder_paragraph:{name:"Reorder Paragraph",isDropdown:!1,isDragDrop:!1,isReorder:!0,isMultipleAnswer:!1,isSingleAnswer:!1,instructions:"The text boxes below have been placed in a random order. Restore the original order by arranging them correctly."},fill_blanks_drag_drop:{name:"Fill in the Blanks (Drag and Drop)",isDropdown:!1,isDragDrop:!0,isReorder:!1,isMultipleAnswer:!1,isSingleAnswer:!1,instructions:"In the text below some words are missing. Drag words from the box below to the appropriate place in the text. There are more words than you need to fill the gaps."},mcq_single_answer:{name:"Multiple Choice, Single Answer",isDropdown:!1,isDragDrop:!1,isReorder:!1,isMultipleAnswer:!1,isSingleAnswer:!0,instructions:"Read the text and answer the multiple-choice question by selecting the correct response. Only one response is correct."}},B=()=>{const B=e(),{type:F}=s(),{user:O}=t(),[E,I]=r.useState([]),[q,P]=r.useState(0),[U,$]=r.useState(!0),[J,T]=r.useState(600),[z,L]=r.useState(!1),[K,V]=r.useState(!1),[W,Y]=r.useState(!1),[G,H]=r.useState(!1),[Q,X]=r.useState([]),[Z,ee]=r.useState(""),[se,re]=r.useState({}),[ae,te]=r.useState({}),[ie,ne]=r.useState([]),[le,oe]=r.useState([]),ce=F?R[F]:null,de=E[q];r.useEffect(()=>{F&&pe()},[F]),r.useEffect(()=>{de&&ce&&(me(),Y(!1),L(!0),T(600))},[q,de]),r.useEffect(()=>{let e;return z&&J>0&&(e=setInterval(()=>{T(e=>e<=1?(L(!1),0):e-1)},1e3)),()=>clearInterval(e)},[z,J]);const pe=async()=>{if(F){$(!0);try{const{data:e,error:s}=await i.from("pte_items").select("*").eq("pte_section_type",F).order("created_at",{ascending:!0});if(s)throw s;if(!e||0===e.length)return n.error("No items available for this type"),void B("/pte-portal");I(e)}catch(e){console.error("Error loading items:",e),n.error("Failed to load practice items")}finally{$(!1)}}},me=()=>{if(X([]),ee(""),re({}),te({}),(null==ce?void 0:ce.isReorder)&&(null==de?void 0:de.paragraphs)){const e=[...de.paragraphs].sort(()=>Math.random()-.5);ne(e)}(null==ce?void 0:ce.isDragDrop)&&(null==de?void 0:de.options)&&oe([...de.options])},he=e=>{X(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},xe=(e,s)=>{const r=[...ie],[a]=r.splice(e,1);r.splice(s,0,a),ne(r)};return U?a.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:a.jsx(l,{})}):ce&&de?a.jsx(o,{title:ce.name,showBackButton:!0,children:a.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs(d,{variant:"outline",className:"text-blue-600 border-blue-600",children:[q+1," / ",E.length]}),a.jsx(d,{variant:"secondary",children:de.difficulty})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(D,{className:"w-4 h-4 text-muted-foreground"}),a.jsx("span",{className:"font-mono text-lg "+(J<60?"text-red-500":""),children:(ue=J,`${Math.floor(ue/60)}:${(ue%60).toString().padStart(2,"0")}`)})]})]}),a.jsx(p,{value:q/E.length*100,className:"h-2"}),a.jsx(m,{className:"bg-blue-50 dark:bg-blue-950/20 border-blue-200",children:a.jsx(h,{className:"pt-4",children:a.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:ce.instructions})})}),a.jsxs(m,{children:[a.jsx(x,{children:a.jsx(u,{children:de.title||ce.name})}),a.jsxs(h,{className:"space-y-6",children:[a.jsx("div",{className:"text-lg font-medium",children:de.prompt_text}),(ce.isSingleAnswer||ce.isMultipleAnswer)&&de.passage_text&&a.jsx(m,{className:"bg-gray-50 dark:bg-gray-900",children:a.jsx(h,{className:"pt-4",children:a.jsx("p",{className:"whitespace-pre-wrap",children:de.passage_text})})}),(ce.isDropdown||ce.isDragDrop)&&a.jsx(m,{className:"bg-gray-50 dark:bg-gray-900",children:a.jsx(h,{className:"pt-4",children:(()=>{if(!(null==de?void 0:de.passage_text))return null;const e=de.passage_text.split(/\[BLANK\]/g);return a.jsx("div",{className:"prose dark:prose-invert max-w-none",children:e.map((s,r)=>{var t;return a.jsxs("span",{children:[s,r<e.length-1&&((null==ce?void 0:ce.isDropdown)?a.jsxs(b,{value:se[r]||"",onValueChange:e=>re(s=>({...s,[r]:e})),children:[a.jsx(w,{className:"w-40 inline-flex mx-1",children:a.jsx(f,{placeholder:`Blank ${r+1}`})}),a.jsx(N,{children:null==(t=de.options)?void 0:t.map((e,s)=>a.jsx(y,{value:e,children:e},s))})]}):(null==ce?void 0:ce.isDragDrop)?a.jsx("span",{className:"inline-block min-w-[100px] px-2 py-1 mx-1 rounded border-2 "+(ae[r]?"bg-violet-100 border-violet-300 dark:bg-violet-900 dark:border-violet-700":"border-dashed border-gray-300 dark:border-gray-600"),onClick:()=>ae[r]&&(e=>{const s=ae[e];s&&(oe(e=>[...e,s]),te(s=>{const r={...s};return delete r[e],r}))})(r),children:ae[r]||`[${r+1}]`}):null)]},r)})})})()})}),ce.isDragDrop&&a.jsxs(m,{children:[a.jsx(x,{className:"pb-2",children:a.jsx(u,{className:"text-sm",children:"Word Bank (click to place in blank)"})}),a.jsx(h,{children:a.jsx("div",{className:"flex flex-wrap gap-2",children:le.map((e,s)=>a.jsx(c,{variant:"outline",size:"sm",onClick:()=>{var s;const r=Object.keys(ae).length;r<((null==(s=de.passage_text)?void 0:s.split(/\[BLANK\]/g))||[]).length-1&&((e,s)=>{oe(s=>s.filter(s=>s!==e)),ae[s]&&oe(e=>[...e,ae[s]]),te(r=>({...r,[s]:e}))})(e,r)},children:e},s))})})]}),ce.isSingleAnswer&&de.options&&a.jsx(g,{value:Z,onValueChange:ee,children:a.jsx("div",{className:"space-y-3",children:de.options.map((e,s)=>a.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg border hover:bg-gray-50 dark:hover:bg-gray-900",children:[a.jsx(j,{value:String.fromCharCode(65+s),id:`option-${s}`}),a.jsxs(v,{htmlFor:`option-${s}`,className:"flex-1 cursor-pointer",children:[a.jsxs("span",{className:"font-medium mr-2",children:[String.fromCharCode(65+s),"."]}),e]})]},s))})}),ce.isMultipleAnswer&&de.options&&a.jsx("div",{className:"space-y-3",children:de.options.map((e,s)=>{const r=String.fromCharCode(65+s);return a.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg border cursor-pointer transition-colors "+(Q.includes(r)?"bg-violet-50 border-violet-300 dark:bg-violet-950 dark:border-violet-700":"hover:bg-gray-50 dark:hover:bg-gray-900"),onClick:()=>he(r),children:[a.jsx(k,{checked:Q.includes(r),onCheckedChange:()=>he(r)}),a.jsxs(v,{className:"flex-1 cursor-pointer",children:[a.jsxs("span",{className:"font-medium mr-2",children:[r,"."]}),e]})]},s)})}),ce.isReorder&&a.jsx("div",{className:"space-y-3",children:ie.map((e,s)=>a.jsx(m,{className:"cursor-move hover:shadow-md transition-shadow",children:a.jsxs(h,{className:"p-4 flex items-start gap-3",children:[a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsx(c,{variant:"ghost",size:"icon",className:"h-6 w-6",disabled:0===s,onClick:()=>xe(s,s-1),children:"↑"}),a.jsx(S,{className:"w-4 h-4 text-gray-400"}),a.jsx(c,{variant:"ghost",size:"icon",className:"h-6 w-6",disabled:s===ie.length-1,onClick:()=>xe(s,s+1),children:"↓"})]}),a.jsxs("div",{className:"flex-1",children:[a.jsx(d,{variant:"outline",className:"mb-2",children:e.id}),a.jsx("p",{className:"text-sm",children:e.text})]})]})},e.id))}),!W&&a.jsx("div",{className:"flex justify-end",children:a.jsxs(c,{onClick:async()=>{if(O&&de){V(!0);try{const e=(()=>{if(!(null==de?void 0:de.correct_answer))return!1;const e=de.correct_answer.split(",").map(e=>e.trim().toUpperCase());if(null==ce?void 0:ce.isSingleAnswer)return e.includes(Z.toUpperCase());if(null==ce?void 0:ce.isMultipleAnswer){const s=Q.map(e=>e.toUpperCase()).sort();return JSON.stringify(s)===JSON.stringify(e.sort())}if(null==ce?void 0:ce.isReorder)return ie.map(e=>e.id).join(",").toUpperCase()===de.correct_answer.toUpperCase();if((null==ce?void 0:ce.isDropdown)||(null==ce?void 0:ce.isDragDrop)){const s=Object.values(ce.isDropdown?se:ae);return JSON.stringify(s.map(e=>e.toUpperCase()))===JSON.stringify(e)}return!1})();H(e);let s="";(null==ce?void 0:ce.isSingleAnswer)?s=Z:(null==ce?void 0:ce.isMultipleAnswer)?s=Q.join(", "):(null==ce?void 0:ce.isReorder)?s=ie.map(e=>e.id).join(", "):(null==ce?void 0:ce.isDropdown)?s=Object.values(se).join(", "):(null==ce?void 0:ce.isDragDrop)&&(s=Object.values(ae).join(", "));const{error:r}=await i.from("pte_user_progress").insert({user_id:O.id,pte_skill:"reading",pte_section_type:F,item_id:de.id,completed:!0,score:e?100:0,response_text:s,time_taken:600-J});if(r)throw r;L(!1),Y(!0),n.success(e?"Correct!":"Incorrect")}catch(e){console.error("Error submitting response:",e),n.error("Failed to submit response")}finally{V(!1)}}},disabled:K,className:"bg-blue-600 hover:bg-blue-700",children:[a.jsx(C,{className:"w-4 h-4 mr-2"}),K?"Checking...":"Submit Answer"]})}),W&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs(m,{className:""+(G?"bg-green-50 border-green-200 dark:bg-green-950/20":"bg-red-50 border-red-200 dark:bg-red-950/20"),children:[a.jsx(x,{children:a.jsx(u,{className:"flex items-center gap-2 "+(G?"text-green-700":"text-red-700"),children:G?a.jsxs(a.Fragment,{children:[a.jsx(_,{className:"w-5 h-5"})," Correct!"]}):a.jsxs(a.Fragment,{children:[a.jsx(A,{className:"w-5 h-5"})," Incorrect"]})})}),a.jsxs(h,{className:"space-y-2",children:[a.jsxs("p",{children:[a.jsx("span",{className:"font-medium",children:"Correct answer: "}),de.correct_answer]}),de.explanation&&a.jsx("p",{className:"text-sm text-muted-foreground",children:de.explanation})]})]}),a.jsx("div",{className:"flex justify-end",children:a.jsx(c,{onClick:()=>{q<E.length-1?P(e=>e+1):(n.success("You have completed all items!"),B("/pte-portal"))},className:"bg-blue-600 hover:bg-blue-700",children:q<E.length-1?a.jsxs(a.Fragment,{children:[a.jsx(M,{className:"w-4 h-4 mr-2"}),"Next Item"]}):"Complete"})})]})]})]})]})}):a.jsx(o,{title:"PTE Practice",showBackButton:!0,children:a.jsxs("div",{className:"text-center py-12",children:[a.jsx("p",{className:"text-muted-foreground",children:"No items available"}),a.jsx(c,{onClick:()=>B("/pte-portal"),className:"mt-4",children:"Back to PTE Portal"})]})});var ue};export{B as default};
