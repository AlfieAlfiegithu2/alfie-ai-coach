import{u as e,G as s,ae as a,a1 as r,r as t,J as i,j as o,a9 as l,aa as n,B as c,l as d,W as m,K as u,C as h,a as p,b as x,d as g,Y as b,Z as y,M as j,L as v,T as f,a0 as w,X as N}from"./index-CCrhrMPI.js";import{s as E}from"./supabase-DWL4C3fA.js";import{C as k,a as C,b as A,O as D,M as S,c as _,R as B,S as P}from"./shimmering-text--GkXUF9k.js";import{M as F}from"./mic-off-CeZyK2e2.js";import{C as I}from"./circle-alert-BxkfQePb.js";import{S as T}from"./skip-forward-DAeVW8Oi.js";const L={read_aloud:{name:"Read Aloud",isSpeaking:!0,isWriting:!1,hasAudio:!1,hasImage:!1,hasPassage:!0,timeLimit:40,instructions:"Look at the text below. In 30-40 seconds, you must read this text aloud as naturally and clearly as possible."},repeat_sentence:{name:"Repeat Sentence",isSpeaking:!0,isWriting:!1,hasAudio:!0,hasImage:!1,hasPassage:!1,timeLimit:15,instructions:"You will hear a sentence. Please repeat the sentence exactly as you hear it."},describe_image:{name:"Describe Image",isSpeaking:!0,isWriting:!1,hasAudio:!1,hasImage:!0,hasPassage:!1,timeLimit:40,instructions:"Look at the image below. In 25 seconds, please speak into the microphone and describe in detail what the image is showing."},retell_lecture:{name:"Retell Lecture",isSpeaking:!0,isWriting:!1,hasAudio:!0,hasImage:!0,hasPassage:!1,timeLimit:40,instructions:"You will hear a lecture. After listening to the lecture, in 10 seconds, please speak into the microphone and retell what you have just heard."},answer_short_question:{name:"Answer Short Question",isSpeaking:!0,isWriting:!1,hasAudio:!0,hasImage:!1,hasPassage:!1,timeLimit:10,instructions:"You will hear a question. Please give a simple and short answer. Often just one or a few words is enough."},summarize_group_discussion:{name:"Summarize Group Discussion",isSpeaking:!0,isWriting:!1,hasAudio:!0,hasImage:!1,hasPassage:!1,timeLimit:70,instructions:"You will hear a group discussion. You will have 10 seconds to prepare, then summarize the main points of the discussion in 70 seconds."},respond_to_situation:{name:"Respond to a Situation",isSpeaking:!0,isWriting:!1,hasAudio:!1,hasImage:!1,hasPassage:!0,timeLimit:40,instructions:"You will see a scenario. In 20 seconds prepare time, think about what you would say in this situation. Then speak for up to 40 seconds."},summarize_written_text:{name:"Summarize Written Text",isSpeaking:!1,isWriting:!0,hasAudio:!1,hasImage:!1,hasPassage:!0,timeLimit:600,wordLimit:75,instructions:"Read the passage below. Write a one-sentence summary of the passage. Your summary should be between 5 and 75 words."},write_essay:{name:"Write Essay",isSpeaking:!1,isWriting:!0,hasAudio:!1,hasImage:!1,hasPassage:!1,timeLimit:1200,wordLimit:300,instructions:"You will have 20 minutes to plan, write and revise an essay about the topic below. Your response will be judged on how well you develop a position, organize your ideas, present supporting details, and control the elements of standard written English."}},W=()=>{var W,z,R;const $=e(),{type:Y}=s(),{user:M,profile:q}=a();r();const O=t.useRef(null),G=t.useRef(null),U=t.useRef([]),[H,K]=t.useState([]),[J,Q]=t.useState(0),[V,Z]=t.useState(!0),[X,ee]=t.useState(0),[se,ae]=t.useState(!1),[re,te]=t.useState(!1),[ie,oe]=t.useState(null),[le,ne]=t.useState(!1),[ce,de]=t.useState(!1),[me,ue]=t.useState(""),[he,pe]=t.useState(!1),[xe,ge]=t.useState(!1),[be,ye]=t.useState(null),[je,ve]=t.useState(!1),[fe,we]=t.useState(!1),[Ne,Ee]=t.useState([{id:"1",type:"bot",content:"Hello! I'm Catie, your PTE Speaking & Writing tutor. üéØ I'm here to help you improve your responses. Ask me about structure, vocabulary, pronunciation tips, or any PTE strategy!",timestamp:new Date}]),[ke,Ce]=t.useState(""),[Ae,De]=t.useState(!1),Se=Y?L[Y]:null,_e=H[J],Be=me.trim().split(/\s+/).filter(e=>e).length,Pe=async()=>{if(!ke.trim()||Ae)return;const e={id:Date.now().toString(),type:"user",content:ke,timestamp:new Date};Ee(s=>[...s,e]),Ce(""),De(!0);try{const e=`You are Catie, a friendly and expert PTE Academic tutor specializing in Speaking and Writing tasks. \nThe student is currently practicing: ${(null==Se?void 0:Se.name)||"PTE task"}\nTask instructions: ${(null==Se?void 0:Se.instructions)||""}\n${(null==_e?void 0:_e.prompt_text)?`Current prompt: ${_e.prompt_text}`:""}\n${(null==_e?void 0:_e.passage_text)?`Passage: ${_e.passage_text}`:""}\n\nHelp the student with:\n- Task-specific strategies\n- Vocabulary and grammar tips\n- Structure and organization\n- Pronunciation guidance (for speaking)\n- Time management advice\n\nBe encouraging, specific, and practical. Keep responses concise but helpful.`,{data:s,error:a}=await E.functions.invoke("gemini-chat",{body:{message:ke,context:"pte_tutor",systemPrompt:e}});if(a)throw a;const r={id:(Date.now()+1).toString(),type:"bot",content:(null==s?void 0:s.response)||"I'm here to help! Could you please rephrase your question?",timestamp:new Date};Ee(e=>[...e,r])}catch(s){console.error("Catie error:",s),i.error("Catie couldn't respond. Please try again.")}finally{De(!1)}};t.useEffect(()=>{Y&&Fe()},[Y]),t.useEffect(()=>{_e&&Se&&(ee(_e.time_limit||Se.timeLimit),ue(""),oe(null),ge(!1),ye(null),de(!1))},[J,_e]),t.useEffect(()=>{let e;return se&&X>0&&(e=setInterval(()=>{ee(e=>e<=1?(ae(!1),re&&Ie(),0):e-1)},1e3)),()=>clearInterval(e)},[se,X,re]);const Fe=async()=>{if(Y){Z(!0);try{const{data:e,error:s}=await E.from("pte_items").select("*").eq("pte_section_type",Y).order("created_at",{ascending:!0});if(s)throw s;if(!e||0===e.length)return i.error("No items available for this type"),void $("/pte-portal");K(e)}catch(e){console.error("Error loading items:",e),i.error("Failed to load practice items")}finally{Z(!1)}}},Ie=()=>{G.current&&re&&(G.current.stop(),te(!1),ae(!1))};return V?o.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:o.jsx(l,{})}):Se&&_e?o.jsxs(n,{title:Se.name,showBackButton:!0,children:[o.jsx("audio",{ref:O,onEnded:()=>{ne(!1),de(!0)},className:"hidden"}),o.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 pb-24",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs(d,{variant:"outline",className:"font-medium",style:{borderColor:"#A68B5B",color:"#5D4E37",backgroundColor:"rgba(254, 249, 231, 0.8)"},children:[J+1," / ",H.length]}),o.jsx(d,{style:{backgroundColor:"#E8D5A3",color:"#5D4E37"},children:_e.difficulty})]}),o.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-lg",style:{backgroundColor:"rgba(254, 249, 231, 0.9)",border:"1px solid #E8D5A3"},children:[o.jsx(m,{className:"w-4 h-4",style:{color:"#8B6914"}}),o.jsx("span",{className:"font-mono text-lg font-semibold",style:{color:X<10?"#C97D60":"#5D4E37"},children:(Te=X,`${Math.floor(Te/60)}:${(Te%60).toString().padStart(2,"0")}`)})]})]}),o.jsx(u,{value:J/H.length*100,className:"h-2",style:{backgroundColor:"#E8D5A3"}}),o.jsx(h,{className:"rounded-2xl border-2",style:{background:"linear-gradient(to bottom, #FFF8E7 0%, #FEF3D6 100%)",borderColor:"#E8D5A3",boxShadow:"0 2px 8px rgba(0,0,0,0.08), inset 0 1px 0 rgba(255,255,255,0.5)"},children:o.jsx(p,{className:"pt-4",children:o.jsxs("p",{className:"text-sm",style:{color:"#8B6914"},children:["üìã ",Se.instructions]})})}),o.jsxs(h,{className:"rounded-2xl shadow-lg border-2",style:{background:"linear-gradient(to bottom, #FEF9E7 0%, #FDF6E3 100%)",borderColor:"#E8D5A3",boxShadow:"0 4px 12px rgba(0,0,0,0.1), inset 0 1px 0 rgba(255,255,255,0.5)"},children:[o.jsx(x,{children:o.jsx(g,{style:{color:"#5D4E37"},children:_e.title||Se.name})}),o.jsxs(p,{className:"space-y-6",children:[o.jsxs("div",{className:"text-lg p-4 rounded-lg",style:{backgroundColor:"rgba(166, 139, 91, 0.1)",border:"1px dashed #E8D5A3",color:"#5D4E37"},children:["‚úèÔ∏è ",_e.prompt_text]}),Se.hasPassage&&_e.passage_text&&o.jsx(h,{className:"border-2",style:{backgroundColor:"rgba(254, 249, 231, 0.8)",borderColor:"#E8D5A3",boxShadow:"inset 0 1px 3px rgba(0,0,0,0.05)"},children:o.jsxs(p,{className:"pt-4",children:[o.jsx("h3",{className:"font-semibold mb-3",style:{color:"#8B6914"},children:"üìñ Passage:"}),o.jsx("p",{className:"whitespace-pre-wrap leading-relaxed",style:{color:"#5D4E37"},children:_e.passage_text})]})}),Se.hasImage&&_e.image_url&&o.jsx("div",{className:"flex justify-center",children:o.jsx("img",{src:_e.image_url,alt:"Practice image",className:"max-w-full max-h-96 rounded-lg border-2",style:{borderColor:"#E8D5A3",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"}})}),Se.hasAudio&&_e.audio_url&&o.jsx(h,{className:"border-2",style:{backgroundColor:"rgba(232, 213, 163, 0.3)",borderColor:"#E8D5A3"},children:o.jsx(p,{className:"pt-4",children:o.jsxs("div",{className:"flex items-center justify-center gap-4",children:[o.jsx(c,{variant:"outline",size:"lg",onClick:le?()=>{O.current&&(O.current.pause(),ne(!1))}:()=>{O.current&&(null==_e?void 0:_e.audio_url)&&(O.current.src=_e.audio_url,O.current.play(),ne(!0))},disabled:ce&&"repeat_sentence"===Y,className:"rounded-full",style:{borderColor:"#A68B5B",color:"#5D4E37"},children:le?o.jsx(b,{className:"w-6 h-6"}):o.jsx(y,{className:"w-6 h-6"})}),o.jsxs("div",{className:"text-sm",style:{color:"#8B6914"},children:["üéß ",ce?"Audio played":"Click to listen","repeat_sentence"===Y&&ce&&" (one time only)"]})]})})}),Se.isSpeaking&&!xe&&o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex justify-center gap-4",children:[!re&&!ie&&o.jsxs(c,{size:"lg",onClick:async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:!0}),s=new MediaRecorder(e);G.current=s,U.current=[],s.ondataavailable=e=>{e.data.size>0&&U.current.push(e.data)},s.onstop=()=>{const s=new Blob(U.current,{type:"audio/webm"});oe(s),e.getTracks().forEach(e=>e.stop())},s.start(),te(!0),ae(!0)}catch(e){console.error("Error starting recording:",e),i.error("Failed to access microphone")}},disabled:Se.hasAudio&&!ce,style:{backgroundColor:"#A68B5B",color:"white"},className:"hover:opacity-90",children:[o.jsx(j,{className:"w-5 h-5 mr-2"}),"üéôÔ∏è Start Recording"]}),re&&o.jsxs(c,{size:"lg",onClick:Ie,style:{backgroundColor:"#C97D60",color:"white"},className:"hover:opacity-90",children:[o.jsx(F,{className:"w-5 h-5 mr-2"}),"Stop Recording"]}),ie&&!re&&o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsxs(d,{style:{backgroundColor:"rgba(232, 213, 163, 0.5)",color:"#5D4E37",border:"1px solid #E8D5A3"},children:[o.jsx(v,{className:"w-4 h-4 mr-1",style:{color:"#8B6914"}}),"Recording saved"]}),o.jsx(c,{variant:"outline",onClick:()=>oe(null),style:{borderColor:"#E8D5A3",color:"#5D4E37"},children:"Re-record"})]})]}),re&&o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"w-4 h-4 rounded-full animate-pulse mx-auto",style:{backgroundColor:"#C97D60"}}),o.jsx("p",{className:"text-sm mt-2",style:{color:"#8B6914"},children:"Recording..."})]})]}),Se.isWriting&&!xe&&o.jsxs("div",{className:"space-y-4",children:[!se&&!me&&o.jsx("div",{className:"text-center",children:o.jsx(c,{onClick:()=>{ae(!0)},size:"lg",style:{backgroundColor:"#A68B5B",color:"white"},className:"hover:opacity-90",children:"‚úçÔ∏è Start Writing"})}),(se||me)&&o.jsxs(o.Fragment,{children:[o.jsx(f,{value:me,onChange:e=>ue(e.target.value),placeholder:"Type your response here...",rows:10,className:"font-mono border-2",style:{backgroundColor:"rgba(255, 255, 255, 0.7)",borderColor:"#E8D5A3",color:"#5D4E37"}}),o.jsxs("div",{className:"flex items-center justify-between text-sm",children:[o.jsxs("span",{style:{color:Be>(Se.wordLimit||300)?"#C97D60":"#8B6914"},children:["üìù Words: ",Be," ",Se.wordLimit&&`/ ${Se.wordLimit}`]}),Se.wordLimit&&Be<5&&o.jsxs("span",{style:{color:"#C97D60"},children:[o.jsx(I,{className:"w-4 h-4 inline mr-1"}),"Minimum 5 words required"]})]})]})]}),!xe&&o.jsx("div",{className:"flex justify-end",children:o.jsxs(c,{onClick:async()=>{if(M&&_e){pe(!0);try{let e=me,s=null,a="";if((null==Se?void 0:Se.isSpeaking)&&ie){const e=`pte-responses/${M.id}/${Y}/${Date.now()}.webm`,{data:r,error:t}=await E.storage.from("audio").upload(e,ie,{upsert:!0});if(t)throw t;const{data:{publicUrl:o}}=E.storage.from("audio").getPublicUrl(e);s=o;const l=await ie.arrayBuffer(),n=btoa(String.fromCharCode(...new Uint8Array(l)));i.loading("AI is evaluating your response...");const{data:c,error:d}=await E.functions.invoke("pte-speaking-evaluator",{body:{taskType:Y,transcribedText:a||"[Audio response - transcription pending]",audioBase64:n,originalText:_e.passage_text||_e.prompt_text,imageDescription:_e.image_url?"Image provided":void 0,lectureContent:_e.audio_url?"Lecture audio provided":void 0,situationContext:_e.passage_text,correctAnswer:_e.sample_answer}});i.dismiss(),d?(console.error("AI evaluation error:",d),ye({sampleAnswer:_e.sample_answer})):(null==c?void 0:c.success)&&ye({aiEvaluation:c.evaluation,taskName:c.taskName,scoringCriteria:c.scoringCriteria,sampleAnswer:_e.sample_answer})}if((null==Se?void 0:Se.isWriting)&&me){i.loading("AI is evaluating your response...");const{data:e,error:s}=await E.functions.invoke("pte-writing-evaluator",{body:{taskType:Y,writtenResponse:me,originalPassage:_e.passage_text,essayPrompt:_e.prompt_text,spokenTextContent:_e.audio_url?"Audio content provided":void 0}});i.dismiss(),s?(console.error("AI evaluation error:",s),ye({sampleAnswer:_e.sample_answer})):(null==e?void 0:e.success)&&ye({aiEvaluation:e.evaluation,taskName:e.taskName,scoringCriteria:e.scoringCriteria,wordLimits:e.wordLimits,sampleAnswer:_e.sample_answer})}const{error:r}=await E.from("pte_user_progress").insert({user_id:M.id,pte_skill:"speaking_writing",pte_section_type:Y,item_id:_e.id,completed:!0,response_text:e||null,response_audio_url:s,time_taken:(_e.time_limit||(null==Se?void 0:Se.timeLimit)||60)-X});if(r)throw r;ge(!0),i.success("Response submitted!")}catch(e){console.error("Error submitting response:",e),i.error("Failed to submit response")}finally{pe(!1)}}},disabled:he||Se.isSpeaking&&!ie||Se.isWriting&&Be<5,style:{backgroundColor:"#A68B5B",color:"white"},className:"hover:opacity-90",children:[o.jsx(w,{className:"w-4 h-4 mr-2"}),he?"Submitting...":"Submit Response"]})}),xe&&o.jsxs("div",{className:"space-y-4",children:[(null==be?void 0:be.aiEvaluation)&&o.jsxs(h,{className:"border-2",style:{borderColor:"#E8D5A3"},children:[o.jsx(x,{style:{background:"linear-gradient(to right, #FEF9E7, #FFF8E7)"},children:o.jsxs(g,{className:"flex items-center justify-between",style:{color:"#5D4E37"},children:[o.jsxs("span",{className:"flex items-center gap-2",children:["‚ú® AI Evaluation - ",be.taskName]}),o.jsxs(d,{className:"text-lg",style:{backgroundColor:"#A68B5B",color:"white"},children:[be.aiEvaluation.totalScore,"/",be.aiEvaluation.totalMax,o.jsxs("span",{className:"ml-2 text-xs",children:["(",be.aiEvaluation.percentage,"%)"]})]})]})}),o.jsxs(p,{className:"pt-4 space-y-4",style:{backgroundColor:"#FEF9E7"},children:[o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Object.entries(be.aiEvaluation.scores||{}).map(([e,s])=>{var a;return o.jsxs("div",{className:"p-3 rounded-lg border",style:{backgroundColor:"rgba(255, 255, 255, 0.6)",borderColor:"#E8D5A3"},children:[o.jsx("div",{className:"text-xs capitalize",style:{color:"#8B6914"},children:e.replace(/_/g," ")}),o.jsxs("div",{className:"text-lg font-bold",style:{color:"#A68B5B"},children:[s,"/",(null==(a=be.scoringCriteria)?void 0:a[e])||5]})]},e)})}),o.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-lg",style:{backgroundColor:"rgba(232, 213, 163, 0.4)",border:"1px solid #E8D5A3"},children:[o.jsxs("div",{children:[o.jsx("div",{className:"text-xs",style:{color:"#8B6914"},children:"Estimated PTE Score"}),o.jsx("div",{className:"text-2xl font-bold",style:{color:"#5D4E37"},children:be.aiEvaluation.pteScore})]}),o.jsx("div",{className:"text-sm",style:{color:"#8B6914"},children:"(Scale: 10-90)"})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("h4",{className:"font-medium",style:{color:"#8B6914"},children:"üìù Overall Feedback"}),o.jsx("p",{className:"text-sm",style:{color:"#5D4E37"},children:be.aiEvaluation.overallFeedback})]}),(null==(W=be.aiEvaluation.strengths)?void 0:W.length)>0&&o.jsxs("div",{className:"space-y-2",children:[o.jsxs("h4",{className:"font-medium flex items-center gap-2",style:{color:"#8B6914"},children:[o.jsx(v,{className:"w-4 h-4",style:{color:"#A68B5B"}})," ‚úÖ Strengths"]}),o.jsx("ul",{className:"list-disc list-inside text-sm space-y-1",style:{color:"#5D4E37"},children:be.aiEvaluation.strengths.map((e,s)=>o.jsx("li",{children:e},s))})]}),(null==(z=be.aiEvaluation.improvements)?void 0:z.length)>0&&o.jsxs("div",{className:"space-y-2",children:[o.jsxs("h4",{className:"font-medium flex items-center gap-2",style:{color:"#C97D60"},children:[o.jsx(I,{className:"w-4 h-4"})," üìà Areas for Improvement"]}),o.jsx("ul",{className:"list-disc list-inside text-sm space-y-1",style:{color:"#5D4E37"},children:be.aiEvaluation.improvements.map((e,s)=>o.jsx("li",{children:e},s))})]}),be.aiEvaluation.feedback&&o.jsxs("div",{className:"space-y-2",children:[o.jsx("h4",{className:"font-medium",style:{color:"#8B6914"},children:"üìã Detailed Feedback"}),o.jsx("div",{className:"space-y-2 text-sm",children:Object.entries(be.aiEvaluation.feedback).map(([e,s])=>o.jsxs("div",{className:"p-2 rounded border",style:{backgroundColor:"rgba(255, 255, 255, 0.5)",borderColor:"#E8D5A3"},children:[o.jsxs("span",{className:"font-medium capitalize",style:{color:"#8B6914"},children:[e.replace(/_/g," "),":"]})," ",o.jsx("span",{style:{color:"#5D4E37"},children:s})]},e))})]}),(null==(R=be.aiEvaluation.grammarErrors)?void 0:R.length)>0&&o.jsxs("div",{className:"p-3 rounded-lg",style:{backgroundColor:"rgba(201, 125, 96, 0.15)",border:"1px solid #C97D60"},children:[o.jsx("h4",{className:"font-medium text-sm",style:{color:"#C97D60"},children:"‚ö†Ô∏è Grammar Issues:"}),o.jsx("ul",{className:"list-disc list-inside text-xs",style:{color:"#5D4E37"},children:be.aiEvaluation.grammarErrors.map((e,s)=>o.jsx("li",{children:e},s))})]})]})]}),(null==be?void 0:be.sampleAnswer)&&o.jsxs(h,{className:"border-2",style:{backgroundColor:"rgba(232, 213, 163, 0.3)",borderColor:"#E8D5A3"},children:[o.jsx(x,{children:o.jsxs(g,{className:"flex items-center gap-2 text-base",style:{color:"#8B6914"},children:[o.jsx(v,{className:"w-5 h-5",style:{color:"#A68B5B"}}),"üí° Sample Answer"]})}),o.jsx(p,{children:o.jsx("p",{className:"whitespace-pre-wrap text-sm",style:{color:"#5D4E37"},children:be.sampleAnswer})})]}),o.jsx("div",{className:"flex justify-end",children:o.jsx(c,{onClick:()=>{J<H.length-1?Q(e=>e+1):(i.success("You have completed all items!"),$("/pte-portal"))},style:{backgroundColor:"#A68B5B",color:"white"},className:"hover:opacity-90",children:J<H.length-1?o.jsxs(o.Fragment,{children:[o.jsx(T,{className:"w-4 h-4 mr-2"}),"Next Item"]}):"üéâ Complete"})})]})]})]})]}),o.jsxs("div",{className:"fixed bottom-6 right-3 sm:bottom-6 sm:right-6 z-50",children:[je&&o.jsxs(h,{className:"rounded-3xl w-[280px] h-[400px] sm:w-96 sm:h-[500px] shadow-2xl flex flex-col transform-gpu origin-bottom-right transition-all duration-260 ease-in-out border-2 "+(fe?"opacity-100 scale-100 translate-y-0":"opacity-0 scale-75 translate-y-8"),style:{background:"linear-gradient(to bottom, #FEF9E7 0%, #FDF6E3 100%)",borderColor:"#E8D5A3",boxShadow:"0 8px 32px rgba(0,0,0,0.15), inset 0 1px 0 rgba(255,255,255,0.5)"},children:[o.jsxs(x,{className:"pb-1 sm:pb-2 rounded-t-3xl relative",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden border-2",style:{borderColor:"#E8D5A3"},children:o.jsx("img",{src:"/1000031289.png",alt:"Catie",className:"w-full h-full object-cover"})}),o.jsxs("div",{children:[o.jsx(g,{className:"text-base",style:{color:"#5D4E37"},children:"Ask Catie"}),o.jsx("p",{className:"text-xs",style:{color:"#8B6914"},children:"Your PTE tutor"})]})]}),o.jsx("div",{className:"absolute top-1.5 right-1.5 sm:top-2 sm:right-2",children:o.jsx(c,{variant:"ghost",size:"icon",onClick:()=>{we(!1),setTimeout(()=>ve(!1),260)},className:"h-7 w-7 sm:h-8 sm:w-8 p-0 hover:bg-amber-100",style:{color:"#5D4E37"},children:o.jsx(N,{className:"w-4 h-4"})})})]}),o.jsxs(p,{className:"flex-1 flex flex-col px-2.5 py-2 sm:p-4 overflow-hidden",children:[o.jsx(k,{className:"flex-1 min-h-0",children:o.jsx(C,{className:"flex-1 min-h-0",children:0!==Ne.length||Ae?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"rounded-lg p-2 mb-3 text-xs",style:{backgroundColor:"rgba(232, 213, 163, 0.4)",borderColor:"#E8D5A3",borderWidth:"1px",borderStyle:"solid",color:"#8B6914"},children:["üìù ",(null==Se?void 0:Se.name)||"PTE Practice"]}),Ne.map(e=>o.jsxs(S,{from:"user"===e.type?"user":"assistant",children:["bot"===e.type&&o.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden flex-shrink-0 border",style:{borderColor:"#E8D5A3"},children:o.jsx("img",{src:"/1000031289.png",alt:"Catie",className:"w-full h-full object-cover"})}),o.jsx(_,{children:o.jsx("div",{className:"px-3 py-2 rounded-xl text-sm",style:{backgroundColor:"user"===e.type?"rgba(166, 139, 91, 0.15)":"rgba(255, 255, 255, 0.6)",borderColor:"#E8D5A3",borderWidth:"1px",borderStyle:"solid",color:"#5D4E37"},children:o.jsx(B,{dangerouslySetInnerHTML:{__html:e.content.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/^‚Ä¢ (.*)$/gm,"<li>$1</li>").replace(/\n/g,"<br>")}})})}),"user"===e.type&&(null==q?void 0:q.avatar_url)&&o.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden flex-shrink-0 border",style:{borderColor:"#E8D5A3"},children:o.jsx("img",{src:q.avatar_url,alt:"You",className:"w-full h-full object-cover"})})]},e.id)),Ae&&o.jsxs(S,{from:"assistant",children:[o.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden flex-shrink-0 border",style:{borderColor:"#E8D5A3"},children:o.jsx("img",{src:"/1000031289.png",alt:"Catie",className:"w-full h-full object-cover"})}),o.jsx(_,{children:o.jsx("div",{className:"px-3 py-2 rounded-xl text-sm",style:{backgroundColor:"rgba(255, 255, 255, 0.6)",borderColor:"#E8D5A3",borderWidth:"1px",borderStyle:"solid"},children:o.jsx(P,{text:"Thinking..."})})})]})]}):o.jsx(A,{icon:o.jsx(D,{className:"size-9 sm:size-12",style:{color:"#8B6914"}}),title:"Ask Catie anything",description:"Get help with your PTE practice"})})}),o.jsx("div",{className:"flex-shrink-0 mt-2.5 sm:mt-4",children:o.jsxs("div",{className:"flex gap-1.5 sm:gap-2",children:[o.jsx("input",{type:"text",value:ke,onChange:e=>Ce(e.target.value),onKeyPress:e=>"Enter"===e.key&&!Ae&&ke.trim()&&Pe(),placeholder:"Ask Catie for PTE help...",className:"flex-1 px-2.5 py-1.5 sm:px-3 sm:py-2 rounded-lg text-sm focus:outline-none focus:ring-2",style:{backgroundColor:"rgba(255, 255, 255, 0.7)",borderColor:"#E8D5A3",borderWidth:"1px",borderStyle:"solid",color:"#5D4E37"},disabled:Ae}),o.jsx(c,{onClick:Pe,disabled:Ae||!ke.trim(),size:"icon",className:"h-9 w-9",style:{backgroundColor:"#A68B5B",color:"white"},children:Ae?o.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):o.jsx(w,{className:"w-4 h-4"})})]})})]})]}),!je&&o.jsx("div",{className:"cursor-pointer transition-all duration-200 hover:scale-110",style:{borderRadius:"50%",overflow:"hidden",width:"64px",height:"64px",boxShadow:"0 8px 20px rgba(166, 139, 91, 0.4)",border:"3px solid #E8D5A3"},onClick:()=>{ve(!0),requestAnimationFrame(()=>we(!0))},children:o.jsx("img",{src:"/1000031289.png",alt:"Ask Catie",className:"w-full h-full object-cover"})})]}),o.jsx(c,{variant:"outline",size:"sm",onClick:()=>$("/pte-portal"),className:"fixed bottom-6 left-6 z-50 rounded-xl",style:{backgroundColor:"#FEF9E7",borderColor:"#E8D5A3",color:"#5D4E37"},children:"Exit"})]}):o.jsx(n,{title:"PTE Practice",showBackButton:!0,children:o.jsxs("div",{className:"text-center py-12",children:[o.jsx("p",{className:"text-muted-foreground",children:"No items available"}),o.jsx(c,{onClick:()=>$("/pte-portal"),className:"mt-4",children:"Back to PTE Portal"})]})});var Te};export{W as default};
