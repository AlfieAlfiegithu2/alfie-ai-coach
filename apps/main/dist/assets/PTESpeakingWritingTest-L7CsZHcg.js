import{u as e,G as s,a3 as a,r as t,J as i,j as r,a4 as n,a5 as l,B as o,l as c,R as d,K as m,C as u,a as h,b as p,d as g,W as x,Y as j,M as w,L as f,T as v,a0 as N}from"./index-C3QnlETR.js";import{s as b}from"./supabase-DWL4C3fA.js";import{M as y}from"./mic-off-BX5web-H.js";import{C as _}from"./circle-alert-BAUdp1c0.js";import{S as k}from"./skip-forward-DsyckXBQ.js";const S={read_aloud:{name:"Read Aloud",isSpeaking:!0,isWriting:!1,hasAudio:!1,hasImage:!1,hasPassage:!0,timeLimit:40,instructions:"Look at the text below. In 30-40 seconds, you must read this text aloud as naturally and clearly as possible."},repeat_sentence:{name:"Repeat Sentence",isSpeaking:!0,isWriting:!1,hasAudio:!0,hasImage:!1,hasPassage:!1,timeLimit:15,instructions:"You will hear a sentence. Please repeat the sentence exactly as you hear it."},describe_image:{name:"Describe Image",isSpeaking:!0,isWriting:!1,hasAudio:!1,hasImage:!0,hasPassage:!1,timeLimit:40,instructions:"Look at the image below. In 25 seconds, please speak into the microphone and describe in detail what the image is showing."},retell_lecture:{name:"Retell Lecture",isSpeaking:!0,isWriting:!1,hasAudio:!0,hasImage:!0,hasPassage:!1,timeLimit:40,instructions:"You will hear a lecture. After listening to the lecture, in 10 seconds, please speak into the microphone and retell what you have just heard."},answer_short_question:{name:"Answer Short Question",isSpeaking:!0,isWriting:!1,hasAudio:!0,hasImage:!1,hasPassage:!1,timeLimit:10,instructions:"You will hear a question. Please give a simple and short answer. Often just one or a few words is enough."},summarize_group_discussion:{name:"Summarize Group Discussion",isSpeaking:!0,isWriting:!1,hasAudio:!0,hasImage:!1,hasPassage:!1,timeLimit:70,instructions:"You will hear a group discussion. You will have 10 seconds to prepare, then summarize the main points of the discussion in 70 seconds."},respond_to_situation:{name:"Respond to a Situation",isSpeaking:!0,isWriting:!1,hasAudio:!1,hasImage:!1,hasPassage:!0,timeLimit:40,instructions:"You will see a scenario. In 20 seconds prepare time, think about what you would say in this situation. Then speak for up to 40 seconds."},summarize_written_text:{name:"Summarize Written Text",isSpeaking:!1,isWriting:!0,hasAudio:!1,hasImage:!1,hasPassage:!0,timeLimit:600,wordLimit:75,instructions:"Read the passage below. Write a one-sentence summary of the passage. Your summary should be between 5 and 75 words."},write_essay:{name:"Write Essay",isSpeaking:!1,isWriting:!0,hasAudio:!1,hasImage:!1,hasPassage:!1,timeLimit:1200,wordLimit:300,instructions:"You will have 20 minutes to plan, write and revise an essay about the topic below. Your response will be judged on how well you develop a position, organize your ideas, present supporting details, and control the elements of standard written English."}},L=()=>{const L=e(),{type:A}=s(),{user:P}=a(),R=t.useRef(null),I=t.useRef(null),W=t.useRef([]),[C,E]=t.useState([]),[z,Y]=t.useState(0),[B,T]=t.useState(!0),[M,$]=t.useState(0),[F,q]=t.useState(!1),[D,U]=t.useState(!1),[G,J]=t.useState(null),[K,O]=t.useState(!1),[Q,H]=t.useState(!1),[V,X]=t.useState(""),[Z,ee]=t.useState(!1),[se,ae]=t.useState(!1),[te,ie]=t.useState(null),re=A?S[A]:null,ne=C[z],le=V.trim().split(/\s+/).filter(e=>e).length;t.useEffect(()=>{A&&oe()},[A]),t.useEffect(()=>{ne&&re&&($(ne.time_limit||re.timeLimit),X(""),J(null),ae(!1),ie(null),H(!1))},[z,ne]),t.useEffect(()=>{let e;return F&&M>0&&(e=setInterval(()=>{$(e=>e<=1?(q(!1),D&&ce(),0):e-1)},1e3)),()=>clearInterval(e)},[F,M,D]);const oe=async()=>{if(A){T(!0);try{const{data:e,error:s}=await b.from("pte_items").select("*").eq("pte_section_type",A).order("created_at",{ascending:!0});if(s)throw s;if(!e||0===e.length)return i.error("No items available for this type"),void L("/pte-portal");E(e)}catch(e){console.error("Error loading items:",e),i.error("Failed to load practice items")}finally{T(!1)}}},ce=()=>{I.current&&D&&(I.current.stop(),U(!1),q(!1))};return B?r.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:r.jsx(n,{})}):re&&ne?r.jsxs(l,{title:re.name,showBackButton:!0,children:[r.jsx("audio",{ref:R,onEnded:()=>{O(!1),H(!0)},className:"hidden"}),r.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs(c,{variant:"outline",className:"text-violet-600 border-violet-600",children:[z+1," / ",C.length]}),r.jsx(c,{variant:"secondary",children:ne.difficulty})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(d,{className:"w-4 h-4 text-muted-foreground"}),r.jsx("span",{className:"font-mono text-lg "+(M<10?"text-red-500":""),children:(de=M,`${Math.floor(de/60)}:${(de%60).toString().padStart(2,"0")}`)})]})]}),r.jsx(m,{value:z/C.length*100,className:"h-2"}),r.jsx(u,{className:"bg-violet-50 dark:bg-violet-950/20 border-violet-200",children:r.jsx(h,{className:"pt-4",children:r.jsx("p",{className:"text-sm text-violet-700 dark:text-violet-300",children:re.instructions})})}),r.jsxs(u,{children:[r.jsx(p,{children:r.jsx(g,{children:ne.title||re.name})}),r.jsxs(h,{className:"space-y-6",children:[r.jsx("div",{className:"text-lg",children:ne.prompt_text}),re.hasPassage&&ne.passage_text&&r.jsx(u,{className:"bg-gray-50 dark:bg-gray-900",children:r.jsx(h,{className:"pt-4",children:r.jsx("p",{className:"whitespace-pre-wrap",children:ne.passage_text})})}),re.hasImage&&ne.image_url&&r.jsx("div",{className:"flex justify-center",children:r.jsx("img",{src:ne.image_url,alt:"Practice image",className:"max-w-full max-h-96 rounded-lg shadow-lg"})}),re.hasAudio&&ne.audio_url&&r.jsx(u,{className:"bg-blue-50 dark:bg-blue-950/20",children:r.jsx(h,{className:"pt-4",children:r.jsxs("div",{className:"flex items-center justify-center gap-4",children:[r.jsx(o,{variant:"outline",size:"lg",onClick:K?()=>{R.current&&(R.current.pause(),O(!1))}:()=>{R.current&&(null==ne?void 0:ne.audio_url)&&(R.current.src=ne.audio_url,R.current.play(),O(!0))},disabled:Q&&"repeat_sentence"===A,children:K?r.jsx(x,{className:"w-6 h-6"}):r.jsx(j,{className:"w-6 h-6"})}),r.jsxs("div",{className:"text-sm text-muted-foreground",children:[Q?"Audio played":"Click to listen","repeat_sentence"===A&&Q&&" (one time only)"]})]})})}),re.isSpeaking&&!se&&r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex justify-center gap-4",children:[!D&&!G&&r.jsxs(o,{size:"lg",onClick:async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:!0}),s=new MediaRecorder(e);I.current=s,W.current=[],s.ondataavailable=e=>{e.data.size>0&&W.current.push(e.data)},s.onstop=()=>{const s=new Blob(W.current,{type:"audio/webm"});J(s),e.getTracks().forEach(e=>e.stop())},s.start(),U(!0),q(!0)}catch(e){console.error("Error starting recording:",e),i.error("Failed to access microphone")}},className:"bg-red-600 hover:bg-red-700",disabled:re.hasAudio&&!Q,children:[r.jsx(w,{className:"w-5 h-5 mr-2"}),"Start Recording"]}),D&&r.jsxs(o,{size:"lg",onClick:ce,variant:"destructive",children:[r.jsx(y,{className:"w-5 h-5 mr-2"}),"Stop Recording"]}),G&&!D&&r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs(c,{variant:"secondary",className:"bg-green-100 text-green-700",children:[r.jsx(f,{className:"w-4 h-4 mr-1"}),"Recording saved"]}),r.jsx(o,{variant:"outline",onClick:()=>J(null),children:"Re-record"})]})]}),D&&r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"w-4 h-4 bg-red-500 rounded-full animate-pulse mx-auto"}),r.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Recording..."})]})]}),re.isWriting&&!se&&r.jsxs("div",{className:"space-y-4",children:[!F&&!V&&r.jsx("div",{className:"text-center",children:r.jsx(o,{onClick:()=>{q(!0)},size:"lg",children:"Start Writing"})}),(F||V)&&r.jsxs(r.Fragment,{children:[r.jsx(v,{value:V,onChange:e=>X(e.target.value),placeholder:"Type your response here...",rows:10,className:"font-mono"}),r.jsxs("div",{className:"flex items-center justify-between text-sm",children:[r.jsxs("span",{className:le>(re.wordLimit||300)?"text-red-500":"text-muted-foreground",children:["Words: ",le," ",re.wordLimit&&`/ ${re.wordLimit}`]}),re.wordLimit&&le<5&&r.jsxs("span",{className:"text-yellow-500",children:[r.jsx(_,{className:"w-4 h-4 inline mr-1"}),"Minimum 5 words required"]})]})]})]}),!se&&r.jsx("div",{className:"flex justify-end",children:r.jsxs(o,{onClick:async()=>{if(P&&ne){ee(!0);try{let e=V,s=null;if((null==re?void 0:re.isSpeaking)&&G){const e=`pte-responses/${P.id}/${A}/${Date.now()}.webm`,{data:a,error:t}=await b.storage.from("audio").upload(e,G,{upsert:!0});if(t)throw t;const{data:{publicUrl:i}}=b.storage.from("audio").getPublicUrl(e);s=i}const{error:a}=await b.from("pte_user_progress").insert({user_id:P.id,pte_skill:"speaking_writing",pte_section_type:A,item_id:ne.id,completed:!0,response_text:e||null,response_audio_url:s,time_taken:(ne.time_limit||(null==re?void 0:re.timeLimit)||60)-M});if(a)throw a;ne.sample_answer&&ie({sampleAnswer:ne.sample_answer}),ae(!0),i.success("Response submitted!")}catch(e){console.error("Error submitting response:",e),i.error("Failed to submit response")}finally{ee(!1)}}},disabled:Z||re.isSpeaking&&!G||re.isWriting&&le<5,className:"bg-violet-600 hover:bg-violet-700",children:[r.jsx(N,{className:"w-4 h-4 mr-2"}),Z?"Submitting...":"Submit Response"]})}),se&&r.jsxs("div",{className:"space-y-4",children:[r.jsxs(u,{className:"bg-green-50 dark:bg-green-950/20 border-green-200",children:[r.jsx(p,{children:r.jsxs(g,{className:"text-green-700 dark:text-green-400 flex items-center gap-2",children:[r.jsx(f,{className:"w-5 h-5"}),"Response Submitted"]})}),r.jsx(h,{children:(null==te?void 0:te.sampleAnswer)&&r.jsxs("div",{className:"space-y-2",children:[r.jsx("p",{className:"font-medium",children:"Sample Answer:"}),r.jsx("p",{className:"text-muted-foreground whitespace-pre-wrap",children:te.sampleAnswer})]})})]}),r.jsx("div",{className:"flex justify-end",children:r.jsx(o,{onClick:()=>{z<C.length-1?Y(e=>e+1):(i.success("You have completed all items!"),L("/pte-portal"))},className:"bg-violet-600 hover:bg-violet-700",children:z<C.length-1?r.jsxs(r.Fragment,{children:[r.jsx(k,{className:"w-4 h-4 mr-2"}),"Next Item"]}):"Complete"})})]})]})]})]})]}):r.jsx(l,{title:"PTE Practice",showBackButton:!0,children:r.jsxs("div",{className:"text-center py-12",children:[r.jsx("p",{className:"text-muted-foreground",children:"No items available"}),r.jsx(o,{onClick:()=>L("/pte-portal"),className:"mt-4",children:"Back to PTE Portal"})]})});var de};export{L as default};
