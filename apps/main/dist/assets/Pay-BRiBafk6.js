import{c4 as e,bE as t,r,u as n,j as s,ai as o,x as a,R as i,ap as l,am as c,c5 as d,N as u,as as m}from"./index-CutW7JrA.js";import{s as p}from"./supabase-DWL4C3fA.js";import{T as f}from"./tag-D1GXF25r.js";import{Z as x}from"./zap-D6GycfEg.js";import{L as h}from"./lock-DOMddyzy.js";var b,y="https://js.stripe.com/v3",g=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,v="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",j=function(e){var t=document.createElement("script");t.src="".concat(y).concat("");var r=document.head||document.body;if(!r)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return r.appendChild(t),t},w=null,E=null,N=null,k=function(e){return null!==w?w:(w=new Promise(function(t,r){if("undefined"!=typeof window&&"undefined"!=typeof document)if(window.Stripe&&e&&console.warn(v),window.Stripe)t(window.Stripe);else try{var n=function(){for(var e=document.querySelectorAll('script[src^="'.concat(y,'"]')),t=0;t<e.length;t++){var r=e[t];if(g.test(r.src))return r}return null}();if(n&&e)console.warn(v);else if(n){if(n&&null!==N&&null!==E){var s;n.removeEventListener("load",N),n.removeEventListener("error",E),null===(s=n.parentNode)||void 0===s||s.removeChild(n),n=j()}}else n=j();N=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}}(t,r),E=function(e){return function(){e(new Error("Failed to load Stripe.js"))}}(r),n.addEventListener("load",N),n.addEventListener("error",E)}catch(o){return void r(o)}else t(null)})).catch(function(e){return w=null,Promise.reject(e)})},C=!1,S=function(){return b||(b=k(null).catch(function(e){return b=null,Promise.reject(e)}))};Promise.resolve().then(function(){return S()}).catch(function(e){C||console.warn(e)});function D(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function B(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?D(Object(r),!0).forEach(function(t){P(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function A(e){return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function P(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function F(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==r)return;var n,s,o=[],a=!0,i=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);a=!0);}catch(l){i=!0,s=l}finally{try{a||null==r.return||r.return()}finally{if(i)throw s}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return M(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return M(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var _=function(e,r,n){var s=!!n,o=t.useRef(n);t.useEffect(function(){o.current=n},[n]),t.useEffect(function(){if(!s||!e)return function(){};var t=function(){o.current&&o.current.apply(o,arguments)};return e.on(r,t),function(){e.off(r,t)}},[s,r,e,o])},O=function(e){var r=t.useRef(e);return t.useEffect(function(){r.current=e},[e]),r.current},L=function(e){return null!==e&&"object"===A(e)},R="[object Object]",$=function e(t,r){if(!L(t)||!L(r))return t===r;var n=Array.isArray(t);if(n!==Array.isArray(r))return!1;var s=Object.prototype.toString.call(t)===R;if(s!==(Object.prototype.toString.call(r)===R))return!1;if(!s&&!n)return t===r;var o=Object.keys(t),a=Object.keys(r);if(o.length!==a.length)return!1;for(var i={},l=0;l<o.length;l+=1)i[o[l]]=!0;for(var c=0;c<a.length;c+=1)i[a[c]]=!0;var d=Object.keys(i);if(d.length!==o.length)return!1;var u=t,m=r;return d.every(function(t){return e(u[t],m[t])})},I=function(e,t,r){return L(e)?Object.keys(e).reduce(function(n,s){var o=!L(t)||!$(e[s],t[s]);return r.includes(s)?(o&&console.warn("Unsupported prop change: options.".concat(s," is not a mutable property.")),n):o?B(B({},n||{}),{},P({},s,e[s])):n},null):null},T="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",U=function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T;if(null===e||L(t=e)&&"function"==typeof t.elements&&"function"==typeof t.createToken&&"function"==typeof t.createPaymentMethod&&"function"==typeof t.confirmCardPayment)return e;throw new Error(r)},q=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T;if(function(e){return L(e)&&"function"==typeof e.then}(e))return{tag:"async",stripePromise:Promise.resolve(e).then(function(e){return U(e,t)})};var r=U(e,t);return null===r?{tag:"empty"}:{tag:"sync",stripe:r}},W=t.createContext(null);W.displayName="ElementsContext";var z=function(e,t){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e},K=function(e){var r=e.stripe,n=e.options,s=e.children,o=t.useMemo(function(){return q(r)},[r]),a=F(t.useState(function(){return{stripe:"sync"===o.tag?o.stripe:null,elements:"sync"===o.tag?o.stripe.elements(n):null}}),2),i=a[0],l=a[1];t.useEffect(function(){var e=!0,t=function(e){l(function(t){return t.stripe?t:{stripe:e,elements:e.elements(n)}})};return"async"!==o.tag||i.stripe?"sync"!==o.tag||i.stripe||t(o.stripe):o.stripePromise.then(function(r){r&&e&&t(r)}),function(){e=!1}},[o,i,n]);var c=O(r);t.useEffect(function(){null!==c&&c!==r&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[c,r]);var d=O(n);return t.useEffect(function(){if(i.elements){var e=I(n,d,["clientSecret","fonts"]);e&&i.elements.update(e)}},[n,d,i.elements]),t.useEffect(function(){var e;(e=i.stripe)&&e._registerWrapper&&e.registerAppInfo&&(e._registerWrapper({name:"react-stripe-js",version:"2.8.1"}),e.registerAppInfo({name:"react-stripe-js",version:"2.8.1",url:"https://stripe.com/docs/stripe-js/react"}))},[i.stripe]),t.createElement(W.Provider,{value:i},s)};K.propTypes={stripe:e.any,options:e.object};var V=function(){var e,r;return(e="calls useElements()",r=t.useContext(W),z(r,e)).elements};e.func.isRequired;var Y=t.createContext(null);Y.displayName="CustomCheckoutSdkContext";t.createContext(null).displayName="CustomCheckoutContext",e.any,e.shape({clientSecret:e.string.isRequired,elementsOptions:e.object}).isRequired;var Z=function(e){var r=t.useContext(Y),n=t.useContext(W);if(r&&n)throw new Error("You cannot wrap the part of your app that ".concat(e," in both <CustomCheckoutProvider> and <Elements> providers."));return r?function(e,t){if(!e)throw new Error("Could not find CustomCheckoutProvider context; You need to wrap the part of your app that ".concat(t," in an <CustomCheckoutProvider> provider."));return e}(r,e):z(n,e)},G=function(r,n){var s,o="".concat((s=r).charAt(0).toUpperCase()+s.slice(1),"Element"),a=n?function(e){Z("mounts <".concat(o,">"));var r=e.id,n=e.className;return t.createElement("div",{id:r,className:n})}:function(e){var n,s=e.id,a=e.className,i=e.options,l=void 0===i?{}:i,c=e.onBlur,d=e.onFocus,u=e.onReady,m=e.onChange,p=e.onEscape,f=e.onClick,x=e.onLoadError,h=e.onLoaderStart,b=e.onNetworksChange,y=e.onConfirm,g=e.onCancel,v=e.onShippingAddressChange,j=e.onShippingRateChange,w=Z("mounts <".concat(o,">")),E="elements"in w?w.elements:null,N="customCheckoutSdk"in w?w.customCheckoutSdk:null,k=F(t.useState(null),2),C=k[0],S=k[1],D=t.useRef(null),B=t.useRef(null);_(C,"blur",c),_(C,"focus",d),_(C,"escape",p),_(C,"click",f),_(C,"loaderror",x),_(C,"loaderstart",h),_(C,"networkschange",b),_(C,"confirm",y),_(C,"cancel",g),_(C,"shippingaddresschange",v),_(C,"shippingratechange",j),_(C,"change",m),u&&(n="expressCheckout"===r?u:function(){u(C)}),_(C,"ready",n),t.useLayoutEffect(function(){if(null===D.current&&null!==B.current&&(E||N)){var e=null;N?e=N.createElement(r,l):E&&(e=E.create(r,l)),D.current=e,S(e),e&&e.mount(B.current)}},[E,N,l]);var A=O(l);return t.useEffect(function(){if(D.current){var e=I(l,A,["paymentRequest"]);e&&"update"in D.current&&D.current.update(e)}},[l,A]),t.useLayoutEffect(function(){return function(){if(D.current&&"function"==typeof D.current.destroy)try{D.current.destroy(),D.current=null}catch(e){}}},[]),t.createElement("div",{id:s,className:a,ref:B})};return a.propTypes={id:e.string,className:e.string,onChange:e.func,onBlur:e.func,onFocus:e.func,onReady:e.func,onEscape:e.func,onClick:e.func,onLoadError:e.func,onLoaderStart:e.func,onNetworksChange:e.func,onConfirm:e.func,onCancel:e.func,onShippingAddressChange:e.func,onShippingRateChange:e.func,options:e.object},a.displayName=o,a.__elementType=r,a},H="undefined"==typeof window;t.createContext(null).displayName="EmbeddedCheckoutProviderContext";G("auBankAccount",H),G("card",H),G("cardNumber",H),G("cardExpiry",H),G("cardCvc",H),G("fpxBank",H),G("iban",H),G("idealBank",H),G("p24Bank",H),G("epsBank",H);var J=G("payment",H);G("expressCheckout",H),G("currencySelector",H),G("paymentRequestButton",H),G("linkAuthentication",H),G("address",H),G("shippingAddress",H),G("paymentMethodMessaging",H),G("affirmMessage",H),G("afterpayClearpayMessage",H);const Q={pro:4*20,ultra:4*75},X={pro:{monthly:49,threeMonth:39,sixMonth:29},ultra:{monthly:199,threeMonth:149,sixMonth:119}},ee={pro:{week:0,monthly:Math.round(100*(1-X.pro.monthly/Q.pro)),threeMonth:Math.round(100*(1-X.pro.threeMonth/Q.pro)),sixMonth:Math.round(100*(1-X.pro.sixMonth/Q.pro))},ultra:{week:0,monthly:Math.round(100*(1-X.ultra.monthly/Q.ultra)),threeMonth:Math.round(100*(1-X.ultra.threeMonth/Q.ultra)),sixMonth:Math.round(100*(1-X.ultra.sixMonth/Q.ultra))}},te={pro:X.pro.monthly,ultra:X.ultra.monthly},re={premium:{name:"Pro",description:"Unlimited AI Practice & Feedback",features:["Unlimited AI Practice Tests","Examiner-Level Detailed Feedback","Advanced Pronunciation Coaching","Personalized Study Roadmap"],icon:u,color:"from-[#d97757] to-[#e8956f]",shadowColor:"shadow-[#d97757]/20",basePrice:te.pro},pro:{name:"Pro",description:"Unlimited AI Practice & Feedback",features:["Unlimited AI Practice Tests","Examiner-Level Detailed Feedback","Advanced Pronunciation Coaching","Personalized Study Roadmap"],icon:u,color:"from-[#d97757] to-[#e8956f]",shadowColor:"shadow-[#d97757]/20",basePrice:te.pro},ultra:{name:"Ultra",description:"Ultimate Mentorship Package",features:["Everything in Pro Plan","1-on-1 Personal Meeting with Developers","All Premium Templates & E-books","Direct Access to New Beta Features"],icon:m,color:"from-amber-500 to-yellow-400",shadowColor:"shadow-amber-500/20",basePrice:te.ultra}},ne=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];C=!0;var n=Date.now();return S().then(function(e){return function(e,t,r){if(null===e)return null;var n=e.apply(void 0,t);return function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"3.4.1",startTime:t})}(n,r),n}(e,t,n)})}(d.stripe.publishableKey),se=({plan:e,totalAmount:t,currency:n,region:o,onSuccess:a,onError:i})=>{const c=Z("calls useStripe()").stripe,d=V(),[u,m]=r.useState(!1),[p,f]=r.useState(null);return s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!c||!d)return;m(!0),f(null);const{error:t,paymentIntent:r}=await c.confirmPayment({elements:d,confirmParams:{return_url:`${window.location.origin}/dashboard?payment=success`},redirect:"if_required"});t?(f(t.message||"Payment failed"),i(t.message||"Payment failed"),m(!1)):r&&"succeeded"===r.status?a():m(!1)},className:"space-y-6",children:[s.jsx(J,{options:{layout:"tabs",business:{name:"English AIdol"},paymentMethodOrder:"korea"===o?["card","kakao_pay","naver_pay"]:"china"===o?["alipay","wechat_pay"]:["card","apple_pay","google_pay"]}}),p&&s.jsxs("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-lg flex items-center gap-2",children:[s.jsx(x,{className:"w-4 h-4"})," ",p]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("button",{type:"submit",disabled:!c||u,className:`w-full bg-gradient-to-r ${e.color} text-white font-semibold py-4 px-6 rounded-xl shadow-lg hover:shadow-xl transition-all disabled:opacity-70 flex items-center justify-center gap-2 transform active:scale-[0.98] duration-200`,children:[u?s.jsx(l,{className:"w-5 h-5 animate-spin"}):s.jsx(h,{className:"w-4 h-4"}),"Pay Securely ",{usd:"$",krw:"₩",cny:"¥"}[n],t.toLocaleString()]}),s.jsxs("p",{className:"text-center text-xs text-[#8B6914] font-sans",children:["By clicking pay, you read and agree to our"," ",s.jsx("a",{href:"/terms-of-service",className:"underline hover:text-[#5D4E37] transition-colors",target:"_blank",rel:"noopener noreferrer",children:"Terms"}),","," ",s.jsx("a",{href:"/privacy-policy",className:"underline hover:text-[#5D4E37] transition-colors",target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"})," ","and"," ",s.jsx("a",{href:"/refund-policy",className:"underline hover:text-[#5D4E37] transition-colors",target:"_blank",rel:"noopener noreferrer",children:"Refund Policy"}),"."]}),s.jsx("p",{className:"text-center text-xs text-[#A68B5B] font-sans mt-2",children:"Subscription automatically renews. Cancel anytime in Settings."})]})]})},oe=()=>{const e=function(){const{search:e}=c();return r.useMemo(()=>new URLSearchParams(e),[e])}(),t=e.get("plan")||"premium";e.get("cancelled");const[d,u]=r.useState(!1),[m,b]=r.useState(null),[y,g]=r.useState(null),v=n(),[j,w]=r.useState("ultra"===t?"ultra":"pro"),[E,N]=r.useState(1),[k,C]=r.useState(!0),[S,D]=r.useState("embedded"),[B,A]=r.useState(""),[P,F]=r.useState("international"),[M,_]=r.useState(null),[O,L]=r.useState(!1),[R,$]=r.useState(null),I="korea"===P?"krw":"china"===P?"cny":"usd",T=re[j],U="pro"===j?"premium":"ultra",q=(e,t)=>{const r=ee[t];return"week"===e?r.week:6===e?r.sixMonth:3===e?r.threeMonth:1===e?r.monthly:0},W=(e,t)=>{const r=X[t];return"week"===e?Q[t]:6===e?r.sixMonth:3===e?r.threeMonth:r.monthly},z={usd:"$",krw:"₩",cny:"¥"},V={usd:1,krw:1350,cny:7.2},Y=q(E,j),Z=Q[j],G=W(E,j),H="week"===E,J=H?.25:E,te=Math.round(Z*J),oe=H?Math.round(.25*Z):G*E,ae=te-oe,ie=Math.round(te*V[I]),le=Math.round(ae*V[I]),ce=Math.round(oe*V[I]),de=Math.round(G*V[I]);let ue=0;M&&(ue="percent"===M.discountType?Math.round(ce*(M.discountValue/100)):Math.round(M.discountValue*V[I]));const me=Math.max(ce-ue,Math.round(1*V[I]));r.useEffect(()=>{C(!0)},[E]),r.useEffect(()=>{"embedded"===S&&pe()},[S,j,E,I,M]);const pe=async()=>{u(!0),b(null),g(null);try{const{data:{session:e}}=await p.auth.getSession();if(!e)return void setTimeout(()=>v("/auth"),500);const{data:t,error:r}=await p.functions.invoke("create-embedded-payment",{body:{planId:U,months:E,currency:I,affiliateCode:(null==M?void 0:M.code)||void 0}});if(r||!(null==t?void 0:t.clientSecret))throw new Error((null==r?void 0:r.message)||"Init failed");g(t.clientSecret)}catch(e){console.error(e),b("Failed to load payment form")}finally{u(!1)}};return s.jsx("div",{className:"min-h-screen w-full font-serif bg-[#FEF9E7] flex items-center justify-center p-4 py-8",children:s.jsxs("div",{className:"w-full max-w-6xl grid grid-cols-1 lg:grid-cols-12 gap-8 items-start",children:[s.jsx("div",{className:"lg:col-span-5 flex flex-col gap-6 order-2 lg:order-1",children:s.jsxs("div",{className:"bg-[#FEF9E7] rounded-3xl p-8 shadow-sm border border-[#E8D5A3] relative overflow-hidden group hover:shadow-md transition-all duration-500",children:[s.jsxs("button",{onClick:()=>v(-1),className:"inline-flex items-center gap-2 text-sm text-[#8B6914] hover:text-[#5D4E37] mb-6 transition-colors font-medium",children:[s.jsx(o,{className:"w-4 h-4"})," Back to Plans"]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm font-semibold text-[#5D4E37] mb-3 font-sans",children:"Select Plan"}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("button",{onClick:()=>w("pro"),className:"p-4 rounded-xl border-2 transition-all text-left "+("pro"===j?"border-[#d97757] bg-gradient-to-br from-[#d97757]/10 to-[#e8956f]/10":"border-[#E8D5A3] hover:border-[#d97757]/50"),children:[s.jsx("div",{className:"mb-1",children:s.jsx("span",{className:"font-bold "+("pro"===j?"text-[#d97757]":"text-[#5D4E37]"),children:"Pro"})}),s.jsxs("span",{className:"text-sm text-[#8B6914]",children:[s.jsx("span",{className:"text-xs",children:"from "}),"$",X.pro.sixMonth,"/mo"]})]}),s.jsxs("button",{onClick:()=>w("ultra"),className:"p-4 rounded-xl border-2 transition-all text-left "+("ultra"===j?"border-amber-500 bg-gradient-to-br from-amber-500/10 to-yellow-400/10":"border-[#E8D5A3] hover:border-amber-500/50"),children:[s.jsx("div",{className:"mb-1",children:s.jsx("span",{className:"font-bold "+("ultra"===j?"text-amber-600":"text-[#5D4E37]"),children:"Ultra"})}),s.jsxs("span",{className:"text-sm text-[#8B6914]",children:[s.jsx("span",{className:"text-xs",children:"from "}),"$",X.ultra.sixMonth,"/mo"]})]})]})]}),s.jsx("div",{className:"flex items-center gap-4 mb-6",children:s.jsx("div",{children:s.jsxs("h1",{className:"text-3xl font-bold text-[#5D4E37] tracking-tight",children:[T.name," Plan"]})})}),s.jsxs("div",{className:"mb-8",children:[s.jsxs("div",{className:"flex items-baseline gap-1",children:[s.jsxs("span",{className:"text-5xl font-bold text-[#5D4E37] font-sans",children:[z[I],de.toLocaleString()]}),s.jsx("span",{className:"text-[#8B6914] font-medium font-sans",children:"/mo"})]}),Y>0&&s.jsxs("p",{className:"text-sm text-[#A68B5B] mt-1 font-sans",children:[s.jsxs("span",{className:"line-through",children:[z[I],Math.round(Q[j]*V[I]).toLocaleString(),"/mo"]}),s.jsxs("span",{className:"ml-2 text-green-600 font-medium",children:[Y,"% off"]})]}),s.jsx("p",{className:"text-base text-[#8B6914] mt-3 leading-relaxed",children:T.description})]}),s.jsx("div",{className:"space-y-4",children:T.features.map((e,t)=>s.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-xl hover:bg-[#FDF6E3] transition-colors border border-transparent hover:border-[#E8D5A3]/30",children:[s.jsx("div",{className:"p-1 rounded-full bg-[#E8D5A3] mt-0.5 shrink-0",children:s.jsx(a,{className:"w-3 h-3 text-[#5D4E37]"})}),s.jsx("span",{className:"text-sm font-medium text-[#5D4E37] leading-tight",children:e})]},t))})]})}),s.jsxs("div",{className:"lg:col-span-7 bg-[#FEF9E7] rounded-3xl shadow-xl shadow-[#E8D5A3]/20 border border-[#E8D5A3] overflow-hidden flex flex-col order-1 lg:order-2",children:[s.jsx("div",{className:"p-8 border-b border-[#E8D5A3] bg-[#FDF6E3]/50",children:s.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-bold text-[#5D4E37] flex items-center gap-2 font-serif",children:"Complete Payment"}),s.jsx("p",{className:"text-sm text-[#8B6914] mt-1 font-sans",children:"Choose your billing cycle"})]})})}),s.jsxs("div",{className:"p-8",children:[s.jsxs("div",{className:"mb-8",children:[s.jsxs("label",{className:"block text-sm font-semibold text-[#5D4E37] mb-3 flex items-center gap-2 font-sans",children:[s.jsx(i,{className:"w-4 h-4 text-[#A68B5B]"})," Billing Cycle"]}),s.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[s.jsxs("button",{onClick:()=>N("week"),className:"relative p-4 rounded-xl border transition-all text-left group font-sans "+("week"===E?"border-[#A68B5B] bg-[#FDF6E3] ring-1 ring-[#A68B5B]/30":"border-[#E8D5A3] hover:border-[#A68B5B] hover:bg-[#FDF6E3]/50"),children:[s.jsx("div",{className:"font-bold text-lg mb-1 "+("week"===E?"text-[#5D4E37]":"text-[#8B6914]"),children:"1 Week"}),s.jsxs("div",{className:"mt-2 text-sm font-bold text-[#5D4E37]",children:[z[I],Math.round(Q[j]*V[I]).toLocaleString(),s.jsx("span",{className:"text-xs font-normal text-[#8B6914]",children:"/mo"})]})]}),[1,3,6].map(e=>{const t=q(e,j),r=W(e,j),n=Math.round(r*V[I]);return s.jsxs("button",{onClick:()=>N(e),className:"relative p-4 rounded-xl border transition-all text-left group font-sans "+(E===e?"border-[#A68B5B] bg-[#FDF6E3] ring-1 ring-[#A68B5B]/30":"border-[#E8D5A3] hover:border-[#A68B5B] hover:bg-[#FDF6E3]/50"),children:[s.jsxs("div",{className:"absolute -top-2.5 right-3 bg-[#A68B5B] text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm tracking-wide",children:["SAVE ",t,"%"]}),s.jsx("div",{className:"font-bold text-lg mb-1 "+(E===e?"text-[#5D4E37]":"text-[#8B6914]"),children:1===e?"Monthly":`${e} Months`}),s.jsxs("div",{className:"mt-2 text-sm font-bold text-[#5D4E37]",children:[z[I],n.toLocaleString(),s.jsx("span",{className:"text-xs font-normal text-[#8B6914]",children:"/mo"})]})]},e)})]})]}),s.jsx("div",{className:"bg-[#FDF6E3] rounded-2xl p-5 border border-[#E8D5A3] mb-8 font-sans",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsxs("span",{className:"text-[#8B6914]",children:["Subtotal (",H?"1 week":`${E} month${E>1?"s":""}`,")"]}),s.jsxs("span",{className:"font-medium text-[#5D4E37]",children:[z[I],ie.toLocaleString()]})]}),le>0&&s.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[s.jsxs("span",{children:["Plan Discount (",Y,"% off)"]}),s.jsxs("span",{className:"font-bold",children:["-",z[I],le.toLocaleString()]})]}),M&&ue>0&&s.jsxs("div",{className:"flex justify-between text-sm text-purple-600",children:[s.jsxs("span",{children:["Promo Code (",M.code,")"]}),s.jsxs("span",{className:"font-bold",children:["-",z[I],ue.toLocaleString()]})]}),s.jsxs("div",{className:"border-t border-[#E8D5A3] pt-3 flex justify-between items-center",children:[s.jsx("span",{className:"font-bold text-lg text-[#5D4E37]",children:"Total Due"}),s.jsxs("div",{className:"text-right",children:[s.jsxs("span",{className:"font-bold text-2xl text-[#5D4E37]",children:[z[I],me.toLocaleString()]}),s.jsx("p",{className:"text-[10px] text-[#8B6914] font-medium uppercase tracking-wider",children:I.toUpperCase()})]})]})]})}),s.jsxs("div",{className:"mb-6",children:[s.jsxs("label",{className:"block text-sm font-semibold text-[#5D4E37] mb-3 font-sans flex items-center gap-2",children:[s.jsx(f,{className:"w-4 h-4 text-[#A68B5B]"})," Discount Code (Optional)"]}),M?s.jsxs("div",{className:"flex items-center justify-between p-4 rounded-xl border border-green-300 bg-green-50",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-8 h-8 rounded-full bg-green-100 flex items-center justify-center",children:s.jsx(a,{className:"w-4 h-4 text-green-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold text-green-700 font-sans text-sm",children:M.code}),s.jsx("p",{className:"text-xs text-green-600 font-sans",children:M.message})]})]}),s.jsx("button",{type:"button",onClick:()=>{_(null),A(""),$(null)},className:"text-sm text-red-500 hover:text-red-700 font-medium font-sans",children:"Remove"})]}):s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",value:B,onChange:e=>{A(e.target.value.toUpperCase()),$(null)},placeholder:"Enter coupon code",className:`flex-1 px-4 py-3 rounded-xl border ${R?"border-red-300":"border-[#E8D5A3]"} bg-[#FEF9E7] text-[#5D4E37] placeholder-[#A68B5B]/60 focus:outline-none focus:ring-2 focus:ring-[#A68B5B]/30 focus:border-[#A68B5B] font-sans text-sm`}),s.jsx("button",{type:"button",onClick:async()=>{if(B.trim()){L(!0),$(null);try{const{data:e,error:t}=await p.from("affiliate_codes").select("id, code, discount_type, discount_value, is_active, expires_at, max_redemptions, current_redemptions").eq("code",B.trim().toUpperCase()).eq("is_active",!0).maybeSingle();if(t)return console.error("Code lookup error:",t),$("Failed to validate code"),void _(null);if(!e)return $("Invalid code"),void _(null);if(e.expires_at&&new Date(e.expires_at)<new Date)return $("Code has expired"),void _(null);if(e.max_redemptions&&e.current_redemptions>=e.max_redemptions)return $("Code has reached maximum uses"),void _(null);const r="percent"===e.discount_type?`${e.discount_value}% off applied!`:`${z.usd}${e.discount_value} off applied!`;_({code:e.code,discountType:e.discount_type,discountValue:e.discount_value,message:r}),$(null)}catch(e){console.error("Coupon validation error:",e),$("Failed to validate code"),_(null)}finally{L(!1)}}else $("Please enter a code")},disabled:O||!B.trim(),className:"px-5 py-3 rounded-xl border border-[#E8D5A3] bg-[#FDF6E3] text-[#5D4E37] font-medium text-sm hover:bg-[#E8D5A3]/30 transition-colors font-sans disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:O?s.jsx(l,{className:"w-4 h-4 animate-spin"}):"Apply"})]}),R&&s.jsx("p",{className:"text-xs text-red-500 font-sans",children:R})]})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm font-semibold text-[#5D4E37] mb-3 font-sans",children:"Region"}),s.jsxs("div",{className:"flex p-1 bg-[#FDF6E3] rounded-xl mb-4 border border-[#E8D5A3]",children:[s.jsx("button",{onClick:()=>F("international"),className:"flex-1 py-2.5 text-sm font-medium rounded-lg transition-all font-sans "+("international"===P?"bg-[#FEF9E7] text-[#5D4E37] shadow-sm border border-[#E8D5A3]":"text-[#8B6914] hover:text-[#5D4E37]"),children:"International"}),s.jsx("button",{onClick:()=>F("china"),className:"flex-1 py-2.5 text-sm font-medium rounded-lg transition-all font-sans "+("china"===P?"bg-[#FEF9E7] text-[#5D4E37] shadow-sm border border-[#E8D5A3]":"text-[#8B6914] hover:text-[#5D4E37]"),children:"China"}),s.jsx("button",{onClick:()=>F("korea"),className:"flex-1 py-2.5 text-sm font-medium rounded-lg transition-all font-sans "+("korea"===P?"bg-[#FEF9E7] text-[#5D4E37] shadow-sm border border-[#E8D5A3]":"text-[#8B6914] hover:text-[#5D4E37]"),children:"Korea"})]}),"korea"===P&&s.jsx("p",{className:"text-xs text-[#8B6914] font-sans mb-4",children:"Kakao Pay, Naver Pay, Korean Cards available"}),"china"===P&&s.jsx("p",{className:"text-xs text-[#8B6914] font-sans mb-4",children:"Alipay, WeChat Pay available"}),s.jsx("label",{className:"block text-sm font-semibold text-[#5D4E37] mb-3 font-sans mt-4",children:"Checkout"}),s.jsxs("div",{className:"flex p-1 bg-[#FDF6E3] rounded-xl mb-4 border border-[#E8D5A3]",children:[s.jsx("button",{onClick:()=>D("embedded"),className:"flex-1 py-2.5 text-sm font-medium rounded-lg transition-all font-sans "+("embedded"===S?"bg-[#FEF9E7] text-[#5D4E37] shadow-sm border border-[#E8D5A3]":"text-[#8B6914] hover:text-[#5D4E37]"),children:"Pay Here"}),s.jsx("button",{onClick:()=>D("redirect"),className:"flex-1 py-2.5 text-sm font-medium rounded-lg transition-all font-sans "+("redirect"===S?"bg-[#FEF9E7] text-[#5D4E37] shadow-sm border border-[#E8D5A3]":"text-[#8B6914] hover:text-[#5D4E37]"),children:"Stripe Checkout"})]})]}),m&&s.jsxs("div",{className:"mb-6 bg-red-50 border border-red-100 text-red-600 p-4 rounded-xl text-sm flex gap-3 items-start animate-in fade-in slide-in-from-top-2",children:[s.jsx(x,{className:"w-5 h-5 shrink-0 mt-0.5"}),s.jsx("span",{children:m})]}),"embedded"===S&&s.jsx("div",{className:"animate-in fade-in zoom-in-95 duration-300",children:d&&!y?s.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-[#8B6914] gap-3",children:[s.jsx(l,{className:"w-8 h-8 animate-spin text-[#A68B5B]"}),s.jsx("span",{className:"text-sm font-medium",children:"Initializing secure checkout..."})]}):y?s.jsx(K,{stripe:ne,options:{clientSecret:y,appearance:{theme:"flat",variables:{colorPrimary:"#A68B5B",colorBackground:"#FEF9E7",colorText:"#5D4E37",colorDanger:"#ef4444",borderRadius:"12px",fontFamily:"ui-sans-serif, system-ui, sans-serif"},rules:{".Label":{marginBottom:"8px"},".Tab--selected":{borderColor:"#A68B5B",boxShadow:"0 0 0 1px #A68B5B"}}}},children:s.jsx(se,{plan:T,totalAmount:me,currency:I,region:P,onSuccess:()=>v("/dashboard?payment=success"),onError:b})},`${y}-${P}-${I}`):null}),"redirect"===S&&s.jsxs("div",{className:"text-center py-6 animate-in fade-in zoom-in-95 duration-300",children:[s.jsx("p",{className:"text-[#8B6914] text-sm mb-6 max-w-sm mx-auto font-sans",children:"korea"===P?"Pay with Kakao Pay, Naver Pay, or Korean Cards via Stripe.":"china"===P?"Pay with Alipay, WeChat Pay via Stripe.":"Pay with Card, Apple Pay, Google Pay, or Crypto via Stripe."}),s.jsxs("button",{onClick:async()=>{u(!0);try{const{data:{session:e}}=await p.auth.getSession();if(!e)return void v("/auth");const{data:t,error:r}=await p.functions.invoke("create-payment-intent",{body:{planId:U,months:E,currency:I,successUrl:`${window.location.origin}/dashboard?payment=success&plan=${U}`,cancelUrl:`${window.location.origin}/pay?plan=${U}&cancelled=true`,affiliateCode:(null==M?void 0:M.code)||void 0}});if(r||!(null==t?void 0:t.url))throw new Error("Checkout failed");window.location.href=t.url}catch(e){b(e.message),u(!1)}},disabled:d,className:"w-full bg-[#A68B5B] text-white font-bold py-4 px-6 rounded-xl shadow-lg hover:shadow-[#A68B5B]/30 hover:-translate-y-0.5 transition-all flex items-center justify-center gap-2 font-sans",children:[d?s.jsx(l,{className:"w-5 h-5 animate-spin"}):s.jsx(h,{className:"w-5 h-5"}),"Pay ",z[I],me.toLocaleString()]}),s.jsxs("p",{className:"text-center text-xs text-[#8B6914] font-sans mt-4",children:["By clicking, you read and agree to our"," ",s.jsx("a",{href:"/terms-of-service",className:"underline hover:text-[#5D4E37] transition-colors",target:"_blank",rel:"noopener noreferrer",children:"Terms"}),","," ",s.jsx("a",{href:"/privacy-policy",className:"underline hover:text-[#5D4E37] transition-colors",target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"})," ","and"," ",s.jsx("a",{href:"/refund-policy",className:"underline hover:text-[#5D4E37] transition-colors",target:"_blank",rel:"noopener noreferrer",children:"Refund Policy"}),"."]}),s.jsx("p",{className:"text-center text-xs text-[#A68B5B] font-sans mt-2",children:"Subscription automatically renews. Cancel anytime in Settings."})]})]})]})]})})};export{oe as default};
