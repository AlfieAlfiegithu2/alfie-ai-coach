import{c as e,u as s,r as t,j as r}from"./vendor-react-rLLBBC7n.js";import{d as n,y as a,P as i,C as c,a as l,B as o,s as d}from"./index-BDl0jLJK.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-charts-0DeywwxG.js";import"./vendor-ui-BGi_EvHx.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";function m(e){const s=[...e];for(let t=s.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[s[t],s[e]]=[s[e],s[t]]}return s}function u(e){if(!e)return"";let s=e.trim();return s=s.replace(/^[-•]\s*/,""),s=s.replace(/\*\*(.*?)\*\*/g,"$1"),s=s.replace(/\*(.*?)\*/g,"$1"),s=s.replace(/_(.*?)_/g,"$1"),s=s.replace(/`(.*?)`/g,"$1"),s}const x=()=>{const{testId:x}=e(),h=s(),{toast:g}=n(),[j,p]=t.useState(""),[v,f]=t.useState([]),[N,b]=t.useState(0),[w,k]=t.useState([]),[y,_]=t.useState(!1),[C,S]=t.useState(0),[q,$]=t.useState(!1),[B,z]=t.useState(!0);t.useEffect(()=>{(async()=>{if(!x)return;const{data:e,error:s}=await d.from("skill_tests").select("title").eq("id",x).maybeSingle();if(s)return void g({title:"Error loading test",description:s.message,variant:"destructive"});if(!e)return g({title:"Test not found",variant:"destructive"}),void h("/skills/sentence-structure-scramble");p(e.title);const{data:t,error:r}=await d.from("skill_practice_questions").select("id,content,question_format,correct_answer,incorrect_answers,explanation,original_sentence").eq("skill_test_id",x);if(r)return void g({title:"Error loading questions",description:r.message,variant:"destructive"});const n=m(t??[]);f(n),z(!1)})()},[x,g,h]);const L=v[N],E=t.useMemo(()=>{if(!L)return[];return m([L.correct_answer,...L.incorrect_answers||[]].filter(Boolean).map(e=>e.toLowerCase()))},[L]),P=v.length?(N+1)/v.length*100:0,Q=()=>{if(!L)return!1;const e=[L.correct_answer,...L.incorrect_answers||[]].map(e=>e.toLowerCase());return w.length===e.length&&w.every((s,t)=>s===e[t])};return B?r.jsx(a,{title:"Loading...",showBackButton:!0,backPath:"/skills/sentence-structure-scramble",children:r.jsx("div",{className:"flex justify-center items-center min-h-[50vh]",children:r.jsx("p",{className:"text-muted-foreground",children:"Loading quiz..."})})}):r.jsx(a,{title:j,showBackButton:!0,backPath:"/skills/sentence-structure-scramble",children:r.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[r.jsx(i,{value:P}),y?r.jsx(c,{children:r.jsxs(l,{className:"p-6 text-center space-y-4",children:[r.jsx("div",{className:"text-2xl font-semibold",children:"Quiz Complete!"}),r.jsxs("div",{className:"text-lg",children:["Your Score: ",r.jsxs("span",{className:"font-bold text-primary",children:[C," / ",v.length]})]}),r.jsx("div",{className:"text-muted-foreground",children:C===v.length?"Perfect! You got every question right!":C>=.8*v.length?"Great job! You did really well!":C>=.6*v.length?"Good effort! Keep practicing!":"Keep practicing to improve your sentence structure skills!"}),r.jsxs("div",{className:"flex gap-3 justify-center",children:[r.jsx(o,{onClick:()=>{b(0),S(0),k([]),$(!1),_(!1),f(m(v))},children:"Try Again"}),r.jsx(o,{variant:"outline",onClick:()=>h("/skills/sentence-structure-scramble"),children:"Back to Tests"})]})]})}):L?r.jsx(c,{className:"border-light-border",children:r.jsxs(l,{className:"p-6 space-y-6",children:[r.jsxs("div",{className:"text-sm text-muted-foreground",children:["Question ",N+1," of ",v.length]}),L.original_sentence&&r.jsxs("div",{className:"bg-muted/50 p-4 rounded-md",children:[r.jsx("div",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Original sentence:"}),r.jsx("div",{className:"text-sm",children:L.original_sentence})]}),r.jsx("div",{className:"text-xl font-medium",children:L.content||"Unscramble the sentence:"}),r.jsxs("div",{className:"space-y-3",children:[r.jsx("div",{className:"text-sm font-medium",children:"Available chunks:"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:E.map((e,s)=>r.jsx(o,{variant:"outline",size:"sm",className:""+(w.includes(e)?"opacity-50":""),onClick:()=>(e=>{q||w.includes(e)||k([...w,e])})(e),disabled:q,children:e},`${e}-${s}`))})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsx("div",{className:"text-sm font-medium",children:"Your sentence:"}),r.jsx("div",{className:"min-h-[4rem] p-4 border-2 border-dashed border-border rounded-md bg-muted/20",children:0===w.length?r.jsx("div",{className:"text-sm text-muted-foreground italic",children:"Click chunks above to build your sentence"}):r.jsx("div",{className:"flex flex-wrap gap-2",children:w.map((e,s)=>r.jsx(o,{variant:"secondary",size:"sm",onClick:()=>(e=>{q||k(w.filter(s=>s!==e))})(e),disabled:q,className:q?Q()?"bg-green-100 text-green-800":"bg-red-100 text-red-800":"",children:e},`selected-${e}-${s}`))})})]}),!q&&w.length>0&&r.jsx(o,{onClick:()=>{if(!L||q)return;$(!0);const e=[L.correct_answer,...L.incorrect_answers||[]].map(e=>e.toLowerCase());w.length===e.length&&w.every((s,t)=>s===e[t])&&S(e=>e+1)},className:"w-full",children:"Check Answer"}),q&&r.jsxs("div",{className:"space-y-4",children:[r.jsx("div",{className:"text-lg font-semibold text-center "+(Q()?"text-green-600":"text-red-600"),children:Q()?"✓ Correct!":"✗ Incorrect"}),!Q()&&r.jsxs("div",{className:"bg-green-50 p-4 rounded-md",children:[r.jsx("div",{className:"text-sm font-medium text-green-800 mb-2",children:"Correct order:"}),r.jsx("div",{className:"text-green-700",children:[L.correct_answer,...L.incorrect_answers||[]].join(" ")})]}),L.explanation&&r.jsxs("div",{className:"rounded-md border p-4",children:[r.jsx("div",{className:"text-sm font-medium mb-2",children:"Explanation"}),r.jsx("p",{className:"text-sm text-muted-foreground",children:u(L.explanation)})]}),r.jsx(o,{onClick:()=>{N+1>=v.length?_(!0):(b(e=>e+1),k([]),$(!1))},className:"w-full",children:N+1>=v.length?"Finish Quiz":"Next Question"})]})]})}):r.jsx(c,{children:r.jsx(l,{className:"p-6 text-center",children:r.jsx("p",{className:"text-muted-foreground",children:"No questions available for this test."})})})]})})};export{x as default};
