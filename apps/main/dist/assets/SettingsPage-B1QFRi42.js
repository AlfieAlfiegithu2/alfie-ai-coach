import{u as e,r as s,j as a}from"./vendor-react-rLLBBC7n.js";import{d as r,E as t,C as l,c as i,y as n,b as c,a as d,B as o,L as m,I as x,S as h,i as u,j,k as p,l as g,K as f,s as v,e as N}from"./index-BDl0jLJK.js";import{S as b}from"./switch-JnklLIAd.js";import{S as y}from"./separator-C0bogF69.js";import{A as w,a as k,b as C,c as S,d as F,e as _,f as B,g as D,h as E}from"./alert-dialog-C3e0CSUs.js";import{y as L,ag as P,aj as T,bh as U,b4 as A,ak as I,U as G,K as Y,G as R,bi as V,af as q}from"./vendor-ui-BGi_EvHx.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-charts-0DeywwxG.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";const K=()=>{const K=e(),{toast:z}=r(),{user:M,profile:$}=t(),[W,H]=s.useState(!0),[J,O]=s.useState(!1),[Q,X]=s.useState({status:"free",displayName:"Explorer",expiresAt:null,stripeCustomerId:null,stripeSubscriptionId:null}),[Z,ee]=s.useState({name:"",email:"",targetBand:"7.5",testDate:"",translationLanguage:"English",notifications:!0,emailUpdates:!1,reminderTime:"09:00",studyGoal:"30"});s.useEffect(()=>{(async()=>{var e;if(M)try{const{data:s}=await v.from("profiles").select("full_name, native_language, subscription_status, subscription_expires_at, stripe_customer_id").eq("id",M.id).single(),{data:a}=await v.from("user_preferences").select("*").eq("user_id",M.id).single(),r=(null==s?void 0:s.subscription_status)||"free";let t="Explorer";"premium"===r||"pro"===r?t="Pro":"ultra"===r&&(t="Ultra"),X({status:r,displayName:t,expiresAt:(null==s?void 0:s.subscription_expires_at)||null,stripeCustomerId:(null==s?void 0:s.stripe_customer_id)||null,stripeSubscriptionId:null}),ee({name:(null==s?void 0:s.full_name)||M.email||"",email:M.email||"",targetBand:(null==(e=null==a?void 0:a.target_score)?void 0:e.toString())||"7.5",testDate:(null==a?void 0:a.target_deadline)||"",translationLanguage:(null==s?void 0:s.native_language)||"English",notifications:!0,emailUpdates:!1,reminderTime:"09:00",studyGoal:"30"})}catch(s){console.error("Error loading settings:",s)}finally{H(!1)}else H(!1)})()},[M]);const se="premium"===Q.status||"pro"===Q.status||"ultra"===Q.status;return W?a.jsx("div",{className:"min-h-screen flex items-center justify-center",children:a.jsx(l,{className:"p-8 text-center",children:a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsx(L,{className:"w-5 h-5 animate-spin"}),a.jsx(i,{className:"text-2xl",children:"Loading Settings..."})]})})}):a.jsx(n,{title:"Settings",showBackButton:!0,children:a.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[a.jsxs(l,{className:"card-modern border-2 border-[#d97757]/20 bg-gradient-to-br from-white to-[#faf8f6]",children:[a.jsx(c,{children:a.jsxs(i,{className:"flex items-center gap-2",children:[a.jsx(P,{className:"w-5 h-5 text-[#d97757]"}),"Subscription & Billing"]})}),a.jsxs(d,{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between p-5 bg-white rounded-xl border border-[#e6e0d4] shadow-sm",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("span",{className:"text-xl font-bold text-[#2d2d2d]",children:[Q.displayName," Plan"]}),(()=>{const{status:e,displayName:s}=Q;return"ultra"===e?a.jsxs(N,{className:"bg-gradient-to-r from-amber-500 to-yellow-400 text-white border-0 shadow-lg",children:[a.jsx(U,{className:"w-3 h-3 mr-1"}),s]}):"premium"===e||"pro"===e?a.jsxs(N,{className:"bg-gradient-to-r from-[#d97757] to-[#e8956f] text-white border-0",children:[a.jsx(I,{className:"w-3 h-3 mr-1"}),s]}):a.jsx(N,{variant:"secondary",className:"bg-gray-100 text-gray-600",children:s})})()]}),a.jsx("p",{className:"text-sm text-[#666666]",children:se?Q.expiresAt?a.jsxs(a.Fragment,{children:["Active until ",new Date(Q.expiresAt).toLocaleDateString()]}):a.jsx(a.Fragment,{children:"Your subscription is active"}):a.jsx(a.Fragment,{children:"Free forever â€¢ Limited features"})})]}),se&&a.jsx(T,{className:"w-8 h-8 text-green-500"})]}),a.jsxs("div",{className:"grid gap-3",children:[a.jsx("h4",{className:"text-sm font-semibold text-[#2d2d2d] uppercase tracking-wide",children:"Your Plan Includes:"}),se?a.jsxs("ul",{className:"grid gap-2 text-sm text-[#666666]",children:[a.jsxs("li",{className:"flex items-center gap-2",children:[a.jsx(T,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),"Unlimited AI Practice Tests"]}),a.jsxs("li",{className:"flex items-center gap-2",children:[a.jsx(T,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),"Examiner-Level Detailed Feedback"]}),a.jsxs("li",{className:"flex items-center gap-2",children:[a.jsx(T,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),"Advanced Pronunciation Coaching"]}),a.jsxs("li",{className:"flex items-center gap-2",children:[a.jsx(T,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),"Personalized Study Roadmap"]}),"ultra"===Q.status&&a.jsxs(a.Fragment,{children:[a.jsxs("li",{className:"flex items-center gap-2",children:[a.jsx(U,{className:"w-4 h-4 text-amber-500 flex-shrink-0"}),"1-on-1 Personal Meeting with Developers"]}),a.jsxs("li",{className:"flex items-center gap-2",children:[a.jsx(U,{className:"w-4 h-4 text-amber-500 flex-shrink-0"}),"Direct Access to New Beta Features"]})]})]}):a.jsxs("ul",{className:"grid gap-2 text-sm text-[#666666]",children:[a.jsxs("li",{className:"flex items-center gap-2",children:[a.jsx(T,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),"Access to 1 Full Practice Test"]}),a.jsxs("li",{className:"flex items-center gap-2",children:[a.jsx(T,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),"Basic AI Scoring & Feedback"]}),a.jsxs("li",{className:"flex items-center gap-2",children:[a.jsx(T,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),"Limited Vocabulary Builder"]}),a.jsxs("li",{className:"flex items-center gap-2 text-[#999999]",children:[a.jsx(A,{className:"w-4 h-4 flex-shrink-0"}),"Upgrade for unlimited tests & advanced feedback"]})]})]}),a.jsx("div",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:se?a.jsxs(a.Fragment,{children:["ultra"!==Q.status&&a.jsxs(o,{onClick:()=>K("/pay?plan=ultra"),className:"flex-1 bg-gradient-to-r from-amber-500 to-yellow-400 hover:from-amber-600 hover:to-yellow-500 text-white",children:[a.jsx(U,{className:"w-4 h-4 mr-2"}),"Upgrade to Ultra"]}),a.jsxs(w,{children:[a.jsx(k,{asChild:!0,children:a.jsx(o,{variant:"outline",className:"flex-1 border-red-200 text-red-600 hover:bg-red-50 hover:text-red-700",children:"Cancel Subscription"})}),a.jsxs(C,{children:[a.jsxs(S,{children:[a.jsx(F,{children:"Cancel Your Subscription?"}),a.jsxs(_,{className:"space-y-2",children:[a.jsxs("p",{children:["Are you sure you want to cancel your ",Q.displayName," subscription?"]}),a.jsx("p",{children:"You'll lose access to:"}),a.jsxs("ul",{className:"list-disc list-inside text-sm space-y-1 mt-2",children:[a.jsx("li",{children:"Unlimited AI Practice Tests"}),a.jsx("li",{children:"Examiner-Level Detailed Feedback"}),a.jsx("li",{children:"Advanced Pronunciation Coaching"}),a.jsx("li",{children:"Personalized Study Roadmap"})]}),a.jsx("p",{className:"mt-3 text-sm",children:"Your access will continue until the end of your current billing period."})]})]}),a.jsxs(B,{children:[a.jsx(D,{children:"Keep My Subscription"}),a.jsx(E,{onClick:async()=>{O(!0);try{const{data:e,error:s}=await v.functions.invoke("cancel-subscription",{body:{userId:null==M?void 0:M.id}});if(s)throw s;z({title:"Subscription Cancelled",description:"Your subscription has been cancelled. You'll retain access until the end of your billing period."}),X(e=>({...e,status:"free",displayName:"Explorer"}))}catch(e){console.error("Error cancelling subscription:",e),z({title:"Cancellation Failed",description:e.message||"Please contact support at hello@englishaidol.com",variant:"destructive"})}finally{O(!1)}},className:"bg-red-600 hover:bg-red-700",disabled:J,children:J?a.jsxs(a.Fragment,{children:[a.jsx(L,{className:"w-4 h-4 mr-2 animate-spin"}),"Cancelling..."]}):"Yes, Cancel"})]})]})]})]}):a.jsxs(a.Fragment,{children:[a.jsxs(o,{onClick:()=>K("/pay?plan=premium"),className:"flex-1 bg-[#d97757] hover:bg-[#c56a4b] text-white",children:[a.jsx(I,{className:"w-4 h-4 mr-2"}),"Upgrade to Pro - $49/mo"]}),a.jsxs(o,{onClick:()=>K("/pay?plan=ultra"),variant:"outline",className:"flex-1 border-amber-300 text-amber-600 hover:bg-amber-50",children:[a.jsx(U,{className:"w-4 h-4 mr-2"}),"Go Ultra - $199/mo"]})]})})]})]}),a.jsxs(l,{className:"card-modern",children:[a.jsx(c,{children:a.jsxs(i,{className:"flex items-center gap-2",children:[a.jsx(G,{className:"w-5 h-5 text-brand-blue"}),"Profile Information"]})}),a.jsx(d,{className:"space-y-4",children:a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx(m,{htmlFor:"name",children:"Full Name"}),a.jsx(x,{id:"name",value:Z.name,onChange:e=>ee({...Z,name:e.target.value}),className:"input-modern"})]}),a.jsxs("div",{children:[a.jsx(m,{htmlFor:"email",children:"Email Address"}),a.jsx(x,{id:"email",type:"email",value:Z.email,disabled:!0,className:"input-modern bg-gray-50"})]})]})})]}),a.jsxs(l,{className:"card-modern",children:[a.jsx(c,{children:a.jsxs(i,{className:"flex items-center gap-2",children:[a.jsx(Y,{className:"w-5 h-5 text-brand-green"}),"Study Goals"]})}),a.jsxs(d,{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx(m,{htmlFor:"targetBand",children:"Target IELTS Band"}),a.jsxs(h,{value:Z.targetBand,onValueChange:e=>ee({...Z,targetBand:e}),children:[a.jsx(u,{className:"glass-button",children:a.jsx(j,{})}),a.jsxs(p,{children:[a.jsx(g,{value:"6.0",children:"Band 6.0"}),a.jsx(g,{value:"6.5",children:"Band 6.5"}),a.jsx(g,{value:"7.0",children:"Band 7.0"}),a.jsx(g,{value:"7.5",children:"Band 7.5"}),a.jsx(g,{value:"8.0",children:"Band 8.0"}),a.jsx(g,{value:"8.5",children:"Band 8.5"}),a.jsx(g,{value:"9.0",children:"Band 9.0"})]})]})]}),a.jsxs("div",{children:[a.jsx(m,{htmlFor:"testDate",children:"Target Test Date"}),a.jsx(x,{id:"testDate",type:"date",value:Z.testDate,onChange:e=>ee({...Z,testDate:e.target.value}),className:"input-modern"})]})]}),a.jsxs("div",{children:[a.jsx(m,{htmlFor:"studyGoal",children:"Daily Study Goal (minutes)"}),a.jsxs(h,{value:Z.studyGoal,onValueChange:e=>ee({...Z,studyGoal:e}),children:[a.jsx(u,{className:"glass-button",children:a.jsx(j,{})}),a.jsxs(p,{children:[a.jsx(g,{value:"15",children:"15 minutes"}),a.jsx(g,{value:"30",children:"30 minutes"}),a.jsx(g,{value:"45",children:"45 minutes"}),a.jsx(g,{value:"60",children:"1 hour"}),a.jsx(g,{value:"90",children:"1.5 hours"}),a.jsx(g,{value:"120",children:"2 hours"})]})]})]})]})]}),a.jsxs(l,{className:"card-modern",children:[a.jsx(c,{children:a.jsxs(i,{className:"flex items-center gap-2",children:[a.jsx(R,{className:"w-5 h-5 text-brand-purple"}),"Language & Translation"]})}),a.jsx(d,{className:"space-y-4",children:a.jsxs("div",{children:[a.jsx(m,{htmlFor:"translationLanguage",children:"Translation Language"}),a.jsxs(h,{value:Z.translationLanguage,onValueChange:e=>ee({...Z,translationLanguage:e}),children:[a.jsx(u,{className:"glass-button",children:a.jsx(j,{})}),a.jsx(p,{children:f().map(e=>a.jsx(g,{value:e.value,children:e.label},e.value))})]}),a.jsx("p",{className:"text-sm text-text-secondary mt-1",children:"Choose your preferred language for word translations during reading practice"})]})})]}),a.jsxs(l,{className:"card-modern",children:[a.jsx(c,{children:a.jsxs(i,{className:"flex items-center gap-2",children:[a.jsx(V,{className:"w-5 h-5 text-brand-orange"}),"Notifications & Reminders"]})}),a.jsxs(d,{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx(m,{htmlFor:"notifications",children:"Push Notifications"}),a.jsx("p",{className:"text-sm text-text-secondary",children:"Receive study reminders and progress updates"})]}),a.jsx(b,{id:"notifications",checked:Z.notifications,onCheckedChange:e=>ee({...Z,notifications:e})})]}),a.jsx(y,{}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx(m,{htmlFor:"emailUpdates",children:"Email Updates"}),a.jsx("p",{className:"text-sm text-text-secondary",children:"Weekly progress reports and study tips"})]}),a.jsx(b,{id:"emailUpdates",checked:Z.emailUpdates,onCheckedChange:e=>ee({...Z,emailUpdates:e})})]}),a.jsxs("div",{children:[a.jsx(m,{htmlFor:"reminderTime",children:"Daily Reminder Time"}),a.jsx(x,{id:"reminderTime",type:"time",value:Z.reminderTime,onChange:e=>ee({...Z,reminderTime:e.target.value}),className:"input-modern"})]})]})]}),a.jsx("div",{className:"flex justify-end",children:a.jsxs(o,{onClick:async()=>{if(M)try{await v.from("profiles").update({full_name:Z.name,native_language:Z.translationLanguage}).eq("id",M.id),await v.from("user_preferences").upsert({user_id:M.id,target_score:parseFloat(Z.targetBand),target_deadline:Z.testDate||null,preferred_name:Z.name}),z({title:"Settings Saved",description:"Your preferences have been updated successfully."})}catch(e){console.error("Error saving settings:",e),z({title:"Error",description:"Failed to save settings. Please try again.",variant:"destructive"})}},className:"btn-primary bg-[#d97757] hover:bg-[#c56a4b]",children:[a.jsx(q,{className:"w-4 h-4 mr-2"}),"Save Settings"]})})]})})};export{K as default};
