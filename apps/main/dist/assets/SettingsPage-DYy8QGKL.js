import{a4 as e,u as s,g as a,z as l,r,j as t,C as i,a9 as n,c,Z as d,b as o,aa as m,a as x,ab as h,ac as u,B as j,ad as g,F as p,ae as f,I as N,Q as v,S as b,o as y,p as w,q as k,s as C,G as S,af as F,K as _,k as B}from"./index-HK7c_X_B.js";import{S as D}from"./switch-B4hNvGFy.js";import{S as L}from"./separator-LRwjCfte.js";import{s as P}from"./supabase-DWL4C3fA.js";import{A as T,a as A,b as E,c as U,d as I,e as G,f as Y,g as q,h as M}from"./alert-dialog-BgmCmGIL.js";import{C as R}from"./circle-alert-VravIU0u.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=e("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),z=()=>{const e=s(),{toast:z}=a(),{user:H,profile:K}=l(),[W,$]=r.useState(!0),[Q,Z]=r.useState(!1),[J,O]=r.useState({status:"free",displayName:"Explorer",expiresAt:null,stripeCustomerId:null,stripeSubscriptionId:null}),[X,ee]=r.useState({name:"",email:"",targetBand:"7.5",testDate:"",translationLanguage:"English",notifications:!0,emailUpdates:!1,reminderTime:"09:00",studyGoal:"30"});r.useEffect(()=>{(async()=>{var e;if(H)try{const{data:s}=await P.from("profiles").select("full_name, native_language, subscription_status, subscription_expires_at, stripe_customer_id").eq("id",H.id).single(),{data:a}=await P.from("user_preferences").select("*").eq("user_id",H.id).single(),l=(null==s?void 0:s.subscription_status)||"free";let r="Explorer";"premium"===l||"pro"===l?r="Pro":"ultra"===l&&(r="Ultra"),O({status:l,displayName:r,expiresAt:(null==s?void 0:s.subscription_expires_at)||null,stripeCustomerId:(null==s?void 0:s.stripe_customer_id)||null,stripeSubscriptionId:null}),ee({name:(null==s?void 0:s.full_name)||H.email||"",email:H.email||"",targetBand:(null==(e=null==a?void 0:a.target_score)?void 0:e.toString())||"7.5",testDate:(null==a?void 0:a.target_deadline)||"",translationLanguage:(null==s?void 0:s.native_language)||"English",notifications:!0,emailUpdates:!1,reminderTime:"09:00",studyGoal:"30"})}catch(s){console.error("Error loading settings:",s)}finally{$(!1)}else $(!1)})()},[H]);const se="premium"===J.status||"pro"===J.status||"ultra"===J.status;return W?t.jsx("div",{className:"min-h-screen flex items-center justify-center",children:t.jsx(i,{className:"p-8 text-center",children:t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.jsx(n,{className:"w-5 h-5 animate-spin"}),t.jsx(c,{className:"text-2xl",children:"Loading Settings..."})]})})}):t.jsx(d,{title:"Settings",showBackButton:!0,children:t.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[t.jsxs(i,{className:"card-modern border-2 border-[#d97757]/20 bg-gradient-to-br from-white to-[#faf8f6]",children:[t.jsx(o,{children:t.jsxs(c,{className:"flex items-center gap-2",children:[t.jsx(m,{className:"w-5 h-5 text-[#d97757]"}),"Subscription & Billing"]})}),t.jsxs(x,{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between p-5 bg-white rounded-xl border border-[#e6e0d4] shadow-sm",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("span",{className:"text-xl font-bold text-[#2d2d2d]",children:[J.displayName," Plan"]}),(()=>{const{status:e,displayName:s}=J;return"ultra"===e?t.jsxs(B,{className:"bg-gradient-to-r from-amber-500 to-yellow-400 text-white border-0 shadow-lg",children:[t.jsx(u,{className:"w-3 h-3 mr-1"}),s]}):"premium"===e||"pro"===e?t.jsxs(B,{className:"bg-gradient-to-r from-[#d97757] to-[#e8956f] text-white border-0",children:[t.jsx(g,{className:"w-3 h-3 mr-1"}),s]}):t.jsx(B,{variant:"secondary",className:"bg-gray-100 text-gray-600",children:s})})()]}),t.jsx("p",{className:"text-sm text-[#666666]",children:se?J.expiresAt?t.jsxs(t.Fragment,{children:["Active until ",new Date(J.expiresAt).toLocaleDateString()]}):t.jsx(t.Fragment,{children:"Your subscription is active"}):t.jsx(t.Fragment,{children:"Free forever â€¢ Limited features"})})]}),se&&t.jsx(h,{className:"w-8 h-8 text-green-500"})]}),t.jsxs("div",{className:"grid gap-3",children:[t.jsx("h4",{className:"text-sm font-semibold text-[#2d2d2d] uppercase tracking-wide",children:"Your Plan Includes:"}),se?t.jsxs("ul",{className:"grid gap-2 text-sm text-[#666666]",children:[t.jsxs("li",{className:"flex items-center gap-2",children:[t.jsx(h,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),"Unlimited AI Practice Tests"]}),t.jsxs("li",{className:"flex items-center gap-2",children:[t.jsx(h,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),"Examiner-Level Detailed Feedback"]}),t.jsxs("li",{className:"flex items-center gap-2",children:[t.jsx(h,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),"Advanced Pronunciation Coaching"]}),t.jsxs("li",{className:"flex items-center gap-2",children:[t.jsx(h,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),"Personalized Study Roadmap"]}),"ultra"===J.status&&t.jsxs(t.Fragment,{children:[t.jsxs("li",{className:"flex items-center gap-2",children:[t.jsx(u,{className:"w-4 h-4 text-amber-500 flex-shrink-0"}),"1-on-1 Personal Meeting with Developers"]}),t.jsxs("li",{className:"flex items-center gap-2",children:[t.jsx(u,{className:"w-4 h-4 text-amber-500 flex-shrink-0"}),"Direct Access to New Beta Features"]})]})]}):t.jsxs("ul",{className:"grid gap-2 text-sm text-[#666666]",children:[t.jsxs("li",{className:"flex items-center gap-2",children:[t.jsx(h,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),"Access to 1 Full Practice Test"]}),t.jsxs("li",{className:"flex items-center gap-2",children:[t.jsx(h,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),"Basic AI Scoring & Feedback"]}),t.jsxs("li",{className:"flex items-center gap-2",children:[t.jsx(h,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),"Limited Vocabulary Builder"]}),t.jsxs("li",{className:"flex items-center gap-2 text-[#999999]",children:[t.jsx(R,{className:"w-4 h-4 flex-shrink-0"}),"Upgrade for unlimited tests & advanced feedback"]})]})]}),t.jsx("div",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:se?t.jsxs(t.Fragment,{children:["ultra"!==J.status&&t.jsxs(j,{onClick:()=>e("/pay?plan=ultra"),className:"flex-1 bg-gradient-to-r from-amber-500 to-yellow-400 hover:from-amber-600 hover:to-yellow-500 text-white",children:[t.jsx(u,{className:"w-4 h-4 mr-2"}),"Upgrade to Ultra"]}),t.jsxs(T,{children:[t.jsx(A,{asChild:!0,children:t.jsx(j,{variant:"outline",className:"flex-1 border-red-200 text-red-600 hover:bg-red-50 hover:text-red-700",children:"Cancel Subscription"})}),t.jsxs(E,{children:[t.jsxs(U,{children:[t.jsx(I,{children:"Cancel Your Subscription?"}),t.jsxs(G,{className:"space-y-2",children:[t.jsxs("p",{children:["Are you sure you want to cancel your ",J.displayName," subscription?"]}),t.jsx("p",{children:"You'll lose access to:"}),t.jsxs("ul",{className:"list-disc list-inside text-sm space-y-1 mt-2",children:[t.jsx("li",{children:"Unlimited AI Practice Tests"}),t.jsx("li",{children:"Examiner-Level Detailed Feedback"}),t.jsx("li",{children:"Advanced Pronunciation Coaching"}),t.jsx("li",{children:"Personalized Study Roadmap"})]}),t.jsx("p",{className:"mt-3 text-sm",children:"Your access will continue until the end of your current billing period."})]})]}),t.jsxs(Y,{children:[t.jsx(q,{children:"Keep My Subscription"}),t.jsx(M,{onClick:async()=>{Z(!0);try{const{data:e,error:s}=await P.functions.invoke("cancel-subscription",{body:{userId:null==H?void 0:H.id}});if(s)throw s;z({title:"Subscription Cancelled",description:"Your subscription has been cancelled. You'll retain access until the end of your billing period."}),O(e=>({...e,status:"free",displayName:"Explorer"}))}catch(e){console.error("Error cancelling subscription:",e),z({title:"Cancellation Failed",description:e.message||"Please contact support at hello@englishaidol.com",variant:"destructive"})}finally{Z(!1)}},className:"bg-red-600 hover:bg-red-700",disabled:Q,children:Q?t.jsxs(t.Fragment,{children:[t.jsx(n,{className:"w-4 h-4 mr-2 animate-spin"}),"Cancelling..."]}):"Yes, Cancel"})]})]})]})]}):t.jsxs(t.Fragment,{children:[t.jsxs(j,{onClick:()=>e("/pay?plan=premium"),className:"flex-1 bg-[#d97757] hover:bg-[#c56a4b] text-white",children:[t.jsx(g,{className:"w-4 h-4 mr-2"}),"Upgrade to Pro - $49/mo"]}),t.jsxs(j,{onClick:()=>e("/pay?plan=ultra"),variant:"outline",className:"flex-1 border-amber-300 text-amber-600 hover:bg-amber-50",children:[t.jsx(u,{className:"w-4 h-4 mr-2"}),"Go Ultra - $199/mo"]})]})})]})]}),t.jsxs(i,{className:"card-modern",children:[t.jsx(o,{children:t.jsxs(c,{className:"flex items-center gap-2",children:[t.jsx(p,{className:"w-5 h-5 text-brand-blue"}),"Profile Information"]})}),t.jsx(x,{className:"space-y-4",children:t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx(f,{htmlFor:"name",children:"Full Name"}),t.jsx(N,{id:"name",value:X.name,onChange:e=>ee({...X,name:e.target.value}),className:"input-modern"})]}),t.jsxs("div",{children:[t.jsx(f,{htmlFor:"email",children:"Email Address"}),t.jsx(N,{id:"email",type:"email",value:X.email,disabled:!0,className:"input-modern bg-gray-50"})]})]})})]}),t.jsxs(i,{className:"card-modern",children:[t.jsx(o,{children:t.jsxs(c,{className:"flex items-center gap-2",children:[t.jsx(v,{className:"w-5 h-5 text-brand-green"}),"Study Goals"]})}),t.jsxs(x,{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx(f,{htmlFor:"targetBand",children:"Target IELTS Band"}),t.jsxs(b,{value:X.targetBand,onValueChange:e=>ee({...X,targetBand:e}),children:[t.jsx(y,{className:"glass-button",children:t.jsx(w,{})}),t.jsxs(k,{children:[t.jsx(C,{value:"6.0",children:"Band 6.0"}),t.jsx(C,{value:"6.5",children:"Band 6.5"}),t.jsx(C,{value:"7.0",children:"Band 7.0"}),t.jsx(C,{value:"7.5",children:"Band 7.5"}),t.jsx(C,{value:"8.0",children:"Band 8.0"}),t.jsx(C,{value:"8.5",children:"Band 8.5"}),t.jsx(C,{value:"9.0",children:"Band 9.0"})]})]})]}),t.jsxs("div",{children:[t.jsx(f,{htmlFor:"testDate",children:"Target Test Date"}),t.jsx(N,{id:"testDate",type:"date",value:X.testDate,onChange:e=>ee({...X,testDate:e.target.value}),className:"input-modern"})]})]}),t.jsxs("div",{children:[t.jsx(f,{htmlFor:"studyGoal",children:"Daily Study Goal (minutes)"}),t.jsxs(b,{value:X.studyGoal,onValueChange:e=>ee({...X,studyGoal:e}),children:[t.jsx(y,{className:"glass-button",children:t.jsx(w,{})}),t.jsxs(k,{children:[t.jsx(C,{value:"15",children:"15 minutes"}),t.jsx(C,{value:"30",children:"30 minutes"}),t.jsx(C,{value:"45",children:"45 minutes"}),t.jsx(C,{value:"60",children:"1 hour"}),t.jsx(C,{value:"90",children:"1.5 hours"}),t.jsx(C,{value:"120",children:"2 hours"})]})]})]})]})]}),t.jsxs(i,{className:"card-modern",children:[t.jsx(o,{children:t.jsxs(c,{className:"flex items-center gap-2",children:[t.jsx(S,{className:"w-5 h-5 text-brand-purple"}),"Language & Translation"]})}),t.jsx(x,{className:"space-y-4",children:t.jsxs("div",{children:[t.jsx(f,{htmlFor:"translationLanguage",children:"Translation Language"}),t.jsxs(b,{value:X.translationLanguage,onValueChange:e=>ee({...X,translationLanguage:e}),children:[t.jsx(y,{className:"glass-button",children:t.jsx(w,{})}),t.jsx(k,{children:F().map(e=>t.jsx(C,{value:e.value,children:e.label},e.value))})]}),t.jsx("p",{className:"text-sm text-text-secondary mt-1",children:"Choose your preferred language for word translations during reading practice"})]})})]}),t.jsxs(i,{className:"card-modern",children:[t.jsx(o,{children:t.jsxs(c,{className:"flex items-center gap-2",children:[t.jsx(V,{className:"w-5 h-5 text-brand-orange"}),"Notifications & Reminders"]})}),t.jsxs(x,{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx(f,{htmlFor:"notifications",children:"Push Notifications"}),t.jsx("p",{className:"text-sm text-text-secondary",children:"Receive study reminders and progress updates"})]}),t.jsx(D,{id:"notifications",checked:X.notifications,onCheckedChange:e=>ee({...X,notifications:e})})]}),t.jsx(L,{}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx(f,{htmlFor:"emailUpdates",children:"Email Updates"}),t.jsx("p",{className:"text-sm text-text-secondary",children:"Weekly progress reports and study tips"})]}),t.jsx(D,{id:"emailUpdates",checked:X.emailUpdates,onCheckedChange:e=>ee({...X,emailUpdates:e})})]}),t.jsxs("div",{children:[t.jsx(f,{htmlFor:"reminderTime",children:"Daily Reminder Time"}),t.jsx(N,{id:"reminderTime",type:"time",value:X.reminderTime,onChange:e=>ee({...X,reminderTime:e.target.value}),className:"input-modern"})]})]})]}),t.jsx("div",{className:"flex justify-end",children:t.jsxs(j,{onClick:async()=>{if(H)try{await P.from("profiles").update({full_name:X.name,native_language:X.translationLanguage}).eq("id",H.id),await P.from("user_preferences").upsert({user_id:H.id,target_score:parseFloat(X.targetBand),target_deadline:X.testDate||null,preferred_name:X.name}),z({title:"Settings Saved",description:"Your preferences have been updated successfully."})}catch(e){console.error("Error saving settings:",e),z({title:"Error",description:"Failed to save settings. Please try again.",variant:"destructive"})}},className:"btn-primary bg-[#d97757] hover:bg-[#c56a4b]",children:[t.jsx(_,{className:"w-4 h-4 mr-2"}),"Save Settings"]})})]})})};export{z as default};
