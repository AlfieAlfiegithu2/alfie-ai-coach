import{u as e,r as s,j as t,N as a,L as r}from"./vendor-react-rLLBBC7n.js";import{E as o,s as n,J as l}from"./index-KxDfHqNJ.js";import{az as d,U as i,co as c,aA as u,aj as m,cl as f,aM as x,aN as h}from"./vendor-ui-BGi_EvHx.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-charts-0DeywwxG.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";const b=()=>{const{user:b,loading:p}=o(),v=e(),[g,j]=s.useState(""),[w,N]=s.useState(""),[y,k]=s.useState(""),[C,P]=s.useState(""),[S,_]=s.useState(["","","","","",""]),[D,E]=s.useState(!1),[A,F]=s.useState(!1),[T,q]=s.useState(!1),[R,$]=s.useState(null),[L,O]=s.useState(!1),[z,B]=s.useState(!1),[G,J]=s.useState(0),M=s.useRef([]),H=s.useRef(null);s.useEffect(()=>{if(G>0){const e=setTimeout(()=>J(e=>e-1),1e3);return()=>clearTimeout(e)}},[G]);const I=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),K=6===S.join("").length,U=async()=>{if(w&&I(w)){F(!0),$(null);try{const{data:e,error:s}=await n.functions.invoke("send-signup-otp",{body:{email:w}});if(s)throw s;if(null==e?void 0:e.error)throw new Error(e.error);if(J(60),null==e?void 0:e._dev_otp){const s=e._dev_otp.split("");_(s),l.success("New code generated! (Dev mode)"),console.log("üîê Dev OTP:",e._dev_otp)}else _(["","","","","",""]),l.success("New verification code sent");setTimeout(()=>{var e;return null==(e=M.current[0])?void 0:e.focus()},100)}catch(e){$(e.message||"Failed to resend code")}finally{F(!1)}}};return p?t.jsx("div",{className:"min-h-screen w-full font-sans flex flex-col items-center justify-center bg-[#f5f2e8]",children:t.jsxs("div",{className:"flex flex-col items-center justify-center gap-4",children:[t.jsx("div",{className:"relative w-20 h-20",children:t.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-[#e6e0d4] border-t-[#d97757] animate-spin"})}),t.jsx("div",{className:"text-xl font-serif font-medium text-[#2d2d2d]",children:"Loading‚Ä¶"})]})}):!p&&b?t.jsx(a,{to:"/dashboard",replace:!0}):t.jsx("div",{className:"min-h-screen w-full font-sans bg-[#f5f2e8] text-[#3c3c3c]",children:t.jsx("div",{className:"relative z-10 w-full min-h-screen flex flex-col items-center justify-center px-4 py-10",children:t.jsxs("div",{className:"w-full max-w-md",children:[t.jsxs("button",{type:"button",onClick:()=>v("/"),className:"mb-6 inline-flex items-center gap-2 text-sm text-[#666666] hover:text-[#d97757] font-medium transition-colors px-2 py-1 rounded-lg hover:bg-[#d97757]/5","aria-label":"Go back",children:[t.jsx(d,{className:"w-4 h-4"}),"Back to Home"]}),t.jsx("div",{className:"w-full rounded-2xl overflow-hidden shadow-sm bg-white border-2 border-[#d97757]/20",children:t.jsxs("div",{className:"p-8 md:p-10 bg-white",children:[t.jsx("h3",{className:"text-2xl font-serif font-medium text-[#d97757] text-center mb-2",children:"Create Account"}),t.jsx("p",{className:"text-center text-[#666666] text-sm mb-8 font-sans",children:"Start your English mastery journey today"}),t.jsxs("form",{onSubmit:async e=>{var s;if(e.preventDefault(),$(null),!D)return void $("Please get a verification code first");if(!K)return void $("Please enter the complete 6-digit verification code");if(!g)return void $("Please enter your nickname");if(!y)return $("Please set a password"),void(null==(s=H.current)||s.focus());if(y.length<6)return void $("Password must be at least 6 characters");if(y!==C)return void $("Passwords do not match");const t=S.join("");q(!0);try{const{data:e,error:s}=await n.functions.invoke("verify-signup-otp",{body:{email:w,otp:t,password:y,fullName:g}});if(s)throw s;if(null==e?void 0:e.error)throw new Error(e.error);const{error:a}=await n.auth.signInWithPassword({email:w,password:y});if(a)return l.success("Account created! Please sign in."),void v("/auth");l.success("Account created successfully!"),v("/dashboard")}catch(a){$(a.message||"Failed to create account")}finally{q(!1)}},className:"space-y-5",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-[#3c3c3c] mb-2 font-sans",children:"Nickname"}),t.jsxs("div",{className:"relative",children:[t.jsx(i,{className:"absolute left-3 top-3.5 h-5 w-5 text-[#d97757]/50"}),t.jsx("input",{type:"text",required:!0,value:g,onChange:e=>j(e.target.value),className:"w-full pl-10 p-3 rounded-xl border border-[#d97757]/20 bg-[#faf8f6] text-[#2d2d2d] shadow-sm focus:outline-none focus:ring-2 focus:ring-[#d97757]/20 focus:border-[#d97757] transition-all font-sans placeholder-[#666666]/50",placeholder:"Johnny"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-[#3c3c3c] mb-2 font-sans",children:"Email Address"}),t.jsxs("div",{className:"relative",children:[t.jsx(c,{className:"absolute left-3 top-3.5 h-5 w-5 text-[#d97757]/50"}),t.jsx("input",{type:"email",required:!0,value:w,onChange:e=>N(e.target.value),className:"w-full pl-10 pr-32 p-3 rounded-xl border border-[#d97757]/20 bg-[#faf8f6] text-[#2d2d2d] shadow-sm focus:outline-none focus:ring-2 focus:ring-[#d97757]/20 focus:border-[#d97757] transition-all font-sans placeholder-[#666666]/50",placeholder:"john@example.com"}),t.jsx("div",{className:"absolute right-1.5 top-1.5 bottom-1.5",children:t.jsx("button",{type:"button",onClick:D?U:async()=>{if($(null),w)if(I(w)){F(!0);try{const{data:e,error:s}=await n.functions.invoke("send-signup-otp",{body:{email:w}});if(s)throw s;if(null==e?void 0:e.error)throw new Error(e.error);if(E(!0),J(60),null==e?void 0:e._dev_otp){const s=e._dev_otp.split("");_(s),l.success("Code generated! (Dev mode - check console for OTP)"),console.log("üîê Dev OTP:",e._dev_otp)}else l.success("Verification code sent to your email");setTimeout(()=>{var e;return null==(e=M.current[0])?void 0:e.focus()},100)}catch(e){$(e.message||"Failed to send verification code")}finally{F(!1)}}else $("Please enter a valid email address");else $("Please enter your email address")},disabled:A||!w||!I(w)||D&&G>0,className:`h-full px-4 rounded-lg text-sm font-medium transition-all flex items-center gap-1.5 ${D?"bg-green-100 text-green-700 hover:bg-green-200":"bg-[#d97757] text-white hover:bg-[#c56a4b] shadow-sm"} disabled:opacity-50 disabled:cursor-not-allowed`,children:A?t.jsx("div",{className:"h-4 w-4 rounded-full border-2 border-current border-t-transparent animate-spin"}):D?t.jsx(t.Fragment,{children:G>0?t.jsxs(t.Fragment,{children:[t.jsx(u,{className:"w-4 h-4"}),G,"s"]}):t.jsxs(t.Fragment,{children:[t.jsx(m,{className:"w-4 h-4"}),"Sent"]})}):"Get Code"})})]}),D&&t.jsxs("div",{className:"mt-4 animate-in fade-in slide-in-from-top-2 duration-300",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("label",{className:"text-xs font-medium text-[#666666] font-sans",children:"Enter verification code sent to your email"}),t.jsx("button",{type:"button",onClick:U,disabled:A||G>0,className:"text-xs text-[#d97757] hover:underline disabled:opacity-50 disabled:hover:no-underline",children:G>0?`Resend in ${G}s`:"Resend"})]}),t.jsx("div",{className:"grid grid-cols-6 gap-2",onPaste:e=>{var s;e.preventDefault();const t=e.clipboardData.getData("text").slice(0,6).split(""),a=[...S];t.forEach((e,s)=>{s<6&&!isNaN(Number(e))&&(a[s]=e)}),_(a);const r=Math.min(t.length,5);null==(s=M.current[r])||s.focus()},children:S.map((e,s)=>t.jsx("input",{ref:e=>M.current[s]=e,type:"text",maxLength:1,value:e,onChange:e=>((e,s)=>{var t;if(isNaN(Number(s)))return;const a=[...S];a[e]=s.substring(s.length-1),_(a),s&&e<5&&(null==(t=M.current[e+1])||t.focus())})(s,e.target.value),onKeyDown:e=>((e,s)=>{var t;"Backspace"===s.key&&!S[e]&&e>0&&(null==(t=M.current[e-1])||t.focus())})(s,e),className:"w-full aspect-square text-center text-xl font-bold rounded-xl border-2 bg-white text-[#2d2d2d] shadow-sm focus:border-[#d97757] focus:ring-4 focus:ring-[#d97757]/10 focus:outline-none transition-all "+(e?"border-[#d97757] shadow-md":"border-[#d97757]/20"),placeholder:"‚Ä¢"},s))})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-[#3c3c3c] mb-2 font-sans",children:"Password"}),t.jsxs("div",{className:"relative",children:[t.jsx(f,{className:"absolute left-3 top-3.5 h-5 w-5 text-[#d97757]/50"}),t.jsx("input",{ref:H,type:L?"text":"password",required:!0,value:y,onChange:e=>k(e.target.value),className:"w-full pl-10 pr-12 p-3 rounded-xl border border-[#d97757]/20 bg-[#faf8f6] text-[#2d2d2d] shadow-sm focus:outline-none focus:ring-2 focus:ring-[#d97757]/20 focus:border-[#d97757] transition-all font-sans placeholder-[#666666]/50",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"}),t.jsx("button",{type:"button",onClick:()=>O(!L),className:"absolute right-3 top-3.5 text-[#666666] hover:text-[#d97757] transition-colors",children:L?t.jsx(x,{className:"h-5 w-5"}):t.jsx(h,{className:"h-5 w-5"})})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-[#3c3c3c] mb-2 font-sans",children:"Confirm Password"}),t.jsxs("div",{className:"relative",children:[t.jsx(f,{className:"absolute left-3 top-3.5 h-5 w-5 text-[#d97757]/50"}),t.jsx("input",{type:z?"text":"password",required:!0,value:C,onChange:e=>P(e.target.value),className:"w-full pl-10 pr-12 p-3 rounded-xl border border-[#d97757]/20 bg-[#faf8f6] text-[#2d2d2d] shadow-sm focus:outline-none focus:ring-2 focus:ring-[#d97757]/20 focus:border-[#d97757] transition-all font-sans placeholder-[#666666]/50",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"}),t.jsx("button",{type:"button",onClick:()=>B(!z),className:"absolute right-3 top-3.5 text-[#666666] hover:text-[#d97757] transition-colors",children:z?t.jsx(x,{className:"h-5 w-5"}):t.jsx(h,{className:"h-5 w-5"})})]})]}),R&&t.jsxs("div",{className:"p-3 bg-red-50 border border-red-100 rounded-lg text-sm text-red-600 flex items-start gap-2 animate-in fade-in slide-in-from-top-1",children:[t.jsx("div",{className:"mt-0.5",children:"‚ö†Ô∏è"}),t.jsx("div",{children:R})]}),t.jsx("button",{type:"submit",disabled:T||!D||!K,className:`w-full py-4 px-6 font-medium rounded-xl shadow-md transform transition-all font-sans flex items-center justify-center gap-2 ${D&&K?"bg-[#d97757] text-white hover:bg-[#c56a4b] hover:-translate-y-0.5":"bg-[#d97757]/50 text-white/80 cursor-not-allowed"} disabled:hover:transform-none`,children:T?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"h-4 w-4 rounded-full border-2 border-white/30 border-t-white animate-spin"}),"Creating Account..."]}):"Create Account"}),t.jsxs("div",{className:"text-center text-sm text-[#666666] font-sans mt-6",children:["Already have an account? ",t.jsx(r,{className:"text-[#d97757] font-medium hover:underline",to:"/auth",children:"Sign in"})]})]})]})})]})})})};export{b as default};
