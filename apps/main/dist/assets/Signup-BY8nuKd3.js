import{ae as e,u as s,r as t,j as a,aj as r,ar as n,al as o,W as l,ax as d,N as i,E as c,at as u,J as m}from"./index-eRihw1rU.js";import{s as f}from"./supabase-DWL4C3fA.js";import{M as x}from"./mail-BMUK_Nrg.js";import{L as h}from"./lock-CNiNPdep.js";const b=()=>{const{user:b,loading:p}=e(),v=s(),[g,j]=t.useState(""),[w,N]=t.useState(""),[y,k]=t.useState(""),[C,P]=t.useState(""),[S,_]=t.useState(["","","","","",""]),[D,E]=t.useState(!1),[A,F]=t.useState(!1),[T,q]=t.useState(!1),[R,$]=t.useState(null),[L,O]=t.useState(!1),[B,G]=t.useState(!1),[J,M]=t.useState(0),W=t.useRef([]),z=t.useRef(null);t.useEffect(()=>{if(J>0){const e=setTimeout(()=>M(e=>e-1),1e3);return()=>clearTimeout(e)}},[J]);const H=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),I=6===S.join("").length,K=async()=>{if(w&&H(w)){F(!0),$(null);try{const{data:e,error:s}=await f.functions.invoke("send-signup-otp",{body:{email:w}});if(s)throw s;if(null==e?void 0:e.error)throw new Error(e.error);if(M(60),null==e?void 0:e._dev_otp){const s=e._dev_otp.split("");_(s),m.success("New code generated! (Dev mode)"),console.log("üîê Dev OTP:",e._dev_otp)}else _(["","","","","",""]),m.success("New verification code sent");setTimeout(()=>{var e;return null==(e=W.current[0])?void 0:e.focus()},100)}catch(e){$(e.message||"Failed to resend code")}finally{F(!1)}}};return p?a.jsx("div",{className:"min-h-screen w-full font-sans flex flex-col items-center justify-center bg-[#f5f2e8]",children:a.jsxs("div",{className:"flex flex-col items-center justify-center gap-4",children:[a.jsx("div",{className:"relative w-20 h-20",children:a.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-[#e6e0d4] border-t-[#d97757] animate-spin"})}),a.jsx("div",{className:"text-xl font-serif font-medium text-[#2d2d2d]",children:"Loading‚Ä¶"})]})}):!p&&b?a.jsx(r,{to:"/dashboard",replace:!0}):a.jsx("div",{className:"min-h-screen w-full font-sans bg-[#f5f2e8] text-[#3c3c3c]",children:a.jsx("div",{className:"relative z-10 w-full min-h-screen flex flex-col items-center justify-center px-4 py-10",children:a.jsxs("div",{className:"w-full max-w-md",children:[a.jsxs("button",{type:"button",onClick:()=>v("/"),className:"mb-6 inline-flex items-center gap-2 text-sm text-[#666666] hover:text-[#d97757] font-medium transition-colors px-2 py-1 rounded-lg hover:bg-[#d97757]/5","aria-label":"Go back",children:[a.jsx(n,{className:"w-4 h-4"}),"Back to Home"]}),a.jsx("div",{className:"w-full rounded-2xl overflow-hidden shadow-sm bg-white border-2 border-[#d97757]/20",children:a.jsxs("div",{className:"p-8 md:p-10 bg-white",children:[a.jsx("h3",{className:"text-2xl font-serif font-medium text-[#d97757] text-center mb-2",children:"Create Account"}),a.jsx("p",{className:"text-center text-[#666666] text-sm mb-8 font-sans",children:"Start your English mastery journey today"}),a.jsxs("form",{onSubmit:async e=>{var s;if(e.preventDefault(),$(null),!D)return void $("Please get a verification code first");if(!I)return void $("Please enter the complete 6-digit verification code");if(!g)return void $("Please enter your nickname");if(!y)return $("Please set a password"),void(null==(s=z.current)||s.focus());if(y.length<6)return void $("Password must be at least 6 characters");if(y!==C)return void $("Passwords do not match");const t=S.join("");q(!0);try{const{data:e,error:s}=await f.functions.invoke("verify-signup-otp",{body:{email:w,otp:t,password:y,fullName:g}});if(s)throw s;if(null==e?void 0:e.error)throw new Error(e.error);const{error:a}=await f.auth.signInWithPassword({email:w,password:y});if(a)return m.success("Account created! Please sign in."),void v("/auth");m.success("Account created successfully!"),v("/dashboard")}catch(a){$(a.message||"Failed to create account")}finally{q(!1)}},className:"space-y-5",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-[#3c3c3c] mb-2 font-sans",children:"Nickname"}),a.jsxs("div",{className:"relative",children:[a.jsx(o,{className:"absolute left-3 top-3.5 h-5 w-5 text-[#d97757]/50"}),a.jsx("input",{type:"text",required:!0,value:g,onChange:e=>j(e.target.value),className:"w-full pl-10 p-3 rounded-xl border border-[#d97757]/20 bg-[#faf8f6] text-[#2d2d2d] shadow-sm focus:outline-none focus:ring-2 focus:ring-[#d97757]/20 focus:border-[#d97757] transition-all font-sans placeholder-[#666666]/50",placeholder:"Johnny"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-[#3c3c3c] mb-2 font-sans",children:"Email Address"}),a.jsxs("div",{className:"relative",children:[a.jsx(x,{className:"absolute left-3 top-3.5 h-5 w-5 text-[#d97757]/50"}),a.jsx("input",{type:"email",required:!0,value:w,onChange:e=>N(e.target.value),className:"w-full pl-10 pr-32 p-3 rounded-xl border border-[#d97757]/20 bg-[#faf8f6] text-[#2d2d2d] shadow-sm focus:outline-none focus:ring-2 focus:ring-[#d97757]/20 focus:border-[#d97757] transition-all font-sans placeholder-[#666666]/50",placeholder:"john@example.com"}),a.jsx("div",{className:"absolute right-1.5 top-1.5 bottom-1.5",children:a.jsx("button",{type:"button",onClick:D?K:async()=>{if($(null),w)if(H(w)){F(!0);try{const{data:e,error:s}=await f.functions.invoke("send-signup-otp",{body:{email:w}});if(s)throw s;if(null==e?void 0:e.error)throw new Error(e.error);if(E(!0),M(60),null==e?void 0:e._dev_otp){const s=e._dev_otp.split("");_(s),m.success("Code generated! (Dev mode - check console for OTP)"),console.log("üîê Dev OTP:",e._dev_otp)}else m.success("Verification code sent to your email");setTimeout(()=>{var e;return null==(e=W.current[0])?void 0:e.focus()},100)}catch(e){$(e.message||"Failed to send verification code")}finally{F(!1)}}else $("Please enter a valid email address");else $("Please enter your email address")},disabled:A||!w||!H(w)||D&&J>0,className:`h-full px-4 rounded-lg text-sm font-medium transition-all flex items-center gap-1.5 ${D?"bg-green-100 text-green-700 hover:bg-green-200":"bg-[#d97757] text-white hover:bg-[#c56a4b] shadow-sm"} disabled:opacity-50 disabled:cursor-not-allowed`,children:A?a.jsx("div",{className:"h-4 w-4 rounded-full border-2 border-current border-t-transparent animate-spin"}):D?a.jsx(a.Fragment,{children:J>0?a.jsxs(a.Fragment,{children:[a.jsx(l,{className:"w-4 h-4"}),J,"s"]}):a.jsxs(a.Fragment,{children:[a.jsx(d,{className:"w-4 h-4"}),"Sent"]})}):"Get Code"})})]}),D&&a.jsxs("div",{className:"mt-4 animate-in fade-in slide-in-from-top-2 duration-300",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("label",{className:"text-xs font-medium text-[#666666] font-sans",children:"Enter verification code sent to your email"}),a.jsx("button",{type:"button",onClick:K,disabled:A||J>0,className:"text-xs text-[#d97757] hover:underline disabled:opacity-50 disabled:hover:no-underline",children:J>0?`Resend in ${J}s`:"Resend"})]}),a.jsx("div",{className:"grid grid-cols-6 gap-2",onPaste:e=>{var s;e.preventDefault();const t=e.clipboardData.getData("text").slice(0,6).split(""),a=[...S];t.forEach((e,s)=>{s<6&&!isNaN(Number(e))&&(a[s]=e)}),_(a);const r=Math.min(t.length,5);null==(s=W.current[r])||s.focus()},children:S.map((e,s)=>a.jsx("input",{ref:e=>W.current[s]=e,type:"text",maxLength:1,value:e,onChange:e=>((e,s)=>{var t;if(isNaN(Number(s)))return;const a=[...S];a[e]=s.substring(s.length-1),_(a),s&&e<5&&(null==(t=W.current[e+1])||t.focus())})(s,e.target.value),onKeyDown:e=>((e,s)=>{var t;"Backspace"===s.key&&!S[e]&&e>0&&(null==(t=W.current[e-1])||t.focus())})(s,e),className:"w-full aspect-square text-center text-xl font-bold rounded-xl border-2 bg-white text-[#2d2d2d] shadow-sm focus:border-[#d97757] focus:ring-4 focus:ring-[#d97757]/10 focus:outline-none transition-all "+(e?"border-[#d97757] shadow-md":"border-[#d97757]/20"),placeholder:"‚Ä¢"},s))})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-[#3c3c3c] mb-2 font-sans",children:"Password"}),a.jsxs("div",{className:"relative",children:[a.jsx(h,{className:"absolute left-3 top-3.5 h-5 w-5 text-[#d97757]/50"}),a.jsx("input",{ref:z,type:L?"text":"password",required:!0,value:y,onChange:e=>k(e.target.value),className:"w-full pl-10 pr-12 p-3 rounded-xl border border-[#d97757]/20 bg-[#faf8f6] text-[#2d2d2d] shadow-sm focus:outline-none focus:ring-2 focus:ring-[#d97757]/20 focus:border-[#d97757] transition-all font-sans placeholder-[#666666]/50",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"}),a.jsx("button",{type:"button",onClick:()=>O(!L),className:"absolute right-3 top-3.5 text-[#666666] hover:text-[#d97757] transition-colors",children:L?a.jsx(i,{className:"h-5 w-5"}):a.jsx(c,{className:"h-5 w-5"})})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-[#3c3c3c] mb-2 font-sans",children:"Confirm Password"}),a.jsxs("div",{className:"relative",children:[a.jsx(h,{className:"absolute left-3 top-3.5 h-5 w-5 text-[#d97757]/50"}),a.jsx("input",{type:B?"text":"password",required:!0,value:C,onChange:e=>P(e.target.value),className:"w-full pl-10 pr-12 p-3 rounded-xl border border-[#d97757]/20 bg-[#faf8f6] text-[#2d2d2d] shadow-sm focus:outline-none focus:ring-2 focus:ring-[#d97757]/20 focus:border-[#d97757] transition-all font-sans placeholder-[#666666]/50",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"}),a.jsx("button",{type:"button",onClick:()=>G(!B),className:"absolute right-3 top-3.5 text-[#666666] hover:text-[#d97757] transition-colors",children:B?a.jsx(i,{className:"h-5 w-5"}):a.jsx(c,{className:"h-5 w-5"})})]})]}),R&&a.jsxs("div",{className:"p-3 bg-red-50 border border-red-100 rounded-lg text-sm text-red-600 flex items-start gap-2 animate-in fade-in slide-in-from-top-1",children:[a.jsx("div",{className:"mt-0.5",children:"‚ö†Ô∏è"}),a.jsx("div",{children:R})]}),a.jsx("button",{type:"submit",disabled:T||!D||!I,className:`w-full py-4 px-6 font-medium rounded-xl shadow-md transform transition-all font-sans flex items-center justify-center gap-2 ${D&&I?"bg-[#d97757] text-white hover:bg-[#c56a4b] hover:-translate-y-0.5":"bg-[#d97757]/50 text-white/80 cursor-not-allowed"} disabled:hover:transform-none`,children:T?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"h-4 w-4 rounded-full border-2 border-white/30 border-t-white animate-spin"}),"Creating Account..."]}):"Create Account"}),a.jsxs("div",{className:"text-center text-sm text-[#666666] font-sans mt-6",children:["Already have an account? ",a.jsx(u,{className:"text-[#d97757] font-medium hover:underline",to:"/auth",children:"Sign in"})]})]})]})})]})})})};export{b as default};
