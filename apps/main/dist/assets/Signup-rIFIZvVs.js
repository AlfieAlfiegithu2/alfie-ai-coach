import{A as e,u as t,r as s,j as a,N as r,_ as n,U as o,bb as l,a1 as i,E as d,a2 as c,J as u}from"./index-DxP3TaXk.js";import{s as m}from"./supabase-Bqkrifq5.js";import{M as f}from"./mail-BIjt3rIG.js";import{L as x}from"./lock-BCHh9HcR.js";const h=()=>{const{user:h,loading:b}=e(),p=t(),[v,g]=s.useState(""),[j,w]=s.useState(""),[N,y]=s.useState(""),[k,C]=s.useState(""),[S,P]=s.useState(["","","","","",""]),[A,E]=s.useState(!1),[q,D]=s.useState(!1),[F,L]=s.useState(!1),[R,$]=s.useState(null),[B,G]=s.useState(!1),[J,M]=s.useState(!1),T=s.useRef([]),z=s.useRef(null),I=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),K=6===S.join("").length,U=async()=>{if(j&&I(j)){D(!0),$(null);try{const{data:e,error:t}=await m.functions.invoke("send-signup-otp",{body:{email:j}});if(t)throw t;if(null==e?void 0:e.error)throw new Error(e.error);P(["","","","","",""]),u.success("New verification code sent"),setTimeout(()=>{var e;return null==(e=T.current[0])?void 0:e.focus()},100)}catch(e){$(e.message||"Failed to resend code")}finally{D(!1)}}};return b?a.jsx("div",{className:"min-h-screen w-full font-sans flex flex-col items-center justify-center bg-[#f5f2e8]",children:a.jsxs("div",{className:"flex flex-col items-center justify-center gap-4",children:[a.jsx("div",{className:"relative w-20 h-20",children:a.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-[#e6e0d4] border-t-[#d97757] animate-spin"})}),a.jsx("div",{className:"text-xl font-serif font-medium text-[#2d2d2d]",children:"Loading…"})]})}):!b&&h?a.jsx(r,{to:"/dashboard",replace:!0}):a.jsx("div",{className:"min-h-screen w-full font-sans bg-[#f5f2e8] text-[#3c3c3c]",children:a.jsxs("div",{className:"relative z-10 w-full min-h-screen flex flex-col items-center justify-center px-4 py-10",children:[a.jsxs("button",{type:"button",onClick:()=>p(-1),className:"absolute top-4 left-4 inline-flex items-center gap-2 text-sm text-[#3c3c3c] hover:text-black bg-white/80 backdrop-blur px-3 py-2 rounded-xl border border-[#e6e0d4] font-medium hover:border-[#d97757]/50 hover:text-[#d97757] transition-all","aria-label":"Go back",children:[a.jsx(n,{className:"w-4 h-4"}),"Back"]}),a.jsx("div",{className:"w-full max-w-md rounded-2xl overflow-hidden shadow-sm bg-white border-2 border-[#d97757]/20 mx-auto",children:a.jsxs("div",{className:"p-8 md:p-10 bg-white",children:[a.jsx("h3",{className:"text-2xl font-serif font-medium text-[#d97757] text-center mb-2",children:"Create Account"}),a.jsx("p",{className:"text-center text-[#666666] text-sm mb-8 font-sans",children:"Start your English mastery journey today"}),a.jsxs("form",{onSubmit:async e=>{var t;if(e.preventDefault(),$(null),!A)return void $("Please get a verification code first");if(!K)return void $("Please enter the complete 6-digit verification code");if(!v)return void $("Please enter your nickname");if(!N)return $("Please set a password"),void(null==(t=z.current)||t.focus());if(N.length<6)return void $("Password must be at least 6 characters");if(N!==k)return void $("Passwords do not match");const s=S.join("");L(!0);try{const{data:e,error:t}=await m.functions.invoke("verify-signup-otp",{body:{email:j,otp:s,password:N,fullName:v}});if(t)throw t;if(null==e?void 0:e.error)throw new Error(e.error);const{error:a}=await m.auth.signInWithPassword({email:j,password:N});if(a)return u.success("Account created! Please sign in."),void p("/auth");u.success("Account created successfully!"),p("/dashboard")}catch(a){$(a.message||"Failed to create account")}finally{L(!1)}},className:"space-y-5",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-[#3c3c3c] mb-2 font-sans",children:"Nickname"}),a.jsxs("div",{className:"relative",children:[a.jsx(o,{className:"absolute left-3 top-3.5 h-5 w-5 text-[#d97757]/50"}),a.jsx("input",{type:"text",required:!0,value:v,onChange:e=>g(e.target.value),className:"w-full pl-10 p-3 rounded-xl border border-[#d97757]/20 bg-[#faf8f6] text-[#2d2d2d] shadow-sm focus:outline-none focus:ring-2 focus:ring-[#d97757]/20 focus:border-[#d97757] transition-all font-sans placeholder-[#666666]/50",placeholder:"Johnny"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-[#3c3c3c] mb-2 font-sans",children:"Email Address"}),a.jsxs("div",{className:"relative",children:[a.jsx(f,{className:"absolute left-3 top-3.5 h-5 w-5 text-[#d97757]/50"}),a.jsx("input",{type:"email",required:!0,value:j,onChange:e=>w(e.target.value),className:"w-full pl-10 pr-32 p-3 rounded-xl border border-[#d97757]/20 bg-[#faf8f6] text-[#2d2d2d] shadow-sm focus:outline-none focus:ring-2 focus:ring-[#d97757]/20 focus:border-[#d97757] transition-all font-sans placeholder-[#666666]/50",placeholder:"john@example.com"}),a.jsx("div",{className:"absolute right-1.5 top-1.5 bottom-1.5",children:a.jsx("button",{type:"button",onClick:A?U:async()=>{if($(null),j)if(I(j)){D(!0);try{const{data:e,error:t}=await m.functions.invoke("send-signup-otp",{body:{email:j}});if(t)throw t;if(null==e?void 0:e.error)throw new Error(e.error);E(!0),u.success("Verification code sent to your email"),setTimeout(()=>{var e;return null==(e=T.current[0])?void 0:e.focus()},100)}catch(e){$(e.message||"Failed to send verification code")}finally{D(!1)}}else $("Please enter a valid email address");else $("Please enter your email address")},disabled:q||!j||!I(j),className:`h-full px-4 rounded-lg text-sm font-medium transition-all flex items-center gap-1.5 ${A?"bg-green-100 text-green-700 hover:bg-green-200":"bg-[#d97757] text-white hover:bg-[#c56a4b] shadow-sm"} disabled:opacity-50 disabled:cursor-not-allowed`,children:q?a.jsx("div",{className:"h-4 w-4 rounded-full border-2 border-current border-t-transparent animate-spin"}):A?a.jsxs(a.Fragment,{children:[a.jsx(l,{className:"w-4 h-4"}),"Sent"]}):"Get Code"})})]}),A&&a.jsxs("div",{className:"mt-4 animate-in fade-in slide-in-from-top-2 duration-300",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("label",{className:"text-xs font-medium text-[#666666] font-sans",children:"Enter verification code sent to your email"}),a.jsx("button",{type:"button",onClick:U,disabled:q,className:"text-xs text-[#d97757] hover:underline disabled:opacity-50",children:"Resend"})]}),a.jsx("div",{className:"grid grid-cols-6 gap-2",onPaste:e=>{var t;e.preventDefault();const s=e.clipboardData.getData("text").slice(0,6).split(""),a=[...S];s.forEach((e,t)=>{t<6&&!isNaN(Number(e))&&(a[t]=e)}),P(a);const r=Math.min(s.length,5);null==(t=T.current[r])||t.focus()},children:S.map((e,t)=>a.jsx("input",{ref:e=>T.current[t]=e,type:"text",maxLength:1,value:e,onChange:e=>((e,t)=>{var s;if(isNaN(Number(t)))return;const a=[...S];a[e]=t.substring(t.length-1),P(a),t&&e<5&&(null==(s=T.current[e+1])||s.focus())})(t,e.target.value),onKeyDown:e=>((e,t)=>{var s;"Backspace"===t.key&&!S[e]&&e>0&&(null==(s=T.current[e-1])||s.focus())})(t,e),className:"w-full aspect-square text-center text-xl font-bold rounded-xl border-2 bg-[#faf8f6] text-[#2d2d2d] focus:border-[#d97757] focus:ring-4 focus:ring-[#d97757]/10 focus:outline-none transition-all "+(e?"border-[#d97757]/50":"border-[#d97757]/20"),placeholder:"•"},t))})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-[#3c3c3c] mb-2 font-sans",children:"Password"}),a.jsxs("div",{className:"relative",children:[a.jsx(x,{className:"absolute left-3 top-3.5 h-5 w-5 text-[#d97757]/50"}),a.jsx("input",{ref:z,type:B?"text":"password",required:!0,value:N,onChange:e=>y(e.target.value),className:"w-full pl-10 pr-12 p-3 rounded-xl border border-[#d97757]/20 bg-[#faf8f6] text-[#2d2d2d] shadow-sm focus:outline-none focus:ring-2 focus:ring-[#d97757]/20 focus:border-[#d97757] transition-all font-sans placeholder-[#666666]/50",placeholder:"••••••••"}),a.jsx("button",{type:"button",onClick:()=>G(!B),className:"absolute right-3 top-3.5 text-[#666666] hover:text-[#d97757] transition-colors",children:B?a.jsx(i,{className:"h-5 w-5"}):a.jsx(d,{className:"h-5 w-5"})})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-[#3c3c3c] mb-2 font-sans",children:"Confirm Password"}),a.jsxs("div",{className:"relative",children:[a.jsx(x,{className:"absolute left-3 top-3.5 h-5 w-5 text-[#d97757]/50"}),a.jsx("input",{type:J?"text":"password",required:!0,value:k,onChange:e=>C(e.target.value),className:"w-full pl-10 pr-12 p-3 rounded-xl border border-[#d97757]/20 bg-[#faf8f6] text-[#2d2d2d] shadow-sm focus:outline-none focus:ring-2 focus:ring-[#d97757]/20 focus:border-[#d97757] transition-all font-sans placeholder-[#666666]/50",placeholder:"••••••••"}),a.jsx("button",{type:"button",onClick:()=>M(!J),className:"absolute right-3 top-3.5 text-[#666666] hover:text-[#d97757] transition-colors",children:J?a.jsx(i,{className:"h-5 w-5"}):a.jsx(d,{className:"h-5 w-5"})})]})]}),R&&a.jsxs("div",{className:"p-3 bg-red-50 border border-red-100 rounded-lg text-sm text-red-600 flex items-start gap-2 animate-in fade-in slide-in-from-top-1",children:[a.jsx("div",{className:"mt-0.5",children:"⚠️"}),a.jsx("div",{children:R})]}),a.jsx("button",{type:"submit",disabled:F||!A||!K,className:`w-full py-4 px-6 font-medium rounded-xl shadow-md transform transition-all font-sans flex items-center justify-center gap-2 ${A&&K?"bg-[#d97757] text-white hover:bg-[#c56a4b] hover:-translate-y-0.5":"bg-[#d97757]/50 text-white/80 cursor-not-allowed"} disabled:hover:transform-none`,children:F?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"h-4 w-4 rounded-full border-2 border-white/30 border-t-white animate-spin"}),"Creating Account..."]}):"Create Account"}),a.jsxs("div",{className:"text-center text-sm text-[#666666] font-sans mt-6",children:["Already have an account? ",a.jsx(c,{className:"text-[#d97757] font-medium hover:underline",to:"/auth",children:"Sign in"})]})]})]})})]})})};export{h as default};
