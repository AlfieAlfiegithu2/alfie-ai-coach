const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DXpPY1B7.js","assets/vendor-react-JN_hy__U.js","assets/vendor-react-dom-Cb-iy8Oc.js","assets/vendor-animation-ClPlB6zo.js","assets/vendor-i18n-DlHrixAm.js","assets/vendor-ui-DG51EGkO.js","assets/vendor-utils-D5HPTFR9.js","assets/vendor-supabase-D7XYLCUu.js","assets/vendor-charts-BpOKEG9Z.js","assets/vendor-date-DT7Rq6D9.js","assets/index-la99fLnL.css"])))=>i.map(i=>d[i]);
import{_ as e}from"./vendor-i18n-DlHrixAm.js";import{r as s,j as t,u as a,c as r}from"./vendor-react-JN_hy__U.js";import{d as l,B as n,a2 as i,a0 as o,C as c,a as d,s as m,E as u,J as x,P as h,Z as p,_ as g,$ as f,y as j,D as b,f as y,g as v,h as w}from"./index-DXpPY1B7.js";import{g as N}from"./skills-NqzSOyzV.js";import{aw as k,bn as _,aL as C,Y as S,F as P}from"./vendor-ui-DG51EGkO.js";import{P as $}from"./PenguinClapAnimation-Czda42R5.js";import E from"./VocabularyMapView-DwJe3eyJ.js";import{A as L,a as A,b as z,c as B,d as F,e as I,f as M,g as T,h as q}from"./alert-dialog-BwGJZs3W.js";import"./vendor-react-dom-Cb-iy8Oc.js";import"./vendor-animation-ClPlB6zo.js";import"./vendor-utils-D5HPTFR9.js";import"./vendor-supabase-D7XYLCUu.js";import"./vendor-charts-BpOKEG9Z.js";import"./vendor-date-DT7Rq6D9.js";const D=({item:e,testId:a,selectedAccent:r="us",onAnalyzed:u})=>{const{toast:x}=l(),[h,p]=s.useState(null),[g,f]=s.useState(!1),[j,b]=s.useState(""),[y,v]=s.useState(""),[w,N]=s.useState(null),[_,C]=s.useState(""),S=s.useRef(null),[P,$]=s.useState(!1),[E,L]=s.useState(!1),[A,z]=s.useState(!1),B=e.audio_url||("uk"===r?e.audio_url_uk:e.audio_url_us);s.useEffect(()=>{if(B){try{S.current&&(S.current.pause(),S.current=null);const e=new Audio(B);e.preload="auto",e.playsInline=!0,S.current=e,e.onended=()=>z(!1),e.onerror=()=>$(!0),E||e.play().then(()=>{$(!1),L(!0),z(!0)}).catch(()=>$(!0))}catch(e){$(!0)}return()=>{var e;try{null==(e=S.current)||e.pause()}catch{}}}},[B,E]),s.useEffect(()=>{p(null),f(!1),b(""),v(""),N(null),C(""),$(!1),L(!1),z(!1)},[e.id]);return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex flex-col items-center gap-2",children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Listen carefully and repeat exactly what you hear"}),t.jsxs(n,{size:"lg",variant:A?"default":"outline",onClick:async()=>{var e;if(B)try{if(A&&S.current)return S.current.pause(),void z(!1);await(null==(e=S.current)?void 0:e.play()),$(!1),z(!0)}catch(s){$(!0)}else x({title:"No audio available",description:"Audio for this accent hasn't been generated yet.",variant:"destructive"})},disabled:!B,className:"gap-2",children:[t.jsx(k,{className:"w-5 h-5 "+(A?"animate-pulse":"")}),B?A?"Playing...":P?"Play Audio":"Play Again":"Audio not available"]})]}),t.jsxs("div",{className:"space-y-4 w-full max-w-xl mx-auto",children:[t.jsx("div",{className:"flex justify-center",children:t.jsx(i,{onRecordingComplete:e=>{p(e),b(""),v(""),N(null),C("")},autoFocus:!0},e.id)}),t.jsx("div",{className:"flex justify-center",children:t.jsx(n,{onClick:async()=>{var s,t,l;try{if(!h)return void x({title:"No recording",description:"Please record your voice first.",variant:"destructive"});const{data:n}=await m.auth.getUser(),i=null==(s=null==n?void 0:n.user)?void 0:s.id;if(!i)return void x({title:"Sign in required",description:"Please log in to save and analyze your recording.",variant:"destructive"});f(!0);const o=`user-recordings/pronunciation/${a}/${e.id}/${Date.now()}.webm`;console.log("Pronunciation upload disabled - implement R2 upload");const c=`https://your-bucket.your-domain.com/${o}`;C(c);const d=await(l=h,new Promise((e,s)=>{const t=new FileReader;t.onloadend=()=>{const s=t.result.split(",")[1];e(s)},t.onerror=s,t.readAsDataURL(l)})),p="uk"===r?"british":"american",{data:g,error:j}=await m.functions.invoke("pronunciation-analysis",{body:{audio:d,referenceText:e.reference_text,accent:p}});if(j)throw j;const y=(null==g?void 0:g.transcription)??"",w=(null==g?void 0:g.analysis)??"";b(y),v(w);try{N((null==g?void 0:g.analysis_json)??JSON.parse(w))}catch{N(null)}const k=(null==(t=null==g?void 0:g.analysis_json)?void 0:t.overallScore)??null,{error:_}=await m.from("pronunciation_results").insert({user_id:i,test_id:a,item_id:e.id,audio_url:c,analysis_json:(null==g?void 0:g.analysis_json)??{transcription:y,analysis:w},overall_score:k});if(_)throw _;x({title:"Analysis complete",description:"Your feedback is ready."}),null==u||u({transcription:y,analysis:w,audioUrl:c})}catch(n){console.error(n),x({title:"Analysis failed",description:n.message,variant:"destructive"})}finally{f(!1)}},disabled:g||!h,size:"lg",children:g?"Analyzing...":"Get Feedback"})}),g&&t.jsx("div",{className:"flex justify-center animate-fade-in",children:t.jsx(o,{size:"md",message:"Analyzing your pronunciation..."})})]}),w&&t.jsx(c,{className:"border-light-border w-full max-w-xl mx-auto animate-fade-in",children:t.jsxs(d,{className:"p-6 space-y-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Overall Score"}),t.jsx("p",{className:"text-4xl font-bold text-primary",children:(null==w?void 0:w.overallScore)??"-"}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"out of 100"}),(null==w?void 0:w.overallSummary)&&t.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:w.overallSummary})]}),Array.isArray(null==w?void 0:w.wordAnalysis)&&w.wordAnalysis.length>0&&t.jsxs("div",{children:[t.jsx("p",{className:"text-xs font-medium mb-2",children:"Word-by-Word Analysis"}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:w.wordAnalysis.slice(0,10).map((e,s)=>t.jsxs("div",{className:"rounded-md border p-2 text-sm "+("correct"===e.status?"border-green-200 bg-green-50":"incorrect"===e.status?"border-red-200 bg-red-50":"border-yellow-200 bg-yellow-50"),children:[t.jsxs("div",{className:"font-medium flex items-center justify-between",children:[t.jsx("span",{children:e.word}),t.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded "+("correct"===e.status?"bg-green-100 text-green-700":"incorrect"===e.status?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"),children:e.status})]}),e.feedback&&t.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:e.feedback})]},s))})]}),Array.isArray(null==w?void 0:w.detailedFeedback)&&w.detailedFeedback.length>0&&t.jsxs("div",{className:"space-y-3",children:[t.jsx("p",{className:"text-xs font-medium",children:"Detailed Feedback"}),w.detailedFeedback.map((e,s)=>t.jsxs("div",{className:"rounded-md border border-light-border p-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("p",{className:"text-sm font-medium",children:e.area}),"number"==typeof e.score&&t.jsxs("span",{className:"text-xs text-muted-foreground",children:[e.score,"/100"]})]}),e.positive&&t.jsxs("p",{className:"text-sm mt-1 text-green-600",children:["âœ“ ",e.positive]}),e.improvement&&t.jsxs("p",{className:"text-sm mt-1 text-amber-600",children:["â†’ ",e.improvement]})]},s))]})]})})]})},O=()=>{const{user:e}=u(),r=a(),[l,i]=s.useState([]),[j,b]=s.useState([]),[y,v]=s.useState(!0),[w,N]=s.useState([]),k=[{name:"Mouse",image:"/moouse emoji.png"},{name:"Hamster",image:"/Hamster.png"},{name:"Chick",image:"/chick.png"},{name:"Rabbit",image:"/rabbit.png"},{name:"Kitten",image:"/cat.png"},{name:"Puppy",image:"/puppy.png"},{name:"Duck",image:"/duck.png"},{name:"Hedgehog",image:"/hedgehog.png"},{name:"Squirrel",image:"/squerrel.png"},{name:"Penguin",image:"/Penguine.png"},{name:"Otter",image:"/otter.png"},{name:"Koala",image:"/koala.png"},{name:"Piglet",image:"/piglet.png"},{name:"Monkey",image:"/Monkey.png"},{name:"Fox",image:"/fox.png"},{name:"Deer",image:"/dear.png"},{name:"Seal",image:"/seal.png"},{name:"Panda",image:"/panda.png"},{name:"Bear",image:"/bear.png"},{name:"Polar Bear",image:"/polar bear.png"}],$=e=>e<k.length?k[e]:k[k.length-1];s.useEffect(()=>{e?E():v(!1)},[e]),s.useEffect(()=>{const s=()=>{e&&E()};return window.addEventListener("focus",s),()=>window.removeEventListener("focus",s)},[e]);const E=async()=>{if(e){v(!0);try{const[s,t]=await Promise.all([m.from("skill_tests").select("id, title, test_order").eq("skill_slug","grammar-fix-it").order("test_order",{ascending:!0}),m.from("user_test_progress").select("test_id, status, completed_score").eq("user_id",e.id)]);if(s.error)throw s.error;if(t.error)throw t.error;const a=s.data||[];let r=t.data||[];const l=a.map(e=>e.id);if(r=r.filter(e=>l.includes(e.test_id)),a.length>0&&0===r.length){const s=a.find(e=>1===e.test_order)||a[0];if(s){const t={user_id:e.id,test_id:s.id,status:"unlocked"};await m.from("user_test_progress").insert(t),r=[{test_id:s.id,status:"unlocked",completed_score:null}]}}i(a),b(r),D(a,r)}catch(s){console.error("Error loading map data:",s),x.error("Failed to load grammar map")}finally{v(!1)}}},D=(e,s)=>{const t=[];e.forEach((e,a)=>{const r=Math.floor(a/5),l=a%5,n=160*(r%2==0?l:4-l)+50,i=150*r+20,o=s.find(s=>s.test_id===e.id)||{test_id:e.id,status:"locked"};t.push({test:e,progress:o,position:{x:n,y:i}})}),N(t)},O=e=>{r(`/skills/grammar-fix-it/test/${e.test.id}`)},R=e=>{switch(e){case"completed":return"bg-gradient-to-br from-yellow-400 to-orange-500 text-white shadow-lg border-yellow-300 hover:shadow-xl transform hover:scale-105";case"unlocked":return"bg-gradient-to-br from-green-400 to-blue-500 text-white shadow-lg border-green-300 hover:shadow-xl transform hover:scale-105 cursor-pointer";default:return"bg-gray-200 text-gray-500 border-gray-300 cursor-not-allowed"}};return y?t.jsx("div",{className:"min-h-screen flex items-center justify-center",children:t.jsx(o,{size:"lg",message:"Loading your grammar journey..."})}):e?t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-blue-50 to-purple-50 p-6",children:t.jsxs("div",{className:"max-w-6xl mx-auto",children:[t.jsxs("div",{className:"text-center mb-4",children:[t.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:"Grammar Fix-it Journey"}),t.jsx(c,{className:"max-w-md mx-auto bg-white/80 backdrop-blur-sm",children:t.jsxs(d,{className:"p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-medium",children:"Overall Progress"}),t.jsxs("span",{className:"text-sm text-gray-600",children:[j.filter(e=>"completed"===e.status).length," / ",l.length]})]}),t.jsx(h,{value:(()=>{const e=j.filter(e=>"completed"===e.status).length;return l.length>0?e/l.length*100:0})(),className:"h-3"})]})})]}),t.jsx(c,{className:"relative bg-white/60 backdrop-blur-sm border-2 border-white/80 shadow-xl",children:t.jsx(d,{className:"pt-4 pb-8 px-8",children:t.jsxs("div",{className:"relative mx-auto",style:{width:"900px",height:"700px",minHeight:"600px"},children:[(()=>{if(w.length<2)return null;let e=`M ${w[0].position.x+50} ${w[0].position.y+50}`;for(let s=1;s<w.length;s++){const t=w[s-1],a=w[s];e+=` Q ${(t.position.x+a.position.x)/2+50} ${(t.position.y+a.position.y)/2+50+30*Math.sin(.5*s)} ${a.position.x+50} ${a.position.y+50}`}return t.jsxs("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{zIndex:1},children:[t.jsx("path",{d:e,stroke:"url(#pathGradient)",strokeWidth:"4",fill:"none",strokeDasharray:"8,4",className:"animate-pulse"}),t.jsx("defs",{children:t.jsxs("linearGradient",{id:"pathGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"#3B82F6"}),t.jsx("stop",{offset:"50%",stopColor:"#8B5CF6"}),t.jsx("stop",{offset:"100%",stopColor:"#EC4899"})]})})]})})(),w.map((s,a)=>{return t.jsxs("div",{className:"absolute",style:{left:`${s.position.x}px`,top:`${s.position.y}px`,zIndex:10},children:["locked"===s.progress.status?t.jsxs(L,{children:[t.jsx(A,{asChild:!0,children:t.jsxs(p,{children:[t.jsx(g,{asChild:!0,children:t.jsxs("div",{className:`relative w-24 h-24 rounded-full border-4 flex items-center justify-center transition-all duration-300 ease-in-out ${R(s.progress.status)} hover:cursor-pointer`,onClick:()=>O(s),children:[t.jsx("img",{src:$(a).image,alt:`${$(a).name} level icon`,className:"absolute inset-0 w-full h-full rounded-full object-cover transform scale-90",loading:"lazy"}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 rounded-full",children:t.jsx(_,{className:"w-8 h-8 text-white"})})]})}),t.jsx(f,{side:"top",children:a>0?`Complete the ${$(a-1).name} Level to unlock! Or double-click to unlock manually.`:"This is the first level."})]})}),t.jsxs(z,{children:[t.jsxs(B,{children:[t.jsxs(F,{children:["Unlock ",$(a).name," Level?"]}),t.jsxs(I,{children:["Do you want to unlock this level? This will allow you to start the ",$(a).name," grammar test."]})]}),t.jsxs(M,{children:[t.jsx(T,{children:"Cancel"}),t.jsx(q,{onClick:()=>(async s=>{if(e)try{await m.from("user_test_progress").upsert({user_id:e.id,test_id:s.test.id,status:"unlocked"},{onConflict:"user_id,test_id"}),x.success(`${$(w.indexOf(s)).name} Level unlocked!`),E()}catch(t){console.error("Error unlocking level:",t),x.error("Failed to unlock level")}})(s),children:"Yes, Unlock Level"})]})]})]}):t.jsxs("div",{className:`relative w-24 h-24 rounded-full border-4 flex items-center justify-center transition-all duration-300 ease-in-out ${R(s.progress.status)}`,onClick:()=>O(s),children:[t.jsx("img",{src:$(a).image,alt:`${$(a).name} level icon`,className:"absolute inset-0 w-full h-full rounded-full object-cover transform scale-90",loading:"lazy"}),"unlocked"===s.progress.status&&t.jsx("div",{className:"absolute bottom-1 right-1",children:t.jsx(C,{className:"w-4 h-4 text-green-500"})}),"completed"===s.progress.status&&s.progress.completed_score&&t.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2",children:(l=s.progress.completed_score,r=l>=90?3:l>=70?2:1,t.jsx("div",{className:"flex items-center justify-center",children:[1,2,3].map(e=>t.jsx(P,{className:"w-6 h-6 "+(e<=r?"text-yellow-400 fill-current":"text-gray-300"),style:{transform:`rotate(${15*(e-2)}deg) translateY(${2===e?"0px":"4px"})`,margin:"0 2px"}},e))}))})]}),t.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 w-32 text-center",children:t.jsxs("p",{className:"text-[10px] font-medium text-muted-foreground truncate",children:[$(a).name," Level"]})})]},s.test.id);var r,l})]})})}),t.jsx("div",{className:"text-center mt-8 space-x-4",children:t.jsxs(n,{variant:"outline",onClick:()=>r("/ielts-portal"),className:"bg-white/80 backdrop-blur-sm hover:bg-white",children:[t.jsx(S,{className:"w-4 h-4 mr-2 rotate-180"}),"Back to IELTS Portal"]})})]})}):t.jsx("div",{className:"min-h-screen flex items-center justify-center",children:t.jsx(c,{className:"p-8 text-center",children:t.jsxs(d,{children:[t.jsx("p",{className:"text-lg mb-4",children:"Please sign in to access your grammar journey."}),t.jsx(n,{onClick:()=>r("/auth"),className:"bg-primary text-primary-foreground hover:bg-primary/90",children:"Sign In"})]})})})},R=()=>{const{user:e}=u(),r=a(),[l,i]=s.useState([]),[j,b]=s.useState([]),[y,v]=s.useState(!0),[w,N]=s.useState([]),k=[{name:"Mouse",image:"/moouse emoji.png"},{name:"Hamster",image:"/Hamster.png"},{name:"Chick",image:"/chick.png"},{name:"Rabbit",image:"/rabbit.png"},{name:"Kitten",image:"/cat.png"},{name:"Puppy",image:"/puppy.png"},{name:"Duck",image:"/duck.png"},{name:"Hedgehog",image:"/hedgehog.png"},{name:"Squirrel",image:"/squerrel.png"},{name:"Penguin",image:"/Penguine.png"},{name:"Otter",image:"/otter.png"},{name:"Koala",image:"/koala.png"},{name:"Piglet",image:"/piglet.png"},{name:"Monkey",image:"/Monkey.png"},{name:"Fox",image:"/fox.png"},{name:"Deer",image:"/dear.png"},{name:"Seal",image:"/seal.png"},{name:"Panda",image:"/panda.png"},{name:"Bear",image:"/bear.png"},{name:"Polar Bear",image:"/polar bear.png"}],$=e=>e<k.length?k[e]:k[k.length-1];s.useEffect(()=>{e?E():v(!1)},[e]),s.useEffect(()=>{const s=()=>{e&&E()};return window.addEventListener("focus",s),()=>window.removeEventListener("focus",s)},[e]);const E=async()=>{if(e){v(!0);try{const[s,t]=await Promise.all([m.from("skill_tests").select("id, title, test_order").eq("skill_slug","paraphrasing-challenge").order("test_order",{ascending:!0}),m.from("user_test_progress").select("test_id, status, completed_score").eq("user_id",e.id)]);if(s.error)throw s.error;if(t.error)throw t.error;const a=s.data||[];let r=t.data||[];const l=a.map(e=>e.id);if(r=r.filter(e=>l.includes(e.test_id)),a.length>0&&0===r.length){const s=a.find(e=>1===e.test_order)||a[0];if(s){const t={user_id:e.id,test_id:s.id,status:"unlocked"};await m.from("user_test_progress").insert(t),r=[{test_id:s.id,status:"unlocked",completed_score:null}]}}i(a),b(r),D(a,r)}catch(s){console.error("Error loading map data:",s),x.error("Failed to load paraphrasing map")}finally{v(!1)}}},D=(e,s)=>{const t=[];e.forEach((e,a)=>{const r=Math.floor(a/5),l=a%5,n=160*(r%2==0?l:4-l)+50,i=150*r+20,o=s.find(s=>s.test_id===e.id)||{test_id:e.id,status:"locked"};t.push({test:e,progress:o,position:{x:n,y:i}})}),N(t)},O=e=>{r(`/skills/paraphrasing-challenge/test/${e.test.id}`)},R=e=>{switch(e){case"completed":return"bg-gradient-to-br from-yellow-400 to-orange-500 text-white shadow-lg border-yellow-300 hover:shadow-xl transform hover:scale-105";case"unlocked":return"bg-gradient-to-br from-purple-400 to-pink-500 text-white shadow-lg border-purple-300 hover:shadow-xl transform hover:scale-105 cursor-pointer";default:return"bg-gray-200 text-gray-500 border-gray-300 cursor-not-allowed"}};return y?t.jsx("div",{className:"min-h-screen flex items-center justify-center",children:t.jsx(o,{size:"lg",message:"Loading your paraphrasing journey..."})}):e?t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-orange-50 p-6",children:t.jsxs("div",{className:"max-w-6xl mx-auto",children:[t.jsxs("div",{className:"text-center mb-4",children:[t.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:"Paraphrasing Challenge Journey"}),t.jsx(c,{className:"max-w-md mx-auto bg-white/80 backdrop-blur-sm",children:t.jsxs(d,{className:"p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-medium",children:"Overall Progress"}),t.jsxs("span",{className:"text-sm text-gray-600",children:[j.filter(e=>"completed"===e.status).length," / ",l.length]})]}),t.jsx(h,{value:(()=>{const e=j.filter(e=>"completed"===e.status).length;return l.length>0?e/l.length*100:0})(),className:"h-3"})]})})]}),t.jsx(c,{className:"relative bg-white/60 backdrop-blur-sm border-2 border-white/80 shadow-xl",children:t.jsx(d,{className:"pt-4 pb-8 px-8",children:t.jsxs("div",{className:"relative mx-auto",style:{width:"900px",height:"700px",minHeight:"600px"},children:[(()=>{if(w.length<2)return null;let e=`M ${w[0].position.x+50} ${w[0].position.y+50}`;for(let s=1;s<w.length;s++){const t=w[s-1],a=w[s];e+=` Q ${(t.position.x+a.position.x)/2+50} ${(t.position.y+a.position.y)/2+50+30*Math.sin(.5*s)} ${a.position.x+50} ${a.position.y+50}`}return t.jsxs("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{zIndex:1},children:[t.jsx("path",{d:e,stroke:"url(#pathGradient)",strokeWidth:"4",fill:"none",strokeDasharray:"8,4",className:"animate-pulse"}),t.jsx("defs",{children:t.jsxs("linearGradient",{id:"pathGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"#8B5CF6"}),t.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),t.jsx("stop",{offset:"100%",stopColor:"#F59E0B"})]})})]})})(),w.map((s,a)=>{return t.jsxs("div",{className:"absolute",style:{left:`${s.position.x}px`,top:`${s.position.y}px`,zIndex:10},children:["locked"===s.progress.status?t.jsxs(L,{children:[t.jsx(A,{asChild:!0,children:t.jsxs(p,{children:[t.jsx(g,{asChild:!0,children:t.jsxs("div",{className:`relative w-24 h-24 rounded-full border-4 flex items-center justify-center transition-all duration-300 ease-in-out ${R(s.progress.status)} hover:cursor-pointer`,onClick:()=>O(s),children:[t.jsx("img",{src:$(a).image,alt:`${$(a).name} level icon`,className:"absolute inset-0 w-full h-full rounded-full object-cover transform scale-90",loading:"lazy"}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 rounded-full",children:t.jsx(_,{className:"w-8 h-8 text-white"})})]})}),t.jsx(f,{side:"top",children:a>0?`Complete the ${$(a-1).name} Level to unlock! Or double-click to unlock manually.`:"This is the first level."})]})}),t.jsxs(z,{children:[t.jsxs(B,{children:[t.jsxs(F,{children:["Unlock ",$(a).name," Level?"]}),t.jsxs(I,{children:["Do you want to unlock this level? This will allow you to start the ",$(a).name," paraphrasing challenge."]})]}),t.jsxs(M,{children:[t.jsx(T,{children:"Cancel"}),t.jsx(q,{onClick:()=>(async s=>{if(e)try{await m.from("user_test_progress").upsert({user_id:e.id,test_id:s.test.id,status:"unlocked"},{onConflict:"user_id,test_id"}),x.success(`${$(w.indexOf(s)).name} Level unlocked!`),E()}catch(t){console.error("Error unlocking level:",t),x.error("Failed to unlock level")}})(s),children:"Yes, Unlock Level"})]})]})]}):t.jsxs("div",{className:`relative w-24 h-24 rounded-full border-4 flex items-center justify-center transition-all duration-300 ease-in-out ${R(s.progress.status)}`,onClick:()=>O(s),children:[t.jsx("img",{src:$(a).image,alt:`${$(a).name} level icon`,className:"absolute inset-0 w-full h-full rounded-full object-cover transform scale-90",loading:"lazy"}),"unlocked"===s.progress.status&&t.jsx("div",{className:"absolute bottom-1 right-1",children:t.jsx(C,{className:"w-4 h-4 text-purple-500"})}),"completed"===s.progress.status&&s.progress.completed_score&&t.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2",children:(l=s.progress.completed_score,r=l>=90?3:l>=70?2:1,t.jsx("div",{className:"flex items-center justify-center",children:[1,2,3].map(e=>t.jsx(P,{className:"w-6 h-6 "+(e<=r?"text-yellow-400 fill-current":"text-gray-300"),style:{transform:`rotate(${15*(e-2)}deg) translateY(${2===e?"0px":"4px"})`,margin:"0 2px"}},e))}))})]}),t.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 w-32 text-center",children:t.jsxs("p",{className:"text-[10px] font-medium text-muted-foreground truncate",children:[$(a).name," Level"]})})]},s.test.id);var r,l})]})})}),t.jsx("div",{className:"text-center mt-8 space-x-4",children:t.jsxs(n,{variant:"outline",onClick:()=>r("/ielts-portal"),className:"bg-white/80 backdrop-blur-sm hover:bg-white",children:[t.jsx(S,{className:"w-4 h-4 mr-2 rotate-180"}),"Back to IELTS Portal"]})})]})}):t.jsx("div",{className:"min-h-screen flex items-center justify-center",children:t.jsx(c,{className:"p-8 text-center",children:t.jsxs(d,{children:[t.jsx("p",{className:"text-lg mb-4",children:"Please sign in to access your paraphrasing journey."}),t.jsx(n,{onClick:()=>r("/auth"),className:"bg-primary text-primary-foreground hover:bg-primary/90",children:"Sign In"})]})})})},Y=()=>{const{user:e}=u(),r=a(),[l,i]=s.useState([]),[j,b]=s.useState([]),[y,v]=s.useState(!0),[w,N]=s.useState([]),k=[{name:"Mouse",image:"/moouse emoji.png"},{name:"Hamster",image:"/Hamster.png"},{name:"Chick",image:"/chick.png"},{name:"Rabbit",image:"/rabbit.png"},{name:"Kitten",image:"/cat.png"},{name:"Puppy",image:"/puppy.png"},{name:"Duck",image:"/duck.png"},{name:"Hedgehog",image:"/hedgehog.png"},{name:"Squirrel",image:"/squerrel.png"},{name:"Penguin",image:"/Penguine.png"},{name:"Otter",image:"/otter.png"},{name:"Koala",image:"/koala.png"},{name:"Piglet",image:"/piglet.png"},{name:"Monkey",image:"/Monkey.png"},{name:"Fox",image:"/fox.png"},{name:"Deer",image:"/dear.png"},{name:"Seal",image:"/seal.png"},{name:"Panda",image:"/panda.png"},{name:"Bear",image:"/bear.png"},{name:"Polar Bear",image:"/polar bear.png"}],$=e=>e<k.length?k[e]:k[k.length-1];s.useEffect(()=>{e?E():v(!1)},[e]),s.useEffect(()=>{const s=()=>{e&&E()};return window.addEventListener("focus",s),()=>window.removeEventListener("focus",s)},[e]);const E=async()=>{if(e){v(!0);try{const[s,t]=await Promise.all([m.from("skill_tests").select("id, title, test_order").eq("skill_slug","sentence-structure-scramble").order("test_order",{ascending:!0}),m.from("user_test_progress").select("test_id, status, completed_score").eq("user_id",e.id)]);if(s.error)throw s.error;if(t.error)throw t.error;const a=s.data||[];let r=t.data||[];const l=a.map(e=>e.id);if(r=r.filter(e=>l.includes(e.test_id)),a.length>0&&0===r.length){const s=a.find(e=>1===e.test_order)||a[0];if(s){const t={user_id:e.id,test_id:s.id,status:"unlocked"};await m.from("user_test_progress").insert(t),r=[{test_id:s.id,status:"unlocked",completed_score:null}]}}i(a),b(r),D(a,r)}catch(s){console.error("Error loading map data:",s),x.error("Failed to load sentence scramble map")}finally{v(!1)}}},D=(e,s)=>{const t=[];e.forEach((e,a)=>{const r=Math.floor(a/5),l=a%5,n=160*(r%2==0?l:4-l)+50,i=150*r+20,o=s.find(s=>s.test_id===e.id)||{test_id:e.id,status:"locked"};t.push({test:e,progress:o,position:{x:n,y:i}})}),N(t)},O=e=>{r(`/skills/sentence-structure-scramble/test/${e.test.id}`)},R=e=>{switch(e){case"completed":return"bg-gradient-to-br from-yellow-400 to-orange-500 text-white shadow-lg border-yellow-300 hover:shadow-xl transform hover:scale-105";case"unlocked":return"bg-gradient-to-br from-indigo-400 to-blue-500 text-white shadow-lg border-indigo-300 hover:shadow-xl transform hover:scale-105 cursor-pointer";default:return"bg-gray-200 text-gray-500 border-gray-300 cursor-not-allowed"}};return y?t.jsx("div",{className:"min-h-screen flex items-center justify-center",children:t.jsx(o,{size:"lg",message:"Loading your sentence scramble journey..."})}):e?t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-blue-50 to-cyan-50 p-6",children:t.jsxs("div",{className:"max-w-6xl mx-auto",children:[t.jsxs("div",{className:"text-center mb-4",children:[t.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:"Sentence Structure Scramble Journey"}),t.jsx(c,{className:"max-w-md mx-auto bg-white/80 backdrop-blur-sm",children:t.jsxs(d,{className:"p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-medium",children:"Overall Progress"}),t.jsxs("span",{className:"text-sm text-gray-600",children:[j.filter(e=>"completed"===e.status).length," / ",l.length]})]}),t.jsx(h,{value:(()=>{const e=j.filter(e=>"completed"===e.status).length;return l.length>0?e/l.length*100:0})(),className:"h-3"})]})})]}),t.jsx(c,{className:"relative bg-white/60 backdrop-blur-sm border-2 border-white/80 shadow-xl",children:t.jsx(d,{className:"pt-4 pb-8 px-8",children:t.jsxs("div",{className:"relative mx-auto",style:{width:"900px",height:"700px",minHeight:"600px"},children:[(()=>{if(w.length<2)return null;let e=`M ${w[0].position.x+50} ${w[0].position.y+50}`;for(let s=1;s<w.length;s++){const t=w[s-1],a=w[s];e+=` Q ${(t.position.x+a.position.x)/2+50} ${(t.position.y+a.position.y)/2+50+30*Math.sin(.5*s)} ${a.position.x+50} ${a.position.y+50}`}return t.jsxs("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{zIndex:1},children:[t.jsx("path",{d:e,stroke:"url(#pathGradient)",strokeWidth:"4",fill:"none",strokeDasharray:"8,4",className:"animate-pulse"}),t.jsx("defs",{children:t.jsxs("linearGradient",{id:"pathGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"#4F46E5"}),t.jsx("stop",{offset:"50%",stopColor:"#3B82F6"}),t.jsx("stop",{offset:"100%",stopColor:"#06B6D4"})]})})]})})(),w.map((s,a)=>{return t.jsxs("div",{className:"absolute",style:{left:`${s.position.x}px`,top:`${s.position.y}px`,zIndex:10},children:["locked"===s.progress.status?t.jsxs(L,{children:[t.jsx(A,{asChild:!0,children:t.jsxs(p,{children:[t.jsx(g,{asChild:!0,children:t.jsxs("div",{className:`relative w-24 h-24 rounded-full border-4 flex items-center justify-center transition-all duration-300 ease-in-out ${R(s.progress.status)} hover:cursor-pointer`,onClick:()=>O(s),children:[t.jsx("img",{src:$(a).image,alt:`${$(a).name} level icon`,className:"absolute inset-0 w-full h-full rounded-full object-cover transform scale-90",loading:"lazy"}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 rounded-full",children:t.jsx(_,{className:"w-8 h-8 text-white"})})]})}),t.jsx(f,{side:"top",children:a>0?`Complete the ${$(a-1).name} Level to unlock! Or double-click to unlock manually.`:"This is the first level."})]})}),t.jsxs(z,{children:[t.jsxs(B,{children:[t.jsxs(F,{children:["Unlock ",$(a).name," Level?"]}),t.jsxs(I,{children:["Do you want to unlock this level? This will allow you to start the ",$(a).name," sentence scramble challenge."]})]}),t.jsxs(M,{children:[t.jsx(T,{children:"Cancel"}),t.jsx(q,{onClick:()=>(async s=>{if(e)try{await m.from("user_test_progress").upsert({user_id:e.id,test_id:s.test.id,status:"unlocked"},{onConflict:"user_id,test_id"}),x.success(`${$(w.indexOf(s)).name} Level unlocked!`),E()}catch(t){console.error("Error unlocking level:",t),x.error("Failed to unlock level")}})(s),children:"Yes, Unlock Level"})]})]})]}):t.jsxs("div",{className:`relative w-24 h-24 rounded-full border-4 flex items-center justify-center transition-all duration-300 ease-in-out ${R(s.progress.status)}`,onClick:()=>O(s),children:[t.jsx("img",{src:$(a).image,alt:`${$(a).name} level icon`,className:"absolute inset-0 w-full h-full rounded-full object-cover transform scale-90",loading:"lazy"}),"unlocked"===s.progress.status&&t.jsx("div",{className:"absolute bottom-1 right-1",children:t.jsx(C,{className:"w-4 h-4 text-indigo-500"})}),"completed"===s.progress.status&&s.progress.completed_score&&t.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2",children:(l=s.progress.completed_score,r=l>=90?3:l>=70?2:1,t.jsx("div",{className:"flex items-center justify-center",children:[1,2,3].map(e=>t.jsx(P,{className:"w-6 h-6 "+(e<=r?"text-yellow-400 fill-current":"text-gray-300"),style:{transform:`rotate(${15*(e-2)}deg) translateY(${2===e?"0px":"4px"})`,margin:"0 2px"}},e))}))})]}),t.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 w-32 text-center",children:t.jsxs("p",{className:"text-[10px] font-medium text-muted-foreground truncate",children:[$(a).name," Level"]})})]},s.test.id);var r,l})]})})}),t.jsx("div",{className:"text-center mt-8 space-x-4",children:t.jsxs(n,{variant:"outline",onClick:()=>r("/ielts-portal"),className:"bg-white/80 backdrop-blur-sm hover:bg-white",children:[t.jsx(S,{className:"w-4 h-4 mr-2 rotate-180"}),"Back to IELTS Portal"]})})]})}):t.jsx("div",{className:"min-h-screen flex items-center justify-center",children:t.jsx(c,{className:"p-8 text-center",children:t.jsxs(d,{children:[t.jsx("p",{className:"text-lg mb-4",children:"Please sign in to access your sentence scramble journey."}),t.jsx(n,{onClick:()=>r("/auth"),className:"bg-primary text-primary-foreground hover:bg-primary/90",children:"Sign In"})]})})})},H=()=>{const{user:e}=u(),r=a(),[l,i]=s.useState([]),[j,b]=s.useState([]),[y,v]=s.useState(!0),[w,N]=s.useState([]),k=[{name:"Mouse",image:"/moouse emoji.png"},{name:"Hamster",image:"/Hamster.png"},{name:"Chick",image:"/chick.png"},{name:"Rabbit",image:"/rabbit.png"},{name:"Kitten",image:"/cat.png"},{name:"Puppy",image:"/puppy.png"},{name:"Duck",image:"/duck.png"},{name:"Hedgehog",image:"/hedgehog.png"},{name:"Squirrel",image:"/squerrel.png"},{name:"Penguin",image:"/Penguine.png"},{name:"Otter",image:"/otter.png"},{name:"Koala",image:"/koala.png"},{name:"Piglet",image:"/piglet.png"},{name:"Monkey",image:"/Monkey.png"},{name:"Fox",image:"/fox.png"},{name:"Deer",image:"/dear.png"},{name:"Seal",image:"/seal.png"},{name:"Panda",image:"/panda.png"},{name:"Bear",image:"/bear.png"},{name:"Polar Bear",image:"/polar bear.png"}],$=e=>e<k.length?k[e]:k[k.length-1];s.useEffect(()=>{e?E():v(!1)},[e]),s.useEffect(()=>{const s=()=>{e&&E()};return window.addEventListener("focus",s),()=>window.removeEventListener("focus",s)},[e]);const E=async()=>{if(e){v(!0);try{const[s,t]=await Promise.all([m.from("skill_tests").select("id, title, test_order").eq("skill_slug","listening-for-details").order("test_order",{ascending:!0}),m.from("user_test_progress").select("test_id, status, completed_score").eq("user_id",e.id)]);if(s.error)throw s.error;if(t.error)throw t.error;const a=s.data||[];let r=t.data||[];const l=a.map(e=>e.id);if(r=r.filter(e=>l.includes(e.test_id)),a.length>0&&0===r.length){const s=a.find(e=>1===e.test_order)||a[0];if(s){const t={user_id:e.id,test_id:s.id,status:"unlocked"};await m.from("user_test_progress").insert(t),r=[{test_id:s.id,status:"unlocked",completed_score:null}]}}i(a),b(r),D(a,r)}catch(s){console.error("Error loading map data:",s),x.error("Failed to load listening map")}finally{v(!1)}}},D=(e,s)=>{const t=[];e.forEach((e,a)=>{const r=Math.floor(a/5),l=a%5,n=160*(r%2==0?l:4-l)+50,i=150*r+20,o=s.find(s=>s.test_id===e.id)||{test_id:e.id,status:"locked"};t.push({test:e,progress:o,position:{x:n,y:i}})}),N(t)},O=e=>{r(`/skills/listening-for-details/test/${e.test.id}`)},R=e=>{switch(e){case"completed":return"bg-gradient-to-br from-yellow-400 to-orange-500 text-white shadow-lg border-yellow-300 hover:shadow-xl transform hover:scale-105";case"unlocked":return"bg-gradient-to-br from-orange-400 to-red-500 text-white shadow-lg border-orange-300 hover:shadow-xl transform hover:scale-105 cursor-pointer";default:return"bg-gray-200 text-gray-500 border-gray-300 cursor-not-allowed"}};return y?t.jsx("div",{className:"min-h-screen flex items-center justify-center",children:t.jsx(o,{size:"lg",message:"Loading your listening journey..."})}):e?t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 via-red-50 to-pink-50 p-6",children:t.jsxs("div",{className:"max-w-6xl mx-auto",children:[t.jsxs("div",{className:"text-center mb-4",children:[t.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:"Listening for Details Journey"}),t.jsx(c,{className:"max-w-md mx-auto bg-white/80 backdrop-blur-sm",children:t.jsxs(d,{className:"p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-medium",children:"Overall Progress"}),t.jsxs("span",{className:"text-sm text-gray-600",children:[j.filter(e=>"completed"===e.status).length," / ",l.length]})]}),t.jsx(h,{value:(()=>{const e=j.filter(e=>"completed"===e.status).length;return l.length>0?e/l.length*100:0})(),className:"h-3"})]})})]}),t.jsx(c,{className:"relative bg-white/60 backdrop-blur-sm border-2 border-white/80 shadow-xl",children:t.jsx(d,{className:"pt-4 pb-8 px-8",children:t.jsxs("div",{className:"relative mx-auto",style:{width:"900px",height:"700px",minHeight:"600px"},children:[(()=>{if(w.length<2)return null;let e=`M ${w[0].position.x+50} ${w[0].position.y+50}`;for(let s=1;s<w.length;s++){const t=w[s-1],a=w[s];e+=` Q ${(t.position.x+a.position.x)/2+50} ${(t.position.y+a.position.y)/2+50+30*Math.sin(.5*s)} ${a.position.x+50} ${a.position.y+50}`}return t.jsxs("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{zIndex:1},children:[t.jsx("path",{d:e,stroke:"url(#pathGradient)",strokeWidth:"4",fill:"none",strokeDasharray:"8,4",className:"animate-pulse"}),t.jsx("defs",{children:t.jsxs("linearGradient",{id:"pathGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"#F97316"}),t.jsx("stop",{offset:"50%",stopColor:"#EF4444"}),t.jsx("stop",{offset:"100%",stopColor:"#DC2626"})]})})]})})(),w.map((s,a)=>{return t.jsxs("div",{className:"absolute",style:{left:`${s.position.x}px`,top:`${s.position.y}px`,zIndex:10},children:["locked"===s.progress.status?t.jsxs(L,{children:[t.jsx(A,{asChild:!0,children:t.jsxs(p,{children:[t.jsx(g,{asChild:!0,children:t.jsxs("div",{className:`relative w-24 h-24 rounded-full border-4 flex items-center justify-center transition-all duration-300 ease-in-out ${R(s.progress.status)} hover:cursor-pointer`,onClick:()=>O(s),children:[t.jsx("img",{src:$(a).image,alt:`${$(a).name} level icon`,className:"absolute inset-0 w-full h-full rounded-full object-cover transform scale-90",loading:"lazy"}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 rounded-full",children:t.jsx(_,{className:"w-8 h-8 text-white"})})]})}),t.jsx(f,{side:"top",children:a>0?`Complete the ${$(a-1).name} Level to unlock! Or double-click to unlock manually.`:"This is the first level."})]})}),t.jsxs(z,{children:[t.jsxs(B,{children:[t.jsxs(F,{children:["Unlock ",$(a).name," Level?"]}),t.jsxs(I,{children:["Do you want to unlock this level? This will allow you to start the ",$(a).name," listening test."]})]}),t.jsxs(M,{children:[t.jsx(T,{children:"Cancel"}),t.jsx(q,{onClick:()=>(async s=>{if(e)try{await m.from("user_test_progress").upsert({user_id:e.id,test_id:s.test.id,status:"unlocked"},{onConflict:"user_id,test_id"}),x.success(`${$(w.indexOf(s)).name} Level unlocked!`),E()}catch(t){console.error("Error unlocking level:",t),x.error("Failed to unlock level")}})(s),children:"Yes, Unlock Level"})]})]})]}):t.jsxs("div",{className:`relative w-24 h-24 rounded-full border-4 flex items-center justify-center transition-all duration-300 ease-in-out ${R(s.progress.status)}`,onClick:()=>O(s),children:[t.jsx("img",{src:$(a).image,alt:`${$(a).name} level icon`,className:"absolute inset-0 w-full h-full rounded-full object-cover transform scale-90",loading:"lazy"}),"unlocked"===s.progress.status&&t.jsx("div",{className:"absolute bottom-1 right-1",children:t.jsx(C,{className:"w-4 h-4 text-orange-500"})}),"completed"===s.progress.status&&s.progress.completed_score&&t.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2",children:(l=s.progress.completed_score,r=l>=90?3:l>=70?2:1,t.jsx("div",{className:"flex items-center justify-center",children:[1,2,3].map(e=>t.jsx(P,{className:"w-6 h-6 "+(e<=r?"text-yellow-400 fill-current":"text-gray-300"),style:{transform:`rotate(${15*(e-2)}deg) translateY(${2===e?"0px":"4px"})`,margin:"0 2px"}},e))}))})]}),t.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 w-32 text-center",children:t.jsxs("p",{className:"text-[10px] font-medium text-muted-foreground truncate",children:[$(a).name," Level"]})})]},s.test.id);var r,l})]})})}),t.jsx("div",{className:"text-center mt-8 space-x-4",children:t.jsxs(n,{variant:"outline",onClick:()=>r("/ielts-portal"),className:"bg-white/80 backdrop-blur-sm hover:bg-white",children:[t.jsx(S,{className:"w-4 h-4 mr-2 rotate-180"}),"Back to IELTS Portal"]})})]})}):t.jsx("div",{className:"min-h-screen flex items-center justify-center",children:t.jsx(c,{className:"p-8 text-center",children:t.jsxs(d,{children:[t.jsx("p",{className:"text-lg mb-4",children:"Please sign in to access your listening journey."}),t.jsx(n,{onClick:()=>r("/auth"),className:"bg-primary text-primary-foreground hover:bg-primary/90",children:"Sign In"})]})})})},G=()=>{const{user:e}=u(),r=a(),[l,i]=s.useState([]),[o,h]=s.useState(!0);s.useEffect(()=>{e?p():h(!1)},[e]);const p=async()=>{if(e){h(!0);try{const e=await m.from("skill_tests").select("id, title, test_order").eq("skill_slug","synonym-match").order("test_order",{ascending:!0});if(e.error)throw e.error;i(e.data||[])}catch(s){console.error("Error loading map data:",s),x.error("Failed to load synonym match data")}finally{h(!1)}}};return o?t.jsx("div",{className:"min-h-screen flex items-center justify-center",children:t.jsx(c,{className:"p-8 text-center",children:t.jsxs(d,{children:[t.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4"}),t.jsx("p",{className:"text-lg",children:"Loading synonym match..."})]})})}):e?t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-teal-50 via-emerald-50 to-green-50 p-6",children:t.jsxs("div",{className:"max-w-6xl mx-auto",children:[t.jsxs("div",{className:"text-center mb-8",children:[t.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:"Synonym Match Journey"}),t.jsx("p",{className:"text-muted-foreground",children:"Coming soon! This skill is under development."})]}),t.jsx(c,{className:"bg-white/60 backdrop-blur-sm border-2 border-white/80 shadow-xl",children:t.jsx(d,{className:"p-8 text-center",children:t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"w-32 h-32 mx-auto bg-gradient-to-br from-teal-400 to-emerald-500 rounded-full flex items-center justify-center",children:t.jsx("div",{className:"text-4xl",children:"ðŸ”„"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Under Construction"}),t.jsx("p",{className:"text-muted-foreground mb-4",children:"We're working hard to bring you an amazing Synonym Match experience!"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"This feature will help you master synonyms and expand your vocabulary."})]})]})})}),t.jsx("div",{className:"text-center mt-8",children:t.jsx(n,{variant:"outline",onClick:()=>r("/ielts-portal"),className:"bg-white/80 backdrop-blur-sm hover:bg-white",children:"Back to IELTS Portal"})})]})}):t.jsx("div",{className:"min-h-screen flex items-center justify-center",children:t.jsx(c,{className:"p-8 text-center",children:t.jsxs(d,{children:[t.jsx("p",{className:"text-lg mb-4",children:"Please sign in to access synonym match."}),t.jsx(n,{onClick:()=>r("/auth"),className:"bg-primary text-primary-foreground hover:bg-primary/90",children:"Sign In"})]})})})},U=()=>{const{user:e}=u(),r=a(),[l,i]=s.useState([]),[h,p]=s.useState(!0);s.useEffect(()=>{e?g():p(!1)},[e]);const g=async()=>{if(e){p(!0);try{const e=await m.from("skill_tests").select("id, title, test_order").eq("skill_slug","collocation-connect").order("test_order",{ascending:!0});if(e.error)throw e.error;i(e.data||[])}catch(s){console.error("Error loading map data:",s),x.error("Failed to load collocation connect data")}finally{p(!1)}}};return h?t.jsx("div",{className:"min-h-screen flex items-center justify-center",children:t.jsx(o,{size:"lg",message:"Loading collocation connect..."})}):e?t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 via-yellow-50 to-orange-50 p-6",children:t.jsxs("div",{className:"max-w-6xl mx-auto",children:[t.jsxs("div",{className:"text-center mb-8",children:[t.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:"Collocation Connect Journey"}),t.jsx("p",{className:"text-muted-foreground",children:"Coming soon! This skill is under development."})]}),t.jsx(c,{className:"bg-white/60 backdrop-blur-sm border-2 border-white/80 shadow-xl",children:t.jsx(d,{className:"p-8 text-center",children:t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"w-32 h-32 mx-auto bg-gradient-to-br from-amber-400 to-orange-500 rounded-full flex items-center justify-center",children:t.jsx("div",{className:"text-4xl",children:"ðŸ”—"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Under Construction"}),t.jsx("p",{className:"text-muted-foreground mb-4",children:"We're working hard to bring you an amazing Collocation Connect experience!"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"This feature will help you master word collocations and natural language patterns."})]})]})})}),t.jsx("div",{className:"text-center mt-8",children:t.jsx(n,{variant:"outline",onClick:()=>r("/ielts-portal"),className:"bg-white/80 backdrop-blur-sm hover:bg-white",children:"Back to IELTS Portal"})})]})}):t.jsx("div",{className:"min-h-screen flex items-center justify-center",children:t.jsx(c,{className:"p-8 text-center",children:t.jsxs(d,{children:[t.jsx("p",{className:"text-lg mb-4",children:"Please sign in to access collocation connect."}),t.jsx(n,{onClick:()=>r("/auth"),className:"bg-primary text-primary-foreground hover:bg-primary/90",children:"Sign In"})]})})})},K=()=>{const{slug:l}=r(),i=a(),o=s.useMemo(()=>l?N(l):void 0,[l]),[m,u]=s.useState([]),[x,p]=s.useState([]),[g,f]=s.useState([]),[k,_]=s.useState([]),[C,S]=s.useState(""),[P,L]=s.useState(""),[A,z]=s.useState(0),[B,F]=s.useState(!1),[I,M]=s.useState(!1),[T,q]=s.useState(null),[K,J]=s.useState(""),[V,W]=s.useState(null),[Q,Z]=s.useState(!1),[X,ee]=s.useState(!0),[se,te]=s.useState(null);s.useEffect(()=>{o&&(document.title=`${o.label} | Practice`,"vocabulary-builder"===l||"grammar-fix-it"===l||"paraphrasing-challenge"===l||"sentence-structure-scramble"===l||"listening-for-details"===l?re():"pronunciation-repeat-after-me"===l?le():ae())},[null==o?void 0:o.label]),s.useEffect(()=>{const s=(async()=>{if(!o)return;const{supabase:s}=await e(async()=>{const{supabase:e}=await import("./index-DXpPY1B7.js").then(e=>e.aa);return{supabase:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])),t=s.channel("realtime-skill-questions").on("postgres_changes",{event:"*",schema:"public",table:"skill_practice_questions"},e=>{var s,t;((null==(s=null==e?void 0:e.new)?void 0:s.skill_type)??(null==(t=null==e?void 0:e.old)?void 0:t.skill_type))===o.label&&("vocabulary-builder"===l||"grammar-fix-it"===l||"paraphrasing-challenge"===l||"sentence-structure-scramble"===l?re():ae())}).subscribe();return()=>{s.removeChannel(t)}})();return()=>{s.then(e=>null==e?void 0:e())}},[null==o?void 0:o.label]);const ae=async()=>{if(!o)return;const{supabase:s}=await e(async()=>{const{supabase:e}=await import("./index-DXpPY1B7.js").then(e=>e.aa);return{supabase:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])),{data:t,error:a}=await s.from("skill_practice_questions").select("id, content").eq("skill_type",o.label).order("created_at",{ascending:!1});a||u(t??[])},re=async()=>{if(!l)return;const{supabase:s}=await e(async()=>{const{supabase:e}=await import("./index-DXpPY1B7.js").then(e=>e.aa);return{supabase:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])),{data:t,error:a}=await s.from("skill_tests").select("id,title").eq("skill_slug",l).order("created_at",{ascending:!1});a||p(t??[])},le=async()=>{const{supabase:s}=await e(async()=>{const{supabase:e}=await import("./index-DXpPY1B7.js").then(e=>e.aa);return{supabase:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])),{data:t,error:a}=await s.from("pronunciation_tests").select("id,title").eq("is_published",!0).order("created_at",{ascending:!1});!a&&t&&f(t)},ne=async s=>{W(s),Z(!1),se&&await(async s=>{const{supabase:t}=await e(async()=>{const{supabase:e}=await import("./index-DXpPY1B7.js").then(e=>e.aa);return{supabase:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])),{data:a,error:r}=await t.from("pronunciation_items").select("id, reference_text, audio_url_uk, audio_url_us, order_index").eq("test_id",s).order("order_index",{ascending:!0});!r&&a&&(_(a),z(0),M(!1),F(!1))})(se.id)},ie=()=>{W(null),te(null),_([]),z(0),M(!1),F(!1),q(null),J(""),ee(!0)};if(s.useEffect(()=>{(async()=>{var s,t,a;if(!I||!P)return;const{supabase:r}=await e(async()=>{const{supabase:e}=await import("./index-DXpPY1B7.js").then(e=>e.aa);return{supabase:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])),{data:l}=await r.auth.getUser(),n=null==(s=null==l?void 0:l.user)?void 0:s.id;if(!n)return;const{data:i,error:o}=await r.from("pronunciation_results").select("overall_score, analysis_json, created_at").eq("user_id",n).eq("test_id",P).order("created_at",{ascending:!1}).limit(10);if(o)return;const c=i??[],d=c.map(e=>e.overall_score).filter(e=>"number"==typeof e);d.length?q(Math.round(d.reduce((e,s)=>e+s,0)/d.length)):q(null);const m=null==(a=null==(t=c[0])?void 0:t.analysis_json)?void 0:a.overallSummary;J("string"==typeof m?m:"")})()},[I,P]),"pronunciation-repeat-after-me"===l){const e=Math.min(10,k.length||10),s=e?A/e*100:0,a=k.slice(0,10)[A];return X?t.jsxs(j,{title:"PTE Repeat Sentence",showBackButton:!0,backPath:"/ielts-portal",children:[t.jsx("section",{className:"mx-auto px-4 max-w-4xl",children:t.jsxs("div",{className:"min-h-[60vh] flex flex-col items-center justify-center gap-6",children:[t.jsxs("div",{className:"text-center space-y-2",children:[t.jsx("h1",{className:"text-2xl font-bold",children:"Repeat Sentence Practice"}),t.jsx("p",{className:"text-muted-foreground",children:"Listen to the audio and repeat exactly what you hear. Choose a test to begin."})]}),0===g.length?t.jsx(c,{className:"w-full max-w-md",children:t.jsx(d,{className:"p-6 text-center",children:t.jsx("p",{className:"text-muted-foreground",children:"No tests available yet. Please check back soon."})})}):t.jsx("div",{className:"grid gap-4 w-full max-w-2xl",children:g.map((e,s)=>t.jsx(c,{className:"cursor-pointer hover:shadow-lg transition-all duration-200 hover:scale-[1.02]",onClick:()=>(e=>{te(e),S(e.title),L(e.id),ee(!1),Z(!0)})(e),children:t.jsxs(d,{className:"p-6 flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold",children:e.title}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"10 sentences â€¢ PTE difficulty"})]}),t.jsx(n,{variant:"outline",size:"sm",children:"Start"})]})},e.id))})]})}),t.jsx(b,{open:Q,onOpenChange:e=>{e||(Z(!1),ee(!0))},children:t.jsxs(y,{className:"sm:max-w-md",children:[t.jsx(v,{children:t.jsx(w,{className:"text-center text-xl",children:"Choose Your Accent"})}),t.jsx("p",{className:"text-center text-muted-foreground text-sm mb-4",children:"Select the accent you want to practice with"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs(n,{variant:"outline",className:"h-24 flex flex-col items-center justify-center gap-2 hover:border-primary hover:bg-primary/5",onClick:()=>ne("uk"),children:[t.jsx("span",{className:"text-3xl",children:"ðŸ‡¬ðŸ‡§"}),t.jsx("span",{className:"font-medium",children:"British"})]}),t.jsxs(n,{variant:"outline",className:"h-24 flex flex-col items-center justify-center gap-2 hover:border-primary hover:bg-primary/5",onClick:()=>ne("us"),children:[t.jsx("span",{className:"text-3xl",children:"ðŸ‡ºðŸ‡¸"}),t.jsx("span",{className:"font-medium",children:"American"})]})]})]})})]}):t.jsx(j,{title:(null==o?void 0:o.label)||"Pronunciation",showBackButton:!0,backPath:"/ielts-portal",children:t.jsx("section",{className:"mx-auto px-4",children:t.jsxs("div",{className:"min-h-[70vh] flex flex-col items-center justify-center gap-4",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[t.jsxs("span",{children:["uk"===V?"ðŸ‡¬ðŸ‡§ British":"ðŸ‡ºðŸ‡¸ American"," Accent"]}),t.jsx(n,{variant:"ghost",size:"sm",onClick:ie,children:"Change"})]}),t.jsx("div",{className:"w-full max-w-3xl md:max-w-4xl lg:max-w-5xl",children:t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute -top-10 h-10 flex items-center justify-center -translate-x-1/2 transition-[left] duration-300 ease-out",style:{left:`${s}%`},"aria-label":"Progress mascot",title:"Keep going!",children:t.jsx("img",{src:"/lovable-uploads/27e74cd0-58d8-4b55-b31a-fdb162f21e8b.png",alt:"Pronunciation progress turtle mascot",className:"w-12 h-12 object-contain drop-shadow animate-[turtle-legs_900ms_ease-in-out_infinite]",loading:"lazy"})}),t.jsx("style",{children:"@keyframes turtle-legs { 0% { transform: translateY(0) rotate(0deg) } 25% { transform: translateY(-1px) rotate(-2deg) } 50% { transform: translateY(0) rotate(0deg) } 75% { transform: translateY(-1px) rotate(2deg) } 100% { transform: translateY(0) rotate(0deg) } }"}),t.jsx(h,{value:s})]})}),0===k.length?t.jsx(c,{className:"border-light-border",children:t.jsx(d,{className:"p-4",children:t.jsx("p",{className:"text-muted-foreground text-sm",children:"Loading sentences..."})})}):I?t.jsx(c,{className:"w-full max-w-3xl md:max-w-4xl lg:max-w-5xl",children:t.jsxs(d,{className:"p-6 space-y-6",children:[t.jsx("div",{className:"flex justify-center",children:t.jsx($,{})}),t.jsxs("div",{className:"space-y-2 text-center",children:[t.jsx("div",{className:"text-2xl font-semibold",children:"Great job!"}),t.jsxs("div",{className:"text-muted-foreground",children:["You completed ",C||"this set","."]})]}),t.jsxs("div",{className:"text-center space-y-1 animate-fade-in",children:[t.jsx("p",{className:"text-xs font-medium",children:"Overall Pronunciation Score"}),t.jsxs("p",{className:"text-4xl font-bold text-primary",children:[T??"-"," / 100"]}),K&&t.jsx("p",{className:"text-sm text-muted-foreground max-w-2xl mx-auto",children:K})]}),t.jsxs("div",{className:"flex gap-2 justify-center",children:[t.jsx(n,{onClick:()=>{z(0),M(!1),F(!1),q(null),J("")},children:"Retry"}),t.jsx(n,{variant:"secondary",onClick:ie,children:"Choose Another Test"}),t.jsx(n,{variant:"outline",onClick:()=>i("/ielts-portal"),children:"Back to Portal"})]})]})}):a?t.jsx(c,{className:"w-full max-w-3xl md:max-w-4xl lg:max-w-5xl border-light-border",children:t.jsxs(d,{className:"p-6 space-y-4",children:[C&&t.jsxs("div",{className:"text-sm text-muted-foreground",children:[C," â€” Sentence ",A+1," of ",e]}),t.jsx(D,{item:{...a,order_index:A+1,audio_url:"uk"===V?a.audio_url_uk:a.audio_url_us},testId:P,selectedAccent:V||"us",onAnalyzed:()=>F(!0)}),t.jsx("div",{className:"pt-2",children:t.jsx(n,{onClick:()=>{A+1>=e?M(!0):(z(e=>e+1),F(!1))},disabled:!B,children:"Continue"})})]})}):t.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading..."})]})})})}return"vocabulary-builder"===l?t.jsx(E,{}):"grammar-fix-it"===l?t.jsx(O,{}):"paraphrasing-challenge"===l?t.jsx(R,{}):"sentence-structure-scramble"===l?t.jsx(Y,{}):"listening-for-details"===l?t.jsx(H,{}):"synonym-match"===l?t.jsx(G,{}):"collocation-connect"===l?t.jsx(U,{}):"sentence-mastery"===l?(window.location.href="/ai-speaking",t.jsx(j,{title:"AI Speaking Tutor",showBackButton:!0,backPath:"/ielts-portal",children:t.jsx("section",{className:"space-y-4 max-w-3xl mx-auto",children:t.jsx("p",{className:"text-muted-foreground text-sm",children:"Redirecting to AI Speaking Tutor..."})})})):t.jsx(j,{title:(null==o?void 0:o.label)||"Practice",showBackButton:!0,backPath:"/ielts-portal",children:t.jsx("section",{className:"space-y-4 max-w-3xl mx-auto",children:0===m.length?t.jsx("p",{className:"text-muted-foreground text-sm",children:"No questions yet. Please check back soon."}):m.map(e=>t.jsx(c,{className:"border-light-border",children:t.jsx(d,{className:"p-4",children:t.jsx("p",{className:"whitespace-pre-wrap leading-relaxed",children:e.content})})},e.id))})})};export{K as default};
