import{s as e,_ as s}from"./supabase-DUkWVuqu.js";import{g as t,r as a,j as r,B as l,bZ as n,bs as i,C as o,a as c,A as d,u as m,J as u,Y as x,bg as h,bh as p,bi as g,ai as f,bU as j,a1 as b,ar as y,_ as v}from"./index-BEYDIuQu.js";import{g as w}from"./skills-NqzSOyzV.js";import{P as N}from"./PenguinClapAnimation-Bo6MHKUG.js";import k from"./VocabularyMapView-CVoFNBx0.js";import{A as _,a as C,b as S,c as $,d as P,e as E,f as L,g as z,h as I}from"./alert-dialog-Om5GdVpj.js";import{C as M}from"./circle-help-gkpOy2Ql.js";const q=({item:s,testId:d,onAnalyzed:m})=>{const{toast:u}=t(),[x,h]=a.useState(null),[p,g]=a.useState(!1),[f,j]=a.useState(""),[b,y]=a.useState(""),[v,w]=a.useState(null),[N,k]=a.useState(""),_=a.useRef(null),[C,S]=a.useState(!1),[$,P]=a.useState(!1);a.useEffect(()=>{try{_.current&&(_.current.pause(),_.current=null);const e=new Audio(s.audio_url);e.preload="auto",e.playsInline=!0,_.current=e,$||e.play().then(()=>{S(!1),P(!0)}).catch(()=>S(!0))}catch(e){S(!0)}return()=>{var e;try{null==(e=_.current)||e.pause()}catch{}}},[s.audio_url,$]),a.useEffect(()=>{h(null),g(!1),j(""),y(""),w(null),k(""),S(!1),P(!1)},[s.id]);return r.jsxs("div",{className:"space-y-2",children:[r.jsx("div",{className:"flex justify-center",children:r.jsx(l,{size:"sm",variant:"outline",onClick:async()=>{var e;try{await(null==(e=_.current)?void 0:e.play()),S(!1)}catch(s){S(!0)}},children:C?"Play sample":"Replay sample"})}),r.jsxs("div",{className:"space-y-4 w-full max-w-xl mx-auto",children:[r.jsx("div",{className:"flex justify-center",children:r.jsx(n,{onRecordingComplete:e=>{h(e),j(""),y(""),w(null),k("")},autoFocus:!0},s.id)}),r.jsx("div",{className:"flex justify-center",children:r.jsx(l,{onClick:async()=>{var t,a,r;try{if(!x)return void u({title:"No recording",description:"Please record your voice first.",variant:"destructive"});const{data:l}=await e.auth.getUser(),n=null==(t=null==l?void 0:l.user)?void 0:t.id;if(!n)return void u({title:"Sign in required",description:"Please log in to save and analyze your recording.",variant:"destructive"});g(!0);const i=`user-recordings/pronunciation/${d}/${s.id}/${Date.now()}.webm`;console.log("Pronunciation upload disabled - implement R2 upload");const o=`https://your-bucket.your-domain.com/${i}`;k(o);const c=await(r=x,new Promise((e,s)=>{const t=new FileReader;t.onloadend=()=>{const s=t.result.split(",")[1];e(s)},t.onerror=s,t.readAsDataURL(r)})),{data:h,error:p}=await e.functions.invoke("pronunciation-analysis",{body:{audio:c,referenceText:s.reference_text,accent:s.accent||"american"}});if(p)throw p;const f=(null==h?void 0:h.transcription)??"",b=(null==h?void 0:h.analysis)??"";j(f),y(b);try{w((null==h?void 0:h.analysis_json)??JSON.parse(b))}catch{w(null)}const v=(null==(a=null==h?void 0:h.analysis_json)?void 0:a.overallScore)??null,{error:N}=await e.from("pronunciation_results").insert({user_id:n,test_id:d,item_id:s.id,audio_url:o,analysis_json:(null==h?void 0:h.analysis_json)??{transcription:f,analysis:b},overall_score:v});if(N)throw N;u({title:"Analysis complete",description:"Your feedback is ready."}),null==m||m({transcription:f,analysis:b,audioUrl:o})}catch(l){console.error(l),u({title:"Analysis failed",description:l.message,variant:"destructive"})}finally{g(!1)}},disabled:p||!x,children:p?"Analyzing...":"Get Analysis"})}),p&&r.jsx("div",{className:"flex justify-center animate-fade-in",children:r.jsx(i,{size:"md",message:"Analyzing pronunciation..."})})]}),v&&r.jsx(o,{className:"border-light-border w-full max-w-xl mx-auto",children:r.jsxs(c,{className:"p-6 space-y-4",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-xs font-medium",children:"Overall Score"}),r.jsxs("p",{className:"text-3xl font-semibold text-primary",children:[(null==v?void 0:v.overallScore)??"-"," / 100"]}),(null==v?void 0:v.overallSummary)&&r.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:v.overallSummary})]}),Array.isArray(null==v?void 0:v.wordAnalysis)&&v.wordAnalysis.length>0&&r.jsxs("div",{children:[r.jsx("p",{className:"text-xs font-medium mb-2",children:"Word Analysis"}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:v.wordAnalysis.slice(0,8).map((e,s)=>r.jsxs("div",{className:"rounded-md border border-light-border p-2 text-sm",children:[r.jsxs("div",{className:"font-medium",children:[e.word,r.jsx("span",{className:"ml-2 text-xs text-muted-foreground",children:e.status})]}),e.feedback&&r.jsx("div",{className:"text-xs text-muted-foreground",children:e.feedback})]},s))})]}),Array.isArray(null==v?void 0:v.detailedFeedback)&&v.detailedFeedback.length>0&&r.jsxs("div",{className:"space-y-3",children:[r.jsx("p",{className:"text-xs font-medium",children:"Detailed Feedback"}),v.detailedFeedback.map((e,s)=>r.jsxs("div",{className:"rounded-md border border-light-border p-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("p",{className:"text-sm font-medium",children:e.area}),"number"==typeof e.score&&r.jsxs("span",{className:"text-xs text-muted-foreground",children:[e.score,"/100"]})]}),e.positive&&r.jsxs("p",{className:"text-sm mt-1",children:["+ ",e.positive]}),e.improvement&&r.jsxs("p",{className:"text-sm mt-1",children:["â†’ ",e.improvement]})]},s))]})]})})]})},F=()=>{const{user:s}=d(),t=m(),[n,y]=a.useState([]),[v,w]=a.useState([]),[N,k]=a.useState(!0),[q,F]=a.useState([]),B=[{name:"Mouse",image:"/moouse emoji.png"},{name:"Hamster",image:"/Hamster.png"},{name:"Chick",image:"/chick.png"},{name:"Rabbit",image:"/rabbit.png"},{name:"Kitten",image:"/cat.png"},{name:"Puppy",image:"/puppy.png"},{name:"Duck",image:"/duck.png"},{name:"Hedgehog",image:"/hedgehog.png"},{name:"Squirrel",image:"/squerrel.png"},{name:"Penguin",image:"/Penguine.png"},{name:"Otter",image:"/otter.png"},{name:"Koala",image:"/koala.png"},{name:"Piglet",image:"/piglet.png"},{name:"Monkey",image:"/Monkey.png"},{name:"Fox",image:"/fox.png"},{name:"Deer",image:"/dear.png"},{name:"Seal",image:"/seal.png"},{name:"Panda",image:"/panda.png"},{name:"Bear",image:"/bear.png"},{name:"Polar Bear",image:"/polar bear.png"}],A=e=>e<B.length?B[e]:B[B.length-1];a.useEffect(()=>{s?D():k(!1)},[s]),a.useEffect(()=>{const e=()=>{s&&D()};return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[s]);const D=async()=>{if(s){k(!0);try{const[t,a]=await Promise.all([e.from("skill_tests").select("id, title, test_order").eq("skill_slug","grammar-fix-it").order("test_order",{ascending:!0}),e.from("user_test_progress").select("test_id, status, completed_score").eq("user_id",s.id)]);if(t.error)throw t.error;if(a.error)throw a.error;const r=t.data||[];let l=a.data||[];const n=r.map(e=>e.id);if(l=l.filter(e=>n.includes(e.test_id)),r.length>0&&0===l.length){const t=r.find(e=>1===e.test_order)||r[0];if(t){const a={user_id:s.id,test_id:t.id,status:"unlocked"};await e.from("user_test_progress").insert(a),l=[{test_id:t.id,status:"unlocked",completed_score:null}]}}y(r),w(l),T(r,l)}catch(t){console.error("Error loading map data:",t),u.error("Failed to load grammar map")}finally{k(!1)}}},T=(e,s)=>{const t=[];e.forEach((e,a)=>{const r=Math.floor(a/5),l=a%5,n=160*(r%2==0?l:4-l)+50,i=150*r+20,o=s.find(s=>s.test_id===e.id)||{test_id:e.id,status:"locked"};t.push({test:e,progress:o,position:{x:n,y:i}})}),F(t)},O=e=>{t(`/skills/grammar-fix-it/test/${e.test.id}`)},R=e=>{switch(e){case"completed":return"bg-gradient-to-br from-yellow-400 to-orange-500 text-white shadow-lg border-yellow-300 hover:shadow-xl transform hover:scale-105";case"unlocked":return"bg-gradient-to-br from-green-400 to-blue-500 text-white shadow-lg border-green-300 hover:shadow-xl transform hover:scale-105 cursor-pointer";default:return"bg-gray-200 text-gray-500 border-gray-300 cursor-not-allowed"}};return N?r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx(i,{size:"lg",message:"Loading your grammar journey..."})}):s?r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-blue-50 to-purple-50 p-6",children:r.jsxs("div",{className:"max-w-6xl mx-auto",children:[r.jsxs("div",{className:"text-center mb-4",children:[r.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:"Grammar Fix-it Journey"}),r.jsx(o,{className:"max-w-md mx-auto bg-white/80 backdrop-blur-sm",children:r.jsxs(c,{className:"p-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-sm font-medium",children:"Overall Progress"}),r.jsxs("span",{className:"text-sm text-gray-600",children:[v.filter(e=>"completed"===e.status).length," / ",n.length]})]}),r.jsx(x,{value:(()=>{const e=v.filter(e=>"completed"===e.status).length;return n.length>0?e/n.length*100:0})(),className:"h-3"})]})})]}),r.jsx(o,{className:"relative bg-white/60 backdrop-blur-sm border-2 border-white/80 shadow-xl",children:r.jsx(c,{className:"pt-4 pb-8 px-8",children:r.jsxs("div",{className:"relative mx-auto",style:{width:"900px",height:"700px",minHeight:"600px"},children:[(()=>{if(q.length<2)return null;let e=`M ${q[0].position.x+50} ${q[0].position.y+50}`;for(let s=1;s<q.length;s++){const t=q[s-1],a=q[s];e+=` Q ${(t.position.x+a.position.x)/2+50} ${(t.position.y+a.position.y)/2+50+30*Math.sin(.5*s)} ${a.position.x+50} ${a.position.y+50}`}return r.jsxs("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{zIndex:1},children:[r.jsx("path",{d:e,stroke:"url(#pathGradient)",strokeWidth:"4",fill:"none",strokeDasharray:"8,4",className:"animate-pulse"}),r.jsx("defs",{children:r.jsxs("linearGradient",{id:"pathGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[r.jsx("stop",{offset:"0%",stopColor:"#3B82F6"}),r.jsx("stop",{offset:"50%",stopColor:"#8B5CF6"}),r.jsx("stop",{offset:"100%",stopColor:"#EC4899"})]})})]})})(),q.map((t,a)=>{return r.jsxs("div",{className:"absolute",style:{left:`${t.position.x}px`,top:`${t.position.y}px`,zIndex:10},children:["locked"===t.progress.status?r.jsxs(_,{children:[r.jsx(C,{asChild:!0,children:r.jsxs(h,{children:[r.jsx(p,{asChild:!0,children:r.jsxs("div",{className:`relative w-24 h-24 rounded-full border-4 flex items-center justify-center transition-all duration-300 ease-in-out ${R(t.progress.status)} hover:cursor-pointer`,onClick:()=>O(t),children:[r.jsx("img",{src:A(a).image,alt:`${A(a).name} level icon`,className:"absolute inset-0 w-full h-full rounded-full object-cover transform scale-90",loading:"lazy"}),r.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 rounded-full",children:r.jsx(M,{className:"w-8 h-8 text-white"})})]})}),r.jsx(g,{side:"top",children:a>0?`Complete the ${A(a-1).name} Level to unlock! Or double-click to unlock manually.`:"This is the first level."})]})}),r.jsxs(S,{children:[r.jsxs($,{children:[r.jsxs(P,{children:["Unlock ",A(a).name," Level?"]}),r.jsxs(E,{children:["Do you want to unlock this level? This will allow you to start the ",A(a).name," grammar test."]})]}),r.jsxs(L,{children:[r.jsx(z,{children:"Cancel"}),r.jsx(I,{onClick:()=>(async t=>{if(s)try{await e.from("user_test_progress").upsert({user_id:s.id,test_id:t.test.id,status:"unlocked"},{onConflict:"user_id,test_id"}),u.success(`${A(q.indexOf(t)).name} Level unlocked!`),D()}catch(a){console.error("Error unlocking level:",a),u.error("Failed to unlock level")}})(t),children:"Yes, Unlock Level"})]})]})]}):r.jsxs("div",{className:`relative w-24 h-24 rounded-full border-4 flex items-center justify-center transition-all duration-300 ease-in-out ${R(t.progress.status)}`,onClick:()=>O(t),children:[r.jsx("img",{src:A(a).image,alt:`${A(a).name} level icon`,className:"absolute inset-0 w-full h-full rounded-full object-cover transform scale-90",loading:"lazy"}),"unlocked"===t.progress.status&&r.jsx("div",{className:"absolute bottom-1 right-1",children:r.jsx(f,{className:"w-4 h-4 text-green-500"})}),"completed"===t.progress.status&&t.progress.completed_score&&r.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2",children:(n=t.progress.completed_score,l=n>=90?3:n>=70?2:1,r.jsx("div",{className:"flex items-center justify-center",children:[1,2,3].map(e=>r.jsx(b,{className:"w-6 h-6 "+(e<=l?"text-yellow-400 fill-current":"text-gray-300"),style:{transform:`rotate(${15*(e-2)}deg) translateY(${2===e?"0px":"4px"})`,margin:"0 2px"}},e))}))})]}),r.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 w-32 text-center",children:r.jsxs("p",{className:"text-[10px] font-medium text-muted-foreground truncate",children:[A(a).name," Level"]})})]},t.test.id);var l,n})]})})}),r.jsx("div",{className:"text-center mt-8 space-x-4",children:r.jsxs(l,{variant:"outline",onClick:()=>t("/ielts-portal"),className:"bg-white/80 backdrop-blur-sm hover:bg-white",children:[r.jsx(j,{className:"w-4 h-4 mr-2 rotate-180"}),"Back to IELTS Portal"]})})]})}):r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx(o,{className:"p-8 text-center",children:r.jsxs(c,{children:[r.jsx("p",{className:"text-lg mb-4",children:"Please sign in to access your grammar journey."}),r.jsx(l,{onClick:()=>t("/auth"),className:"bg-primary text-primary-foreground hover:bg-primary/90",children:"Sign In"})]})})})},B=()=>{const{user:s}=d(),t=m(),[n,y]=a.useState([]),[v,w]=a.useState([]),[N,k]=a.useState(!0),[q,F]=a.useState([]),B=[{name:"Mouse",image:"/moouse emoji.png"},{name:"Hamster",image:"/Hamster.png"},{name:"Chick",image:"/chick.png"},{name:"Rabbit",image:"/rabbit.png"},{name:"Kitten",image:"/cat.png"},{name:"Puppy",image:"/puppy.png"},{name:"Duck",image:"/duck.png"},{name:"Hedgehog",image:"/hedgehog.png"},{name:"Squirrel",image:"/squerrel.png"},{name:"Penguin",image:"/Penguine.png"},{name:"Otter",image:"/otter.png"},{name:"Koala",image:"/koala.png"},{name:"Piglet",image:"/piglet.png"},{name:"Monkey",image:"/Monkey.png"},{name:"Fox",image:"/fox.png"},{name:"Deer",image:"/dear.png"},{name:"Seal",image:"/seal.png"},{name:"Panda",image:"/panda.png"},{name:"Bear",image:"/bear.png"},{name:"Polar Bear",image:"/polar bear.png"}],A=e=>e<B.length?B[e]:B[B.length-1];a.useEffect(()=>{s?D():k(!1)},[s]),a.useEffect(()=>{const e=()=>{s&&D()};return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[s]);const D=async()=>{if(s){k(!0);try{const[t,a]=await Promise.all([e.from("skill_tests").select("id, title, test_order").eq("skill_slug","paraphrasing-challenge").order("test_order",{ascending:!0}),e.from("user_test_progress").select("test_id, status, completed_score").eq("user_id",s.id)]);if(t.error)throw t.error;if(a.error)throw a.error;const r=t.data||[];let l=a.data||[];const n=r.map(e=>e.id);if(l=l.filter(e=>n.includes(e.test_id)),r.length>0&&0===l.length){const t=r.find(e=>1===e.test_order)||r[0];if(t){const a={user_id:s.id,test_id:t.id,status:"unlocked"};await e.from("user_test_progress").insert(a),l=[{test_id:t.id,status:"unlocked",completed_score:null}]}}y(r),w(l),T(r,l)}catch(t){console.error("Error loading map data:",t),u.error("Failed to load paraphrasing map")}finally{k(!1)}}},T=(e,s)=>{const t=[];e.forEach((e,a)=>{const r=Math.floor(a/5),l=a%5,n=160*(r%2==0?l:4-l)+50,i=150*r+20,o=s.find(s=>s.test_id===e.id)||{test_id:e.id,status:"locked"};t.push({test:e,progress:o,position:{x:n,y:i}})}),F(t)},O=e=>{t(`/skills/paraphrasing-challenge/test/${e.test.id}`)},R=e=>{switch(e){case"completed":return"bg-gradient-to-br from-yellow-400 to-orange-500 text-white shadow-lg border-yellow-300 hover:shadow-xl transform hover:scale-105";case"unlocked":return"bg-gradient-to-br from-purple-400 to-pink-500 text-white shadow-lg border-purple-300 hover:shadow-xl transform hover:scale-105 cursor-pointer";default:return"bg-gray-200 text-gray-500 border-gray-300 cursor-not-allowed"}};return N?r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx(i,{size:"lg",message:"Loading your paraphrasing journey..."})}):s?r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-orange-50 p-6",children:r.jsxs("div",{className:"max-w-6xl mx-auto",children:[r.jsxs("div",{className:"text-center mb-4",children:[r.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:"Paraphrasing Challenge Journey"}),r.jsx(o,{className:"max-w-md mx-auto bg-white/80 backdrop-blur-sm",children:r.jsxs(c,{className:"p-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-sm font-medium",children:"Overall Progress"}),r.jsxs("span",{className:"text-sm text-gray-600",children:[v.filter(e=>"completed"===e.status).length," / ",n.length]})]}),r.jsx(x,{value:(()=>{const e=v.filter(e=>"completed"===e.status).length;return n.length>0?e/n.length*100:0})(),className:"h-3"})]})})]}),r.jsx(o,{className:"relative bg-white/60 backdrop-blur-sm border-2 border-white/80 shadow-xl",children:r.jsx(c,{className:"pt-4 pb-8 px-8",children:r.jsxs("div",{className:"relative mx-auto",style:{width:"900px",height:"700px",minHeight:"600px"},children:[(()=>{if(q.length<2)return null;let e=`M ${q[0].position.x+50} ${q[0].position.y+50}`;for(let s=1;s<q.length;s++){const t=q[s-1],a=q[s];e+=` Q ${(t.position.x+a.position.x)/2+50} ${(t.position.y+a.position.y)/2+50+30*Math.sin(.5*s)} ${a.position.x+50} ${a.position.y+50}`}return r.jsxs("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{zIndex:1},children:[r.jsx("path",{d:e,stroke:"url(#pathGradient)",strokeWidth:"4",fill:"none",strokeDasharray:"8,4",className:"animate-pulse"}),r.jsx("defs",{children:r.jsxs("linearGradient",{id:"pathGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[r.jsx("stop",{offset:"0%",stopColor:"#8B5CF6"}),r.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),r.jsx("stop",{offset:"100%",stopColor:"#F59E0B"})]})})]})})(),q.map((t,a)=>{return r.jsxs("div",{className:"absolute",style:{left:`${t.position.x}px`,top:`${t.position.y}px`,zIndex:10},children:["locked"===t.progress.status?r.jsxs(_,{children:[r.jsx(C,{asChild:!0,children:r.jsxs(h,{children:[r.jsx(p,{asChild:!0,children:r.jsxs("div",{className:`relative w-24 h-24 rounded-full border-4 flex items-center justify-center transition-all duration-300 ease-in-out ${R(t.progress.status)} hover:cursor-pointer`,onClick:()=>O(t),children:[r.jsx("img",{src:A(a).image,alt:`${A(a).name} level icon`,className:"absolute inset-0 w-full h-full rounded-full object-cover transform scale-90",loading:"lazy"}),r.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 rounded-full",children:r.jsx(M,{className:"w-8 h-8 text-white"})})]})}),r.jsx(g,{side:"top",children:a>0?`Complete the ${A(a-1).name} Level to unlock! Or double-click to unlock manually.`:"This is the first level."})]})}),r.jsxs(S,{children:[r.jsxs($,{children:[r.jsxs(P,{children:["Unlock ",A(a).name," Level?"]}),r.jsxs(E,{children:["Do you want to unlock this level? This will allow you to start the ",A(a).name," paraphrasing challenge."]})]}),r.jsxs(L,{children:[r.jsx(z,{children:"Cancel"}),r.jsx(I,{onClick:()=>(async t=>{if(s)try{await e.from("user_test_progress").upsert({user_id:s.id,test_id:t.test.id,status:"unlocked"},{onConflict:"user_id,test_id"}),u.success(`${A(q.indexOf(t)).name} Level unlocked!`),D()}catch(a){console.error("Error unlocking level:",a),u.error("Failed to unlock level")}})(t),children:"Yes, Unlock Level"})]})]})]}):r.jsxs("div",{className:`relative w-24 h-24 rounded-full border-4 flex items-center justify-center transition-all duration-300 ease-in-out ${R(t.progress.status)}`,onClick:()=>O(t),children:[r.jsx("img",{src:A(a).image,alt:`${A(a).name} level icon`,className:"absolute inset-0 w-full h-full rounded-full object-cover transform scale-90",loading:"lazy"}),"unlocked"===t.progress.status&&r.jsx("div",{className:"absolute bottom-1 right-1",children:r.jsx(f,{className:"w-4 h-4 text-purple-500"})}),"completed"===t.progress.status&&t.progress.completed_score&&r.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2",children:(n=t.progress.completed_score,l=n>=90?3:n>=70?2:1,r.jsx("div",{className:"flex items-center justify-center",children:[1,2,3].map(e=>r.jsx(b,{className:"w-6 h-6 "+(e<=l?"text-yellow-400 fill-current":"text-gray-300"),style:{transform:`rotate(${15*(e-2)}deg) translateY(${2===e?"0px":"4px"})`,margin:"0 2px"}},e))}))})]}),r.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 w-32 text-center",children:r.jsxs("p",{className:"text-[10px] font-medium text-muted-foreground truncate",children:[A(a).name," Level"]})})]},t.test.id);var l,n})]})})}),r.jsx("div",{className:"text-center mt-8 space-x-4",children:r.jsxs(l,{variant:"outline",onClick:()=>t("/ielts-portal"),className:"bg-white/80 backdrop-blur-sm hover:bg-white",children:[r.jsx(j,{className:"w-4 h-4 mr-2 rotate-180"}),"Back to IELTS Portal"]})})]})}):r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx(o,{className:"p-8 text-center",children:r.jsxs(c,{children:[r.jsx("p",{className:"text-lg mb-4",children:"Please sign in to access your paraphrasing journey."}),r.jsx(l,{onClick:()=>t("/auth"),className:"bg-primary text-primary-foreground hover:bg-primary/90",children:"Sign In"})]})})})},A=()=>{const{user:s}=d(),t=m(),[n,y]=a.useState([]),[v,w]=a.useState([]),[N,k]=a.useState(!0),[q,F]=a.useState([]),B=[{name:"Mouse",image:"/moouse emoji.png"},{name:"Hamster",image:"/Hamster.png"},{name:"Chick",image:"/chick.png"},{name:"Rabbit",image:"/rabbit.png"},{name:"Kitten",image:"/cat.png"},{name:"Puppy",image:"/puppy.png"},{name:"Duck",image:"/duck.png"},{name:"Hedgehog",image:"/hedgehog.png"},{name:"Squirrel",image:"/squerrel.png"},{name:"Penguin",image:"/Penguine.png"},{name:"Otter",image:"/otter.png"},{name:"Koala",image:"/koala.png"},{name:"Piglet",image:"/piglet.png"},{name:"Monkey",image:"/Monkey.png"},{name:"Fox",image:"/fox.png"},{name:"Deer",image:"/dear.png"},{name:"Seal",image:"/seal.png"},{name:"Panda",image:"/panda.png"},{name:"Bear",image:"/bear.png"},{name:"Polar Bear",image:"/polar bear.png"}],A=e=>e<B.length?B[e]:B[B.length-1];a.useEffect(()=>{s?D():k(!1)},[s]),a.useEffect(()=>{const e=()=>{s&&D()};return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[s]);const D=async()=>{if(s){k(!0);try{const[t,a]=await Promise.all([e.from("skill_tests").select("id, title, test_order").eq("skill_slug","sentence-structure-scramble").order("test_order",{ascending:!0}),e.from("user_test_progress").select("test_id, status, completed_score").eq("user_id",s.id)]);if(t.error)throw t.error;if(a.error)throw a.error;const r=t.data||[];let l=a.data||[];const n=r.map(e=>e.id);if(l=l.filter(e=>n.includes(e.test_id)),r.length>0&&0===l.length){const t=r.find(e=>1===e.test_order)||r[0];if(t){const a={user_id:s.id,test_id:t.id,status:"unlocked"};await e.from("user_test_progress").insert(a),l=[{test_id:t.id,status:"unlocked",completed_score:null}]}}y(r),w(l),T(r,l)}catch(t){console.error("Error loading map data:",t),u.error("Failed to load sentence scramble map")}finally{k(!1)}}},T=(e,s)=>{const t=[];e.forEach((e,a)=>{const r=Math.floor(a/5),l=a%5,n=160*(r%2==0?l:4-l)+50,i=150*r+20,o=s.find(s=>s.test_id===e.id)||{test_id:e.id,status:"locked"};t.push({test:e,progress:o,position:{x:n,y:i}})}),F(t)},O=e=>{t(`/skills/sentence-structure-scramble/test/${e.test.id}`)},R=e=>{switch(e){case"completed":return"bg-gradient-to-br from-yellow-400 to-orange-500 text-white shadow-lg border-yellow-300 hover:shadow-xl transform hover:scale-105";case"unlocked":return"bg-gradient-to-br from-indigo-400 to-blue-500 text-white shadow-lg border-indigo-300 hover:shadow-xl transform hover:scale-105 cursor-pointer";default:return"bg-gray-200 text-gray-500 border-gray-300 cursor-not-allowed"}};return N?r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx(i,{size:"lg",message:"Loading your sentence scramble journey..."})}):s?r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-blue-50 to-cyan-50 p-6",children:r.jsxs("div",{className:"max-w-6xl mx-auto",children:[r.jsxs("div",{className:"text-center mb-4",children:[r.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:"Sentence Structure Scramble Journey"}),r.jsx(o,{className:"max-w-md mx-auto bg-white/80 backdrop-blur-sm",children:r.jsxs(c,{className:"p-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-sm font-medium",children:"Overall Progress"}),r.jsxs("span",{className:"text-sm text-gray-600",children:[v.filter(e=>"completed"===e.status).length," / ",n.length]})]}),r.jsx(x,{value:(()=>{const e=v.filter(e=>"completed"===e.status).length;return n.length>0?e/n.length*100:0})(),className:"h-3"})]})})]}),r.jsx(o,{className:"relative bg-white/60 backdrop-blur-sm border-2 border-white/80 shadow-xl",children:r.jsx(c,{className:"pt-4 pb-8 px-8",children:r.jsxs("div",{className:"relative mx-auto",style:{width:"900px",height:"700px",minHeight:"600px"},children:[(()=>{if(q.length<2)return null;let e=`M ${q[0].position.x+50} ${q[0].position.y+50}`;for(let s=1;s<q.length;s++){const t=q[s-1],a=q[s];e+=` Q ${(t.position.x+a.position.x)/2+50} ${(t.position.y+a.position.y)/2+50+30*Math.sin(.5*s)} ${a.position.x+50} ${a.position.y+50}`}return r.jsxs("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{zIndex:1},children:[r.jsx("path",{d:e,stroke:"url(#pathGradient)",strokeWidth:"4",fill:"none",strokeDasharray:"8,4",className:"animate-pulse"}),r.jsx("defs",{children:r.jsxs("linearGradient",{id:"pathGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[r.jsx("stop",{offset:"0%",stopColor:"#4F46E5"}),r.jsx("stop",{offset:"50%",stopColor:"#3B82F6"}),r.jsx("stop",{offset:"100%",stopColor:"#06B6D4"})]})})]})})(),q.map((t,a)=>{return r.jsxs("div",{className:"absolute",style:{left:`${t.position.x}px`,top:`${t.position.y}px`,zIndex:10},children:["locked"===t.progress.status?r.jsxs(_,{children:[r.jsx(C,{asChild:!0,children:r.jsxs(h,{children:[r.jsx(p,{asChild:!0,children:r.jsxs("div",{className:`relative w-24 h-24 rounded-full border-4 flex items-center justify-center transition-all duration-300 ease-in-out ${R(t.progress.status)} hover:cursor-pointer`,onClick:()=>O(t),children:[r.jsx("img",{src:A(a).image,alt:`${A(a).name} level icon`,className:"absolute inset-0 w-full h-full rounded-full object-cover transform scale-90",loading:"lazy"}),r.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 rounded-full",children:r.jsx(M,{className:"w-8 h-8 text-white"})})]})}),r.jsx(g,{side:"top",children:a>0?`Complete the ${A(a-1).name} Level to unlock! Or double-click to unlock manually.`:"This is the first level."})]})}),r.jsxs(S,{children:[r.jsxs($,{children:[r.jsxs(P,{children:["Unlock ",A(a).name," Level?"]}),r.jsxs(E,{children:["Do you want to unlock this level? This will allow you to start the ",A(a).name," sentence scramble challenge."]})]}),r.jsxs(L,{children:[r.jsx(z,{children:"Cancel"}),r.jsx(I,{onClick:()=>(async t=>{if(s)try{await e.from("user_test_progress").upsert({user_id:s.id,test_id:t.test.id,status:"unlocked"},{onConflict:"user_id,test_id"}),u.success(`${A(q.indexOf(t)).name} Level unlocked!`),D()}catch(a){console.error("Error unlocking level:",a),u.error("Failed to unlock level")}})(t),children:"Yes, Unlock Level"})]})]})]}):r.jsxs("div",{className:`relative w-24 h-24 rounded-full border-4 flex items-center justify-center transition-all duration-300 ease-in-out ${R(t.progress.status)}`,onClick:()=>O(t),children:[r.jsx("img",{src:A(a).image,alt:`${A(a).name} level icon`,className:"absolute inset-0 w-full h-full rounded-full object-cover transform scale-90",loading:"lazy"}),"unlocked"===t.progress.status&&r.jsx("div",{className:"absolute bottom-1 right-1",children:r.jsx(f,{className:"w-4 h-4 text-indigo-500"})}),"completed"===t.progress.status&&t.progress.completed_score&&r.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2",children:(n=t.progress.completed_score,l=n>=90?3:n>=70?2:1,r.jsx("div",{className:"flex items-center justify-center",children:[1,2,3].map(e=>r.jsx(b,{className:"w-6 h-6 "+(e<=l?"text-yellow-400 fill-current":"text-gray-300"),style:{transform:`rotate(${15*(e-2)}deg) translateY(${2===e?"0px":"4px"})`,margin:"0 2px"}},e))}))})]}),r.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 w-32 text-center",children:r.jsxs("p",{className:"text-[10px] font-medium text-muted-foreground truncate",children:[A(a).name," Level"]})})]},t.test.id);var l,n})]})})}),r.jsx("div",{className:"text-center mt-8 space-x-4",children:r.jsxs(l,{variant:"outline",onClick:()=>t("/ielts-portal"),className:"bg-white/80 backdrop-blur-sm hover:bg-white",children:[r.jsx(j,{className:"w-4 h-4 mr-2 rotate-180"}),"Back to IELTS Portal"]})})]})}):r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx(o,{className:"p-8 text-center",children:r.jsxs(c,{children:[r.jsx("p",{className:"text-lg mb-4",children:"Please sign in to access your sentence scramble journey."}),r.jsx(l,{onClick:()=>t("/auth"),className:"bg-primary text-primary-foreground hover:bg-primary/90",children:"Sign In"})]})})})},D=()=>{const{user:s}=d(),t=m(),[n,y]=a.useState([]),[v,w]=a.useState([]),[N,k]=a.useState(!0),[q,F]=a.useState([]),B=[{name:"Mouse",image:"/moouse emoji.png"},{name:"Hamster",image:"/Hamster.png"},{name:"Chick",image:"/chick.png"},{name:"Rabbit",image:"/rabbit.png"},{name:"Kitten",image:"/cat.png"},{name:"Puppy",image:"/puppy.png"},{name:"Duck",image:"/duck.png"},{name:"Hedgehog",image:"/hedgehog.png"},{name:"Squirrel",image:"/squerrel.png"},{name:"Penguin",image:"/Penguine.png"},{name:"Otter",image:"/otter.png"},{name:"Koala",image:"/koala.png"},{name:"Piglet",image:"/piglet.png"},{name:"Monkey",image:"/Monkey.png"},{name:"Fox",image:"/fox.png"},{name:"Deer",image:"/dear.png"},{name:"Seal",image:"/seal.png"},{name:"Panda",image:"/panda.png"},{name:"Bear",image:"/bear.png"},{name:"Polar Bear",image:"/polar bear.png"}],A=e=>e<B.length?B[e]:B[B.length-1];a.useEffect(()=>{s?D():k(!1)},[s]),a.useEffect(()=>{const e=()=>{s&&D()};return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[s]);const D=async()=>{if(s){k(!0);try{const[t,a]=await Promise.all([e.from("skill_tests").select("id, title, test_order").eq("skill_slug","listening-for-details").order("test_order",{ascending:!0}),e.from("user_test_progress").select("test_id, status, completed_score").eq("user_id",s.id)]);if(t.error)throw t.error;if(a.error)throw a.error;const r=t.data||[];let l=a.data||[];const n=r.map(e=>e.id);if(l=l.filter(e=>n.includes(e.test_id)),r.length>0&&0===l.length){const t=r.find(e=>1===e.test_order)||r[0];if(t){const a={user_id:s.id,test_id:t.id,status:"unlocked"};await e.from("user_test_progress").insert(a),l=[{test_id:t.id,status:"unlocked",completed_score:null}]}}y(r),w(l),T(r,l)}catch(t){console.error("Error loading map data:",t),u.error("Failed to load listening map")}finally{k(!1)}}},T=(e,s)=>{const t=[];e.forEach((e,a)=>{const r=Math.floor(a/5),l=a%5,n=160*(r%2==0?l:4-l)+50,i=150*r+20,o=s.find(s=>s.test_id===e.id)||{test_id:e.id,status:"locked"};t.push({test:e,progress:o,position:{x:n,y:i}})}),F(t)},O=e=>{t(`/skills/listening-for-details/test/${e.test.id}`)},R=e=>{switch(e){case"completed":return"bg-gradient-to-br from-yellow-400 to-orange-500 text-white shadow-lg border-yellow-300 hover:shadow-xl transform hover:scale-105";case"unlocked":return"bg-gradient-to-br from-orange-400 to-red-500 text-white shadow-lg border-orange-300 hover:shadow-xl transform hover:scale-105 cursor-pointer";default:return"bg-gray-200 text-gray-500 border-gray-300 cursor-not-allowed"}};return N?r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx(i,{size:"lg",message:"Loading your listening journey..."})}):s?r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 via-red-50 to-pink-50 p-6",children:r.jsxs("div",{className:"max-w-6xl mx-auto",children:[r.jsxs("div",{className:"text-center mb-4",children:[r.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:"Listening for Details Journey"}),r.jsx(o,{className:"max-w-md mx-auto bg-white/80 backdrop-blur-sm",children:r.jsxs(c,{className:"p-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-sm font-medium",children:"Overall Progress"}),r.jsxs("span",{className:"text-sm text-gray-600",children:[v.filter(e=>"completed"===e.status).length," / ",n.length]})]}),r.jsx(x,{value:(()=>{const e=v.filter(e=>"completed"===e.status).length;return n.length>0?e/n.length*100:0})(),className:"h-3"})]})})]}),r.jsx(o,{className:"relative bg-white/60 backdrop-blur-sm border-2 border-white/80 shadow-xl",children:r.jsx(c,{className:"pt-4 pb-8 px-8",children:r.jsxs("div",{className:"relative mx-auto",style:{width:"900px",height:"700px",minHeight:"600px"},children:[(()=>{if(q.length<2)return null;let e=`M ${q[0].position.x+50} ${q[0].position.y+50}`;for(let s=1;s<q.length;s++){const t=q[s-1],a=q[s];e+=` Q ${(t.position.x+a.position.x)/2+50} ${(t.position.y+a.position.y)/2+50+30*Math.sin(.5*s)} ${a.position.x+50} ${a.position.y+50}`}return r.jsxs("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{zIndex:1},children:[r.jsx("path",{d:e,stroke:"url(#pathGradient)",strokeWidth:"4",fill:"none",strokeDasharray:"8,4",className:"animate-pulse"}),r.jsx("defs",{children:r.jsxs("linearGradient",{id:"pathGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[r.jsx("stop",{offset:"0%",stopColor:"#F97316"}),r.jsx("stop",{offset:"50%",stopColor:"#EF4444"}),r.jsx("stop",{offset:"100%",stopColor:"#DC2626"})]})})]})})(),q.map((t,a)=>{return r.jsxs("div",{className:"absolute",style:{left:`${t.position.x}px`,top:`${t.position.y}px`,zIndex:10},children:["locked"===t.progress.status?r.jsxs(_,{children:[r.jsx(C,{asChild:!0,children:r.jsxs(h,{children:[r.jsx(p,{asChild:!0,children:r.jsxs("div",{className:`relative w-24 h-24 rounded-full border-4 flex items-center justify-center transition-all duration-300 ease-in-out ${R(t.progress.status)} hover:cursor-pointer`,onClick:()=>O(t),children:[r.jsx("img",{src:A(a).image,alt:`${A(a).name} level icon`,className:"absolute inset-0 w-full h-full rounded-full object-cover transform scale-90",loading:"lazy"}),r.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 rounded-full",children:r.jsx(M,{className:"w-8 h-8 text-white"})})]})}),r.jsx(g,{side:"top",children:a>0?`Complete the ${A(a-1).name} Level to unlock! Or double-click to unlock manually.`:"This is the first level."})]})}),r.jsxs(S,{children:[r.jsxs($,{children:[r.jsxs(P,{children:["Unlock ",A(a).name," Level?"]}),r.jsxs(E,{children:["Do you want to unlock this level? This will allow you to start the ",A(a).name," listening test."]})]}),r.jsxs(L,{children:[r.jsx(z,{children:"Cancel"}),r.jsx(I,{onClick:()=>(async t=>{if(s)try{await e.from("user_test_progress").upsert({user_id:s.id,test_id:t.test.id,status:"unlocked"},{onConflict:"user_id,test_id"}),u.success(`${A(q.indexOf(t)).name} Level unlocked!`),D()}catch(a){console.error("Error unlocking level:",a),u.error("Failed to unlock level")}})(t),children:"Yes, Unlock Level"})]})]})]}):r.jsxs("div",{className:`relative w-24 h-24 rounded-full border-4 flex items-center justify-center transition-all duration-300 ease-in-out ${R(t.progress.status)}`,onClick:()=>O(t),children:[r.jsx("img",{src:A(a).image,alt:`${A(a).name} level icon`,className:"absolute inset-0 w-full h-full rounded-full object-cover transform scale-90",loading:"lazy"}),"unlocked"===t.progress.status&&r.jsx("div",{className:"absolute bottom-1 right-1",children:r.jsx(f,{className:"w-4 h-4 text-orange-500"})}),"completed"===t.progress.status&&t.progress.completed_score&&r.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2",children:(n=t.progress.completed_score,l=n>=90?3:n>=70?2:1,r.jsx("div",{className:"flex items-center justify-center",children:[1,2,3].map(e=>r.jsx(b,{className:"w-6 h-6 "+(e<=l?"text-yellow-400 fill-current":"text-gray-300"),style:{transform:`rotate(${15*(e-2)}deg) translateY(${2===e?"0px":"4px"})`,margin:"0 2px"}},e))}))})]}),r.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 w-32 text-center",children:r.jsxs("p",{className:"text-[10px] font-medium text-muted-foreground truncate",children:[A(a).name," Level"]})})]},t.test.id);var l,n})]})})}),r.jsx("div",{className:"text-center mt-8 space-x-4",children:r.jsxs(l,{variant:"outline",onClick:()=>t("/ielts-portal"),className:"bg-white/80 backdrop-blur-sm hover:bg-white",children:[r.jsx(j,{className:"w-4 h-4 mr-2 rotate-180"}),"Back to IELTS Portal"]})})]})}):r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx(o,{className:"p-8 text-center",children:r.jsxs(c,{children:[r.jsx("p",{className:"text-lg mb-4",children:"Please sign in to access your listening journey."}),r.jsx(l,{onClick:()=>t("/auth"),className:"bg-primary text-primary-foreground hover:bg-primary/90",children:"Sign In"})]})})})},T=()=>{const{user:s}=d(),t=m(),[n,i]=a.useState([]),[x,h]=a.useState(!0);a.useEffect(()=>{s?p():h(!1)},[s]);const p=async()=>{if(s){h(!0);try{const s=await e.from("skill_tests").select("id, title, test_order").eq("skill_slug","synonym-match").order("test_order",{ascending:!0});if(s.error)throw s.error;i(s.data||[])}catch(t){console.error("Error loading map data:",t),u.error("Failed to load synonym match data")}finally{h(!1)}}};return x?r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx(o,{className:"p-8 text-center",children:r.jsxs(c,{children:[r.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4"}),r.jsx("p",{className:"text-lg",children:"Loading synonym match..."})]})})}):s?r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-teal-50 via-emerald-50 to-green-50 p-6",children:r.jsxs("div",{className:"max-w-6xl mx-auto",children:[r.jsxs("div",{className:"text-center mb-8",children:[r.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:"Synonym Match Journey"}),r.jsx("p",{className:"text-muted-foreground",children:"Coming soon! This skill is under development."})]}),r.jsx(o,{className:"bg-white/60 backdrop-blur-sm border-2 border-white/80 shadow-xl",children:r.jsx(c,{className:"p-8 text-center",children:r.jsxs("div",{className:"space-y-6",children:[r.jsx("div",{className:"w-32 h-32 mx-auto bg-gradient-to-br from-teal-400 to-emerald-500 rounded-full flex items-center justify-center",children:r.jsx("div",{className:"text-4xl",children:"ðŸ”„"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Under Construction"}),r.jsx("p",{className:"text-muted-foreground mb-4",children:"We're working hard to bring you an amazing Synonym Match experience!"}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"This feature will help you master synonyms and expand your vocabulary."})]})]})})}),r.jsx("div",{className:"text-center mt-8",children:r.jsx(l,{variant:"outline",onClick:()=>t("/ielts-portal"),className:"bg-white/80 backdrop-blur-sm hover:bg-white",children:"Back to IELTS Portal"})})]})}):r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx(o,{className:"p-8 text-center",children:r.jsxs(c,{children:[r.jsx("p",{className:"text-lg mb-4",children:"Please sign in to access synonym match."}),r.jsx(l,{onClick:()=>t("/auth"),className:"bg-primary text-primary-foreground hover:bg-primary/90",children:"Sign In"})]})})})},O=()=>{const{user:s}=d(),t=m(),[n,x]=a.useState([]),[h,p]=a.useState(!0);a.useEffect(()=>{s?g():p(!1)},[s]);const g=async()=>{if(s){p(!0);try{const s=await e.from("skill_tests").select("id, title, test_order").eq("skill_slug","collocation-connect").order("test_order",{ascending:!0});if(s.error)throw s.error;x(s.data||[])}catch(t){console.error("Error loading map data:",t),u.error("Failed to load collocation connect data")}finally{p(!1)}}};return h?r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx(i,{size:"lg",message:"Loading collocation connect..."})}):s?r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 via-yellow-50 to-orange-50 p-6",children:r.jsxs("div",{className:"max-w-6xl mx-auto",children:[r.jsxs("div",{className:"text-center mb-8",children:[r.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:"Collocation Connect Journey"}),r.jsx("p",{className:"text-muted-foreground",children:"Coming soon! This skill is under development."})]}),r.jsx(o,{className:"bg-white/60 backdrop-blur-sm border-2 border-white/80 shadow-xl",children:r.jsx(c,{className:"p-8 text-center",children:r.jsxs("div",{className:"space-y-6",children:[r.jsx("div",{className:"w-32 h-32 mx-auto bg-gradient-to-br from-amber-400 to-orange-500 rounded-full flex items-center justify-center",children:r.jsx("div",{className:"text-4xl",children:"ðŸ”—"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Under Construction"}),r.jsx("p",{className:"text-muted-foreground mb-4",children:"We're working hard to bring you an amazing Collocation Connect experience!"}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"This feature will help you master word collocations and natural language patterns."})]})]})})}),r.jsx("div",{className:"text-center mt-8",children:r.jsx(l,{variant:"outline",onClick:()=>t("/ielts-portal"),className:"bg-white/80 backdrop-blur-sm hover:bg-white",children:"Back to IELTS Portal"})})]})}):r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx(o,{className:"p-8 text-center",children:r.jsxs(c,{children:[r.jsx("p",{className:"text-lg mb-4",children:"Please sign in to access collocation connect."}),r.jsx(l,{onClick:()=>t("/auth"),className:"bg-primary text-primary-foreground hover:bg-primary/90",children:"Sign In"})]})})})};const R=()=>{const{slug:e}=y(),t=m(),n=a.useMemo(()=>e?w(e):void 0,[e]),[i,d]=a.useState([]),[u,h]=a.useState([]),[p,g]=a.useState([]),[f,j]=a.useState(""),[b,_]=a.useState(""),[C,S]=a.useState(0),[$,P]=a.useState(!1),[E,L]=a.useState(!1),[z,I]=a.useState(null),[M,R]=a.useState("");a.useEffect(()=>{n&&(document.title=`${n.label} | Practice`,"vocabulary-builder"===e||"grammar-fix-it"===e||"paraphrasing-challenge"===e||"sentence-structure-scramble"===e||"listening-for-details"===e?Y():"pronunciation-repeat-after-me"===e?G():H())},[null==n?void 0:n.label]),a.useEffect(()=>{const t=(async()=>{if(!n)return;const{supabase:t}=await s(async()=>{const{supabase:e}=await import("./supabase-DUkWVuqu.js").then(e=>e.b);return{supabase:e}},[]),a=t.channel("realtime-skill-questions").on("postgres_changes",{event:"*",schema:"public",table:"skill_practice_questions"},s=>{var t,a;((null==(t=null==s?void 0:s.new)?void 0:t.skill_type)??(null==(a=null==s?void 0:s.old)?void 0:a.skill_type))===n.label&&("vocabulary-builder"===e||"grammar-fix-it"===e||"paraphrasing-challenge"===e||"sentence-structure-scramble"===e?Y():H())}).subscribe();return()=>{t.removeChannel(a)}})();return()=>{t.then(e=>null==e?void 0:e())}},[null==n?void 0:n.label]);const H=async()=>{if(!n)return;const{supabase:e}=await s(async()=>{const{supabase:e}=await import("./supabase-DUkWVuqu.js").then(e=>e.b);return{supabase:e}},[]),{data:t,error:a}=await e.from("skill_practice_questions").select("id, content").eq("skill_type",n.label).order("created_at",{ascending:!1});a||d(t??[])},Y=async()=>{if(!e)return;const{supabase:t}=await s(async()=>{const{supabase:e}=await import("./supabase-DUkWVuqu.js").then(e=>e.b);return{supabase:e}},[]),{data:a,error:r}=await t.from("skill_tests").select("id,title").eq("skill_slug",e).order("created_at",{ascending:!1});r||h(a??[])},G=async()=>{const{supabase:e}=await s(async()=>{const{supabase:e}=await import("./supabase-DUkWVuqu.js").then(e=>e.b);return{supabase:e}},[]),{data:t,error:a}=await e.from("pronunciation_tests").select("id,title").eq("is_published",!0).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(a)return;if(!(null==t?void 0:t.id))return g([]),j(""),_(""),S(0),L(!1),void P(!1);j(t.title),_(t.id);const{data:r,error:l}=await null.from("pronunciation_items").select("id, reference_text, audio_url, order_index").eq("test_id",t.id).order("order_index",{ascending:!0});l||(g(r??[]),S(0),L(!1),P(!1))};if(a.useEffect(()=>{(async()=>{var e,t,a;if(!E||!b)return;const{supabase:r}=await s(async()=>{const{supabase:e}=await import("./supabase-DUkWVuqu.js").then(e=>e.b);return{supabase:e}},[]),{data:l}=await r.auth.getUser(),n=null==(e=null==l?void 0:l.user)?void 0:e.id;if(!n)return;const{data:i,error:o}=await r.from("pronunciation_results").select("overall_score, analysis_json, created_at").eq("user_id",n).eq("test_id",b).order("created_at",{ascending:!1}).limit(10);if(o)return;const c=i??[],d=c.map(e=>e.overall_score).filter(e=>"number"==typeof e);d.length?I(Math.round(d.reduce((e,s)=>e+s,0)/d.length)):I(null);const m=null==(a=null==(t=c[0])?void 0:t.analysis_json)?void 0:a.overallSummary;R("string"==typeof m?m:"")})()},[E,b]),"pronunciation-repeat-after-me"===e){const e=Math.min(10,p.length||10),s=e?C/e*100:0,a=p.slice(0,10)[C];return r.jsx(v,{title:n.label,showBackButton:!0,backPath:"/ielts-portal",children:r.jsx("section",{className:"mx-auto px-4",children:r.jsxs("div",{className:"min-h-[70vh] flex flex-col items-center justify-center gap-4",children:[r.jsx("div",{className:"w-full max-w-3xl md:max-w-4xl lg:max-w-5xl",children:r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"absolute -top-10 h-10 flex items-center justify-center -translate-x-1/2 transition-[left] duration-300 ease-out",style:{left:`${s}%`},"aria-label":"Progress mascot",title:"Keep going!",children:r.jsx("img",{src:"/lovable-uploads/27e74cd0-58d8-4b55-b31a-fdb162f21e8b.png",alt:"Pronunciation progress turtle mascot",className:"w-12 h-12 object-contain drop-shadow animate-[turtle-legs_900ms_ease-in-out_infinite]",loading:"lazy"})}),r.jsx("style",{children:"@keyframes turtle-legs { 0% { transform: translateY(0) rotate(0deg) } 25% { transform: translateY(-1px) rotate(-2deg) } 50% { transform: translateY(0) rotate(0deg) } 75% { transform: translateY(-1px) rotate(2deg) } 100% { transform: translateY(0) rotate(0deg) } }"}),r.jsx(x,{value:s})]})}),0===p.length?r.jsx(o,{className:"border-light-border",children:r.jsx(c,{className:"p-4",children:r.jsx("p",{className:"text-muted-foreground text-sm",children:"No pronunciation set is available yet. Please check back soon."})})}):E?r.jsx(o,{className:"w-full max-w-3xl md:max-w-4xl lg:max-w-5xl",children:r.jsxs(c,{className:"p-6 space-y-6",children:[r.jsx("div",{className:"flex justify-center",children:r.jsx(N,{})}),r.jsxs("div",{className:"space-y-2 text-center",children:[r.jsx("div",{className:"text-2xl font-semibold",children:"Great job!"}),r.jsxs("div",{className:"text-muted-foreground",children:["You completed ",f||"this set","."]})]}),r.jsxs("div",{className:"text-center space-y-1 animate-fade-in",children:[r.jsx("p",{className:"text-xs font-medium",children:"Overall Pronunciation Score"}),r.jsxs("p",{className:"text-4xl font-bold text-primary",children:[z??"-"," / 100"]}),M&&r.jsx("p",{className:"text-sm text-muted-foreground max-w-2xl mx-auto",children:M})]}),r.jsxs("div",{className:"flex gap-2 justify-center",children:[r.jsx(l,{onClick:()=>{S(0),L(!1),P(!1),I(null),R("")},children:"Retry"}),r.jsx(l,{variant:"secondary",onClick:()=>t("/ielts-portal"),children:"Back"})]})]})}):a?r.jsx(o,{className:"w-full max-w-3xl md:max-w-4xl lg:max-w-5xl border-light-border",children:r.jsxs(c,{className:"p-6 space-y-4",children:[f&&r.jsxs("div",{className:"text-sm text-muted-foreground",children:[f," â€” Question ",C+1," of ",e]}),r.jsx(q,{item:{...a,order_index:C+1},testId:b,onAnalyzed:()=>P(!0)}),r.jsx("div",{className:"pt-2",children:r.jsx(l,{onClick:()=>{C+1>=e?L(!0):(S(e=>e+1),P(!1))},disabled:!$,children:"Continue"})})]})}):r.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading..."})]})})})}return"vocabulary-builder"===e?r.jsx(k,{}):"grammar-fix-it"===e?r.jsx(F,{}):"paraphrasing-challenge"===e?r.jsx(B,{}):"sentence-structure-scramble"===e?r.jsx(A,{}):"listening-for-details"===e?r.jsx(D,{}):"synonym-match"===e?r.jsx(T,{}):"collocation-connect"===e?r.jsx(O,{}):"sentence-mastery"===e?(window.location.href="/ai-speaking",r.jsx(v,{title:"AI Speaking Tutor",showBackButton:!0,backPath:"/ielts-portal",children:r.jsx("section",{className:"space-y-4 max-w-3xl mx-auto",children:r.jsx("p",{className:"text-muted-foreground text-sm",children:"Redirecting to AI Speaking Tutor..."})})})):r.jsx(v,{title:n.label,showBackButton:!0,backPath:"/ielts-portal",children:r.jsx("section",{className:"space-y-4 max-w-3xl mx-auto",children:0===i.length?r.jsx("p",{className:"text-muted-foreground text-sm",children:"No questions yet. Please check back soon."}):i.map(e=>r.jsx(o,{className:"border-light-border",children:r.jsx(c,{className:"p-4",children:r.jsx("p",{className:"whitespace-pre-wrap leading-relaxed",children:e.content})})},e.id))})})};export{R as default};
