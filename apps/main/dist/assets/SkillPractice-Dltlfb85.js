import{s as e,_ as s}from"./supabase-DWL4C3fA.js";import{h as t,r as a,j as r,B as l,V as n,c3 as i,bC as o,C as c,a as d,a3 as m,u,J as x,K as h,bs as p,bt as g,bu as f,Y as j,c0 as b,aj as y,G as v,a5 as w,D as N,m as k,n as _,o as C}from"./index-Dbr7DlF4.js";import{g as S}from"./skills-NqzSOyzV.js";import{P}from"./PenguinClapAnimation-D9r7iI9L.js";import $ from"./VocabularyMapView-e0lNefWS.js";import{A as E,a as L,b as A,c as z,d as B,e as I,f as F,g as M,h as T}from"./alert-dialog-BgwNHovY.js";import{C as q}from"./circle-help-BDgvcDrY.js";const D=({item:s,testId:m,selectedAccent:u="us",onAnalyzed:x})=>{const{toast:h}=t(),[p,g]=a.useState(null),[f,j]=a.useState(!1),[b,y]=a.useState(""),[v,w]=a.useState(""),[N,k]=a.useState(null),[_,C]=a.useState(""),S=a.useRef(null),[P,$]=a.useState(!1),[E,L]=a.useState(!1),[A,z]=a.useState(!1),B=s.audio_url||("uk"===u?s.audio_url_uk:s.audio_url_us);a.useEffect(()=>{if(B){try{S.current&&(S.current.pause(),S.current=null);const e=new Audio(B);e.preload="auto",e.playsInline=!0,S.current=e,e.onended=()=>z(!1),e.onerror=()=>$(!0),E||e.play().then(()=>{$(!1),L(!0),z(!0)}).catch(()=>$(!0))}catch(e){$(!0)}return()=>{var e;try{null==(e=S.current)||e.pause()}catch{}}}},[B,E]),a.useEffect(()=>{g(null),j(!1),y(""),w(""),k(null),C(""),$(!1),L(!1),z(!1)},[s.id]);return r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex flex-col items-center gap-2",children:[r.jsx("p",{className:"text-sm text-muted-foreground",children:"Listen carefully and repeat exactly what you hear"}),r.jsxs(l,{size:"lg",variant:A?"default":"outline",onClick:async()=>{var e;if(B)try{if(A&&S.current)return S.current.pause(),void z(!1);await(null==(e=S.current)?void 0:e.play()),$(!1),z(!0)}catch(s){$(!0)}else h({title:"No audio available",description:"Audio for this accent hasn't been generated yet.",variant:"destructive"})},disabled:!B,className:"gap-2",children:[r.jsx(n,{className:"w-5 h-5 "+(A?"animate-pulse":"")}),B?A?"Playing...":P?"Play Audio":"Play Again":"Audio not available"]})]}),r.jsxs("div",{className:"space-y-4 w-full max-w-xl mx-auto",children:[r.jsx("div",{className:"flex justify-center",children:r.jsx(i,{onRecordingComplete:e=>{g(e),y(""),w(""),k(null),C("")},autoFocus:!0},s.id)}),r.jsx("div",{className:"flex justify-center",children:r.jsx(l,{onClick:async()=>{var t,a,r;try{if(!p)return void h({title:"No recording",description:"Please record your voice first.",variant:"destructive"});const{data:l}=await e.auth.getUser(),n=null==(t=null==l?void 0:l.user)?void 0:t.id;if(!n)return void h({title:"Sign in required",description:"Please log in to save and analyze your recording.",variant:"destructive"});j(!0);const i=`user-recordings/pronunciation/${m}/${s.id}/${Date.now()}.webm`;console.log("Pronunciation upload disabled - implement R2 upload");const o=`https://your-bucket.your-domain.com/${i}`;C(o);const c=await(r=p,new Promise((e,s)=>{const t=new FileReader;t.onloadend=()=>{const s=t.result.split(",")[1];e(s)},t.onerror=s,t.readAsDataURL(r)})),d="uk"===u?"british":"american",{data:g,error:f}=await e.functions.invoke("pronunciation-analysis",{body:{audio:c,referenceText:s.reference_text,accent:d}});if(f)throw f;const b=(null==g?void 0:g.transcription)??"",v=(null==g?void 0:g.analysis)??"";y(b),w(v);try{k((null==g?void 0:g.analysis_json)??JSON.parse(v))}catch{k(null)}const N=(null==(a=null==g?void 0:g.analysis_json)?void 0:a.overallScore)??null,{error:_}=await e.from("pronunciation_results").insert({user_id:n,test_id:m,item_id:s.id,audio_url:o,analysis_json:(null==g?void 0:g.analysis_json)??{transcription:b,analysis:v},overall_score:N});if(_)throw _;h({title:"Analysis complete",description:"Your feedback is ready."}),null==x||x({transcription:b,analysis:v,audioUrl:o})}catch(l){console.error(l),h({title:"Analysis failed",description:l.message,variant:"destructive"})}finally{j(!1)}},disabled:f||!p,size:"lg",children:f?"Analyzing...":"Get Feedback"})}),f&&r.jsx("div",{className:"flex justify-center animate-fade-in",children:r.jsx(o,{size:"md",message:"Analyzing your pronunciation..."})})]}),N&&r.jsx(c,{className:"border-light-border w-full max-w-xl mx-auto animate-fade-in",children:r.jsxs(d,{className:"p-6 space-y-4",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Overall Score"}),r.jsx("p",{className:"text-4xl font-bold text-primary",children:(null==N?void 0:N.overallScore)??"-"}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"out of 100"}),(null==N?void 0:N.overallSummary)&&r.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:N.overallSummary})]}),Array.isArray(null==N?void 0:N.wordAnalysis)&&N.wordAnalysis.length>0&&r.jsxs("div",{children:[r.jsx("p",{className:"text-xs font-medium mb-2",children:"Word-by-Word Analysis"}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:N.wordAnalysis.slice(0,10).map((e,s)=>r.jsxs("div",{className:"rounded-md border p-2 text-sm "+("correct"===e.status?"border-green-200 bg-green-50":"incorrect"===e.status?"border-red-200 bg-red-50":"border-yellow-200 bg-yellow-50"),children:[r.jsxs("div",{className:"font-medium flex items-center justify-between",children:[r.jsx("span",{children:e.word}),r.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded "+("correct"===e.status?"bg-green-100 text-green-700":"incorrect"===e.status?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"),children:e.status})]}),e.feedback&&r.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:e.feedback})]},s))})]}),Array.isArray(null==N?void 0:N.detailedFeedback)&&N.detailedFeedback.length>0&&r.jsxs("div",{className:"space-y-3",children:[r.jsx("p",{className:"text-xs font-medium",children:"Detailed Feedback"}),N.detailedFeedback.map((e,s)=>r.jsxs("div",{className:"rounded-md border border-light-border p-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("p",{className:"text-sm font-medium",children:e.area}),"number"==typeof e.score&&r.jsxs("span",{className:"text-xs text-muted-foreground",children:[e.score,"/100"]})]}),e.positive&&r.jsxs("p",{className:"text-sm mt-1 text-green-600",children:["âœ“ ",e.positive]}),e.improvement&&r.jsxs("p",{className:"text-sm mt-1 text-amber-600",children:["â†’ ",e.improvement]})]},s))]})]})})]})},O=()=>{const{user:s}=m(),t=u(),[n,i]=a.useState([]),[v,w]=a.useState([]),[N,k]=a.useState(!0),[_,C]=a.useState([]),S=[{name:"Mouse",image:"/moouse emoji.png"},{name:"Hamster",image:"/Hamster.png"},{name:"Chick",image:"/chick.png"},{name:"Rabbit",image:"/rabbit.png"},{name:"Kitten",image:"/cat.png"},{name:"Puppy",image:"/puppy.png"},{name:"Duck",image:"/duck.png"},{name:"Hedgehog",image:"/hedgehog.png"},{name:"Squirrel",image:"/squerrel.png"},{name:"Penguin",image:"/Penguine.png"},{name:"Otter",image:"/otter.png"},{name:"Koala",image:"/koala.png"},{name:"Piglet",image:"/piglet.png"},{name:"Monkey",image:"/Monkey.png"},{name:"Fox",image:"/fox.png"},{name:"Deer",image:"/dear.png"},{name:"Seal",image:"/seal.png"},{name:"Panda",image:"/panda.png"},{name:"Bear",image:"/bear.png"},{name:"Polar Bear",image:"/polar bear.png"}],P=e=>e<S.length?S[e]:S[S.length-1];a.useEffect(()=>{s?$():k(!1)},[s]),a.useEffect(()=>{const e=()=>{s&&$()};return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[s]);const $=async()=>{if(s){k(!0);try{const[t,a]=await Promise.all([e.from("skill_tests").select("id, title, test_order").eq("skill_slug","grammar-fix-it").order("test_order",{ascending:!0}),e.from("user_test_progress").select("test_id, status, completed_score").eq("user_id",s.id)]);if(t.error)throw t.error;if(a.error)throw a.error;const r=t.data||[];let l=a.data||[];const n=r.map(e=>e.id);if(l=l.filter(e=>n.includes(e.test_id)),r.length>0&&0===l.length){const t=r.find(e=>1===e.test_order)||r[0];if(t){const a={user_id:s.id,test_id:t.id,status:"unlocked"};await e.from("user_test_progress").insert(a),l=[{test_id:t.id,status:"unlocked",completed_score:null}]}}i(r),w(l),D(r,l)}catch(t){console.error("Error loading map data:",t),x.error("Failed to load grammar map")}finally{k(!1)}}},D=(e,s)=>{const t=[];e.forEach((e,a)=>{const r=Math.floor(a/5),l=a%5,n=160*(r%2==0?l:4-l)+50,i=150*r+20,o=s.find(s=>s.test_id===e.id)||{test_id:e.id,status:"locked"};t.push({test:e,progress:o,position:{x:n,y:i}})}),C(t)},O=e=>{t(`/skills/grammar-fix-it/test/${e.test.id}`)},R=e=>{switch(e){case"completed":return"bg-gradient-to-br from-yellow-400 to-orange-500 text-white shadow-lg border-yellow-300 hover:shadow-xl transform hover:scale-105";case"unlocked":return"bg-gradient-to-br from-green-400 to-blue-500 text-white shadow-lg border-green-300 hover:shadow-xl transform hover:scale-105 cursor-pointer";default:return"bg-gray-200 text-gray-500 border-gray-300 cursor-not-allowed"}};return N?r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx(o,{size:"lg",message:"Loading your grammar journey..."})}):s?r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-blue-50 to-purple-50 p-6",children:r.jsxs("div",{className:"max-w-6xl mx-auto",children:[r.jsxs("div",{className:"text-center mb-4",children:[r.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:"Grammar Fix-it Journey"}),r.jsx(c,{className:"max-w-md mx-auto bg-white/80 backdrop-blur-sm",children:r.jsxs(d,{className:"p-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-sm font-medium",children:"Overall Progress"}),r.jsxs("span",{className:"text-sm text-gray-600",children:[v.filter(e=>"completed"===e.status).length," / ",n.length]})]}),r.jsx(h,{value:(()=>{const e=v.filter(e=>"completed"===e.status).length;return n.length>0?e/n.length*100:0})(),className:"h-3"})]})})]}),r.jsx(c,{className:"relative bg-white/60 backdrop-blur-sm border-2 border-white/80 shadow-xl",children:r.jsx(d,{className:"pt-4 pb-8 px-8",children:r.jsxs("div",{className:"relative mx-auto",style:{width:"900px",height:"700px",minHeight:"600px"},children:[(()=>{if(_.length<2)return null;let e=`M ${_[0].position.x+50} ${_[0].position.y+50}`;for(let s=1;s<_.length;s++){const t=_[s-1],a=_[s];e+=` Q ${(t.position.x+a.position.x)/2+50} ${(t.position.y+a.position.y)/2+50+30*Math.sin(.5*s)} ${a.position.x+50} ${a.position.y+50}`}return r.jsxs("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{zIndex:1},children:[r.jsx("path",{d:e,stroke:"url(#pathGradient)",strokeWidth:"4",fill:"none",strokeDasharray:"8,4",className:"animate-pulse"}),r.jsx("defs",{children:r.jsxs("linearGradient",{id:"pathGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[r.jsx("stop",{offset:"0%",stopColor:"#3B82F6"}),r.jsx("stop",{offset:"50%",stopColor:"#8B5CF6"}),r.jsx("stop",{offset:"100%",stopColor:"#EC4899"})]})})]})})(),_.map((t,a)=>{return r.jsxs("div",{className:"absolute",style:{left:`${t.position.x}px`,top:`${t.position.y}px`,zIndex:10},children:["locked"===t.progress.status?r.jsxs(E,{children:[r.jsx(L,{asChild:!0,children:r.jsxs(p,{children:[r.jsx(g,{asChild:!0,children:r.jsxs("div",{className:`relative w-24 h-24 rounded-full border-4 flex items-center justify-center transition-all duration-300 ease-in-out ${R(t.progress.status)} hover:cursor-pointer`,onClick:()=>O(t),children:[r.jsx("img",{src:P(a).image,alt:`${P(a).name} level icon`,className:"absolute inset-0 w-full h-full rounded-full object-cover transform scale-90",loading:"lazy"}),r.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 rounded-full",children:r.jsx(q,{className:"w-8 h-8 text-white"})})]})}),r.jsx(f,{side:"top",children:a>0?`Complete the ${P(a-1).name} Level to unlock! Or double-click to unlock manually.`:"This is the first level."})]})}),r.jsxs(A,{children:[r.jsxs(z,{children:[r.jsxs(B,{children:["Unlock ",P(a).name," Level?"]}),r.jsxs(I,{children:["Do you want to unlock this level? This will allow you to start the ",P(a).name," grammar test."]})]}),r.jsxs(F,{children:[r.jsx(M,{children:"Cancel"}),r.jsx(T,{onClick:()=>(async t=>{if(s)try{await e.from("user_test_progress").upsert({user_id:s.id,test_id:t.test.id,status:"unlocked"},{onConflict:"user_id,test_id"}),x.success(`${P(_.indexOf(t)).name} Level unlocked!`),$()}catch(a){console.error("Error unlocking level:",a),x.error("Failed to unlock level")}})(t),children:"Yes, Unlock Level"})]})]})]}):r.jsxs("div",{className:`relative w-24 h-24 rounded-full border-4 flex items-center justify-center transition-all duration-300 ease-in-out ${R(t.progress.status)}`,onClick:()=>O(t),children:[r.jsx("img",{src:P(a).image,alt:`${P(a).name} level icon`,className:"absolute inset-0 w-full h-full rounded-full object-cover transform scale-90",loading:"lazy"}),"unlocked"===t.progress.status&&r.jsx("div",{className:"absolute bottom-1 right-1",children:r.jsx(j,{className:"w-4 h-4 text-green-500"})}),"completed"===t.progress.status&&t.progress.completed_score&&r.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2",children:(n=t.progress.completed_score,l=n>=90?3:n>=70?2:1,r.jsx("div",{className:"flex items-center justify-center",children:[1,2,3].map(e=>r.jsx(y,{className:"w-6 h-6 "+(e<=l?"text-yellow-400 fill-current":"text-gray-300"),style:{transform:`rotate(${15*(e-2)}deg) translateY(${2===e?"0px":"4px"})`,margin:"0 2px"}},e))}))})]}),r.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 w-32 text-center",children:r.jsxs("p",{className:"text-[10px] font-medium text-muted-foreground truncate",children:[P(a).name," Level"]})})]},t.test.id);var l,n})]})})}),r.jsx("div",{className:"text-center mt-8 space-x-4",children:r.jsxs(l,{variant:"outline",onClick:()=>t("/ielts-portal"),className:"bg-white/80 backdrop-blur-sm hover:bg-white",children:[r.jsx(b,{className:"w-4 h-4 mr-2 rotate-180"}),"Back to IELTS Portal"]})})]})}):r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx(c,{className:"p-8 text-center",children:r.jsxs(d,{children:[r.jsx("p",{className:"text-lg mb-4",children:"Please sign in to access your grammar journey."}),r.jsx(l,{onClick:()=>t("/auth"),className:"bg-primary text-primary-foreground hover:bg-primary/90",children:"Sign In"})]})})})},R=()=>{const{user:s}=m(),t=u(),[n,i]=a.useState([]),[v,w]=a.useState([]),[N,k]=a.useState(!0),[_,C]=a.useState([]),S=[{name:"Mouse",image:"/moouse emoji.png"},{name:"Hamster",image:"/Hamster.png"},{name:"Chick",image:"/chick.png"},{name:"Rabbit",image:"/rabbit.png"},{name:"Kitten",image:"/cat.png"},{name:"Puppy",image:"/puppy.png"},{name:"Duck",image:"/duck.png"},{name:"Hedgehog",image:"/hedgehog.png"},{name:"Squirrel",image:"/squerrel.png"},{name:"Penguin",image:"/Penguine.png"},{name:"Otter",image:"/otter.png"},{name:"Koala",image:"/koala.png"},{name:"Piglet",image:"/piglet.png"},{name:"Monkey",image:"/Monkey.png"},{name:"Fox",image:"/fox.png"},{name:"Deer",image:"/dear.png"},{name:"Seal",image:"/seal.png"},{name:"Panda",image:"/panda.png"},{name:"Bear",image:"/bear.png"},{name:"Polar Bear",image:"/polar bear.png"}],P=e=>e<S.length?S[e]:S[S.length-1];a.useEffect(()=>{s?$():k(!1)},[s]),a.useEffect(()=>{const e=()=>{s&&$()};return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[s]);const $=async()=>{if(s){k(!0);try{const[t,a]=await Promise.all([e.from("skill_tests").select("id, title, test_order").eq("skill_slug","paraphrasing-challenge").order("test_order",{ascending:!0}),e.from("user_test_progress").select("test_id, status, completed_score").eq("user_id",s.id)]);if(t.error)throw t.error;if(a.error)throw a.error;const r=t.data||[];let l=a.data||[];const n=r.map(e=>e.id);if(l=l.filter(e=>n.includes(e.test_id)),r.length>0&&0===l.length){const t=r.find(e=>1===e.test_order)||r[0];if(t){const a={user_id:s.id,test_id:t.id,status:"unlocked"};await e.from("user_test_progress").insert(a),l=[{test_id:t.id,status:"unlocked",completed_score:null}]}}i(r),w(l),D(r,l)}catch(t){console.error("Error loading map data:",t),x.error("Failed to load paraphrasing map")}finally{k(!1)}}},D=(e,s)=>{const t=[];e.forEach((e,a)=>{const r=Math.floor(a/5),l=a%5,n=160*(r%2==0?l:4-l)+50,i=150*r+20,o=s.find(s=>s.test_id===e.id)||{test_id:e.id,status:"locked"};t.push({test:e,progress:o,position:{x:n,y:i}})}),C(t)},O=e=>{t(`/skills/paraphrasing-challenge/test/${e.test.id}`)},R=e=>{switch(e){case"completed":return"bg-gradient-to-br from-yellow-400 to-orange-500 text-white shadow-lg border-yellow-300 hover:shadow-xl transform hover:scale-105";case"unlocked":return"bg-gradient-to-br from-purple-400 to-pink-500 text-white shadow-lg border-purple-300 hover:shadow-xl transform hover:scale-105 cursor-pointer";default:return"bg-gray-200 text-gray-500 border-gray-300 cursor-not-allowed"}};return N?r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx(o,{size:"lg",message:"Loading your paraphrasing journey..."})}):s?r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-orange-50 p-6",children:r.jsxs("div",{className:"max-w-6xl mx-auto",children:[r.jsxs("div",{className:"text-center mb-4",children:[r.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:"Paraphrasing Challenge Journey"}),r.jsx(c,{className:"max-w-md mx-auto bg-white/80 backdrop-blur-sm",children:r.jsxs(d,{className:"p-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-sm font-medium",children:"Overall Progress"}),r.jsxs("span",{className:"text-sm text-gray-600",children:[v.filter(e=>"completed"===e.status).length," / ",n.length]})]}),r.jsx(h,{value:(()=>{const e=v.filter(e=>"completed"===e.status).length;return n.length>0?e/n.length*100:0})(),className:"h-3"})]})})]}),r.jsx(c,{className:"relative bg-white/60 backdrop-blur-sm border-2 border-white/80 shadow-xl",children:r.jsx(d,{className:"pt-4 pb-8 px-8",children:r.jsxs("div",{className:"relative mx-auto",style:{width:"900px",height:"700px",minHeight:"600px"},children:[(()=>{if(_.length<2)return null;let e=`M ${_[0].position.x+50} ${_[0].position.y+50}`;for(let s=1;s<_.length;s++){const t=_[s-1],a=_[s];e+=` Q ${(t.position.x+a.position.x)/2+50} ${(t.position.y+a.position.y)/2+50+30*Math.sin(.5*s)} ${a.position.x+50} ${a.position.y+50}`}return r.jsxs("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{zIndex:1},children:[r.jsx("path",{d:e,stroke:"url(#pathGradient)",strokeWidth:"4",fill:"none",strokeDasharray:"8,4",className:"animate-pulse"}),r.jsx("defs",{children:r.jsxs("linearGradient",{id:"pathGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[r.jsx("stop",{offset:"0%",stopColor:"#8B5CF6"}),r.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),r.jsx("stop",{offset:"100%",stopColor:"#F59E0B"})]})})]})})(),_.map((t,a)=>{return r.jsxs("div",{className:"absolute",style:{left:`${t.position.x}px`,top:`${t.position.y}px`,zIndex:10},children:["locked"===t.progress.status?r.jsxs(E,{children:[r.jsx(L,{asChild:!0,children:r.jsxs(p,{children:[r.jsx(g,{asChild:!0,children:r.jsxs("div",{className:`relative w-24 h-24 rounded-full border-4 flex items-center justify-center transition-all duration-300 ease-in-out ${R(t.progress.status)} hover:cursor-pointer`,onClick:()=>O(t),children:[r.jsx("img",{src:P(a).image,alt:`${P(a).name} level icon`,className:"absolute inset-0 w-full h-full rounded-full object-cover transform scale-90",loading:"lazy"}),r.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 rounded-full",children:r.jsx(q,{className:"w-8 h-8 text-white"})})]})}),r.jsx(f,{side:"top",children:a>0?`Complete the ${P(a-1).name} Level to unlock! Or double-click to unlock manually.`:"This is the first level."})]})}),r.jsxs(A,{children:[r.jsxs(z,{children:[r.jsxs(B,{children:["Unlock ",P(a).name," Level?"]}),r.jsxs(I,{children:["Do you want to unlock this level? This will allow you to start the ",P(a).name," paraphrasing challenge."]})]}),r.jsxs(F,{children:[r.jsx(M,{children:"Cancel"}),r.jsx(T,{onClick:()=>(async t=>{if(s)try{await e.from("user_test_progress").upsert({user_id:s.id,test_id:t.test.id,status:"unlocked"},{onConflict:"user_id,test_id"}),x.success(`${P(_.indexOf(t)).name} Level unlocked!`),$()}catch(a){console.error("Error unlocking level:",a),x.error("Failed to unlock level")}})(t),children:"Yes, Unlock Level"})]})]})]}):r.jsxs("div",{className:`relative w-24 h-24 rounded-full border-4 flex items-center justify-center transition-all duration-300 ease-in-out ${R(t.progress.status)}`,onClick:()=>O(t),children:[r.jsx("img",{src:P(a).image,alt:`${P(a).name} level icon`,className:"absolute inset-0 w-full h-full rounded-full object-cover transform scale-90",loading:"lazy"}),"unlocked"===t.progress.status&&r.jsx("div",{className:"absolute bottom-1 right-1",children:r.jsx(j,{className:"w-4 h-4 text-purple-500"})}),"completed"===t.progress.status&&t.progress.completed_score&&r.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2",children:(n=t.progress.completed_score,l=n>=90?3:n>=70?2:1,r.jsx("div",{className:"flex items-center justify-center",children:[1,2,3].map(e=>r.jsx(y,{className:"w-6 h-6 "+(e<=l?"text-yellow-400 fill-current":"text-gray-300"),style:{transform:`rotate(${15*(e-2)}deg) translateY(${2===e?"0px":"4px"})`,margin:"0 2px"}},e))}))})]}),r.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 w-32 text-center",children:r.jsxs("p",{className:"text-[10px] font-medium text-muted-foreground truncate",children:[P(a).name," Level"]})})]},t.test.id);var l,n})]})})}),r.jsx("div",{className:"text-center mt-8 space-x-4",children:r.jsxs(l,{variant:"outline",onClick:()=>t("/ielts-portal"),className:"bg-white/80 backdrop-blur-sm hover:bg-white",children:[r.jsx(b,{className:"w-4 h-4 mr-2 rotate-180"}),"Back to IELTS Portal"]})})]})}):r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx(c,{className:"p-8 text-center",children:r.jsxs(d,{children:[r.jsx("p",{className:"text-lg mb-4",children:"Please sign in to access your paraphrasing journey."}),r.jsx(l,{onClick:()=>t("/auth"),className:"bg-primary text-primary-foreground hover:bg-primary/90",children:"Sign In"})]})})})},Y=()=>{const{user:s}=m(),t=u(),[n,i]=a.useState([]),[v,w]=a.useState([]),[N,k]=a.useState(!0),[_,C]=a.useState([]),S=[{name:"Mouse",image:"/moouse emoji.png"},{name:"Hamster",image:"/Hamster.png"},{name:"Chick",image:"/chick.png"},{name:"Rabbit",image:"/rabbit.png"},{name:"Kitten",image:"/cat.png"},{name:"Puppy",image:"/puppy.png"},{name:"Duck",image:"/duck.png"},{name:"Hedgehog",image:"/hedgehog.png"},{name:"Squirrel",image:"/squerrel.png"},{name:"Penguin",image:"/Penguine.png"},{name:"Otter",image:"/otter.png"},{name:"Koala",image:"/koala.png"},{name:"Piglet",image:"/piglet.png"},{name:"Monkey",image:"/Monkey.png"},{name:"Fox",image:"/fox.png"},{name:"Deer",image:"/dear.png"},{name:"Seal",image:"/seal.png"},{name:"Panda",image:"/panda.png"},{name:"Bear",image:"/bear.png"},{name:"Polar Bear",image:"/polar bear.png"}],P=e=>e<S.length?S[e]:S[S.length-1];a.useEffect(()=>{s?$():k(!1)},[s]),a.useEffect(()=>{const e=()=>{s&&$()};return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[s]);const $=async()=>{if(s){k(!0);try{const[t,a]=await Promise.all([e.from("skill_tests").select("id, title, test_order").eq("skill_slug","sentence-structure-scramble").order("test_order",{ascending:!0}),e.from("user_test_progress").select("test_id, status, completed_score").eq("user_id",s.id)]);if(t.error)throw t.error;if(a.error)throw a.error;const r=t.data||[];let l=a.data||[];const n=r.map(e=>e.id);if(l=l.filter(e=>n.includes(e.test_id)),r.length>0&&0===l.length){const t=r.find(e=>1===e.test_order)||r[0];if(t){const a={user_id:s.id,test_id:t.id,status:"unlocked"};await e.from("user_test_progress").insert(a),l=[{test_id:t.id,status:"unlocked",completed_score:null}]}}i(r),w(l),D(r,l)}catch(t){console.error("Error loading map data:",t),x.error("Failed to load sentence scramble map")}finally{k(!1)}}},D=(e,s)=>{const t=[];e.forEach((e,a)=>{const r=Math.floor(a/5),l=a%5,n=160*(r%2==0?l:4-l)+50,i=150*r+20,o=s.find(s=>s.test_id===e.id)||{test_id:e.id,status:"locked"};t.push({test:e,progress:o,position:{x:n,y:i}})}),C(t)},O=e=>{t(`/skills/sentence-structure-scramble/test/${e.test.id}`)},R=e=>{switch(e){case"completed":return"bg-gradient-to-br from-yellow-400 to-orange-500 text-white shadow-lg border-yellow-300 hover:shadow-xl transform hover:scale-105";case"unlocked":return"bg-gradient-to-br from-indigo-400 to-blue-500 text-white shadow-lg border-indigo-300 hover:shadow-xl transform hover:scale-105 cursor-pointer";default:return"bg-gray-200 text-gray-500 border-gray-300 cursor-not-allowed"}};return N?r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx(o,{size:"lg",message:"Loading your sentence scramble journey..."})}):s?r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-blue-50 to-cyan-50 p-6",children:r.jsxs("div",{className:"max-w-6xl mx-auto",children:[r.jsxs("div",{className:"text-center mb-4",children:[r.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:"Sentence Structure Scramble Journey"}),r.jsx(c,{className:"max-w-md mx-auto bg-white/80 backdrop-blur-sm",children:r.jsxs(d,{className:"p-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-sm font-medium",children:"Overall Progress"}),r.jsxs("span",{className:"text-sm text-gray-600",children:[v.filter(e=>"completed"===e.status).length," / ",n.length]})]}),r.jsx(h,{value:(()=>{const e=v.filter(e=>"completed"===e.status).length;return n.length>0?e/n.length*100:0})(),className:"h-3"})]})})]}),r.jsx(c,{className:"relative bg-white/60 backdrop-blur-sm border-2 border-white/80 shadow-xl",children:r.jsx(d,{className:"pt-4 pb-8 px-8",children:r.jsxs("div",{className:"relative mx-auto",style:{width:"900px",height:"700px",minHeight:"600px"},children:[(()=>{if(_.length<2)return null;let e=`M ${_[0].position.x+50} ${_[0].position.y+50}`;for(let s=1;s<_.length;s++){const t=_[s-1],a=_[s];e+=` Q ${(t.position.x+a.position.x)/2+50} ${(t.position.y+a.position.y)/2+50+30*Math.sin(.5*s)} ${a.position.x+50} ${a.position.y+50}`}return r.jsxs("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{zIndex:1},children:[r.jsx("path",{d:e,stroke:"url(#pathGradient)",strokeWidth:"4",fill:"none",strokeDasharray:"8,4",className:"animate-pulse"}),r.jsx("defs",{children:r.jsxs("linearGradient",{id:"pathGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[r.jsx("stop",{offset:"0%",stopColor:"#4F46E5"}),r.jsx("stop",{offset:"50%",stopColor:"#3B82F6"}),r.jsx("stop",{offset:"100%",stopColor:"#06B6D4"})]})})]})})(),_.map((t,a)=>{return r.jsxs("div",{className:"absolute",style:{left:`${t.position.x}px`,top:`${t.position.y}px`,zIndex:10},children:["locked"===t.progress.status?r.jsxs(E,{children:[r.jsx(L,{asChild:!0,children:r.jsxs(p,{children:[r.jsx(g,{asChild:!0,children:r.jsxs("div",{className:`relative w-24 h-24 rounded-full border-4 flex items-center justify-center transition-all duration-300 ease-in-out ${R(t.progress.status)} hover:cursor-pointer`,onClick:()=>O(t),children:[r.jsx("img",{src:P(a).image,alt:`${P(a).name} level icon`,className:"absolute inset-0 w-full h-full rounded-full object-cover transform scale-90",loading:"lazy"}),r.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 rounded-full",children:r.jsx(q,{className:"w-8 h-8 text-white"})})]})}),r.jsx(f,{side:"top",children:a>0?`Complete the ${P(a-1).name} Level to unlock! Or double-click to unlock manually.`:"This is the first level."})]})}),r.jsxs(A,{children:[r.jsxs(z,{children:[r.jsxs(B,{children:["Unlock ",P(a).name," Level?"]}),r.jsxs(I,{children:["Do you want to unlock this level? This will allow you to start the ",P(a).name," sentence scramble challenge."]})]}),r.jsxs(F,{children:[r.jsx(M,{children:"Cancel"}),r.jsx(T,{onClick:()=>(async t=>{if(s)try{await e.from("user_test_progress").upsert({user_id:s.id,test_id:t.test.id,status:"unlocked"},{onConflict:"user_id,test_id"}),x.success(`${P(_.indexOf(t)).name} Level unlocked!`),$()}catch(a){console.error("Error unlocking level:",a),x.error("Failed to unlock level")}})(t),children:"Yes, Unlock Level"})]})]})]}):r.jsxs("div",{className:`relative w-24 h-24 rounded-full border-4 flex items-center justify-center transition-all duration-300 ease-in-out ${R(t.progress.status)}`,onClick:()=>O(t),children:[r.jsx("img",{src:P(a).image,alt:`${P(a).name} level icon`,className:"absolute inset-0 w-full h-full rounded-full object-cover transform scale-90",loading:"lazy"}),"unlocked"===t.progress.status&&r.jsx("div",{className:"absolute bottom-1 right-1",children:r.jsx(j,{className:"w-4 h-4 text-indigo-500"})}),"completed"===t.progress.status&&t.progress.completed_score&&r.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2",children:(n=t.progress.completed_score,l=n>=90?3:n>=70?2:1,r.jsx("div",{className:"flex items-center justify-center",children:[1,2,3].map(e=>r.jsx(y,{className:"w-6 h-6 "+(e<=l?"text-yellow-400 fill-current":"text-gray-300"),style:{transform:`rotate(${15*(e-2)}deg) translateY(${2===e?"0px":"4px"})`,margin:"0 2px"}},e))}))})]}),r.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 w-32 text-center",children:r.jsxs("p",{className:"text-[10px] font-medium text-muted-foreground truncate",children:[P(a).name," Level"]})})]},t.test.id);var l,n})]})})}),r.jsx("div",{className:"text-center mt-8 space-x-4",children:r.jsxs(l,{variant:"outline",onClick:()=>t("/ielts-portal"),className:"bg-white/80 backdrop-blur-sm hover:bg-white",children:[r.jsx(b,{className:"w-4 h-4 mr-2 rotate-180"}),"Back to IELTS Portal"]})})]})}):r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx(c,{className:"p-8 text-center",children:r.jsxs(d,{children:[r.jsx("p",{className:"text-lg mb-4",children:"Please sign in to access your sentence scramble journey."}),r.jsx(l,{onClick:()=>t("/auth"),className:"bg-primary text-primary-foreground hover:bg-primary/90",children:"Sign In"})]})})})},G=()=>{const{user:s}=m(),t=u(),[n,i]=a.useState([]),[v,w]=a.useState([]),[N,k]=a.useState(!0),[_,C]=a.useState([]),S=[{name:"Mouse",image:"/moouse emoji.png"},{name:"Hamster",image:"/Hamster.png"},{name:"Chick",image:"/chick.png"},{name:"Rabbit",image:"/rabbit.png"},{name:"Kitten",image:"/cat.png"},{name:"Puppy",image:"/puppy.png"},{name:"Duck",image:"/duck.png"},{name:"Hedgehog",image:"/hedgehog.png"},{name:"Squirrel",image:"/squerrel.png"},{name:"Penguin",image:"/Penguine.png"},{name:"Otter",image:"/otter.png"},{name:"Koala",image:"/koala.png"},{name:"Piglet",image:"/piglet.png"},{name:"Monkey",image:"/Monkey.png"},{name:"Fox",image:"/fox.png"},{name:"Deer",image:"/dear.png"},{name:"Seal",image:"/seal.png"},{name:"Panda",image:"/panda.png"},{name:"Bear",image:"/bear.png"},{name:"Polar Bear",image:"/polar bear.png"}],P=e=>e<S.length?S[e]:S[S.length-1];a.useEffect(()=>{s?$():k(!1)},[s]),a.useEffect(()=>{const e=()=>{s&&$()};return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[s]);const $=async()=>{if(s){k(!0);try{const[t,a]=await Promise.all([e.from("skill_tests").select("id, title, test_order").eq("skill_slug","listening-for-details").order("test_order",{ascending:!0}),e.from("user_test_progress").select("test_id, status, completed_score").eq("user_id",s.id)]);if(t.error)throw t.error;if(a.error)throw a.error;const r=t.data||[];let l=a.data||[];const n=r.map(e=>e.id);if(l=l.filter(e=>n.includes(e.test_id)),r.length>0&&0===l.length){const t=r.find(e=>1===e.test_order)||r[0];if(t){const a={user_id:s.id,test_id:t.id,status:"unlocked"};await e.from("user_test_progress").insert(a),l=[{test_id:t.id,status:"unlocked",completed_score:null}]}}i(r),w(l),D(r,l)}catch(t){console.error("Error loading map data:",t),x.error("Failed to load listening map")}finally{k(!1)}}},D=(e,s)=>{const t=[];e.forEach((e,a)=>{const r=Math.floor(a/5),l=a%5,n=160*(r%2==0?l:4-l)+50,i=150*r+20,o=s.find(s=>s.test_id===e.id)||{test_id:e.id,status:"locked"};t.push({test:e,progress:o,position:{x:n,y:i}})}),C(t)},O=e=>{t(`/skills/listening-for-details/test/${e.test.id}`)},R=e=>{switch(e){case"completed":return"bg-gradient-to-br from-yellow-400 to-orange-500 text-white shadow-lg border-yellow-300 hover:shadow-xl transform hover:scale-105";case"unlocked":return"bg-gradient-to-br from-orange-400 to-red-500 text-white shadow-lg border-orange-300 hover:shadow-xl transform hover:scale-105 cursor-pointer";default:return"bg-gray-200 text-gray-500 border-gray-300 cursor-not-allowed"}};return N?r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx(o,{size:"lg",message:"Loading your listening journey..."})}):s?r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 via-red-50 to-pink-50 p-6",children:r.jsxs("div",{className:"max-w-6xl mx-auto",children:[r.jsxs("div",{className:"text-center mb-4",children:[r.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:"Listening for Details Journey"}),r.jsx(c,{className:"max-w-md mx-auto bg-white/80 backdrop-blur-sm",children:r.jsxs(d,{className:"p-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-sm font-medium",children:"Overall Progress"}),r.jsxs("span",{className:"text-sm text-gray-600",children:[v.filter(e=>"completed"===e.status).length," / ",n.length]})]}),r.jsx(h,{value:(()=>{const e=v.filter(e=>"completed"===e.status).length;return n.length>0?e/n.length*100:0})(),className:"h-3"})]})})]}),r.jsx(c,{className:"relative bg-white/60 backdrop-blur-sm border-2 border-white/80 shadow-xl",children:r.jsx(d,{className:"pt-4 pb-8 px-8",children:r.jsxs("div",{className:"relative mx-auto",style:{width:"900px",height:"700px",minHeight:"600px"},children:[(()=>{if(_.length<2)return null;let e=`M ${_[0].position.x+50} ${_[0].position.y+50}`;for(let s=1;s<_.length;s++){const t=_[s-1],a=_[s];e+=` Q ${(t.position.x+a.position.x)/2+50} ${(t.position.y+a.position.y)/2+50+30*Math.sin(.5*s)} ${a.position.x+50} ${a.position.y+50}`}return r.jsxs("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{zIndex:1},children:[r.jsx("path",{d:e,stroke:"url(#pathGradient)",strokeWidth:"4",fill:"none",strokeDasharray:"8,4",className:"animate-pulse"}),r.jsx("defs",{children:r.jsxs("linearGradient",{id:"pathGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[r.jsx("stop",{offset:"0%",stopColor:"#F97316"}),r.jsx("stop",{offset:"50%",stopColor:"#EF4444"}),r.jsx("stop",{offset:"100%",stopColor:"#DC2626"})]})})]})})(),_.map((t,a)=>{return r.jsxs("div",{className:"absolute",style:{left:`${t.position.x}px`,top:`${t.position.y}px`,zIndex:10},children:["locked"===t.progress.status?r.jsxs(E,{children:[r.jsx(L,{asChild:!0,children:r.jsxs(p,{children:[r.jsx(g,{asChild:!0,children:r.jsxs("div",{className:`relative w-24 h-24 rounded-full border-4 flex items-center justify-center transition-all duration-300 ease-in-out ${R(t.progress.status)} hover:cursor-pointer`,onClick:()=>O(t),children:[r.jsx("img",{src:P(a).image,alt:`${P(a).name} level icon`,className:"absolute inset-0 w-full h-full rounded-full object-cover transform scale-90",loading:"lazy"}),r.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 rounded-full",children:r.jsx(q,{className:"w-8 h-8 text-white"})})]})}),r.jsx(f,{side:"top",children:a>0?`Complete the ${P(a-1).name} Level to unlock! Or double-click to unlock manually.`:"This is the first level."})]})}),r.jsxs(A,{children:[r.jsxs(z,{children:[r.jsxs(B,{children:["Unlock ",P(a).name," Level?"]}),r.jsxs(I,{children:["Do you want to unlock this level? This will allow you to start the ",P(a).name," listening test."]})]}),r.jsxs(F,{children:[r.jsx(M,{children:"Cancel"}),r.jsx(T,{onClick:()=>(async t=>{if(s)try{await e.from("user_test_progress").upsert({user_id:s.id,test_id:t.test.id,status:"unlocked"},{onConflict:"user_id,test_id"}),x.success(`${P(_.indexOf(t)).name} Level unlocked!`),$()}catch(a){console.error("Error unlocking level:",a),x.error("Failed to unlock level")}})(t),children:"Yes, Unlock Level"})]})]})]}):r.jsxs("div",{className:`relative w-24 h-24 rounded-full border-4 flex items-center justify-center transition-all duration-300 ease-in-out ${R(t.progress.status)}`,onClick:()=>O(t),children:[r.jsx("img",{src:P(a).image,alt:`${P(a).name} level icon`,className:"absolute inset-0 w-full h-full rounded-full object-cover transform scale-90",loading:"lazy"}),"unlocked"===t.progress.status&&r.jsx("div",{className:"absolute bottom-1 right-1",children:r.jsx(j,{className:"w-4 h-4 text-orange-500"})}),"completed"===t.progress.status&&t.progress.completed_score&&r.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2",children:(n=t.progress.completed_score,l=n>=90?3:n>=70?2:1,r.jsx("div",{className:"flex items-center justify-center",children:[1,2,3].map(e=>r.jsx(y,{className:"w-6 h-6 "+(e<=l?"text-yellow-400 fill-current":"text-gray-300"),style:{transform:`rotate(${15*(e-2)}deg) translateY(${2===e?"0px":"4px"})`,margin:"0 2px"}},e))}))})]}),r.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 w-32 text-center",children:r.jsxs("p",{className:"text-[10px] font-medium text-muted-foreground truncate",children:[P(a).name," Level"]})})]},t.test.id);var l,n})]})})}),r.jsx("div",{className:"text-center mt-8 space-x-4",children:r.jsxs(l,{variant:"outline",onClick:()=>t("/ielts-portal"),className:"bg-white/80 backdrop-blur-sm hover:bg-white",children:[r.jsx(b,{className:"w-4 h-4 mr-2 rotate-180"}),"Back to IELTS Portal"]})})]})}):r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx(c,{className:"p-8 text-center",children:r.jsxs(d,{children:[r.jsx("p",{className:"text-lg mb-4",children:"Please sign in to access your listening journey."}),r.jsx(l,{onClick:()=>t("/auth"),className:"bg-primary text-primary-foreground hover:bg-primary/90",children:"Sign In"})]})})})},H=()=>{const{user:s}=m(),t=u(),[n,i]=a.useState([]),[o,h]=a.useState(!0);a.useEffect(()=>{s?p():h(!1)},[s]);const p=async()=>{if(s){h(!0);try{const s=await e.from("skill_tests").select("id, title, test_order").eq("skill_slug","synonym-match").order("test_order",{ascending:!0});if(s.error)throw s.error;i(s.data||[])}catch(t){console.error("Error loading map data:",t),x.error("Failed to load synonym match data")}finally{h(!1)}}};return o?r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx(c,{className:"p-8 text-center",children:r.jsxs(d,{children:[r.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4"}),r.jsx("p",{className:"text-lg",children:"Loading synonym match..."})]})})}):s?r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-teal-50 via-emerald-50 to-green-50 p-6",children:r.jsxs("div",{className:"max-w-6xl mx-auto",children:[r.jsxs("div",{className:"text-center mb-8",children:[r.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:"Synonym Match Journey"}),r.jsx("p",{className:"text-muted-foreground",children:"Coming soon! This skill is under development."})]}),r.jsx(c,{className:"bg-white/60 backdrop-blur-sm border-2 border-white/80 shadow-xl",children:r.jsx(d,{className:"p-8 text-center",children:r.jsxs("div",{className:"space-y-6",children:[r.jsx("div",{className:"w-32 h-32 mx-auto bg-gradient-to-br from-teal-400 to-emerald-500 rounded-full flex items-center justify-center",children:r.jsx("div",{className:"text-4xl",children:"ðŸ”„"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Under Construction"}),r.jsx("p",{className:"text-muted-foreground mb-4",children:"We're working hard to bring you an amazing Synonym Match experience!"}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"This feature will help you master synonyms and expand your vocabulary."})]})]})})}),r.jsx("div",{className:"text-center mt-8",children:r.jsx(l,{variant:"outline",onClick:()=>t("/ielts-portal"),className:"bg-white/80 backdrop-blur-sm hover:bg-white",children:"Back to IELTS Portal"})})]})}):r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx(c,{className:"p-8 text-center",children:r.jsxs(d,{children:[r.jsx("p",{className:"text-lg mb-4",children:"Please sign in to access synonym match."}),r.jsx(l,{onClick:()=>t("/auth"),className:"bg-primary text-primary-foreground hover:bg-primary/90",children:"Sign In"})]})})})},U=()=>{const{user:s}=m(),t=u(),[n,i]=a.useState([]),[h,p]=a.useState(!0);a.useEffect(()=>{s?g():p(!1)},[s]);const g=async()=>{if(s){p(!0);try{const s=await e.from("skill_tests").select("id, title, test_order").eq("skill_slug","collocation-connect").order("test_order",{ascending:!0});if(s.error)throw s.error;i(s.data||[])}catch(t){console.error("Error loading map data:",t),x.error("Failed to load collocation connect data")}finally{p(!1)}}};return h?r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx(o,{size:"lg",message:"Loading collocation connect..."})}):s?r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 via-yellow-50 to-orange-50 p-6",children:r.jsxs("div",{className:"max-w-6xl mx-auto",children:[r.jsxs("div",{className:"text-center mb-8",children:[r.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:"Collocation Connect Journey"}),r.jsx("p",{className:"text-muted-foreground",children:"Coming soon! This skill is under development."})]}),r.jsx(c,{className:"bg-white/60 backdrop-blur-sm border-2 border-white/80 shadow-xl",children:r.jsx(d,{className:"p-8 text-center",children:r.jsxs("div",{className:"space-y-6",children:[r.jsx("div",{className:"w-32 h-32 mx-auto bg-gradient-to-br from-amber-400 to-orange-500 rounded-full flex items-center justify-center",children:r.jsx("div",{className:"text-4xl",children:"ðŸ”—"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Under Construction"}),r.jsx("p",{className:"text-muted-foreground mb-4",children:"We're working hard to bring you an amazing Collocation Connect experience!"}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"This feature will help you master word collocations and natural language patterns."})]})]})})}),r.jsx("div",{className:"text-center mt-8",children:r.jsx(l,{variant:"outline",onClick:()=>t("/ielts-portal"),className:"bg-white/80 backdrop-blur-sm hover:bg-white",children:"Back to IELTS Portal"})})]})}):r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx(c,{className:"p-8 text-center",children:r.jsxs(d,{children:[r.jsx("p",{className:"text-lg mb-4",children:"Please sign in to access collocation connect."}),r.jsx(l,{onClick:()=>t("/auth"),className:"bg-primary text-primary-foreground hover:bg-primary/90",children:"Sign In"})]})})})},K=()=>{const{slug:e}=v(),t=u(),n=a.useMemo(()=>e?S(e):void 0,[e]),[i,o]=a.useState([]),[m,x]=a.useState([]),[p,g]=a.useState([]),[f,j]=a.useState([]),[b,y]=a.useState(""),[E,L]=a.useState(""),[A,z]=a.useState(0),[B,I]=a.useState(!1),[F,M]=a.useState(!1),[T,q]=a.useState(null),[K,V]=a.useState(""),[J,W]=a.useState(null),[Q,X]=a.useState(!1),[Z,ee]=a.useState(!0),[se,te]=a.useState(null);a.useEffect(()=>{n&&(document.title=`${n.label} | Practice`,"vocabulary-builder"===e||"grammar-fix-it"===e||"paraphrasing-challenge"===e||"sentence-structure-scramble"===e||"listening-for-details"===e?re():"pronunciation-repeat-after-me"===e?le():ae())},[null==n?void 0:n.label]),a.useEffect(()=>{const t=(async()=>{if(!n)return;const{supabase:t}=await s(async()=>{const{supabase:e}=await import("./supabase-DWL4C3fA.js").then(e=>e.b);return{supabase:e}},[]),a=t.channel("realtime-skill-questions").on("postgres_changes",{event:"*",schema:"public",table:"skill_practice_questions"},s=>{var t,a;((null==(t=null==s?void 0:s.new)?void 0:t.skill_type)??(null==(a=null==s?void 0:s.old)?void 0:a.skill_type))===n.label&&("vocabulary-builder"===e||"grammar-fix-it"===e||"paraphrasing-challenge"===e||"sentence-structure-scramble"===e?re():ae())}).subscribe();return()=>{t.removeChannel(a)}})();return()=>{t.then(e=>null==e?void 0:e())}},[null==n?void 0:n.label]);const ae=async()=>{if(!n)return;const{supabase:e}=await s(async()=>{const{supabase:e}=await import("./supabase-DWL4C3fA.js").then(e=>e.b);return{supabase:e}},[]),{data:t,error:a}=await e.from("skill_practice_questions").select("id, content").eq("skill_type",n.label).order("created_at",{ascending:!1});a||o(t??[])},re=async()=>{if(!e)return;const{supabase:t}=await s(async()=>{const{supabase:e}=await import("./supabase-DWL4C3fA.js").then(e=>e.b);return{supabase:e}},[]),{data:a,error:r}=await t.from("skill_tests").select("id,title").eq("skill_slug",e).order("created_at",{ascending:!1});r||x(a??[])},le=async()=>{const{supabase:e}=await s(async()=>{const{supabase:e}=await import("./supabase-DWL4C3fA.js").then(e=>e.b);return{supabase:e}},[]),{data:t,error:a}=await e.from("pronunciation_tests").select("id,title").eq("is_published",!0).order("created_at",{ascending:!1});!a&&t&&g(t)},ne=async e=>{W(e),X(!1),se&&await(async e=>{const{supabase:t}=await s(async()=>{const{supabase:e}=await import("./supabase-DWL4C3fA.js").then(e=>e.b);return{supabase:e}},[]),{data:a,error:r}=await t.from("pronunciation_items").select("id, reference_text, audio_url_uk, audio_url_us, order_index").eq("test_id",e).order("order_index",{ascending:!0});!r&&a&&(j(a),z(0),M(!1),I(!1))})(se.id)},ie=()=>{W(null),te(null),j([]),z(0),M(!1),I(!1),q(null),V(""),ee(!0)};if(a.useEffect(()=>{(async()=>{var e,t,a;if(!F||!E)return;const{supabase:r}=await s(async()=>{const{supabase:e}=await import("./supabase-DWL4C3fA.js").then(e=>e.b);return{supabase:e}},[]),{data:l}=await r.auth.getUser(),n=null==(e=null==l?void 0:l.user)?void 0:e.id;if(!n)return;const{data:i,error:o}=await r.from("pronunciation_results").select("overall_score, analysis_json, created_at").eq("user_id",n).eq("test_id",E).order("created_at",{ascending:!1}).limit(10);if(o)return;const c=i??[],d=c.map(e=>e.overall_score).filter(e=>"number"==typeof e);d.length?q(Math.round(d.reduce((e,s)=>e+s,0)/d.length)):q(null);const m=null==(a=null==(t=c[0])?void 0:t.analysis_json)?void 0:a.overallSummary;V("string"==typeof m?m:"")})()},[F,E]),"pronunciation-repeat-after-me"===e){const e=Math.min(10,f.length||10),s=e?A/e*100:0,a=f.slice(0,10)[A];return Z?r.jsxs(w,{title:"PTE Repeat Sentence",showBackButton:!0,backPath:"/ielts-portal",children:[r.jsx("section",{className:"mx-auto px-4 max-w-4xl",children:r.jsxs("div",{className:"min-h-[60vh] flex flex-col items-center justify-center gap-6",children:[r.jsxs("div",{className:"text-center space-y-2",children:[r.jsx("h1",{className:"text-2xl font-bold",children:"Repeat Sentence Practice"}),r.jsx("p",{className:"text-muted-foreground",children:"Listen to the audio and repeat exactly what you hear. Choose a test to begin."})]}),0===p.length?r.jsx(c,{className:"w-full max-w-md",children:r.jsx(d,{className:"p-6 text-center",children:r.jsx("p",{className:"text-muted-foreground",children:"No tests available yet. Please check back soon."})})}):r.jsx("div",{className:"grid gap-4 w-full max-w-2xl",children:p.map((e,s)=>r.jsx(c,{className:"cursor-pointer hover:shadow-lg transition-all duration-200 hover:scale-[1.02]",onClick:()=>(e=>{te(e),y(e.title),L(e.id),ee(!1),X(!0)})(e),children:r.jsxs(d,{className:"p-6 flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"font-semibold",children:e.title}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"10 sentences â€¢ PTE difficulty"})]}),r.jsx(l,{variant:"outline",size:"sm",children:"Start"})]})},e.id))})]})}),r.jsx(N,{open:Q,onOpenChange:e=>{e||(X(!1),ee(!0))},children:r.jsxs(k,{className:"sm:max-w-md",children:[r.jsx(_,{children:r.jsx(C,{className:"text-center text-xl",children:"Choose Your Accent"})}),r.jsx("p",{className:"text-center text-muted-foreground text-sm mb-4",children:"Select the accent you want to practice with"}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs(l,{variant:"outline",className:"h-24 flex flex-col items-center justify-center gap-2 hover:border-primary hover:bg-primary/5",onClick:()=>ne("uk"),children:[r.jsx("span",{className:"text-3xl",children:"ðŸ‡¬ðŸ‡§"}),r.jsx("span",{className:"font-medium",children:"British"})]}),r.jsxs(l,{variant:"outline",className:"h-24 flex flex-col items-center justify-center gap-2 hover:border-primary hover:bg-primary/5",onClick:()=>ne("us"),children:[r.jsx("span",{className:"text-3xl",children:"ðŸ‡ºðŸ‡¸"}),r.jsx("span",{className:"font-medium",children:"American"})]})]})]})})]}):r.jsx(w,{title:(null==n?void 0:n.label)||"Pronunciation",showBackButton:!0,backPath:"/ielts-portal",children:r.jsx("section",{className:"mx-auto px-4",children:r.jsxs("div",{className:"min-h-[70vh] flex flex-col items-center justify-center gap-4",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[r.jsxs("span",{children:["uk"===J?"ðŸ‡¬ðŸ‡§ British":"ðŸ‡ºðŸ‡¸ American"," Accent"]}),r.jsx(l,{variant:"ghost",size:"sm",onClick:ie,children:"Change"})]}),r.jsx("div",{className:"w-full max-w-3xl md:max-w-4xl lg:max-w-5xl",children:r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"absolute -top-10 h-10 flex items-center justify-center -translate-x-1/2 transition-[left] duration-300 ease-out",style:{left:`${s}%`},"aria-label":"Progress mascot",title:"Keep going!",children:r.jsx("img",{src:"/lovable-uploads/27e74cd0-58d8-4b55-b31a-fdb162f21e8b.png",alt:"Pronunciation progress turtle mascot",className:"w-12 h-12 object-contain drop-shadow animate-[turtle-legs_900ms_ease-in-out_infinite]",loading:"lazy"})}),r.jsx("style",{children:"@keyframes turtle-legs { 0% { transform: translateY(0) rotate(0deg) } 25% { transform: translateY(-1px) rotate(-2deg) } 50% { transform: translateY(0) rotate(0deg) } 75% { transform: translateY(-1px) rotate(2deg) } 100% { transform: translateY(0) rotate(0deg) } }"}),r.jsx(h,{value:s})]})}),0===f.length?r.jsx(c,{className:"border-light-border",children:r.jsx(d,{className:"p-4",children:r.jsx("p",{className:"text-muted-foreground text-sm",children:"Loading sentences..."})})}):F?r.jsx(c,{className:"w-full max-w-3xl md:max-w-4xl lg:max-w-5xl",children:r.jsxs(d,{className:"p-6 space-y-6",children:[r.jsx("div",{className:"flex justify-center",children:r.jsx(P,{})}),r.jsxs("div",{className:"space-y-2 text-center",children:[r.jsx("div",{className:"text-2xl font-semibold",children:"Great job!"}),r.jsxs("div",{className:"text-muted-foreground",children:["You completed ",b||"this set","."]})]}),r.jsxs("div",{className:"text-center space-y-1 animate-fade-in",children:[r.jsx("p",{className:"text-xs font-medium",children:"Overall Pronunciation Score"}),r.jsxs("p",{className:"text-4xl font-bold text-primary",children:[T??"-"," / 100"]}),K&&r.jsx("p",{className:"text-sm text-muted-foreground max-w-2xl mx-auto",children:K})]}),r.jsxs("div",{className:"flex gap-2 justify-center",children:[r.jsx(l,{onClick:()=>{z(0),M(!1),I(!1),q(null),V("")},children:"Retry"}),r.jsx(l,{variant:"secondary",onClick:ie,children:"Choose Another Test"}),r.jsx(l,{variant:"outline",onClick:()=>t("/ielts-portal"),children:"Back to Portal"})]})]})}):a?r.jsx(c,{className:"w-full max-w-3xl md:max-w-4xl lg:max-w-5xl border-light-border",children:r.jsxs(d,{className:"p-6 space-y-4",children:[b&&r.jsxs("div",{className:"text-sm text-muted-foreground",children:[b," â€” Sentence ",A+1," of ",e]}),r.jsx(D,{item:{...a,order_index:A+1,audio_url:"uk"===J?a.audio_url_uk:a.audio_url_us},testId:E,selectedAccent:J||"us",onAnalyzed:()=>I(!0)}),r.jsx("div",{className:"pt-2",children:r.jsx(l,{onClick:()=>{A+1>=e?M(!0):(z(e=>e+1),I(!1))},disabled:!B,children:"Continue"})})]})}):r.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading..."})]})})})}return"vocabulary-builder"===e?r.jsx($,{}):"grammar-fix-it"===e?r.jsx(O,{}):"paraphrasing-challenge"===e?r.jsx(R,{}):"sentence-structure-scramble"===e?r.jsx(Y,{}):"listening-for-details"===e?r.jsx(G,{}):"synonym-match"===e?r.jsx(H,{}):"collocation-connect"===e?r.jsx(U,{}):"sentence-mastery"===e?(window.location.href="/ai-speaking",r.jsx(w,{title:"AI Speaking Tutor",showBackButton:!0,backPath:"/ielts-portal",children:r.jsx("section",{className:"space-y-4 max-w-3xl mx-auto",children:r.jsx("p",{className:"text-muted-foreground text-sm",children:"Redirecting to AI Speaking Tutor..."})})})):r.jsx(w,{title:(null==n?void 0:n.label)||"Practice",showBackButton:!0,backPath:"/ielts-portal",children:r.jsx("section",{className:"space-y-4 max-w-3xl mx-auto",children:0===i.length?r.jsx("p",{className:"text-muted-foreground text-sm",children:"No questions yet. Please check back soon."}):i.map(e=>r.jsx(c,{className:"border-light-border",children:r.jsx(d,{className:"p-4",children:r.jsx("p",{className:"whitespace-pre-wrap leading-relaxed",children:e.content})})},e.id))})})};export{K as default};
