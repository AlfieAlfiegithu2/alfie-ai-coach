import{u as e,c as s,r as t,j as a}from"./vendor-react-rLLBBC7n.js";import{s as r,J as n,B as i,e as o,P as l,C as c,a as d,b as m,c as u,R as x,L as h,p as b}from"./index-KxDfHqNJ.js";import{H as p}from"./Header-orWSRply.js";import{b4 as j,aA as g,aK as N,aL as v,aw as f,at as _,a9 as w,x as q,aa as y}from"./vendor-ui-BGi_EvHx.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-charts-0DeywwxG.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";import"./dropdown-menu-BeB6Wuy0.js";const k={1:{name:"Photos",questions:6,description:"Look at the photo and choose the statement that best describes it"},2:{name:"Question-Response",questions:25,description:"Listen and choose the best response"},3:{name:"Conversations",questions:39,description:"Listen to conversations and answer questions"},4:{name:"Talks",questions:30,description:"Listen to talks and answer questions"}},S=()=>{var S,C;const E=e(),{testId:P}=s(),L=t.useRef(null),[T,I]=t.useState(!0),[O,Q]=t.useState(""),[$,z]=t.useState([]),[B,R]=t.useState(0),[U,A]=t.useState(0),[F,H]=t.useState({}),[J,M]=t.useState(!1),[K,V]=t.useState(2700),[D,G]=t.useState(!1),[W,X]=t.useState(!1);t.useEffect(()=>{P&&Y()},[P]),t.useEffect(()=>{if(!D&&K>0){const e=setInterval(()=>{V(e=>e-1)},1e3);return()=>clearInterval(e)}0!==K||D||ae()},[K,D]);const Y=async()=>{if(P)try{const{data:e,error:s}=await r.from("tests").select("*").eq("id",P).single();if(s)throw s;Q(e.test_name);const{data:t,error:a}=await r.from("questions").select("*").eq("test_id",P).order("toeic_part",{ascending:!0}).order("question_number_in_part",{ascending:!0});if(a)throw a;const n={};null==t||t.forEach(e=>{const s=e.toeic_part||1;n[s]||(n[s]=[]),n[s].push({id:e.id,question_number:e.question_number_in_part,question_text:e.question_text,question_type:e.question_type,options:e.choices?JSON.parse(e.choices):null,correct_answer:e.correct_answer,toeic_part:s,audio_url:e.audio_url,image_url:e.image_url,ai_explanation:e.ai_explanation})});const i=Object.entries(n).map(([e,s])=>{var t;return{partNumber:parseInt(e),questions:s,audioUrl:null==(t=s[0])?void 0:t.audio_url}}).sort((e,s)=>e.partNumber-s.partNumber);z(i)}catch(e){console.error("Error loading test:",e),n.error("Failed to load test")}finally{I(!1)}},Z=$[B],ee=null==Z?void 0:Z.questions[U],se=$.reduce((e,s)=>e+s.questions.length,0),te=Object.keys(F).length,ae=async()=>{G(!0),X(!0);let e=0;$.forEach(s=>{s.questions.forEach(s=>{F[s.question_number]===s.correct_answer&&e++})}),n.success(`Test submitted! Score: ${e}/${se}`)};return T?a.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),a.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading test..."})]})}):0===$.length?a.jsxs("div",{className:"min-h-screen bg-background",children:[a.jsx(p,{}),a.jsxs("div",{className:"container mx-auto px-4 py-8 text-center",children:[a.jsx(j,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4"}),a.jsx("h2",{className:"text-2xl font-bold mb-2",children:"No Questions Found"}),a.jsx("p",{className:"text-muted-foreground mb-4",children:"This test doesn't have any questions yet."}),a.jsx(i,{onClick:()=>E("/toeic"),children:"Back to TOEIC Portal"})]})]}):a.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 dark:from-gray-950 dark:via-gray-900 dark:to-gray-950",children:[a.jsx(p,{}),a.jsxs("div",{className:"container mx-auto px-4 py-4 max-w-4xl",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-xl font-bold",children:O}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"TOEIC Listening Test"})]}),a.jsx("div",{className:"flex items-center gap-4",children:a.jsxs(o,{variant:K<300?"destructive":"secondary",className:"text-lg px-3 py-1",children:[a.jsx(g,{className:"w-4 h-4 mr-1"}),(e=>{const s=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`})(K)]})})]}),a.jsxs("div",{className:"mb-4",children:[a.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[a.jsxs("span",{children:["Progress: ",te,"/",se," answered"]}),a.jsxs("span",{children:[Math.round(te/se*100),"%"]})]}),a.jsx(l,{value:te/se*100,className:"h-2"})]}),a.jsx("div",{className:"flex gap-2 mb-4 overflow-x-auto pb-2",children:$.map((e,s)=>a.jsxs(i,{variant:s===B?"default":"outline",size:"sm",onClick:()=>{R(s),A(0)},className:"whitespace-nowrap",children:["Part ",e.partNumber,a.jsxs(o,{variant:"secondary",className:"ml-1 text-xs",children:[e.questions.filter(e=>F[e.question_number]).length,"/",e.questions.length]})]},e.partNumber))}),(null==Z?void 0:Z.audioUrl)&&a.jsx(c,{className:"mb-4 bg-gradient-to-r from-blue-500 to-indigo-500 text-white",children:a.jsx(d,{className:"p-4",children:a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx(i,{variant:"secondary",size:"icon",onClick:()=>{L.current&&(J?L.current.pause():L.current.play(),M(!J))},className:"bg-white/20 hover:bg-white/30",children:J?a.jsx(N,{className:"w-5 h-5"}):a.jsx(v,{className:"w-5 h-5"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("audio",{ref:L,src:Z.audioUrl,onEnded:()=>M(!1)}),a.jsxs("p",{className:"text-sm font-medium",children:["Part ",Z.partNumber," Audio"]}),a.jsx("p",{className:"text-xs opacity-80",children:null==(S=k[Z.partNumber])?void 0:S.name})]}),a.jsx(f,{className:"w-5 h-5 opacity-80"})]})})}),ee&&a.jsxs(c,{className:"mb-4",children:[a.jsx(m,{children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs(u,{className:"text-lg",children:["Question ",ee.question_number]}),a.jsxs(o,{variant:"outline",children:["Part ",Z.partNumber,": ",null==(C=k[Z.partNumber])?void 0:C.name]})]})}),a.jsxs(d,{children:[ee.image_url&&a.jsx("div",{className:"mb-4",children:a.jsx("img",{src:ee.image_url,alt:"Question image",className:"max-w-full h-auto rounded-lg border"})}),a.jsx("p",{className:"mb-4 text-lg",children:ee.question_text}),ee.options&&a.jsx(x,{value:F[ee.question_number]||"",onValueChange:e=>{return s=ee.question_number,t=e,void H(e=>({...e,[s]:t}));var s,t},children:a.jsx("div",{className:"space-y-3",children:ee.options.map((e,s)=>{const t=String.fromCharCode(65+s),r=F[ee.question_number]===t,n=W&&t===ee.correct_answer,i=W&&r&&t!==ee.correct_answer;return a.jsxs(h,{className:"flex items-center gap-3 p-4 rounded-lg border cursor-pointer transition-all "+(n?"bg-green-50 border-green-300 dark:bg-green-950/20":i?"bg-red-50 border-red-300 dark:bg-red-950/20":r?"bg-blue-50 border-blue-300 dark:bg-blue-950/20":"hover:bg-gray-50 dark:hover:bg-gray-800"),children:[a.jsx(b,{value:t,disabled:D}),a.jsxs("span",{className:"font-medium mr-2",children:["(",t,")"]}),a.jsx("span",{className:"flex-1",children:e}),W&&n&&a.jsx(_,{className:"w-5 h-5 text-green-500"}),W&&i&&a.jsx(j,{className:"w-5 h-5 text-red-500"})]},s)})})}),W&&ee.ai_explanation&&a.jsxs("div",{className:"mt-4 p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg",children:[a.jsx("h4",{className:"font-semibold text-blue-700 dark:text-blue-400 mb-2",children:"Explanation"}),a.jsx("p",{className:"text-sm",children:ee.ai_explanation})]})]})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs(i,{variant:"outline",onClick:()=>{U>0?A(e=>e-1):B>0&&(R(e=>e-1),A($[B-1].questions.length-1))},disabled:0===B&&0===U,children:[a.jsx(w,{className:"w-4 h-4 mr-1"}),"Previous"]}),D?a.jsx(i,{onClick:()=>E("/toeic"),children:"Back to Portal"}):a.jsxs(i,{onClick:ae,className:"bg-orange-600 hover:bg-orange-700",children:[a.jsx(q,{className:"w-4 h-4 mr-1"}),"Submit Test"]}),a.jsxs(i,{variant:"outline",onClick:()=>{U<Z.questions.length-1?A(e=>e+1):B<$.length-1&&(R(e=>e+1),A(0))},disabled:B===$.length-1&&U===Z.questions.length-1,children:["Next",a.jsx(y,{className:"w-4 h-4 ml-1"})]})]}),a.jsxs(c,{className:"mt-4",children:[a.jsx(m,{className:"py-3",children:a.jsx(u,{className:"text-sm",children:"Question Navigator"})}),a.jsx(d,{className:"pb-4",children:a.jsx("div",{className:"flex flex-wrap gap-2",children:null==Z?void 0:Z.questions.map((e,s)=>{const t=!!F[e.question_number],r=s===U,n=W&&F[e.question_number]===e.correct_answer,o=W&&F[e.question_number]&&F[e.question_number]!==e.correct_answer;return a.jsx(i,{variant:"outline",size:"sm",className:"w-10 h-10 p-0 "+(n?"bg-green-100 border-green-300 text-green-700":o?"bg-red-100 border-red-300 text-red-700":r?"bg-blue-100 border-blue-300":t?"bg-gray-100":""),onClick:()=>A(s),children:e.question_number},e.question_number)})})})]})]})]})};export{S as default};
