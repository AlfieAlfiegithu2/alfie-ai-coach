import{u as e,G as s,a1 as t,r,J as a,j as n,B as o,l as i,W as l,K as c,C as d,b as m,d as u,F as x,a as b,_ as h,R as g,$ as p,L as j,Q as v,a0 as N,k as _}from"./index-BPt0WcNZ.js";import{S as E}from"./scroll-area-DBXjDTAw.js";import{H as f}from"./Header-7VDaLUE3.js";import{s as q}from"./supabase-DWL4C3fA.js";import{C as w}from"./circle-alert-C47UWVXS.js";import"./dropdown-menu-y2xYqpUp.js";import"./shield-BBpdMrUZ.js";const y={5:{name:"Incomplete Sentences",questions:40,description:"Choose the word or phrase that best completes the sentence"},6:{name:"Text Completion",questions:12,description:"Complete the passage with the correct word or phrase"},7:{name:"Reading Comprehension",questions:48,description:"Read the passage and answer questions"}},D=()=>{var D;const A=e(),{testId:B}=s(),k="note"===t().theme.name,[S,C]=r.useState(!0),[F,I]=r.useState(""),[P,T]=r.useState([]),[$,O]=r.useState(0),[R,Q]=r.useState(0),[z,H]=r.useState({}),[J,L]=r.useState(4500),[M,G]=r.useState(!1),[K,V]=r.useState(!1);r.useEffect(()=>{B&&W()},[B]),r.useEffect(()=>{if(!M&&J>0){const e=setInterval(()=>{L(e=>e-1)},1e3);return()=>clearInterval(e)}0!==J||M||se()},[J,M]);const W=async()=>{if(B)try{const{data:e,error:s}=await q.from("tests").select("*").eq("id",B).single();if(s)throw s;I(e.test_name);const{data:t,error:r}=await q.from("questions").select("*").eq("test_id",B).order("toeic_part",{ascending:!0}).order("question_number_in_part",{ascending:!0});if(r)throw r;const{data:a,error:n}=await q.from("toeic_passages").select("*").eq("test_id",B).order("question_range_start",{ascending:!0}),o={5:{questions:[],passages:[]},6:{questions:[],passages:[]},7:{questions:[],passages:[]}};null==t||t.forEach(e=>{const s=e.toeic_part||5;o[s]&&o[s].questions.push({id:e.id,question_number:e.question_number_in_part,question_text:e.question_text,question_type:e.question_type,options:e.choices?JSON.parse(e.choices):null,correct_answer:e.correct_answer,toeic_part:s,passage_context:e.passage_context,ai_explanation:e.ai_explanation})}),null==a||a.forEach(e=>{const s=e.part_number;o[s]&&o[s].passages.push({id:e.id,title:e.passage_title,content:e.passage_content,type:e.passage_type,questionStart:e.question_range_start,questionEnd:e.question_range_end})});const i=Object.entries(o).filter(([e,s])=>s.questions.length>0).map(([e,s])=>({partNumber:parseInt(e),questions:s.questions,passages:s.passages})).sort((e,s)=>e.partNumber-s.partNumber);T(i)}catch(e){console.error("Error loading test:",e),a.error("Failed to load test")}finally{C(!1)}},U=P[$],X=null==U?void 0:U.questions[R],Y=P.reduce((e,s)=>e+s.questions.length,0),Z=Object.keys(z).length,ee=null==U?void 0:U.passages.find(e=>X&&X.question_number>=e.questionStart&&X.question_number<=e.questionEnd),se=async()=>{G(!0),V(!0);let e=0;P.forEach(s=>{s.questions.forEach(s=>{z[s.question_number]===s.correct_answer&&e++})}),a.success(`Test submitted! Score: ${e}/${Y}`)};return S?n.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),n.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading test..."})]})}):0===P.length?n.jsxs("div",{className:"min-h-screen bg-background",children:[n.jsx(f,{}),n.jsxs("div",{className:"container mx-auto px-4 py-8 text-center",children:[n.jsx(w,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4"}),n.jsx("h2",{className:"text-2xl font-bold mb-2",children:"No Questions Found"}),n.jsx("p",{className:"text-muted-foreground mb-4",children:"This test doesn't have any questions yet."}),n.jsx(o,{onClick:()=>A("/toeic"),children:"Back to TOEIC Portal"})]})]}):n.jsxs("div",{className:"min-h-screen "+(k?"bg-[#FEF9E7]":"bg-gradient-to-br from-green-50 via-white to-emerald-50 dark:from-gray-950 dark:via-gray-900 dark:to-gray-950"),children:[n.jsx(f,{}),n.jsxs("div",{className:"container mx-auto px-4 py-4 max-w-6xl",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-xl font-bold",style:{color:k?"#5D4E37":void 0},children:F}),n.jsx("p",{className:"text-sm",style:{color:k?"#8B6914":void 0},children:"TOEIC Reading Test"})]}),n.jsx("div",{className:"flex items-center gap-4",children:n.jsxs(i,{variant:J<300?"destructive":"secondary",className:"text-lg px-3 py-1 "+(k?"bg-[#FEF9E7] text-[#8B6914] border-[#E8D5A3] border":""),children:[n.jsx(l,{className:"w-4 h-4 mr-1"}),(e=>{const s=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`})(J)]})})]}),n.jsxs("div",{className:"mb-4",children:[n.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",style:{color:k?"#8B6914":void 0},children:[n.jsxs("span",{children:["Progress: ",Z,"/",Y," answered"]}),n.jsxs("span",{children:[Math.round(Z/Y*100),"%"]})]}),n.jsx(c,{value:Z/Y*100,className:"h-2 "+(k?"bg-[#E8D5A3]":"")})]}),n.jsx("div",{className:"flex gap-2 mb-4 overflow-x-auto pb-2",children:P.map((e,s)=>n.jsxs(o,{variant:s===$?"default":"outline",size:"sm",onClick:()=>{O(s),Q(0)},className:"whitespace-nowrap "+(k?s===$?"bg-[#A68B5B] hover:bg-[#8B6914] text-white":"border-[#E8D5A3] text-[#5D4E37] hover:bg-[#E8D5A3]/20 bg-transparent":""),children:["Part ",e.partNumber,n.jsxs(i,{variant:"secondary",className:"ml-1 text-xs "+(k?s===$?"bg-white/20 text-white":"bg-[#FEF9E7] text-[#8B6914] border border-[#E8D5A3]":""),children:[e.questions.filter(e=>z[e.question_number]).length,"/",e.questions.length]})]},e.partNumber))}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[(6===(null==U?void 0:U.partNumber)||7===(null==U?void 0:U.partNumber))&&(ee||(null==X?void 0:X.passage_context))&&n.jsxs(d,{className:"md:h-[600px] "+(k?"bg-[#FEF9E7] border-[#E8D5A3]":""),children:[n.jsx(m,{className:"py-3",children:n.jsxs(u,{className:"text-sm flex items-center gap-2",style:{color:k?"#5D4E37":void 0},children:[n.jsx(x,{className:"w-4 h-4 "+(k?"text-[#8B6914]":"")}),(null==ee?void 0:ee.title)||"Reading Passage"]})}),n.jsx(b,{className:"p-0",children:n.jsx(E,{className:"h-[520px] px-4",children:n.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none pb-4",children:n.jsx("div",{className:"whitespace-pre-wrap text-sm leading-relaxed",style:{color:k?"#5D4E37":void 0},children:(null==ee?void 0:ee.content)||(null==X?void 0:X.passage_context)})})})})]}),n.jsxs(d,{className:`${6!==(null==U?void 0:U.partNumber)&&7!==(null==U?void 0:U.partNumber)||!ee&&!(null==X?void 0:X.passage_context)?"md:col-span-2":""} ${k?"bg-[#FEF9E7] border-[#E8D5A3]":""}`,children:[n.jsx(m,{children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs(u,{className:"text-lg",style:{color:k?"#5D4E37":void 0},children:["Question ",null==X?void 0:X.question_number]}),n.jsxs(i,{variant:"outline",className:k?"border-[#E8D5A3] text-[#8B6914] bg-transparent":"",children:["Part ",null==U?void 0:U.partNumber,": ",null==(D=y[null==U?void 0:U.partNumber])?void 0:D.name]})]})}),n.jsx(b,{children:X&&n.jsxs(n.Fragment,{children:[n.jsx("p",{className:"mb-4 text-lg leading-relaxed",style:{color:k?"#5D4E37":void 0},children:X.question_text}),X.options&&n.jsx(h,{value:z[X.question_number]||"",onValueChange:e=>{return s=X.question_number,t=e,void H(e=>({...e,[s]:t}));var s,t},children:n.jsx("div",{className:"space-y-3",children:X.options.map((e,s)=>{const t=String.fromCharCode(65+s),r=z[X.question_number]===t,a=K&&t===X.correct_answer,o=K&&r&&t!==X.correct_answer;return n.jsxs(g,{className:"flex items-center gap-3 p-4 rounded-lg border cursor-pointer transition-all "+(a?"bg-green-50 border-green-300 dark:bg-green-950/20":o?"bg-red-50 border-red-300 dark:bg-red-950/20":r?k?"bg-[#E8D5A3]/30 border-[#A68B5B]":"bg-green-50 border-green-300 dark:bg-green-950/20":k?"bg-white/50 border-[#E8D5A3] hover:border-[#A68B5B]/50":"hover:bg-gray-50 dark:hover:bg-gray-800"),children:[n.jsx(p,{value:t,disabled:M,className:k?"text-[#A68B5B] border-[#A68B5B]":""}),n.jsxs("span",{className:"font-medium mr-2 "+(k?"text-[#5D4E37]":""),children:["(",t,")"]}),n.jsx("span",{className:"flex-1 "+(k?"text-[#5D4E37]":""),children:e}),K&&a&&n.jsx(j,{className:"w-5 h-5 text-green-500"}),K&&o&&n.jsx(w,{className:"w-5 h-5 text-red-500"})]},s)})})}),K&&X.ai_explanation&&n.jsxs("div",{className:"mt-4 p-4 rounded-lg "+(k?"bg-[#E8D5A3]/20 border border-[#E8D5A3]":"bg-blue-50 dark:bg-blue-950/20"),children:[n.jsx("h4",{className:"font-semibold mb-2 "+(k?"text-[#8B6914]":"text-blue-700 dark:text-blue-400"),children:"Explanation"}),n.jsx("p",{className:"text-sm "+(k?"text-[#5D4E37]":""),children:X.ai_explanation})]})]})})]})]}),n.jsxs("div",{className:"flex items-center justify-between mt-4",children:[n.jsxs(o,{variant:"outline",onClick:()=>{R>0?Q(e=>e-1):$>0&&(O(e=>e-1),Q(P[$-1].questions.length-1))},disabled:0===$&&0===R,className:k?"border-[#E8D5A3] text-[#5D4E37] hover:bg-[#E8D5A3]/20":"",children:[n.jsx(v,{className:"w-4 h-4 mr-1"}),"Previous"]}),M?n.jsx(o,{onClick:()=>A("/toeic"),className:k?"bg-[#A68B5B] hover:bg-[#8B6914] text-white":"",children:"Back to Portal"}):n.jsxs(o,{onClick:se,className:k?"bg-[#A68B5B] hover:bg-[#8B6914] text-white":"bg-orange-600 hover:bg-orange-700",children:[n.jsx(N,{className:"w-4 h-4 mr-1"}),"Submit Test"]}),n.jsxs(o,{variant:"outline",onClick:()=>{R<U.questions.length-1?Q(e=>e+1):$<P.length-1&&(O(e=>e+1),Q(0))},disabled:$===P.length-1&&R===U.questions.length-1,className:k?"border-[#E8D5A3] text-[#5D4E37] hover:bg-[#E8D5A3]/20":"",children:["Next",n.jsx(_,{className:"w-4 h-4 ml-1"})]})]}),n.jsxs(d,{className:"mt-4 "+(k?"bg-[#FEF9E7] border-[#E8D5A3]":""),children:[n.jsx(m,{className:"py-3",children:n.jsx(u,{className:"text-sm",style:{color:k?"#5D4E37":void 0},children:"Question Navigator"})}),n.jsx(b,{className:"pb-4",children:n.jsx("div",{className:"flex flex-wrap gap-2",children:null==U?void 0:U.questions.map((e,s)=>{const t=!!z[e.question_number],r=s===R,a=K&&z[e.question_number]===e.correct_answer,i=K&&z[e.question_number]&&z[e.question_number]!==e.correct_answer;return n.jsx(o,{variant:"outline",size:"sm",className:"w-10 h-10 p-0 "+(a?"bg-green-100 border-green-300 text-green-700":i?"bg-red-100 border-red-300 text-red-700":r?k?"bg-[#A68B5B] text-white border-[#A68B5B]":"bg-green-100 border-green-300":t?k?"bg-[#E8D5A3] text-[#5D4E37] border-[#E8D5A3]":"bg-gray-100":k?"bg-transparent border-[#E8D5A3] text-[#5D4E37] hover:bg-[#E8D5A3]/20":""),onClick:()=>Q(s),children:e.question_number},e.question_number)})})})]})]})]})};export{D as default};
