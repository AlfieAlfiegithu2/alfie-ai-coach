import{c as e,u as s,G as t,a1 as a,r,J as n,j as o,B as l,C as i,b as d,d as c,F as m,a as u,_ as h,R as x,$ as g,L as b,Q as p,a2 as v,a3 as j,a4 as f,N as w,E as N,a0 as _,k as q}from"./index-DYtCQA4x.js";import{S as y}from"./scroll-area-D9pVi3jv.js";import{s as E}from"./supabase-DWL4C3fA.js";import{C as k}from"./circle-alert-Cjvs9EOX.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=e("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),D=()=>{const e=s(),{testId:D}=t(),B="note"===a().theme.name,[S,F]=r.useState(!0),[C,I]=r.useState(""),[P,Q]=r.useState([]),[$,M]=r.useState(0),[T,O]=r.useState(0),[G,H]=r.useState({}),[J,L]=r.useState([]),[R,z]=r.useState(4500),[V,K]=r.useState(!1),[U,W]=r.useState(!1);r.useEffect(()=>{D&&X()},[D]),r.useEffect(()=>{if(!V&&R>0){const e=setInterval(()=>{z(e=>e-1)},1e3);return()=>clearInterval(e)}0!==R||V||te()},[R,V]);const X=async()=>{if(D)try{const{data:e,error:s}=await E.from("tests").select("*").eq("id",D).single();if(s)throw s;I(e.test_name);const{data:t,error:a}=await E.from("questions").select("*").eq("test_id",D).order("toeic_part",{ascending:!0}).order("question_number_in_part",{ascending:!0});if(a)throw a;const{data:r,error:n}=await E.from("toeic_passages").select("*").eq("test_id",D).order("question_range_start",{ascending:!0});if(n)throw n;const o={5:{questions:[],passages:[]},6:{questions:[],passages:[]},7:{questions:[],passages:[]}};null==t||t.forEach(e=>{const s=e.toeic_part||5;o[s]&&o[s].questions.push({id:e.id,question_number:e.question_number_in_part,question_text:e.question_text,question_type:e.question_type,options:e.choices?JSON.parse(e.choices):null,correct_answer:e.correct_answer,toeic_part:s,passage_context:e.passage_context,ai_explanation:e.ai_explanation})}),null==r||r.forEach(e=>{const s=e.part_number;o[s]&&o[s].passages.push({id:e.id,title:e.passage_title,content:e.passage_content,type:e.passage_type,questionStart:e.question_range_start,questionEnd:e.question_range_end})});const l=Object.entries(o).filter(([e,s])=>s.questions.length>0).map(([e,s])=>({partNumber:parseInt(e),questions:s.questions,passages:s.passages})).sort((e,s)=>e.partNumber-s.partNumber);Q(l)}catch(e){console.error("Error loading test:",e),n.error("Failed to load test")}finally{F(!1)}},Y=P[$],Z=null==Y?void 0:Y.questions[T],ee=P.reduce((e,s)=>e+s.questions.length,0),se=null==Y?void 0:Y.passages.find(e=>Z&&Z.question_number>=e.questionStart&&Z.question_number<=e.questionEnd),te=async()=>{K(!0),W(!0);let s=0;P.forEach(e=>{e.questions.forEach(e=>{G[e.question_number]===e.correct_answer&&s++})}),n.success(`Test submitted! Score: ${s}/${ee}`),e("/toeic/reading/result",{state:{score:s,totalQuestions:ee,answers:G,groupedParts:P,testName:C}})},ae=Y&&$===P.length-1&&T===Y.questions.length-1;return S?o.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),o.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading test..."})]})}):0===P.length?o.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:o.jsxs("div",{className:"container mx-auto px-4 py-8 text-center max-w-2xl",children:[o.jsx(k,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4"}),o.jsx("h2",{className:"text-2xl font-bold mb-2",children:"No Questions Found"}),o.jsx("p",{className:"text-muted-foreground mb-4",children:"This test doesn't have any questions yet."}),o.jsx(l,{onClick:()=>e("/toeic"),children:"Back to TOEIC Portal"})]})}):o.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center py-8 "+(B?"bg-[#FEF9E7]":"bg-gradient-to-br from-green-50 via-white to-emerald-50 dark:from-gray-950 dark:via-gray-900 dark:to-gray-950"),children:o.jsxs("div",{className:"container px-4 max-w-6xl w-full",children:[o.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[(6===(null==Y?void 0:Y.partNumber)||7===(null==Y?void 0:Y.partNumber))&&(se||(null==Z?void 0:Z.passage_context))&&o.jsxs(i,{className:"md:h-[600px] "+(B?"bg-[#FEF9E7] border-[#E8D5A3]":""),children:[o.jsx(d,{className:"py-3",children:o.jsxs(c,{className:"text-sm flex items-center gap-2",style:{color:B?"#5D4E37":void 0},children:[o.jsx(m,{className:"w-4 h-4 "+(B?"text-[#8B6914]":"")}),(null==se?void 0:se.title)||"Reading Passage"]})}),o.jsx(u,{className:"p-0",children:o.jsx(y,{className:"h-[520px] px-4",children:o.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none pb-4",children:o.jsx("div",{className:"whitespace-pre-wrap text-sm leading-relaxed",style:{color:B?"#5D4E37":void 0},children:(null==se?void 0:se.content)||(null==Z?void 0:Z.passage_context)})})})})]}),o.jsxs(i,{className:`${6!==(null==Y?void 0:Y.partNumber)&&7!==(null==Y?void 0:Y.partNumber)||!se&&!(null==Z?void 0:Z.passage_context)?"md:col-span-2":""} ${B?"bg-[#FEF9E7] border-[#E8D5A3]":""}`,children:[o.jsx(d,{className:"flex flex-row items-center justify-between pb-2",children:o.jsxs(c,{className:"text-lg",style:{color:B?"#5D4E37":void 0},children:["Question ",null==Z?void 0:Z.question_number]})}),o.jsx(u,{children:Z&&o.jsxs(o.Fragment,{children:[o.jsx("p",{className:"mb-4 text-lg leading-relaxed",style:{color:B?"#5D4E37":void 0},children:Z.question_text}),Z.options&&o.jsx(h,{value:G[Z.question_number]||"",onValueChange:e=>{return s=Z.question_number,t=e,void H(e=>({...e,[s]:t}));var s,t},children:o.jsx("div",{className:"space-y-3",children:Z.options.map((e,s)=>{const t=String.fromCharCode(65+s),a=G[Z.question_number]===t,r=J.includes(Z.question_number),n=(U||r)&&t===Z.correct_answer,l=(U||r)&&a&&t!==Z.correct_answer;return o.jsxs(x,{className:"flex items-center gap-3 p-4 rounded-lg border cursor-pointer transition-all "+(n?"bg-green-50 border-green-300 dark:bg-green-950/20":l?"bg-red-50 border-red-300 dark:bg-red-950/20":a?B?"bg-[#E8D5A3]/30 border-[#A68B5B]":"bg-green-50 border-green-300 dark:bg-green-950/20":B?"bg-white/50 border-[#E8D5A3] hover:border-[#A68B5B]/50":"hover:bg-gray-50 dark:hover:bg-gray-800"),children:[o.jsx(g,{value:t,disabled:V,className:"sr-only"}),o.jsxs("span",{className:"font-medium mr-2 "+(B?"text-[#5D4E37]":""),children:["(",t,")"]}),o.jsx("span",{className:"flex-1 "+(B?"text-[#5D4E37]":""),children:e}),(U||r)&&n&&o.jsx(b,{className:"w-5 h-5 text-green-500"}),(U||r)&&l&&o.jsx(k,{className:"w-5 h-5 text-red-500"})]},s)})})}),(U||J.includes(Z.question_number))&&Z.ai_explanation&&o.jsxs("div",{className:"mt-4 p-4 rounded-lg "+(B?"bg-[#E8D5A3]/20 border border-[#E8D5A3]":"bg-blue-50 dark:bg-blue-950/20"),children:[o.jsx("h4",{className:"font-semibold mb-2 "+(B?"text-[#8B6914]":"text-blue-700 dark:text-blue-400"),children:"Explanation"}),o.jsx("p",{className:"text-sm "+(B?"text-[#5D4E37]":""),children:Z.ai_explanation})]})]})})]})]}),o.jsxs("div",{className:"flex items-center justify-between mt-8 px-4 relative",children:[o.jsx(l,{variant:"ghost",onClick:()=>{T>0?O(e=>e-1):$>0&&(M(e=>e-1),O(P[$-1].questions.length-1))},disabled:0===$&&0===T,className:"w-12 h-12 rounded-full p-0 transition-all duration-200 "+(B?"bg-[#E8D5A3]/20 text-[#5D4E37] hover:bg-[#E8D5A3]/40 disabled:opacity-30":"bg-white shadow-md text-slate-600 hover:text-emerald-600 hover:bg-white hover:shadow-lg hover:-translate-y-0.5 disabled:opacity-30 disabled:shadow-none dark:bg-gray-800 dark:text-gray-300 dark:hover:text-emerald-400"),children:o.jsx(p,{className:"w-6 h-6"})}),o.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:o.jsxs(v,{children:[o.jsx(j,{asChild:!0,children:o.jsxs(l,{variant:"ghost",className:"flex items-center gap-2 px-4 py-2 rounded-full shadow-sm transition-all border "+(B?"bg-[#FEF9E7] border-[#E8D5A3] text-[#5D4E37] hover:bg-[#E8D5A3]/20":"bg-white border-slate-200 text-slate-600 hover:bg-slate-50 hover:text-emerald-600 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300"),children:[o.jsx(A,{className:"w-4 h-4"}),o.jsxs("span",{className:"font-medium",children:[T+1," / ",null==Y?void 0:Y.questions.length]})]})}),o.jsx(f,{className:"w-80 p-4 "+(B?"bg-[#FEF9E7] border-[#E8D5A3]":""),align:"center",side:"top",children:o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("h4",{className:"font-medium "+(B?"text-[#5D4E37]":""),children:"Question Navigator"}),o.jsxs("span",{className:"text-xs "+(B?"text-[#8B6914]":"text-muted-foreground"),children:["Part ",null==Y?void 0:Y.partNumber]})]}),o.jsx(y,{className:"h-[200px]",children:o.jsx("div",{className:"grid grid-cols-5 gap-2",children:null==Y?void 0:Y.questions.map((e,s)=>{const t=!!G[e.question_number],a=s===T,r=U&&G[e.question_number]===e.correct_answer,n=U&&G[e.question_number]&&G[e.question_number]!==e.correct_answer;return o.jsx(l,{variant:"outline",size:"sm",className:"h-9 w-full p-0 text-xs "+(r?"bg-green-100 border-green-300 text-green-700":n?"bg-red-100 border-red-300 text-red-700":a?B?"bg-[#A68B5B] text-white border-[#A68B5B]":"bg-emerald-600 text-white border-emerald-600":t?B?"bg-[#E8D5A3] text-[#5D4E37] border-[#E8D5A3]":"bg-emerald-50 text-emerald-700 border-emerald-200":B?"bg-transparent border-[#E8D5A3] text-[#5D4E37] hover:bg-[#E8D5A3]/20":""),onClick:()=>O(s),children:e.question_number},e.question_number)})})})]})})]})}),V?o.jsx(l,{onClick:()=>e("/toeic"),className:"px-6 rounded-full shadow-md transition-all "+(B?"bg-[#A68B5B] hover:bg-[#8B6914] text-white":"bg-slate-800 text-white hover:bg-slate-700"),children:"Back to Portal"}):o.jsxs("div",{className:"flex items-center gap-4",children:[Z&&!U&&o.jsx(l,{variant:"ghost",onClick:()=>{return e=Z.question_number,void(J.includes(e)?L(s=>s.filter(s=>s!==e)):L(s=>[...s,e]));var e},className:"rounded-full px-4 py-2 transition-all duration-200 gap-2 "+(B?"text-[#A68B5B] hover:bg-[#E8D5A3]/20":"text-slate-500 hover:text-emerald-600 hover:bg-slate-50 dark:text-slate-400 dark:hover:text-emerald-400 dark:hover:bg-slate-800"),title:J.includes(Z.question_number)?"Hide Answer":"Show Answer",children:J.includes(Z.question_number)?o.jsxs(o.Fragment,{children:[o.jsx(w,{className:"w-5 h-5"}),o.jsx("span",{className:"text-sm font-medium",children:"Hide Answer"})]}):o.jsxs(o.Fragment,{children:[o.jsx(N,{className:"w-5 h-5"}),o.jsx("span",{className:"text-sm font-medium",children:"Show Answer"})]})}),ae?o.jsxs(l,{onClick:te,className:"px-8 py-6 rounded-full shadow-md text-base font-medium transition-all duration-200 "+(B?"bg-[#A68B5B] hover:bg-[#8B6914] text-white hover:shadow-lg hover:-translate-y-0.5":"bg-gradient-to-r from-emerald-500 to-green-600 text-white hover:shadow-lg hover:shadow-green-500/20 hover:-translate-y-0.5"),children:["Submit Test",o.jsx(_,{className:"w-4 h-4 ml-2"})]}):o.jsx(l,{onClick:()=>{T<Y.questions.length-1?O(e=>e+1):$<P.length-1&&(M(e=>e+1),O(0))},variant:"ghost",className:"w-12 h-12 rounded-full p-0 transition-all duration-200 "+(B?"bg-[#A68B5B] text-white hover:bg-[#8B6914] shadow-sm hover:shadow-md":"bg-white shadow-md text-emerald-600 hover:bg-white hover:shadow-lg hover:-translate-y-0.5 dark:bg-gray-800 dark:text-emerald-400"),children:o.jsx(q,{className:"w-6 h-6"})})]})]})]})})};export{D as default};
