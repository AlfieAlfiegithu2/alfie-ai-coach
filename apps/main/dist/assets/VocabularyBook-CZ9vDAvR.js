import{u as e,r as a,j as s,N as r}from"./vendor-react-rLLBBC7n.js";import{E as l,q as t,y as n,I as o,S as i,i as d,j as c,k as m,l as x,A as h,a as u,e as g,B as f,D as p,f as b,g as j,h as v,s as N}from"./index-BDl0jLJK.js";import{f as y,a as w}from"./d1Client-DHU_uMQx.js";import{aW as k,an as C,G as S,c5 as L,aL as $,aN as E,aw as _}from"./vendor-ui-BGi_EvHx.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-charts-0DeywwxG.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";const B=[{code:"ko",name:"í•œêµ­ì–´",flag:"ðŸ‡°ðŸ‡·"},{code:"ja",name:"æ—¥æœ¬èªž",flag:"ðŸ‡¯ðŸ‡µ"},{code:"zh",name:"ä¸­æ–‡",flag:"ðŸ‡¨ðŸ‡³"},{code:"zh-TW",name:"ç¹é«”ä¸­æ–‡",flag:"ðŸ‡¹ðŸ‡¼"},{code:"vi",name:"Tiáº¿ng Viá»‡t",flag:"ðŸ‡»ðŸ‡³"},{code:"th",name:"à¹„à¸—à¸¢",flag:"ðŸ‡¹ðŸ‡­"},{code:"id",name:"Bahasa Indonesia",flag:"ðŸ‡®ðŸ‡©"},{code:"ms",name:"Bahasa Melayu",flag:"ðŸ‡²ðŸ‡¾"},{code:"es",name:"EspaÃ±ol",flag:"ðŸ‡ªðŸ‡¸"},{code:"fr",name:"FranÃ§ais",flag:"ðŸ‡«ðŸ‡·"},{code:"de",name:"Deutsch",flag:"ðŸ‡©ðŸ‡ª"},{code:"pt",name:"PortuguÃªs",flag:"ðŸ‡§ðŸ‡·"},{code:"ru",name:"Ð ÑƒÑÑÐºÐ¸Ð¹",flag:"ðŸ‡·ðŸ‡º"},{code:"ar",name:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",flag:"ðŸ‡¸ðŸ‡¦"},{code:"hi",name:"à¤¹à¤¿à¤¨à¥à¤¦à¥€",flag:"ðŸ‡®ðŸ‡³"},{code:"bn",name:"à¦¬à¦¾à¦‚à¦²à¦¾",flag:"ðŸ‡§ðŸ‡©"},{code:"tr",name:"TÃ¼rkÃ§e",flag:"ðŸ‡¹ðŸ‡·"},{code:"fa",name:"ÙØ§Ø±Ø³ÛŒ",flag:"ðŸ‡®ðŸ‡·"},{code:"ur",name:"Ø§Ø±Ø¯Ùˆ",flag:"ðŸ‡µðŸ‡°"},{code:"en",name:"English",flag:"ðŸ‡¬ðŸ‡§"}],V=["bg-emerald-100 text-emerald-800 border-emerald-200","bg-sky-100 text-sky-800 border-sky-200","bg-violet-100 text-violet-800 border-violet-200","bg-orange-100 text-orange-800 border-orange-200"],M=["Level 1","Level 2","Level 3","Level 4"];function P(){const{user:P,loading:z}=l(),A=e(),I=t(),[T,q]=a.useState(!0),[D,O]=a.useState([]),[U,W]=a.useState({}),[F,G]=a.useState({}),[H,J]=a.useState("ko"),[K,Q]=a.useState(""),[R,X]=a.useState(null),[Y,Z]=a.useState(null);a.useEffect(()=>{(async()=>{if(P)try{const{data:e}=await N.from("profiles").select("native_language").eq("id",P.id).single();(null==e?void 0:e.native_language)&&J(e.native_language)}catch(e){console.error("Error loading user preferences:",e)}})()},[P]),a.useEffect(()=>{(async()=>{q(!0);try{const e=await y({limit:1e4});console.log("VocabularyBook: Loaded",e.length,"cards from D1");const a={};if(H&&"en"!==H){const e=await w(H);Object.entries(e).forEach(([e,s])=>{a[e]||(a[e]={}),a[e][H]=s})}W(a);const{data:s}=await N.from("vocab_images").select("card_id, url"),r={};null==s||s.forEach(e=>{r[e.card_id]=e.url}),G(r);const l=Math.ceil(e.length/4),t=e.map((e,a)=>{let s=e.level||1;return(s>4||s<1)&&(s=Math.floor(a/l)+1,s>4&&(s=4)),{id:e.id,term:e.term,translation:e.term,pos:e.pos,ipa:e.ipa,context_sentence:e.context_sentence,level:s}}),n=null!==R?t.filter(e=>e.level===R):t;O(n)}catch(e){console.error("VocabularyBook: Error loading data:",e)}finally{q(!1)}})()},[P,R,H]);const ee=a.useMemo(()=>{const e=K.toLowerCase();let a=e?D.filter(a=>{var s;return a.term.toLowerCase().includes(e)||(a.translation||"").toLowerCase().includes(e)||((null==(s=U[a.id])?void 0:s[H])||"").toLowerCase().includes(e)}):D;const s={};a.forEach(e=>{const a=e.level||1;s[a]||(s[a]=[]),s[a].push(e)});const r=[];return Object.entries(s).sort(([e],[a])=>Number(e)-Number(a)).forEach(([e,a])=>{const s=Number(e),l=M[s-1]||`Level ${e}`;for(let t=0;t<a.length;t+=20){const s=a.slice(t,t+20),n=Math.floor(t/20)+1,o=Math.ceil(a.length/20);r.push({id:`${e}-${n}`,name:1===o?`${l} Vocabulary`:`${l} - Set ${n}`,cards:s})}}),r},[D,K,U,H]),ae=B.find(e=>e.code===H);return z?s.jsx(n,{title:"Loading...",children:s.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),s.jsx("p",{className:"text-muted-foreground",children:"Loading vocabulary..."})]})})}):z||P?s.jsxs("div",{className:"min-h-screen relative",children:[s.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"note"===I.theme.name||"minimalist"===I.theme.name||"dark"===I.theme.name?"none":"url('/1000031207.png')",backgroundColor:I.backgroundImageColor}}),s.jsx("div",{className:"relative z-10",children:s.jsx(n,{title:"Vocabulary Book",showBackButton:!0,backPath:"/dashboard",children:s.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[s.jsx("div",{className:"bg-white/80 backdrop-blur-md rounded-2xl p-6 mb-8 border border-white/20 shadow-lg",children:s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[s.jsxs("div",{className:"relative flex-1",children:[s.jsx(k,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),s.jsx(o,{placeholder:"Search words or translations...",value:K,onChange:e=>Q(e.target.value),className:"pl-10 h-11 bg-white/50 border-gray-200 focus:ring-primary/20 rounded-xl"})]}),s.jsxs(i,{value:(null==R?void 0:R.toString())||"all",onValueChange:e=>X("all"===e?null:Number(e)),children:[s.jsxs(d,{className:"w-[180px] h-11 bg-white/50 border-gray-200 focus:ring-primary/20 rounded-xl",children:[s.jsx(C,{className:"w-4 h-4 mr-2 text-muted-foreground"}),s.jsx(c,{placeholder:"All Levels"})]}),s.jsxs(m,{children:[s.jsx(x,{value:"all",children:"All Levels"}),M.map((e,a)=>s.jsx(x,{value:(a+1).toString(),children:e},a+1))]})]}),s.jsxs(i,{value:H,onValueChange:async e=>{if(J(e),P)try{await N.from("profiles").update({native_language:e}).eq("id",P.id)}catch(a){console.error("Error saving language preference:",a)}},children:[s.jsxs(d,{className:"w-[180px] h-11 bg-white/50 border-gray-200 focus:ring-primary/20 rounded-xl",children:[s.jsx(S,{className:"w-4 h-4 mr-2 text-muted-foreground"}),s.jsx(c,{children:ae&&`${ae.flag} ${ae.name}`})]}),s.jsx(m,{className:"max-h-[300px]",children:B.map(e=>s.jsxs(x,{value:e.code,children:[e.flag," ",e.name]},e.code))})]})]})}),T?s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),s.jsx("p",{className:"text-muted-foreground",children:"Loading vocabulary..."})]}):0===ee.length?s.jsxs("div",{className:"text-center py-12 bg-white/50 rounded-2xl border border-white/20",children:[s.jsx(L,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground/50"}),s.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No words found"}),s.jsx("p",{className:"text-muted-foreground",children:K?"Try a different search term":"Start learning to build your vocabulary!"})]}):s.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:ee.map(e=>{const a=parseInt(e.id.split("-")[0])||1,r=V[a-1]||V[0];return s.jsx(h,{className:"cursor-pointer group h-full bg-white/80 hover:bg-white/90 border-white/20",onClick:()=>Z(e),children:s.jsxs(u,{className:"p-6 flex flex-col h-full",children:[s.jsxs("div",{className:"flex items-start justify-between mb-4",children:[s.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center shadow-sm ${r.replace("text-","bg-").split(" ")[0]} bg-opacity-20`,children:s.jsx(L,{className:`w-6 h-6 ${r.split(" ")[1]}`})}),s.jsxs(g,{variant:"outline",className:`${r}`,children:["Level ",a]})]}),s.jsx("h3",{className:"text-xl font-bold mb-2 group-hover:text-primary transition-colors",children:e.name}),s.jsxs("p",{className:"text-muted-foreground text-sm mb-6 flex-1",children:[e.cards.length," words to master"]}),s.jsxs("div",{className:"flex items-center gap-2 mt-auto pt-4 border-t border-gray-100",children:[s.jsxs(f,{className:"flex-1 bg-primary hover:bg-primary/90 text-white rounded-xl",onClick:a=>{a.stopPropagation(),A(`/vocabulary/test/${e.id}`)},children:[s.jsx($,{className:"w-4 h-4 mr-2"}),"Practice"]}),s.jsxs(f,{variant:"outline",className:"flex-1 rounded-xl hover:bg-gray-50",onClick:a=>{a.stopPropagation(),Z(e)},children:[s.jsx(E,{className:"w-4 h-4 mr-2"}),"View"]})]})]})},e.id)})})]})})}),s.jsx(p,{open:!!Y,onOpenChange:e=>!e&&Z(null),children:s.jsxs(b,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[s.jsx(j,{children:s.jsxs(v,{className:"text-2xl font-bold flex items-center gap-3",children:[s.jsx(L,{className:"w-6 h-6 text-primary"}),null==Y?void 0:Y.name]})}),s.jsx("div",{className:"mt-6 space-y-4",children:null==Y?void 0:Y.cards.map(e=>{var a;const r=(null==(a=U[e.id])?void 0:a[H])||e.translation||"",l=F[e.id];return s.jsxs("div",{className:"p-4 rounded-xl bg-gray-50 border border-gray-100 flex items-start gap-4 hover:bg-gray-100 transition-colors",children:[l?s.jsx("div",{className:"w-16 h-16 flex-shrink-0 rounded-lg overflow-hidden bg-white border border-gray-200 shadow-sm",children:s.jsx("img",{src:l,alt:e.term,className:"w-full h-full object-cover",loading:"lazy"})}):s.jsx("div",{className:"w-16 h-16 flex-shrink-0 rounded-lg bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center border border-gray-200",children:s.jsx("span",{className:"text-2xl",children:e.term.charAt(0).toUpperCase()})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-1",children:[s.jsx("span",{className:"font-bold text-lg",children:e.term}),e.pos&&s.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-gray-200 text-gray-700 font-medium",children:e.pos}),e.ipa&&s.jsxs("span",{className:"text-sm text-muted-foreground font-mono",children:["/",e.ipa,"/"]})]}),s.jsx("div",{className:"text-primary font-medium mb-1",children:r}),e.context_sentence&&s.jsxs("p",{className:"text-sm text-muted-foreground italic truncate",children:['"',e.context_sentence,'"']})]}),s.jsx(f,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-primary flex-shrink-0",onClick:()=>{const a=new SpeechSynthesisUtterance(e.term);a.lang="en-US",speechSynthesis.speak(a)},children:s.jsx(_,{className:"w-5 h-5"})})]},e.id)})}),s.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t",children:[s.jsx(f,{variant:"outline",onClick:()=>Z(null),children:"Close"}),s.jsxs(f,{onClick:()=>{Y&&A(`/vocabulary/test/${Y.id}`)},children:[s.jsx($,{className:"w-4 h-4 mr-2"}),"Start Practice"]})]})]})})]}):s.jsx(r,{to:"/auth",replace:!0})}export{P as default};
