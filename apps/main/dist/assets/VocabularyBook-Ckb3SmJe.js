import{A as e,r as n,j as t,N as s,Z as a,C as l,a as i,I as o,S as r,o as d,p as c,q as u,s as m,k as x,B as p,W as h}from"./index-ZP4Rea1h.js";import{s as v}from"./supabase-DUkWVuqu.js";function _(){const{user:_,loading:g}=e(),[j,f]=n.useState(!0),[b,N]=n.useState([]),[w,y]=n.useState({}),[k,C]=n.useState("ko"),[S,q]=n.useState("");n.useEffect(()=>{(async()=>{if(_)try{const{data:e}=await v.from("profiles").select("native_language").eq("id",_.id).single();(null==e?void 0:e.native_language)&&C(e.native_language)}catch(e){console.error("Error loading user preferences:",e)}})()},[_]),n.useEffect(()=>{(async()=>{if(f(!0),!_)return N([]),void f(!1);const{data:e}=await v.from("vocab_cards").select("id, term, translation, pos, ipa, context_sentence, user_id").eq("is_public",!0).order("created_at",{ascending:!1}).limit(5e3),{data:n}=await v.from("vocab_translations").select("card_id, lang, translations"),t={};null==n||n.forEach(e=>{var n;t[e.card_id]||(t[e.card_id]={}),t[e.card_id][e.lang]=(null==(n=e.translations)?void 0:n[0])||""}),y(t);const s=e||[];if(s.length)N(s);else try{const e=[{id:"demo-1",term:"local",translation:"지역의",pos:"adj",ipa:null,context_sentence:null},{id:"demo-2",term:"update",translation:"업데이트하다",pos:"verb",ipa:null,context_sentence:null},{id:"demo-3",term:"issue",translation:"문제",pos:"noun",ipa:null,context_sentence:null},{id:"demo-4",term:"cause",translation:"원인",pos:"noun",ipa:null,context_sentence:null},{id:"demo-5",term:"supply",translation:"공급",pos:"noun",ipa:null,context_sentence:null},{id:"demo-6",term:"demand",translation:"수요",pos:"noun",ipa:null,context_sentence:null},{id:"demo-7",term:"policy",translation:"정책",pos:"noun",ipa:null,context_sentence:null},{id:"demo-8",term:"climate",translation:"기후",pos:"noun",ipa:null,context_sentence:null},{id:"demo-9",term:"shortage",translation:"부족",pos:"noun",ipa:null,context_sentence:null},{id:"demo-10",term:"expand",translation:"확장하다",pos:"verb",ipa:null,context_sentence:null},{id:"demo-11",term:"negotiate",translation:"협상하다",pos:"verb",ipa:null,context_sentence:null},{id:"demo-12",term:"impact",translation:"영향",pos:"noun",ipa:null,context_sentence:null},{id:"demo-13",term:"infrastructure",translation:"사회 기반 시설",pos:"noun",ipa:null,context_sentence:null},{id:"demo-14",term:"regulation",translation:"규제",pos:"noun",ipa:null,context_sentence:null},{id:"demo-15",term:"forecast",translation:"전망, 예보",pos:"noun",ipa:null,context_sentence:null},{id:"demo-16",term:"initiative",translation:"주도권/계획",pos:"noun",ipa:null,context_sentence:null},{id:"demo-17",term:"sustainable",translation:"지속 가능한",pos:"adj",ipa:null,context_sentence:null},{id:"demo-18",term:"emissions",translation:"배출",pos:"noun",ipa:null,context_sentence:null},{id:"demo-19",term:"innovation",translation:"혁신",pos:"noun",ipa:null,context_sentence:null},{id:"demo-20",term:"resilience",translation:"회복 탄력성",pos:"noun",ipa:null,context_sentence:null}],{data:n}=await v.from("vocab_decks").insert({user_id:_.id,name:"Demo: General News (20 words)"}).select("id").single(),t=(null==n?void 0:n.id)||null,s=e.map(e=>({user_id:_.id,deck_id:t,language:"en",term:e.term,translation:e.translation,pos:e.pos,level:1,is_public:!0}));await v.from("vocab_cards").insert(s);const{data:a}=await v.from("vocab_cards").select("id, term, translation, pos, ipa, context_sentence, user_id").eq("is_public",!0).order("created_at",{ascending:!1}).limit(5e3);N(a||[])}catch{N([])}f(!1)})()},[_]);const E=n.useMemo(()=>{const e=S.toLowerCase();return e?b.filter(n=>n.term.toLowerCase().includes(e)||(n.translation||"").toLowerCase().includes(e)):b},[b,S]);return g?t.jsx("div",{className:"min-h-screen flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),t.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading..."})]})}):g||_?t.jsx(a,{title:"Vocabulary Book",showBackButton:!0,children:t.jsxs("div",{className:"space-y-4",children:[t.jsx(l,{children:t.jsxs(i,{className:"p-4 flex items-center gap-3",children:[t.jsx(o,{placeholder:"Search word or translation",value:S,onChange:e=>q(e.target.value)}),t.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[t.jsxs(r,{value:k,onValueChange:async e=>{if(C(e),_)try{await v.from("profiles").update({native_language:e}).eq("id",_.id)}catch(n){console.error("Error saving language preference:",n)}},children:[t.jsx(d,{className:"w-[120px]",children:t.jsx(c,{placeholder:"Language"})}),t.jsxs(u,{children:[t.jsx(m,{value:"ko",children:"한국어"}),t.jsx(m,{value:"ja",children:"日本語"}),t.jsx(m,{value:"zh",children:"中文"}),t.jsx(m,{value:"es",children:"Español"}),t.jsx(m,{value:"fr",children:"Français"}),t.jsx(m,{value:"de",children:"Deutsch"}),t.jsx(m,{value:"en",children:"English"})]})]}),t.jsxs(x,{variant:"secondary",children:[E.length," words"]})]})]})}),t.jsx(l,{children:t.jsx(i,{className:"p-0",children:j?t.jsx("div",{className:"p-6 text-sm text-muted-foreground",children:"Loading words…"}):t.jsxs("div",{className:"divide-y",children:[E.map(e=>{var n;const s=(null==(n=w[e.id])?void 0:n[k])||e.translation||"";return t.jsxs("div",{className:"p-4 flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"font-medium text-foreground",children:[e.term," ",e.pos?t.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",e.pos,")"]}):null]}),t.jsx("div",{className:"text-sm text-blue-600 font-medium",children:s}),e.context_sentence&&t.jsxs("div",{className:"text-xs text-muted-foreground italic",children:['"',e.context_sentence,'"']}),Object.keys(w[e.id]||{}).length>1&&t.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:Object.entries(w[e.id]||{}).filter(([e])=>e!==k).slice(0,2).map(([e,n])=>t.jsxs("span",{className:"mr-2",children:[e.toUpperCase(),": ",String(n)]},e))})]}),e.user_id===_.id&&t.jsx(p,{size:"sm",variant:"outline",onClick:()=>(async e=>{_&&e.user_id&&e.user_id===_.id&&(await v.from("vocab_cards").delete().eq("id",e.id).eq("user_id",_.id),N(n=>n.filter(n=>n.id!==e.id)))})(e),children:"Remove"})]},e.id)}),0===E.length&&t.jsx("div",{className:"p-6 text-sm text-muted-foreground",children:"No words match your search."})]})})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Memorization Progress (coming soon)"}),t.jsx(h,{value:0})]})]})}):(console.log("❌ User not authenticated in VocabularyBook, redirecting to auth"),t.jsx(s,{to:"/auth",replace:!0}))}export{_ as default};
