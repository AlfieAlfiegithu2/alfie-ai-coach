import{ae as e,u as a,a1 as s,r,j as l,aa as t,aj as n,I as o,S as i,p as c,af as d,q as m,s as x,t as h,ah as u,ad as g,a as f,l as p,B as b,Z as j,E as v,D as y,m as N,n as w,o as k,V as S}from"./index-DEk2O6yt.js";import{s as C}from"./supabase-DWL4C3fA.js";import{f as L,a as $}from"./d1Client-DHU_uMQx.js";import{S as E}from"./search-DefJO5bk.js";import{B as _}from"./book-7Q3vcntk.js";const B=[{code:"ko",name:"í•œêµ­ì–´",flag:"ðŸ‡°ðŸ‡·"},{code:"ja",name:"æ—¥æœ¬èªž",flag:"ðŸ‡¯ðŸ‡µ"},{code:"zh",name:"ä¸­æ–‡",flag:"ðŸ‡¨ðŸ‡³"},{code:"zh-TW",name:"ç¹é«”ä¸­æ–‡",flag:"ðŸ‡¹ðŸ‡¼"},{code:"vi",name:"Tiáº¿ng Viá»‡t",flag:"ðŸ‡»ðŸ‡³"},{code:"th",name:"à¹„à¸—à¸¢",flag:"ðŸ‡¹ðŸ‡­"},{code:"id",name:"Bahasa Indonesia",flag:"ðŸ‡®ðŸ‡©"},{code:"ms",name:"Bahasa Melayu",flag:"ðŸ‡²ðŸ‡¾"},{code:"es",name:"EspaÃ±ol",flag:"ðŸ‡ªðŸ‡¸"},{code:"fr",name:"FranÃ§ais",flag:"ðŸ‡«ðŸ‡·"},{code:"de",name:"Deutsch",flag:"ðŸ‡©ðŸ‡ª"},{code:"pt",name:"PortuguÃªs",flag:"ðŸ‡§ðŸ‡·"},{code:"ru",name:"Ð ÑƒÑÑÐºÐ¸Ð¹",flag:"ðŸ‡·ðŸ‡º"},{code:"ar",name:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",flag:"ðŸ‡¸ðŸ‡¦"},{code:"hi",name:"à¤¹à¤¿à¤¨à¥à¤¦à¥€",flag:"ðŸ‡®ðŸ‡³"},{code:"bn",name:"à¦¬à¦¾à¦‚à¦²à¦¾",flag:"ðŸ‡§ðŸ‡©"},{code:"tr",name:"TÃ¼rkÃ§e",flag:"ðŸ‡¹ðŸ‡·"},{code:"fa",name:"ÙØ§Ø±Ø³ÛŒ",flag:"ðŸ‡®ðŸ‡·"},{code:"ur",name:"Ø§Ø±Ø¯Ùˆ",flag:"ðŸ‡µðŸ‡°"},{code:"en",name:"English",flag:"ðŸ‡¬ðŸ‡§"}],V=["bg-emerald-100 text-emerald-800 border-emerald-200","bg-sky-100 text-sky-800 border-sky-200","bg-violet-100 text-violet-800 border-violet-200","bg-orange-100 text-orange-800 border-orange-200"],M=["Level 1","Level 2","Level 3","Level 4"];function P(){const{user:P,loading:z}=e(),I=a(),T=s(),[q,A]=r.useState(!0),[D,O]=r.useState([]),[U,F]=r.useState({}),[R,W]=r.useState({}),[Z,G]=r.useState("ko"),[H,J]=r.useState(""),[K,Q]=r.useState(null),[X,Y]=r.useState(null);r.useEffect(()=>{(async()=>{if(P)try{const{data:e}=await C.from("profiles").select("native_language").eq("id",P.id).single();(null==e?void 0:e.native_language)&&G(e.native_language)}catch(e){console.error("Error loading user preferences:",e)}})()},[P]),r.useEffect(()=>{(async()=>{A(!0);try{const e=await L({limit:1e4});console.log("VocabularyBook: Loaded",e.length,"cards from D1");const a={};if(Z&&"en"!==Z){const e=await $(Z);Object.entries(e).forEach(([e,s])=>{a[e]||(a[e]={}),a[e][Z]=s})}F(a);const{data:s}=await C.from("vocab_images").select("card_id, url"),r={};null==s||s.forEach(e=>{r[e.card_id]=e.url}),W(r);const l=Math.ceil(e.length/4),t=e.map((e,a)=>{let s=e.level||1;return(s>4||s<1)&&(s=Math.floor(a/l)+1,s>4&&(s=4)),{id:e.id,term:e.term,translation:e.term,pos:e.pos,ipa:e.ipa,context_sentence:e.context_sentence,level:s}}),n=null!==K?t.filter(e=>e.level===K):t;O(n)}catch(e){console.error("VocabularyBook: Error loading data:",e)}finally{A(!1)}})()},[P,K,Z]);const ee=r.useMemo(()=>{const e=H.toLowerCase();let a=e?D.filter(a=>{var s;return a.term.toLowerCase().includes(e)||(a.translation||"").toLowerCase().includes(e)||((null==(s=U[a.id])?void 0:s[Z])||"").toLowerCase().includes(e)}):D;const s={};a.forEach(e=>{const a=e.level||1;s[a]||(s[a]=[]),s[a].push(e)});const r=[];return Object.entries(s).sort(([e],[a])=>Number(e)-Number(a)).forEach(([e,a])=>{const s=Number(e),l=M[s-1]||`Level ${e}`;for(let t=0;t<a.length;t+=20){const s=a.slice(t,t+20),n=Math.floor(t/20)+1,o=Math.ceil(a.length/20);r.push({id:`${e}-${n}`,name:1===o?`${l} Vocabulary`:`${l} - Set ${n}`,cards:s})}}),r},[D,H,U,Z]),ae=B.find(e=>e.code===Z);return z?l.jsx(t,{title:"Loading...",children:l.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),l.jsx("p",{className:"text-muted-foreground",children:"Loading vocabulary..."})]})})}):z||P?l.jsxs("div",{className:"min-h-screen relative",children:[l.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:"note"===T.theme.name||"minimalist"===T.theme.name||"dark"===T.theme.name?"none":"url('/1000031207.png')",backgroundColor:T.backgroundImageColor}}),l.jsx("div",{className:"relative z-10",children:l.jsx(t,{title:"Vocabulary Book",showBackButton:!0,backPath:"/dashboard",children:l.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[l.jsx("div",{className:"bg-white/80 backdrop-blur-md rounded-2xl p-6 mb-8 border border-white/20 shadow-lg",children:l.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[l.jsxs("div",{className:"relative flex-1",children:[l.jsx(E,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),l.jsx(o,{placeholder:"Search words or translations...",value:H,onChange:e=>J(e.target.value),className:"pl-10 h-11 bg-white/50 border-gray-200 focus:ring-primary/20 rounded-xl"})]}),l.jsxs(i,{value:(null==K?void 0:K.toString())||"all",onValueChange:e=>Q("all"===e?null:Number(e)),children:[l.jsxs(c,{className:"w-[180px] h-11 bg-white/50 border-gray-200 focus:ring-primary/20 rounded-xl",children:[l.jsx(d,{className:"w-4 h-4 mr-2 text-muted-foreground"}),l.jsx(m,{placeholder:"All Levels"})]}),l.jsxs(x,{children:[l.jsx(h,{value:"all",children:"All Levels"}),M.map((e,a)=>l.jsx(h,{value:(a+1).toString(),children:e},a+1))]})]}),l.jsxs(i,{value:Z,onValueChange:async e=>{if(G(e),P)try{await C.from("profiles").update({native_language:e}).eq("id",P.id)}catch(a){console.error("Error saving language preference:",a)}},children:[l.jsxs(c,{className:"w-[180px] h-11 bg-white/50 border-gray-200 focus:ring-primary/20 rounded-xl",children:[l.jsx(u,{className:"w-4 h-4 mr-2 text-muted-foreground"}),l.jsx(m,{children:ae&&`${ae.flag} ${ae.name}`})]}),l.jsx(x,{className:"max-h-[300px]",children:B.map(e=>l.jsxs(h,{value:e.code,children:[e.flag," ",e.name]},e.code))})]})]})}),q?l.jsxs("div",{className:"text-center py-12",children:[l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),l.jsx("p",{className:"text-muted-foreground",children:"Loading vocabulary..."})]}):0===ee.length?l.jsxs("div",{className:"text-center py-12 bg-white/50 rounded-2xl border border-white/20",children:[l.jsx(_,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground/50"}),l.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No words found"}),l.jsx("p",{className:"text-muted-foreground",children:H?"Try a different search term":"Start learning to build your vocabulary!"})]}):l.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:ee.map(e=>{const a=parseInt(e.id.split("-")[0])||1,s=V[a-1]||V[0];return l.jsx(g,{className:"cursor-pointer group h-full bg-white/80 hover:bg-white/90 border-white/20",onClick:()=>Y(e),children:l.jsxs(f,{className:"p-6 flex flex-col h-full",children:[l.jsxs("div",{className:"flex items-start justify-between mb-4",children:[l.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center shadow-sm ${s.replace("text-","bg-").split(" ")[0]} bg-opacity-20`,children:l.jsx(_,{className:`w-6 h-6 ${s.split(" ")[1]}`})}),l.jsxs(p,{variant:"outline",className:`${s}`,children:["Level ",a]})]}),l.jsx("h3",{className:"text-xl font-bold mb-2 group-hover:text-primary transition-colors",children:e.name}),l.jsxs("p",{className:"text-muted-foreground text-sm mb-6 flex-1",children:[e.cards.length," words to master"]}),l.jsxs("div",{className:"flex items-center gap-2 mt-auto pt-4 border-t border-gray-100",children:[l.jsxs(b,{className:"flex-1 bg-primary hover:bg-primary/90 text-white rounded-xl",onClick:a=>{a.stopPropagation(),I(`/vocabulary/test/${e.id}`)},children:[l.jsx(j,{className:"w-4 h-4 mr-2"}),"Practice"]}),l.jsxs(b,{variant:"outline",className:"flex-1 rounded-xl hover:bg-gray-50",onClick:a=>{a.stopPropagation(),Y(e)},children:[l.jsx(v,{className:"w-4 h-4 mr-2"}),"View"]})]})]})},e.id)})})]})})}),l.jsx(y,{open:!!X,onOpenChange:e=>!e&&Y(null),children:l.jsxs(N,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[l.jsx(w,{children:l.jsxs(k,{className:"text-2xl font-bold flex items-center gap-3",children:[l.jsx(_,{className:"w-6 h-6 text-primary"}),null==X?void 0:X.name]})}),l.jsx("div",{className:"mt-6 space-y-4",children:null==X?void 0:X.cards.map(e=>{var a;const s=(null==(a=U[e.id])?void 0:a[Z])||e.translation||"",r=R[e.id];return l.jsxs("div",{className:"p-4 rounded-xl bg-gray-50 border border-gray-100 flex items-start gap-4 hover:bg-gray-100 transition-colors",children:[r?l.jsx("div",{className:"w-16 h-16 flex-shrink-0 rounded-lg overflow-hidden bg-white border border-gray-200 shadow-sm",children:l.jsx("img",{src:r,alt:e.term,className:"w-full h-full object-cover",loading:"lazy"})}):l.jsx("div",{className:"w-16 h-16 flex-shrink-0 rounded-lg bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center border border-gray-200",children:l.jsx("span",{className:"text-2xl",children:e.term.charAt(0).toUpperCase()})}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-1",children:[l.jsx("span",{className:"font-bold text-lg",children:e.term}),e.pos&&l.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-gray-200 text-gray-700 font-medium",children:e.pos}),e.ipa&&l.jsxs("span",{className:"text-sm text-muted-foreground font-mono",children:["/",e.ipa,"/"]})]}),l.jsx("div",{className:"text-primary font-medium mb-1",children:s}),e.context_sentence&&l.jsxs("p",{className:"text-sm text-muted-foreground italic truncate",children:['"',e.context_sentence,'"']})]}),l.jsx(b,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-primary flex-shrink-0",onClick:()=>{const a=new SpeechSynthesisUtterance(e.term);a.lang="en-US",speechSynthesis.speak(a)},children:l.jsx(S,{className:"w-5 h-5"})})]},e.id)})}),l.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t",children:[l.jsx(b,{variant:"outline",onClick:()=>Y(null),children:"Close"}),l.jsxs(b,{onClick:()=>{X&&I(`/vocabulary/test/${X.id}`)},children:[l.jsx(j,{className:"w-4 h-4 mr-2"}),"Start Practice"]})]})]})})]}):l.jsx(n,{to:"/auth",replace:!0})}export{P as default};
