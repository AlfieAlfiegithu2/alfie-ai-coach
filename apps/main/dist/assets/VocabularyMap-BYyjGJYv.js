import{u as e,r as s,j as t}from"./vendor-react-rLLBBC7n.js";import{d as a,y as l,P as r,C as i,a as o,B as n,s as c}from"./index-BDl0jLJK.js";import{ck as d,be as u,cl as m}from"./vendor-ui-BGi_EvHx.js";import"./vendor-react-dom-CgqbTh6h.js";import"./vendor-charts-0DeywwxG.js";import"./vendor-i18n-gE2_DBDv.js";import"./vendor-utils-Cn4gX4Gv.js";import"./vendor-supabase-DcWtwiPX.js";import"./vendor-animation-DlplP_f6.js";import"./vendor-date-DT7Rq6D9.js";const v=()=>{const v=e(),{toast:p}=a(),[x,h]=s.useState([]),[b,g]=s.useState(1),[j,f]=s.useState(!0);s.useEffect(()=>{document.title="Vocabulary Map | Vocabulary Builder";const e=document.querySelector('link[rel="canonical"]')||document.createElement("link");e.setAttribute("rel","canonical"),e.setAttribute("href",window.location.href),document.head.appendChild(e)},[]),s.useEffect(()=>{(async()=>{var e;f(!0);const{data:s}=await c.auth.getUser(),t=null==(e=null==s?void 0:s.user)?void 0:e.id,{data:a}=await c.from("skill_tests").select("id,title,created_at").eq("skill_slug","vocabulary-builder").order("created_at",{ascending:!0});if(h((a??[]).map(({id:e,title:s})=>({id:e,title:s}))),!t)return g(1),void f(!1);const{data:l,error:r}=await c.from("user_skill_progress").select("max_unlocked_level").eq("user_id",t).eq("skill_slug","vocabulary-builder").maybeSingle();!r&&l?g(Math.max(1,l.max_unlocked_level||1)):r||l||!t||(await c.from("user_skill_progress").insert({user_id:t,skill_slug:"vocabulary-builder",max_unlocked_level:1}),g(1)),f(!1)})()},[]);const y=s.useMemo(()=>{const e=[];let s=1;for(let t=0;t<5;t++){const a=[];for(let e=0;e<4;e++){const e=x[s-1];a.push({level:s,test:e}),s++}t%2==1&&a.reverse(),e.push(a)}return e},[x]),k=Math.min(100,(b-1)/19*100);return t.jsxs(l,{title:"Vocabulary Map",showBackButton:!0,backPath:"/skills/vocabulary-builder",children:[t.jsxs("main",{className:"max-w-4xl mx-auto space-y-6",children:[t.jsxs("section",{"aria-label":"Map progress",className:"space-y-2",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Progress to the castle"}),t.jsx(r,{value:k})]}),t.jsx(i,{className:"border-light-border",children:t.jsxs(o,{className:"p-4 space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[t.jsx(d,{className:"h-4 w-4"}),t.jsx("span",{children:"Start at Level 1 â€” reach the castle at Level 20"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(n,{variant:"secondary",onClick:()=>v("/skills/vocabulary-builder"),children:"List View"}),t.jsx(n,{onClick:async()=>{var e;const{data:s}=await c.auth.getUser(),t=null==(e=null==s?void 0:s.user)?void 0:e.id;if(!t)return void p({title:"Sign in required",description:"Please sign in to save your progress."});const a=Math.min(20,b+1),{error:l}=await c.from("user_skill_progress").upsert({user_id:t,skill_slug:"vocabulary-builder",max_unlocked_level:a},{onConflict:"user_id,skill_slug"});l||(g(a),p({title:"Unlocked!",description:`Level ${a} is now available.`}))},"aria-label":"Manually unlock next level",children:"Unlock Next"})]})]}),j?t.jsx("div",{className:"flex justify-center items-center min-h-[40vh]",children:t.jsx("p",{className:"text-muted-foreground",children:"Loading map..."})}):t.jsx("div",{className:"grid gap-4",children:y.map((e,s)=>t.jsx("div",{className:"grid grid-cols-4 gap-4",children:e.map(({level:e,test:s})=>{const a=20===e,l=e>b;return t.jsxs("button",{onClick:()=>((e,s)=>{e>b?p({title:"Level locked",description:"Clear previous levels to unlock this one."}):s?v(`/skills/vocabulary-builder/test/${s.id}`):p({title:"Coming soon",description:`Level ${e} content is not available yet.`})})(e,s),className:"relative rounded-lg border p-4 text-left transition-colors hover:bg-muted "+(l?"opacity-60 cursor-not-allowed":""),"aria-disabled":l,"aria-label":a?`Level ${e} Castle`:`Level ${e}`,children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"inline-flex h-7 w-7 items-center justify-center rounded-full bg-primary/10 text-primary font-semibold",children:e}),t.jsx("div",{className:"font-medium",children:a?"Castle":(null==s?void 0:s.title)||`Level ${e}`})]}),a?t.jsx(u,{className:"h-5 w-5 text-primary"}):l?t.jsx(m,{className:"h-4 w-4 text-muted-foreground"}):null]}),t.jsx("div",{className:"mt-2 text-xs text-muted-foreground",children:l?"Locked":s?"Play":"Coming soon"})]},e)})},s))})]})})]}),t.jsx("script",{type:"application/ld+json",suppressHydrationWarning:!0,children:JSON.stringify({"@context":"https://schema.org","@type":"CollectionPage",name:"Vocabulary Builder Map",description:"Mario-style 20-level vocabulary progression ending at a castle.",isPartOf:{"@type":"WebSite",name:"Vocabulary Builder"}})})]})};export{v as default};
