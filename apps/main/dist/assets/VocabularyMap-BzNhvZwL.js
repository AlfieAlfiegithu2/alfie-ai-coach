import{y as e,u as s,g as l,r as a,j as t,Z as r,W as i,C as n,a as o,B as c}from"./index-C8eGhmvu.js";import{s as d}from"./supabase-Bqkrifq5.js";import{T as u}from"./trophy-DdTCXD3H.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m=e("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]),x=e("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),p=()=>{const e=s(),{toast:p}=l(),[v,h]=a.useState([]),[y,g]=a.useState(1),[b,f]=a.useState(!0);a.useEffect(()=>{document.title="Vocabulary Map | Vocabulary Builder";const e=document.querySelector('link[rel="canonical"]')||document.createElement("link");e.setAttribute("rel","canonical"),e.setAttribute("href",window.location.href),document.head.appendChild(e)},[]),a.useEffect(()=>{(async()=>{var e;f(!0);const{data:s}=await d.auth.getUser(),l=null==(e=null==s?void 0:s.user)?void 0:e.id,{data:a}=await d.from("skill_tests").select("id,title,created_at").eq("skill_slug","vocabulary-builder").order("created_at",{ascending:!0});if(h((a??[]).map(({id:e,title:s})=>({id:e,title:s}))),!l)return g(1),void f(!1);const{data:t,error:r}=await d.from("user_skill_progress").select("max_unlocked_level").eq("user_id",l).eq("skill_slug","vocabulary-builder").maybeSingle();!r&&t?g(Math.max(1,t.max_unlocked_level||1)):r||t||!l||(await d.from("user_skill_progress").insert({user_id:l,skill_slug:"vocabulary-builder",max_unlocked_level:1}),g(1)),f(!1)})()},[]);const j=a.useMemo(()=>{const e=[];let s=1;for(let l=0;l<5;l++){const a=[];for(let e=0;e<4;e++){const e=v[s-1];a.push({level:s,test:e}),s++}l%2==1&&a.reverse(),e.push(a)}return e},[v]),k=Math.min(100,(y-1)/19*100);return t.jsxs(r,{title:"Vocabulary Map",showBackButton:!0,backPath:"/skills/vocabulary-builder",children:[t.jsxs("main",{className:"max-w-4xl mx-auto space-y-6",children:[t.jsxs("section",{"aria-label":"Map progress",className:"space-y-2",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Progress to the castle"}),t.jsx(i,{value:k})]}),t.jsx(n,{className:"border-light-border",children:t.jsxs(o,{className:"p-4 space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[t.jsx(m,{className:"h-4 w-4"}),t.jsx("span",{children:"Start at Level 1 â€” reach the castle at Level 20"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(c,{variant:"secondary",onClick:()=>e("/skills/vocabulary-builder"),children:"List View"}),t.jsx(c,{onClick:async()=>{var e;const{data:s}=await d.auth.getUser(),l=null==(e=null==s?void 0:s.user)?void 0:e.id;if(!l)return void p({title:"Sign in required",description:"Please sign in to save your progress."});const a=Math.min(20,y+1),{error:t}=await d.from("user_skill_progress").upsert({user_id:l,skill_slug:"vocabulary-builder",max_unlocked_level:a},{onConflict:"user_id,skill_slug"});t||(g(a),p({title:"Unlocked!",description:`Level ${a} is now available.`}))},"aria-label":"Manually unlock next level",children:"Unlock Next"})]})]}),b?t.jsx("div",{className:"flex justify-center items-center min-h-[40vh]",children:t.jsx("p",{className:"text-muted-foreground",children:"Loading map..."})}):t.jsx("div",{className:"grid gap-4",children:j.map((s,l)=>t.jsx("div",{className:"grid grid-cols-4 gap-4",children:s.map(({level:s,test:l})=>{const a=20===s,r=s>y;return t.jsxs("button",{onClick:()=>((s,l)=>{s>y?p({title:"Level locked",description:"Clear previous levels to unlock this one."}):l?e(`/skills/vocabulary-builder/test/${l.id}`):p({title:"Coming soon",description:`Level ${s} content is not available yet.`})})(s,l),className:"relative rounded-lg border p-4 text-left transition-colors hover:bg-muted "+(r?"opacity-60 cursor-not-allowed":""),"aria-disabled":r,"aria-label":a?`Level ${s} Castle`:`Level ${s}`,children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"inline-flex h-7 w-7 items-center justify-center rounded-full bg-primary/10 text-primary font-semibold",children:s}),t.jsx("div",{className:"font-medium",children:a?"Castle":(null==l?void 0:l.title)||`Level ${s}`})]}),a?t.jsx(u,{className:"h-5 w-5 text-primary"}):r?t.jsx(x,{className:"h-4 w-4 text-muted-foreground"}):null]}),t.jsx("div",{className:"mt-2 text-xs text-muted-foreground",children:r?"Locked":l?"Play":"Coming soon"})]},s)})},l))})]})})]}),t.jsx("script",{type:"application/ld+json",suppressHydrationWarning:!0,children:JSON.stringify({"@context":"https://schema.org","@type":"CollectionPage",name:"Vocabulary Builder Map",description:"Mario-style 20-level vocabulary progression ending at a castle.",isPartOf:{"@type":"WebSite",name:"Vocabulary Builder"}})})]})};
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */export{p as default};
