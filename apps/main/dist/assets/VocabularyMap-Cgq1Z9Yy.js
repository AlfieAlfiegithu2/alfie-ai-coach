import{u as e,h as s,r as l,j as a,a4 as t,K as r,C as i,a as o,B as n}from"./index-DGTvukq5.js";import{s as c}from"./supabase-DWL4C3fA.js";import{F as d}from"./flag-4jhJKd8e.js";import{T as u}from"./trophy-CwPQJ1I6.js";import{L as m}from"./lock-BzPCfAJb.js";const p=()=>{const p=e(),{toast:x}=s(),[v,h]=l.useState([]),[f,g]=l.useState(1),[b,y]=l.useState(!0);l.useEffect(()=>{document.title="Vocabulary Map | Vocabulary Builder";const e=document.querySelector('link[rel="canonical"]')||document.createElement("link");e.setAttribute("rel","canonical"),e.setAttribute("href",window.location.href),document.head.appendChild(e)},[]),l.useEffect(()=>{(async()=>{var e;y(!0);const{data:s}=await c.auth.getUser(),l=null==(e=null==s?void 0:s.user)?void 0:e.id,{data:a}=await c.from("skill_tests").select("id,title,created_at").eq("skill_slug","vocabulary-builder").order("created_at",{ascending:!0});if(h((a??[]).map(({id:e,title:s})=>({id:e,title:s}))),!l)return g(1),void y(!1);const{data:t,error:r}=await c.from("user_skill_progress").select("max_unlocked_level").eq("user_id",l).eq("skill_slug","vocabulary-builder").maybeSingle();!r&&t?g(Math.max(1,t.max_unlocked_level||1)):r||t||!l||(await c.from("user_skill_progress").insert({user_id:l,skill_slug:"vocabulary-builder",max_unlocked_level:1}),g(1)),y(!1)})()},[]);const j=l.useMemo(()=>{const e=[];let s=1;for(let l=0;l<5;l++){const a=[];for(let e=0;e<4;e++){const e=v[s-1];a.push({level:s,test:e}),s++}l%2==1&&a.reverse(),e.push(a)}return e},[v]),k=Math.min(100,(f-1)/19*100);return a.jsxs(t,{title:"Vocabulary Map",showBackButton:!0,backPath:"/skills/vocabulary-builder",children:[a.jsxs("main",{className:"max-w-4xl mx-auto space-y-6",children:[a.jsxs("section",{"aria-label":"Map progress",className:"space-y-2",children:[a.jsx("div",{className:"text-sm text-muted-foreground",children:"Progress to the castle"}),a.jsx(r,{value:k})]}),a.jsx(i,{className:"border-light-border",children:a.jsxs(o,{className:"p-4 space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[a.jsx(d,{className:"h-4 w-4"}),a.jsx("span",{children:"Start at Level 1 â€” reach the castle at Level 20"})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(n,{variant:"secondary",onClick:()=>p("/skills/vocabulary-builder"),children:"List View"}),a.jsx(n,{onClick:async()=>{var e;const{data:s}=await c.auth.getUser(),l=null==(e=null==s?void 0:s.user)?void 0:e.id;if(!l)return void x({title:"Sign in required",description:"Please sign in to save your progress."});const a=Math.min(20,f+1),{error:t}=await c.from("user_skill_progress").upsert({user_id:l,skill_slug:"vocabulary-builder",max_unlocked_level:a},{onConflict:"user_id,skill_slug"});t||(g(a),x({title:"Unlocked!",description:`Level ${a} is now available.`}))},"aria-label":"Manually unlock next level",children:"Unlock Next"})]})]}),b?a.jsx("div",{className:"flex justify-center items-center min-h-[40vh]",children:a.jsx("p",{className:"text-muted-foreground",children:"Loading map..."})}):a.jsx("div",{className:"grid gap-4",children:j.map((e,s)=>a.jsx("div",{className:"grid grid-cols-4 gap-4",children:e.map(({level:e,test:s})=>{const l=20===e,t=e>f;return a.jsxs("button",{onClick:()=>((e,s)=>{e>f?x({title:"Level locked",description:"Clear previous levels to unlock this one."}):s?p(`/skills/vocabulary-builder/test/${s.id}`):x({title:"Coming soon",description:`Level ${e} content is not available yet.`})})(e,s),className:"relative rounded-lg border p-4 text-left transition-colors hover:bg-muted "+(t?"opacity-60 cursor-not-allowed":""),"aria-disabled":t,"aria-label":l?`Level ${e} Castle`:`Level ${e}`,children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"inline-flex h-7 w-7 items-center justify-center rounded-full bg-primary/10 text-primary font-semibold",children:e}),a.jsx("div",{className:"font-medium",children:l?"Castle":(null==s?void 0:s.title)||`Level ${e}`})]}),l?a.jsx(u,{className:"h-5 w-5 text-primary"}):t?a.jsx(m,{className:"h-4 w-4 text-muted-foreground"}):null]}),a.jsx("div",{className:"mt-2 text-xs text-muted-foreground",children:t?"Locked":s?"Play":"Coming soon"})]},e)})},s))})]})})]}),a.jsx("script",{type:"application/ld+json",suppressHydrationWarning:!0,children:JSON.stringify({"@context":"https://schema.org","@type":"CollectionPage",name:"Vocabulary Builder Map",description:"Mario-style 20-level vocabulary progression ending at a castle.",isPartOf:{"@type":"WebSite",name:"Vocabulary Builder"}})})]})};export{p as default};
