import{A as e,u as s,r as t,J as a,j as r,bo as l,C as n,a as o,B as i,W as c,bc as d,bd as m,be as u,af as h,bQ as g,b9 as p,a0 as x}from"./index-Dn1FbCoL.js";import{A as f,a as b,b as j,c as y,d as v,e as w,f as k,g as N,h as _}from"./alert-dialog-CjvLcW48.js";import{s as C}from"./supabase-DUkWVuqu.js";import{C as $}from"./circle-help-CdB5mkUq.js";const P=()=>{const{user:P}=e(),E=s(),[L,S]=t.useState([]),[B,D]=t.useState([]),[M,z]=t.useState(!0),[F,q]=t.useState([]),H=[{name:"Mouse",image:"/moouse emoji.png"},{name:"Hamster",image:"/Hamster.png"},{name:"Chick",image:"/chick.png"},{name:"Rabbit",image:"/rabbit.png"},{name:"Kitten",image:"/cat.png"},{name:"Puppy",image:"/puppy.png"},{name:"Duck",image:"/duck.png"},{name:"Hedgehog",image:"/hedgehog.png"},{name:"Squirrel",image:"/squerrel.png"},{name:"Penguin",image:"/Penguine.png"},{name:"Otter",image:"/otter.png"},{name:"Koala",image:"/koala.png"},{name:"Piglet",image:"/piglet.png"},{name:"Monkey",image:"/Monkey.png"},{name:"Fox",image:"/fox.png"},{name:"Deer",image:"/dear.png"},{name:"Seal",image:"/seal.png"},{name:"Panda",image:"/panda.png"},{name:"Bear",image:"/bear.png"},{name:"Polar Bear",image:"/polar bear.png"}],O=e=>e<H.length?H[e]:H[H.length-1];t.useEffect(()=>{P?G():z(!1)},[P]),t.useEffect(()=>{const e=()=>{P&&G()};return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[P]);const G=async()=>{if(P){z(!0);try{const[e,s]=await Promise.all([C.from("skill_tests").select("id, title, test_order").eq("skill_slug","vocabulary-builder").order("test_order",{ascending:!0}),C.from("user_test_progress").select("test_id, status, completed_score").eq("user_id",P.id)]);if(e.error)throw e.error;if(s.error)throw s.error;const t=e.data||[];let a=s.data||[];const r=t.map(e=>e.id);if(a=a.filter(e=>r.includes(e.test_id)),t.length>0&&0===a.length){const e=t.find(e=>1===e.test_order)||t[0];if(e){const s={user_id:P.id,test_id:e.id,status:"unlocked"};await C.from("user_test_progress").insert(s),a=[{test_id:e.id,status:"unlocked",completed_score:null}]}}S(t),D(a),I(t,a)}catch(e){console.error("Error loading map data:",e),a.error("Failed to load vocabulary map")}finally{z(!1)}}},I=(e,s)=>{const t=[];e.forEach((e,a)=>{const r=Math.floor(a/5),l=a%5,n=160*(r%2==0?l:4-l)+50,o=150*r+20,i=s.find(s=>s.test_id===e.id)||{test_id:e.id,status:"locked"};t.push({test:e,progress:i,position:{x:n,y:o}})}),q(t)},J=e=>{E(`/skills/vocabulary-builder/test/${e.test.id}`)},V=e=>{switch(e){case"completed":return"bg-gradient-to-br from-yellow-400 to-orange-500 text-white shadow-lg border-yellow-300 hover:shadow-xl transform hover:scale-105";case"unlocked":return"bg-gradient-to-br from-green-400 to-blue-500 text-white shadow-lg border-green-300 hover:shadow-xl transform hover:scale-105 cursor-pointer";default:return"bg-gray-200 text-gray-500 border-gray-300 cursor-not-allowed"}};return M?r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx(l,{size:"lg",message:"Loading your vocabulary journey..."})}):P?r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 p-6",children:r.jsxs("div",{className:"max-w-6xl mx-auto",children:[r.jsxs("div",{className:"text-center mb-4",children:[r.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:"Vocabulary Journey"}),r.jsx(n,{className:"max-w-md mx-auto bg-white/80 backdrop-blur-sm",children:r.jsxs(o,{className:"p-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-sm font-medium",children:"Overall Progress"}),r.jsxs("span",{className:"text-sm text-gray-600",children:[B.filter(e=>"completed"===e.status).length," / ",L.length]})]}),r.jsx(c,{value:(()=>{const e=B.filter(e=>"completed"===e.status).length;return L.length>0?e/L.length*100:0})(),className:"h-3"})]})})]}),r.jsx(n,{className:"relative bg-white/60 backdrop-blur-sm border-2 border-white/80 shadow-xl",children:r.jsx(o,{className:"pt-4 pb-8 px-8",children:r.jsxs("div",{className:"relative mx-auto",style:{width:"900px",height:"700px",minHeight:"600px"},children:[(()=>{if(F.length<2)return null;let e=`M ${F[0].position.x+50} ${F[0].position.y+50}`;for(let s=1;s<F.length;s++){const t=F[s-1],a=F[s];e+=` Q ${(t.position.x+a.position.x)/2+50} ${(t.position.y+a.position.y)/2+50+30*Math.sin(.5*s)} ${a.position.x+50} ${a.position.y+50}`}return r.jsxs("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{zIndex:1},children:[r.jsx("path",{d:e,stroke:"url(#pathGradient)",strokeWidth:"4",fill:"none",strokeDasharray:"8,4",className:"animate-pulse"}),r.jsx("defs",{children:r.jsxs("linearGradient",{id:"pathGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[r.jsx("stop",{offset:"0%",stopColor:"#3B82F6"}),r.jsx("stop",{offset:"50%",stopColor:"#8B5CF6"}),r.jsx("stop",{offset:"100%",stopColor:"#EC4899"})]})})]})})(),F.map((e,s)=>{return r.jsxs("div",{className:"absolute",style:{left:`${e.position.x}px`,top:`${e.position.y}px`,zIndex:10},children:["locked"===e.progress.status?r.jsxs(f,{children:[r.jsx(b,{asChild:!0,children:r.jsxs(d,{children:[r.jsx(m,{asChild:!0,children:r.jsxs("div",{className:`\n                                relative w-24 h-24 rounded-full border-4 flex items-center justify-center\n                                transition-all duration-300 ease-in-out\n                                ${V(e.progress.status)} hover:cursor-pointer\n                              `,onClick:()=>J(e),onDoubleClick:e=>{e.stopPropagation()},children:[r.jsx("img",{src:O(s).image,alt:`${O(s).name} level icon`,className:"absolute inset-0 w-full h-full rounded-full object-cover transform scale-90",loading:"lazy"}),r.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 rounded-full",children:r.jsx($,{className:"w-8 h-8 text-white"})})]})}),r.jsx(u,{side:"top",children:s>0?`Complete the ${O(s-1).name} Level to unlock! Or double-click to unlock manually.`:"This is the first level."})]})}),r.jsxs(j,{children:[r.jsxs(y,{children:[r.jsxs(v,{children:["Unlock ",O(s).name," Level?"]}),r.jsxs(w,{children:["Do you want to unlock this level? This will allow you to start the ",O(s).name," vocabulary test."]})]}),r.jsxs(k,{children:[r.jsx(N,{children:"Cancel"}),r.jsx(_,{onClick:()=>(async e=>{if(P)try{await C.from("user_test_progress").upsert({user_id:P.id,test_id:e.test.id,status:"unlocked"},{onConflict:"user_id,test_id"}),a.success(`${O(F.indexOf(e)).name} Level unlocked!`),G()}catch(s){console.error("Error unlocking level:",s),a.error("Failed to unlock level")}})(e),children:"Yes, Unlock Level"})]})]})]}):r.jsxs("div",{className:`\n                        relative w-24 h-24 rounded-full border-4 flex items-center justify-center\n                        transition-all duration-300 ease-in-out\n                        ${V(e.progress.status)}\n                      `,onClick:()=>J(e),children:[r.jsx("img",{src:O(s).image,alt:`${O(s).name} level icon`,className:"absolute inset-0 w-full h-full rounded-full object-cover transform scale-90",loading:"lazy"}),"unlocked"===e.progress.status&&r.jsx("div",{className:"absolute bottom-1 right-1",children:r.jsx(h,{className:"w-4 h-4 text-green-500"})}),"completed"===e.progress.status&&e.progress.completed_score&&r.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2",children:(l=e.progress.completed_score,t=l>=90?3:l>=70?2:1,r.jsx("div",{className:"flex items-center justify-center",children:[1,2,3].map(e=>r.jsx(x,{className:"w-6 h-6 "+(e<=t?"text-yellow-400 fill-current":"text-gray-300"),style:{transform:`rotate(${15*(e-2)}deg) translateY(${2===e?"0px":"4px"})`,margin:"0 2px"}},e))}))})]}),r.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 w-32 text-center",children:r.jsxs("p",{className:"text-[10px] font-medium text-muted-foreground truncate",children:[O(s).name," Level"]})})]},e.test.id);var t,l})]})})}),r.jsxs("div",{className:"text-center mt-8 space-x-4",children:[r.jsxs(i,{variant:"outline",onClick:()=>E("/dashboard"),className:"bg-white/80 backdrop-blur-sm hover:bg-white",children:[r.jsx(g,{className:"w-4 h-4 mr-2 rotate-180"}),"Back to Dashboard"]}),r.jsxs(i,{onClick:()=>E("/vocabulary"),className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[r.jsx(p,{className:"w-4 h-4 mr-2"}),"View Saved Vocabulary"]})]}),r.jsx(n,{className:"mt-8 bg-white/60 backdrop-blur-sm"})]})}):r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx(n,{className:"p-8 text-center",children:r.jsxs(o,{children:[r.jsx("p",{className:"text-lg mb-4",children:"Please sign in to access your vocabulary journey."}),r.jsx(i,{onClick:()=>E("/auth"),className:"bg-primary text-primary-foreground hover:bg-primary/90",children:"Sign In"})]})})})};export{P as default};
