import{u as e,r as s,j as t}from"./vendor-react-JN_hy__U.js";import{E as a,s as r,J as l,a0 as o,C as n,a as i,B as c,P as d,Z as m,_ as u,$ as p}from"./index-DXpPY1B7.js";import{A as h,a as g,b as x,c as f,d as j,e as b,f as v,g as y,h as w}from"./alert-dialog-BwGJZs3W.js";import{bn as k,aL as N,Y as _,at as C,F as $}from"./vendor-ui-DG51EGkO.js";import"./vendor-react-dom-Cb-iy8Oc.js";import"./vendor-animation-ClPlB6zo.js";import"./vendor-i18n-DlHrixAm.js";import"./vendor-utils-D5HPTFR9.js";import"./vendor-supabase-D7XYLCUu.js";import"./vendor-charts-BpOKEG9Z.js";import"./vendor-date-DT7Rq6D9.js";const P=()=>{const{user:P}=a(),E=e(),[L,S]=s.useState([]),[B,D]=s.useState([]),[F,M]=s.useState(!0),[z,q]=s.useState([]),H=[{name:"Mouse",image:"/moouse emoji.png"},{name:"Hamster",image:"/Hamster.png"},{name:"Chick",image:"/chick.png"},{name:"Rabbit",image:"/rabbit.png"},{name:"Kitten",image:"/cat.png"},{name:"Puppy",image:"/puppy.png"},{name:"Duck",image:"/duck.png"},{name:"Hedgehog",image:"/hedgehog.png"},{name:"Squirrel",image:"/squerrel.png"},{name:"Penguin",image:"/Penguine.png"},{name:"Otter",image:"/otter.png"},{name:"Koala",image:"/koala.png"},{name:"Piglet",image:"/piglet.png"},{name:"Monkey",image:"/Monkey.png"},{name:"Fox",image:"/fox.png"},{name:"Deer",image:"/dear.png"},{name:"Seal",image:"/seal.png"},{name:"Panda",image:"/panda.png"},{name:"Bear",image:"/bear.png"},{name:"Polar Bear",image:"/polar bear.png"}],O=e=>e<H.length?H[e]:H[H.length-1];s.useEffect(()=>{P?G():M(!1)},[P]),s.useEffect(()=>{const e=()=>{P&&G()};return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[P]);const G=async()=>{if(P){M(!0);try{const[e,s]=await Promise.all([r.from("skill_tests").select("id, title, test_order").eq("skill_slug","vocabulary-builder").order("test_order",{ascending:!0}),r.from("user_test_progress").select("test_id, status, completed_score").eq("user_id",P.id)]);if(e.error)throw e.error;if(s.error)throw s.error;const t=e.data||[];let a=s.data||[];const l=t.map(e=>e.id);if(a=a.filter(e=>l.includes(e.test_id)),t.length>0&&0===a.length){const e=t.find(e=>1===e.test_order)||t[0];if(e){const s={user_id:P.id,test_id:e.id,status:"unlocked"};await r.from("user_test_progress").insert(s),a=[{test_id:e.id,status:"unlocked",completed_score:null}]}}S(t),D(a),I(t,a)}catch(e){console.error("Error loading map data:",e),l.error("Failed to load vocabulary map")}finally{M(!1)}}},I=(e,s)=>{const t=[];e.forEach((e,a)=>{const r=Math.floor(a/5),l=a%5,o=160*(r%2==0?l:4-l)+50,n=150*r+20,i=s.find(s=>s.test_id===e.id)||{test_id:e.id,status:"locked"};t.push({test:e,progress:i,position:{x:o,y:n}})}),q(t)},V=e=>{E(`/skills/vocabulary-builder/test/${e.test.id}`)},Y=e=>{switch(e){case"completed":return"bg-gradient-to-br from-yellow-400 to-orange-500 text-white shadow-lg border-yellow-300 hover:shadow-xl transform hover:scale-105";case"unlocked":return"bg-gradient-to-br from-green-400 to-blue-500 text-white shadow-lg border-green-300 hover:shadow-xl transform hover:scale-105 cursor-pointer";default:return"bg-gray-200 text-gray-500 border-gray-300 cursor-not-allowed"}};return F?t.jsx("div",{className:"min-h-screen flex items-center justify-center",children:t.jsx(o,{size:"lg",message:"Loading your vocabulary journey..."})}):P?t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 p-6",children:t.jsxs("div",{className:"max-w-6xl mx-auto",children:[t.jsxs("div",{className:"text-center mb-4",children:[t.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:"Vocabulary Journey"}),t.jsx(n,{className:"max-w-md mx-auto bg-white/80 backdrop-blur-sm",children:t.jsxs(i,{className:"p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-medium",children:"Overall Progress"}),t.jsxs("span",{className:"text-sm text-gray-600",children:[B.filter(e=>"completed"===e.status).length," / ",L.length]})]}),t.jsx(d,{value:(()=>{const e=B.filter(e=>"completed"===e.status).length;return L.length>0?e/L.length*100:0})(),className:"h-3"})]})})]}),t.jsx(n,{className:"relative bg-white/60 backdrop-blur-sm border-2 border-white/80 shadow-xl",children:t.jsx(i,{className:"pt-4 pb-8 px-8",children:t.jsxs("div",{className:"relative mx-auto",style:{width:"900px",height:"700px",minHeight:"600px"},children:[(()=>{if(z.length<2)return null;let e=`M ${z[0].position.x+50} ${z[0].position.y+50}`;for(let s=1;s<z.length;s++){const t=z[s-1],a=z[s];e+=` Q ${(t.position.x+a.position.x)/2+50} ${(t.position.y+a.position.y)/2+50+30*Math.sin(.5*s)} ${a.position.x+50} ${a.position.y+50}`}return t.jsxs("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{zIndex:1},children:[t.jsx("path",{d:e,stroke:"url(#pathGradient)",strokeWidth:"4",fill:"none",strokeDasharray:"8,4",className:"animate-pulse"}),t.jsx("defs",{children:t.jsxs("linearGradient",{id:"pathGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"#3B82F6"}),t.jsx("stop",{offset:"50%",stopColor:"#8B5CF6"}),t.jsx("stop",{offset:"100%",stopColor:"#EC4899"})]})})]})})(),z.map((e,s)=>{return t.jsxs("div",{className:"absolute",style:{left:`${e.position.x}px`,top:`${e.position.y}px`,zIndex:10},children:["locked"===e.progress.status?t.jsxs(h,{children:[t.jsxs(m,{children:[t.jsx(u,{asChild:!0,children:t.jsx(g,{asChild:!0,children:t.jsxs("div",{className:`\n                                relative w-24 h-24 rounded-full border-4 flex items-center justify-center\n                                transition-all duration-300 ease-in-out\n                                ${Y(e.progress.status)} hover:cursor-pointer\n                              `,onClick:()=>V(e),onDoubleClick:e=>{e.stopPropagation()},children:[t.jsx("img",{src:O(s).image,alt:`${O(s).name} level icon`,className:"absolute inset-0 w-full h-full rounded-full object-cover transform scale-90",loading:"lazy"}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 rounded-full",children:t.jsx(k,{className:"w-8 h-8 text-white"})})]})})}),t.jsx(p,{side:"top",children:s>0?`Complete the ${O(s-1).name} Level to unlock! Or double-click to unlock manually.`:"This is the first level."})]}),t.jsxs(x,{children:[t.jsxs(f,{children:[t.jsxs(j,{children:["Unlock ",O(s).name," Level?"]}),t.jsxs(b,{children:["Do you want to unlock this level? This will allow you to start the ",O(s).name," vocabulary test."]})]}),t.jsxs(v,{children:[t.jsx(y,{children:"Cancel"}),t.jsx(w,{onClick:()=>(async e=>{if(P)try{await r.from("user_test_progress").upsert({user_id:P.id,test_id:e.test.id,status:"unlocked"},{onConflict:"user_id,test_id"}),l.success(`${O(z.indexOf(e)).name} Level unlocked!`),G()}catch(s){console.error("Error unlocking level:",s),l.error("Failed to unlock level")}})(e),children:"Yes, Unlock Level"})]})]})]}):t.jsxs("div",{className:`\n                        relative w-24 h-24 rounded-full border-4 flex items-center justify-center\n                        transition-all duration-300 ease-in-out\n                        ${Y(e.progress.status)}\n                      `,onClick:()=>V(e),children:[t.jsx("img",{src:O(s).image,alt:`${O(s).name} level icon`,className:"absolute inset-0 w-full h-full rounded-full object-cover transform scale-90",loading:"lazy"}),"unlocked"===e.progress.status&&t.jsx("div",{className:"absolute bottom-1 right-1",children:t.jsx(N,{className:"w-4 h-4 text-green-500"})}),"completed"===e.progress.status&&e.progress.completed_score&&t.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2",children:(o=e.progress.completed_score,a=o>=90?3:o>=70?2:1,t.jsx("div",{className:"flex items-center justify-center",children:[1,2,3].map(e=>t.jsx($,{className:"w-6 h-6 "+(e<=a?"text-yellow-400 fill-current":"text-gray-300"),style:{transform:`rotate(${15*(e-2)}deg) translateY(${2===e?"0px":"4px"})`,margin:"0 2px"}},e))}))})]}),t.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 w-32 text-center",children:t.jsxs("p",{className:"text-[10px] font-medium text-muted-foreground truncate",children:[O(s).name," Level"]})})]},e.test.id);var a,o})]})})}),t.jsxs("div",{className:"text-center mt-8 space-x-4",children:[t.jsxs(c,{variant:"outline",onClick:()=>E("/dashboard"),className:"bg-white/80 backdrop-blur-sm hover:bg-white",children:[t.jsx(_,{className:"w-4 h-4 mr-2 rotate-180"}),"Back to Dashboard"]}),t.jsxs(c,{onClick:()=>E("/vocabulary"),className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[t.jsx(C,{className:"w-4 h-4 mr-2"}),"View Saved Vocabulary"]})]}),t.jsx(n,{className:"mt-8 bg-white/60 backdrop-blur-sm"})]})}):t.jsx("div",{className:"min-h-screen flex items-center justify-center",children:t.jsx(n,{className:"p-8 text-center",children:t.jsxs(i,{children:[t.jsx("p",{className:"text-lg mb-4",children:"Please sign in to access your vocabulary journey."}),t.jsx(c,{onClick:()=>E("/auth"),className:"bg-primary text-primary-foreground hover:bg-primary/90",children:"Sign In"})]})})})};export{P as default};
