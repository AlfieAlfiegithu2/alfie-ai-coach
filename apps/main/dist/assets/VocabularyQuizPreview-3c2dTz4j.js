import{r as e,j as s,an as t,C as r,a as n,B as a}from"./index-DLTLzwZ2.js";import{s as c}from"./supabase-Bqkrifq5.js";function l(e){const s=[...e];for(let t=s.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[s[t],s[e]]=[s[e],s[t]]}return s}function i(e){if(!e)return"";let s=e.trim();return s=s.replace(/^[-â€¢]\s*/,""),s=s.replace(/\*\*(.*?)\*\*/g,"$1"),s=s.replace(/\*(.*?)\*/g,"$1"),s=s.replace(/_(.*?)_/g,"$1"),s=s.replace(/`(.*?)`/g,"$1"),s}const o=o=>{const{skillTestId:d,selectedQuestionId:u,limit:m=6}=o,x=o.questions,[h,p]=e.useState([]),[f,j]=e.useState(0),[g,v]=e.useState(null),[N,_]=e.useState(0),[w,y]=e.useState(!1);e.useEffect(()=>{(async()=>{if(x&&x.length)return p(x),j(0),v(null),_(0),void y(!1);if(!d)return;const{data:e,error:s}=await c.from("skill_practice_questions").select("id,content,question_format,correct_answer,incorrect_answers,explanation").eq("skill_test_id",d);if(!s){const s=l(e??[]).slice(0,m);p(s),j(0),v(null),_(0),y(!1)}})()},[x,d,m]),e.useEffect(()=>{if(!u||!h.length)return;const e=h.findIndex(e=>e.id===u);e>=0&&(j(e),v(null),y(!1))},[u,h]);const b=h[f],k=e.useMemo(()=>b?l([b.correct_answer,...b.incorrect_answers||[]]):[],[b]),C=h.length?f/h.length*100:0,S=e=>{g||(v(e),b&&e===b.correct_answer&&_(e=>e+1))};return d||x&&x.length?s.jsxs("div",{className:"space-y-4",children:[s.jsx(t,{value:C}),w?s.jsx(r,{children:s.jsxs(n,{className:"p-6 text-center space-y-3",children:[s.jsx("div",{className:"text-lg font-semibold",children:"Preview complete"}),s.jsxs("div",{className:"text-muted-foreground",children:["Score: ",N," / ",h.length]}),s.jsx(a,{onClick:()=>{j(0),_(0),v(null),y(!1)},children:"Restart preview"})]})}):b?s.jsx(r,{className:"border-light-border",children:s.jsxs(n,{className:"p-6 space-y-4",children:[s.jsxs("div",{className:"text-xs text-muted-foreground",children:["Question ",f+1," of ",h.length]}),"DefinitionMatch"===b.question_format?s.jsxs("div",{children:[s.jsx("div",{className:"text-xl font-semibold mb-4",children:b.content}),s.jsx("div",{className:"grid gap-3 sm:grid-cols-2",children:k.map(e=>{const t=g&&e===b.correct_answer,r=g===e&&e!==b.correct_answer;return s.jsx(a,{variant:t?"success":r?"destructive":"outline",className:"justify-start h-auto py-3",onClick:()=>S(e),children:e},e)})})]}):s.jsxs("div",{children:[s.jsx("div",{className:"text-lg mb-4 whitespace-pre-wrap",children:b.content}),s.jsx("div",{className:"grid gap-3 sm:grid-cols-2",children:k.map(e=>{const t=g&&e===b.correct_answer,r=g===e&&e!==b.correct_answer;return s.jsx(a,{variant:t?"success":r?"destructive":"outline",className:"justify-start h-auto py-3",onClick:()=>S(e),children:e},e)})})]}),g&&s.jsxs("div",{className:"pt-2 space-y-3",children:[b.explanation&&s.jsxs("div",{className:"rounded-md border p-3",children:[s.jsx("div",{className:"text-sm font-medium",children:"Explanation"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:i(b.explanation)})]}),s.jsx(a,{onClick:()=>{f+1>=h.length?y(!0):(j(e=>e+1),v(null))},children:"Continue"})]})]})}):s.jsx("p",{className:"text-sm text-muted-foreground",children:"No questions yet. Use the CSV import above."})]}):null};export{o as V};
