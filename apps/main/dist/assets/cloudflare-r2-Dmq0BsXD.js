import{s as e}from"./supabase-DUkWVuqu.js";const t="https://your-bucket.your-domain.com";async function a(t,a,o){try{const n=(null==o?void 0:o.contentType)||t.type,s=(null==o?void 0:o.cacheControl)||"public, max-age=31536000",r=new FormData;r.append("file",t),r.append("path",a),r.append("contentType",n),r.append("cacheControl",s);const{data:{session:c}}=await e.auth.getSession(),i=`${"https://cuumxmfzhwljylbdlflj.supabase.co"}/functions/v1/r2-upload`,p=await fetch(i,{method:"POST",headers:{Authorization:(null==c?void 0:c.access_token)?`Bearer ${c.access_token}`:""},body:r});if(!p.ok){const e=await p.text();throw new Error(`Upload failed: ${p.status} ${p.statusText} - ${e}`)}const u=await p.json();if(!u||!u.success)throw new Error((null==u?void 0:u.error)||"Upload failed");return{success:!0,url:u.url||"",key:u.key||a}}catch(n){console.error("R2 upload error:",n);return{success:!1,url:"",key:"",error:n instanceof Error?n.message:"string"==typeof n?n:"Upload failed"}}}async function o(t){try{const a=`${"https://cuumxmfzhwljylbdlflj.supabase.co"}/functions/v1/r2-delete`,{data:{session:o}}=await e.auth.getSession(),n=await fetch(a,{method:"POST",headers:{Authorization:(null==o?void 0:o.access_token)?`Bearer ${o.access_token}`:"","Content-Type":"application/json"},body:JSON.stringify({key:t})});if(!n.ok){const e=await n.text();throw new Error(`Delete failed: ${n.status} ${n.statusText} - ${e}`)}const s=await n.json();return!0===(null==s?void 0:s.success)}catch(a){return console.error("R2 delete error:",a),!1}}const n={uploadPronunciation:async(e,t,o)=>a(e,`pronunciation/${t}/${o}/${Date.now()}.webm`,{contentType:"audio/webm"}),uploadSpeaking:async(e,t,o)=>a(e,`speaking/${t}/${o}_${Date.now()}.webm`,{contentType:"audio/webm"}),uploadListening:async(e,t,o)=>a(e,`listening/${t}/${o}`,{contentType:"audio/mpeg"}),uploadAdminAudio:async(e,t,o)=>a(e,`admin/${t}/${Date.now()}-${o}`,{contentType:"audio/mpeg"}),uploadAvatar:async(e,t)=>{const o=e.name.split(".").pop()||"jpg";return a(e,`avatars/${t}/avatar.${o}`,{contentType:e.type})},uploadWritingImage:async(e,t)=>{const o=e.name.split(".").pop()||"jpg";return a(e,`ielts-writing/${t}/${`${Date.now()}.${o}`}`,{contentType:e.type||"image/jpeg",cacheControl:"public, max-age=31536000"})},getAudioUrl:e=>`${t}/${e}`};export{n as A,o as d};
