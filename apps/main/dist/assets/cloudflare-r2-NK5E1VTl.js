import{s as e}from"./index-KxDfHqNJ.js";const t="https://your-bucket.your-domain.com";async function o(t,o,a){try{const n=(null==a?void 0:a.contentType)||t.type,s=(null==a?void 0:a.cacheControl)||"public, max-age=31536000",r=new FormData;r.append("file",t),r.append("path",o),r.append("contentType",n),r.append("cacheControl",s);const{data:{session:c}}=await e.auth.getSession(),i=`${"https://cuumxmfzhwljylbdlflj.supabase.co"}/functions/v1/r2-upload`,u=await fetch(i,{method:"POST",headers:{Authorization:(null==c?void 0:c.access_token)?`Bearer ${c.access_token}`:""},body:r});if(!u.ok){const e=await u.text();throw new Error(`Upload failed: ${u.status} ${u.statusText} - ${e}`)}const p=await u.json();if(!p||!p.success)throw new Error((null==p?void 0:p.error)||"Upload failed");return{success:!0,url:p.url||"",key:p.key||o}}catch(n){console.error("R2 upload error:",n);return{success:!1,url:"",key:"",error:n instanceof Error?n.message:"string"==typeof n?n:"Upload failed"}}}async function a(t){try{const o=`${"https://cuumxmfzhwljylbdlflj.supabase.co"}/functions/v1/r2-delete`,{data:{session:a}}=await e.auth.getSession(),n=await fetch(o,{method:"POST",headers:{Authorization:(null==a?void 0:a.access_token)?`Bearer ${a.access_token}`:"","Content-Type":"application/json"},body:JSON.stringify({key:t})});if(!n.ok){const e=await n.text();throw new Error(`Delete failed: ${n.status} ${n.statusText} - ${e}`)}const s=await n.json();return!0===(null==s?void 0:s.success)}catch(o){return console.error("R2 delete error:",o),!1}}const n={uploadPronunciation:async(e,t,a)=>o(e,`pronunciation/${t}/${a}/${Date.now()}.webm`,{contentType:"audio/webm"}),uploadSpeaking:async(e,t,a)=>o(e,`speaking/${t}/${a}_${Date.now()}.webm`,{contentType:"audio/webm"}),uploadListening:async(e,t,a)=>o(e,`listening/${t}/${a}`,{contentType:"audio/mpeg"}),uploadAdminAudio:async(e,t,a)=>o(e,`admin/${t}/${Date.now()}-${a}`,{contentType:"audio/mpeg"}),uploadAvatar:async(e,t)=>{const a=e.name.split(".").pop()||"jpg";return o(e,`avatars/${t}/avatar.${a}`,{contentType:e.type})},uploadWritingImage:async(e,t)=>{const a=e.name.split(".").pop()||"jpg";return o(e,`ielts-writing/${t}/${`${Date.now()}.${a}`}`,{contentType:e.type||"image/jpeg",cacheControl:"public, max-age=31536000"})},getAudioUrl:e=>`${t}/${e}`};export{n as A,a as d,o as u};
