⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217
Testing Edge Function directly for detailed error...
❌ Function call error: FunctionsHttpError: Edge Function returned a non-2xx status code
    at FunctionsClient.<anonymous> (/Users/alfie/alfie-ai-coach-1/apps/main/node_modules/@supabase/functions-js/dist/main/FunctionsClient.js:92:27)
    at Generator.next (<anonymous>)
    at fulfilled (/Users/alfie/alfie-ai-coach-1/apps/main/node_modules/@supabase/functions-js/dist/main/FunctionsClient.js:5:58)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5) {
  context: Response {
    [Symbol(realm)]: null,
    [Symbol(state)]: {
      aborted: false,
      rangeRequested: false,
      timingAllowPassed: true,
      requestIncludesCredentials: true,
      type: 'default',
      status: 500,
      timingInfo: [Object],
      cacheState: '',
      statusText: 'Internal Server Error',
      headersList: [HeadersList],
      urlList: [Array],
      body: [Object]
    },
    [Symbol(headers)]: HeadersList {
      cookies: [Array],
      [Symbol(headers map)]: [Map],
      [Symbol(headers map sorted)]: null
    }
  }
}
Context: Response {
  [Symbol(realm)]: null,
  [Symbol(state)]: {
    aborted: false,
    rangeRequested: false,
    timingAllowPassed: true,
    requestIncludesCredentials: true,
    type: 'default',
    status: 500,
    timingInfo: {
      startTime: 620.6854999065399,
      redirectStartTime: 0,
      redirectEndTime: 0,
      postRedirectStartTime: 620.6854999065399,
      finalServiceWorkerStartTime: 0,
      finalNetworkResponseStartTime: 0,
      finalNetworkRequestStartTime: 0,
      endTime: 0,
      encodedBodySize: 371,
      decodedBodySize: 0,
      finalConnectionTimingInfo: null
    },
    cacheState: '',
    statusText: 'Internal Server Error',
    headersList: HeadersList {
      cookies: [Array],
      [Symbol(headers map)]: [Map],
      [Symbol(headers map sorted)]: null
    },
    urlList: [ [URL] ],
    body: { stream: undefined }
  },
  [Symbol(headers)]: HeadersList {
    cookies: [
      '__cf_bm=I._BxTpn2GSoMFP_P3P6R2KRvbfy2UbrDSqZsogHL6w-1765865047-1.0.1.1-Ns4U3fK9Ua8Amu9IVV0vMObvOA_UXHzw9gZq21k8yP.mBmFvAoDVocu.p_DXHtxQYh9FngbW2mxSywUn1Xi_nMSyRuauUzJ0ys7taMpJkD4; path=/; expires=Tue, 16-Dec-25 06:34:07 GMT; domain=.supabase.co; HttpOnly; Secure; SameSite=None'
    ],
    [Symbol(headers map)]: Map(19) {
      'date' => [Object],
      'content-type' => [Object],
      'content-length' => [Object],
      'connection' => [Object],
      'server' => [Object],
      'cf-ray' => [Object],
      'cf-cache-status' => [Object],
      'access-control-allow-origin' => [Object],
      'content-encoding' => [Object],
      'strict-transport-security' => [Object],
      'vary' => [Object],
      'access-control-allow-headers' => [Object],
      'sb-project-ref' => [Object],
      'sb-request-id' => [Object],
      'x-deno-execution-id' => [Object],
      'x-sb-edge-region' => [Object],
      'x-served-by' => [Object],
      'set-cookie' => [Object],
      'alt-svc' => [Object]
    },
    [Symbol(headers map sorted)]: null
  }
}
Trying raw fetch...
Status: 500 Internal Server Error
Body: {"success":false,"error":"[GoogleGenerativeAI Error]: Error fetching from https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent: [429 Too Many Requests] You exceeded your current quota. Please migrate to Gemini 2.5 Flash Image (models/gemini-2.5-flash-image) for higher quota limits. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [{\"@type\":\"type.googleapis.com/google.rpc.Help\",\"links\":[{\"description\":\"Learn more about Gemini API quotas\",\"url\":\"https://ai.google.dev/gemini-api/docs/rate-limits\"}]},{\"@type\":\"type.googleapis.com/google.rpc.QuotaFailure\",\"violations\":[{\"quotaMetric\":\"generativelanguage.googleapis.com/generate_requests_per_model_per_day\",\"quotaId\":\"GenerateRequestsPerDayPerProjectPerModel\"}]}]","details":{"status":429,"statusText":"Too Many Requests","errorDetails":[{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_requests_per_model_per_day","quotaId":"GenerateRequestsPerDayPerProjectPerModel"}]}]}}
